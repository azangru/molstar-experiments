var Tt={exports:{}},Gr={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var g5=Object.getOwnPropertySymbols,Nq=Object.prototype.hasOwnProperty,Uq=Object.prototype.propertyIsEnumerable;function zq(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function Vq(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(n.join("")!=="0123456789")return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(i){a[i]=i}),Object.keys(Object.assign({},a)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var kk=Vq()?Object.assign:function(e,t){for(var r,n=zq(e),a,i=1;i<arguments.length;i++){r=Object(arguments[i]);for(var o in r)Nq.call(r,o)&&(n[o]=r[o]);if(g5){a=g5(r);for(var s=0;s<a.length;s++)Uq.call(r,a[s])&&(n[a[s]]=r[a[s]])}}return n};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LA=kk,vm=60103,Lk=60106;Gr.Fragment=60107;Gr.StrictMode=60108;Gr.Profiler=60114;var Fk=60109,Nk=60110,Uk=60112;Gr.Suspense=60113;var zk=60115,Vk=60116;if(typeof Symbol=="function"&&Symbol.for){var bs=Symbol.for;vm=bs("react.element"),Lk=bs("react.portal"),Gr.Fragment=bs("react.fragment"),Gr.StrictMode=bs("react.strict_mode"),Gr.Profiler=bs("react.profiler"),Fk=bs("react.provider"),Nk=bs("react.context"),Uk=bs("react.forward_ref"),Gr.Suspense=bs("react.suspense"),zk=bs("react.memo"),Vk=bs("react.lazy")}var y5=typeof Symbol=="function"&&Symbol.iterator;function Hq(e){return e===null||typeof e!="object"?null:(e=y5&&e[y5]||e["@@iterator"],typeof e=="function"?e:null)}function fg(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Hk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gk={};function mm(e,t,r){this.props=e,this.context=t,this.refs=Gk,this.updater=r||Hk}mm.prototype.isReactComponent={};mm.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error(fg(85));this.updater.enqueueSetState(this,e,t,"setState")};mm.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function qk(){}qk.prototype=mm.prototype;function FA(e,t,r){this.props=e,this.context=t,this.refs=Gk,this.updater=r||Hk}var NA=FA.prototype=new qk;NA.constructor=FA;LA(NA,mm.prototype);NA.isPureReactComponent=!0;var UA={current:null},jk=Object.prototype.hasOwnProperty,Wk={key:!0,ref:!0,__self:!0,__source:!0};function Xk(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)jk.call(t,n)&&!Wk.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];a.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:vm,type:e,key:i,ref:o,props:a,_owner:UA.current}}function Gq(e,t){return{$$typeof:vm,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function zA(e){return typeof e=="object"&&e!==null&&e.$$typeof===vm}function qq(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var b5=/\/+/g;function Bx(e,t){return typeof e=="object"&&e!==null&&e.key!=null?qq(""+e.key):t.toString(36)}function y1(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case vm:case Lk:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+Bx(o,0):n,Array.isArray(a)?(r="",e!=null&&(r=e.replace(b5,"$&/")+"/"),y1(a,t,r,"",function(l){return l})):a!=null&&(zA(a)&&(a=Gq(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(b5,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",Array.isArray(e))for(var s=0;s<e.length;s++){i=e[s];var u=n+Bx(i,s);o+=y1(i,t,r,u,a)}else if(u=Hq(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=n+Bx(i,s++),o+=y1(i,t,r,u,a);else if(i==="object")throw t=""+e,Error(fg(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t));return o}function Yg(e,t,r){if(e==null)return e;var n=[],a=0;return y1(e,n,"","",function(i){return t.call(r,i,a++)}),n}function jq(e){if(e._status===-1){var t=e._result;t=t(),e._status=0,e._result=t,t.then(function(r){e._status===0&&(r=r.default,e._status=1,e._result=r)},function(r){e._status===0&&(e._status=2,e._result=r)})}if(e._status===1)return e._result;throw e._result}var Yk={current:null};function Wl(){var e=Yk.current;if(e===null)throw Error(fg(321));return e}var Wq={ReactCurrentDispatcher:Yk,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:UA,IsSomeRendererActing:{current:!1},assign:LA};Gr.Children={map:Yg,forEach:function(e,t,r){Yg(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Yg(e,function(){t++}),t},toArray:function(e){return Yg(e,function(t){return t})||[]},only:function(e){if(!zA(e))throw Error(fg(143));return e}};Gr.Component=mm;Gr.PureComponent=FA;Gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wq;Gr.cloneElement=function(e,t,r){if(e==null)throw Error(fg(267,e));var n=LA({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=UA.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)jk.call(t,u)&&!Wk.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:vm,type:e.type,key:a,ref:i,props:n,_owner:o}};Gr.createContext=function(e,t){return t===void 0&&(t=null),e={$$typeof:Nk,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider={$$typeof:Fk,_context:e},e.Consumer=e};Gr.createElement=Xk;Gr.createFactory=function(e){var t=Xk.bind(null,e);return t.type=e,t};Gr.createRef=function(){return{current:null}};Gr.forwardRef=function(e){return{$$typeof:Uk,render:e}};Gr.isValidElement=zA;Gr.lazy=function(e){return{$$typeof:Vk,_payload:{_status:-1,_result:e},_init:jq}};Gr.memo=function(e,t){return{$$typeof:zk,type:e,compare:t===void 0?null:t}};Gr.useCallback=function(e,t){return Wl().useCallback(e,t)};Gr.useContext=function(e,t){return Wl().useContext(e,t)};Gr.useDebugValue=function(){};Gr.useEffect=function(e,t){return Wl().useEffect(e,t)};Gr.useImperativeHandle=function(e,t,r){return Wl().useImperativeHandle(e,t,r)};Gr.useLayoutEffect=function(e,t){return Wl().useLayoutEffect(e,t)};Gr.useMemo=function(e,t){return Wl().useMemo(e,t)};Gr.useReducer=function(e,t,r){return Wl().useReducer(e,t,r)};Gr.useRef=function(e){return Wl().useRef(e)};Gr.useState=function(e){return Wl().useState(e)};Gr.version="17.0.2";Tt.exports=Gr;var b6e=Tt.exports,VA={exports:{}},vs={},Kk={exports:{}},Qk={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){var t,r,n,a;if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var u=null,l=null,c=function(){if(u!==null)try{var J=e.unstable_now();u(!0,J),u=null}catch(Z){throw setTimeout(c,0),Z}};t=function(J){u!==null?setTimeout(t,0,J):(u=J,setTimeout(c,0))},r=function(J,Z){l=setTimeout(J,Z)},n=function(){clearTimeout(l)},e.unstable_shouldYield=function(){return!1},a=e.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,f=window.clearTimeout;if(typeof console!="undefined"){var p=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof p!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var v=!1,m=null,h=-1,g=5,y=0;e.unstable_shouldYield=function(){return e.unstable_now()>=y},a=function(){},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):g=0<J?Math.floor(1e3/J):5};var b=new MessageChannel,S=b.port2;b.port1.onmessage=function(){if(m!==null){var J=e.unstable_now();y=J+g;try{m(!0,J)?S.postMessage(null):(v=!1,m=null)}catch(Z){throw S.postMessage(null),Z}}else v=!1},t=function(J){m=J,v||(v=!0,S.postMessage(null))},r=function(J,Z){h=d(function(){J(e.unstable_now())},Z)},n=function(){f(h),h=-1}}function C(J,Z){var N=J.length;J.push(Z);e:for(;;){var j=N-1>>>1,L=J[j];if(L!==void 0&&0<P(L,Z))J[j]=Z,J[N]=L,N=j;else break e}}function x(J){return J=J[0],J===void 0?null:J}function A(J){var Z=J[0];if(Z!==void 0){var N=J.pop();if(N!==Z){J[0]=N;e:for(var j=0,L=J.length;j<L;){var H=2*(j+1)-1,G=J[H],q=H+1,X=J[q];if(G!==void 0&&0>P(G,N))X!==void 0&&0>P(X,G)?(J[j]=X,J[q]=N,j=q):(J[j]=G,J[H]=N,j=H);else if(X!==void 0&&0>P(X,N))J[j]=X,J[q]=N,j=q;else break e}}return Z}return null}function P(J,Z){var N=J.sortIndex-Z.sortIndex;return N!==0?N:J.id-Z.id}var T=[],D=[],I=1,M=null,B=3,U=!1,V=!1,F=!1;function Y(J){for(var Z=x(D);Z!==null;){if(Z.callback===null)A(D);else if(Z.startTime<=J)A(D),Z.sortIndex=Z.expirationTime,C(T,Z);else break;Z=x(D)}}function W(J){if(F=!1,Y(J),!V)if(x(T)!==null)V=!0,t(K);else{var Z=x(D);Z!==null&&r(W,Z.startTime-J)}}function K(J,Z){V=!1,F&&(F=!1,n()),U=!0;var N=B;try{for(Y(Z),M=x(T);M!==null&&(!(M.expirationTime>Z)||J&&!e.unstable_shouldYield());){var j=M.callback;if(typeof j=="function"){M.callback=null,B=M.priorityLevel;var L=j(M.expirationTime<=Z);Z=e.unstable_now(),typeof L=="function"?M.callback=L:M===x(T)&&A(T),Y(Z)}else A(T);M=x(T)}if(M!==null)var H=!0;else{var G=x(D);G!==null&&r(W,G.startTime-Z),H=!1}return H}finally{M=null,B=N,U=!1}}var $=a;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_continueExecution=function(){V||U||(V=!0,t(K))},e.unstable_getCurrentPriorityLevel=function(){return B},e.unstable_getFirstCallbackNode=function(){return x(T)},e.unstable_next=function(J){switch(B){case 1:case 2:case 3:var Z=3;break;default:Z=B}var N=B;B=Z;try{return J()}finally{B=N}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=$,e.unstable_runWithPriority=function(J,Z){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var N=B;B=J;try{return Z()}finally{B=N}},e.unstable_scheduleCallback=function(J,Z,N){var j=e.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?j+N:j):N=j,J){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=N+L,J={id:I++,callback:Z,priorityLevel:J,startTime:N,expirationTime:L,sortIndex:-1},N>j?(J.sortIndex=N,C(D,J),x(T)===null&&J===x(D)&&(F?n():F=!0,r(W,N-j))):(J.sortIndex=L,C(T,J),V||U||(V=!0,t(K))),J},e.unstable_wrapCallback=function(J){var Z=B;return function(){var N=B;B=Z;try{return J.apply(this,arguments)}finally{B=N}}}})(Qk);Kk.exports=Qk;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L2=Tt.exports,Ln=kk,La=Kk.exports;function Ct(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!L2)throw Error(Ct(227));var Zk=new Set,_0={};function op(e,t){Gv(e,t),Gv(e+"Capture",t)}function Gv(e,t){for(_0[e]=t,e=0;e<t.length;e++)Zk.add(t[e])}var _l=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Xq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S5=Object.prototype.hasOwnProperty,x5={},C5={};function Yq(e){return S5.call(C5,e)?!0:S5.call(x5,e)?!1:Xq.test(e)?C5[e]=!0:(x5[e]=!0,!1)}function Kq(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Qq(e,t,r,n){if(t===null||typeof t=="undefined"||Kq(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Oi(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var Wa={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Wa[e]=new Oi(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Wa[t]=new Oi(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Wa[e]=new Oi(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Wa[e]=new Oi(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Wa[e]=new Oi(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Wa[e]=new Oi(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Wa[e]=new Oi(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Wa[e]=new Oi(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Wa[e]=new Oi(e,5,!1,e.toLowerCase(),null,!1,!1)});var HA=/[\-:]([a-z])/g;function GA(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(HA,GA);Wa[t]=new Oi(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(HA,GA);Wa[t]=new Oi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(HA,GA);Wa[t]=new Oi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Wa[e]=new Oi(e,1,!1,e.toLowerCase(),null,!1,!1)});Wa.xlinkHref=new Oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Wa[e]=new Oi(e,1,!1,e.toLowerCase(),null,!0,!0)});function qA(e,t,r,n){var a=Wa.hasOwnProperty(t)?Wa[t]:null,i=a!==null?a.type===0:n?!1:!(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N");i||(Qq(t,r,a,n)&&(r=null),n||a===null?Yq(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var sp=L2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Mh=60103,hf=60106,Rc=60107,jA=60108,Kh=60114,WA=60109,XA=60110,F2=60112,Qh=60113,W1=60120,N2=60115,YA=60116,KA=60121,QA=60128,$k=60129,ZA=60130,Pw=60131;if(typeof Symbol=="function"&&Symbol.for){var Aa=Symbol.for;Mh=Aa("react.element"),hf=Aa("react.portal"),Rc=Aa("react.fragment"),jA=Aa("react.strict_mode"),Kh=Aa("react.profiler"),WA=Aa("react.provider"),XA=Aa("react.context"),F2=Aa("react.forward_ref"),Qh=Aa("react.suspense"),W1=Aa("react.suspense_list"),N2=Aa("react.memo"),YA=Aa("react.lazy"),KA=Aa("react.block"),Aa("react.scope"),QA=Aa("react.opaque.id"),$k=Aa("react.debug_trace_mode"),ZA=Aa("react.offscreen"),Pw=Aa("react.legacy_hidden")}var w5=typeof Symbol=="function"&&Symbol.iterator;function Xm(e){return e===null||typeof e!="object"?null:(e=w5&&e[w5]||e["@@iterator"],typeof e=="function"?e:null)}var kx;function Rh(e){if(kx===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);kx=t&&t[1]||""}return`
`+kx+e}var Lx=!1;function Kg(e,t){if(!e||Lx)return"";Lx=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s])return`
`+a[o].replace(" at new "," at ");while(1<=o&&0<=s);break}}}finally{Lx=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Rh(e):""}function Zq(e){switch(e.tag){case 5:return Rh(e.type);case 16:return Rh("Lazy");case 13:return Rh("Suspense");case 19:return Rh("SuspenseList");case 0:case 2:case 15:return e=Kg(e.type,!1),e;case 11:return e=Kg(e.type.render,!1),e;case 22:return e=Kg(e.type._render,!1),e;case 1:return e=Kg(e.type,!0),e;default:return""}}function _v(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Rc:return"Fragment";case hf:return"Portal";case Kh:return"Profiler";case jA:return"StrictMode";case Qh:return"Suspense";case W1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case XA:return(e.displayName||"Context")+".Consumer";case WA:return(e._context.displayName||"Context")+".Provider";case F2:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case N2:return _v(e.type);case KA:return _v(e._render);case YA:t=e._payload,e=e._init;try{return _v(e(t))}catch{}}return null}function vd(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Jk(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function $q(e){var t=Jk(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r!="undefined"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Qg(e){e._valueTracker||(e._valueTracker=$q(e))}function eL(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Jk(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function X1(e){if(e=e||(typeof document!="undefined"?document:void 0),typeof e=="undefined")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ew(e,t){var r=t.checked;return Ln({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function _5(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=vd(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function tL(e,t){t=t.checked,t!=null&&qA(e,"checked",t,!1)}function Iw(e,t){tL(e,t);var r=vd(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Dw(e,t.type,r):t.hasOwnProperty("defaultValue")&&Dw(e,t.type,vd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function A5(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Dw(e,t,r){(t!=="number"||X1(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function Jq(e){var t="";return L2.Children.forEach(e,function(r){r!=null&&(t+=r)}),t}function Mw(e,t){return e=Ln({children:void 0},t),(t=Jq(t.children))&&(e.children=t),e}function Av(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+vd(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Rw(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ct(91));return Ln({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function T5(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Ct(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(Ct(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:vd(r)}}function rL(e,t){var r=vd(t.value),n=vd(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function P5(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}var Ow={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function nL(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Bw(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?nL(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Zg,aL=function(e){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!==Ow.svg||"innerHTML"in e)e.innerHTML=t;else{for(Zg=Zg||document.createElement("div"),Zg.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Zg.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function A0(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Zh={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ej=["Webkit","ms","Moz","O"];Object.keys(Zh).forEach(function(e){ej.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Zh[t]=Zh[e]})});function iL(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Zh.hasOwnProperty(e)&&Zh[e]?(""+t).trim():t+"px"}function oL(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=iL(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var tj=Ln({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kw(e,t){if(t){if(tj[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ct(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ct(60));if(!(typeof t.dangerouslySetInnerHTML=="object"&&"__html"in t.dangerouslySetInnerHTML))throw Error(Ct(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ct(62))}}function Lw(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function $A(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Fw=null,Tv=null,Pv=null;function E5(e){if(e=vg(e)){if(typeof Fw!="function")throw Error(Ct(280));var t=e.stateNode;t&&(t=q2(t),Fw(e.stateNode,e.type,t))}}function sL(e){Tv?Pv?Pv.push(e):Pv=[e]:Tv=e}function uL(){if(Tv){var e=Tv,t=Pv;if(Pv=Tv=null,E5(e),t)for(e=0;e<t.length;e++)E5(t[e])}}function JA(e,t){return e(t)}function lL(e,t,r,n,a){return e(t,r,n,a)}function eT(){}var cL=JA,gf=!1,Fx=!1;function tT(){(Tv!==null||Pv!==null)&&(eT(),uL())}function rj(e,t,r){if(Fx)return e(t,r);Fx=!0;try{return cL(e,t,r)}finally{Fx=!1,tT()}}function T0(e,t){var r=e.stateNode;if(r===null)return null;var n=q2(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Ct(231,t,typeof r));return r}var Nw=!1;if(_l)try{var Ym={};Object.defineProperty(Ym,"passive",{get:function(){Nw=!0}}),window.addEventListener("test",Ym,Ym),window.removeEventListener("test",Ym,Ym)}catch{Nw=!1}function nj(e,t,r,n,a,i,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var $h=!1,Y1=null,K1=!1,Uw=null,aj={onError:function(e){$h=!0,Y1=e}};function ij(e,t,r,n,a,i,o,s,u){$h=!1,Y1=null,nj.apply(aj,arguments)}function oj(e,t,r,n,a,i,o,s,u){if(ij.apply(this,arguments),$h){if($h){var l=Y1;$h=!1,Y1=null}else throw Error(Ct(198));K1||(K1=!0,Uw=l)}}function up(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&1026)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function dL(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function I5(e){if(up(e)!==e)throw Error(Ct(188))}function sj(e){var t=e.alternate;if(!t){if(t=up(e),t===null)throw Error(Ct(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return I5(a),e;if(i===n)return I5(a),t;i=i.sibling}throw Error(Ct(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(Ct(189))}}if(r.alternate!==n)throw Error(Ct(190))}if(r.tag!==3)throw Error(Ct(188));return r.stateNode.current===r?e:t}function fL(e){if(e=sj(e),!e)return null;for(var t=e;;){if(t.tag===5||t.tag===6)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function D5(e,t){for(var r=e.alternate;t!==null;){if(t===e||t===r)return!0;t=t.return}return!1}var pL,rT,vL,mL,zw=!1,yu=[],Jc=null,ed=null,td=null,P0=new Map,E0=new Map,Km=[],M5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vw(e,t,r,n,a){return{blockedOn:e,domEventName:t,eventSystemFlags:r|16,nativeEvent:a,targetContainers:[n]}}function R5(e,t){switch(e){case"focusin":case"focusout":Jc=null;break;case"dragenter":case"dragleave":ed=null;break;case"mouseover":case"mouseout":td=null;break;case"pointerover":case"pointerout":P0.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":E0.delete(t.pointerId)}}function Qm(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e=Vw(t,r,n,a,i),t!==null&&(t=vg(t),t!==null&&rT(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function uj(e,t,r,n,a){switch(t){case"focusin":return Jc=Qm(Jc,e,t,r,n,a),!0;case"dragenter":return ed=Qm(ed,e,t,r,n,a),!0;case"mouseover":return td=Qm(td,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return P0.set(i,Qm(P0.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,E0.set(i,Qm(E0.get(i)||null,e,t,r,n,a)),!0}return!1}function lj(e){var t=yf(e.target);if(t!==null){var r=up(t);if(r!==null){if(t=r.tag,t===13){if(t=dL(r),t!==null){e.blockedOn=t,mL(e.lanePriority,function(){La.unstable_runWithPriority(e.priority,function(){vL(r)})});return}}else if(t===3&&r.stateNode.hydrate){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function b1(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=oT(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r!==null)return t=vg(r),t!==null&&rT(t),e.blockedOn=r,!1;t.shift()}return!0}function O5(e,t,r){b1(e)&&r.delete(t)}function cj(){for(zw=!1;0<yu.length;){var e=yu[0];if(e.blockedOn!==null){e=vg(e.blockedOn),e!==null&&pL(e);break}for(var t=e.targetContainers;0<t.length;){var r=oT(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r!==null){e.blockedOn=r;break}t.shift()}e.blockedOn===null&&yu.shift()}Jc!==null&&b1(Jc)&&(Jc=null),ed!==null&&b1(ed)&&(ed=null),td!==null&&b1(td)&&(td=null),P0.forEach(O5),E0.forEach(O5)}function Zm(e,t){e.blockedOn===t&&(e.blockedOn=null,zw||(zw=!0,La.unstable_scheduleCallback(La.unstable_NormalPriority,cj)))}function hL(e){function t(a){return Zm(a,e)}if(0<yu.length){Zm(yu[0],e);for(var r=1;r<yu.length;r++){var n=yu[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Jc!==null&&Zm(Jc,e),ed!==null&&Zm(ed,e),td!==null&&Zm(td,e),P0.forEach(t),E0.forEach(t),r=0;r<Km.length;r++)n=Km[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Km.length&&(r=Km[0],r.blockedOn===null);)lj(r),r.blockedOn===null&&Km.shift()}function $g(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var dv={animationend:$g("Animation","AnimationEnd"),animationiteration:$g("Animation","AnimationIteration"),animationstart:$g("Animation","AnimationStart"),transitionend:$g("Transition","TransitionEnd")},Nx={},gL={};_l&&(gL=document.createElement("div").style,"AnimationEvent"in window||(delete dv.animationend.animation,delete dv.animationiteration.animation,delete dv.animationstart.animation),"TransitionEvent"in window||delete dv.transitionend.transition);function U2(e){if(Nx[e])return Nx[e];if(!dv[e])return e;var t=dv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in gL)return Nx[e]=t[r];return e}var yL=U2("animationend"),bL=U2("animationiteration"),SL=U2("animationstart"),xL=U2("transitionend"),CL=new Map,nT=new Map,dj=["abort","abort",yL,"animationEnd",bL,"animationIteration",SL,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",xL,"transitionEnd","waiting","waiting"];function aT(e,t){for(var r=0;r<e.length;r+=2){var n=e[r],a=e[r+1];a="on"+(a[0].toUpperCase()+a.slice(1)),nT.set(n,t),CL.set(n,a),op(a,[n])}}var fj=La.unstable_now;fj();var mn=8;function sv(e){if((1&e)!==0)return mn=15,1;if((2&e)!==0)return mn=14,2;if((4&e)!==0)return mn=13,4;var t=24&e;return t!==0?(mn=12,t):(e&32)!==0?(mn=11,32):(t=192&e,t!==0?(mn=10,t):(e&256)!==0?(mn=9,256):(t=3584&e,t!==0?(mn=8,t):(e&4096)!==0?(mn=7,4096):(t=4186112&e,t!==0?(mn=6,t):(t=62914560&e,t!==0?(mn=5,t):e&67108864?(mn=4,67108864):(e&134217728)!==0?(mn=3,134217728):(t=805306368&e,t!==0?(mn=2,t):(1073741824&e)!==0?(mn=1,1073741824):(mn=8,e))))))}function pj(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function vj(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(Ct(358,e))}}function I0(e,t){var r=e.pendingLanes;if(r===0)return mn=0;var n=0,a=0,i=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(i!==0)n=i,a=mn=15;else if(i=r&134217727,i!==0){var u=i&~o;u!==0?(n=sv(u),a=mn):(s&=i,s!==0&&(n=sv(s),a=mn))}else i=r&~o,i!==0?(n=sv(i),a=mn):s!==0&&(n=sv(s),a=mn);if(n===0)return 0;if(n=31-md(n),n=r&((0>n?0:1<<n)<<1)-1,t!==0&&t!==n&&(t&o)===0){if(sv(t),a<=mn)return t;mn=a}if(t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-md(t),a=1<<r,n|=e[r],t&=~a;return n}function wL(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Q1(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return e=uv(24&~t),e===0?Q1(10,t):e;case 10:return e=uv(192&~t),e===0?Q1(8,t):e;case 8:return e=uv(3584&~t),e===0&&(e=uv(4186112&~t),e===0&&(e=512)),e;case 2:return t=uv(805306368&~t),t===0&&(t=268435456),t}throw Error(Ct(358,e))}function uv(e){return e&-e}function Ux(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function z2(e,t,r){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,e=e.eventTimes,t=31-md(t),e[t]=r}var md=Math.clz32?Math.clz32:gj,mj=Math.log,hj=Math.LN2;function gj(e){return e===0?32:31-(mj(e)/hj|0)|0}var yj=La.unstable_UserBlockingPriority,bj=La.unstable_runWithPriority,S1=!0;function Sj(e,t,r,n){gf||eT();var a=iT,i=gf;gf=!0;try{lL(a,e,t,r,n)}finally{(gf=i)||tT()}}function xj(e,t,r,n){bj(yj,iT.bind(null,e,t,r,n))}function iT(e,t,r,n){if(S1){var a;if((a=(t&4)===0)&&0<yu.length&&-1<M5.indexOf(e))e=Vw(null,e,t,r,n),yu.push(e);else{var i=oT(e,t,r,n);if(i===null)a&&R5(e,n);else{if(a){if(-1<M5.indexOf(e)){e=Vw(i,e,t,r,n),yu.push(e);return}if(uj(i,e,t,r,n))return;R5(e,n)}LL(e,t,n,null,r)}}}}function oT(e,t,r,n){var a=$A(n);if(a=yf(a),a!==null){var i=up(a);if(i===null)a=null;else{var o=i.tag;if(o===13){if(a=dL(i),a!==null)return a;a=null}else if(o===3){if(i.stateNode.hydrate)return i.tag===3?i.stateNode.containerInfo:null;a=null}else i!==a&&(a=null)}}return LL(e,t,n,a,r),null}var Hc=null,sT=null,x1=null;function _L(){if(x1)return x1;var e,t=sT,r=t.length,n,a="value"in Hc?Hc.value:Hc.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return x1=a.slice(e,1<n?1-n:void 0)}function C1(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Jg(){return!0}function B5(){return!1}function Ao(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Jg:B5,this.isPropagationStopped=B5,this}return Ln(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Jg)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Jg)},persist:function(){},isPersistent:Jg}),t}var hm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uT=Ao(hm),pg=Ln({},hm,{view:0,detail:0}),Cj=Ao(pg),zx,Vx,$m,V2=Ln({},pg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lT,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$m&&($m&&e.type==="mousemove"?(zx=e.screenX-$m.screenX,Vx=e.screenY-$m.screenY):Vx=zx=0,$m=e),zx)},movementY:function(e){return"movementY"in e?e.movementY:Vx}}),k5=Ao(V2),wj=Ln({},V2,{dataTransfer:0}),_j=Ao(wj),Aj=Ln({},pg,{relatedTarget:0}),Hx=Ao(Aj),Tj=Ln({},hm,{animationName:0,elapsedTime:0,pseudoElement:0}),Pj=Ao(Tj),Ej=Ln({},hm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ij=Ao(Ej),Dj=Ln({},hm,{data:0}),L5=Ao(Dj),Mj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bj(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Oj[e])?!!t[e]:!1}function lT(){return Bj}var kj=Ln({},pg,{key:function(e){if(e.key){var t=Mj[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=C1(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Rj[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lT,charCode:function(e){return e.type==="keypress"?C1(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?C1(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Lj=Ao(kj),Fj=Ln({},V2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),F5=Ao(Fj),Nj=Ln({},pg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lT}),Uj=Ao(Nj),zj=Ln({},hm,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vj=Ao(zj),Hj=Ln({},V2,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Gj=Ao(Hj),qj=[9,13,27,32],cT=_l&&"CompositionEvent"in window,Jh=null;_l&&"documentMode"in document&&(Jh=document.documentMode);var jj=_l&&"TextEvent"in window&&!Jh,AL=_l&&(!cT||Jh&&8<Jh&&11>=Jh),N5=String.fromCharCode(32),U5=!1;function TL(e,t){switch(e){case"keyup":return qj.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function PL(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var fv=!1;function Wj(e,t){switch(e){case"compositionend":return PL(t);case"keypress":return t.which!==32?null:(U5=!0,N5);case"textInput":return e=t.data,e===N5&&U5?null:e;default:return null}}function Xj(e,t){if(fv)return e==="compositionend"||!cT&&TL(e,t)?(e=_L(),x1=sT=Hc=null,fv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return AL&&t.locale!=="ko"?null:t.data;default:return null}}var Yj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function z5(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Yj[e.type]:t==="textarea"}function EL(e,t,r,n){sL(n),t=Z1(t,"onChange"),0<t.length&&(r=new uT("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var e0=null,D0=null;function Kj(e){OL(e,0)}function H2(e){var t=vv(e);if(eL(t))return e}function Qj(e,t){if(e==="change")return t}var IL=!1;if(_l){var Gx;if(_l){var qx="oninput"in document;if(!qx){var V5=document.createElement("div");V5.setAttribute("oninput","return;"),qx=typeof V5.oninput=="function"}Gx=qx}else Gx=!1;IL=Gx&&(!document.documentMode||9<document.documentMode)}function H5(){e0&&(e0.detachEvent("onpropertychange",DL),D0=e0=null)}function DL(e){if(e.propertyName==="value"&&H2(D0)){var t=[];if(EL(t,D0,e,$A(e)),e=Kj,gf)e(t);else{gf=!0;try{JA(e,t)}finally{gf=!1,tT()}}}}function Zj(e,t,r){e==="focusin"?(H5(),e0=t,D0=r,e0.attachEvent("onpropertychange",DL)):e==="focusout"&&H5()}function $j(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return H2(D0)}function Jj(e,t){if(e==="click")return H2(t)}function eW(e,t){if(e==="input"||e==="change")return H2(t)}function tW(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qo=typeof Object.is=="function"?Object.is:tW,rW=Object.prototype.hasOwnProperty;function M0(e,t){if(qo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!rW.call(t,r[n])||!qo(e[r[n]],t[r[n]]))return!1;return!0}function G5(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function q5(e,t){var r=G5(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=G5(r)}}function ML(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ML(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function j5(){for(var e=window,t=X1();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=X1(e.document)}return t}function Hw(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var nW=_l&&"documentMode"in document&&11>=document.documentMode,pv=null,Gw=null,t0=null,qw=!1;function W5(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;qw||pv==null||pv!==X1(n)||(n=pv,"selectionStart"in n&&Hw(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),t0&&M0(t0,n)||(t0=n,n=Z1(Gw,"onSelect"),0<n.length&&(t=new uT("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=pv)))}aT("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);aT("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);aT(dj,2);for(var X5="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),jx=0;jx<X5.length;jx++)nT.set(X5[jx],0);Gv("onMouseEnter",["mouseout","mouseover"]);Gv("onMouseLeave",["mouseout","mouseover"]);Gv("onPointerEnter",["pointerout","pointerover"]);Gv("onPointerLeave",["pointerout","pointerover"]);op("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));op("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));op("onBeforeInput",["compositionend","keypress","textInput","paste"]);op("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));op("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));op("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),RL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oh));function Y5(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,oj(n,t,void 0,e),e.currentTarget=null}function OL(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Y5(a,s,l),i=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Y5(a,s,l),i=u}}}if(K1)throw e=Uw,K1=!1,Uw=null,e}function Sn(e,t){var r=NL(t),n=e+"__bubble";r.has(n)||(kL(t,e,2,!1),r.add(n))}var K5="_reactListening"+Math.random().toString(36).slice(2);function BL(e){e[K5]||(e[K5]=!0,Zk.forEach(function(t){RL.has(t)||Q5(t,!1,e,null),Q5(t,!0,e,null)}))}function Q5(e,t,r,n){var a=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,i=r;if(e==="selectionchange"&&r.nodeType!==9&&(i=r.ownerDocument),n!==null&&!t&&RL.has(e)){if(e!=="scroll")return;a|=2,i=n}var o=NL(i),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(a|=4),kL(i,e,a,t),o.add(s))}function kL(e,t,r,n){var a=nT.get(t);switch(a===void 0?2:a){case 0:a=Sj;break;case 1:a=xj;break;default:a=iT}r=a.bind(null,t,r,e),a=void 0,!Nw||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function LL(e,t,r,n,a){var i=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===a||u.nodeType===8&&u.parentNode===a))return;o=o.return}for(;s!==null;){if(o=yf(s),o===null)return;if(u=o.tag,u===5||u===6){n=i=o;continue e}s=s.parentNode}}n=n.return}rj(function(){var l=i,c=$A(r),d=[];e:{var f=CL.get(e);if(f!==void 0){var p=uT,v=e;switch(e){case"keypress":if(C1(r)===0)break e;case"keydown":case"keyup":p=Lj;break;case"focusin":v="focus",p=Hx;break;case"focusout":v="blur",p=Hx;break;case"beforeblur":case"afterblur":p=Hx;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=k5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=_j;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Uj;break;case yL:case bL:case SL:p=Pj;break;case xL:p=Vj;break;case"scroll":p=Cj;break;case"wheel":p=Gj;break;case"copy":case"cut":case"paste":p=Ij;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=F5}var m=(t&4)!==0,h=!m&&e==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=T0(y,g),S!=null&&m.push(R0(y,S,b)))),h)break;y=y.return}0<m.length&&(f=new p(f,v,null,r,c),d.push({event:f,listeners:m}))}}if((t&7)===0){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&(t&16)===0&&(v=r.relatedTarget||r.fromElement)&&(yf(v)||v[gm]))break e;if((p||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,p?(v=r.relatedTarget||r.toElement,p=l,v=v?yf(v):null,v!==null&&(h=up(v),v!==h||v.tag!==5&&v.tag!==6)&&(v=null)):(p=null,v=l),p!==v)){if(m=k5,S="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(m=F5,S="onPointerLeave",g="onPointerEnter",y="pointer"),h=p==null?f:vv(p),b=v==null?f:vv(v),f=new m(S,y+"leave",p,r,c),f.target=h,f.relatedTarget=b,S=null,yf(c)===l&&(m=new m(g,y+"enter",v,r,c),m.target=b,m.relatedTarget=h,S=m),h=S,p&&v)t:{for(m=p,g=v,y=0,b=m;b;b=Up(b))y++;for(b=0,S=g;S;S=Up(S))b++;for(;0<y-b;)m=Up(m),y--;for(;0<b-y;)g=Up(g),b--;for(;y--;){if(m===g||g!==null&&m===g.alternate)break t;m=Up(m),g=Up(g)}m=null}else m=null;p!==null&&Z5(d,f,p,m,!1),v!==null&&h!==null&&Z5(d,h,v,m,!0)}}e:{if(f=l?vv(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var C=Qj;else if(z5(f))if(IL)C=eW;else{C=$j;var x=Zj}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=Jj);if(C&&(C=C(e,l))){EL(d,C,r,c);break e}x&&x(e,f,l),e==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&Dw(f,"number",f.value)}switch(x=l?vv(l):window,e){case"focusin":(z5(x)||x.contentEditable==="true")&&(pv=x,Gw=l,t0=null);break;case"focusout":t0=Gw=pv=null;break;case"mousedown":qw=!0;break;case"contextmenu":case"mouseup":case"dragend":qw=!1,W5(d,r,c);break;case"selectionchange":if(nW)break;case"keydown":case"keyup":W5(d,r,c)}var A;if(cT)e:{switch(e){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else fv?TL(e,r)&&(P="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(AL&&r.locale!=="ko"&&(fv||P!=="onCompositionStart"?P==="onCompositionEnd"&&fv&&(A=_L()):(Hc=c,sT="value"in Hc?Hc.value:Hc.textContent,fv=!0)),x=Z1(l,P),0<x.length&&(P=new L5(P,e,null,r,c),d.push({event:P,listeners:x}),A?P.data=A:(A=PL(r),A!==null&&(P.data=A)))),(A=jj?Wj(e,r):Xj(e,r))&&(l=Z1(l,"onBeforeInput"),0<l.length&&(c=new L5("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=A))}OL(d,t)})}function R0(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Z1(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=T0(e,r),i!=null&&n.unshift(R0(e,i,a)),i=T0(e,t),i!=null&&n.push(R0(e,i,a))),e=e.return}return n}function Up(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Z5(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,a?(u=T0(r,i),u!=null&&o.unshift(R0(r,u,s))):a||(u=T0(r,i),u!=null&&o.push(R0(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}function $1(){}var Wx=null,Xx=null;function FL(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function jw(e,t){return e==="textarea"||e==="option"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var $5=typeof setTimeout=="function"?setTimeout:void 0,aW=typeof clearTimeout=="function"?clearTimeout:void 0;function dT(e){e.nodeType===1?e.textContent="":e.nodeType===9&&(e=e.body,e!=null&&(e.textContent=""))}function Ev(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break}return e}function J5(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Yx=0;function iW(e){return{$$typeof:QA,toString:e,valueOf:e}}var G2=Math.random().toString(36).slice(2),Gc="__reactFiber$"+G2,J1="__reactProps$"+G2,gm="__reactContainer$"+G2,eI="__reactEvents$"+G2;function yf(e){var t=e[Gc];if(t)return t;for(var r=e.parentNode;r;){if(t=r[gm]||r[Gc]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=J5(e);e!==null;){if(r=e[Gc])return r;e=J5(e)}return t}e=r,r=e.parentNode}return null}function vg(e){return e=e[Gc]||e[gm],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function vv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ct(33))}function q2(e){return e[J1]||null}function NL(e){var t=e[eI];return t===void 0&&(t=e[eI]=new Set),t}var Ww=[],mv=-1;function Bd(e){return{current:e}}function An(e){0>mv||(e.current=Ww[mv],Ww[mv]=null,mv--)}function jn(e,t){mv++,Ww[mv]=e.current,e.current=t}var hd={},pi=Bd(hd),Wi=Bd(!1),Uf=hd;function qv(e,t){var r=e.type.contextTypes;if(!r)return hd;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Xi(e){return e=e.childContextTypes,e!=null}function eb(){An(Wi),An(pi)}function tI(e,t,r){if(pi.current!==hd)throw Error(Ct(168));jn(pi,t),jn(Wi,r)}function UL(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in e))throw Error(Ct(108,_v(t)||"Unknown",a));return Ln({},r,n)}function w1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||hd,Uf=pi.current,jn(pi,e),jn(Wi,Wi.current),!0}function rI(e,t,r){var n=e.stateNode;if(!n)throw Error(Ct(169));r?(e=UL(e,t,Uf),n.__reactInternalMemoizedMergedChildContext=e,An(Wi),An(pi),jn(pi,e)):An(Wi),jn(Wi,r)}var fT=null,Pf=null,oW=La.unstable_runWithPriority,pT=La.unstable_scheduleCallback,Xw=La.unstable_cancelCallback,sW=La.unstable_shouldYield,nI=La.unstable_requestPaint,Yw=La.unstable_now,uW=La.unstable_getCurrentPriorityLevel,j2=La.unstable_ImmediatePriority,zL=La.unstable_UserBlockingPriority,VL=La.unstable_NormalPriority,HL=La.unstable_LowPriority,GL=La.unstable_IdlePriority,Kx={},lW=nI!==void 0?nI:function(){},nl=null,_1=null,Qx=!1,aI=Yw(),oi=1e4>aI?Yw:function(){return Yw()-aI};function jv(){switch(uW()){case j2:return 99;case zL:return 98;case VL:return 97;case HL:return 96;case GL:return 95;default:throw Error(Ct(332))}}function qL(e){switch(e){case 99:return j2;case 98:return zL;case 97:return VL;case 96:return HL;case 95:return GL;default:throw Error(Ct(332))}}function zf(e,t){return e=qL(e),oW(e,t)}function O0(e,t,r){return e=qL(e),pT(e,t,r)}function Lu(){if(_1!==null){var e=_1;_1=null,Xw(e)}jL()}function jL(){if(!Qx&&nl!==null){Qx=!0;var e=0;try{var t=nl;zf(99,function(){for(;e<t.length;e++){var r=t[e];do r=r(!0);while(r!==null)}}),nl=null}catch(r){throw nl!==null&&(nl=nl.slice(e+1)),pT(j2,Lu),r}finally{Qx=!1}}}var cW=sp.ReactCurrentBatchConfig;function _s(e,t){if(e&&e.defaultProps){t=Ln({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var tb=Bd(null),rb=null,hv=null,nb=null;function vT(){nb=hv=rb=null}function mT(e){var t=tb.current;An(tb),e.type._context._currentValue=t}function WL(e,t){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)===t){if(r===null||(r.childLanes&t)===t)break;r.childLanes|=t}else e.childLanes|=t,r!==null&&(r.childLanes|=t);e=e.return}}function Iv(e,t){rb=e,nb=hv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Os=!0),e.firstContext=null)}function ts(e,t){if(nb!==e&&t!==!1&&t!==0)if((typeof t!="number"||t===1073741823)&&(nb=e,t=1073741823),t={context:e,observedBits:t,next:null},hv===null){if(rb===null)throw Error(Ct(308));hv=t,rb.dependencies={lanes:0,firstContext:t,responders:null}}else hv=hv.next=t;return e._currentValue}var Ec=!1;function hT(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function XL(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function rd(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function nd(e,t){if(e=e.updateQueue,e!==null){e=e.shared;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function iI(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function B0(e,t,r,n){var a=e.updateQueue;Ec=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?i=l:o.next=l,o=u;var c=e.alternate;if(c!==null){c=c.updateQueue;var d=c.lastBaseUpdate;d!==o&&(d===null?c.firstBaseUpdate=l:d.next=l,c.lastBaseUpdate=u)}}if(i!==null){d=a.baseState,o=0,c=l=u=null;do{s=i.lane;var f=i.eventTime;if((n&s)===s){c!==null&&(c=c.next={eventTime:f,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var p=e,v=i;switch(s=t,f=r,v.tag){case 1:if(p=v.payload,typeof p=="function"){d=p.call(f,d,s);break e}d=p;break e;case 3:p.flags=p.flags&-4097|64;case 0:if(p=v.payload,s=typeof p=="function"?p.call(f,d,s):p,s==null)break e;d=Ln({},d,s);break e;case 2:Ec=!0}}i.callback!==null&&(e.flags|=32,s=a.effects,s===null?a.effects=[i]:s.push(i))}else f={eventTime:f,lane:s,tag:i.tag,payload:i.payload,callback:i.callback,next:null},c===null?(l=c=f,u=d):c=c.next=f,o|=s;if(i=i.next,i===null){if(s=a.shared.pending,s===null)break;i=s.next,s.next=null,a.lastBaseUpdate=s,a.shared.pending=null}}while(1);c===null&&(u=d),a.baseState=u,a.firstBaseUpdate=l,a.lastBaseUpdate=c,hg|=o,e.lanes=o,e.memoizedState=d}}function oI(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Ct(191,a));a.call(n)}}}var YL=new L2.Component().refs;function ab(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Ln({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var W2={isMounted:function(e){return(e=e._reactInternals)?up(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=vo(),a=ad(e),i=rd(n,a);i.payload=t,r!=null&&(i.callback=r),nd(e,i),id(e,a,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=vo(),a=ad(e),i=rd(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),nd(e,i),id(e,a,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=vo(),n=ad(e),a=rd(r,n);a.tag=2,t!=null&&(a.callback=t),nd(e,a),id(e,n,r)}};function sI(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!M0(r,n)||!M0(a,i):!0}function KL(e,t,r){var n=!1,a=hd,i=t.contextType;return typeof i=="object"&&i!==null?i=ts(i):(a=Xi(t)?Uf:pi.current,n=t.contextTypes,i=(n=n!=null)?qv(e,a):hd),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=W2,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function uI(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&W2.enqueueReplaceState(t,t.state,null)}function Kw(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs=YL,hT(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=ts(i):(i=Xi(t)?Uf:pi.current,a.context=qv(e,i)),B0(e,r,a,n),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(ab(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&W2.enqueueReplaceState(a,a.state,null),B0(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4)}var ey=Array.isArray;function Jm(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ct(309));var n=r.stateNode}if(!n)throw Error(Ct(147,e));var a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var o=n.refs;o===YL&&(o=n.refs={}),i===null?delete o[a]:o[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(Ct(284));if(!r._owner)throw Error(Ct(290,e))}return e}function ty(e,t){if(e.type!=="textarea")throw Error(Ct(31,Object.prototype.toString.call(t)==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function QL(e){function t(h,g){if(e){var y=h.lastEffect;y!==null?(y.nextEffect=g,h.lastEffect=g):h.firstEffect=h.lastEffect=g,g.nextEffect=null,g.flags=8}}function r(h,g){if(!e)return null;for(;g!==null;)t(h,g),g=g.sibling;return null}function n(h,g){for(h=new Map;g!==null;)g.key!==null?h.set(g.key,g):h.set(g.index,g),g=g.sibling;return h}function a(h,g){return h=yd(h,g),h.index=0,h.sibling=null,h}function i(h,g,y){return h.index=y,e?(y=h.alternate,y!==null?(y=y.index,y<g?(h.flags=2,g):y):(h.flags=2,g)):g}function o(h){return e&&h.alternate===null&&(h.flags=2),h}function s(h,g,y,b){return g===null||g.tag!==6?(g=tC(y,h.mode,b),g.return=h,g):(g=a(g,y),g.return=h,g)}function u(h,g,y,b){return g!==null&&g.elementType===y.type?(b=a(g,y.props),b.ref=Jm(h,g,y),b.return=h,b):(b=E1(y.type,y.key,y.props,null,h.mode,b),b.ref=Jm(h,g,y),b.return=h,b)}function l(h,g,y,b){return g===null||g.tag!==4||g.stateNode.containerInfo!==y.containerInfo||g.stateNode.implementation!==y.implementation?(g=rC(y,h.mode,b),g.return=h,g):(g=a(g,y.children||[]),g.return=h,g)}function c(h,g,y,b,S){return g===null||g.tag!==7?(g=Ov(y,h.mode,b,S),g.return=h,g):(g=a(g,y),g.return=h,g)}function d(h,g,y){if(typeof g=="string"||typeof g=="number")return g=tC(""+g,h.mode,y),g.return=h,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Mh:return y=E1(g.type,g.key,g.props,null,h.mode,y),y.ref=Jm(h,null,g),y.return=h,y;case hf:return g=rC(g,h.mode,y),g.return=h,g}if(ey(g)||Xm(g))return g=Ov(g,h.mode,y,null),g.return=h,g;ty(h,g)}return null}function f(h,g,y,b){var S=g!==null?g.key:null;if(typeof y=="string"||typeof y=="number")return S!==null?null:s(h,g,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Mh:return y.key===S?y.type===Rc?c(h,g,y.props.children,b,S):u(h,g,y,b):null;case hf:return y.key===S?l(h,g,y,b):null}if(ey(y)||Xm(y))return S!==null?null:c(h,g,y,b,null);ty(h,y)}return null}function p(h,g,y,b,S){if(typeof b=="string"||typeof b=="number")return h=h.get(y)||null,s(g,h,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Mh:return h=h.get(b.key===null?y:b.key)||null,b.type===Rc?c(g,h,b.props.children,S,b.key):u(g,h,b,S);case hf:return h=h.get(b.key===null?y:b.key)||null,l(g,h,b,S)}if(ey(b)||Xm(b))return h=h.get(y)||null,c(g,h,b,S,null);ty(g,b)}return null}function v(h,g,y,b){for(var S=null,C=null,x=g,A=g=0,P=null;x!==null&&A<y.length;A++){x.index>A?(P=x,x=null):P=x.sibling;var T=f(h,x,y[A],b);if(T===null){x===null&&(x=P);break}e&&x&&T.alternate===null&&t(h,x),g=i(T,g,A),C===null?S=T:C.sibling=T,C=T,x=P}if(A===y.length)return r(h,x),S;if(x===null){for(;A<y.length;A++)x=d(h,y[A],b),x!==null&&(g=i(x,g,A),C===null?S=x:C.sibling=x,C=x);return S}for(x=n(h,x);A<y.length;A++)P=p(x,h,A,y[A],b),P!==null&&(e&&P.alternate!==null&&x.delete(P.key===null?A:P.key),g=i(P,g,A),C===null?S=P:C.sibling=P,C=P);return e&&x.forEach(function(D){return t(h,D)}),S}function m(h,g,y,b){var S=Xm(y);if(typeof S!="function")throw Error(Ct(150));if(y=S.call(y),y==null)throw Error(Ct(151));for(var C=S=null,x=g,A=g=0,P=null,T=y.next();x!==null&&!T.done;A++,T=y.next()){x.index>A?(P=x,x=null):P=x.sibling;var D=f(h,x,T.value,b);if(D===null){x===null&&(x=P);break}e&&x&&D.alternate===null&&t(h,x),g=i(D,g,A),C===null?S=D:C.sibling=D,C=D,x=P}if(T.done)return r(h,x),S;if(x===null){for(;!T.done;A++,T=y.next())T=d(h,T.value,b),T!==null&&(g=i(T,g,A),C===null?S=T:C.sibling=T,C=T);return S}for(x=n(h,x);!T.done;A++,T=y.next())T=p(x,h,A,T.value,b),T!==null&&(e&&T.alternate!==null&&x.delete(T.key===null?A:T.key),g=i(T,g,A),C===null?S=T:C.sibling=T,C=T);return e&&x.forEach(function(I){return t(h,I)}),S}return function(h,g,y,b){var S=typeof y=="object"&&y!==null&&y.type===Rc&&y.key===null;S&&(y=y.props.children);var C=typeof y=="object"&&y!==null;if(C)switch(y.$$typeof){case Mh:e:{for(C=y.key,S=g;S!==null;){if(S.key===C){switch(S.tag){case 7:if(y.type===Rc){r(h,S.sibling),g=a(S,y.props.children),g.return=h,h=g;break e}break;default:if(S.elementType===y.type){r(h,S.sibling),g=a(S,y.props),g.ref=Jm(h,S,y),g.return=h,h=g;break e}}r(h,S);break}else t(h,S);S=S.sibling}y.type===Rc?(g=Ov(y.props.children,h.mode,b,y.key),g.return=h,h=g):(b=E1(y.type,y.key,y.props,null,h.mode,b),b.ref=Jm(h,g,y),b.return=h,h=b)}return o(h);case hf:e:{for(S=y.key;g!==null;){if(g.key===S)if(g.tag===4&&g.stateNode.containerInfo===y.containerInfo&&g.stateNode.implementation===y.implementation){r(h,g.sibling),g=a(g,y.children||[]),g.return=h,h=g;break e}else{r(h,g);break}else t(h,g);g=g.sibling}g=rC(y,h.mode,b),g.return=h,h=g}return o(h)}if(typeof y=="string"||typeof y=="number")return y=""+y,g!==null&&g.tag===6?(r(h,g.sibling),g=a(g,y),g.return=h,h=g):(r(h,g),g=tC(y,h.mode,b),g.return=h,h=g),o(h);if(ey(y))return v(h,g,y,b);if(Xm(y))return m(h,g,y,b);if(C&&ty(h,y),typeof y=="undefined"&&!S)switch(h.tag){case 1:case 22:case 0:case 11:case 15:throw Error(Ct(152,_v(h.type)||"Component"))}return r(h,g)}}var ib=QL(!0),ZL=QL(!1),mg={},_u=Bd(mg),k0=Bd(mg),L0=Bd(mg);function bf(e){if(e===mg)throw Error(Ct(174));return e}function Qw(e,t){switch(jn(L0,t),jn(k0,e),jn(_u,mg),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Bw(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Bw(t,e)}An(_u),jn(_u,t)}function Wv(){An(_u),An(k0),An(L0)}function lI(e){bf(L0.current);var t=bf(_u.current),r=Bw(t,e.type);t!==r&&(jn(k0,e),jn(_u,r))}function gT(e){k0.current===e&&(An(_u),An(k0))}var Gn=Bd(0);function ob(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&64)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var cl=null,qc=null,Au=!1;function $L(e,t){var r=jo(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.flags=8,e.lastEffect!==null?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function cI(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,!0):!1;case 13:return!1;default:return!1}}function Zw(e){if(Au){var t=qc;if(t){var r=t;if(!cI(e,t)){if(t=Ev(r.nextSibling),!t||!cI(e,t)){e.flags=e.flags&-1025|2,Au=!1,cl=e;return}$L(cl,r)}cl=e,qc=Ev(t.firstChild)}else e.flags=e.flags&-1025|2,Au=!1,cl=e}}function dI(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;cl=e}function ry(e){if(e!==cl)return!1;if(!Au)return dI(e),Au=!0,!1;var t=e.type;if(e.tag!==5||t!=="head"&&t!=="body"&&!jw(t,e.memoizedProps))for(t=qc;t;)$L(e,t),t=Ev(t.nextSibling);if(dI(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ct(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){qc=Ev(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}qc=null}}else qc=cl?Ev(e.stateNode.nextSibling):null;return!0}function Zx(){qc=cl=null,Au=!1}var Dv=[];function yT(){for(var e=0;e<Dv.length;e++)Dv[e]._workInProgressVersionPrimary=null;Dv.length=0}var r0=sp.ReactCurrentDispatcher,$o=sp.ReactCurrentBatchConfig,F0=0,$n=null,ri=null,Na=null,sb=!1,n0=!1;function ki(){throw Error(Ct(321))}function bT(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!qo(e[r],t[r]))return!1;return!0}function ST(e,t,r,n,a,i){if(F0=i,$n=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,r0.current=e===null||e.memoizedState===null?fW:pW,e=r(n,a),n0){i=0;do{if(n0=!1,!(25>i))throw Error(Ct(301));i+=1,Na=ri=null,t.updateQueue=null,r0.current=vW,e=r(n,a)}while(n0)}if(r0.current=db,t=ri!==null&&ri.next!==null,F0=0,Na=ri=$n=null,sb=!1,t)throw Error(Ct(300));return e}function Sf(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Na===null?$n.memoizedState=Na=e:Na=Na.next=e,Na}function lp(){if(ri===null){var e=$n.alternate;e=e!==null?e.memoizedState:null}else e=ri.next;var t=Na===null?$n.memoizedState:Na.next;if(t!==null)Na=t,ri=e;else{if(e===null)throw Error(Ct(310));ri=e,e={memoizedState:ri.memoizedState,baseState:ri.baseState,baseQueue:ri.baseQueue,queue:ri.queue,next:null},Na===null?$n.memoizedState=Na=e:Na=Na.next=e}return Na}function bu(e,t){return typeof t=="function"?t(e):t}function eh(e){var t=lp(),r=t.queue;if(r===null)throw Error(Ct(311));r.lastRenderedReducer=e;var n=ri,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){a=a.next,n=n.baseState;var s=o=i=null,u=a;do{var l=u.lane;if((F0&l)===l)s!==null&&(s=s.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),n=u.eagerReducer===e?u.eagerState:e(n,u.action);else{var c={lane:l,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};s===null?(o=s=c,i=n):s=s.next=c,$n.lanes|=l,hg|=l}u=u.next}while(u!==null&&u!==a);s===null?i=n:s.next=o,qo(n,t.memoizedState)||(Os=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=s,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function th(e){var t=lp(),r=t.queue;if(r===null)throw Error(Ct(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);qo(i,t.memoizedState)||(Os=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function fI(e,t,r){var n=t._getVersion;n=n(t._source);var a=t._workInProgressVersionPrimary;if(a!==null?e=a===n:(e=e.mutableReadLanes,(e=(F0&e)===e)&&(t._workInProgressVersionPrimary=n,Dv.push(t))),e)return r(t._source);throw Dv.push(t),Error(Ct(350))}function JL(e,t,r,n){var a=Ti;if(a===null)throw Error(Ct(349));var i=t._getVersion,o=i(t._source),s=r0.current,u=s.useState(function(){return fI(a,t,r)}),l=u[1],c=u[0];u=Na;var d=e.memoizedState,f=d.refs,p=f.getSnapshot,v=d.source;d=d.subscribe;var m=$n;return e.memoizedState={refs:f,source:t,subscribe:n},s.useEffect(function(){f.getSnapshot=r,f.setSnapshot=l;var h=i(t._source);if(!qo(o,h)){h=r(t._source),qo(c,h)||(l(h),h=ad(m),a.mutableReadLanes|=h&a.pendingLanes),h=a.mutableReadLanes,a.entangledLanes|=h;for(var g=a.entanglements,y=h;0<y;){var b=31-md(y),S=1<<b;g[b]|=h,y&=~S}}},[r,t,n]),s.useEffect(function(){return n(t._source,function(){var h=f.getSnapshot,g=f.setSnapshot;try{g(h(t._source));var y=ad(m);a.mutableReadLanes|=y&a.pendingLanes}catch(b){g(function(){throw b})}})},[t,n]),qo(p,r)&&qo(v,t)&&qo(d,n)||(e={pending:null,dispatch:null,lastRenderedReducer:bu,lastRenderedState:c},e.dispatch=l=wT.bind(null,$n,e),u.queue=e,u.baseQueue=null,c=fI(a,t,r),u.memoizedState=u.baseState=c),c}function eF(e,t,r){var n=lp();return JL(n,e,t,r)}function rh(e){var t=Sf();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e=t.queue={pending:null,dispatch:null,lastRenderedReducer:bu,lastRenderedState:e},e=e.dispatch=wT.bind(null,$n,e),[t.memoizedState,e]}function ub(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=$n.updateQueue,t===null?(t={lastEffect:null},$n.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function pI(e){var t=Sf();return e={current:e},t.memoizedState=e}function lb(){return lp().memoizedState}function $w(e,t,r,n){var a=Sf();$n.flags|=e,a.memoizedState=ub(1|t,r,void 0,n===void 0?null:n)}function xT(e,t,r,n){var a=lp();n=n===void 0?null:n;var i=void 0;if(ri!==null){var o=ri.memoizedState;if(i=o.destroy,n!==null&&bT(n,o.deps)){ub(t,r,i,n);return}}$n.flags|=e,a.memoizedState=ub(1|t,r,i,n)}function vI(e,t){return $w(516,4,e,t)}function cb(e,t){return xT(516,4,e,t)}function tF(e,t){return xT(4,2,e,t)}function rF(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function nF(e,t,r){return r=r!=null?r.concat([e]):null,xT(4,2,rF.bind(null,t,e),r)}function CT(){}function aF(e,t){var r=lp();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&bT(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function iF(e,t){var r=lp();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&bT(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function dW(e,t){var r=jv();zf(98>r?98:r,function(){e(!0)}),zf(97<r?97:r,function(){var n=$o.transition;$o.transition=1;try{e(!1),t()}finally{$o.transition=n}})}function wT(e,t,r){var n=vo(),a=ad(e),i={lane:a,action:r,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===$n||o!==null&&o===$n)n0=sb=!0;else{if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,u=o(s,r);if(i.eagerReducer=o,i.eagerState=u,qo(u,s))return}catch{}finally{}id(e,a,n)}}var db={readContext:ts,useCallback:ki,useContext:ki,useEffect:ki,useImperativeHandle:ki,useLayoutEffect:ki,useMemo:ki,useReducer:ki,useRef:ki,useState:ki,useDebugValue:ki,useDeferredValue:ki,useTransition:ki,useMutableSource:ki,useOpaqueIdentifier:ki,unstable_isNewReconciler:!1},fW={readContext:ts,useCallback:function(e,t){return Sf().memoizedState=[e,t===void 0?null:t],e},useContext:ts,useEffect:vI,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,$w(4,2,rF.bind(null,t,e),r)},useLayoutEffect:function(e,t){return $w(4,2,e,t)},useMemo:function(e,t){var r=Sf();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Sf();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=wT.bind(null,$n,e),[n.memoizedState,e]},useRef:pI,useState:rh,useDebugValue:CT,useDeferredValue:function(e){var t=rh(e),r=t[0],n=t[1];return vI(function(){var a=$o.transition;$o.transition=1;try{n(e)}finally{$o.transition=a}},[e]),r},useTransition:function(){var e=rh(!1),t=e[0];return e=dW.bind(null,e[1]),pI(e),[e,t]},useMutableSource:function(e,t,r){var n=Sf();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:r},JL(n,e,t,r)},useOpaqueIdentifier:function(){if(Au){var e=!1,t=iW(function(){throw e||(e=!0,r("r:"+(Yx++).toString(36))),Error(Ct(355))}),r=rh(t)[1];return($n.mode&2)===0&&($n.flags|=516,ub(5,function(){r("r:"+(Yx++).toString(36))},void 0,null)),t}return t="r:"+(Yx++).toString(36),rh(t),t},unstable_isNewReconciler:!1},pW={readContext:ts,useCallback:aF,useContext:ts,useEffect:cb,useImperativeHandle:nF,useLayoutEffect:tF,useMemo:iF,useReducer:eh,useRef:lb,useState:function(){return eh(bu)},useDebugValue:CT,useDeferredValue:function(e){var t=eh(bu),r=t[0],n=t[1];return cb(function(){var a=$o.transition;$o.transition=1;try{n(e)}finally{$o.transition=a}},[e]),r},useTransition:function(){var e=eh(bu)[0];return[lb().current,e]},useMutableSource:eF,useOpaqueIdentifier:function(){return eh(bu)[0]},unstable_isNewReconciler:!1},vW={readContext:ts,useCallback:aF,useContext:ts,useEffect:cb,useImperativeHandle:nF,useLayoutEffect:tF,useMemo:iF,useReducer:th,useRef:lb,useState:function(){return th(bu)},useDebugValue:CT,useDeferredValue:function(e){var t=th(bu),r=t[0],n=t[1];return cb(function(){var a=$o.transition;$o.transition=1;try{n(e)}finally{$o.transition=a}},[e]),r},useTransition:function(){var e=th(bu)[0];return[lb().current,e]},useMutableSource:eF,useOpaqueIdentifier:function(){return th(bu)[0]},unstable_isNewReconciler:!1},mW=sp.ReactCurrentOwner,Os=!1;function Gi(e,t,r,n){t.child=e===null?ZL(t,null,r,n):ib(t,e.child,r,n)}function mI(e,t,r,n,a){r=r.render;var i=t.ref;return Iv(t,a),n=ST(e,t,r,n,i,a),e!==null&&!Os?(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,dl(e,t,a)):(t.flags|=1,Gi(e,t,n,a),t.child)}function hI(e,t,r,n,a,i){if(e===null){var o=r.type;return typeof o=="function"&&!IT(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,oF(e,t,o,n,a,i)):(e=E1(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}return o=e.child,(a&i)===0&&(a=o.memoizedProps,r=r.compare,r=r!==null?r:M0,r(a,n)&&e.ref===t.ref)?dl(e,t,i):(t.flags|=1,e=yd(o,n),e.ref=t.ref,e.return=t,t.child=e)}function oF(e,t,r,n,a,i){if(e!==null&&M0(e.memoizedProps,n)&&e.ref===t.ref)if(Os=!1,(i&a)!==0)(e.flags&16384)!==0&&(Os=!0);else return t.lanes=e.lanes,dl(e,t,i);return Jw(e,t,r,n,i)}function $x(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden"||n.mode==="unstable-defer-without-hiding")if((t.mode&4)===0)t.memoizedState={baseLanes:0},ay(t,r);else if((r&1073741824)!==0)t.memoizedState={baseLanes:0},ay(t,i!==null?i.baseLanes:r);else return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},ay(t,e),null;else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,ay(t,n);return Gi(e,t,a,r),t.child}function sF(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=128)}function Jw(e,t,r,n,a){var i=Xi(r)?Uf:pi.current;return i=qv(t,i),Iv(t,a),r=ST(e,t,r,n,i,a),e!==null&&!Os?(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,dl(e,t,a)):(t.flags|=1,Gi(e,t,r,a),t.child)}function gI(e,t,r,n,a){if(Xi(r)){var i=!0;w1(t)}else i=!1;if(Iv(t,a),t.stateNode===null)e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),KL(t,r,n),Kw(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=ts(l):(l=Xi(r)?Uf:pi.current,l=qv(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&uI(t,o,n,l),Ec=!1;var f=t.memoizedState;o.state=f,B0(t,n,o,a),u=t.memoizedState,s!==n||f!==u||Wi.current||Ec?(typeof c=="function"&&(ab(t,r,c,n),u=t.memoizedState),(s=Ec||sI(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4)):(typeof o.componentDidMount=="function"&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4),n=!1)}else{o=t.stateNode,XL(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:_s(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=ts(u):(u=Xi(r)?Uf:pi.current,u=qv(t,u));var p=r.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&uI(t,o,n,u),Ec=!1,f=t.memoizedState,o.state=f,B0(t,n,o,a);var v=t.memoizedState;s!==d||f!==v||Wi.current||Ec?(typeof p=="function"&&(ab(t,r,p,n),v=t.memoizedState),(l=Ec||sI(t,r,l,n,f,v,u))?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=256)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=v),o.props=n,o.state=v,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),n=!1)}return e_(e,t,r,n,i,a)}function e_(e,t,r,n,a,i){sF(e,t);var o=(t.flags&64)!==0;if(!n&&!o)return a&&rI(t,r,!1),dl(e,t,i);n=t.stateNode,mW.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=ib(t,e.child,null,i),t.child=ib(t,null,s,i)):Gi(e,t,s,i),t.memoizedState=n.state,a&&rI(t,r,!0),t.child}function yI(e){var t=e.stateNode;t.pendingContext?tI(e,t.pendingContext,t.pendingContext!==t.context):t.context&&tI(e,t.context,!1),Qw(e,t.containerInfo)}var ny={dehydrated:null,retryLane:0};function bI(e,t,r){var n=t.pendingProps,a=Gn.current,i=!1,o;return(o=(t.flags&64)!==0)||(o=e!==null&&e.memoizedState===null?!1:(a&2)!==0),o?(i=!0,t.flags&=-65):e!==null&&e.memoizedState===null||n.fallback===void 0||n.unstable_avoidThisFallback===!0||(a|=1),jn(Gn,a&1),e===null?(n.fallback!==void 0&&Zw(t),e=n.children,a=n.fallback,i?(e=SI(t,e,a,r),t.child.memoizedState={baseLanes:r},t.memoizedState=ny,e):typeof n.unstable_expectedLoadTime=="number"?(e=SI(t,e,a,r),t.child.memoizedState={baseLanes:r},t.memoizedState=ny,t.lanes=33554432,e):(r=DT({mode:"visible",children:e},t.mode,r,null),r.return=t,t.child=r)):e.memoizedState!==null?i?(n=CI(e,t,n.children,n.fallback,r),i=t.child,a=e.child.memoizedState,i.memoizedState=a===null?{baseLanes:r}:{baseLanes:a.baseLanes|r},i.childLanes=e.childLanes&~r,t.memoizedState=ny,n):(r=xI(e,t,n.children,r),t.memoizedState=null,r):i?(n=CI(e,t,n.children,n.fallback,r),i=t.child,a=e.child.memoizedState,i.memoizedState=a===null?{baseLanes:r}:{baseLanes:a.baseLanes|r},i.childLanes=e.childLanes&~r,t.memoizedState=ny,n):(r=xI(e,t,n.children,r),t.memoizedState=null,r)}function SI(e,t,r,n){var a=e.mode,i=e.child;return t={mode:"hidden",children:t},(a&2)===0&&i!==null?(i.childLanes=0,i.pendingProps=t):i=DT(t,a,0,null),r=Ov(r,a,n,null),i.return=e,r.return=e,i.sibling=r,e.child=i,r}function xI(e,t,r,n){var a=e.child;return e=a.sibling,r=yd(a,{mode:"visible",children:r}),(t.mode&2)===0&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=r}function CI(e,t,r,n,a){var i=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:r};return(i&2)===0&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=s,o=r.lastEffect,o!==null?(t.firstEffect=r.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):r=yd(o,s),e!==null?n=yd(e,n):(n=Ov(n,i,a,null),n.flags|=2),n.return=t,r.return=t,r.sibling=n,t.child=r,n}function wI(e,t){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),WL(e.return,t)}function Jx(e,t,r,n,a,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=a,o.lastEffect=i)}function _I(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(Gi(e,t,n.children,r),n=Gn.current,(n&2)!==0)n=n&1|2,t.flags|=64;else{if(e!==null&&(e.flags&64)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&wI(e,r);else if(e.tag===19)wI(e,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(jn(Gn,n),(t.mode&2)===0)t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&ob(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),Jx(t,!1,a,r,i,t.lastEffect);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&ob(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}Jx(t,!0,r,null,i,t.lastEffect);break;case"together":Jx(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function dl(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),hg|=t.lanes,(r&t.childLanes)!==0){if(e!==null&&t.child!==e.child)throw Error(Ct(153));if(t.child!==null){for(e=t.child,r=yd(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=yd(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}return null}var uF,t_,lF,cF;uF=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};t_=function(){};lF=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,bf(_u.current);var i=null;switch(r){case"input":a=Ew(e,a),n=Ew(e,n),i=[];break;case"option":a=Mw(e,a),n=Mw(e,n),i=[];break;case"select":a=Ln({},a,{value:void 0}),n=Ln({},n,{value:void 0}),i=[];break;case"textarea":a=Rw(e,a),n=Rw(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=$1)}kw(r,n);var o;r=null;for(l in a)if(!n.hasOwnProperty(l)&&a.hasOwnProperty(l)&&a[l]!=null)if(l==="style"){var s=a[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(_0.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in n){var u=n[l];if(s=a!=null?a[l]:void 0,n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(i||(i=[]),i.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(_0.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Sn("scroll",e),i||s===u||(i=[])):typeof u=="object"&&u!==null&&u.$$typeof===QA?u.toString():(i=i||[]).push(l,u))}r&&(i=i||[]).push("style",r);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};cF=function(e,t,r,n){r!==n&&(t.flags|=4)};function nh(e,t){if(!Au)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function hW(e,t,r){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Xi(t.type)&&eb(),null;case 3:return Wv(),An(Wi),An(pi),yT(),n=t.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(ry(t)?t.flags|=4:n.hydrate||(t.flags|=256)),t_(t),null;case 5:gT(t);var a=bf(L0.current);if(r=t.type,e!==null&&t.stateNode!=null)lF(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(t.stateNode===null)throw Error(Ct(166));return null}if(e=bf(_u.current),ry(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Gc]=t,n[J1]=i,r){case"dialog":Sn("cancel",n),Sn("close",n);break;case"iframe":case"object":case"embed":Sn("load",n);break;case"video":case"audio":for(e=0;e<Oh.length;e++)Sn(Oh[e],n);break;case"source":Sn("error",n);break;case"img":case"image":case"link":Sn("error",n),Sn("load",n);break;case"details":Sn("toggle",n);break;case"input":_5(n,i),Sn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Sn("invalid",n);break;case"textarea":T5(n,i),Sn("invalid",n)}kw(r,i),e=null;for(var o in i)i.hasOwnProperty(o)&&(a=i[o],o==="children"?typeof a=="string"?n.textContent!==a&&(e=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(e=["children",""+a]):_0.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Sn("scroll",n));switch(r){case"input":Qg(n),A5(n,i,!0);break;case"textarea":Qg(n),P5(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=$1)}n=e,t.updateQueue=n,n!==null&&(t.flags|=4)}else{switch(o=a.nodeType===9?a:a.ownerDocument,e===Ow.html&&(e=nL(r)),e===Ow.html?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Gc]=t,e[J1]=n,uF(e,t,!1,!1),t.stateNode=e,o=Lw(r,n),r){case"dialog":Sn("cancel",e),Sn("close",e),a=n;break;case"iframe":case"object":case"embed":Sn("load",e),a=n;break;case"video":case"audio":for(a=0;a<Oh.length;a++)Sn(Oh[a],e);a=n;break;case"source":Sn("error",e),a=n;break;case"img":case"image":case"link":Sn("error",e),Sn("load",e),a=n;break;case"details":Sn("toggle",e),a=n;break;case"input":_5(e,n),a=Ew(e,n),Sn("invalid",e);break;case"option":a=Mw(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=Ln({},n,{value:void 0}),Sn("invalid",e);break;case"textarea":T5(e,n),a=Rw(e,n),Sn("invalid",e);break;default:a=n}kw(r,a);var s=a;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?oL(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&aL(e,u)):i==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&A0(e,u):typeof u=="number"&&A0(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(_0.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Sn("scroll",e):u!=null&&qA(e,i,u,o))}switch(r){case"input":Qg(e),A5(e,n,!1);break;case"textarea":Qg(e),P5(e);break;case"option":n.value!=null&&e.setAttribute("value",""+vd(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Av(e,!!n.multiple,i,!1):n.defaultValue!=null&&Av(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=$1)}FL(r,n)&&(t.flags|=4)}t.ref!==null&&(t.flags|=128)}return null;case 6:if(e&&t.stateNode!=null)cF(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Ct(166));r=bf(L0.current),bf(_u.current),ry(t)?(n=t.stateNode,r=t.memoizedProps,n[Gc]=t,n.nodeValue!==r&&(t.flags|=4)):(n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Gc]=t,t.stateNode=n)}return null;case 13:return An(Gn),n=t.memoizedState,(t.flags&64)!==0?(t.lanes=r,t):(n=n!==null,r=!1,e===null?t.memoizedProps.fallback!==void 0&&ry(t):r=e.memoizedState!==null,n&&!r&&(t.mode&2)!==0&&(e===null&&t.memoizedProps.unstable_avoidThisFallback!==!0||(Gn.current&1)!==0?Va===0&&(Va=3):((Va===0||Va===3)&&(Va=4),Ti===null||(hg&134217727)===0&&(bm&134217727)===0||Mv(Ti,li))),(n||r)&&(t.flags|=4),null);case 4:return Wv(),t_(t),e===null&&BL(t.stateNode.containerInfo),null;case 10:return mT(t),null;case 17:return Xi(t.type)&&eb(),null;case 19:if(An(Gn),n=t.memoizedState,n===null)return null;if(i=(t.flags&64)!==0,o=n.rendering,o===null)if(i)nh(n,!1);else{if(Va!==0||e!==null&&(e.flags&64)!==0)for(e=t.child;e!==null;){if(o=ob(e),o!==null){for(t.flags|=64,nh(n,!1),i=o.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),n.lastEffect===null&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return jn(Gn,Gn.current&1|2),t.child}e=e.sibling}n.tail!==null&&oi()>s_&&(t.flags|=64,i=!0,nh(n,!1),t.lanes=33554432)}else{if(!i)if(e=ob(o),e!==null){if(t.flags|=64,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),nh(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!Au)return t=t.lastEffect=n.lastEffect,t!==null&&(t.nextEffect=null),null}else 2*oi()-n.renderingStartTime>s_&&r!==1073741824&&(t.flags|=64,i=!0,nh(n,!1),t.lanes=33554432);n.isBackwards?(o.sibling=t.child,t.child=o):(r=n.last,r!==null?r.sibling=o:t.child=o,n.last=o)}return n.tail!==null?(r=n.tail,n.rendering=r,n.tail=r.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=oi(),r.sibling=null,t=Gn.current,jn(Gn,i?t&1|2:t&1),r):null;case 23:case 24:return ET(),e!==null&&e.memoizedState!==null!=(t.memoizedState!==null)&&n.mode!=="unstable-defer-without-hiding"&&(t.flags|=4),null}throw Error(Ct(156,t.tag))}function gW(e){switch(e.tag){case 1:Xi(e.type)&&eb();var t=e.flags;return t&4096?(e.flags=t&-4097|64,e):null;case 3:if(Wv(),An(Wi),An(pi),yT(),t=e.flags,(t&64)!==0)throw Error(Ct(285));return e.flags=t&-4097|64,e;case 5:return gT(e),null;case 13:return An(Gn),t=e.flags,t&4096?(e.flags=t&-4097|64,e):null;case 19:return An(Gn),null;case 4:return Wv(),null;case 10:return mT(e),null;case 23:case 24:return ET(),null;default:return null}}function _T(e,t){try{var r="",n=t;do r+=Zq(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a}}function r_(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var yW=typeof WeakMap=="function"?WeakMap:Map;function dF(e,t,r){r=rd(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){pb||(pb=!0,u_=n),r_(e,t)},r}function fF(e,t,r){r=rd(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return r_(e,t),n(a)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){typeof n!="function"&&(Su===null?Su=new Set([this]):Su.add(this),r_(e,t));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}var bW=typeof WeakSet=="function"?WeakSet:Set;function AI(e){var t=e.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){od(e,r)}else t.current=null}function SW(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(t.flags&256&&e!==null){var r=e.memoizedProps,n=e.memoizedState;e=t.stateNode,t=e.getSnapshotBeforeUpdate(t.elementType===t.type?r:_s(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:t.flags&256&&dT(t.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(Ct(163))}function xW(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:if(t=r.updateQueue,t=t!==null?t.lastEffect:null,t!==null){e=t=t.next;do{if((e.tag&3)===3){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(t=r.updateQueue,t=t!==null?t.lastEffect:null,t!==null){e=t=t.next;do{var a=e;n=a.next,a=a.tag,(a&4)!==0&&(a&1)!==0&&(xF(r,e),IW(r,e)),e=n}while(e!==t)}return;case 1:e=r.stateNode,r.flags&4&&(t===null?e.componentDidMount():(n=r.elementType===r.type?t.memoizedProps:_s(r.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),t=r.updateQueue,t!==null&&oI(r,t,e);return;case 3:if(t=r.updateQueue,t!==null){if(e=null,r.child!==null)switch(r.child.tag){case 5:e=r.child.stateNode;break;case 1:e=r.child.stateNode}oI(r,t,e)}return;case 5:e=r.stateNode,t===null&&r.flags&4&&FL(r.type,r.memoizedProps)&&e.focus();return;case 6:return;case 4:return;case 12:return;case 13:r.memoizedState===null&&(r=r.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&hL(r))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(Ct(163))}function TI(e,t){for(var r=e;;){if(r.tag===5){var n=r.stateNode;if(t)n=n.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none";else{n=r.stateNode;var a=r.memoizedProps.style;a=a!=null&&a.hasOwnProperty("display")?a.display:null,n.style.display=iL("display",a)}}else if(r.tag===6)r.stateNode.nodeValue=t?"":r.memoizedProps;else if((r.tag!==23&&r.tag!==24||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function PI(e,t){if(Pf&&typeof Pf.onCommitFiberUnmount=="function")try{Pf.onCommitFiberUnmount(fT,t)}catch{}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(e=t.updateQueue,e!==null&&(e=e.lastEffect,e!==null)){var r=e=e.next;do{var n=r,a=n.destroy;if(n=n.tag,a!==void 0)if((n&4)!==0)xF(t,r);else{n=t;try{a()}catch(i){od(n,i)}}r=r.next}while(r!==e)}break;case 1:if(AI(t),e=t.stateNode,typeof e.componentWillUnmount=="function")try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(i){od(t,i)}break;case 5:AI(t);break;case 4:pF(e,t)}}function EI(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function II(e){return e.tag===5||e.tag===3||e.tag===4}function DI(e){e:{for(var t=e.return;t!==null;){if(II(t))break e;t=t.return}throw Error(Ct(160))}var r=t;switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:t=t.containerInfo,n=!0;break;case 4:t=t.containerInfo,n=!0;break;default:throw Error(Ct(161))}r.flags&16&&(A0(t,""),r.flags&=-17);e:t:for(r=e;;){for(;r.sibling===null;){if(r.return===null||II(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue t;r.child.return=r,r=r.child}if(!(r.flags&2)){r=r.stateNode;break e}}n?n_(e,r,t):a_(e,r,t)}function n_(e,t,r){var n=e.tag,a=n===5||n===6;if(a)e=a?e.stateNode:e.stateNode.instance,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=$1));else if(n!==4&&(e=e.child,e!==null))for(n_(e,t,r),e=e.sibling;e!==null;)n_(e,t,r),e=e.sibling}function a_(e,t,r){var n=e.tag,a=n===5||n===6;if(a)e=a?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(a_(e,t,r),e=e.sibling;e!==null;)a_(e,t,r),e=e.sibling}function pF(e,t){for(var r=t,n=!1,a,i;;){if(!n){n=r.return;e:for(;;){if(n===null)throw Error(Ct(160));switch(a=n.stateNode,n.tag){case 5:i=!1;break e;case 3:a=a.containerInfo,i=!0;break e;case 4:a=a.containerInfo,i=!0;break e}n=n.return}n=!0}if(r.tag===5||r.tag===6){e:for(var o=e,s=r,u=s;;)if(PI(o,u),u.child!==null&&u.tag!==4)u.child.return=u,u=u.child;else{if(u===s)break e;for(;u.sibling===null;){if(u.return===null||u.return===s)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}i?(o=a,s=r.stateNode,o.nodeType===8?o.parentNode.removeChild(s):o.removeChild(s)):a.removeChild(r.stateNode)}else if(r.tag===4){if(r.child!==null){a=r.stateNode.containerInfo,i=!0,r.child.return=r,r=r.child;continue}}else if(PI(e,r),r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return,r.tag===4&&(n=!1)}r.sibling.return=r.return,r=r.sibling}}function eC(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do(n.tag&3)===3&&(e=n.destroy,n.destroy=void 0,e!==void 0&&e()),n=n.next;while(n!==r)}return;case 1:return;case 5:if(r=t.stateNode,r!=null){n=t.memoizedProps;var a=e!==null?e.memoizedProps:n;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,i!==null){for(r[J1]=n,e==="input"&&n.type==="radio"&&n.name!=null&&tL(r,n),Lw(e,a),t=Lw(e,n),a=0;a<i.length;a+=2){var o=i[a],s=i[a+1];o==="style"?oL(r,s):o==="dangerouslySetInnerHTML"?aL(r,s):o==="children"?A0(r,s):qA(r,o,s,t)}switch(e){case"input":Iw(r,n);break;case"textarea":rL(r,n);break;case"select":e=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,i=n.value,i!=null?Av(r,!!n.multiple,i,!1):e!==!!n.multiple&&(n.defaultValue!=null?Av(r,!!n.multiple,n.defaultValue,!0):Av(r,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(t.stateNode===null)throw Error(Ct(162));t.stateNode.nodeValue=t.memoizedProps;return;case 3:r=t.stateNode,r.hydrate&&(r.hydrate=!1,hL(r.containerInfo));return;case 12:return;case 13:t.memoizedState!==null&&(PT=oi(),TI(t.child,!0)),MI(t);return;case 19:MI(t);return;case 17:return;case 23:case 24:TI(t,t.memoizedState!==null);return}throw Error(Ct(163))}function MI(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new bW),t.forEach(function(n){var a=RW.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function CW(e,t){return e!==null&&(e=e.memoizedState,e===null||e.dehydrated!==null)?(t=t.memoizedState,t!==null&&t.dehydrated===null):!1}var wW=Math.ceil,fb=sp.ReactCurrentDispatcher,AT=sp.ReactCurrentOwner,lr=0,Ti=null,ya=null,li=0,Vf=0,i_=Bd(0),Va=0,X2=null,ym=0,hg=0,bm=0,TT=0,o_=null,PT=0,s_=1/0;function Sm(){s_=oi()+500}var Ft=null,pb=!1,u_=null,Su=null,gd=!1,a0=null,Bh=90,l_=[],c_=[],yl=null,i0=0,d_=null,A1=-1,sl=0,T1=0,o0=null,P1=!1;function vo(){return(lr&48)!==0?oi():A1!==-1?A1:A1=oi()}function ad(e){if(e=e.mode,(e&2)===0)return 1;if((e&4)===0)return jv()===99?1:2;if(sl===0&&(sl=ym),cW.transition!==0){T1!==0&&(T1=o_!==null?o_.pendingLanes:0),e=sl;var t=4186112&~T1;return t&=-t,t===0&&(e=4186112&~e,t=e&-e,t===0&&(t=8192)),t}return e=jv(),(lr&4)!==0&&e===98?e=Q1(12,sl):(e=pj(e),e=Q1(e,sl)),e}function id(e,t,r){if(50<i0)throw i0=0,d_=null,Error(Ct(185));if(e=Y2(e,t),e===null)return null;z2(e,t,r),e===Ti&&(bm|=t,Va===4&&Mv(e,li));var n=jv();t===1?(lr&8)!==0&&(lr&48)===0?f_(e):(rs(e,r),lr===0&&(Sm(),Lu())):((lr&4)===0||n!==98&&n!==99||(yl===null?yl=new Set([e]):yl.add(e)),rs(e,r)),o_=e}function Y2(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}function rs(e,t){for(var r=e.callbackNode,n=e.suspendedLanes,a=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-md(o),u=1<<s,l=i[s];if(l===-1){if((u&n)===0||(u&a)!==0){l=t,sv(u);var c=mn;i[s]=10<=c?l+250:6<=c?l+5e3:-1}}else l<=t&&(e.expiredLanes|=u);o&=~u}if(n=I0(e,e===Ti?li:0),t=mn,n===0)r!==null&&(r!==Kx&&Xw(r),e.callbackNode=null,e.callbackPriority=0);else{if(r!==null){if(e.callbackPriority===t)return;r!==Kx&&Xw(r)}t===15?(r=f_.bind(null,e),nl===null?(nl=[r],_1=pT(j2,jL)):nl.push(r),r=Kx):t===14?r=O0(99,f_.bind(null,e)):(r=vj(t),r=O0(r,vF.bind(null,e))),e.callbackPriority=t,e.callbackNode=r}}function vF(e){if(A1=-1,T1=sl=0,(lr&48)!==0)throw Error(Ct(327));var t=e.callbackNode;if(kd()&&e.callbackNode!==t)return null;var r=I0(e,e===Ti?li:0);if(r===0)return null;var n=r,a=lr;lr|=16;var i=yF();(Ti!==e||li!==n)&&(Sm(),Rv(e,n));do try{TW();break}catch(s){gF(e,s)}while(1);if(vT(),fb.current=i,lr=a,ya!==null?n=0:(Ti=null,li=0,n=Va),(ym&bm)!==0)Rv(e,0);else if(n!==0){if(n===2&&(lr|=64,e.hydrate&&(e.hydrate=!1,dT(e.containerInfo)),r=wL(e),r!==0&&(n=kh(e,r))),n===1)throw t=X2,Rv(e,0),Mv(e,r),rs(e,oi()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=r,n){case 0:case 1:throw Error(Ct(345));case 2:uf(e);break;case 3:if(Mv(e,r),(r&62914560)===r&&(n=PT+500-oi(),10<n)){if(I0(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){vo(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=$5(uf.bind(null,e),n);break}uf(e);break;case 4:if(Mv(e,r),(r&4186112)===r)break;for(n=e.eventTimes,a=-1;0<r;){var o=31-md(r);i=1<<o,o=n[o],o>a&&(a=o),r&=~i}if(r=a,r=oi()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wW(r/1960))-r,10<r){e.timeoutHandle=$5(uf.bind(null,e),r);break}uf(e);break;case 5:uf(e);break;default:throw Error(Ct(329))}}return rs(e,oi()),e.callbackNode===t?vF.bind(null,e):null}function Mv(e,t){for(t&=~TT,t&=~bm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-md(t),n=1<<r;e[r]=-1,t&=~n}}function f_(e){if((lr&48)!==0)throw Error(Ct(327));if(kd(),e===Ti&&(e.expiredLanes&li)!==0){var t=li,r=kh(e,t);(ym&bm)!==0&&(t=I0(e,t),r=kh(e,t))}else t=I0(e,0),r=kh(e,t);if(e.tag!==0&&r===2&&(lr|=64,e.hydrate&&(e.hydrate=!1,dT(e.containerInfo)),t=wL(e),t!==0&&(r=kh(e,t))),r===1)throw r=X2,Rv(e,0),Mv(e,t),rs(e,oi()),r;return e.finishedWork=e.current.alternate,e.finishedLanes=t,uf(e),rs(e,oi()),null}function _W(){if(yl!==null){var e=yl;yl=null,e.forEach(function(t){t.expiredLanes|=24&t.pendingLanes,rs(t,oi())})}Lu()}function mF(e,t){var r=lr;lr|=1;try{return e(t)}finally{lr=r,lr===0&&(Sm(),Lu())}}function hF(e,t){var r=lr;lr&=-2,lr|=8;try{return e(t)}finally{lr=r,lr===0&&(Sm(),Lu())}}function ay(e,t){jn(i_,Vf),Vf|=t,ym|=t}function ET(){Vf=i_.current,An(i_)}function Rv(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,aW(r)),ya!==null)for(r=ya.return;r!==null;){var n=r;switch(n.tag){case 1:n=n.type.childContextTypes,n!=null&&eb();break;case 3:Wv(),An(Wi),An(pi),yT();break;case 5:gT(n);break;case 4:Wv();break;case 13:An(Gn);break;case 19:An(Gn);break;case 10:mT(n);break;case 23:case 24:ET()}r=r.return}Ti=e,ya=yd(e.current,null),li=Vf=ym=t,Va=0,X2=null,TT=bm=hg=0}function gF(e,t){do{var r=ya;try{if(vT(),r0.current=db,sb){for(var n=$n.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}sb=!1}if(F0=0,Na=ri=$n=null,n0=!1,AT.current=null,r===null||r.return===null){Va=1,X2=t,ya=null;break}e:{var i=e,o=r.return,s=r,u=t;if(t=li,s.flags|=2048,s.firstEffect=s.lastEffect=null,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u;if((s.mode&2)===0){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var d=(Gn.current&1)!==0,f=o;do{var p;if(p=f.tag===13){var v=f.memoizedState;if(v!==null)p=v.dehydrated!==null;else{var m=f.memoizedProps;p=m.fallback===void 0?!1:m.unstable_avoidThisFallback!==!0?!0:!d}}if(p){var h=f.updateQueue;if(h===null){var g=new Set;g.add(l),f.updateQueue=g}else h.add(l);if((f.mode&2)===0){if(f.flags|=64,s.flags|=16384,s.flags&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var y=rd(-1,1);y.tag=2,nd(s,y)}s.lanes|=1;break e}u=void 0,s=t;var b=i.pingCache;if(b===null?(b=i.pingCache=new yW,u=new Set,b.set(l,u)):(u=b.get(l),u===void 0&&(u=new Set,b.set(l,u))),!u.has(s)){u.add(s);var S=MW.bind(null,i,l,s);l.then(S,S)}f.flags|=4096,f.lanes=t;break e}f=f.return}while(f!==null);u=Error((_v(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Va!==5&&(Va=2),u=_T(u,s),f=o;do{switch(f.tag){case 3:i=u,f.flags|=4096,t&=-t,f.lanes|=t;var C=dF(f,i,t);iI(f,C);break e;case 1:i=u;var x=f.type,A=f.stateNode;if((f.flags&64)===0&&(typeof x.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(Su===null||!Su.has(A)))){f.flags|=4096,t&=-t,f.lanes|=t;var P=fF(f,i,t);iI(f,P);break e}}f=f.return}while(f!==null)}SF(r)}catch(T){t=T,ya===r&&r!==null&&(ya=r=r.return);continue}break}while(1)}function yF(){var e=fb.current;return fb.current=db,e===null?db:e}function kh(e,t){var r=lr;lr|=16;var n=yF();Ti===e&&li===t||Rv(e,t);do try{AW();break}catch(a){gF(e,a)}while(1);if(vT(),lr=r,fb.current=n,ya!==null)throw Error(Ct(261));return Ti=null,li=0,Va}function AW(){for(;ya!==null;)bF(ya)}function TW(){for(;ya!==null&&!sW();)bF(ya)}function bF(e){var t=CF(e.alternate,e,Vf);e.memoizedProps=e.pendingProps,t===null?SF(e):ya=t,AT.current=null}function SF(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&2048)===0){if(r=hW(r,t,Vf),r!==null){ya=r;return}if(r=t,r.tag!==24&&r.tag!==23||r.memoizedState===null||(Vf&1073741824)!==0||(r.mode&4)===0){for(var n=0,a=r.child;a!==null;)n|=a.lanes|a.childLanes,a=a.sibling;r.childLanes=n}e!==null&&(e.flags&2048)===0&&(e.firstEffect===null&&(e.firstEffect=t.firstEffect),t.lastEffect!==null&&(e.lastEffect!==null&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(e.lastEffect!==null?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(r=gW(t),r!==null){r.flags&=2047,ya=r;return}e!==null&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(t=t.sibling,t!==null){ya=t;return}ya=t=e}while(t!==null);Va===0&&(Va=5)}function uf(e){var t=jv();return zf(99,PW.bind(null,e,t)),null}function PW(e,t){do kd();while(a0!==null);if((lr&48)!==0)throw Error(Ct(327));var r=e.finishedWork;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Ct(177));e.callbackNode=null;var n=r.lanes|r.childLanes,a=n,i=e.pendingLanes&~a;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=a,e.mutableReadLanes&=a,e.entangledLanes&=a,a=e.entanglements;for(var o=e.eventTimes,s=e.expirationTimes;0<i;){var u=31-md(i),l=1<<u;a[u]=0,o[u]=-1,s[u]=-1,i&=~l}if(yl!==null&&(n&24)===0&&yl.has(e)&&yl.delete(e),e===Ti&&(ya=Ti=null,li=0),1<r.flags?r.lastEffect!==null?(r.lastEffect.nextEffect=r,n=r.firstEffect):n=r:n=r.firstEffect,n!==null){if(a=lr,lr|=32,AT.current=null,Wx=S1,o=j5(),Hw(o)){if("selectionStart"in o)s={start:o.selectionStart,end:o.selectionEnd};else e:if(s=(s=o.ownerDocument)&&s.defaultView||window,(l=s.getSelection&&s.getSelection())&&l.rangeCount!==0){s=l.anchorNode,i=l.anchorOffset,u=l.focusNode,l=l.focusOffset;try{s.nodeType,u.nodeType}catch{s=null;break e}var c=0,d=-1,f=-1,p=0,v=0,m=o,h=null;t:for(;;){for(var g;m!==s||i!==0&&m.nodeType!==3||(d=c+i),m!==u||l!==0&&m.nodeType!==3||(f=c+l),m.nodeType===3&&(c+=m.nodeValue.length),(g=m.firstChild)!==null;)h=m,m=g;for(;;){if(m===o)break t;if(h===s&&++p===i&&(d=c),h===u&&++v===l&&(f=c),(g=m.nextSibling)!==null)break;m=h,h=m.parentNode}m=g}s=d===-1||f===-1?null:{start:d,end:f}}else s=null;s=s||{start:0,end:0}}else s=null;Xx={focusedElem:o,selectionRange:s},S1=!1,o0=null,P1=!1,Ft=n;do try{EW()}catch(T){if(Ft===null)throw Error(Ct(330));od(Ft,T),Ft=Ft.nextEffect}while(Ft!==null);o0=null,Ft=n;do try{for(o=e;Ft!==null;){var y=Ft.flags;if(y&16&&A0(Ft.stateNode,""),y&128){var b=Ft.alternate;if(b!==null){var S=b.ref;S!==null&&(typeof S=="function"?S(null):S.current=null)}}switch(y&1038){case 2:DI(Ft),Ft.flags&=-3;break;case 6:DI(Ft),Ft.flags&=-3,eC(Ft.alternate,Ft);break;case 1024:Ft.flags&=-1025;break;case 1028:Ft.flags&=-1025,eC(Ft.alternate,Ft);break;case 4:eC(Ft.alternate,Ft);break;case 8:s=Ft,pF(o,s);var C=s.alternate;EI(s),C!==null&&EI(C)}Ft=Ft.nextEffect}}catch(T){if(Ft===null)throw Error(Ct(330));od(Ft,T),Ft=Ft.nextEffect}while(Ft!==null);if(S=Xx,b=j5(),y=S.focusedElem,o=S.selectionRange,b!==y&&y&&y.ownerDocument&&ML(y.ownerDocument.documentElement,y)){for(o!==null&&Hw(y)&&(b=o.start,S=o.end,S===void 0&&(S=b),"selectionStart"in y?(y.selectionStart=b,y.selectionEnd=Math.min(S,y.value.length)):(S=(b=y.ownerDocument||document)&&b.defaultView||window,S.getSelection&&(S=S.getSelection(),s=y.textContent.length,C=Math.min(o.start,s),o=o.end===void 0?C:Math.min(o.end,s),!S.extend&&C>o&&(s=o,o=C,C=s),s=q5(y,C),i=q5(y,o),s&&i&&(S.rangeCount!==1||S.anchorNode!==s.node||S.anchorOffset!==s.offset||S.focusNode!==i.node||S.focusOffset!==i.offset)&&(b=b.createRange(),b.setStart(s.node,s.offset),S.removeAllRanges(),C>o?(S.addRange(b),S.extend(i.node,i.offset)):(b.setEnd(i.node,i.offset),S.addRange(b)))))),b=[],S=y;S=S.parentNode;)S.nodeType===1&&b.push({element:S,left:S.scrollLeft,top:S.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<b.length;y++)S=b[y],S.element.scrollLeft=S.left,S.element.scrollTop=S.top}S1=!!Wx,Xx=Wx=null,e.current=r,Ft=n;do try{for(y=e;Ft!==null;){var x=Ft.flags;if(x&36&&xW(y,Ft.alternate,Ft),x&128){b=void 0;var A=Ft.ref;if(A!==null){var P=Ft.stateNode;switch(Ft.tag){case 5:b=P;break;default:b=P}typeof A=="function"?A(b):A.current=b}}Ft=Ft.nextEffect}}catch(T){if(Ft===null)throw Error(Ct(330));od(Ft,T),Ft=Ft.nextEffect}while(Ft!==null);Ft=null,lW(),lr=a}else e.current=r;if(gd)gd=!1,a0=e,Bh=t;else for(Ft=n;Ft!==null;)t=Ft.nextEffect,Ft.nextEffect=null,Ft.flags&8&&(x=Ft,x.sibling=null,x.stateNode=null),Ft=t;if(n=e.pendingLanes,n===0&&(Su=null),n===1?e===d_?i0++:(i0=0,d_=e):i0=0,r=r.stateNode,Pf&&typeof Pf.onCommitFiberRoot=="function")try{Pf.onCommitFiberRoot(fT,r,void 0,(r.current.flags&64)===64)}catch{}if(rs(e,oi()),pb)throw pb=!1,e=u_,u_=null,e;return(lr&8)!==0||Lu(),null}function EW(){for(;Ft!==null;){var e=Ft.alternate;P1||o0===null||((Ft.flags&8)!==0?D5(Ft,o0)&&(P1=!0):Ft.tag===13&&CW(e,Ft)&&D5(Ft,o0)&&(P1=!0));var t=Ft.flags;(t&256)!==0&&SW(e,Ft),(t&512)===0||gd||(gd=!0,O0(97,function(){return kd(),null})),Ft=Ft.nextEffect}}function kd(){if(Bh!==90){var e=97<Bh?97:Bh;return Bh=90,zf(e,DW)}return!1}function IW(e,t){l_.push(t,e),gd||(gd=!0,O0(97,function(){return kd(),null}))}function xF(e,t){c_.push(t,e),gd||(gd=!0,O0(97,function(){return kd(),null}))}function DW(){if(a0===null)return!1;var e=a0;if(a0=null,(lr&48)!==0)throw Error(Ct(331));var t=lr;lr|=32;var r=c_;c_=[];for(var n=0;n<r.length;n+=2){var a=r[n],i=r[n+1],o=a.destroy;if(a.destroy=void 0,typeof o=="function")try{o()}catch(u){if(i===null)throw Error(Ct(330));od(i,u)}}for(r=l_,l_=[],n=0;n<r.length;n+=2){a=r[n],i=r[n+1];try{var s=a.create;a.destroy=s()}catch(u){if(i===null)throw Error(Ct(330));od(i,u)}}for(s=e.current.firstEffect;s!==null;)e=s.nextEffect,s.nextEffect=null,s.flags&8&&(s.sibling=null,s.stateNode=null),s=e;return lr=t,Lu(),!0}function RI(e,t,r){t=_T(r,t),t=dF(e,t,1),nd(e,t),t=vo(),e=Y2(e,1),e!==null&&(z2(e,1,t),rs(e,t))}function od(e,t){if(e.tag===3)RI(e,e,t);else for(var r=e.return;r!==null;){if(r.tag===3){RI(r,e,t);break}else if(r.tag===1){var n=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Su===null||!Su.has(n))){e=_T(t,e);var a=fF(r,e,1);if(nd(r,a),a=vo(),r=Y2(r,1),r!==null)z2(r,1,a),rs(r,a);else if(typeof n.componentDidCatch=="function"&&(Su===null||!Su.has(n)))try{n.componentDidCatch(t,e)}catch{}break}}r=r.return}}function MW(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=vo(),e.pingedLanes|=e.suspendedLanes&r,Ti===e&&(li&r)===r&&(Va===4||Va===3&&(li&62914560)===li&&500>oi()-PT?Rv(e,0):TT|=r),rs(e,t)}function RW(e,t){var r=e.stateNode;r!==null&&r.delete(t),t=0,t===0&&(t=e.mode,(t&2)===0?t=1:(t&4)===0?t=jv()===99?1:2:(sl===0&&(sl=ym),t=uv(62914560&~sl),t===0&&(t=4194304))),r=vo(),e=Y2(e,t),e!==null&&(z2(e,t,r),rs(e,r))}var CF;CF=function(e,t,r){var n=t.lanes;if(e!==null)if(e.memoizedProps!==t.pendingProps||Wi.current)Os=!0;else if((r&n)!==0)Os=(e.flags&16384)!==0;else{switch(Os=!1,t.tag){case 3:yI(t),Zx();break;case 5:lI(t);break;case 1:Xi(t.type)&&w1(t);break;case 4:Qw(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value;var a=t.type._context;jn(tb,a._currentValue),a._currentValue=n;break;case 13:if(t.memoizedState!==null)return(r&t.child.childLanes)!==0?bI(e,t,r):(jn(Gn,Gn.current&1),t=dl(e,t,r),t!==null?t.sibling:null);jn(Gn,Gn.current&1);break;case 19:if(n=(r&t.childLanes)!==0,(e.flags&64)!==0){if(n)return _I(e,t,r);t.flags|=64}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),jn(Gn,Gn.current),n)break;return null;case 23:case 24:return t.lanes=0,$x(e,t,r)}return dl(e,t,r)}else Os=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=qv(t,pi.current),Iv(t,r),a=ST(null,t,n,e,a,r),t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,Xi(n)){var i=!0;w1(t)}else i=!1;t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,hT(t);var o=n.getDerivedStateFromProps;typeof o=="function"&&ab(t,n,o,e),a.updater=W2,t.stateNode=a,a._reactInternals=t,Kw(t,n,e,r),t=e_(null,t,n,!0,i,r)}else t.tag=0,Gi(null,t,a,r),t=t.child;return t;case 16:a=t.elementType;e:{switch(e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=a._init,a=i(a._payload),t.type=a,i=t.tag=BW(a),e=_s(a,e),i){case 0:t=Jw(null,t,a,e,r);break e;case 1:t=gI(null,t,a,e,r);break e;case 11:t=mI(null,t,a,e,r);break e;case 14:t=hI(null,t,a,_s(a.type,e),n,r);break e}throw Error(Ct(306,a,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_s(n,a),Jw(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_s(n,a),gI(e,t,n,a,r);case 3:if(yI(t),n=t.updateQueue,e===null||n===null)throw Error(Ct(282));if(n=t.pendingProps,a=t.memoizedState,a=a!==null?a.element:null,XL(e,t),B0(t,n,null,r),n=t.memoizedState.element,n===a)Zx(),t=dl(e,t,r);else{if(a=t.stateNode,(i=a.hydrate)&&(qc=Ev(t.stateNode.containerInfo.firstChild),cl=t,i=Au=!0),i){if(e=a.mutableSourceEagerHydrationData,e!=null)for(a=0;a<e.length;a+=2)i=e[a],i._workInProgressVersionPrimary=e[a+1],Dv.push(i);for(r=ZL(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|1024,r=r.sibling}else Gi(e,t,n,r),Zx();t=t.child}return t;case 5:return lI(t),e===null&&Zw(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,jw(n,a)?o=null:i!==null&&jw(n,i)&&(t.flags|=16),sF(e,t),Gi(e,t,o,r),t.child;case 6:return e===null&&Zw(t),null;case 13:return bI(e,t,r);case 4:return Qw(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=ib(t,null,n,r):Gi(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_s(n,a),mI(e,t,n,a,r);case 7:return Gi(e,t,t.pendingProps,r),t.child;case 8:return Gi(e,t,t.pendingProps.children,r),t.child;case 12:return Gi(e,t,t.pendingProps.children,r),t.child;case 10:e:{n=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value;var s=t.type._context;if(jn(tb,s._currentValue),s._currentValue=i,o!==null)if(s=o.value,i=qo(s,i)?0:(typeof n._calculateChangedBits=="function"?n._calculateChangedBits(s,i):1073741823)|0,i===0){if(o.children===a.children&&!Wi.current){t=dl(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var u=s.dependencies;if(u!==null){o=s.child;for(var l=u.firstContext;l!==null;){if(l.context===n&&(l.observedBits&i)!==0){s.tag===1&&(l=rd(-1,r&-r),l.tag=2,nd(s,l)),s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),WL(s.return,r),u.lanes|=r;break}l=l.next}}else o=s.tag===10&&s.type===t.type?null:s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Gi(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,i=t.pendingProps,n=i.children,Iv(t,r),a=ts(a,i.unstable_observedBits),n=n(a),t.flags|=1,Gi(e,t,n,r),t.child;case 14:return a=t.type,i=_s(a,t.pendingProps),i=_s(a.type,i),hI(e,t,a,i,n,r);case 15:return oF(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_s(n,a),e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Xi(n)?(e=!0,w1(t)):e=!1,Iv(t,r),KL(t,n,a),Kw(t,n,a,r),e_(null,t,n,!0,e,r);case 19:return _I(e,t,r);case 23:return $x(e,t,r);case 24:return $x(e,t,r)}throw Error(Ct(156,t.tag))};function OW(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function jo(e,t,r,n){return new OW(e,t,r,n)}function IT(e){return e=e.prototype,!(!e||!e.isReactComponent)}function BW(e){if(typeof e=="function")return IT(e)?1:0;if(e!=null){if(e=e.$$typeof,e===F2)return 11;if(e===N2)return 14}return 2}function yd(e,t){var r=e.alternate;return r===null?(r=jo(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function E1(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")IT(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Rc:return Ov(r.children,a,i,t);case $k:o=8,a|=16;break;case jA:o=8,a|=1;break;case Kh:return e=jo(12,r,t,a|8),e.elementType=Kh,e.type=Kh,e.lanes=i,e;case Qh:return e=jo(13,r,t,a),e.type=Qh,e.elementType=Qh,e.lanes=i,e;case W1:return e=jo(19,r,t,a),e.elementType=W1,e.lanes=i,e;case ZA:return DT(r,a,i,t);case Pw:return e=jo(24,r,t,a),e.elementType=Pw,e.lanes=i,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case WA:o=10;break e;case XA:o=9;break e;case F2:o=11;break e;case N2:o=14;break e;case YA:o=16,n=null;break e;case KA:o=22;break e}throw Error(Ct(130,e==null?e:typeof e,""))}return t=jo(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function Ov(e,t,r,n){return e=jo(7,e,n,t),e.lanes=r,e}function DT(e,t,r,n){return e=jo(23,e,n,t),e.elementType=ZA,e.lanes=r,e}function tC(e,t,r){return e=jo(6,e,null,t),e.lanes=r,e}function rC(e,t,r){return t=jo(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function kW(e,t,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Ux(0),this.expirationTimes=Ux(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ux(0),this.mutableSourceEagerHydrationData=null}function LW(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hf,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function vb(e,t,r,n){var a=t.current,i=vo(),o=ad(a);e:if(r){r=r._reactInternals;t:{if(up(r)!==r||r.tag!==1)throw Error(Ct(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(Xi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(s!==null);throw Error(Ct(171))}if(r.tag===1){var u=r.type;if(Xi(u)){r=UL(r,u,s);break e}}r=s}else r=hd;return t.context===null?t.context=r:t.pendingContext=r,t=rd(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),nd(a,t),id(a,o,i),o}function nC(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function OI(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function MT(e,t){OI(e,t),(e=e.alternate)&&OI(e,t)}function FW(){return null}function RT(e,t,r){var n=r!=null&&r.hydrationOptions!=null&&r.hydrationOptions.mutableSources||null;if(r=new kW(e,t,r!=null&&r.hydrate===!0),t=jo(3,null,null,t===2?7:t===1?3:0),r.current=t,t.stateNode=r,hT(t),e[gm]=r.current,BL(e.nodeType===8?e.parentNode:e),n)for(e=0;e<n.length;e++){t=n[e];var a=t._getVersion;a=a(t._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[t,a]:r.mutableSourceEagerHydrationData.push(t,a)}this._internalRoot=r}RT.prototype.render=function(e){vb(e,this._internalRoot,null,null)};RT.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;vb(null,e,null,function(){t[gm]=null})};function gg(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function NW(e,t){if(t||(t=e?e.nodeType===9?e.documentElement:e.firstChild:null,t=!(!t||t.nodeType!==1||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new RT(e,0,t?{hydrate:!0}:void 0)}function K2(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i._internalRoot;if(typeof a=="function"){var s=a;a=function(){var l=nC(o);s.call(l)}}vb(t,o,e,a)}else{if(i=r._reactRootContainer=NW(r,n),o=i._internalRoot,typeof a=="function"){var u=a;a=function(){var l=nC(o);u.call(l)}}hF(function(){vb(t,o,e,a)})}return nC(o)}pL=function(e){if(e.tag===13){var t=vo();id(e,4,t),MT(e,4)}};rT=function(e){if(e.tag===13){var t=vo();id(e,67108864,t),MT(e,67108864)}};vL=function(e){if(e.tag===13){var t=vo(),r=ad(e);id(e,r,t),MT(e,r)}};mL=function(e,t){return t()};Fw=function(e,t,r){switch(t){case"input":if(Iw(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=q2(n);if(!a)throw Error(Ct(90));eL(n),Iw(n,a)}}}break;case"textarea":rL(e,r);break;case"select":t=r.value,t!=null&&Av(e,!!r.multiple,t,!1)}};JA=mF;lL=function(e,t,r,n,a){var i=lr;lr|=4;try{return zf(98,e.bind(null,t,r,n,a))}finally{lr=i,lr===0&&(Sm(),Lu())}};eT=function(){(lr&49)===0&&(_W(),kd())};cL=function(e,t){var r=lr;lr|=2;try{return e(t)}finally{lr=r,lr===0&&(Sm(),Lu())}};function wF(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gg(t))throw Error(Ct(200));return LW(e,t,null,r)}var UW={Events:[vg,vv,q2,sL,uL,kd,{current:!1}]},ah={findFiberByHostInstance:yf,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},zW={bundleType:ah.bundleType,version:ah.version,rendererPackageName:ah.rendererPackageName,rendererConfig:ah.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:sp.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=fL(e),e===null?null:e.stateNode},findFiberByHostInstance:ah.findFiberByHostInstance||FW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var iy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iy.isDisabled&&iy.supportsFiber)try{fT=iy.inject(zW),Pf=iy}catch{}}vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UW;vs.createPortal=wF;vs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ct(188)):Error(Ct(268,Object.keys(e)));return e=fL(t),e=e===null?null:e.stateNode,e};vs.flushSync=function(e,t){var r=lr;if((r&48)!==0)return e(t);lr|=1;try{if(e)return zf(99,e.bind(null,t))}finally{lr=r,Lu()}};vs.hydrate=function(e,t,r){if(!gg(t))throw Error(Ct(200));return K2(null,e,t,!0,r)};vs.render=function(e,t,r){if(!gg(t))throw Error(Ct(200));return K2(null,e,t,!1,r)};vs.unmountComponentAtNode=function(e){if(!gg(e))throw Error(Ct(40));return e._reactRootContainer?(hF(function(){K2(null,null,e,!1,function(){e._reactRootContainer=null,e[gm]=null})}),!0):!1};vs.unstable_batchedUpdates=mF;vs.unstable_createPortal=function(e,t){return wF(e,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};vs.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!gg(r))throw Error(Ct(200));if(e==null||e._reactInternals===void 0)throw Error(Ct(38));return K2(e,t,r,!1,n)};vs.version="17.0.2";function _F(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_F)}catch(e){console.error(e)}}_F(),VA.exports=vs;var S6e=VA.exports;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var p_=function(e,t){return p_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},p_(e,t)};function Pe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");p_(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var _=function(){return _=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},_.apply(this,arguments)};function se(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function ie(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,a=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xv(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function N0(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,i=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function It(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,i;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function Bv(e){return this instanceof Bv?(this.v=e,this):new Bv(e)}function VW(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),a,i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(f){n[f]&&(a[f]=function(p){return new Promise(function(v,m){i.push([f,p,v,m])>1||s(f,p)})})}function s(f,p){try{u(n[f](p))}catch(v){d(i[0][3],v)}}function u(f){f.value instanceof Bv?Promise.resolve(f.value.v).then(l,c):d(i[0][2],f)}function l(f){s("next",f)}function c(f){s("throw",f)}function d(f,p){f(p),i.shift(),i.length&&s(i[0][0],i[0][1])}}function HW(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Xv=="function"?Xv(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(s,u){o=e[i](o),a(s,u,o.done,o.value)})}}function a(i,o,s,u){Promise.resolve(u).then(function(l){i({value:l,done:s})},o)}}var Xa;(function(e){function t(a){return a}e.create=t;function r(a,i){return(a&i)!==0}e.has=r;function n(a,i){return!!i&&(a&i)===i}e.hasAll=n})(Xa||(Xa={}));var Cr;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var C=0,x=0,A=S.chunks;x<A.length;x++){var P=A[x];C+=P.length}for(var T=0;T<S.offset;T++)C+=S.current[T].length;return C}e.getSize=n;function a(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=a;var i=[];(function(){for(var S="",C=0;C<512;C++)i[C]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,C){C>0&&c(S,i[C])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,C){!C||(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=C)}e.write=l;function c(S,C){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=C}e.writeSafe=c;function d(S,C,x){if(!C){s(S,x);return}var A=x-C.length;s(S,A),c(S,C)}e.writePadLeft=d;function f(S,C,x){if(!C){s(S,x);return}var A=x-C.length;c(S,C),s(S,A)}e.writePadRight=f;function p(S,C){c(S,""+C)}e.writeInteger=p;function v(S,C){c(S,""+C+" ")}e.writeIntegerAndSpace=v;function m(S,C,x){var A=""+C,P=x-A.length;s(S,P),c(S,A)}e.writeIntegerPadLeft=m;function h(S,C,x){var A=""+C,P=x-A.length;c(S,A),s(S,P)}e.writeIntegerPadRight=h;function g(S,C,x){c(S,""+Math.round(x*C)/x)}e.writeFloat=g;function y(S,C,x,A){var P=""+Math.round(x*C)/x,T=A-P.length;s(S,T),c(S,P)}e.writeFloatPadLeft=y;function b(S,C,x,A){var P=""+Math.round(x*C)/x,T=A-P.length;c(S,P),s(S,T)}e.writeFloatPadRight=b})(Cr||(Cr={}));var fn=function(){if(typeof window!="undefined"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process!="undefined"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function I1(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?"".concat(r,"h").concat(n,"m").concat(a,".").concat(i,"s"):n>0?"".concat(n,"m").concat(a,".").concat(i,"s"):a>0?"".concat(a,".").concat(i,"s"):"".concat(e.toFixed(0),"ms")}var Jr;(function(e){var t=typeof btoa!="undefined"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+fn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function a(){var o=+new Date+fn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=a;function i(o){return typeof o=="string"}e.is=i})(Jr||(Jr={}));function GW(e,t){return e-t}function qW(e){return Array.prototype.sort.call(e,GW),e}var BI;(function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(v){return!1},p.prototype.forEach=function(v,m){return m},p}(),r=function(){function p(v){this.idx=v,this.size=1}return p.prototype.has=function(v){return v===this.idx},p.prototype.forEach=function(v,m){return v(this.idx,m),m},p}(),n=function(){function p(v,m){this.mask=v,this.size=m,this.length=v.length}return p.prototype.has=function(v){return v<this.length&&!!this.mask[v]},p.prototype._forEach=function(v,m){for(var h=0;h<this.length;h++)this.mask[h]&&v(h,m)},p.prototype.forEach=function(v,m){return this._forEach(v,m),m},p}(),a=function(){function p(v){this.size=v}return p.prototype.has=function(v){return!0},p.prototype._forEach=function(v,m){for(var h=0;h<this.size;h++)v(h,m)},p.prototype.forEach=function(v,m){return this._forEach(v,m),m},p}(),i=function(){function p(v){this.set=v,this._flat=void 0,this.size=v.size}return p.prototype.has=function(v){return this.set.has(v)},p.prototype._forEach=function(v,m){for(var h=0,g=this.flatten();h<g.length;h++){var y=g[h];v(y,m)}},p.prototype.flatten=function(){if(this._flat)return this._flat;var v=new Int32Array(this.size),m=0;return this.set.forEach(function(h){return v[m++]=h}),qW(v),this._flat=v,this._flat},p.prototype.forEach=function(v,m){return this._forEach(v,m),m},p}();function o(p){return new a(p)}e.always=o,e.never=new t;function s(p){return new i(p)}e.ofSet=s;function u(p){return new r(p)}e.singleton=u;function l(p){var v=p.length;if(v===0)return new t;if(v===1)return new r(p[0]);for(var m=0,h=0,g=p;h<g.length;h++){var y=g[h];y>m&&(m=y)}if(v===m)return new a(v);var b=v/m;if(b<1/12){for(var S=new Set,C=0,x=p;C<x.length;C++){var y=x[C];S.add(y)}return new i(S)}for(var A=new Int8Array(m+1),P=0,T=p;P<T.length;P++){var y=T[P];A[y]=1}return new n(A,p.length)}e.ofUniqueIndices=l;function c(p,v){return new n(p,v)}e.ofMask=c;function d(p,v){for(var m=0,h=v;m<h.length;m++){var g=h[m];if(p.has(g))return!0}return!1}e.hasAny=d;function f(p,v){var m=0,h=0;if(v.forEach(function(b){p.has(b)||(m++,b>h&&(h=b))}),m/h<1/12){var g=new Set;return v.forEach(function(b){p.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(h+1);return v.forEach(function(b){p.has(b)||(y[b]=1)}),c(y,m)}}e.complement=f})(BI||(BI={}));function gi(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var s0;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,a){return n.ref=a,n}e.set=r})(s0||(s0={}));var jW=gi(0,2147483647),bd;(function(e){function t(n,a){return{id:jW(),version:0,value:n,metadata:a}}e.create=t;function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}e.withValue=r})(bd||(bd={}));var R;(function(e){function t(i,o){return s0.create(bd.create(i,o))}e.create=t;function r(i,o){return s0.set(i,bd.withValue(i.ref,o))}e.update=r;function n(i,o){return s0.set(i,o)}e.set=n;function a(i,o){return i.ref.value!==o?r(i,o):i}e.updateIfChanged=a})(R||(R={}));var Oc=function(){};function Di(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var AF=Object.prototype.hasOwnProperty;function Al(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!Al(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var a=0;a<i.length;a++)if(!AF.call(t,i[a]))return!1;for(var a=0;a<i.length;a++)if(!Al(e[i[a]],t[i[a]]))return!1;return!0}return!1}function U0(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?WW(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Yv(e,t):!1}function Yv(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!AF.call(e,i)||e[i]!==t[i])return!1}return!0}function WW(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function oa(e,t){return e!==void 0?e:t}function kI(e){return(e<10?"0":"")+e}function XW(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return"".concat(t,":").concat(kI(r),":").concat(kI(n))}var pn;(function(e){function t(){return function(a){return r(a)}}e.factory=t;function r(a){var i;return i=function(){function o(s,u){this.data=s,this.id=Jr.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}(),i.type=a,i}e.create=r;function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++){var u=s[o];if(u===i)return!0}return!1}e.hasTag=n,e.Null={id:Jr.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(pn||(pn={}));var z0;(function(e){function t(n){var a=n;return!!a&&!!a.transform&&!!a.parent&&!!a.status}e.is=t;function r(n,a){var i=typeof a=="string"?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}e.resolve=r})(z0||(z0={}));var TF=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===pn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==pn.Null},enumerable:!1,configurable:!0}),e}(),Zn;(function(e){function t(a){var i;if(!!a)return typeof a=="string"?a:z0.is(a)?a.transform.ref:(i=a.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(a,i){if(!!i)return z0.is(i)?i:typeof i=="string"?a.cells.get(i):i.cell}e.resolve=r;function n(a,i){var o=r(a,i);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(Zn||(Zn={}));var Q2="delete",Cn=5,Wo=1<<Cn,Ai=Wo-1,Nr={};function v_(){return{value:!1}}function Xo(e){e&&(e.value=!0)}function OT(){}function Kv(e){return e.size===void 0&&(e.size=e.__iterate(PF)),e.size}function Sd(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?Kv(e)+t:t}function PF(){return!0}function Z2(e,t,r){return(e===0&&!IF(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function yg(e,t){return EF(e,t,0)}function $2(e,t){return EF(e,t,t)}function EF(e,t,r){return e===void 0?r:IF(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function IF(e){return e<0||e===0&&1/e===-1/0}var DF="@@__IMMUTABLE_ITERABLE__@@";function Qi(e){return Boolean(e&&e[DF])}var MF="@@__IMMUTABLE_KEYED__@@";function zn(e){return Boolean(e&&e[MF])}var RF="@@__IMMUTABLE_INDEXED__@@";function Yi(e){return Boolean(e&&e[RF])}function J2(e){return zn(e)||Yi(e)}var Jn=function(t){return Qi(t)?t:yo(t)},Zs=function(e){function t(r){return zn(r)?r:Ld(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Jn),cp=function(e){function t(r){return Yi(r)?r:$s(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Jn),xm=function(e){function t(r){return Qi(r)&&!J2(r)?r:_m(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Jn);Jn.Keyed=Zs;Jn.Indexed=cp;Jn.Set=xm;var OF="@@__IMMUTABLE_SEQ__@@";function BT(e){return Boolean(e&&e[OF])}var YW="@@__IMMUTABLE_RECORD__@@";function kT(e){return Boolean(e&&e[YW])}function Xl(e){return Qi(e)||kT(e)}var Cm="@@__IMMUTABLE_ORDERED__@@";function ks(e){return Boolean(e&&e[Cm])}var bg=0,js=1,Ws=2,m_=typeof Symbol=="function"&&Symbol.iterator,BF="@@iterator",LT=m_||BF,en=function(t){this.next=t};en.prototype.toString=function(){return"[Iterator]"};en.KEYS=bg;en.VALUES=js;en.ENTRIES=Ws;en.prototype.inspect=en.prototype.toSource=function(){return this.toString()};en.prototype[LT]=function(){return this};function Bn(e,t,r,n){var a=e===0?t:e===1?r:[t,r];return n?n.value=a:n={value:a,done:!1},n}function Zi(){return{value:void 0,done:!0}}function kF(e){return Array.isArray(e)?!0:!!eS(e)}function LI(e){return e&&typeof e.next=="function"}function h_(e){var t=eS(e);return t&&t.call(e)}function eS(e){var t=e&&(m_&&e[m_]||e[BF]);if(typeof t=="function")return t}function KW(e){var t=eS(e);return t&&t===e.entries}function QW(e){var t=eS(e);return t&&t===e.keys}var wm=Object.prototype.hasOwnProperty;function LF(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var yo=function(e){function t(r){return r==null?NT():Xl(r)?r.toSeq():$W(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,a){var i=this._cache;if(i){for(var o=i.length,s=0;s!==o;){var u=i[a?o-++s:s++];if(n(u[1],u[0],this)===!1)break}return s}return this.__iterateUncached(n,a)},t.prototype.__iterator=function(n,a){var i=this._cache;if(i){var o=i.length,s=0;return new en(function(){if(s===o)return Zi();var u=i[a?o-++s:s++];return Bn(n,u[0],u[1])})}return this.__iteratorUncached(n,a)},t}(Jn),Ld=function(e){function t(r){return r==null?NT().toKeyedSeq():Qi(r)?zn(r)?r.toSeq():r.fromEntrySeq():kT(r)?r.toSeq():FF(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(yo),$s=function(e){function t(r){return r==null?NT():Qi(r)?zn(r)?r.entrySeq():r.toIndexedSeq():kT(r)?r.toSeq().entrySeq():NF(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(yo),_m=function(e){function t(r){return(Qi(r)&&!J2(r)?r:$s(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(yo);yo.isSeq=BT;yo.Keyed=Ld;yo.Set=_m;yo.Indexed=$s;yo.prototype[OF]=!0;var Hf=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return this.has(n)?this._array[Sd(this,n)]:a},t.prototype.__iterate=function(n,a){for(var i=this._array,o=i.length,s=0;s!==o;){var u=a?o-++s:s++;if(n(i[u],u,this)===!1)break}return s},t.prototype.__iterator=function(n,a){var i=this._array,o=i.length,s=0;return new en(function(){if(s===o)return Zi();var u=a?o-++s:s++;return Bn(n,u,i[u])})},t}($s),FT=function(e){function t(r){var n=Object.keys(r);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return a!==void 0&&!this.has(n)?a:this._object[n]},t.prototype.has=function(n){return wm.call(this._object,n)},t.prototype.__iterate=function(n,a){for(var i=this._object,o=this._keys,s=o.length,u=0;u!==s;){var l=o[a?s-++u:u++];if(n(i[l],l,this)===!1)break}return u},t.prototype.__iterator=function(n,a){var i=this._object,o=this._keys,s=o.length,u=0;return new en(function(){if(u===s)return Zi();var l=o[a?s-++u:u++];return Bn(n,l,i[l])})},t}(Ld);FT.prototype[Cm]=!0;var ZW=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,a){if(a)return this.cacheResult().__iterate(n,a);var i=this._collection,o=h_(i),s=0;if(LI(o))for(var u;!(u=o.next()).done&&n(u.value,s++,this)!==!1;);return s},t.prototype.__iteratorUncached=function(n,a){if(a)return this.cacheResult().__iterator(n,a);var i=this._collection,o=h_(i);if(!LI(o))return new en(Zi);var s=0;return new en(function(){var u=o.next();return u.done?u:Bn(n,s++,u.value)})},t}($s),FI;function NT(){return FI||(FI=new Hf([]))}function FF(e){var t=UT(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new FT(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function NF(e){var t=UT(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function $W(e){var t=UT(e);if(t)return KW(e)?t.fromEntrySeq():QW(e)?t.toSetSeq():t;if(typeof e=="object")return new FT(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function UT(e){return LF(e)?new Hf(e):kF(e)?new ZW(e):void 0}var UF="@@__IMMUTABLE_MAP__@@";function zT(e){return Boolean(e&&e[UF])}function zF(e){return zT(e)&&ks(e)}function NI(e){return Boolean(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function fo(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(NI(e)&&NI(t)&&e.equals(t))}var ih=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,a=r&65535;return n*a+((t>>>16)*a+n*(r>>>16)<<16>>>0)|0};function tS(e){return e>>>1&1073741824|e&3221225471}var JW=Object.prototype.valueOf;function lo(e){if(e==null)return UI(e);if(typeof e.hashCode=="function")return tS(e.hashCode(e));var t=iX(e);if(t==null)return UI(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return eX(t);case"string":return t.length>oX?tX(t):g_(t);case"object":case"function":return nX(t);case"symbol":return rX(t);default:if(typeof t.toString=="function")return g_(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function UI(e){return e===null?1108378658:1108378659}function eX(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return tS(t)}function tX(e){var t=oC[e];return t===void 0&&(t=g_(e),iC===sX&&(iC=0,oC={}),iC++,oC[e]=t),t}function g_(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return tS(t)}function rX(e){var t=HI[e];return t!==void 0||(t=VF(),HI[e]=t),t}function nX(e){var t;if(y_&&(t=b_.get(e),t!==void 0)||(t=e[df],t!==void 0)||!VI&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[df],t!==void 0||(t=aX(e),t!==void 0)))return t;if(t=VF(),y_)b_.set(e,t);else{if(zI!==void 0&&zI(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(VI)Object.defineProperty(e,df,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[df]=t;else if(e.nodeType!==void 0)e[df]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var zI=Object.isExtensible,VI=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function aX(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function iX(e){return e.valueOf!==JW&&typeof e.valueOf=="function"?e.valueOf(e):e}function VF(){var e=++aC;return aC&1073741824&&(aC=0),e}var y_=typeof WeakMap=="function",b_;y_&&(b_=new WeakMap);var HI=Object.create(null),aC=0,df="__immutablehash__";typeof Symbol=="function"&&(df=Symbol(df));var oX=16,sX=255,iC=0,oC={},rS=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return this._iter.get(n,a)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,a=VT(this,!0);return this._useKeys||(a.valueSeq=function(){return n._iter.toSeq().reverse()}),a},t.prototype.map=function(n,a){var i=this,o=WF(this,n,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(n,a)}),o},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o,s){return n(o,s,i)},a)},t.prototype.__iterator=function(n,a){return this._iter.__iterator(n,a)},t}(Ld);rS.prototype[Cm]=!0;var HF=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this,o=0;return a&&Kv(this),this._iter.__iterate(function(s){return n(s,a?i.size-++o:o++,i)},a)},t.prototype.__iterator=function(n,a){var i=this,o=this._iter.__iterator(js,a),s=0;return a&&Kv(this),new en(function(){var u=o.next();return u.done?u:Bn(n,a?i.size-++s:s++,u.value,u)})},t}($s),GF=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(js,a);return new en(function(){var o=i.next();return o.done?o:Bn(n,o.value,o.value,o)})},t}(_m),qF=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){if(o){qI(o);var s=Qi(o);return n(s?o.get(1):o[1],s?o.get(0):o[0],i)}},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(js,a);return new en(function(){for(;;){var o=i.next();if(o.done)return o;var s=o.value;if(s){qI(s);var u=Qi(s);return Bn(n,u?s.get(0):s[0],u?s.get(1):s[1],o)}}})},t}(Ld);HF.prototype.cacheResult=rS.prototype.cacheResult=GF.prototype.cacheResult=qF.prototype.cacheResult=GT;function jF(e){var t=Fu(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=GT,t.__iterateUncached=function(r,n){var a=this;return e.__iterate(function(i,o){return r(o,i,a)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===Ws){var a=e.__iterator(r,n);return new en(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return e.__iterator(r===js?bg:js,n)},t}function WF(e,t,r){var n=Fu(e);return n.size=e.size,n.has=function(a){return e.has(a)},n.get=function(a,i){var o=e.get(a,Nr);return o===Nr?i:t.call(r,o,a,e)},n.__iterateUncached=function(a,i){var o=this;return e.__iterate(function(s,u,l){return a(t.call(r,s,u,l),u,o)!==!1},i)},n.__iteratorUncached=function(a,i){var o=e.__iterator(Ws,i);return new en(function(){var s=o.next();if(s.done)return s;var u=s.value,l=u[0];return Bn(a,l,t.call(r,u[1],l,e),s)})},n}function VT(e,t){var r=this,n=Fu(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var a=jF(e);return a.reverse=function(){return e.flip()},a}),n.get=function(a,i){return e.get(t?a:-1-a,i)},n.has=function(a){return e.has(t?a:-1-a)},n.includes=function(a){return e.includes(a)},n.cacheResult=GT,n.__iterate=function(a,i){var o=this,s=0;return i&&Kv(e),e.__iterate(function(u,l){return a(u,t?l:i?o.size-++s:s++,o)},!i)},n.__iterator=function(a,i){var o=0;i&&Kv(e);var s=e.__iterator(Ws,!i);return new en(function(){var u=s.next();if(u.done)return u;var l=u.value;return Bn(a,t?l[0]:i?r.size-++o:o++,l[1],u)})},n}function XF(e,t,r,n){var a=Fu(e);return n&&(a.has=function(i){var o=e.get(i,Nr);return o!==Nr&&!!t.call(r,o,i,e)},a.get=function(i,o){var s=e.get(i,Nr);return s!==Nr&&t.call(r,s,i,e)?s:o}),a.__iterateUncached=function(i,o){var s=this,u=0;return e.__iterate(function(l,c,d){if(t.call(r,l,c,d))return u++,i(l,n?c:u-1,s)},o),u},a.__iteratorUncached=function(i,o){var s=e.__iterator(Ws,o),u=0;return new en(function(){for(;;){var l=s.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];if(t.call(r,f,d,e))return Bn(i,n?d:u++,f,l)}})},a}function uX(e,t,r){var n=Go().asMutable();return e.__iterate(function(a,i){n.update(t.call(r,a,i,e),0,function(o){return o+1})}),n.asImmutable()}function lX(e,t,r){var n=zn(e),a=(ks(e)?ci():Go()).asMutable();e.__iterate(function(o,s){a.update(t.call(r,o,s,e),function(u){return u=u||[],u.push(n?[s,o]:o),u})});var i=QF(e);return a.map(function(o){return hn(e,i(o))}).asImmutable()}function HT(e,t,r,n){var a=e.size;if(Z2(t,r,a))return e;var i=yg(t,a),o=$2(r,a);if(i!==i||o!==o)return HT(e.toSeq().cacheResult(),t,r,n);var s=o-i,u;s===s&&(u=s<0?0:s);var l=Fu(e);return l.size=u===0?u:e.size&&u||void 0,!n&&BT(e)&&u>=0&&(l.get=function(c,d){return c=Sd(this,c),c>=0&&c<u?e.get(c+i,d):d}),l.__iterateUncached=function(c,d){var f=this;if(u===0)return 0;if(d)return this.cacheResult().__iterate(c,d);var p=0,v=!0,m=0;return e.__iterate(function(h,g){if(!(v&&(v=p++<i)))return m++,c(h,n?g:m-1,f)!==!1&&m!==u}),m},l.__iteratorUncached=function(c,d){if(u!==0&&d)return this.cacheResult().__iterator(c,d);if(u===0)return new en(Zi);var f=e.__iterator(c,d),p=0,v=0;return new en(function(){for(;p++<i;)f.next();if(++v>u)return Zi();var m=f.next();return n||c===js||m.done?m:c===bg?Bn(c,v-1,void 0,m):Bn(c,v-1,m.value[1],m)})},l}function cX(e,t,r){var n=Fu(e);return n.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var s=0;return e.__iterate(function(u,l,c){return t.call(r,u,l,c)&&++s&&a(u,l,o)}),s},n.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var s=e.__iterator(Ws,i),u=!0;return new en(function(){if(!u)return Zi();var l=s.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];return t.call(r,f,d,o)?a===Ws?l:Bn(a,d,f,l):(u=!1,Zi())})},n}function YF(e,t,r,n){var a=Fu(e);return a.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var u=!0,l=0;return e.__iterate(function(c,d,f){if(!(u&&(u=t.call(r,c,d,f))))return l++,i(c,n?d:l-1,s)}),l},a.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var u=e.__iterator(Ws,o),l=!0,c=0;return new en(function(){var d,f,p;do{if(d=u.next(),d.done)return n||i===js?d:i===bg?Bn(i,c++,void 0,d):Bn(i,c++,d.value[1],d);var v=d.value;f=v[0],p=v[1],l&&(l=t.call(r,p,f,s))}while(l);return i===Ws?d:Bn(i,f,p,d)})},a}function dX(e,t){var r=zn(e),n=[e].concat(t).map(function(o){return Qi(o)?r&&(o=Zs(o)):o=r?FF(o):NF(Array.isArray(o)?o:[o]),o}).filter(function(o){return o.size!==0});if(n.length===0)return e;if(n.length===1){var a=n[0];if(a===e||r&&zn(a)||Yi(e)&&Yi(a))return a}var i=new Hf(n);return r?i=i.toKeyedSeq():Yi(e)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=n.reduce(function(o,s){if(o!==void 0){var u=s.size;if(u!==void 0)return o+u}},0),i}function KF(e,t,r){var n=Fu(e);return n.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,s=!1;function u(l,c){l.__iterate(function(d,f){return(!t||c<t)&&Qi(d)?u(d,c+1):(o++,a(d,r?f:o-1,n)===!1&&(s=!0)),!s},i)}return u(e,0),o},n.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=e.__iterator(a,i),s=[],u=0;return new en(function(){for(;o;){var l=o.next();if(l.done!==!1){o=s.pop();continue}var c=l.value;if(a===Ws&&(c=c[1]),(!t||s.length<t)&&Qi(c))s.push(o),o=c.__iterator(a,i);else return r?l:Bn(a,u++,c,l)}return Zi()})},n}function fX(e,t,r){var n=QF(e);return e.toSeq().map(function(a,i){return n(t.call(r,a,i,e))}).flatten(!0)}function pX(e,t){var r=Fu(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,a){var i=this,o=0;return e.__iterate(function(s){return(!o||n(t,o++,i)!==!1)&&n(s,o++,i)!==!1},a),o},r.__iteratorUncached=function(n,a){var i=e.__iterator(js,a),o=0,s;return new en(function(){return(!s||o%2)&&(s=i.next(),s.done)?s:o%2?Bn(n,o++,t):Bn(n,o++,s.value,s)})},r}function Qv(e,t,r){t||(t=ZF);var n=zn(e),a=0,i=e.toSeq().map(function(o,s){return[s,o,a++,r?r(o,s,e):o]}).valueSeq().toArray();return i.sort(function(o,s){return t(o[3],s[3])||o[2]-s[2]}).forEach(n?function(o,s){i[s].length=2}:function(o,s){i[s]=o[1]}),n?Ld(i):Yi(e)?$s(i):_m(i)}function oy(e,t,r){if(t||(t=ZF),r){var n=e.toSeq().map(function(a,i){return[a,r(a,i,e)]}).reduce(function(a,i){return GI(t,a[1],i[1])?i:a});return n&&n[0]}return e.reduce(function(a,i){return GI(t,a,i)?i:a})}function GI(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function sy(e,t,r,n){var a=Fu(e),i=new Hf(r).map(function(o){return o.size});return a.size=n?i.max():i.min(),a.__iterate=function(o,s){for(var u=this.__iterator(js,s),l,c=0;!(l=u.next()).done&&o(l.value,c++,this)!==!1;);return c},a.__iteratorUncached=function(o,s){var u=r.map(function(d){return d=Jn(d),h_(s?d.reverse():d)}),l=0,c=!1;return new en(function(){var d;return c||(d=u.map(function(f){return f.next()}),c=n?d.every(function(f){return f.done}):d.some(function(f){return f.done})),c?Zi():Bn(o,l++,t.apply(null,d.map(function(f){return f.value})))})},a}function hn(e,t){return e===t?e:BT(e)?t:e.constructor(t)}function qI(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function QF(e){return zn(e)?Zs:Yi(e)?cp:xm}function Fu(e){return Object.create((zn(e)?Ld:Yi(e)?$s:_m).prototype)}function GT(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):yo.prototype.cacheResult.call(this)}function ZF(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function mu(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),a=0;a<r;a++)n[a]=e[a+t];return n}function $F(e,t){if(!e)throw new Error(t)}function Yo(e){$F(e!==1/0,"Cannot perform this action with an infinite size.")}function JF(e){if(LF(e)&&typeof e!="string")return e;if(ks(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}var vX=Object.prototype.toString;function mX(e){if(!e||typeof e!="object"||vX.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function xd(e){return typeof e=="object"&&(Xl(e)||Array.isArray(e)||mX(e))}function mb(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function hX(e,t){return Xl(e)?e.has(t):xd(e)&&wm.call(e,t)}function e8(e,t,r){return Xl(e)?e.get(t,r):hX(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function hb(e){if(Array.isArray(e))return mu(e);var t={};for(var r in e)wm.call(e,r)&&(t[r]=e[r]);return t}function gX(e,t){if(!xd(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Xl(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!wm.call(e,t))return e;var r=hb(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function yX(e,t,r){if(!xd(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Xl(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(wm.call(e,t)&&r===e[t])return e;var n=hb(e);return n[t]=r,n}function Am(e,t,r,n){n||(n=r,r=void 0);var a=t8(Xl(e),e,JF(t),0,r,n);return a===Nr?r:a}function t8(e,t,r,n,a,i){var o=t===Nr;if(n===r.length){var s=o?a:t,u=i(s);return u===s?t:u}if(!o&&!xd(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(mb)+"]: "+t);var l=r[n],c=o?Nr:e8(t,l,Nr),d=t8(c===Nr?e:Xl(c),c,r,n+1,a,i);return d===c?t:d===Nr?gX(t,l):yX(o?e?Ds():{}:t,l,d)}function bX(e,t,r){return Am(e,t,Nr,function(){return r})}function r8(e,t){return bX(this,e,t)}function SX(e,t){return Am(e,t,function(){return Nr})}function n8(e){return SX(this,e)}function a8(e,t,r,n){return Am(e,[t],r,n)}function i8(e,t,r){return arguments.length===1?e(this):a8(this,e,t,r)}function o8(e,t,r){return Am(this,e,t,r)}function xX(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return s8(this,e)}function CX(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return s8(this,t,e)}function s8(e,t,r){for(var n=[],a=0;a<t.length;a++){var i=Zs(t[a]);i.size!==0&&n.push(i)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?e.constructor(n[0]):e.withMutations(function(o){for(var s=r?function(l,c){a8(o,c,Nr,function(d){return d===Nr?l:r(d,l,c)})}:function(l,c){o.set(c,l)},u=0;u<n.length;u++)n[u].forEach(s)})}function qT(e,t,r){return jT(e,t,wX(r))}function jT(e,t,r){if(!xd(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Xl(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),a=e,i=n?cp:Zs,o=n?function(u){a===e&&(a=hb(a)),a.push(u)}:function(u,l){var c=wm.call(a,l),d=c&&r?r(a[l],u,l):u;(!c||d!==a[l])&&(a===e&&(a=hb(a)),a[l]=d)},s=0;s<t.length;s++)i(t[s]).forEach(o);return a}function wX(e){function t(r,n,a){return xd(r)&&xd(n)&&_X(r,n)?jT(r,[n],t):e?e(r,n,a):n}return t}function _X(e,t){var r=yo(e),n=yo(t);return Yi(r)===Yi(n)&&zn(r)===zn(n)}function AX(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return qT(this,e)}function TX(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return qT(this,t,e)}function u8(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Am(this,e,Ds(),function(n){return jT(n,t)})}function l8(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Am(this,e,Ds(),function(n){return qT(n,t)})}function nS(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function aS(){return this.__ownerID?this:this.__ensureOwner(new OT)}function iS(){return this.__ensureOwner()}function WT(){return this.__altered}var Go=function(e){function t(r){return r==null?Ds():zT(r)&&!ks(r)?r:Ds().withMutations(function(n){var a=e(r);Yo(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return Ds().withMutations(function(i){for(var o=0;o<n.length;o+=2){if(o+1>=n.length)throw new Error("Missing value for key: "+n[o]);i.set(n[o],n[o+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,a){return this._root?this._root.get(0,void 0,n,a):a},t.prototype.set=function(n,a){return XI(this,n,a)},t.prototype.remove=function(n){return XI(this,n,Nr)},t.prototype.deleteAll=function(n){var a=Jn(n);return a.size===0?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ds()},t.prototype.sort=function(n){return ci(Qv(this,n))},t.prototype.sortBy=function(n,a){return ci(Qv(this,a,n))},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){o.forEach(function(s,u){o.set(u,n.call(a,s,u,i))})})},t.prototype.__iterator=function(n,a){return new PX(this,n,a)},t.prototype.__iterate=function(n,a){var i=this,o=0;return this._root&&this._root.iterate(function(s){return o++,n(s[1],s[0],i)},a),o},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?XT(this.size,this._root,n,this.__hash):this.size===0?Ds():(this.__ownerID=n,this.__altered=!1,this)},t}(Zs);Go.isMap=zT;var Tn=Go.prototype;Tn[UF]=!0;Tn[Q2]=Tn.remove;Tn.removeAll=Tn.deleteAll;Tn.setIn=r8;Tn.removeIn=Tn.deleteIn=n8;Tn.update=i8;Tn.updateIn=o8;Tn.merge=Tn.concat=xX;Tn.mergeWith=CX;Tn.mergeDeep=AX;Tn.mergeDeepWith=TX;Tn.mergeIn=u8;Tn.mergeDeepIn=l8;Tn.withMutations=nS;Tn.wasAltered=WT;Tn.asImmutable=iS;Tn["@@transducer/init"]=Tn.asMutable=aS;Tn["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};Tn["@@transducer/result"]=function(e){return e.asImmutable()};var V0=function(t,r){this.ownerID=t,this.entries=r};V0.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(fo(n,i[o][0]))return i[o][1];return a};V0.prototype.update=function(t,r,n,a,i,o,s){for(var u=i===Nr,l=this.entries,c=0,d=l.length;c<d&&!fo(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:u)return this;if(Xo(s),(u||!f)&&Xo(o),!(u&&l.length===1)){if(!f&&!u&&l.length>=OX)return EX(t,l,a,i);var p=t&&t===this.ownerID,v=p?l:mu(l);return f?u?c===d-1?v.pop():v[c]=v.pop():v[c]=[a,i]:v.push([a,i]),p?(this.entries=v,this):new V0(t,v)}};var Zv=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};Zv.prototype.get=function(t,r,n,a){r===void 0&&(r=lo(n));var i=1<<((t===0?r:r>>>t)&Ai),o=this.bitmap;return(o&i)===0?a:this.nodes[c8(o&i-1)].get(t+Cn,r,n,a)};Zv.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=lo(a));var u=(r===0?n:n>>>r)&Ai,l=1<<u,c=this.bitmap,d=(c&l)!==0;if(!d&&i===Nr)return this;var f=c8(c&l-1),p=this.nodes,v=d?p[f]:void 0,m=YT(v,t,r+Cn,n,a,i,o,s);if(m===v)return this;if(!d&&m&&p.length>=BX)return DX(t,p,c,u,m);if(d&&!m&&p.length===2&&YI(p[f^1]))return p[f^1];if(d&&m&&p.length===1&&YI(m))return m;var h=t&&t===this.ownerID,g=d?m?c:c^l:c|l,y=d?m?d8(p,f,m,h):RX(p,f,h):MX(p,f,m,h);return h?(this.bitmap=g,this.nodes=y,this):new Zv(t,g,y)};var H0=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};H0.prototype.get=function(t,r,n,a){r===void 0&&(r=lo(n));var i=(t===0?r:r>>>t)&Ai,o=this.nodes[i];return o?o.get(t+Cn,r,n,a):a};H0.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=lo(a));var u=(r===0?n:n>>>r)&Ai,l=i===Nr,c=this.nodes,d=c[u];if(l&&!d)return this;var f=YT(d,t,r+Cn,n,a,i,o,s);if(f===d)return this;var p=this.count;if(!d)p++;else if(!f&&(p--,p<kX))return IX(t,c,p,u);var v=t&&t===this.ownerID,m=d8(c,u,f,v);return v?(this.count=p,this.nodes=m,this):new H0(t,p,m)};var $v=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};$v.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(fo(n,i[o][0]))return i[o][1];return a};$v.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=lo(a));var u=i===Nr;if(n!==this.keyHash)return u?this:(Xo(s),Xo(o),KT(this,t,r,n,[a,i]));for(var l=this.entries,c=0,d=l.length;c<d&&!fo(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:u)return this;if(Xo(s),(u||!f)&&Xo(o),u&&d===2)return new Tl(t,this.keyHash,l[c^1]);var p=t&&t===this.ownerID,v=p?l:mu(l);return f?u?c===d-1?v.pop():v[c]=v.pop():v[c]=[a,i]:v.push([a,i]),p?(this.entries=v,this):new $v(t,this.keyHash,v)};var Tl=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};Tl.prototype.get=function(t,r,n,a){return fo(n,this.entry[0])?this.entry[1]:a};Tl.prototype.update=function(t,r,n,a,i,o,s){var u=i===Nr,l=fo(a,this.entry[0]);if(l?i===this.entry[1]:u)return this;if(Xo(s),u){Xo(o);return}return l?t&&t===this.ownerID?(this.entry[1]=i,this):new Tl(t,this.keyHash,[a,i]):(Xo(o),KT(this,t,r,lo(a),[a,i]))};V0.prototype.iterate=$v.prototype.iterate=function(e,t){for(var r=this.entries,n=0,a=r.length-1;n<=a;n++)if(e(r[t?a-n:n])===!1)return!1};Zv.prototype.iterate=H0.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,a=r.length-1;n<=a;n++){var i=r[t?a-n:n];if(i&&i.iterate(e,t)===!1)return!1}};Tl.prototype.iterate=function(e,t){return e(this.entry)};var PX=function(e){function t(r,n,a){this._type=n,this._reverse=a,this._stack=r._root&&jI(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,a=this._stack;a;){var i=a.node,o=a.index++,s=void 0;if(i.entry){if(o===0)return sC(n,i.entry)}else if(i.entries){if(s=i.entries.length-1,o<=s)return sC(n,i.entries[this._reverse?s-o:o])}else if(s=i.nodes.length-1,o<=s){var u=i.nodes[this._reverse?s-o:o];if(u){if(u.entry)return sC(n,u.entry);a=this._stack=jI(u,a)}continue}a=this._stack=this._stack.__prev}return Zi()},t}(en);function sC(e,t){return Bn(e,t[0],t[1])}function jI(e,t){return{node:e,index:0,__prev:t}}function XT(e,t,r,n){var a=Object.create(Tn);return a.size=e,a._root=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var WI;function Ds(){return WI||(WI=XT(0))}function XI(e,t,r){var n,a;if(e._root){var i=v_(),o=v_();if(n=YT(e._root,e.__ownerID,0,void 0,t,r,i,o),!o.value)return e;a=e.size+(i.value?r===Nr?-1:1:0)}else{if(r===Nr)return e;a=1,n=new V0(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=a,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?XT(a,n):Ds()}function YT(e,t,r,n,a,i,o,s){return e?e.update(t,r,n,a,i,o,s):i===Nr?e:(Xo(s),Xo(o),new Tl(t,n,[a,i]))}function YI(e){return e.constructor===Tl||e.constructor===$v}function KT(e,t,r,n,a){if(e.keyHash===n)return new $v(t,n,[e.entry,a]);var i=(r===0?e.keyHash:e.keyHash>>>r)&Ai,o=(r===0?n:n>>>r)&Ai,s,u=i===o?[KT(e,t,r+Cn,n,a)]:(s=new Tl(t,n,a),i<o?[e,s]:[s,e]);return new Zv(t,1<<i|1<<o,u)}function EX(e,t,r,n){e||(e=new OT);for(var a=new Tl(e,lo(r),[r,n]),i=0;i<t.length;i++){var o=t[i];a=a.update(e,0,void 0,o[0],o[1])}return a}function IX(e,t,r,n){for(var a=0,i=0,o=new Array(r),s=0,u=1,l=t.length;s<l;s++,u<<=1){var c=t[s];c!==void 0&&s!==n&&(a|=u,o[i++]=c)}return new Zv(e,a,o)}function DX(e,t,r,n,a){for(var i=0,o=new Array(Wo),s=0;r!==0;s++,r>>>=1)o[s]=r&1?t[i++]:void 0;return o[n]=a,new H0(e,i+1,o)}function c8(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function d8(e,t,r,n){var a=n?e:mu(e);return a[t]=r,a}function MX(e,t,r,n){var a=e.length+1;if(n&&t+1===a)return e[t]=r,e;for(var i=new Array(a),o=0,s=0;s<a;s++)s===t?(i[s]=r,o=-1):i[s]=e[s+o];return i}function RX(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var a=new Array(n),i=0,o=0;o<n;o++)o===t&&(i=1),a[o]=e[o+i];return a}var OX=Wo/4,BX=Wo/2,kX=Wo/4,f8="@@__IMMUTABLE_LIST__@@";function p8(e){return Boolean(e&&e[f8])}var Ef=function(e){function t(r){var n=D1();if(r==null)return n;if(p8(r))return r;var a=e(r),i=a.size;return i===0?n:(Yo(i),i>0&&i<Wo?G0(0,i,Cn,null,new sd(a.toArray())):n.withMutations(function(o){o.setSize(i),a.forEach(function(s,u){return o.set(u,s)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,a){if(n=Sd(this,n),n>=0&&n<this.size){n+=this._origin;var i=v8(this,n);return i&&i.array[n&Ai]}return a},t.prototype.set=function(n,a){return LX(this,n,a)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,a){return this.splice(n,0,a)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Cn,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):D1()},t.prototype.push=function(){var n=arguments,a=this.size;return this.withMutations(function(i){Ic(i,0,a+n.length);for(var o=0;o<n.length;o++)i.set(a+o,n[o])})},t.prototype.pop=function(){return Ic(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(a){Ic(a,-n.length);for(var i=0;i<n.length;i++)a.set(i,n[i])})},t.prototype.shift=function(){return Ic(this,1)},t.prototype.concat=function(){for(var n=arguments,a=[],i=0;i<arguments.length;i++){var o=n[i],s=e(typeof o!="string"&&kF(o)?o:[o]);s.size!==0&&a.push(s)}return a.length===0?this:this.size===0&&!this.__ownerID&&a.length===1?this.constructor(a[0]):this.withMutations(function(u){a.forEach(function(l){return l.forEach(function(c){return u.push(c)})})})},t.prototype.setSize=function(n){return Ic(this,0,n)},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){for(var s=0;s<i.size;s++)o.set(s,n.call(a,o.get(s),s,i))})},t.prototype.slice=function(n,a){var i=this.size;return Z2(n,a,i)?this:Ic(this,yg(n,i),$2(a,i))},t.prototype.__iterator=function(n,a){var i=a?this.size:0,o=KI(this,a);return new en(function(){var s=o();return s===u0?Zi():Bn(n,a?--i:i++,s)})},t.prototype.__iterate=function(n,a){for(var i=a?this.size:0,o=KI(this,a),s;(s=o())!==u0&&n(s,a?--i:i++,this)!==!1;);return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?G0(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?D1():(this.__ownerID=n,this.__altered=!1,this)},t}(cp);Ef.isList=p8;var da=Ef.prototype;da[f8]=!0;da[Q2]=da.remove;da.merge=da.concat;da.setIn=r8;da.deleteIn=da.removeIn=n8;da.update=i8;da.updateIn=o8;da.mergeIn=u8;da.mergeDeepIn=l8;da.withMutations=nS;da.wasAltered=WT;da.asImmutable=iS;da["@@transducer/init"]=da.asMutable=aS;da["@@transducer/step"]=function(e,t){return e.push(t)};da["@@transducer/result"]=function(e){return e.asImmutable()};var sd=function(t,r){this.array=t,this.ownerID=r};sd.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:this.array.length===0)return this;var a=n>>>r&Ai;if(a>=this.array.length)return new sd([],t);var i=a===0,o;if(r>0){var s=this.array[a];if(o=s&&s.removeBefore(t,r-Cn,n),o===s&&i)return this}if(i&&!o)return this;var u=Jv(this,t);if(!i)for(var l=0;l<a;l++)u.array[l]=void 0;return o&&(u.array[a]=o),u};sd.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||this.array.length===0)return this;var a=n-1>>>r&Ai;if(a>=this.array.length)return this;var i;if(r>0){var o=this.array[a];if(i=o&&o.removeAfter(t,r-Cn,n),i===o&&a===this.array.length-1)return this}var s=Jv(this,t);return s.array.splice(a+1),i&&(s.array[a]=i),s};var u0={};function KI(e,t){var r=e._origin,n=e._capacity,a=q0(n),i=e._tail;return o(e._root,e._level,0);function o(l,c,d){return c===0?s(l,d):u(l,c,d)}function s(l,c){var d=c===a?i&&i.array:l&&l.array,f=c>r?0:r-c,p=n-c;return p>Wo&&(p=Wo),function(){if(f===p)return u0;var v=t?--p:f++;return d&&d[v]}}function u(l,c,d){var f,p=l&&l.array,v=d>r?0:r-d>>c,m=(n-d>>c)+1;return m>Wo&&(m=Wo),function(){for(;;){if(f){var h=f();if(h!==u0)return h;f=null}if(v===m)return u0;var g=t?--m:v++;f=o(p&&p[g],c-Cn,d+(g<<c))}}}}function G0(e,t,r,n,a,i,o){var s=Object.create(da);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=a,s.__ownerID=i,s.__hash=o,s.__altered=!1,s}var QI;function D1(){return QI||(QI=G0(0,0,Cn))}function LX(e,t,r){if(t=Sd(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(o){t<0?Ic(o,t).set(0,r):Ic(o,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,a=e._root,i=v_();return t>=q0(e._capacity)?n=S_(n,e.__ownerID,0,t,r,i):a=S_(a,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=a,e._tail=n,e.__hash=void 0,e.__altered=!0,e):G0(e._origin,e._capacity,e._level,a,n):e}function S_(e,t,r,n,a,i){var o=n>>>r&Ai,s=e&&o<e.array.length;if(!s&&a===void 0)return e;var u;if(r>0){var l=e&&e.array[o],c=S_(l,t,r-Cn,n,a,i);return c===l?e:(u=Jv(e,t),u.array[o]=c,u)}return s&&e.array[o]===a?e:(i&&Xo(i),u=Jv(e,t),a===void 0&&o===u.array.length-1?u.array.pop():u.array[o]=a,u)}function Jv(e,t){return t&&e&&t===e.ownerID?e:new sd(e?e.array.slice():[],t)}function v8(e,t){if(t>=q0(e._capacity))return e._tail;if(t<1<<e._level+Cn){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&Ai],n-=Cn;return r}}function Ic(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new OT,a=e._origin,i=e._capacity,o=a+t,s=r===void 0?i:r<0?i+r:a+r;if(o===a&&s===i)return e;if(o>=s)return e.clear();for(var u=e._level,l=e._root,c=0;o+c<0;)l=new sd(l&&l.array.length?[void 0,l]:[],n),u+=Cn,c+=1<<u;c&&(o+=c,a+=c,s+=c,i+=c);for(var d=q0(i),f=q0(s);f>=1<<u+Cn;)l=new sd(l&&l.array.length?[l]:[],n),u+=Cn;var p=e._tail,v=f<d?v8(e,s-1):f>d?new sd([],n):p;if(p&&f>d&&o<i&&p.array.length){l=Jv(l,n);for(var m=l,h=u;h>Cn;h-=Cn){var g=d>>>h&Ai;m=m.array[g]=Jv(m.array[g],n)}m.array[d>>>Cn&Ai]=p}if(s<i&&(v=v&&v.removeAfter(n,0,s)),o>=f)o-=f,s-=f,u=Cn,l=null,v=v&&v.removeBefore(n,0,o);else if(o>a||f<d){for(c=0;l;){var y=o>>>u&Ai;if(y!==f>>>u&Ai)break;y&&(c+=(1<<u)*y),u-=Cn,l=l.array[y]}l&&o>a&&(l=l.removeBefore(n,u,o-c)),l&&f<d&&(l=l.removeAfter(n,u,f-c)),c&&(o-=c,s-=c)}return e.__ownerID?(e.size=s-o,e._origin=o,e._capacity=s,e._level=u,e._root=l,e._tail=v,e.__hash=void 0,e.__altered=!0,e):G0(o,s,u,l,v)}function q0(e){return e<Wo?0:e-1>>>Cn<<Cn}var ci=function(e){function t(r){return r==null?Lh():zF(r)?r:Lh().withMutations(function(n){var a=Zs(r);Yo(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,a){var i=this._map.get(n);return i!==void 0?this._list.get(i)[1]:a},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Lh()},t.prototype.set=function(n,a){return $I(this,n,a)},t.prototype.remove=function(n){return $I(this,n,Nr)},t.prototype.__iterate=function(n,a){var i=this;return this._list.__iterate(function(o){return o&&n(o[1],o[0],i)},a)},t.prototype.__iterator=function(n,a){return this._list.fromEntrySeq().__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?QT(a,i,n,this.__hash):this.size===0?Lh():(this.__ownerID=n,this.__altered=!1,this._map=a,this._list=i,this)},t}(Go);ci.isOrderedMap=zF;ci.prototype[Cm]=!0;ci.prototype[Q2]=ci.prototype.remove;function QT(e,t,r,n){var a=Object.create(ci.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var ZI;function Lh(){return ZI||(ZI=QT(Ds(),D1()))}function $I(e,t,r){var n=e._map,a=e._list,i=n.get(t),o=i!==void 0,s,u;if(r===Nr){if(!o)return e;a.size>=Wo&&a.size>=n.size*2?(u=a.filter(function(l,c){return l!==void 0&&i!==c}),s=u.toKeyedSeq().map(function(l){return l[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=u.__ownerID=e.__ownerID)):(s=n.remove(t),u=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(r===a.get(i)[1])return e;s=n,u=a.set(i,[t,r])}else s=n.set(t,a.size),u=a.set(a.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=u,e.__hash=void 0,e.__altered=!0,e):QT(s,u)}var m8="@@__IMMUTABLE_STACK__@@";function x_(e){return Boolean(e&&e[m8])}var ZT=function(e){function t(r){return r==null?uy():x_(r)?r:uy().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,a){var i=this._head;for(n=Sd(this,n);i&&n--;)i=i.next;return i?i.value:a},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:n[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):Fh(a,i)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&x_(n))return n;Yo(n.size);var a=this.size,i=this._head;return n.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):Fh(a,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):uy()},t.prototype.slice=function(n,a){if(Z2(n,a,this.size))return this;var i=yg(n,this.size),o=$2(a,this.size);if(o!==this.size)return e.prototype.slice.call(this,n,a);for(var s=this.size-i,u=this._head;i--;)u=u.next;return this.__ownerID?(this.size=s,this._head=u,this.__hash=void 0,this.__altered=!0,this):Fh(s,u)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Fh(this.size,this._head,n,this.__hash):this.size===0?uy():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,a){var i=this;if(a)return new Hf(this.toArray()).__iterate(function(u,l){return n(u,l,i)},a);for(var o=0,s=this._head;s&&n(s.value,o++,this)!==!1;)s=s.next;return o},t.prototype.__iterator=function(n,a){if(a)return new Hf(this.toArray()).__iterator(n,a);var i=0,o=this._head;return new en(function(){if(o){var s=o.value;return o=o.next,Bn(n,i++,s)}return Zi()})},t}(cp);ZT.isStack=x_;var Mi=ZT.prototype;Mi[m8]=!0;Mi.shift=Mi.pop;Mi.unshift=Mi.push;Mi.unshiftAll=Mi.pushAll;Mi.withMutations=nS;Mi.wasAltered=WT;Mi.asImmutable=iS;Mi["@@transducer/init"]=Mi.asMutable=aS;Mi["@@transducer/step"]=function(e,t){return e.unshift(t)};Mi["@@transducer/result"]=function(e){return e.asImmutable()};function Fh(e,t,r,n){var a=Object.create(Mi);return a.size=e,a._head=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var JI;function uy(){return JI||(JI=Fh(0))}var h8="@@__IMMUTABLE_SET__@@";function $T(e){return Boolean(e&&e[h8])}function g8(e){return $T(e)&&ks(e)}function y8(e,t){if(e===t)return!0;if(!Qi(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||zn(e)!==zn(t)||Yi(e)!==Yi(t)||ks(e)!==ks(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!J2(e);if(ks(e)){var n=e.entries();return t.every(function(u,l){var c=n.next().value;return c&&fo(c[1],u)&&(r||fo(c[0],l))})&&n.next().done}var a=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{a=!0;var i=e;e=t,t=i}var o=!0,s=t.__iterate(function(u,l){if(r?!e.has(u):a?!fo(u,e.get(l,Nr)):!fo(e.get(l,Nr),u))return o=!1,!1});return o&&e.size===s}function dp(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function C_(e){if(!e||typeof e!="object")return e;if(!Qi(e)){if(!xd(e))return e;e=yo(e)}if(zn(e)){var t={};return e.__iterate(function(n,a){t[a]=C_(n)}),t}var r=[];return e.__iterate(function(n){r.push(C_(n))}),r}var oS=function(e){function t(r){return r==null?Nh():$T(r)&&!ks(r)?r:Nh().withMutations(function(n){var a=e(r);Yo(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Zs(n).keySeq())},t.intersect=function(n){return n=Jn(n).toArray(),n.length?ja.intersect.apply(t(n.pop()),n):Nh()},t.union=function(n){return n=Jn(n).toArray(),n.length?ja.union.apply(t(n.pop()),n):Nh()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return ly(this,this._map.set(n,n))},t.prototype.remove=function(n){return ly(this,this._map.remove(n))},t.prototype.clear=function(){return ly(this,this._map.clear())},t.prototype.map=function(n,a){var i=this,o=!1,s=ly(this,this._map.mapEntries(function(u){var l=u[1],c=n.call(a,l,l,i);return c!==l&&(o=!0),[c,c]},a));return o?s:this},t.prototype.union=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return n=n.filter(function(i){return i.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(i){for(var o=0;o<n.length;o++)e(n[o]).forEach(function(s){return i.add(s)})})},t.prototype.intersect=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(n.length===0)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.every(function(s){return s.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.subtract=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(n.length===0)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.some(function(s){return s.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.sort=function(n){return Ls(Qv(this,n))},t.prototype.sortBy=function(n,a){return Ls(Qv(this,a,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,a){var i=this;return this._map.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){return this._map.__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n);return n?this.__make(a,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=a,this)},t}(xm);oS.isSet=$T;var ja=oS.prototype;ja[h8]=!0;ja[Q2]=ja.remove;ja.merge=ja.concat=ja.union;ja.withMutations=nS;ja.asImmutable=iS;ja["@@transducer/init"]=ja.asMutable=aS;ja["@@transducer/step"]=function(e,t){return e.add(t)};ja["@@transducer/result"]=function(e){return e.asImmutable()};ja.__empty=Nh;ja.__make=b8;function ly(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function b8(e,t){var r=Object.create(ja);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var eD;function Nh(){return eD||(eD=b8(Ds()))}var FX=function(e){function t(r,n,a){if(!(this instanceof t))return new t(r,n,a);if($F(a!==0,"Cannot step a Range by 0"),r=r||0,n===void 0&&(n=1/0),a=a===void 0?1:Math.abs(a),n<r&&(a=-a),this._start=r,this._end=n,this._step=a,this.size=Math.max(0,Math.ceil((n-r)/a-1)+1),this.size===0){if(uC)return uC;uC=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,a){return this.has(n)?this._start+Sd(this,n)*this._step:a},t.prototype.includes=function(n){var a=(n-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},t.prototype.slice=function(n,a){return Z2(n,a,this.size)?this:(n=yg(n,this.size),a=$2(a,this.size),a<=n?new t(0,0):new t(this.get(n,this._end),this.get(a,this._end),this._step))},t.prototype.indexOf=function(n){var a=n-this._start;if(a%this._step===0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,a){for(var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;u!==i&&n(s,a?i-++u:u++,this)!==!1;)s+=a?-o:o;return u},t.prototype.__iterator=function(n,a){var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;return new en(function(){if(u===i)return Zi();var l=s;return s+=a?-o:o,Bn(n,a?i-++u:u++,l)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:y8(this,n)},t}($s),uC;function S8(e,t,r){for(var n=JF(t),a=0;a!==n.length;)if(e=e8(e,n[a++],Nr),e===Nr)return r;return e}function NX(e,t){return S8(this,e,t)}function UX(e,t){return S8(e,t,Nr)!==Nr}function zX(e){return UX(this,e)}function x8(){Yo(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}Jn.isIterable=Qi;Jn.isKeyed=zn;Jn.isIndexed=Yi;Jn.isAssociative=J2;Jn.isOrdered=ks;Jn.Iterator=en;dp(Jn,{toArray:function(){Yo(this.size);var t=new Array(this.size||0),r=zn(this),n=0;return this.__iterate(function(a,i){t[n++]=r?[i,a]:a}),t},toIndexedSeq:function(){return new HF(this)},toJS:function(){return C_(this)},toKeyedSeq:function(){return new rS(this,!0)},toMap:function(){return Go(this.toKeyedSeq())},toObject:x8,toOrderedMap:function(){return ci(this.toKeyedSeq())},toOrderedSet:function(){return Ls(zn(this)?this.valueSeq():this)},toSet:function(){return oS(zn(this)?this.valueSeq():this)},toSetSeq:function(){return new GF(this)},toSeq:function(){return Yi(this)?this.toIndexedSeq():zn(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return ZT(zn(this)?this.valueSeq():this)},toList:function(){return Ef(zn(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return hn(this,dX(this,t))},includes:function(t){return this.some(function(r){return fo(r,t)})},entries:function(){return this.__iterator(Ws)},every:function(t,r){Yo(this.size);var n=!0;return this.__iterate(function(a,i,o){if(!t.call(r,a,i,o))return n=!1,!1}),n},filter:function(t,r){return hn(this,XF(this,t,r,!0))},find:function(t,r,n){var a=this.findEntry(t,r);return a?a[1]:n},forEach:function(t,r){return Yo(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){Yo(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(a){n?n=!1:r+=t,r+=a!=null?a.toString():""}),r},keys:function(){return this.__iterator(bg)},map:function(t,r){return hn(this,WF(this,t,r))},reduce:function(t,r,n){return tD(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return tD(this,t,r,n,arguments.length<2,!0)},reverse:function(){return hn(this,VT(this,!0))},slice:function(t,r){return hn(this,HT(this,t,r,!0))},some:function(t,r){return!this.every(cy(t),r)},sort:function(t){return hn(this,Qv(this,t))},values:function(){return this.__iterator(js)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return Kv(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return uX(this,t,r)},equals:function(t){return y8(this,t)},entrySeq:function(){var t=this;if(t._cache)return new Hf(t._cache);var r=t.toSeq().map(HX).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(cy(t),r)},findEntry:function(t,r,n){var a=n;return this.__iterate(function(i,o,s){if(t.call(r,i,o,s))return a=[o,i],!1}),a},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(PF,null,t)},flatMap:function(t,r){return hn(this,fX(this,t,r))},flatten:function(t){return hn(this,KF(this,t,!0))},fromEntrySeq:function(){return new qF(this)},get:function(t,r){return this.find(function(n,a){return fo(a,t)},void 0,r)},getIn:NX,groupBy:function(t,r){return lX(this,t,r)},has:function(t){return this.get(t,Nr)!==Nr},hasIn:zX,isSubset:function(t){return t=typeof t.includes=="function"?t:Jn(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:Jn(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return fo(r,t)})},keySeq:function(){return this.toSeq().map(VX).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return oy(this,t)},maxBy:function(t,r){return oy(this,r,t)},min:function(t){return oy(this,t?rD(t):aD)},minBy:function(t,r){return oy(this,r?rD(r):aD,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return hn(this,YF(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(cy(t),r)},sortBy:function(t,r){return hn(this,Qv(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return hn(this,cX(this,t,r))},takeUntil:function(t,r){return this.takeWhile(cy(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=GX(this))}});var $i=Jn.prototype;$i[DF]=!0;$i[LT]=$i.values;$i.toJSON=$i.toArray;$i.__toStringMapper=mb;$i.inspect=$i.toSource=function(){return this.toString()};$i.chain=$i.flatMap;$i.contains=$i.includes;dp(Zs,{flip:function(){return hn(this,jF(this))},mapEntries:function(t,r){var n=this,a=0;return hn(this,this.toSeq().map(function(i,o){return t.call(r,[o,i],a++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return hn(this,this.toSeq().flip().map(function(a,i){return t.call(r,a,i,n)}).flip())}});var Sg=Zs.prototype;Sg[MF]=!0;Sg[LT]=$i.entries;Sg.toJSON=x8;Sg.__toStringMapper=function(e,t){return mb(t)+": "+mb(e)};dp(cp,{toKeyedSeq:function(){return new rS(this,!1)},filter:function(t,r){return hn(this,XF(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return hn(this,VT(this,!1))},slice:function(t,r){return hn(this,HT(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=yg(t,t<0?this.count():this.size);var a=this.slice(0,t);return hn(this,n===1?a:a.concat(mu(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return hn(this,KF(this,t,!1))},get:function(t,r){return t=Sd(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,a){return a===t},void 0,r)},has:function(t){return t=Sd(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return hn(this,pX(this,t))},interleave:function(){var t=[this].concat(mu(arguments)),r=sy(this.toSeq(),$s.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),hn(this,n)},keySeq:function(){return FX(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return hn(this,YF(this,t,r,!1))},zip:function(){var t=[this].concat(mu(arguments));return hn(this,sy(this,nD,t))},zipAll:function(){var t=[this].concat(mu(arguments));return hn(this,sy(this,nD,t,!0))},zipWith:function(t){var r=mu(arguments);return r[0]=this,hn(this,sy(this,t,r))}});var Tm=cp.prototype;Tm[RF]=!0;Tm[Cm]=!0;dp(xm,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var em=xm.prototype;em.has=$i.includes;em.contains=em.includes;em.keys=em.values;dp(Ld,Sg);dp($s,Tm);dp(_m,em);function tD(e,t,r,n,a,i){return Yo(e.size),e.__iterate(function(o,s,u){a?(a=!1,r=o):r=t.call(n,r,o,s,u)},i),r}function VX(e,t){return t}function HX(e,t){return[t,e]}function cy(e){return function(){return!e.apply(this,arguments)}}function rD(e){return function(){return-e.apply(this,arguments)}}function nD(){return mu(arguments)}function aD(e,t){return e<t?1:e>t?-1:0}function GX(e){if(e.size===1/0)return 0;var t=ks(e),r=zn(e),n=t?1:0,a=e.__iterate(r?t?function(i,o){n=31*n+iD(lo(i),lo(o))|0}:function(i,o){n=n+iD(lo(i),lo(o))|0}:t?function(i){n=31*n+lo(i)|0}:function(i){n=n+lo(i)|0});return qX(a,n)}function qX(e,t){return t=ih(t,3432918353),t=ih(t<<15|t>>>-15,461845907),t=ih(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=ih(t^t>>>16,2246822507),t=ih(t^t>>>13,3266489909),t=tS(t^t>>>16),t}function iD(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var Ls=function(e){function t(r){return r==null?w_():g8(r)?r:w_().withMutations(function(n){var a=xm(r);Yo(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Zs(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(oS);Ls.isOrderedSet=g8;var fp=Ls.prototype;fp[Cm]=!0;fp.zip=Tm.zip;fp.zipWith=Tm.zipWith;fp.zipAll=Tm.zipAll;fp.__empty=w_;fp.__make=C8;function C8(e,t){var r=Object.create(fp);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var oD;function w_(){return oD||(oD=C8(Lh()))}var zr=1e-6;function tn(e,t,r){return Math.abs(e-t)<=r}var l0=Math.PI/2,w8=Math.PI/180;function wr(e){return e*w8}function Fs(e){return e/w8}function jX(e){return e!==0&&(e&e-1)===0}function WX(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function _8(e,t){return e*t}function XX(e){for(var t,r=0,n=0,a=[0,-1],i=e*2+1,o=i/2,s=[],u=Math.pow(i,2);u>0;--u)-o<r&&r<=o&&-o<n&&n<=o&&s.push([r,n]),(r===n||r<0&&r===-n||r>0&&r===1-n)&&(t=[-a[1],a[0]],a[0]=t[0],a[1]=t[1]),r+=a[0],n+=a[1];return s}function oe(){return oe.zero()}(function(e){function t(){var O=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return O[0]=0,O}e.zero=t;function r(){var O=t();return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.identity=r;function n(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.setIdentity=n;function a(O){for(var z=0;z<16;z++)O[z]=0;return O}e.setZero=a;function i(O){for(var z=t(),de=0;de<4;de++)for(var me=O[de],ye=0;ye<4;ye++)z[4*ye+de]=me[ye];return z}e.ofRows=i;var o=r();function s(O,z){return l(O,o,typeof z=="undefined"?zr:z)}e.isIdentity=s;function u(O){for(var z=0;z<16;z++)if(isNaN(O[z]))return!0;return!1}e.hasNaN=u;function l(O,z,de){for(var me=0;me<16;me++)if(Math.abs(O[me]-z[me])>de)return!1;return!0}e.areEqual=l;function c(O,z,de,me){O[4*de+z]=me}e.setValue=c;function d(O,z,de){return O[4*de+z]}e.getValue=d;function f(O,z,de){return z[de+0]=O[0],z[de+1]=O[1],z[de+2]=O[2],z[de+3]=O[3],z[de+4]=O[4],z[de+5]=O[5],z[de+6]=O[6],z[de+7]=O[7],z[de+8]=O[8],z[de+9]=O[9],z[de+10]=O[10],z[de+11]=O[11],z[de+12]=O[12],z[de+13]=O[13],z[de+14]=O[14],z[de+15]=O[15],z}e.toArray=f;function p(O,z,de){return O[0]=z[de+0],O[1]=z[de+1],O[2]=z[de+2],O[3]=z[de+3],O[4]=z[de+4],O[5]=z[de+5],O[6]=z[de+6],O[7]=z[de+7],O[8]=z[de+8],O[9]=z[de+9],O[10]=z[de+10],O[11]=z[de+11],O[12]=z[de+12],O[13]=z[de+13],O[14]=z[de+14],O[15]=z[de+15],O}e.fromArray=p;function v(O,z,de,me){return a(O),c(O,0,0,z[0]),c(O,1,0,z[1]),c(O,2,0,z[2]),c(O,0,1,de[0]),c(O,1,1,de[1]),c(O,2,1,de[2]),c(O,0,2,me[0]),c(O,1,2,me[1]),c(O,2,2,me[2]),c(O,3,3,1),O}e.fromBasis=v;function m(O,z){return O[0]=z[0],O[1]=z[1],O[2]=z[2],O[3]=z[3],O[4]=z[4],O[5]=z[5],O[6]=z[6],O[7]=z[7],O[8]=z[8],O[9]=z[9],O[10]=z[10],O[11]=z[11],O[12]=z[12],O[13]=z[13],O[14]=z[14],O[15]=z[15],O}e.copy=m;function h(O){return m(t(),O)}e.clone=h;function g(O,z){return O[0]=z[12],O[1]=z[13],O[2]=z[14],O}e.getTranslation=g;function y(O,z){var de=z[0],me=z[1],ye=z[2],Te=z[4],Oe=z[5],Ue=z[6],Qe=z[8],Ge=z[9],Je=z[10];return O[0]=Math.sqrt(de*de+me*me+ye*ye),O[1]=Math.sqrt(Te*Te+Oe*Oe+Ue*Ue),O[2]=Math.sqrt(Qe*Qe+Ge*Ge+Je*Je),O}e.getScaling=y;function b(O,z){var de=z[0]+z[5]+z[10],me=0;return de>0?(me=Math.sqrt(de+1)*2,O[3]=.25*me,O[0]=(z[6]-z[9])/me,O[1]=(z[8]-z[2])/me,O[2]=(z[1]-z[4])/me):z[0]>z[5]&&z[0]>z[10]?(me=Math.sqrt(1+z[0]-z[5]-z[10])*2,O[3]=(z[6]-z[9])/me,O[0]=.25*me,O[1]=(z[1]+z[4])/me,O[2]=(z[8]+z[2])/me):z[5]>z[10]?(me=Math.sqrt(1+z[5]-z[0]-z[10])*2,O[3]=(z[8]-z[2])/me,O[0]=(z[1]+z[4])/me,O[1]=.25*me,O[2]=(z[6]+z[9])/me):(me=Math.sqrt(1+z[10]-z[0]-z[5])*2,O[3]=(z[1]-z[4])/me,O[0]=(z[8]+z[2])/me,O[1]=(z[6]+z[9])/me,O[2]=.25*me),O}e.getRotation=b;function S(O,z){var de=1/Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),me=1/Math.sqrt(z[4]*z[4]+z[5]*z[5]+z[6]*z[6]),ye=1/Math.sqrt(z[8]*z[8]+z[9]*z[9]+z[10]*z[10]);return O[0]=z[0]*de,O[1]=z[1]*de,O[2]=z[2]*de,O[3]=0,O[4]=z[4]*me,O[5]=z[5]*me,O[6]=z[6]*me,O[7]=0,O[8]=z[8]*ye,O[9]=z[9]*ye,O[10]=z[10]*ye,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.extractRotation=S;function C(O,z){if(O===z){var de=z[1],me=z[2],ye=z[3],Te=z[6],Oe=z[7],Ue=z[11];O[1]=z[4],O[2]=z[8],O[3]=z[12],O[4]=de,O[6]=z[9],O[7]=z[13],O[8]=me,O[9]=Te,O[11]=z[14],O[12]=ye,O[13]=Oe,O[14]=Ue}else O[0]=z[0],O[1]=z[4],O[2]=z[8],O[3]=z[12],O[4]=z[1],O[5]=z[5],O[6]=z[9],O[7]=z[13],O[8]=z[2],O[9]=z[6],O[10]=z[10],O[11]=z[14],O[12]=z[3],O[13]=z[7],O[14]=z[11],O[15]=z[15];return O}e.transpose=C;function x(O,z){var de=z[0],me=z[1],ye=z[2],Te=z[3],Oe=z[4],Ue=z[5],Qe=z[6],Ge=z[7],Je=z[8],Ze=z[9],rt=z[10],et=z[11],St=z[12],De=z[13],Ie=z[14],je=z[15],st=de*Ue-me*Oe,pt=de*Qe-ye*Oe,qe=de*Ge-Te*Oe,bt=me*Qe-ye*Ue,yt=me*Ge-Te*Ue,Dt=ye*Ge-Te*Qe,ee=Je*De-Ze*St,pe=Je*Ie-rt*St,we=Je*je-et*St,Xe=Ze*Ie-rt*De,dt=Ze*je-et*De,vt=rt*je-et*Ie,Et=st*vt-pt*dt+qe*Xe+bt*we-yt*pe+Dt*ee;return Et?(Et=1/Et,O[0]=(Ue*vt-Qe*dt+Ge*Xe)*Et,O[1]=(ye*dt-me*vt-Te*Xe)*Et,O[2]=(De*Dt-Ie*yt+je*bt)*Et,O[3]=(rt*yt-Ze*Dt-et*bt)*Et,O[4]=(Qe*we-Oe*vt-Ge*pe)*Et,O[5]=(de*vt-ye*we+Te*pe)*Et,O[6]=(Ie*qe-St*Dt-je*pt)*Et,O[7]=(Je*Dt-rt*qe+et*pt)*Et,O[8]=(Oe*dt-Ue*we+Ge*ee)*Et,O[9]=(me*we-de*dt-Te*ee)*Et,O[10]=(St*yt-De*qe+je*st)*Et,O[11]=(Ze*qe-Je*yt-et*st)*Et,O[12]=(Ue*pe-Oe*Xe-Qe*ee)*Et,O[13]=(de*Xe-me*pe+ye*ee)*Et,O[14]=(De*pt-St*bt-Ie*st)*Et,O[15]=(Je*bt-Ze*pt+rt*st)*Et,!0):!1}e.tryInvert=x;function A(O,z){return x(O,z)||console.warn("non-invertible matrix.",z),O}e.invert=A;function P(O,z,de){var me=z[0],ye=z[1],Te=z[2],Oe=z[3],Ue=z[4],Qe=z[5],Ge=z[6],Je=z[7],Ze=z[8],rt=z[9],et=z[10],St=z[11],De=z[12],Ie=z[13],je=z[14],st=z[15],pt=de[0],qe=de[1],bt=de[2],yt=de[3];return O[0]=pt*me+qe*Ue+bt*Ze+yt*De,O[1]=pt*ye+qe*Qe+bt*rt+yt*Ie,O[2]=pt*Te+qe*Ge+bt*et+yt*je,O[3]=pt*Oe+qe*Je+bt*St+yt*st,pt=de[4],qe=de[5],bt=de[6],yt=de[7],O[4]=pt*me+qe*Ue+bt*Ze+yt*De,O[5]=pt*ye+qe*Qe+bt*rt+yt*Ie,O[6]=pt*Te+qe*Ge+bt*et+yt*je,O[7]=pt*Oe+qe*Je+bt*St+yt*st,pt=de[8],qe=de[9],bt=de[10],yt=de[11],O[8]=pt*me+qe*Ue+bt*Ze+yt*De,O[9]=pt*ye+qe*Qe+bt*rt+yt*Ie,O[10]=pt*Te+qe*Ge+bt*et+yt*je,O[11]=pt*Oe+qe*Je+bt*St+yt*st,pt=de[12],qe=de[13],bt=de[14],yt=de[15],O[12]=pt*me+qe*Ue+bt*Ze+yt*De,O[13]=pt*ye+qe*Qe+bt*rt+yt*Ie,O[14]=pt*Te+qe*Ge+bt*et+yt*je,O[15]=pt*Oe+qe*Je+bt*St+yt*st,O}e.mul=P;function T(O,z,de,me,ye,Te){var Oe=z[0+ye],Ue=z[1+ye],Qe=z[2+ye],Ge=z[3+ye],Je=z[4+ye],Ze=z[5+ye],rt=z[6+ye],et=z[7+ye],St=z[8+ye],De=z[9+ye],Ie=z[10+ye],je=z[11+ye],st=z[12+ye],pt=z[13+ye],qe=z[14+ye],bt=z[15+ye],yt=de[0+Te],Dt=de[1+Te],ee=de[2+Te],pe=de[3+Te];return O[0+me]=yt*Oe+Dt*Je+ee*St+pe*st,O[1+me]=yt*Ue+Dt*Ze+ee*De+pe*pt,O[2+me]=yt*Qe+Dt*rt+ee*Ie+pe*qe,O[3+me]=yt*Ge+Dt*et+ee*je+pe*bt,yt=de[4+Te],Dt=de[5+Te],ee=de[6+Te],pe=de[7+Te],O[4+me]=yt*Oe+Dt*Je+ee*St+pe*st,O[5+me]=yt*Ue+Dt*Ze+ee*De+pe*pt,O[6+me]=yt*Qe+Dt*rt+ee*Ie+pe*qe,O[7+me]=yt*Ge+Dt*et+ee*je+pe*bt,yt=de[8+Te],Dt=de[9+Te],ee=de[10+Te],pe=de[11+Te],O[8+me]=yt*Oe+Dt*Je+ee*St+pe*st,O[9+me]=yt*Ue+Dt*Ze+ee*De+pe*pt,O[10+me]=yt*Qe+Dt*rt+ee*Ie+pe*qe,O[11+me]=yt*Ge+Dt*et+ee*je+pe*bt,yt=de[12+Te],Dt=de[13+Te],ee=de[14+Te],pe=de[15+Te],O[12+me]=yt*Oe+Dt*Je+ee*St+pe*st,O[13+me]=yt*Ue+Dt*Ze+ee*De+pe*pt,O[14+me]=yt*Qe+Dt*rt+ee*Ie+pe*qe,O[15+me]=yt*Ge+Dt*et+ee*je+pe*bt,O}e.mulOffset=T;function D(O,z,de,me){return P(O,P(O,z,de),me)}e.mul3=D;function I(O,z,de){var me=de[0],ye=de[1],Te=de[2],Oe,Ue,Qe,Ge,Je,Ze,rt,et,St,De,Ie,je;return z===O?(O[12]=z[0]*me+z[4]*ye+z[8]*Te+z[12],O[13]=z[1]*me+z[5]*ye+z[9]*Te+z[13],O[14]=z[2]*me+z[6]*ye+z[10]*Te+z[14],O[15]=z[3]*me+z[7]*ye+z[11]*Te+z[15]):(Oe=z[0],Ue=z[1],Qe=z[2],Ge=z[3],Je=z[4],Ze=z[5],rt=z[6],et=z[7],St=z[8],De=z[9],Ie=z[10],je=z[11],O[0]=Oe,O[1]=Ue,O[2]=Qe,O[3]=Ge,O[4]=Je,O[5]=Ze,O[6]=rt,O[7]=et,O[8]=St,O[9]=De,O[10]=Ie,O[11]=je,O[12]=Oe*me+Je*ye+St*Te+z[12],O[13]=Ue*me+Ze*ye+De*Te+z[13],O[14]=Qe*me+rt*ye+Ie*Te+z[14],O[15]=Ge*me+et*ye+je*Te+z[15]),O}e.translate=I;function M(O,z){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=z[0],O[13]=z[1],O[14]=z[2],O[15]=1,O}e.fromTranslation=M;function B(O,z){return O[12]=z[0],O[13]=z[1],O[14]=z[2],O}e.setTranslation=B;function U(O,z,de,me){return O[0]=de[0],O[4]=de[1],O[8]=de[2],O[1]=me[0],O[5]=me[1],O[9]=me[2],O[2]=z[0],O[6]=z[1],O[10]=z[2],O}e.setAxes=U;function V(O,z,de,me){var ye=me[0],Te=me[1],Oe=me[2],Ue=Math.sqrt(ye*ye+Te*Te+Oe*Oe);if(Math.abs(Ue)<zr)return r();Ue=1/Ue,ye*=Ue,Te*=Ue,Oe*=Ue;var Qe=Math.sin(de),Ge=Math.cos(de),Je=1-Ge,Ze=z[0],rt=z[1],et=z[2],St=z[3],De=z[4],Ie=z[5],je=z[6],st=z[7],pt=z[8],qe=z[9],bt=z[10],yt=z[11],Dt=ye*ye*Je+Ge,ee=Te*ye*Je+Oe*Qe,pe=Oe*ye*Je-Te*Qe,we=ye*Te*Je-Oe*Qe,Xe=Te*Te*Je+Ge,dt=Oe*Te*Je+ye*Qe,vt=ye*Oe*Je+Te*Qe,Et=Te*Oe*Je-ye*Qe,_r=Oe*Oe*Je+Ge;return O[0]=Ze*Dt+De*ee+pt*pe,O[1]=rt*Dt+Ie*ee+qe*pe,O[2]=et*Dt+je*ee+bt*pe,O[3]=St*Dt+st*ee+yt*pe,O[4]=Ze*we+De*Xe+pt*dt,O[5]=rt*we+Ie*Xe+qe*dt,O[6]=et*we+je*Xe+bt*dt,O[7]=St*we+st*Xe+yt*dt,O[8]=Ze*vt+De*Et+pt*_r,O[9]=rt*vt+Ie*Et+qe*_r,O[10]=et*vt+je*Et+bt*_r,O[11]=St*vt+st*Et+yt*_r,z!==O&&(O[12]=z[12],O[13]=z[13],O[14]=z[14],O[15]=z[15]),O}e.rotate=V;function F(O,z,de){var me=de[0],ye=de[1],Te=de[2],Oe=Math.sqrt(me*me+ye*ye+Te*Te);if(Math.abs(Oe)<zr)return n(O);Oe=1/Oe,me*=Oe,ye*=Oe,Te*=Oe;var Ue=Math.sin(z),Qe=Math.cos(z),Ge=1-Qe;return O[0]=me*me*Ge+Qe,O[1]=ye*me*Ge+Te*Ue,O[2]=Te*me*Ge-ye*Ue,O[3]=0,O[4]=me*ye*Ge-Te*Ue,O[5]=ye*ye*Ge+Qe,O[6]=Te*ye*Ge+me*Ue,O[7]=0,O[8]=me*Te*Ge+ye*Ue,O[9]=ye*Te*Ge-me*Ue,O[10]=Te*Te*Ge+Qe,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromRotation=F;function Y(O,z,de){var me=de[0],ye=de[1],Te=de[2];return O[0]=z[0]*me,O[1]=z[1]*me,O[2]=z[2]*me,O[3]=z[3]*me,O[4]=z[4]*ye,O[5]=z[5]*ye,O[6]=z[6]*ye,O[7]=z[7]*ye,O[8]=z[8]*Te,O[9]=z[9]*Te,O[10]=z[10]*Te,O[11]=z[11]*Te,O[12]=z[12],O[13]=z[13],O[14]=z[14],O[15]=z[15],O}e.scale=Y;function W(O,z,de){return O[0]=z[0]*de,O[1]=z[1]*de,O[2]=z[2]*de,O[3]=z[3]*de,O[4]=z[4]*de,O[5]=z[5]*de,O[6]=z[6]*de,O[7]=z[7]*de,O[8]=z[8]*de,O[9]=z[9]*de,O[10]=z[10]*de,O[11]=z[11]*de,O[12]=z[12],O[13]=z[13],O[14]=z[14],O[15]=z[15],O}e.scaleUniformly=W;function K(O,z){return O[0]=z[0],O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=z[1],O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=z[2],O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromScaling=K;function $(O,z){return O[0]=z,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=z,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=z,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromUniformScaling=$;function J(O,z){return O[0]=z[0],O[1]=z[1],O[2]=z[2],O[4]=z[3],O[5]=z[4],O[6]=z[5],O[8]=z[6],O[9]=z[7],O[10]=z[8],O}e.fromMat3=J;function Z(O){for(var z="",de=0;de<4;de++){for(var me=0;me<4;me++)z+=O[4*me+de].toString(),me<3&&(z+=" ");de<3&&(z+=`
`)}return z}e.makeTable=Z;function N(O){var z=O[0],de=O[1],me=O[2],ye=O[3],Te=O[4],Oe=O[5],Ue=O[6],Qe=O[7],Ge=O[8],Je=O[9],Ze=O[10],rt=O[11],et=O[12],St=O[13],De=O[14],Ie=O[15],je=z*Oe-de*Te,st=z*Ue-me*Te,pt=z*Qe-ye*Te,qe=de*Ue-me*Oe,bt=de*Qe-ye*Oe,yt=me*Qe-ye*Ue,Dt=Ge*St-Je*et,ee=Ge*De-Ze*et,pe=Ge*Ie-rt*et,we=Je*De-Ze*St,Xe=Je*Ie-rt*St,dt=Ze*Ie-rt*De;return je*dt-st*Xe+pt*we+qe*pe-bt*ee+yt*Dt}e.determinant=N;function j(O,z){return L(O,typeof z!="undefined"?z:zr)}e.isRotationAndTranslation=j;function L(O,z){var de=O[0],me=O[1],ye=O[2],Te=O[3],Oe=O[4],Ue=O[5],Qe=O[6],Ge=O[7],Je=O[8],Ze=O[9],rt=O[10],et=O[11],St=O[15];if(!tn(St,1,z)||!tn(Te,0,z)||!tn(Ge,0,z)||!tn(et,0,z))return!1;var De=Math.abs(de*(Ue*rt-Qe*Ze)-me*(Oe*rt-Qe*Je)+ye*(Oe*Ze-Ue*Je));return!!tn(De,1,z)}function H(O,z){return G(O,typeof z!="undefined"?z:zr)}e.isTranslationAndUniformScaling=H;function G(O,z){var de=O[0];return tn(O[1],0,z)&&tn(O[2],0,z)&&tn(O[3],0,z)&&tn(O[4],0,z)&&tn(O[5],de,z)&&tn(O[6],0,z)&&tn(O[7],0,z)&&tn(O[8],0,z)&&tn(O[9],0,z)&&tn(O[10],de,z)&&tn(O[11],0,z)&&tn(O[15],1,z)}function q(O,z){var de=z[0],me=z[1],ye=z[2],Te=z[3],Oe=de+de,Ue=me+me,Qe=ye+ye,Ge=de*Oe,Je=me*Oe,Ze=me*Ue,rt=ye*Oe,et=ye*Ue,St=ye*Qe,De=Te*Oe,Ie=Te*Ue,je=Te*Qe;return O[0]=1-Ze-St,O[1]=Je+je,O[2]=rt-Ie,O[3]=0,O[4]=Je-je,O[5]=1-Ge-St,O[6]=et+De,O[7]=0,O[8]=rt+Ie,O[9]=et-De,O[10]=1-Ge-Ze,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromQuat=q;function X(O,z,de,me,ye,Te,Oe){var Ue=2*Te/(de-z),Qe=2*Te/(me-ye),Ge=(de+z)/(de-z),Je=(me+ye)/(me-ye),Ze=-(Oe+Te)/(Oe-Te),rt=-2*Oe*Te/(Oe-Te);return O[0]=Ue,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=Qe,O[6]=0,O[7]=0,O[8]=Ge,O[9]=Je,O[10]=Ze,O[11]=-1,O[12]=0,O[13]=0,O[14]=rt,O[15]=0,O}e.perspective=X;function Q(O,z,de,me,ye,Te,Oe){var Ue=1/(de-z),Qe=1/(me-ye),Ge=1/(Oe-Te),Je=(de+z)*Ue,Ze=(me+ye)*Qe,rt=(Oe+Te)*Ge;return O[0]=2*Ue,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=2*Qe,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=-2*Ge,O[11]=0,O[12]=-Je,O[13]=-Ze,O[14]=-rt,O[15]=1,O}e.ortho=Q;function ue(O,z,de,me){var ye,Te,Oe,Ue,Qe,Ge,Je,Ze,rt,et,St=z[0],De=z[1],Ie=z[2],je=me[0],st=me[1],pt=me[2],qe=de[0],bt=de[1],yt=de[2];return Math.abs(St-qe)<zr&&Math.abs(De-bt)<zr&&Math.abs(Ie-yt)<zr?n(O):(Je=St-qe,Ze=De-bt,rt=Ie-yt,et=1/Math.sqrt(Je*Je+Ze*Ze+rt*rt),Je*=et,Ze*=et,rt*=et,ye=st*rt-pt*Ze,Te=pt*Je-je*rt,Oe=je*Ze-st*Je,et=Math.sqrt(ye*ye+Te*Te+Oe*Oe),et?(et=1/et,ye*=et,Te*=et,Oe*=et):(ye=0,Te=0,Oe=0),Ue=Ze*Oe-rt*Te,Qe=rt*ye-Je*Oe,Ge=Je*Te-Ze*ye,et=Math.sqrt(Ue*Ue+Qe*Qe+Ge*Ge),et?(et=1/et,Ue*=et,Qe*=et,Ge*=et):(Ue=0,Qe=0,Ge=0),O[0]=ye,O[1]=Ue,O[2]=Je,O[3]=0,O[4]=Te,O[5]=Qe,O[6]=Ze,O[7]=0,O[8]=Oe,O[9]=Ge,O[10]=rt,O[11]=0,O[12]=-(ye*St+Te*De+Oe*Ie),O[13]=-(Ue*St+Qe*De+Ge*Ie),O[14]=-(Je*St+Ze*De+rt*Ie),O[15]=1,O)}e.lookAt=ue;function le(O,z,de,me){var ye=z[0],Te=z[1],Oe=z[2],Ue=me[0],Qe=me[1],Ge=me[2],Je=ye-de[0],Ze=Te-de[1],rt=Oe-de[2],et=Je*Je+Ze*Ze+rt*rt;et>0&&(et=1/Math.sqrt(et),Je*=et,Ze*=et,rt*=et);var St=Qe*rt-Ge*Ze,De=Ge*Je-Ue*rt,Ie=Ue*Ze-Qe*Je;return et=St*St+De*De+Ie*Ie,et>0&&(et=1/Math.sqrt(et),St*=et,De*=et,Ie*=et),O[0]=St,O[1]=De,O[2]=Ie,O[3]=0,O[4]=Ze*Ie-rt*De,O[5]=rt*St-Je*Ie,O[6]=Je*De-Ze*St,O[7]=0,O[8]=Je,O[9]=Ze,O[10]=rt,O[11]=0,O[12]=ye,O[13]=Te,O[14]=Oe,O[15]=1,O}e.targetTo=le;function ve(O,z){a(O);for(var de=0;de<4;de++){var me=z[de];c(O,de,me,1)}return O}e.fromPermutation=ve;function ge(O){var z=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],de=O[4]*O[4]+O[5]*O[5]+O[6]*O[6],me=O[8]*O[8]+O[9]*O[9]+O[10]*O[10];return Math.sqrt(Math.max(z,de,me))}e.getMaxScaleOnAxis=ge;var Se=[1,0,0],ae=[0,1,0],re=[0,0,1];e.rotX90=F(t(),wr(90),Se),e.rotX180=F(t(),wr(180),Se),e.rotY90=F(t(),wr(90),ae),e.rotY180=F(t(),wr(180),ae),e.rotY270=F(t(),wr(270),ae),e.rotZ90=F(t(),wr(90),re),e.rotZ180=F(t(),wr(180),re),e.rotXY90=P(t(),e.rotX90,e.rotY90),e.rotZY90=P(t(),e.rotZ90,e.rotY90),e.rotZYZ90=P(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=P(t(),e.rotZ90,e.rotX180),e.rotY90Z180=P(t(),e.rotY90,e.rotZ180),e.id=r()})(oe||(oe={}));function YX(e,t,r){return(e-t)/(r-t)}function Ha(e,t,r){return Math.max(t,Math.min(r,e))}function KX(e){return Ha(e,0,1)}function sa(e,t,r){return e+(t-e)*r}function M1(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a,l=a*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*a+t}function lC(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function A8(e,t,r){return r=KX(YX(r,e,t)),r*r*(3-2*r)}function w(){return w.zero()}(function(e){function t(){var ee=[.1,0,0];return ee[0]=0,ee}e.zero=t;function r(ee){var pe=t();return pe[0]=ee[0],pe[1]=ee[1],pe[2]=ee[2],pe}e.clone=r;function n(ee){return isNaN(ee[0])||isNaN(ee[1])||isNaN(ee[2])}e.hasNaN=n;function a(ee){return ee[0]=NaN,ee[1]=NaN,ee[2]=NaN,ee}e.setNaN=a;function i(ee){return l(ee.x,ee.y,ee.z)}e.fromObj=i;function o(ee){return{x:ee[0],y:ee[1],z:ee[2]}}e.toObj=o;function s(ee,pe,we){return ee[0]=pe[we+0],ee[1]=pe[we+1],ee[2]=pe[we+2],ee}e.fromArray=s;function u(ee,pe,we){return pe[we+0]=ee[0],pe[we+1]=ee[1],pe[we+2]=ee[2],pe}e.toArray=u;function l(ee,pe,we){var Xe=t();return Xe[0]=ee,Xe[1]=pe,Xe[2]=we,Xe}e.create=l;function c(ee){var pe=t();return pe[0]=ee[0],pe[1]=ee[1],pe[2]=ee[2],pe}e.ofArray=c;function d(ee,pe,we,Xe){return ee[0]=pe,ee[1]=we,ee[2]=Xe,ee}e.set=d;function f(ee,pe){return ee[0]=pe[0],ee[1]=pe[1],ee[2]=pe[2],ee}e.copy=f;function p(ee,pe,we){return ee[0]=pe[0]+we[0],ee[1]=pe[1]+we[1],ee[2]=pe[2]+we[2],ee}e.add=p;function v(ee,pe,we){return ee[0]=pe[0]-we[0],ee[1]=pe[1]-we[1],ee[2]=pe[2]-we[2],ee}e.sub=v;function m(ee,pe,we){return ee[0]=pe[0]*we[0],ee[1]=pe[1]*we[1],ee[2]=pe[2]*we[2],ee}e.mul=m;function h(ee,pe,we){return ee[0]=pe[0]/we[0],ee[1]=pe[1]/we[1],ee[2]=pe[2]/we[2],ee}e.div=h;function g(ee,pe,we){return ee[0]=pe[0]*we,ee[1]=pe[1]*we,ee[2]=pe[2]*we,ee}e.scale=g;function y(ee,pe,we,Xe){return ee[0]=pe[0]+we[0]*Xe,ee[1]=pe[1]+we[1]*Xe,ee[2]=pe[2]+we[2]*Xe,ee}e.scaleAndAdd=y;function b(ee,pe,we,Xe){return ee[0]=pe[0]-we[0]*Xe,ee[1]=pe[1]-we[1]*Xe,ee[2]=pe[2]-we[2]*Xe,ee}e.scaleAndSub=b;function S(ee,pe,we){return ee[0]=pe[0]+we,ee[1]=pe[1]+we,ee[2]=pe[2]+we,ee}e.addScalar=S;function C(ee,pe,we){return ee[0]=pe[0]-we,ee[1]=pe[1]-we,ee[2]=pe[2]-we,ee}e.subScalar=C;function x(ee,pe){return ee[0]=Math.round(pe[0]),ee[1]=Math.round(pe[1]),ee[2]=Math.round(pe[2]),ee}e.round=x;function A(ee,pe){return ee[0]=Math.ceil(pe[0]),ee[1]=Math.ceil(pe[1]),ee[2]=Math.ceil(pe[2]),ee}e.ceil=A;function P(ee,pe){return ee[0]=Math.floor(pe[0]),ee[1]=Math.floor(pe[1]),ee[2]=Math.floor(pe[2]),ee}e.floor=P;function T(ee,pe){return ee[0]=Math.trunc(pe[0]),ee[1]=Math.trunc(pe[1]),ee[2]=Math.trunc(pe[2]),ee}e.trunc=T;function D(ee,pe){return ee[0]=Math.abs(pe[0]),ee[1]=Math.abs(pe[1]),ee[2]=Math.abs(pe[2]),ee}e.abs=D;function I(ee,pe,we){return ee[0]=Math.min(pe[0],we[0]),ee[1]=Math.min(pe[1],we[1]),ee[2]=Math.min(pe[2],we[2]),ee}e.min=I;function M(ee,pe,we){return ee[0]=Math.max(pe[0],we[0]),ee[1]=Math.max(pe[1],we[1]),ee[2]=Math.max(pe[2],we[2]),ee}e.max=M;function B(ee,pe){var we=pe[0]-ee[0],Xe=pe[1]-ee[1],dt=pe[2]-ee[2];return Math.sqrt(we*we+Xe*Xe+dt*dt)}e.distance=B;function U(ee,pe){var we=pe[0]-ee[0],Xe=pe[1]-ee[1],dt=pe[2]-ee[2];return we*we+Xe*Xe+dt*dt}e.squaredDistance=U;function V(ee){var pe=ee[0],we=ee[1],Xe=ee[2];return Math.sqrt(pe*pe+we*we+Xe*Xe)}e.magnitude=V;function F(ee){var pe=ee[0],we=ee[1],Xe=ee[2];return pe*pe+we*we+Xe*Xe}e.squaredMagnitude=F;function Y(ee,pe,we){return g(ee,$(ee,pe),we)}e.setMagnitude=Y;function W(ee,pe){return ee[0]=-pe[0],ee[1]=-pe[1],ee[2]=-pe[2],ee}e.negate=W;function K(ee,pe){return ee[0]=1/pe[0],ee[1]=1/pe[1],ee[2]=1/pe[2],ee}e.inverse=K;function $(ee,pe){var we=pe[0],Xe=pe[1],dt=pe[2],vt=we*we+Xe*Xe+dt*dt;return vt>0&&(vt=1/Math.sqrt(vt),ee[0]=pe[0]*vt,ee[1]=pe[1]*vt,ee[2]=pe[2]*vt),ee}e.normalize=$;function J(ee,pe){return ee[0]*pe[0]+ee[1]*pe[1]+ee[2]*pe[2]}e.dot=J;function Z(ee,pe,we){var Xe=pe[0],dt=pe[1],vt=pe[2],Et=we[0],_r=we[1],qr=we[2];return ee[0]=dt*qr-vt*_r,ee[1]=vt*Et-Xe*qr,ee[2]=Xe*_r-dt*Et,ee}e.cross=Z;function N(ee,pe,we,Xe){var dt=pe[0],vt=pe[1],Et=pe[2];return ee[0]=dt+Xe*(we[0]-dt),ee[1]=vt+Xe*(we[1]-vt),ee[2]=Et+Xe*(we[2]-Et),ee}e.lerp=N;var j=t();function L(ee,pe,we,Xe){var dt=Ha(J(pe,we),-1,1),vt=Math.acos(dt)*Xe;return y(j,we,pe,-dt),$(j,j),p(ee,g(ee,pe,Math.cos(vt)),g(j,j,Math.sin(vt)))}e.slerp=L;function H(ee,pe,we,Xe,dt,vt){var Et=vt*vt,_r=Et*(2*vt-3)+1,qr=Et*(vt-2)+vt,Qr=Et*(vt-1),_a=Et*(3-2*vt);return ee[0]=pe[0]*_r+we[0]*qr+Xe[0]*Qr+dt[0]*_a,ee[1]=pe[1]*_r+we[1]*qr+Xe[1]*Qr+dt[1]*_a,ee[2]=pe[2]*_r+we[2]*qr+Xe[2]*Qr+dt[2]*_a,ee}e.hermite=H;function G(ee,pe,we,Xe,dt,vt){var Et=1-vt,_r=Et*Et,qr=vt*vt,Qr=_r*Et,_a=3*vt*_r,bi=3*qr*Et,Si=qr*vt;return ee[0]=pe[0]*Qr+we[0]*_a+Xe[0]*bi+dt[0]*Si,ee[1]=pe[1]*Qr+we[1]*_a+Xe[1]*bi+dt[1]*Si,ee[2]=pe[2]*Qr+we[2]*_a+Xe[2]*bi+dt[2]*Si,ee}e.bezier=G;function q(ee,pe,we,Xe,dt){return ee[0]=lC(pe[0],we[0],Xe[0],dt),ee[1]=lC(pe[1],we[1],Xe[1],dt),ee[2]=lC(pe[2],we[2],Xe[2],dt),ee}e.quadraticBezier=q;function X(ee,pe,we,Xe,dt,vt,Et){return ee[0]=M1(pe[0],we[0],Xe[0],dt[0],vt,Et),ee[1]=M1(pe[1],we[1],Xe[1],dt[1],vt,Et),ee[2]=M1(pe[2],we[2],Xe[2],dt[2],vt,Et),ee}e.spline=X;function Q(ee,pe){var we=Math.random()*2*Math.PI,Xe=Math.random()*2-1,dt=Math.sqrt(1-Xe*Xe)*pe;return ee[0]=Math.cos(we)*dt,ee[1]=Math.sin(we)*dt,ee[2]=Xe*pe,ee}e.random=Q;function ue(ee,pe,we){var Xe=pe[0],dt=pe[1],vt=pe[2],Et=1/(we[3]*Xe+we[7]*dt+we[11]*vt+we[15]||1);return ee[0]=(we[0]*Xe+we[4]*dt+we[8]*vt+we[12])*Et,ee[1]=(we[1]*Xe+we[5]*dt+we[9]*vt+we[13])*Et,ee[2]=(we[2]*Xe+we[6]*dt+we[10]*vt+we[14])*Et,ee}e.transformMat4=ue;function le(ee,pe,we,Xe,dt,vt){var Et=pe[0+dt],_r=pe[1+dt],qr=pe[2+dt],Qr=1/(we[3+vt]*Et+we[7+vt]*_r+we[11+vt]*qr+we[15+vt]||1);return ee[0+Xe]=(we[0+vt]*Et+we[4+vt]*_r+we[8+vt]*qr+we[12+vt])*Qr,ee[1+Xe]=(we[1+vt]*Et+we[5+vt]*_r+we[9+vt]*qr+we[13+vt])*Qr,ee[2+Xe]=(we[2+vt]*Et+we[6+vt]*_r+we[10+vt]*qr+we[14+vt])*Qr,ee}e.transformMat4Offset=le;function ve(ee,pe,we){var Xe=pe[0],dt=pe[1],vt=pe[2];return ee[0]=Xe*we[0]+dt*we[3]+vt*we[6],ee[1]=Xe*we[1]+dt*we[4]+vt*we[7],ee[2]=Xe*we[2]+dt*we[5]+vt*we[8],ee}e.transformMat3=ve;function ge(ee,pe,we){var Xe=pe[0],dt=pe[1],vt=pe[2],Et=we[0],_r=we[1],qr=we[2],Qr=we[3],_a=Qr*Xe+_r*vt-qr*dt,bi=Qr*dt+qr*Xe-Et*vt,Si=Qr*vt+Et*dt-_r*Xe,ys=-Et*Xe-_r*dt-qr*vt;return ee[0]=_a*Qr+ys*-Et+bi*-qr-Si*-_r,ee[1]=bi*Qr+ys*-_r+Si*-Et-_a*-qr,ee[2]=Si*Qr+ys*-qr+_a*-_r-bi*-Et,ee}e.transformQuat=ge;function Se(ee,pe){var we=Math.sqrt(F(ee)*F(pe));if(we===0)return Math.PI/2;var Xe=J(ee,pe)/we;return Math.acos(Ha(Xe,-1,1))}e.angle=Se;var ae=t(),re=t(),O=t(),z=t(),de=t(),me=t(),ye=t();function Te(ee,pe,we,Xe){v(ae,ee,pe),v(re,we,pe),v(O,pe,we),v(z,Xe,we),Z(de,ae,re),Z(me,O,z);var dt=Se(de,me);return Z(ye,de,me),J(re,ye)>0?dt:-dt}e.dihedralAngle=Te;function Oe(ee,pe,we,Xe){return e.set(ee,Xe*Math.cos(we)*Math.sin(pe),Xe*Math.sin(we)*Math.sin(pe),Xe*Math.cos(pe))}e.directionFromSpherical=Oe;function Ue(ee,pe){return ee[0]===pe[0]&&ee[1]===pe[1]&&ee[2]===pe[2]}e.exactEquals=Ue;function Qe(ee,pe){var we=ee[0],Xe=ee[1],dt=ee[2],vt=pe[0],Et=pe[1],_r=pe[2];return Math.abs(we-vt)<=zr*Math.max(1,Math.abs(we),Math.abs(vt))&&Math.abs(Xe-Et)<=zr*Math.max(1,Math.abs(Xe),Math.abs(Et))&&Math.abs(dt-_r)<=zr*Math.max(1,Math.abs(dt),Math.abs(_r))}e.equals=Qe;var Ge=t();function Je(ee,pe,we){var Xe=Se(pe,we);if(Math.abs(Xe)<1e-4)return oe.setIdentity(ee);if(Math.abs(Xe-Math.PI)<zr)return oe.fromScaling(ee,e.negUnit);var dt=Z(Ge,pe,we);return oe.fromRotation(ee,Xe,dt)}e.makeRotation=Je;function Ze(ee){return ee[0]===0&&ee[1]===0&&ee[2]===0}e.isZero=Ze;function rt(ee,pe,we,Xe){v(ee,pe,Xe);var dt=J(we,ee)/F(we);return p(ee,g(ee,we,dt),Xe)}e.projectPointOnVector=rt;var et=t();function St(ee,pe,we,Xe){return $(et,we),v(ee,pe,Xe),v(ee,pe,g(et,et,J(ee,et)))}e.projectPointOnPlane=St;function De(ee,pe,we){var Xe=J(we,pe)/F(we);return g(ee,we,Xe)}e.projectOnVector=De;var Ie=t();function je(ee,pe,we){return De(Ie,pe,we),v(ee,pe,Ie)}e.projectOnPlane=je;function st(ee,pe,we){return $(ee,Z(ee,Z(ee,pe,we),pe))}e.orthogonalize=st;function pt(ee,pe,we){return J(pe,we)>0?f(ee,pe):W(ee,f(ee,pe)),ee}e.matchDirection=pt;var qe=t(),bt=t();function yt(ee,pe,we,Xe){return v(qe,we,pe),v(bt,Xe,pe),$(ee,Z(ee,qe,bt))}e.triangleNormal=yt;function Dt(ee,pe){return"[".concat(ee[0].toPrecision(pe)," ").concat(ee[1].toPrecision(pe)," ").concat(ee[2].toPrecision(pe),"]")}e.toString=Dt,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(w||(w={}));function wn(){return wn.zero()}(function(e){function t(){var N=[.1,0,0,0,0,0,0,0,0];return N[0]=0,N}e.zero=t;function r(){var N=t();return N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=1,N[5]=0,N[6]=0,N[7]=0,N[8]=1,N}e.identity=r;function n(N){return N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=1,N[5]=0,N[6]=0,N[7]=0,N[8]=1,N}e.setIdentity=n;function a(N,j,L){return j[L+0]=N[0],j[L+1]=N[1],j[L+2]=N[2],j[L+3]=N[3],j[L+4]=N[4],j[L+5]=N[5],j[L+6]=N[6],j[L+7]=N[7],j[L+8]=N[8],j}e.toArray=a;function i(N,j,L){return N[0]=j[L+0],N[1]=j[L+1],N[2]=j[L+2],N[3]=j[L+3],N[4]=j[L+4],N[5]=j[L+5],N[6]=j[L+6],N[7]=j[L+7],N[8]=j[L+8],N}e.fromArray=i;function o(N,j){return N[0]=j[0],N[1]=j[1],N[2]=j[2],N[3]=j[4],N[4]=j[5],N[5]=j[6],N[6]=j[8],N[7]=j[9],N[8]=j[10],N}e.fromMat4=o;function s(N,j,L,H,G,q,X,Q,ue){var le=t();return le[0]=N,le[1]=j,le[2]=L,le[3]=H,le[4]=G,le[5]=q,le[6]=X,le[7]=Q,le[8]=ue,le}e.create=s;var u=r();function l(N,j){return f(N,u,typeof j=="undefined"?zr:j)}e.isIdentity=l;function c(N){for(var j=0;j<9;j++)if(isNaN(N[j]))return!0;return!1}e.hasNaN=c;function d(N){return m(t(),N)}e.clone=d;function f(N,j,L){for(var H=0;H<9;H++)if(Math.abs(N[H]-j[H])>L)return!1;return!0}e.areEqual=f;function p(N,j,L,H){N[3*L+j]=H}e.setValue=p;function v(N,j,L){return N[3*L+j]}e.getValue=v;function m(N,j){return N[0]=j[0],N[1]=j[1],N[2]=j[2],N[3]=j[3],N[4]=j[4],N[5]=j[5],N[6]=j[6],N[7]=j[7],N[8]=j[8],N}e.copy=m;function h(N,j){if(N===j){var L=j[1],H=j[2],G=j[5];N[1]=j[3],N[2]=j[6],N[3]=L,N[5]=j[7],N[6]=H,N[7]=G}else N[0]=j[0],N[1]=j[3],N[2]=j[6],N[3]=j[1],N[4]=j[4],N[5]=j[7],N[6]=j[2],N[7]=j[5],N[8]=j[8];return N}e.transpose=h;function g(N,j){var L=j[0],H=j[1],G=j[2],q=j[3],X=j[4],Q=j[5],ue=j[6],le=j[7],ve=j[8],ge=ve*X-Q*le,Se=-ve*q+Q*ue,ae=le*q-X*ue,re=L*ge+H*Se+G*ae;return re?(re=1/re,N[0]=ge*re,N[1]=(-ve*H+G*le)*re,N[2]=(Q*H-G*X)*re,N[3]=Se*re,N[4]=(ve*L-G*ue)*re,N[5]=(-Q*L+G*q)*re,N[6]=ae*re,N[7]=(-le*L+H*ue)*re,N[8]=(X*L-H*q)*re,N):(console.warn("non-invertible matrix.",j),N)}e.invert=g;function y(N,j){return N===j?(N[3]=j[1],N[6]=j[2],N[7]=j[5]):(N[0]=j[0],N[1]=j[1],N[2]=j[2],N[3]=j[1],N[4]=j[4],N[5]=j[5],N[6]=j[2],N[7]=j[5],N[8]=j[8]),N}e.symmtricFromUpper=y;function b(N,j){return N===j?(N[1]=j[3],N[2]=j[6],N[5]=j[7]):(N[0]=j[0],N[1]=j[3],N[2]=j[6],N[3]=j[3],N[4]=j[4],N[5]=j[7],N[6]=j[6],N[7]=j[7],N[8]=j[8]),N}e.symmtricFromLower=b;function S(N){var j=N[0],L=N[1],H=N[2],G=N[3],q=N[4],X=N[5],Q=N[6],ue=N[7],le=N[8],ve=le*q-X*ue,ge=-le*G+X*Q,Se=ue*G-q*Q;return j*ve+L*ge+H*Se}e.determinant=S;function C(N){return N[0]+N[4]+N[8]}e.trace=C;function x(N,j,L){return N[0]=j[0]-L[0],N[1]=j[1]-L[1],N[2]=j[2]-L[2],N[3]=j[3]-L[3],N[4]=j[4]-L[4],N[5]=j[5]-L[5],N[6]=j[6]-L[6],N[7]=j[7]-L[7],N[8]=j[8]-L[8],N}e.sub=x;function A(N,j,L){return N[0]=j[0]+L[0],N[1]=j[1]+L[1],N[2]=j[2]+L[2],N[3]=j[3]+L[3],N[4]=j[4]+L[4],N[5]=j[5]+L[5],N[6]=j[6]+L[6],N[7]=j[7]+L[7],N[8]=j[8]+L[8],N}e.add=A;function P(N,j,L){var H=j[0],G=j[1],q=j[2],X=j[3],Q=j[4],ue=j[5],le=j[6],ve=j[7],ge=j[8],Se=L[0],ae=L[1],re=L[2],O=L[3],z=L[4],de=L[5],me=L[6],ye=L[7],Te=L[8];return N[0]=Se*H+ae*X+re*le,N[1]=Se*G+ae*Q+re*ve,N[2]=Se*q+ae*ue+re*ge,N[3]=O*H+z*X+de*le,N[4]=O*G+z*Q+de*ve,N[5]=O*q+z*ue+de*ge,N[6]=me*H+ye*X+Te*le,N[7]=me*G+ye*Q+Te*ve,N[8]=me*q+ye*ue+Te*ge,N}e.mul=P;function T(N,j,L){return N[0]=j[0]-L,N[1]=j[1]-L,N[2]=j[2]-L,N[3]=j[3]-L,N[4]=j[4]-L,N[5]=j[5]-L,N[6]=j[6]-L,N[7]=j[7]-L,N[8]=j[8]-L,N}e.subScalar=T;function D(N,j,L){return N[0]=j[0]+L,N[1]=j[1]+L,N[2]=j[2]+L,N[3]=j[3]+L,N[4]=j[4]+L,N[5]=j[5]+L,N[6]=j[6]+L,N[7]=j[7]+L,N[8]=j[8]+L,N}e.addScalar=D;function I(N,j,L){return N[0]=j[0]*L,N[1]=j[1]*L,N[2]=j[2]*L,N[3]=j[3]*L,N[4]=j[4]*L,N[5]=j[5]*L,N[6]=j[6]*L,N[7]=j[7]*L,N[8]=j[8]*L,N}e.mulScalar=I;var M=Math.PI/3,B=t();function U(N,j){var L=j[1]*j[1]+j[2]*j[2]+j[5]*j[5];if(L===0)N[0]=j[0],N[1]=j[4],N[2]=j[8];else{var H=C(j)/3,G=j[0]-H,q=j[4]-H,X=j[8]-H,Q=G*G+q*q+X*X+2*L,ue=Math.sqrt(Q/6);I(B,e.Identity,H),x(B,j,B),I(B,B,1/ue);var le=S(B)/2,ve=le<=-1?M:le>=1?0:Math.acos(le)/3;N[0]=H+2*ue*Math.cos(ve),N[2]=H+2*ue*Math.cos(ve+2*M),N[1]=3*H-N[0]-N[2]}return N}e.symmetricEigenvalues=U;var V=[.1,0,0],F=[.1,0,0],Y=[.1,0,0],W=[.1,0,0],K=[.1,0,0],$=[.1,0,0];function J(N,j,L){w.set(V,j[0]-L,j[1],j[2]),w.set(F,j[1],j[4]-L,j[5]),w.set(Y,j[2],j[5],j[8]-L),w.cross(W,V,F),w.cross(K,V,Y),w.cross($,F,Y);var H=w.dot(W,W),G=w.dot(K,K),q=w.dot($,$),X=H,Q=0;return G>X&&(X=G,Q=1),q>X&&(Q=2),Q===0?w.scale(N,W,1/Math.sqrt(H)):Q===1?w.scale(N,K,1/Math.sqrt(G)):w.scale(N,$,1/Math.sqrt(q)),N}e.eigenvector=J;function Z(N,j){return o(N,j),g(N,N),h(N,N),N}e.directionTransform=Z,e.Identity=r()})(wn||(wn={}));function ke(){return ke.zero()}(function(e){function t(){var P=[.1,0];return P[0]=0,P}e.zero=t;function r(P){var T=t();return T[0]=P[0],T[1]=P[1],T}e.clone=r;function n(P,T){var D=t();return D[0]=P,D[1]=T,D}e.create=n;function a(P){return isNaN(P[0])||isNaN(P[1])}e.hasNaN=a;function i(P,T,D){return T[D+0]=P[0],T[D+1]=P[1],T}e.toArray=i;function o(P,T,D){return P[0]=T[D+0],P[1]=T[D+1],P}e.fromArray=o;function s(P,T){return P[0]=T[0],P[1]=T[1],P}e.copy=s;function u(P,T,D){return P[0]=T,P[1]=D,P}e.set=u;function l(P,T,D){return P[0]=T[0]+D[0],P[1]=T[1]+D[1],P}e.add=l;function c(P,T,D){return P[0]=T[0]-D[0],P[1]=T[1]-D[1],P}e.sub=c;function d(P,T,D){return P[0]=T[0]*D[0],P[1]=T[1]*D[1],P}e.mul=d;function f(P,T,D){return P[0]=T[0]/D[0],P[1]=T[1]/D[1],P}e.div=f;function p(P,T,D){return P[0]=T[0]*D,P[1]=T[1]*D,P}e.scale=p;function v(P,T){return P[0]=Math.round(T[0]),P[1]=Math.round(T[1]),P}e.round=v;function m(P,T){return P[0]=Math.ceil(T[0]),P[1]=Math.ceil(T[1]),P}e.ceil=m;function h(P,T){return P[0]=Math.floor(T[0]),P[1]=Math.floor(T[1]),P}e.floor=h;function g(P,T){var D=T[0]-P[0],I=T[1]-P[1];return Math.sqrt(D*D+I*I)}e.distance=g;function y(P,T){var D=T[0]-P[0],I=T[1]-P[1];return D*D+I*I}e.squaredDistance=y;function b(P){var T=P[0],D=P[1];return Math.sqrt(T*T+D*D)}e.magnitude=b;function S(P){var T=P[0],D=P[1];return T*T+D*D}e.squaredMagnitude=S;function C(P,T){return P[0]=1/T[0],P[1]=1/T[1],P}e.inverse=C;function x(P,T){return P[0]===T[0]&&P[1]===T[1]}e.areEqual=x;function A(P,T){return"[".concat(P[0].toPrecision(T)," ").concat(P[1].toPrecision(T),"}]")}e.toString=A})(ke||(ke={}));function Jt(){return Jt.zero()}(function(e){function t(){var M=[.1,0,0,0];return M[0]=0,M}e.zero=t;function r(M){var B=t();return B[0]=M[0],B[1]=M[1],B[2]=M[2],B[3]=M[3],B}e.clone=r;function n(M,B,U,V){var F=t();return F[0]=M,F[1]=B,F[2]=U,F[3]=V,F}e.create=n;function a(M,B){return M[0]=B.center[0],M[1]=B.center[1],M[2]=B.center[2],M[3]=B.radius,M}e.fromSphere=a;function i(M){return a(t(),M)}e.ofSphere=i;function o(M){return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])}e.hasNaN=o;function s(M,B,U){return B[U+0]=M[0],B[U+1]=M[1],B[U+2]=M[2],B[U+3]=M[3],B}e.toArray=s;function u(M,B,U){return M[0]=B[U+0],M[1]=B[U+1],M[2]=B[U+2],M[3]=B[U+3],M}e.fromArray=u;function l(M,B,U){B[U+0]=M[0],B[U+1]=M[1],B[U+2]=M[2]}e.toVec3Array=l;function c(M,B,U){return M[0]=B[U+0],M[1]=B[U+1],M[2]=B[U+2],M[3]=0,M}e.fromVec3Array=c;function d(M,B){return M[0]=B[0],M[1]=B[1],M[2]=B[2],M[3]=B[3],M}e.copy=d;function f(M,B,U,V,F){return M[0]=B,M[1]=U,M[2]=V,M[3]=F,M}e.set=f;function p(M,B,U){return M[0]=B[0]+U[0],M[1]=B[1]+U[1],M[2]=B[2]+U[2],M[3]=B[3]+U[3],M}e.add=p;function v(M,B){var U=B[0]-M[0],V=B[1]-M[1],F=B[2]-M[2],Y=B[3]-M[3];return Math.sqrt(U*U+V*V+F*F+Y*Y)}e.distance=v;function m(M,B,U){return M[0]=B[0]*U,M[1]=B[1]*U,M[2]=B[2]*U,M[4]=B[4]*U,M}e.scale=m;function h(M,B){return M[0]=Math.round(B[0]),M[1]=Math.round(B[1]),M[2]=Math.round(B[2]),M[3]=Math.round(B[3]),M}e.round=h;function g(M,B){return M[0]=Math.ceil(B[0]),M[1]=Math.ceil(B[1]),M[2]=Math.ceil(B[2]),M[3]=Math.ceil(B[3]),M}e.ceil=g;function y(M,B){return M[0]=Math.floor(B[0]),M[1]=Math.floor(B[1]),M[2]=Math.floor(B[2]),M[3]=Math.floor(B[3]),M}e.floor=y;function b(M,B){var U=B[0]-M[0],V=B[1]-M[1],F=B[2]-M[2],Y=B[3]-M[3];return U*U+V*V+F*F+Y*Y}e.squaredDistance=b;function S(M){var B=M[0],U=M[1],V=M[2],F=M[3];return Math.sqrt(B*B+U*U+V*V+F*F)}e.norm=S;function C(M){var B=M[0],U=M[1],V=M[2],F=M[3];return B*B+U*U+V*V+F*F}e.squaredNorm=C;function x(M,B,U){var V=B[0],F=B[1],Y=B[2],W=B[3];return M[0]=U[0]*V+U[4]*F+U[8]*Y+U[12]*W,M[1]=U[1]*V+U[5]*F+U[9]*Y+U[13]*W,M[2]=U[2]*V+U[6]*F+U[10]*Y+U[14]*W,M[3]=U[3]*V+U[7]*F+U[11]*Y+U[15]*W,M}e.transformMat4=x;function A(M,B){return M[0]*B[0]+M[1]*B[1]+M[2]*B[2]+M[3]*B[3]}e.dot=A;function P(M,B){return M[0]=1/B[0],M[1]=1/B[1],M[2]=1/B[2],M[3]=1/B[3],M}e.inverse=P;function T(M,B){return M[0]===B[0]&&M[1]===B[1]&&M[2]===B[2]&&M[3]===B[3]}e.exactEquals=T;function D(M,B){var U=M[0],V=M[1],F=M[2],Y=M[3],W=B[0],K=B[1],$=B[2],J=B[3];return Math.abs(U-W)<=zr*Math.max(1,Math.abs(U),Math.abs(W))&&Math.abs(V-K)<=zr*Math.max(1,Math.abs(V),Math.abs(K))&&Math.abs(F-$)<=zr*Math.max(1,Math.abs(F),Math.abs($))&&Math.abs(Y-J)<=zr*Math.max(1,Math.abs(Y),Math.abs(J))}e.equals=D;function I(M,B){return"[".concat(M[0].toPrecision(B)," ").concat(M[1].toPrecision(B)," ").concat(M[2].toPrecision(B),"  ").concat(M[3].toPrecision(B),"]")}e.toString=I})(Jt||(Jt={}));function $r(){return $r.zero()}(function(e){function t(){var Z=[.1,0,0,0];return Z[0]=0,Z}e.zero=t;function r(){var Z=t();return Z[3]=1,Z}e.identity=r;function n(Z){Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1}e.setIdentity=n;function a(Z){return isNaN(Z[0])||isNaN(Z[1])||isNaN(Z[2])||isNaN(Z[3])}e.hasNaN=a;function i(Z,N,j,L){var H=r();return H[0]=Z,H[1]=N,H[2]=j,H[3]=L,H}e.create=i;function o(Z,N,j){j=j*.5;var L=Math.sin(j);return Z[0]=L*N[0],Z[1]=L*N[1],Z[2]=L*N[2],Z[3]=Math.cos(j),Z}e.setAxisAngle=o;function s(Z,N){var j=Math.acos(N[3])*2,L=Math.sin(j/2);return L!==0?(Z[0]=N[0]/L,Z[1]=N[1]/L,Z[2]=N[2]/L):(Z[0]=1,Z[1]=0,Z[2]=0),j}e.getAxisAngle=s;function u(Z,N,j){var L=N[0],H=N[1],G=N[2],q=N[3],X=j[0],Q=j[1],ue=j[2],le=j[3];return Z[0]=L*le+q*X+H*ue-G*Q,Z[1]=H*le+q*Q+G*X-L*ue,Z[2]=G*le+q*ue+L*Q-H*X,Z[3]=q*le-L*X-H*Q-G*ue,Z}e.multiply=u;function l(Z,N,j){j*=.5;var L=N[0],H=N[1],G=N[2],q=N[3],X=Math.sin(j),Q=Math.cos(j);return Z[0]=L*Q+q*X,Z[1]=H*Q+G*X,Z[2]=G*Q-H*X,Z[3]=q*Q-L*X,Z}e.rotateX=l;function c(Z,N,j){j*=.5;var L=N[0],H=N[1],G=N[2],q=N[3],X=Math.sin(j),Q=Math.cos(j);return Z[0]=L*Q-G*X,Z[1]=H*Q+q*X,Z[2]=G*Q+L*X,Z[3]=q*Q-H*X,Z}e.rotateY=c;function d(Z,N,j){j*=.5;var L=N[0],H=N[1],G=N[2],q=N[3],X=Math.sin(j),Q=Math.cos(j);return Z[0]=L*Q+H*X,Z[1]=H*Q-L*X,Z[2]=G*Q+q*X,Z[3]=q*Q-G*X,Z}e.rotateZ=d;function f(Z,N){var j=N[0],L=N[1],H=N[2];return Z[0]=j,Z[1]=L,Z[2]=H,Z[3]=Math.sqrt(Math.abs(1-j*j-L*L-H*H)),Z}e.calculateW=f;function p(Z,N,j,L){var H=N[0],G=N[1],q=N[2],X=N[3],Q=j[0],ue=j[1],le=j[2],ve=j[3],ge,Se,ae,re,O;return Se=H*Q+G*ue+q*le+X*ve,Se<0&&(Se=-Se,Q=-Q,ue=-ue,le=-le,ve=-ve),1-Se>1e-6?(ge=Math.acos(Se),ae=Math.sin(ge),re=Math.sin((1-L)*ge)/ae,O=Math.sin(L*ge)/ae):(re=1-L,O=L),Z[0]=re*H+O*Q,Z[1]=re*G+O*ue,Z[2]=re*q+O*le,Z[3]=re*X+O*ve,Z}e.slerp=p;function v(Z,N){var j=N[0],L=N[1],H=N[2],G=N[3],q=j*j+L*L+H*H+G*G,X=q?1/q:0;return Z[0]=-j*X,Z[1]=-L*X,Z[2]=-H*X,Z[3]=G*X,Z}e.invert=v;function m(Z,N){return Z[0]=-N[0],Z[1]=-N[1],Z[2]=-N[2],Z[3]=N[3],Z}e.conjugate=m;function h(Z,N){var j=N[0]+N[4]+N[8],L;if(j>0)L=Math.sqrt(j+1),Z[3]=.5*L,L=.5/L,Z[0]=(N[5]-N[7])*L,Z[1]=(N[6]-N[2])*L,Z[2]=(N[1]-N[3])*L;else{var H=0;N[4]>N[0]&&(H=1),N[8]>N[H*3+H]&&(H=2);var G=(H+1)%3,q=(H+2)%3;L=Math.sqrt(N[H*3+H]-N[G*3+G]-N[q*3+q]+1),Z[H]=.5*L,L=.5/L,Z[3]=(N[G*3+q]-N[q*3+G])*L,Z[G]=(N[G*3+H]+N[H*3+G])*L,Z[q]=(N[q*3+H]+N[H*3+q])*L}return Z}e.fromMat3=h;var g=[0,0,0];function y(Z,N,j){var L=w.dot(N,j)+1;return L<zr?(L=0,Math.abs(N[0])>Math.abs(N[2])?w.set(g,-N[1],N[0],0):w.set(g,0,-N[2],N[1])):w.cross(g,N,j),Z[0]=g[0],Z[1]=g[1],Z[2]=g[2],Z[3]=L,I(Z,Z),Z}e.fromUnitVec3=y;function b(Z){var N=t();return N[0]=Z[0],N[1]=Z[1],N[2]=Z[2],N[3]=Z[3],N}e.clone=b;function S(Z,N,j){return N[j+0]=Z[0],N[j+1]=Z[1],N[j+2]=Z[2],N[j+3]=Z[3],N}e.toArray=S;function C(Z,N,j){return Z[0]=N[j+0],Z[1]=N[j+1],Z[2]=N[j+2],Z[3]=N[j+3],Z}e.fromArray=C;function x(Z,N){return Z[0]=N[0],Z[1]=N[1],Z[2]=N[2],Z[3]=N[3],Z}e.copy=x;function A(Z,N,j,L,H){return Z[0]=N,Z[1]=j,Z[2]=L,Z[3]=H,Z}e.set=A;function P(Z,N){return Z[0]===N[0]&&Z[1]===N[1]&&Z[2]===N[2]&&Z[3]===N[3]}e.exactEquals=P;function T(Z,N){var j=Z[0],L=Z[1],H=Z[2],G=Z[3],q=N[0],X=N[1],Q=N[2],ue=N[3];return Math.abs(j-q)<=zr*Math.max(1,Math.abs(j),Math.abs(q))&&Math.abs(L-X)<=zr*Math.max(1,Math.abs(L),Math.abs(X))&&Math.abs(H-Q)<=zr*Math.max(1,Math.abs(H),Math.abs(Q))&&Math.abs(G-ue)<=zr*Math.max(1,Math.abs(G),Math.abs(ue))}e.equals=T;function D(Z,N,j){return Z[0]=N[0]+j[0],Z[1]=N[1]+j[1],Z[2]=N[2]+j[2],Z[3]=N[3]+j[3],Z}e.add=D;function I(Z,N){var j=N[0],L=N[1],H=N[2],G=N[3],q=j*j+L*L+H*H+G*G;return q>0&&(q=1/Math.sqrt(q),Z[0]=j*q,Z[1]=L*q,Z[2]=H*q,Z[3]=G*q),Z}e.normalize=I;var M=[0,0,0],B=[1,0,0],U=[0,1,0];function V(Z,N,j){var L=w.dot(N,j);return L<-.999999?(w.cross(M,B,N),w.magnitude(M)<1e-6&&w.cross(M,U,N),w.normalize(M,M),o(Z,M,Math.PI),Z):L>.999999?(Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z):(w.cross(M,N,j),Z[0]=M[0],Z[1]=M[1],Z[2]=M[2],Z[3]=1+L,I(Z,Z))}e.rotationTo=V;var F=t(),Y=t();function W(Z,N,j,L,H,G){return p(F,N,H,G),p(Y,j,L,G),p(Z,F,Y,2*G*(1-G)),Z}e.sqlerp=W;var K=[0,0,0,0,0,0,0,0,0];function $(Z,N,j,L){return K[0]=j[0],K[3]=j[1],K[6]=j[2],K[1]=L[0],K[4]=L[1],K[7]=L[2],K[2]=-N[0],K[5]=-N[1],K[8]=-N[2],I(Z,h(Z,K))}e.setAxes=$;function J(Z,N){return"[".concat(Z[0].toPrecision(N)," ").concat(Z[1].toPrecision(N)," ").concat(Z[2].toPrecision(N),"  ").concat(Z[3].toPrecision(N),"]")}e.toString=J,e.Identity=r()})($r||($r={}));var gr;(function(e){function t(C,x,A){for(var P=[],T=0;T<x.length;T++)P[T]=x[x.length-T-1];for(var D=[1],T=1;T<C.length;T++)D[T]=C[P[T-1]];return{dimensions:C,axisOrderFastToSlow:P,axisOrderSlowToFast:x,accessDimensions:D,defaultCtor:A||Float64Array}}function r(C,x){return{space:C,data:x}}e.create=r;function n(C,x,A){var P=t(C,x,A),T=p(P),D=T.get,I=T.set,M=T.add,B=T.dataOffset,U=T.getCoords;return{rank:C.length,dimensions:C,axisOrderSlowToFast:x,create:v(P),get:D,set:I,add:M,dataOffset:B,getCoords:U}}e.Space=n;function a(C){return C}e.Data1=a;function i(C,x){return n([C],[0],x)}e.Vector=i;function o(C,x,A){return n([C,x],[1,0],A)}e.ColumnMajorMatrix=o;function s(C,x,A){return n([C,x],[0,1],A)}e.RowMajorMatrix=s;function u(C,x,A){if(x.rank!==2)throw new Error("Invalid tensor rank");for(var P=Math.min(4,x.dimensions[0]),T=Math.min(4,x.dimensions[1]),D=0;D<P;D++)for(var I=0;I<T;I++)oe.setValue(C,D,I,x.get(A,D,I));return C}e.toMat4=u;function l(C,x,A){if(x.rank!==2)throw new Error("Invalid tensor rank");for(var P=Math.min(3,x.dimensions[0]),T=Math.min(3,x.dimensions[1]),D=0;D<P;D++)for(var I=0;I<T;I++)wn.setValue(C,D,I,x.get(A,D,I));return C}e.toMat3=l;function c(C,x,A){if(x.rank!==1)throw new Error("Invalid tensor rank");for(var P=Math.min(3,x.dimensions[0]),T=0;T<P;T++)C[T]=A[T];return C}e.toVec3=c;function d(C,x,A){if(x.rank!==1)throw new Error("Invalid tensor rank");for(var P=Math.min(4,x.dimensions[0]),T=0;T<P;T++)C[T]=A[T];return C}e.toVec4=d;function f(C,x){var A=C.length;if(A!==x.length)return!1;for(var P=0;P<A;P++)if(C[P]!==x[P])return!1;return!0}e.areEqualExact=f;function p(C){var x=C.dimensions,A=C.axisOrderFastToSlow;switch(x.length){case 1:return{get:function(q,X){return q[X]},set:function(q,X,Q){return q[X]=Q},add:function(q,X,Q){return q[X]+=Q},dataOffset:function(q){return q},getCoords:function(q,X){return X[0]=q,X}};case 2:{if(A[0]===0&&A[1]===1){var P=x[0];return{get:function(q,X,Q){return q[Q*P+X]},set:function(q,X,Q,ue){return q[Q*P+X]=ue},add:function(q,X,Q,ue){return q[Q*P+X]+=ue},dataOffset:function(q,X){return X*P+q},getCoords:function(q,X){return X[0]=q%P,X[1]=Math.floor(q/P),X}}}if(A[0]===1&&A[1]===0){var T=x[1];return{get:function(q,X,Q){return q[X*T+Q]},set:function(q,X,Q,ue){return q[X*T+Q]=ue},add:function(q,X,Q,ue){return q[X*T+Q]+=ue},dataOffset:function(q,X){return q*T+X},getCoords:function(q,X){return X[0]=Math.floor(q/T),X[1]=q%T,X}}}throw new Error("bad axis order")}case 3:{if(A[0]===0&&A[1]===1&&A[2]===2){var D=x[0],I=x[1],M=D*I;return{get:function(q,X,Q,ue){return q[X+Q*D+ue*M]},set:function(q,X,Q,ue,le){return q[X+Q*D+ue*M]=le},add:function(q,X,Q,ue,le){return q[X+Q*D+ue*M]+=le},dataOffset:function(q,X,Q){return q+X*D+Q*M},getCoords:function(q,X){var Q=Math.floor(q/D);return X[0]=q%D,X[1]=Q%I,X[2]=Math.floor(Q/I),X}}}if(A[0]===0&&A[1]===2&&A[2]===1){var B=x[0],U=x[2],V=B*U;return{get:function(q,X,Q,ue){return q[X+ue*B+Q*V]},set:function(q,X,Q,ue,le){return q[X+ue*B+Q*V]=le},add:function(q,X,Q,ue,le){return q[X+ue*B+Q*V]+=le},dataOffset:function(q,X,Q){return q+Q*B+X*V},getCoords:function(q,X){var Q=Math.floor(q/B);return X[0]=q%B,X[1]=Math.floor(Q/U),X[2]=Q%U,X}}}if(A[0]===1&&A[1]===0&&A[2]===2){var F=x[1],Y=x[0],W=F*Y;return{get:function(q,X,Q,ue){return q[Q+X*F+ue*W]},set:function(q,X,Q,ue,le){return q[Q+X*F+ue*W]=le},add:function(q,X,Q,ue,le){return q[Q+X*F+ue*W]+=le},dataOffset:function(q,X,Q){return X+q*F+Q*W},getCoords:function(q,X){var Q=Math.floor(q/F);return X[0]=Q%Y,X[1]=q%F,X[2]=Math.floor(Q/Y),X}}}if(A[0]===1&&A[1]===2&&A[2]===0){var K=x[1],$=x[2],J=K*$;return{get:function(q,X,Q,ue){return q[Q+ue*K+X*J]},set:function(q,X,Q,ue,le){return q[Q+ue*K+X*J]=le},add:function(q,X,Q,ue,le){return q[Q+ue*K+X*J]+=le},dataOffset:function(q,X,Q){return X+Q*K+q*J},getCoords:function(q,X){var Q=Math.floor(q/K);return X[0]=Math.floor(Q/$),X[1]=q%K,X[2]=Q%$,X}}}if(A[0]===2&&A[1]===0&&A[2]===1){var Z=x[2],N=x[0],j=Z*N;return{get:function(q,X,Q,ue){return q[ue+X*Z+Q*j]},set:function(q,X,Q,ue,le){return q[ue+X*Z+Q*j]=le},add:function(q,X,Q,ue,le){return q[ue+X*Z+Q*j]+=le},dataOffset:function(q,X,Q){return Q+q*Z+X*j},getCoords:function(q,X){var Q=Math.floor(q/Z);return X[0]=Q%N,X[1]=Math.floor(Q/N),X[2]=q%Z,X}}}if(A[0]===2&&A[1]===1&&A[2]===0){var L=x[2],H=x[1],G=L*H;return{get:function(q,X,Q,ue){return q[ue+Q*L+X*G]},set:function(q,X,Q,ue,le){return q[ue+Q*L+X*G]=le},add:function(q,X,Q,ue,le){return q[ue+Q*L+X*G]+=le},dataOffset:function(q,X,Q){return Q+X*L+q*G},getCoords:function(q,X){var Q=Math.floor(q/L);return X[0]=Math.floor(Q/H),X[1]=Q%H,X[2]=q%L,X}}}throw new Error("bad axis order")}default:return{get:function(q){for(var X=[],Q=1;Q<arguments.length;Q++)X[Q-1]=arguments[Q];return q[m(C,X)]},set:function(q){for(var X=[],Q=1;Q<arguments.length;Q++)X[Q-1]=arguments[Q];return q[m(C,X)]=X[X.length-1]},add:function(q){for(var X=[],Q=1;Q<arguments.length;Q++)X[Q-1]=arguments[Q];return q[m(C,X)]+=X[X.length-1]},dataOffset:function(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];return m(C,q)},getCoords:function(q,X){return h(C,q,X)}}}}function v(C){for(var x=C.dimensions,A=1,P=0,T=x.length;P<T;P++)A*=x[P];return function(D){return new(D||C.defaultCtor)(A)}}function m(C,x){for(var A=C.accessDimensions,P=C.axisOrderFastToSlow,T=A.length-1,D=A[T]*x[P[T]],I=T-1;I>=0;I--)D=(D+x[P[I]])*A[I];return D}function h(C,x,A){for(var P=C.dimensions,T=C.axisOrderFastToSlow,D=P.length,I=x,M=0;M<D;M++){var B=P[T[M]];A[T[M]]=I%B,I=Math.floor(I/B)}return A[T[D+1]]=I,A}function g(C){for(var x=[],A=0;A<C.length;A++)x[A]=C[C.length-A-1];return x}e.invertAxisOrder=g;function y(C,x){for(var A=[],P=0;P<C.length;P++)A[P]=C[x[P]];return A}function b(C){for(var x=new Int32Array(C.length),A=0;A<C.length;A++)x[C[A]]=A;return function(P){return y(P,x)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(C){for(var x=new Int32Array(C.length),A=0;A<C.length;A++)x[C[C.length-A-1]]=A;return function(P){return y(P,x)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(gr||(gr={}));var sS=Object.prototype.hasOwnProperty;function QX(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];!sS.call(t,a)||typeof e[a]=="undefined"&&(e[a]=t[a])}return e}function ZX(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(!!sS.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function uS(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!sS.call(e,i)||e[i]!==t[i])return!1}return!0}function $X(e,t){for(var r=e,n=0;n<t.length;n++)if(!!t[n]&&(r=ZX(e,t[n]),r!==e)){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}function Cd(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=Cd(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var a in e)sS.call(e,a)&&(t[a]=Cd(e[a]));return t}throw new Error(`Can't clone, type "`.concat(typeof e,'" unsupported'))}function ns(e,t){if(!!e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function T8(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1".concat(t,"$2"))}function Ya(e){return Pm(T8(e))}var JX=function(e){return e.toUpperCase()};function eY(e){return e?typeof e=="string"?e.toUpperCase():"".concat(e).toUpperCase():""}function Pm(e){return e.toLowerCase().replace(/^\w|\s\w/g,JX)}function tY(e){return e.replace(/_/g," ")}function rY(e){return e.replace(/-/g," ")}function mo(e){return Pm(T8(tY(rY(e))))}function Vn(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function nY(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,It(It([void 0],r,!1),["return `".concat(e,"`;")],!1)))().apply(void 0,n)}function jc(e){return e.replace(/<\/?[^>]+>/g,"")}function Ra(){return Ra.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,I,M){var B=t();return B[0]=D,B[1]=I,B[2]=M,B}e.create=r;function n(D,I){var M=$e.toRgb(I),B=M[0],U=M[1],V=M[2],F=T(B,U,V),Y=F[0],W=F[1],K=F[2],$=116*W-16;return D[0]=$<0?0:$,D[1]=500*(Y-W),D[2]=200*(W-K),D}e.fromColor=n;function a(D,I){return Tu.toLab(D,I)}e.fromHcl=a;function i(D){var I=(D[0]+16)/116,M=isNaN(D[1])?I:I+D[1]/500,B=isNaN(D[2])?I:I-D[2]/200;I=m*x(I),M=v*x(M),B=h*x(B);var U=C(3.2404542*M-1.5371385*I-.4985314*B),V=C(-.969266*M+1.8760108*I+.041556*B),F=C(.0556434*M-.2040259*I+1.0572252*B);return $e.fromRgb(Math.round(Ha(U,0,255)),Math.round(Ha(V,0,255)),Math.round(Ha(F,0,255)))}e.toColor=i;function o(D,I){var M=I[0],B=I[1],U=I[2],V=Math.sqrt(B*B+U*U),F=(Fs(Math.atan2(U,B))+360)%360;return Math.round(V*1e4)===0&&(F=Number.NaN),D[0]=F,D[1]=V,D[2]=M,D}e.toHcl=o;function s(D,I){return D[0]=I[0],D[1]=I[1],D[2]=I[2],D}e.copy=s;function u(D,I,M){return D[0]=I[0]-p*M,D[1]=I[1],D[2]=I[2],D}e.darken=u;function l(D,I,M){return u(D,I,-M)}e.lighten=l;var c=[0,0,0];function d(D,I,M){return o(c,I),Tu.toLab(D,Tu.saturate(c,c,M))}e.saturate=d;function f(D,I,M){return d(D,I,-M)}e.desaturate=f;var p=18,v=.95047,m=1,h=1.08883,g=.137931034,y=.206896552,b=.12841855,S=.008856452;function C(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function x(D){return D>y?D*D*D:b*(D-g)}function A(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function P(D){return D>S?Math.pow(D,1/3):D/b+g}function T(D,I,M){D=A(D),I=A(I),M=A(M);var B=P((.4124564*D+.3575761*I+.1804375*M)/v),U=P((.2126729*D+.7151522*I+.072175*M)/m),V=P((.0193339*D+.119192*I+.9503041*M)/h);return[B,U,V]}})(Ra||(Ra={}));function Tu(){return Tu.zero()}(function(e){function t(){var h=[.1,0,0];return h[0]=0,h}e.zero=t;function r(h,g,y){var b=t();return b[0]=h,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function a(h,g){return Ra.toHcl(h,Ra.fromColor(n,g))}e.fromColor=a;function i(h,g){return Ra.toHcl(h,g)}e.fromLab=i;var o=[0,0,0];function s(h){return Ra.toColor(u(o,h))}e.toColor=s;function u(h,g){var y=g[0],b=g[1],S=g[2];return isNaN(y)&&(y=0),y=wr(y),h[0]=S,h[1]=Math.cos(y)*b,h[2]=Math.sin(y)*b,h}e.toLab=u;function l(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h}e.copy=l;function c(h,g,y){return h[0]=g[0],h[1]=Math.max(0,g[1]+m*y),h[2]=g[2],h}e.saturate=c;function d(h,g,y){return c(h,g,-y)}e.desaturate=d;var f=[0,0,0];function p(h,g,y){return u(f,g),Ra.toHcl(h,Ra.darken(f,f,y))}e.darken=p;function v(h,g,y){return p(h,g,-y)}e.lighten=v;var m=18})(Tu||(Tu={}));function $e(e){return e}(function(e){function t(T){return"rgb(".concat(T>>16&255,", ").concat(T>>8&255,", ").concat(T&255,")")}e.toStyle=t;function r(T){return"0x"+("000000"+T.toString(16)).slice(-6)}e.toHexString=r;function n(T){return"RGB: ".concat(e.toRgb(T).join(", "))}e.toRgbString=n;function a(T){return[T>>16&255,T>>8&255,T&255]}e.toRgb=a;function i(T){return[(T>>16&255)/255,(T>>8&255)/255,(T&255)/255]}e.toRgbNormalized=i;function o(T,D,I){return T<<16|D<<8|I}e.fromRgb=o;function s(T,D,I){return T*255<<16|D*255<<8|I*255}e.fromNormalizedRgb=s;function u(T,D){return o(T[D],T[D+1],T[D+2])}e.fromArray=u;function l(T,D){return s(T[D],T[D+1],T[D+2])}e.fromNormalizedArray=l;function c(T,D,I){return D[I]=T>>16&255,D[I+1]=T>>8&255,D[I+2]=T&255,D}e.toArray=c;function d(T,D,I){return D[I]=(T>>16&255)/255,D[I+1]=(T>>8&255)/255,D[I+2]=(T&255)/255,D}e.toArrayNormalized=d;function f(T,D){return T[0]=D>>16&255,T[1]=D>>8&255,T[2]=D&255,T}e.toVec3=f;function p(T,D){return T[0]=(D>>16&255)/255,T[1]=(D>>8&255)/255,T[2]=(D&255)/255,T}e.toVec3Normalized=p;function v(T,D,I){var M=T>>16&255,B=T>>8&255,U=T&255,V=D>>16&255,F=D>>8&255,Y=D&255,W=M+(V-M)*I,K=B+(F-B)*I,$=U+(Y-U)*I;return W<<16|K<<8|$}e.interpolate=v;var m=[0,0,0];function h(T,D){return Tu.fromColor(m,T),Tu.toColor(Tu.saturate(m,m,D))}e.saturate=h;function g(T,D){return h(T,-D)}e.desaturate=g;var y=[0,0,0];function b(T,D){return Ra.fromColor(y,T),Ra.toColor(Ra.darken(y,y,D))}e.darken=b;function S(T,D){return b(T,-D)}e.lighten=S;function C(T){return T<.04045?T*.0773993808:Math.pow(T*.9478672986+.0521327014,2.4)}function x(T){return s(C((T>>16&255)/255),C((T>>8&255)/255),C((T&255)/255))}e.sRGBToLinear=x;function A(T){return T<.0031308?T*12.92:1.055*Math.pow(T,.41666)-.055}function P(T){return s(A((T>>16&255)/255),A((T>>8&255)/255),A((T&255)/255))}e.linearToSRGB=P})($e||($e={}));function cr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function lS(e,t,r){var n={};for(var a in e){var i=e[a];i=$e.saturate(i,t),i=$e.darken(i,-r),n[a]=i}return n}var Ki={"orange-red":cr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":cr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":cr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:cr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":cr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":cr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":cr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:cr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":cr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:cr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":cr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:cr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":cr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:cr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":cr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":cr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:cr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":cr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:cr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":cr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":cr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":cr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":cr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":cr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":cr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":cr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":cr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":cr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:cr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":cr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":cr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":cr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:cr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":cr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":cr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":cr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:cr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:cr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:cr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:cr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:cr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:cr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:cr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:cr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":cr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},aY=Object.keys(Ki),JT=aY.map(function(e){return[e,Ki[e].label,Pm(Ki[e].type)]}),iY=JT.filter(function(e){return Ki[e[0]].type==="diverging"||Ki[e[0]].type==="sequential"}),oY=JT.filter(function(e){return Ki[e[0]].type==="qualitative"});function as(e){return e in Ki?Ki[e]:(console.warn("unknown color list named '".concat(e,"'")),Ki["red-yellow-blue"])}var Le;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function n(f,p,v,m,h){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=v,g[y+2]=m,g[y+3]=h,f.currentIndex+=4,f.elementCount++}e.add4=n;function a(f,p,v,m){f.currentIndex>=f.currentSize&&r(f);var h=f.currentChunk,g=f.currentIndex;return h[g]=p,h[g+1]=v,h[g+2]=m,f.currentIndex+=3,f.elementCount++}e.add3=a;function i(f,p,v){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,h=f.currentIndex;return m[h]=p,m[h+1]=v,f.currentIndex+=2,f.elementCount++}e.add2=i;function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,p,v){for(var m=0;m<p;m++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=v,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,p){for(var v=f.elementSize,m=0,h=p.length;m<h;m+=v){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<v;y++)g[f.currentIndex++]=p[m+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,p){return p===void 0&&(p=!1),c(f,p)}e.compact=l;function c(f,p){var v=f.ctor,m=f.chunks,h=f.currentIndex;if(!m.length)return new v(0);if(m.length===1&&(p||h===f.allocatedSize))return m[0];for(var g=0,y=0,b=m.length-1;y<b;y++)g+=m[y].length;g+=f.currentIndex;var S=new v(g),C=0;if(S.buffer)for(var y=0,b=m.length-1;y<b;y++)S.set(m[y],C),C+=m[y].length;else for(var y=0,b=m.length-1;y<b;y++){for(var x=m[y],A=0,P=x.length;A<P;A++)S[C+A]=x[A];C+=x.length}var T=m[m.length-1];if(S.buffer&&h>=f.currentSize)S.set(T,C);else for(var A=0,P=T.length;A<P;A++)S[C+A]=T[A];return S}e._compact=c;function d(f,p,v,m){var h={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(v)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof m=="undefined")return h;if(typeof m=="number")return h.currentChunk=new f(m*p),h.allocatedSize=m*p,h.currentSize=h.currentChunk.length,h.chunks[0]=h.currentChunk,h;var g=m;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return h.currentChunk=g,h.allocatedSize=g.length,h.currentSize=g.length,h.chunks[0]=g,h}e.create=d})(Le||(Le={}));function gb(e,t,r){return e[t]-e[r]}function xf(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function P8(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function sY(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,P8(i,n,t,r));n(i,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(i,l,t);if(c>0){for(a(i,l,u),--u;n(i,u,t)>0;)--u;l--}else c===0&&(a(i,l,s),s++)}for(var l=t;l<s;l++)a(i,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function uY(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s=s-1}function yb(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){uY(e,t,r);return}sY(e,t,r);var a=n[0],i=n[1];a-t<r-i?(yb(e,t,a-1),t=i+1):(yb(e,i+1,r),r=a-1)}}function lY(e,t,r,n){var a=r+1,i=n;xf(e,r,P8(e,gb,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(xf(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(xf(e,s,a),++a)}for(var s=r;s<a;s++)xf(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function cY(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i=i-1;e[i+1]=a}}function __(e,t,r,n){for(;r<n;){if(n-r<16){cY(e,r,n);return}lY(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(__(e,t,r,a-1),r=i+1):(__(e,t,i+1,n),n=a-1)}}function Ns(e,t){return t===void 0&&(t=gb),dY(e,0,e.length,t)}function dY(e,t,r,n){return n===void 0&&(n=gb),n===gb?__(e,[0,0],t,r-1):yb({data:e,cmp:n,swap:xf,parts:[0,0]},t,r-1),e}function E8(e,t,r,n,a){var i={data:e,cmp:n,swap:a,parts:[0,0]};return yb(i,t,r-1),e}function fY(e,t,r){return e[t].key<e[r].key?-1:1}function pY(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,l=n;l<a;l++){var c=t(e[l]);if(i.has(c))i.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};i.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=a;var p=!0;if(r){for(var l=1,v=o.length;l<v;l++)if(o[l-1].key>o[l].key){p=!1;break}}if(u&&p){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!p&&E8(o,0,o.length,fY,xf);for(var m=0,l=0;l<o.length;l++){var h=o[l];h.offset=m,m+=h.count}for(var g=new Int32Array(a-n),l=n;l<a;l++){var c=t(e[l]),d=i.get(c);g[d.offset++]=e[l]}for(var l=0,v=g.length;l<v;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function cC(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return pY(e,t,!!(r&&r.sort),n,a)}var vY=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function mY(e,t){return new vY(e,t)}function I8(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function pp(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function hY(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function gY(e,t,r,n){var a=23;return a=31*a+e|0,a=31*a+t|0,a=31*a+r|0,a=31*a+n|0,a=a^a>>4,a=(a^3735928559)+(a<<5),a=a^a>>11,a}function eP(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function Jo(e,t){return(e+t)*(e+t+1)/2+t}function sD(e,t){return e<t?Jo(e,t):Jo(t,e)}function yY(e,t){var r=Math.floor((Math.sqrt(8*t+1)-1)/2),n=(r*r+r)/2,a=t-n;return e[0]=r-a,e[1]=a,e}function vi(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function bb(e,t){var r=t&&typeof t.start!="undefined"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end!="undefined"?Math.min(t.end,e):e;return{start:r,end:n}}function xg(e,t){var r=t&&typeof t.array!="undefined"?t.array:Array,n=bb(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function bY(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}function Ia(e,t,r){var n=xg(e,r),a=n.array,i=n.start;return bY(t,a,i)}function tP(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function Sb(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=bb(a,t),u=s.start,l=s.end;return u===0&&l===a?e:new r(n,i+o*u,Math.min(a,l-u))}function lf(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return ud(e,t,r)}function ud(e,t,r){var n=t,a=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function uD(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,ud(t,r,n))}function SY(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return bl(e,t,r)}function bl(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)i=i*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?uD(a*(i+o/s),e,n+1,r):a*(i+o/s);return a*(i+o/s)}else{if(u===53||u===21)return uD(a*i,e,n+1,r);break}}return a*i}var ce;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function I(K){return K===void 0&&(K=""),{"@type":"str",T:K,valueType:"str"}}D.Str=I;function M(K){return K===void 0&&(K=0),{"@type":"int",T:K,valueType:"int"}}D.Int=M;function B(K){return K===void 0&&(K=0),{"@type":"float",T:K,valueType:"float"}}D.Float=B;function U(K,$){return $===void 0&&($=D.float),{"@type":"tensor",T:K.create(),space:K,valueType:"tensor",baseType:$}}D.Tensor=U;function V(K,$){return $===void 0&&($=D.float),U(gr.Vector(K,$["@type"]==="int"?Int32Array:Float64Array),$)}D.Vector=V;function F(K,$,J){return J===void 0&&(J=D.float),U(gr.ColumnMajorMatrix(K,$,J["@type"]==="int"?Int32Array:Float64Array),J)}D.Matrix=F;function Y(K,$){return typeof $!="undefined"?_(_({},K),{T:$}):K}D.Aliased=Y;function W(K,$,J){return J===void 0&&(J=[]),{"@type":"list",T:J,separator:K,itemParse:$,valueType:"list"}}D.List=W})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,I){return lD(I.T,D,I,1)}e.Undefined=n;function a(D,I,M){return lD(D,I,M,0)}e.ofConst=a;function i(D){return dy(D)}e.ofLambda=i;function o(D,I){return i({value:function(M){return M+D},rowCount:Math.max(I-D+1,0),schema:t.int})}e.range=o;function s(D){return el(D)}e.ofArray=s;function u(D){return el({array:D,schema:t.int})}e.ofIntArray=u;function l(D){return el({array:D,schema:t.float})}e.ofFloatArray=l;function c(D){return el({array:D,schema:t.str})}e.ofStringArray=c;function d(D){return el({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(D,I){return I===void 0&&(I=","),el({array:D,schema:t.List(I,function(M){return M})})}e.ofStringListArray=f;function p(D){var I=D.count,M=D.data,B=D.indices;return dy({value:function(U){return ud(M,B[2*U],B[2*U+1])||0},rowCount:I,schema:t.int})}e.ofIntTokens=p;function v(D){var I=D.count,M=D.data,B=D.indices;return dy({value:function(U){return bl(M,B[2*U],B[2*U+1])||0},rowCount:I,schema:t.float})}e.ofFloatTokens=v;function m(D){var I=D.count,M=D.data,B=D.indices;return dy({value:function(U){var V=M.substring(B[2*U],B[2*U+1]);return V==="."||V==="?"?"":V},rowCount:I,schema:t.str})}e.ofStringTokens=m;function h(D,I,M){return wY(D,I,M)}e.window=h;function g(D,I,M){return M===void 0&&(M=!0),PY(D,I,M)}e.view=g;function y(D){return xY(D)}e.createFirstIndexMap=y;function b(D){return CY(D)}e.createIndexer=b;function S(D,I,M){return DY(D,I,M||Array)}e.mapToArray=S;function C(D,I){return MY(D,I)}e.areEqual=C;function x(D,I){return BY(D,I)}e.indicesOf=x;function A(D,I){return D.__array?D:D.isDefined?el({array:D.toArray({array:I}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=A;function P(D,I,M){if(M===void 0&&(M=0),!!D.isDefined){var B=D.__array;if(B)for(var U=0,V=B.length;U<V;U++)I[M+U]=B[U];else for(var U=0,V=D.rowCount;U<V;U++)I[M+U]=D.value(U)}}e.copyToArray=P;function T(D){for(var I=0,M=D.rowCount;I<M;I++)if(I!==D.value(I))return!1;return!0}e.isIdentity=T})(ce||(ce={}));function xY(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}function CY(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}function lD(e,t,r,n){var a=function(i){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:a,valueKind:function(i){return n},toArray:function(i){for(var o=xg(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function dy(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,a=e.rowCount,i=e.schema;return{schema:i,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=xg(a,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function el(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=tP(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:i,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=bb(a,s),l=u.start,c=u.end,d=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++){var v=t[l+f];d[f]=typeof v=="string"?v:""+v}return d}:o?function(s){return Sb(t,s)}:function(s){var u=bb(a,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function wY(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:!!e.__array&&tP(e.__array)?_Y(e,t,r):AY(e,t,r):ce.Undefined(r-t,e.schema)}function _Y(e,t,r){var n=Sb(e.__array,{start:t,end:r}),a=e.valueKind;return el({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}function AY(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?a:function(u){return a(u+t)},toArray:function(u){for(var l=xg(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?i:function(u,l){return i(u+t,l+t)}}}function TY(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function PY(e,t,r){return e.rowCount===0||r&&TY(t,e.rowCount)?e:!!e.__array&&typeof e.value(0)==typeof e.__array[0]?EY(e,t):IY(e,t)}function EY(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return el({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function IY(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,i=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:i,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=xg(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}function DY(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}function MY(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:!!e.__array&&!!t.__array?RY(e,t):OY(e,t)}function RY(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}function OY(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}function BY(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}var kr;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,C,x){x===void 0&&(x={});var A=Object.create(null),P=Object.keys(S);A._rowCount=C._rowCount,A._columns=P,A._schema=S;for(var T=0,D=P;T<D.length;T++){var I=D[T];if(C[I])A[I]=C[I];else if(x[I])A[I]=x[I];else throw Error("Cannot find column '".concat(I,"'."))}return A}e.pickColumns=r;function n(S,C){var x=Object.keys(C),A=C[x[0]].rowCount;return _({_rowCount:A,_columns:x,_schema:S},C)}e.ofColumns=n;function a(S,C,x){var A=Object.create(null),P=Object.keys(S);A._rowCount=x,A._columns=P,A._schema=S;for(var T=0,D=P;T<D.length;T++){var I=D[T];I in C?A[I]=C[I]:A[I]=ce.Undefined(x,S[I])}return A}e.ofPartialColumns=a;function i(S,C){var x=Object.create(null),A=Object.keys(S);x._rowCount=C,x._columns=A,x._schema=S;for(var P=0,T=A;P<T.length;P++){var D=T[P];x[D]=ce.Undefined(C,S[D])}return x}e.ofUndefinedColumns=i;function o(S,C){var x=Object.create(null),A=C.length,P=Object.keys(S);x._rowCount=A,x._columns=P,x._schema=S;for(var T=function(B){x[B]=ce.ofLambda({rowCount:A,schema:S[B],value:function(U){return C[U][B]},valueKind:function(U){return typeof C[U][B]=="undefined"?1:0}})},D=0,I=P;D<I.length;D++){var M=I[D];T(M)}return x}e.ofRows=o;function s(S,C){var x,A=Object.create(null),P=Object.keys(S);A._rowCount=0,A._columns=P,A._schema=S;for(var T=0,D=P;T<D.length;T++){var I=D[T];typeof C[I]!="undefined"?(A[I]=ce.ofArray({array:C[I],schema:S[I]}),A._rowCount=(x=C[I])===null||x===void 0?void 0:x.length):A[I]=ce.Undefined(A._rowCount,S[I])}return A}e.ofArrays=s;function u(S,C,x){var A=Object.create(null),P=Object.keys(C);A._rowCount=x.length,A._columns=P,A._schema=C;for(var T=0,D=P;T<D.length;T++){var I=D[T];A[I]=ce.view(S[I],x)}return A}e.view=u;function l(S,C,x){for(var A=[],P=0,T=S._rowCount;P<T;++P)x(P)&&A.push(P);return u(S,C,A)}e.pick=l;function c(S,C,x,A){if(x===0&&A===S._rowCount)return S;var P=Object.create(null),T=Object.keys(C);P._rowCount=A-x,P._columns=T,P._schema=C;for(var D=0,I=T;D<I.length;D++){var M=I[D];P[M]=ce.window(S[M],x,A)}return P}e.window=c;function d(S,C){var x=Object.create(null),A=Object.keys(C);x._rowCount=0;for(var P=0,T=S;P<T.length;P++){var D=T[P];x._rowCount+=D._rowCount}for(var I={},M=0,B=A;M<B.length;M++){var U=B[M];I[U]=new Array(x._rowCount)}x._columns=A,x._schema=C;for(var V=0,F=0,Y=S;F<Y.length;F++){for(var D=Y[F],W=0,K=A;W<K.length;W++){var $=K[W];ce.copyToArray(D[$],I[$],V)}V+=D._rowCount}for(var J=0,Z=A;J<Z.length;J++){var $=Z[J];x[$]=ce.ofArray({array:I[$],schema:C[$]})}return x}e.concat=d;function f(S,C,x){S[C]=ce.asArrayColumn(S[C],x)}e.columnToArray=f;function p(S,C){for(var x=new Int32Array(S._rowCount),A=0,P=x.length;A<P;A++)x[A]=A;Ns(x,function(U,V,F){return C(V,F)});for(var T=!0,A=0,P=x.length;A<P;A++)if(x[A]!==A){T=!1;break}if(T)return S;var D=Object.create(null);D._rowCount=S._rowCount,D._columns=S._columns,D._schema=S._schema;for(var I=0,M=S._columns;I<M.length;I++){var B=M[I];D[B]=ce.view(S[B],x,!1)}return D}e.sort=p;function v(S,C){if(S._rowCount!==C._rowCount||S._columns.length!==C._columns.length)return!1;for(var x=0,A=S._columns;x<A.length;x++){var P=A[x];if(!C[P])return!1}for(var T=0,D=S._columns;T<D.length;T++){var P=D[T];if(!ce.areEqual(S[P],C[P]))return!1}return!0}e.areEqual=v;function m(S,C){for(var x=Object.create(null),A=S._columns,P=0;P<A.length;P++){var T=A[P];x[T]=S[T].value(C)}return x}e.getRow=m;function h(S,C){for(var x=0,A=S._rowCount;x<A;++x)if(C(x))return m(S,x)}e.pickRow=h;function g(S){for(var C=[],x=S._rowCount,A=0;A<x;A++)C[A]=m(S,A);return C}e.getRows=g;function y(S){for(var C={},x=S._columns,A=0;A<x.length;A++){var P=x[A];C[P]=S[P].toArray()}return C}e.toArrays=y;function b(S){var C=Cr.create(),x=S._columns,A=S._rowCount,P=1;Cr.write(C,"|");for(var T=0;T<x.length;T++)Cr.write(C,x[T]),Cr.write(C,"|"),P+=x[T].length+1;Cr.newline(C),Cr.write(C,new Array(P+1).join("-")),Cr.newline(C);for(var D=0;D<A;D++){Cr.write(C,"|");for(var T=0;T<x.length;T++){var I=S[x[T]];I.valueKind(D)===0?(Cr.write(C,I.value(D)),Cr.write(C,"|")):Cr.write(C,".|")}Cr.newline(C)}return Cr.getString(C)}e.formatToString=b})(kr||(kr={}));var A_;(function(e){function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var l=0,c=o;l<c.length;l++){var d=c[l];!kr.is(i[d])||(s[d]=i[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=kr.getRows(n[s])}return a}e.getTablesAsRows=r})(A_||(A_={}));function rP(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function cS(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,a=r.value;if(n)break;t[t.length]=a}return t}function T_(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function kY(e,t){for(var r=new(LY(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function LY(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}function FY(){var e=function(){var m=typeof window!="undefined"&&window,h=typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&self,g=typeof e!="undefined"&&e;return m||g||h}(),t={},r=typeof document!="undefined"?document:void 0,n=1,a;function i(m){for(var h=[],g=1;g<arguments.length;g++)h[g-1]=arguments[g];typeof m!="function"&&(m=new Function(""+m));var y={callback:m,args:h};return t[n]=y,a(n),n++}function o(m){delete t[m]}function s(m){var h=m.callback,g=m.args;switch(g.length){case 0:h();break;case 1:h(g[0]);break;case 2:h(g[0],g[1]);break;case 3:h(g[0],g[1],g[2]);break;default:h.apply(void 0,g);break}}function u(m){var h=t[m];o(m),s(h)}function l(){a=function(m){process.nextTick(function(){u(m)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var m=!0,h=e.onmessage;return e.onmessage=function(){m=!1},e.postMessage("","*"),e.onmessage=h,m}}function d(){var m="setImmediate$"+Math.random()+"$",h=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(m)===0&&u(+g.data.slice(m.length))};window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent("onmessage",h),a=function(g){window.postMessage(m+g,"*")}}function f(){var m=new MessageChannel;m.port1.onmessage=function(h){var g=h.data;u(g)},a=function(h){m.port2.postMessage(h)}}function p(){var m=r.documentElement;a=function(h){var g=r.createElement("script");g.onreadystatechange=function(){u(h),g.onreadystatechange=null,m.removeChild(g),g=null},m.appendChild(g)}}function v(){a=function(m){setTimeout(u,0,m)}}return typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel!="undefined"?f():r&&"onreadystatechange"in r.createElement("script")?p():v(),{setImmediate:i,clearImmediate:o}}var P_=function(){return typeof setImmediate!="undefined"?typeof window!="undefined"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,It([e],r,!1))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:FY()}();function NY(e){P_.setImmediate(e)}var nP={setImmediate:P_.setImmediate,clearImmediate:P_.clearImmediate,immediatePromise:function(){return new Promise(NY)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},Cg=function(){try{return!0}catch{return!1}}(),Ar=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),UY=typeof performance!="undefined"&&performance.mark&&performance.measure,dC=UY&&!Cg,c0;(function(e){function t(o){return"startTask".concat(o.id)}function r(o){return"endTask".concat(o.id)}function n(o){dC&&performance.mark(t(o))}e.markStart=n;function a(o){dC&&performance.mark(r(o))}e.markEnd=a;function i(o){dC&&performance.measure("\u2733\uFE0F ".concat(o.name),t(o),r(o))}e.measure=i})(c0||(c0={}));function zY(e,t,r){r===void 0&&(r=250);var n=R8(e,t,r),a=new N8(n,n.root);return aP(e,a)}function VY(e,t,r){r===void 0&&(r=250);var n=R8(e,t,r);return new N8(n,n.root)}function D8(e,t){return aP(t,e)}function HY(e,t,r){return e.runChild(t,r)}function M8(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function R8(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:fn(),observer:t,abortToken:n,taskId:e.id,root:{progress:M8(e),children:[]},tryAbort:GY(n)}}function GY(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function O8(e){return{progress:_({},e.progress),children:e.children.map(O8)}}function B8(e){return e.progress.canAbort&&e.children.every(B8)}function qY(e){return{root:O8(e.root),canAbort:B8(e.root),requestAbort:e.tryAbort}}function aP(e,t){return se(this,void 0,void 0,function(){var r,n;return ie(this,function(a){switch(a.label){case 0:c0.markStart(e),t.node.progress.startedTime=fn(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),c0.markEnd(e),c0.measure(e),t.info.abortToken.abortRequested&&k8(t.info),[2,r];case 3:return n=a.sent(),Fe.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw n;case 7:return[2]}})})}function k8(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,L8(e.root),F8(e,fn())),Fe.Aborted(e.abortToken.reason)}function L8(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var a=n[r];L8(a)}}function F8(e,t){e.lastNotified=t;var r=qY(e);e.observer(r)}var N8=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,k8(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),fn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort!="undefined"&&(r.canAbort=t.canAbort),typeof t.message!="undefined"&&(r.message=t.message),typeof t.current!="undefined"&&(r.current=t.current),typeof t.max!="undefined"&&(r.max=t.max),r.isIndeterminate=typeof r.current=="undefined"||typeof r.max=="undefined",typeof t.isIndeterminate!="undefined"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=fn(),this.updateProgress(t),!r)return F8(this.info,this.lastUpdatedTime),this.checkAborted(),nP.immediatePromise()},e.prototype.runChild=function(t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:M8(t),children:[]},a=this.node.children,a.push(n),i=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,aP(t,i)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),Fe.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=a.indexOf(n),s>=0){for(u=s,l=a.length-1;u<l;u++)a[u]=a[u+1];a.pop()}return a.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),jY=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),R1=new jY,Fe;(function(e){var t=function(){function d(f,p,v){this.name=f,this.f=p,this.onAbort=v,this.id=c()}return d.prototype.run=function(f,p){return p===void 0&&(p=250),f?zY(this,f,p):this.f(R1)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(R1):HY(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(R1):D8(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function a(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted".concat(d?": "+d:"")}}}e.Aborted=a;function i(d,f,p){return new t(d,f,p)}e.create=i;function o(d,f){var p=this;return i(d,function(v){return se(p,void 0,void 0,function(){return ie(this,function(m){return[2,f]})})})}e.constant=o;function s(){var d=this;return i("",function(f){return se(d,void 0,void 0,function(){return ie(this,function(p){return[2]})})})}e.empty=s;function u(d,f){var p=this;return i(d,function(v){return se(p,void 0,void 0,function(){return ie(this,function(m){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=gi(0,1073741823)})(Fe||(Fe={}));var cD;(function(e){e.Synchronous=R1})(cD||(cD={}));var dD;(function(e){function t(n,a){a===void 0&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message);var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message,`
`).concat(s.join(`
`)):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message,`
`).concat(s.join(`
`))}function r(n){return t(n.root)}e.format=r})(dD||(dD={}));function Pl(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=fn(),l=0,c=0,f.label=1;case 1:return(l=n(i,r))>0?(o+=l,d=fn()-u,c+=d,s+=d,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),i=Math.round(c*o/s)+1,u=fn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function WY(e){return e>>0}function Wc(e,t){return e[t]|e[t+1]<<8}function ff(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function pf(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function al(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function XY(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}function YY(e){return e.length<2?"0"+e:e}function KY(e,t,r){for(var n="",a,i=0;i<r;i++)n+="%"+YY(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return XY(e,t,r)}return a}function QY(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if((o&4294967295-(1<<7)+1)===0)e[t+a]=o,a++;else if((o&4294967295-(1<<11)+1)===0)e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else if((o&4294967295-(1<<16)+1)===0)e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else if((o&4294967295-(1<<21)+1)===0)e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4;else throw new Error("e")}return a}function U8(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if((a&4294967295-(1<<7)+1)===0)r++;else if((a&4294967295-(1<<11)+1)===0)r+=2;else if((a&4294967295-(1<<16)+1)===0)r+=3;else if((a&4294967295-(1<<21)+1)===0)r+=4;else throw new Error("e")}return r}var ZY=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function $Y(e,t,r,n){for(var a=0;a<n;a++)e=ZY[(e^t[r+a])&255]^e>>>8;return e}function z8(e,t,r){return $Y(4294967295,e,t,r)^4294967295}var ut=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,ut.rev15[t]=(r>>>16|r<<16)>>>17}function n(a,i,o){for(;i--!==0;)a.push(0,o)}for(var t=0;t<32;t++)ut.ldef[t]=ut.of0[t]<<3|ut.exb[t],ut.ddef[t]=ut.df0[t]<<4|ut.dxb[t];n(ut.fltree,144,8),n(ut.fltree,255-143,9),n(ut.fltree,279-255,7),n(ut.fltree,287-279,8),ld(ut.fltree,9),d0(ut.fltree,9,ut.flmap),f0(ut.fltree,9),n(ut.fdtree,32,5),ld(ut.fdtree,5),d0(ut.fdtree,5,ut.fdmap),f0(ut.fdtree,5),n(ut.itree,19,0),n(ut.ltree,286,0),n(ut.dtree,30,0),n(ut.ttree,320,0)})();function d0(e,t,r){for(var n=e.length,a=ut.rev15,i=0;i<n;i+=2)if(e[i+1]!==0)for(var o=i>>1,s=e[i+1],u=o<<4|s,l=t-s,c=e[i]<<l,d=c+(1<<l);c!==d;){var f=a[c]>>>15-t;r[f]=u,c++}}function ld(e,t){for(var r=e.length,n=ut.bl_count,a=0;a<=t;a++)n[a]=0;for(var a=1;a<r;a+=2)n[e[a]]++;var i=ut.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,i[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=i[l],i[l]++)}}function f0(e,t){for(var r=ut.rev15,n=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=r[i]>>>n}}function JY(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function eK(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;i===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;i=pC(r,s,1),u+=1;var p=pC(r,s+1,2);if(s+=3,p===0){(s&7)!==0&&(s+=8-(s&7));var v=(s>>>3)+4,m=r[v-4]|r[v-3]<<8;n&&(a=fC(a,o+m)),a.set(new Uint8Array(r.buffer,r.byteOffset+v,m),o),s=v+m<<3,o+=m;continue}if(n&&(a=fC(a,o+(1<<17))),p===1)l=ut.flmap,c=ut.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(p===2){var h=Bc(r,s,5)+257,g=Bc(r,s+5,5)+1,y=Bc(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)ut.itree[b]=0,ut.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var C=Bc(r,s+b*3,3);ut.itree[(ut.ordr[b]<<1)+1]=C,C>S&&(S=C)}s+=3*y,ld(ut.itree,S),d0(ut.itree,S,ut.imap),l=ut.lmap,c=ut.dmap,s=rK(ut.imap,(1<<S)-1,h+g,r,s,ut.ttree);var x=fD(ut.ttree,0,h,ut.ltree);d=(1<<x)-1;var A=fD(ut.ttree,h,g,ut.dtree);f=(1<<A)-1,ld(ut.ltree,x),d0(ut.ltree,x,l),ld(ut.dtree,A),d0(ut.dtree,A,c)}else throw new Error("unknown BTYPE ".concat(p));for(;;){var P=l[E_(r,s)&d];s+=P&15;var T=P>>>4;if(T>>>8===0)a[o++]=T;else{if(T===256)break;var D=o+T-254;if(T>264){var I=ut.ldef[T-257];D=o+(I>>>3)+Bc(r,s,I&7),s+=I&7}var M=c[E_(r,s)&f];s+=M&15;var B=M>>>4,U=ut.ddef[B],V=(U>>>4)+pC(r,s,U&15);for(s+=U&15,n&&(a=fC(a,o+(1<<17)));o<D;)a[o]=a[o++-V],a[o]=a[o++-V],a[o]=a[o++-V],a[o]=a[o++-V];o=D}}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}function tK(e,t,r){return se(this,void 0,void 0,function(){var n;return ie(this,function(a){switch(a.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=JY(t,r),a.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return eK(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function fC(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function rK(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[E_(n,a)&t];a+=s&15;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var l=0,c=0;u===16?(c=3+Bc(n,a,2),a+=2,l=i[o-1]):u===17?(c=3+Bc(n,a,3),a+=3):u===18&&(c=11+Bc(n,a,7),a+=7);for(var d=o+c;o<d;)i[o]=l,o++}}return a}function fD(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return a}function Bc(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function pC(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function E_(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function vC(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<a;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,v=1,m=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};v!==s-1;)p!==v&&(m===s||n[p].f<n[m].f)?d=n[p++]:d=n[m++],p!==v&&(m===s||n[p].f<n[m].f)?f=n[p++]:f=n[m++],n[v++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var h=I_(n[v-1],0);h>r&&(nK(u,r,h),h=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return h}function I_(e,t){return e.lit!==-1?(e.d=t,t):Math.max(I_(e.l,t+1),I_(e.r,t+1))}function nK(e,t,r){var n=0,a=0,i=1<<r-t;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a=a>>>r-t;a>0;){var o=e[n].d;o<t?(e[n].d++,a-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);a!==0&&console.log("debt left")}function aK(e,t,r,n){var a=ut.lits,i=ut.strt,o=ut.prev;return{data:e,out:t,opt:oK[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:a,strt:i,prev:o}}function iK(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,p=e.c,v=e.nc,m=ut.lits,h=ut.strt,g=ut.prev,y=Math.min(o+t,n);o<y;o++){if(p=v,o+1<n-2){v=iP(r,o+1);var b=o+1&32767;g[b]=h[v],h[v]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(m[l]=o-u,l+=2,u=o),s=V8(o===n-1||u===n?1:0,m,l,f,r,d,o-d,a,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=uK(r,o,g,p,Math.min(i[2],n-o),i[3])),S!==0){var C=S>>>16,x=S&65535,A=mD(C,ut.of0);ut.lhst[257+A]++;var P=mD(x,ut.df0);ut.dhst[P]++,f+=ut.exb[A]+ut.dxb[P],m[l]=C<<23|o-u,m[l+1]=x<<16|A<<8|P,l+=2,u=o+C}else ut.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=p,e.nc=v}var oK=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function sK(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,h;return ie(this,function(g){switch(g.label){case 0:if(i=aK(t,r,n,a),o=i.dlen,a===0){for(s=i.i,u=i.pos;s<o;)l=Math.min(65535,o-s),vf(r,u,s+l===o?1:0),u=H8(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(i.nc=iP(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return iK(i,1024*1024),[3,1];case 4:for(c=i.li,d=i.cvrd,f=i.pos,p=i.i,v=i.lits,m=i.bs,h=i.ebits,(m!==p||t.length===0)&&(d<p&&(v[c]=p-d,c+=2,d=p),f=V8(1,v,c,h,t,m,p-m,r,f));(f&7)!==0;)f++;return[2,f>>>3]}})})}function uK(e,t,r,n,a,i){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==iP(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--i!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=lK(e,t,u);if(f>l){if(l=f,c=u,l>=a)break;u+2<f&&(f=u+2);for(var p=0,v=0;v<f-2;v++){var m=t-u+v+32768&32767,h=r[m],g=m-h+(1<<15)&32767;g>p&&(p=g,s=m)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function lK(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function iP(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function V8(e,t,r,n,a,i,o,s,u){ut.lhst[256]++;var l=cK(),c=l[0],d=l[1],f=l[2],p=l[3],v=l[4],m=l[5],h=l[6],g=l[7],y=((u+3&7)===0?0:8-(u+3&7))+32+(o<<3),b=n+oh(ut.fltree,ut.lhst)+oh(ut.fdtree,ut.dhst),S=n+oh(ut.ltree,ut.lhst)+oh(ut.dtree,ut.dhst);S+=14+3*m+oh(ut.itree,ut.ihst)+(ut.ihst[16]*2+ut.ihst[17]*3+ut.ihst[18]*7);for(var C=0;C<286;C++)ut.lhst[C]=0;for(var C=0;C<30;C++)ut.dhst[C]=0;for(var C=0;C<19;C++)ut.ihst[C]=0;var x=y<b&&y<S?0:b<S?1:2;if(O1(s,u,e),O1(s,u+1,x),u+=3,x===0){for(;(u&7)!==0;)u++;u=H8(a,i,o,s,u)}else{var A=void 0,P=void 0;if(x===1)A=ut.fltree,P=ut.fdtree;else if(x===2){ld(ut.ltree,c),f0(ut.ltree,c),ld(ut.dtree,d),f0(ut.dtree,d),ld(ut.itree,f),f0(ut.itree,f),A=ut.ltree,P=ut.dtree,vf(s,u,p-257),u+=5,vf(s,u,v-1),u+=5,vf(s,u,m-4),u+=4;for(var T=0;T<m;T++)vf(s,u+T*3,ut.itree[(ut.ordr[T]<<1)+1]);u+=3*m,u=pD(h,ut.itree,s,u),u=pD(g,ut.itree,s,u)}else throw new Error("unknown BTYPE ".concat(x));for(var D=i,I=0;I<r;I+=2){for(var M=t[I],B=M>>>23,U=D+(M&(1<<23)-1);D<U;)u=Uh(a[D++],A,s,u);if(B!==0){var V=t[I+1],F=V>>16,Y=V>>8&255,W=V&255;u=Uh(257+Y,A,s,u),vf(s,u,B-ut.of0[Y]),u+=ut.exb[Y],u=Uh(W,P,s,u),O1(s,u,F-ut.df0[W]),u+=ut.dxb[W],D+=B}}u=Uh(256,A,s,u)}return u}function H8(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function cK(){for(var e=vC(ut.lhst,ut.ltree,15),t=vC(ut.dhst,ut.dtree,15),r=[],n=vD(ut.ltree,r),a=[],i=vD(ut.dtree,a),o=0;o<r.length;o+=2)ut.ihst[r[o]]++;for(var o=0;o<a.length;o+=2)ut.ihst[a[o]]++;for(var s=vC(ut.ihst,ut.itree,7),u=19;u>4&&ut.itree[(ut.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,i,u,r,a]}function oh(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function pD(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=Uh(i,t,r,n);var s=i===16?2:i===17?3:7;i>15&&(vf(r,n,o),n+=s)}return n}function vD(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(a===0&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(a===s&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(a,0)}return r>>>1}function mD(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function Uh(e,t,r,n){return O1(r,n,t[e<<1]),n+t[(e<<1)+1]}function vf(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function O1(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function oP(e,t,r){return r===void 0&&(r=!1),se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;pf(a,i)!==101010256;)i--;o=i,o+=4,o+=4,s=Wc(a,o),o+=2,o+=2,o+=4,u=pf(a,o),o+=4,o=u,l=0,h.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=pf(a,o),o+=4,d=pf(a,o),o+=4,f=Wc(a,o),p=Wc(a,o+2),v=Wc(a,o+4),o+=6,o+=8,m=pf(a,o),o+=4,o+=f+p+v,[4,dK(e,a,m,n,c,d,r)]):[3,4];case 2:h.sent(),h.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function dK(e,t,r,n,a,i,o){return se(this,void 0,void 0,function(){var s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:return r+=4,r+=2,r+=2,s=Wc(t,r),r+=2,r+=4,r+=4,r+=8,u=Wc(t,r),r+=2,l=Wc(t,r),r+=2,c=KY(t,r,u),r+=u,r+=l,o?(n[c]={size:i,csize:a},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+a)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(i),[4,G8(e,d,f)]);case 2:return p.sent(),n[c]=f,[3,4];case 3:throw new Error("unknown compression method: ".concat(s));case 4:return[2]}})})}function G8(e,t,r){return se(this,void 0,void 0,function(){return ie(this,function(n){return[2,tK(e,t,r)]})})}function fK(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:if(n=t[3],a=10,n&4&&(i=Wc(t,a),a+=i),n&8){for(o=a;t[o]!==0;)++o;a=o+1}if(n&16){for(o=a;t[o]!==0;)++o;a=o+1}return n&1&&(a+=2),s=WY(pf(t,t.length-8)),u=pf(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,G8(e,l,r)];case 1:return c=f.sent(),d=z8(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function pK(e,t,r){return se(this,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,sK(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function vK(e,t){return t===void 0&&(t=!1),Fe.create("Zip",function(r){return mK(r,e,t)})}function mK(e,t,r){return r===void 0&&(r=!1),se(this,void 0,void 0,function(){var n,a,i,o,s,b,u,l,c,d,f,p,b,v,m,h,b,S,g,y,b,S,C,x;return ie(this,function(A){switch(A.label){case 0:n=0,a={},i=[];for(o in t)i.push(o);s=0,A.label=1;case 1:return s<i.length?(b=i[s],u=!hK(b)&&!r,l=t[b],c=z8(l,0,l.length),d=a,f=b,x={cpr:u,usize:l.length,crc:c},u?[4,pK(e,l)]:[3,3]):[3,6];case 2:return p=A.sent(),[3,4];case 3:p=l,A.label=4;case 4:d[f]=(x.file=p,x),A.label=5;case 5:return s++,[3,1];case 6:for(b in a)n+=a[b].file.length+30+46+2*U8(b);n+=22,v=new Uint8Array(n),m=0,h=[];for(b in a)S=a[b],h.push(m),m=hD(v,m,b,S,0);g=0,y=m;for(b in a)S=a[b],h.push(m),m=hD(v,m,b,S,1,h[g++]);return C=m-y,al(v,m,101010256),m+=4,m+=4,ff(v,m,g),m+=2,ff(v,m,g),m+=2,al(v,m,C),m+=4,al(v,m,y),m+=4,m+=2,[2,v.buffer]}})})}function hK(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function hD(e,t,r,n,a,i){i===void 0&&(i=0);var o=n.file;al(e,t,a===0?67324752:33639248),t+=4,a===1&&(t+=2),ff(e,t,20),t+=2,ff(e,t,0),t+=2,ff(e,t,n.cpr?8:0),t+=2,al(e,t,0),t+=4,al(e,t,n.crc),t+=4,al(e,t,o.length),t+=4,al(e,t,n.usize),t+=4,ff(e,t,U8(r)),t+=2,ff(e,t,0),t+=2,a===1&&(t+=2,t+=2,t+=6,al(e,t,i),t+=4);var s=QY(e,t,r);return t+=s,a===0&&(e.set(o,t),t+=o.length),t}function gv(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var gK=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function q8(e){throw new Error(e)}function yK(e,t,r){for(var n=gK,a=void 0,i=0,o=[],s=512,u=t,l=t+r;u<l;u++){var c=e[u];(c&128)===0?o[i++]=n[c]:(c&224)===192?o[i++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?o[i++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?o[i++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):q8("Invalid byte "+c.toString(16)),i===s&&(a=a||[],a[a.length]=o.join(""),i=0)}return a?(i>0&&(a[a.length]=o.slice(0,i).join("")),a.join("")):o.slice(0,i).join("")}var gD=typeof TextDecoder!="undefined"?new TextDecoder:void 0;function sP(e,t,r){if(gD){var n=t||r!==e.length?e.subarray(t,t+r):e;return gD.decode(n)}else return yK(e,t,r)}function xb(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}q8("bad codepoint "+a)}return t}var bK=typeof document=="undefined"?require("xhr2"):XMLHttpRequest,Us;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Us||(Us={}));function Xc(e,t){return _K(e,t)}function D_(e){return typeof e=="string"?bD(e,e,"string"):bD(e.title,e.url,e.type||"string",e.body,e.headers)}function SK(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function yD(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function j8(e,t,r){return new Promise(function(n,a){if(SK(r)){var i=r.error;i!=null?a(i!=null?i:yD(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;a(u!=null?u:yD(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:"".concat(t," ").concat((s.loaded/1024/1024).toFixed(2)," MB"),isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}})}function xK(e){return/\.gz$/i.test(e)?Us.Gzip:/\.zip$/i.test(e)?Us.Zip:Us.None}function CK(e,t,r){return se(this,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:switch(n=r,n){case Us.None:return[3,1];case Us.Gzip:return[3,2];case Us.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,fK(e,t)];case 3:return[4,oP(e,t.buffer)];case 4:if(a=o.sent(),i=Object.keys(a),i.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function wK(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s;return ie(this,function(u){switch(u.label){case 0:if(a=t.result,i=a instanceof ArrayBuffer?new Uint8Array(a):a,i===null)throw new Error("no data given");if(n===Us.None)return[3,4];if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,CK(e,i,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),i=sP(o,0,o.length),[3,4];case 3:i=o,u.label=4;case 4:return r==="binary"&&i instanceof Uint8Array?[2,i]:[3,5];case 5:return r==="zip"&&i instanceof Uint8Array?[4,oP(e,i.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof i=="string")return[2,i];if(r==="xml"&&typeof i=="string")return s=new DOMParser,[2,s.parseFromString(i,"application/xml")];if(r==="json"&&typeof i=="string")return[2,JSON.parse(i)];u.label=8;case 8:throw new Error("could not get requested response data '".concat(r,"'"))}})})}function _K(e,t){var r=this,n=void 0;return Fe.create("Read File",function(a){return se(r,void 0,void 0,function(){var i,o;return ie(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i=t==="zip"?Us.None:xK(e.name),t==="binary"||t==="zip"||i!==Us.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,j8(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,wK(a,o,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var M_=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new bK},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function AK(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(M_.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '".concat(t,"'"))}else throw M_.deposit(e),new Error("Download failed with status code ".concat(e.status))}function TK(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function bD(e,t,r,n,a){var i=this,o=void 0;return Fe.create(e||"Download",function(s){return se(i,void 0,void 0,function(){var u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:if(o=M_.get(),o.open(n?"post":"get",t,!0),a)for(u=0,l=a;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=TK(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return m.sent(),[4,j8(s,"Downloading...",o)];case 2:return p=m.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return m.sent(),v=AK(p,r),[2,v]}})})},function(){o&&(o.abort(),o=void 0)})}function PK(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,v,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(h.sent(),o=[],s=[],u=0,l=Math.min(a,n);u<l;u++)v=r[u],o.push(xD(u,v.id,t.resolve(Kr.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,h.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=h.sent(),f=r[d.index],p=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error("".concat(f.url,": ").concat(d.error));return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:a})]:[3,5];case 4:h.sent(),h.label=5;case 5:return i[d.index]=d,o=o.filter(SD,p),s=s.filter(SD,p),u<a&&(v=r[u],m=t.resolve(Kr.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e),o.push(xD(u,v.id,m)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function SD(e,t){return this!==t}function xD(e,t,r){return se(this,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return n=i.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return a=i.sent(),[2,{kind:"error",error:a,index:e,id:t}];case 3:return[2]}})})}var Kr;(function(e){function t(u,l){return _({kind:"url",id:Jr.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:Jr.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function a(u){return(u==null?void 0:u.kind)==="file"}e.isFile=a;function i(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=i;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Kr||(Kr={}));var EK=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return cS(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(Kr.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var a=this;return n===void 0&&(n=!0),Kr.isUrl(t)?Fe.create("Download ".concat(t.title||t.url),function(i){return se(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Kr).Wrapper,[4,Xc(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[m.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Kr).Wrapper,[4,D_(_(_({},t),{type:r})).runInContext(i)]);case 3:return[2,c.apply(l,[m.sent(),t,this])];case 4:return[4,D_(_(_({},t),{type:"binary"})).runInContext(i)];case 5:return d=m.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),v=(p=Kr).Wrapper,[4,Xc(f,r).runInContext(i)];case 6:return[2,v.apply(p,[m.sent(),t,this])]}})})}):Fe.create("Read ".concat(t.name),function(i){return se(a,void 0,void 0,function(){var o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Kr).Wrapper,[4,Xc(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '".concat(t.name,"' (").concat(t.id,")"));return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Kr).Wrapper,[4,Xc(t.file,r).runInContext(i)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);!r||(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),E;(function(e){e.Essential={isEssential:!0};function t(ae,re){return re&&(re.label&&(ae.label=re.label),re.description&&(ae.description=re.description),re.legend&&(ae.legend=re.legend),re.fieldLabels&&(ae.fieldLabels=re.fieldLabels),re.isHidden&&(ae.isHidden=re.isHidden),re.shortLabel&&(ae.shortLabel=re.shortLabel),re.twoColumns&&(ae.twoColumns=re.twoColumns),re.isEssential&&(ae.isEssential=re.isEssential),re.category&&(ae.category=re.category),re.hideIf&&(ae.hideIf=re.hideIf),re.help&&(ae.help=re.help)),ae}function r(ae){var re=_({},ae);return re.isOptional=!0,re}e.Optional=r;function n(ae,re){return t({type:"value",defaultValue:ae},re)}e.Value=n;function a(ae,re,O){return t({type:"select",defaultValue:Se(ae,re),options:re,cycle:O==null?void 0:O.cycle},O)}e.Select=a;function i(ae,re,O){var z=t({type:"multi-select",defaultValue:ae,options:re},O);return(O==null?void 0:O.emptyValue)&&(z.emptyValue=O.emptyValue),z}e.MultiSelect=i;function o(ae,re){return t({type:"boolean",defaultValue:ae},re)}e.Boolean=o;function s(ae,re){return ae===void 0&&(ae=""),t({type:"text",defaultValue:ae},re)}e.Text=s;function u(ae,re){var O=t({type:"color",defaultValue:ae},re);return(re==null?void 0:re.isExpanded)&&(O.isExpanded=re.isExpanded),O}e.Color=u;function l(ae,re){var O;if(typeof ae=="string"){var z=as(ae);O={kind:z.type!=="qualitative"?"interpolate":"set",colors:z.list}}else O=ae;return t({type:"color-list",presetKind:(re==null?void 0:re.presetKind)||"all",defaultValue:O,offsets:!!(re==null?void 0:re.offsets)},re)}e.ColorList=l;function c(ae,re,O){return t(m({type:"vec3",defaultValue:ae},re),O)}e.Vec3=c;function d(ae,re){return t({type:"mat4",defaultValue:ae},re)}e.Mat4=d;function f(ae,re){var O=typeof ae=="string"?Kr.Url(ae):Kr.Url(ae.url,{body:ae.body}),z=t({type:"url",defaultValue:O},re);return z}e.Url=f;function p(ae){var re=t({type:"file",defaultValue:null},ae);return(ae==null?void 0:ae.accept)&&(re.accept=ae.accept),re}e.File=p;function v(ae){var re=t({type:"file-list",defaultValue:null},ae);return(ae==null?void 0:ae.accept)&&(re.accept=ae.accept),re}e.FileList=v;function m(ae,re){return re&&(typeof re.min!="undefined"&&(ae.min=re.min),typeof re.max!="undefined"&&(ae.max=re.max),typeof re.step!="undefined"&&(ae.step=re.step)),ae}function h(ae,re,O){var z=t(m({type:"number",defaultValue:ae},re),O);return(O==null?void 0:O.immediateUpdate)&&(z.immediateUpdate=!0),z}e.Numeric=h;function g(ae,re,O){return t(m({type:"interval",defaultValue:ae},re),O)}e.Interval=g;function y(ae,re){return t({type:"line-graph",defaultValue:ae},re)}e.LineGraph=y;function b(ae,re){var O=t({type:"group",defaultValue:(re==null?void 0:re.customDefault)||F(ae),params:ae},re);return(re==null?void 0:re.presets)&&(O.presets=re.presets),(re==null?void 0:re.isExpanded)&&(O.isExpanded=re.isExpanded),(re==null?void 0:re.isFlat)&&(O.isFlat=re.isFlat),(re==null?void 0:re.pivot)&&(O.pivot=re.pivot),O}e.Group=b;function S(ae){return b({},ae)}e.EmptyGroup=S;function C(ae,re,O,z){var de=Se(ae,re);return t({type:"mapped",defaultValue:{name:de,params:O(de).defaultValue},select:a(de,re,z),map:O},z)}e.Mapped=C;function x(ae,re,O){var z=(O==null?void 0:O.options)?O.options:Object.keys(re).map(function(me){return[me,re[me].label||mo(me)]}),de=Se(ae,z);return t({type:"mapped",defaultValue:{name:de,params:re[de].defaultValue},select:a(de,z,O),map:function(me){return re[me]}},O)}e.MappedStatic=x;function A(ae,re,O){return t({type:"object-list",element:ae,getLabel:re,ctor:P,defaultValue:(O==null?void 0:O.defaultValue)||[]},O)}e.ObjectList=A;function P(){return F(this.element)}function T(){throw new Error("getValue not set. Fix runtime.")}function D(ae,re,O){var z;return t({type:"value-ref",defaultValue:{ref:(z=O==null?void 0:O.defaultRef)!==null&&z!==void 0?z:"",getValue:T},getOptions:ae,resolveRef:re},O)}e.ValueRef=D;function I(ae){var re;return t({type:"data-ref",defaultValue:{ref:(re=ae==null?void 0:ae.defaultRef)!==null&&re!==void 0?re:"",getValue:T}},ae)}e.DataRef=I;function M(ae,re,O){return{type:"converted",defaultValue:re(O.defaultValue),converted:O,fromValue:ae,toValue:re}}e.Converted=M;function B(ae,re,O,z,de){var me=Object.keys(re).map(function(ye){return[ye,ye]});return t({type:"conditioned",select:a(O(ae),me,de),defaultValue:ae,conditionParams:re,conditionForValue:O,conditionedValue:z},de)}e.Conditioned=B;function U(ae,re){return t({type:"script",defaultValue:ae},re)}e.Script=U;function V(ae){return 0}e.For=V;function F(ae){for(var re={},O=0,z=Object.keys(ae);O<z.length;O++){var de=z[O];ae[de].isOptional||(re[de]=ae[de].defaultValue)}return re}e.getDefaultValues=F;function Y(ae,re){return function(){return ae(re)}}function W(ae,re,O){if(!!re){if(ae.type==="value-ref"){var z=re;z.ref?z.getValue=Y(ae.resolveRef,z.ref):z.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="data-ref"){var z=re;z.ref?z.getValue=Y(O,z.ref):z.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ae.type==="group")J(ae.params,re,O);else if(ae.type==="mapped"){var z=re,de=ae.map(z.name);W(de,z.params,O)}else if(ae.type==="object-list"){if(!$(ae.element))return;for(var me=0,ye=re;me<ye.length;me++){var Te=ye[me];J(ae.element,Te,O)}}}}function K(ae){if(ae.type==="value-ref"||ae.type==="data-ref")return!0;if(ae.type==="group"){if($(ae.params))return!0}else if(ae.type==="mapped")for(var re=0,O=ae.select.options;re<O.length;re++){var z=O[re][0];if(K(ae.map(z)))return!0}else if(ae.type==="object-list")return $(ae.element);return!1}function $(ae){for(var re=0,O=Object.keys(ae);re<O.length;re++){var z=O[re];if(K(ae[z]))return!0}return!1}function J(ae,re,O){for(var z=0,de=Object.keys(ae);z<de.length;z++){var me=de[z];W(ae[me],re==null?void 0:re[me],O)}}e.resolveRefs=J;function Z(ae,re){for(var O=0,z=Object.keys(ae);O<z.length;O++){var de=z[O];ae[de].isOptional||(ae[de].defaultValue=re[de])}}e.setDefaultValues=Z;function N(ae){return Cd(ae)}e.clone=N;function j(ae,re){}e.validate=j;function L(ae,re,O){if(re===O)return!0;if(typeof re!="object"||typeof O!="object")return!1;for(var z=0,de=Object.keys(ae);z<de.length;z++){var me=de[z];if(!H(ae[me],re[me],O[me]))return!1}return!0}e.areEqual=L;function H(ae,re,O){if(re===O)return!0;if(ae.type==="group")return L(ae.params,re,O);if(ae.type==="mapped"){var z=re,de=O;if(z.name!==de.name)return!1;var me=ae.map(z.name);return H(me,z.params,de.params)}else if(ae.type==="multi-select"){var z=re,de=O;if(z.length!==de.length)return!1;if(z.length<10){for(var ye=0,Te=z.length;ye<Te;ye++)if(z[ye]!==de[ye]&&de.indexOf(z[ye])<0)return!1}else for(var Oe=new Set(de),ye=0,Te=z.length;ye<Te;ye++)if(z[ye]!==de[ye]&&!Oe.has(z[ye]))return!1;return!0}else{if(ae.type==="interval")return re[0]===O[0]&&re[1]===O[1];if(ae.type==="line-graph"){var z=re,de=O;if(z.length!==de.length)return!1;for(var ye=0,Te=z.length;ye<Te;ye++)if(!ke.areEqual(z[ye],de[ye]))return!1;return!0}else{if(ae.type==="vec3")return w.equals(re,O);if(ae.type==="mat4")return oe.areEqual(re,O,zr);if(ae.type==="script"){var z=re,de=O;return z.language===de.language&&z.expression===de.expression}else if(ae.type==="object-list"){var z=re,de=O,Ue=z.length;if(Ue!==de.length)return!1;for(var ye=0;ye<Ue;ye++)if(!L(ae.element,z[ye],de[ye]))return!1;return!0}else if(typeof re=="object"&&typeof O=="object")return Yv(re,O)}}return!1}e.isParamEqual=H;function G(ae,re,O){if(re===void 0)return _({},O);if(O===void 0)return _({},re);for(var z=Object.create(null),de=0,me=Object.keys(ae);de<me.length;de++){var ye=me[de];z[ye]=q(ae[ye],re[ye],O[ye])}return z}e.merge=G;function q(ae,re,O){if(re===void 0)return typeof O=="object"&&!Array.isArray(O)?_({},O):O;if(O===void 0)return typeof re=="object"&&!Array.isArray(re)?_({},re):re;if(ae.type==="group")return G(ae.params,re,O);if(ae.type==="mapped"){var z=re,de=O;if(z.name!==de.name)return _({},de);var me=ae.map(de.name);return{name:de.name,params:q(me,z.params,de.params)}}else return ae.type==="value"?O:typeof re=="object"&&typeof O=="object"?Array.isArray(O)?O:_(_({},re),O):O}e.mergeParam=q;function X(ae,re){for(var O=0,z=ae.options;O<z.length;O++){var de=z[O];if(de[0]===re)return!0}return!1}function Q(ae,re,O){if(re==null)return O?ae.defaultValue:void 0;if(ae.type==="value")return re;if(ae.type==="group"){for(var z=Object.create(null),de=0,me=Object.keys(ae.params);de<me.length;de++){var ye=me[de],Te=ae.params[ye];re[ye]===void 0?O&&(z[ye]=Te.defaultValue):z[ye]=Q(Te,re[ye],O)}return z}else if(ae.type==="mapped"){var Oe=re;if(typeof Oe.name!="string")return ae.defaultValue;if(typeof Oe.params=="undefined")return O?ae.defaultValue:void 0;if(!X(ae.select,Oe.name))return ae.defaultValue;var Te=ae.map(Oe.name);return{name:Oe.name,params:Q(Te,Oe.params,O)}}else{if(ae.type==="select")return X(ae,re)?re:ae.defaultValue;if(ae.type==="multi-select"){if(!Array.isArray(re))return ae.defaultValue;var z=re.filter(function(Qe){return X(this,Qe)},ae);return re.length>0&&z.length===0?ae.defaultValue:z}else if(ae.type==="object-list")return Array.isArray(re)?re.map(function(Ue){return ue(ae.element,Ue,O?"all":"skip")}):ae.defaultValue}return re}function ue(ae,re,O){if(typeof re!="object"||re===null)return O?F(ae):re;for(var z=Object.create(null),de=0,me=Object.keys(ae);de<me.length;de++){var ye=me[de],Te=ae[ye];re[ye]===void 0?O==="all"&&(z[ye]=Te.defaultValue):z[ye]=Q(Te,re[ye],O!=="skip")}return z}e.normalizeParams=ue;function le(ae,re){for(var O=[],z=0,de=Object.keys(ae);z<de.length;z++){var me=de[z];if(!re)typeof ae[me]=="string"?O.push([me,ae[me]]):O.push([me,re===null?me:mo(me)]);else{var ye=re(me,ae[me]);O.push(typeof ye=="string"?[me,ye]:[me,ye[0],ye[1]])}}return O}e.objectToOptions=le;function ve(ae,re){for(var O=[],z=0,de=ae;z<de.length;z++){var me=de[z];re?O.push([me,re(me)]):O.push([me,re===null?me:mo(me)])}return O}e.arrayToOptions=ve;function ge(ae,re){for(var O=0,z=ae.options;O<z.length;O++){var de=z[O];if(de[0]===re)return de[1]}return""}e.optionLabel=ge;function Se(ae,re){for(var O=0,z=re;O<z.length;O++){var de=z[O];if(de[0]===ae)return ae}return re.length>0?re[0][0]:void 0}})(E||(E={}));var Ji;(function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:Jr.create22(),definition:a,createDefaultParams:function(o,s){return a.params?E.getDefaultValues(a.params(o,s)):{}}};return i}e.create=t;function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(a,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(a){function i(o){return function(s){return t(_({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}a.build=function(o){return i(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Ji||(Ji={}));var We;(function(e){function t(m,h,g){return m.definition.params?m.definition.params(h,g):{}}e.getParamDefinition=t;function r(m){return!!m&&typeof m.toAction=="function"&&typeof m.apply=="function"}e.is=r;var n;(function(m){m[m.Unchanged=0]="Unchanged",m[m.Updated=1]="Updated",m[m.Recreate=2]="Recreate",m[m.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var a=new Map,i=new Map;function o(m){for(var h=0,g=m.definition.from;h<g.length;h++){var y=g[h];i.has(y.type)?i.get(y.type).push(m):i.set(y.type,[m])}}function s(){return Array.from(a.values())}e.getAll=s;function u(m){var h=a.get(m);if(!h)throw new Error("A transformer with signature '".concat(m,"' is not registered."));return h}e.get=u;function l(m){return i.get(m)||[]}e.fromType=l;function c(m,h){var g=h.name,y="".concat(m,".").concat(g);if(a.has(y))throw new Error("A transform with id '".concat(g,"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed."));var b={apply:function(S,C,x){return er.create(S,b,C,x)},toAction:function(){return Ji.fromTransformer(b)},namespace:m,id:y,definition:h,createDefaultParams:function(S,C){return h.params?E.getDefaultValues(h.params(S,C)):{}}};return a.set(y,b),o(b),b}e.create=c;function d(m){return function(h){return c(m,h)}}e.factory=d;function f(m){return p.build(m)}e.builderFactory=f;var p;(function(m){function h(y,b){return function(S){return c(y,_({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:Pm(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function g(y){return function(b){return h(y,b)}}m.build=g})(p=e.Builder||(e.Builder={}));function v(m){return p.build(m)}e.build=v,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(We||(We={}));var er;(function(e){e.RootRef="-=root=-";function t(h,g){return!!h.isHidden!=!!g.isHidden||!!h.isCollapsed!=!!g.isCollapsed||!!h.isGhost!=!!g.isGhost||!!h.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(h,g){return g?typeof g.isCollapsed!="undefined"&&h.isCollapsed!==g.isCollapsed||typeof g.isHidden!="undefined"&&h.isHidden!==g.isHidden||typeof g.isGhost!="undefined"&&h.isGhost!==g.isGhost||typeof g.isLocked!="undefined"&&h.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(h,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var C=S[b],x=g[C],A=h[C];!!x!=!!A&&(y=!0,h[C]=x)}return y}e.assignState=n;function a(h,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var C=S[b],x=g[C],A=h[C];!!x!=!!A&&(y=!0,x!==void 0?h[C]=x:delete h[C])}for(var P=0,T=Object.keys(h);P<T.length;P++){var C=T[P],x=g[C],A=h[C];!!x!=!!A&&(y=!0,x!==void 0?h[C]=x:delete h[C])}return y}e.syncState=a;function i(h,g,y,b){var S=b&&b.ref?b.ref:Jr.create22(),C=void 0;return b&&b.tags&&(C=typeof b.tags=="string"?[b.tags]:b.tags,C.length===0?C=void 0:C.sort()),{parent:h,transformer:g,state:(b==null?void 0:b.state)||{},tags:C,ref:S,dependsOn:b&&b.dependsOn,params:y,version:Jr.create22()}}e.create=i;function o(h,g){return _(_({},h),{params:g,version:Jr.create22()})}e.withParams=o;function s(h,g){return g?_(_({},h),{state:_(_({},h.state),g)}):h}e.withState=s;function u(h,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),_(_({},h),{tags:y,version:Jr.create22()})}e.withTags=u;function l(h,g){return _(_({},h),{parent:g,version:Jr.create22()})}e.withParent=l;function c(h){return i(e.RootRef,We.ROOT,{},{ref:e.RootRef,state:h})}e.createRoot=c;function d(h,g){return h.tags?h.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(h,g){if(!h.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(h,g);for(var y=0,b=g;y<b.length;y++){var S=b[y];if(h.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function p(h){return h}function v(h){for(var g=h.transformer.definition.customSerialization?h.transformer.definition.customSerialization.toJSON:p,y=void 0,b=0,S=Object.keys(h.state);b<S.length;b++){var C=S[b],x=h.state[C];!x||(y||(y={}),y[C]=!0)}return{parent:h.parent,transformer:h.transformer.id,params:h.params?g(h.params):void 0,state:y,tags:h.tags,ref:h.ref,dependsOn:h.dependsOn,version:h.version}}e.toJSON=v;function m(h){var g=We.get(h.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:p;return{parent:h.parent,transformer:g,params:h.params?y(h.params):void 0,state:h.state||{},tags:h.tags,ref:h.ref,dependsOn:h.dependsOn,version:h.version}}e.fromJSON=m})(er||(er={}));function Eu(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function dS(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function oo(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function p0(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function fS(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),p0(e,t,r)/(e.length/t)}function pS(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function is(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function j0(e,t){for(var r=0,n=!1,a=e.length;r<a;r++)if(e[r]===t){n=!0;break}return n?(W0(e,r),!0):!1}function W0(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function On(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function If(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function Cb(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function uP(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function IK(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function DK(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var MK=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(er.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=er.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=Ls();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),a=i?i.asMutable():Ls().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}n==="add"?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){fy(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,er.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&BK(t.ref)}var a=this.children.get(t.parent);if(a||kK(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,Ls())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++){var s=o[i];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){fy(this.transforms,t);var n=this.transforms.get(t);return uS(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,er.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){fy(this.transforms,t);var n=this.transforms.get(t),a=er.withParams(n,r);return uP(n.tags,a.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){fy(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return er.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=er.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=Nn.subtreePostOrder(this,r);if(t===er.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++){var o=i[a];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];!this.transforms.has(f)||this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var v=0,m=p;v<m.length;v++){var h=m[v];if(!!this.transforms.has(h))for(var g=0,y=this.remove(h);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var S=0,C=s;S<C.length;S++){var h=C[S];n[n.length]=h}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(RK,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(OK,this.dependencies),Nn.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function RK(e,t){this.set(t,e.asImmutable())}function OK(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function BK(e){throw new Error("Transform '".concat(e,"' is already present in the tree."))}function kK(e){throw new Error("Parent '".concat(e,"' must be present in the tree."))}function fy(e,t){if(!e.has(t))throw new Error("Node '".concat(t,"' is not present in the tree."))}var Nn;(function(e){var t=function(){function b(S,C,x){this.transforms=S,this.children=C,this.dependencies=x}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(er.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new MK(this)},b}();function r(b){var S=b||er.createRoot();return n(Go([[S.ref,S]]),Go([[S.ref,Ls()]]),Go())}e.createEmpty=r;function n(b,S,C){return new t(b,S,C)}e.create=n;function a(b){i(this,this.tree.transforms.get(b))}function i(b,S){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(a,b),b.f(S,b.tree,b.state)}function o(b,S,C,x){var A={tree:b,state:C,f:x};return i(A,S),A.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var C=b.f(S,b.tree,b.state);if(!(typeof C=="boolean"&&!C)){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(s,b)}}function l(b,S,C,x){var A={tree:b,state:C,f:x};return u(A,S),A.state}e.doPreOrder=l;function c(b,S,C){C.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,C){C.push(er.toJSON(b))}function p(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=p;function v(b){for(var S=Go().asMutable(),C=Go().asMutable(),x=Go().asMutable(),A=0,P=b.transforms;A<P.length;A++){var T=P[A],D=er.fromJSON(T);S.set(D.ref,D),C.has(D.ref)||C.set(D.ref,Ls().asMutable()),D.ref!==D.parent&&C.get(D.parent).add(D.ref)}for(var I=new Set,M=0,B=b.transforms;M<B.length;M++){var T=B[M],U=T.ref;if(C.set(U,C.get(U).asImmutable()),!!T.dependsOn)for(var V=0,F=T.dependsOn;V<F.length;V++){var Y=F[V];I.add(Y),x.has(Y)?x.get(Y).add(U):x.set(Y,Ls([U]).asMutable())}}return I.forEach(function(W){x.set(W,x.get(W).asImmutable())}),n(S.asImmutable(),C.asImmutable(),x.asImmutable())}e.fromJSON=v;function m(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=m;function h(b,S,C){if(S===C)return!0;for(var x=b.children.get(S),A=x.values();;){var P=A.next();if(P.done)return!1;if(h(b,P.value,C))return!0}}function g(b,S,C){return!b.transforms.has(S)||!b.transforms.has(C)?!1:h(b,S,C)}e.subtreeHasRef=g;function y(b,S){var C=b.children.get(S);if(C.size!==1)return S;var x=b.transforms.get(C.first());return x.transformer.definition.isDecorator?y(b,x.ref):S}e.getDecoratorRoot=y})(Nn||(Nn={}));var Kt;(function(e){function t(L,H){return r(L)(H)}e.select=t;function r(L){var H=L||l.root,G;return a(H)?G=H.compile():n(H)?G=l.byValue(H).compile():i(H)?G=H:G=l.byRef(H).compile(),G}e.compile=r;function n(L){return L.transform!==void 0&&L.status!==void 0}function a(L){return L.compile!==void 0}function i(L){return typeof L=="function"}var o={select:function(L){return t(this,L||this.state)}};function s(L,H){o[L]=function(){for(var G=[],q=0;q<arguments.length;q++)G[q]=arguments[q];return H.call.apply(H,It([void 0,this],G,!1))}}function u(L){return Object.create(o,{compile:{writable:!1,configurable:!1,value:L}})}var l;(function(L){L.root=u(function(){return function(ae){return[ae.cells.get(ae.tree.root.ref)]}});function H(){for(var ae=[],re=0;re<arguments.length;re++)ae[re]=arguments[re];return u(function(){return function(O){for(var z=[],de=0,me=ae;de<me.length;de++){var ye=me[de],Te=O.cells.get(ye);!Te||z.push(Te)}return z}})}L.byRef=H;function G(){for(var ae=[],re=0;re<arguments.length;re++)ae[re]=arguments[re];return u(function(){return function(O){return ae}})}L.byValue=G;function q(ae,re){return re===void 0&&(re=er.RootRef),u(function(){return function(O){var z={roots:[],cells:O.cells,type:ae.type};return Nn.doPreOrder(O.tree,O.tree.transforms.get(re),z,le),z.roots}})}L.rootsOfType=q;function X(ae,re){return re===void 0&&(re=er.RootRef),u(function(){return function(O){var z={ret:[],cells:O.cells,type:ae.type};return Nn.doPreOrder(O.tree,O.tree.transforms.get(re),z,ve),z.ret}})}L.ofType=X;function Q(ae,re){return re===void 0&&(re=er.RootRef),u(function(){return function(O){var z={ret:[],cells:O.cells,t:ae};return Nn.doPreOrder(O.tree,O.tree.transforms.get(re),z,ge),z.ret}})}L.ofTransformer=Q;function ue(ae,re){return re===void 0&&(re=er.RootRef),u(function(){return function(O){var z={ret:[],cells:O.cells,t:ae};return Nn.doPreOrder(O.tree,O.tree.transforms.get(re),z,Se),z.ret}})}L.ofTransformerWithError=ue;function le(ae,re,O){var z=O.cells.get(ae.ref);return z&&z.obj&&z.obj.type===O.type?(O.roots.push(z),!1):!0}function ve(ae,re,O){var z=O.cells.get(ae.ref);return z&&z.obj&&z.obj.type===O.type&&O.ret.push(z),!0}function ge(ae,re,O){var z=O.cells.get(ae.ref);return z&&z.obj&&z.transform.transformer===O.t&&O.ret.push(z),!0}function Se(ae,re,O){var z=O.cells.get(ae.ref);return z&&z.status==="error"&&z.transform.transformer===O.t&&O.ret.push(z),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(L,H){var G=r(L);return u(function(){return function(q){for(var X=[],Q=0,ue=G(q);Q<ue.length;Q++)for(var le=ue[Q],ve=0,ge=H(le,q);ve<ge.length;ve++){var Se=ge[ve];X.push(Se)}return X}})}e.flatMap=c,s("mapObject",d);function d(L,H){var G=r(L);return u(function(){return function(q){for(var X=[],Q=0,ue=G(q);Q<ue.length;Q++){var le=ue[Q],ve=H(le,q);ve&&X.push(ve)}return X}})}e.mapObject=d,s("unique",f);function f(L){var H=r(L);return u(function(){return function(G){for(var q=new Set,X=[],Q=0,ue=H(G);Q<ue.length;Q++){var le=ue[Q];!le||q.has(le.transform.ref)||(q.add(le.transform.ref),X.push(le))}return X}})}e.unique=f,s("first",p);function p(L){var H=r(L);return u(function(){return function(G){var q=H(G);return q.length?[q[0]]:[]}})}e.first=p,s("filter",v);function v(L,H){return c(L,function(G){return H(G)?[G]:[]})}e.filter=v,s("withStatus",m);function m(L,H){return v(L,function(G){return G.status===H})}e.withStatus=m,s("withTag",h);function h(L,H){return v(L,function(G){return!!G.transform.tags&&G.transform.tags.indexOf(H)>=0})}e.withTag=h,s("subtree",g);function g(L){return c(L,function(H,G){var q=[];return Nn.doPreOrder(G.tree,G.tree.transforms.get(H.transform.ref),q,function(X,Q,ue){ue.push(X.ref)}),q.map(function(X){return G.cells.get(X)})})}e.subtree=g,s("children",y);function y(L){return c(L,function(H,G){var q=[];return G.tree.children.get(H.transform.ref).forEach(function(X){return q.push(G.cells.get(X))}),q})}e.children=y,s("ofType",b);function b(L,H){return v(L,function(G){return G.obj?G.obj.type===H.type:!1})}e.ofType=b,s("ancestor",S);function S(L,H){return f(d(L,function(G,q){return M(q.tree,q.cells,G.transform.ref,H)}))}e.ancestor=S,s("ancestorOfType",C);function C(L,H){return f(d(L,function(G,q){return V(q.tree,q.cells,G.transform.ref,H)}))}e.ancestorOfType=C,s("ancestorWithTransformer",x);function x(L,H){return f(d(L,function(G,q){return U(q.tree,q.cells,G.transform.ref,H)}))}e.ancestorWithTransformer=x,s("withTransformer",A);function A(L,H){return v(L,function(G){return G.transform.transformer===H})}e.withTransformer=A,s("root",P);function P(L,H){return f(d(L,function(G,q){return B(q.tree,q.cells,G.transform.ref,H)}))}e.root=P,s("rootOfType",T);function T(L,H){return f(d(L,function(G,q){return F(q.tree,q.cells,G.transform.ref,H)}))}e.rootOfType=T,s("parent",D);function D(L){return f(d(L,function(H,G){return G.cells.get(G.tree.transforms.get(H.transform.ref).parent)}))}e.parent=D;function I(L,H,G,q,X){for(var Q=L.transforms.get(G),ue=void 0;;){Q=L.transforms.get(Q.parent);var le=H.get(Q.ref);if(le.obj&&q(le)&&(ue=le,X)||Q.ref===er.RootRef)return ue}}function M(L,H,G,q){return I(L,H,G,q,!0)}e.findAncestor=M;function B(L,H,G,q){return I(L,H,G,q,!1)}e.findRoot=B;function U(L,H,G,q){return M(L,H,G,Array.isArray(q)?function(X){return q.indexOf(X.transform.transformer)>=0}:function(X){return X.transform.transformer===q})}e.findAncestorWithTransformer=U;function V(L,H,G,q){return M(L,H,G,Y(q))}e.findAncestorOfType=V;function F(L,H,G,q){return B(L,H,G,Y(q))}e.findRootOfType=F;function Y(L){return Array.isArray(L)?function(H){for(var G=0,q=L;G<q.length;G++){var X=q[G];if(X.type===H.obj.type)return!0}}:function(H){return H.obj.type===L.type}}function W(L,H,G){return Nn.doPreOrder(L,L.transforms.get(H),{refs:{},tags:G},K).refs}e.findUniqueTagsInSubtree=W;function K(L,H,G){if(L.tags)for(var q=0,X=L.tags;q<X.length;q++){var Q=X[q];if(!!G.tags.has(Q)){G.refs[Q]=L.ref;break}}return!0}function $(L,H,G){return Nn.doPreOrder(L,L.transforms.get(H),{ref:void 0,tag:G},J).ref}e.findTagInSubtree=$;function J(L,H,G){return L.tags&&L.tags.indexOf(G.tag)>=0?(G.ref=L.ref,!1):!0}function Z(L,H,G){return Nn.doPreOrder(L,L.transforms.get(H),{refs:[],tags:G},N).refs}e.findWithAllTags=Z;function N(L,H,G){if(L.tags)for(var q=G.tags.size,X=0,Q=0,ue=L.tags;Q<ue.length;Q++){var le=ue[Q];if(!!G.tags.has(le)&&(X++,X===q)){G.refs.push(L);break}}else G.tags.size===0&&G.refs.push(L)}function j(L,H,G){var q=L.transforms.get(H);if(q.transformer===G)return L.cells.get(H);var X=L.tree.children.get(H);if(X.size===1){var Q=X.first();if(L.transforms.get(Q).transformer.definition.isDecorator)return j(L,Q,G)}}e.tryFindDecorator=j})(Kt||(Kt={}));function ba(e){return typeof e=="function"}function W8(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var mC=W8(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,a){return a+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function wb(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var wg=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var t,r,n,a,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Xv(o),u=s.next();!u.done;u=s.next()){var l=u.value;l.remove(this)}}catch(m){t={error:m}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(ba(c))try{c()}catch(m){i=m instanceof mC?m.errors:[m]}var d=this._teardowns;if(d){this._teardowns=null;try{for(var f=Xv(d),p=f.next();!p.done;p=f.next()){var v=p.value;try{CD(v)}catch(m){i=i!=null?i:[],m instanceof mC?i=It(It([],N0(i)),N0(m.errors)):i.push(m)}}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(n)throw n.error}}}if(i)throw new mC(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)CD(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=(r=this._teardowns)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&wb(r,t)},e.prototype.remove=function(t){var r=this._teardowns;r&&wb(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),X8=wg.EMPTY;function Y8(e){return e instanceof wg||e&&"closed"in e&&ba(e.remove)&&ba(e.add)&&ba(e.unsubscribe)}function CD(e){ba(e)?e():e.unsubscribe()}var vp={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_b={setTimeout:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=_b.delegate;return((r==null?void 0:r.setTimeout)||setTimeout).apply(void 0,It([],N0(e)))},clearTimeout:function(e){var t=_b.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function K8(e){_b.setTimeout(function(){var t=vp.onUnhandledError;if(t)t(e);else throw e})}function Ab(){}var LK=function(){return lP("C",void 0,void 0)}();function FK(e){return lP("E",void 0,e)}function NK(e){return lP("N",e,void 0)}function lP(e,t,r){return{kind:e,value:t,error:r}}var Cf=null;function B1(e){if(vp.useDeprecatedSynchronousErrorHandling){var t=!Cf;if(t&&(Cf={errorThrown:!1,error:null}),e(),t){var r=Cf,n=r.errorThrown,a=r.error;if(Cf=null,n)throw a}}else e()}function UK(e){vp.useDeprecatedSynchronousErrorHandling&&Cf&&(Cf.errorThrown=!0,Cf.error=e)}var cP=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Y8(r)&&r.add(n)):n.destination=zK,n}return t.create=function(r,n,a){return new R_(r,n,a)},t.prototype.next=function(r){this.isStopped?gC(NK(r),this):this._next(r)},t.prototype.error=function(r){this.isStopped?gC(FK(r),this):(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped?gC(LK,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(wg),R_=function(e){Pe(t,e);function t(r,n,a){var i=e.call(this)||this,o;if(ba(r))o=r;else if(r){o=r.next,n=r.error,a=r.complete;var s;i&&vp.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return i.unsubscribe()}):s=r,o=o==null?void 0:o.bind(s),n=n==null?void 0:n.bind(s),a=a==null?void 0:a.bind(s)}return i.destination={next:o?hC(o):Ab,error:hC(n!=null?n:Q8),complete:a?hC(a):Ab},i}return t}(cP);function hC(e,t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{e.apply(void 0,It([],N0(r)))}catch(a){vp.useDeprecatedSynchronousErrorHandling?UK(a):K8(a)}}}function Q8(e){throw e}function gC(e,t){var r=vp.onStoppedNotification;r&&_b.setTimeout(function(){return r(e,t)})}var zK={closed:!0,next:Ab,error:Q8,complete:Ab},dP=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Z8(e){return e}function VK(e){return e.length===0?Z8:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var os=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this,i=GK(t)?t:new R_(t,r,n);return B1(function(){var o=a,s=o.operator,u=o.source;i.add(s?s.call(i,u):u?a._subscribe(i):a._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=wD(r),new r(function(a,i){var o=new R_({next:function(s){try{t(s)}catch(u){i(u),o.unsubscribe()}},error:i,complete:a});n.subscribe(o)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[dP]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return VK(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=wD(t),new t(function(n,a){var i;r.subscribe(function(o){return i=o},function(o){return a(o)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function wD(e){var t;return(t=e!=null?e:vp.Promise)!==null&&t!==void 0?t:Promise}function HK(e){return e&&ba(e.next)&&ba(e.error)&&ba(e.complete)}function GK(e){return e&&e instanceof cP||HK(e)&&Y8(e)}function qK(e){return ba(e==null?void 0:e.lift)}function mp(e){return function(t){if(qK(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Gf=function(e){Pe(t,e);function t(r,n,a,i,o){var s=e.call(this,r)||this;return s.onFinalize=o,s._next=n?function(u){try{n(u)}catch(l){r.error(l)}}:e.prototype._next,s._error=i?function(u){try{i(u)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=a?function(){try{a()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,s}return t.prototype.unsubscribe=function(){var r,n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))},t}(cP),jK=W8(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xn=function(e){Pe(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new _D(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new jK},t.prototype.next=function(r){var n=this;B1(function(){var a,i;if(n._throwIfClosed(),!n.isStopped){var o=n.observers.slice();try{for(var s=Xv(o),u=s.next();!u.done;u=s.next()){var l=u.value;l.next(r)}}catch(c){a={error:c}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}}})},t.prototype.error=function(r){var n=this;B1(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var a=n.observers;a.length;)a.shift().error(r)}})},t.prototype.complete=function(){var r=this;B1(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,a=n.hasError,i=n.isStopped,o=n.observers;return a||i?X8:(o.push(r),new wg(function(){return wb(o,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,a=n.hasError,i=n.thrownError,o=n.isStopped;a?r.error(i):o&&r.complete()},t.prototype.asObservable=function(){var r=new os;return r.source=this,r},t.create=function(r,n){return new _D(r,n)},t}(os),_D=function(e){Pe(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.next)===null||a===void 0||a.call(n,r)},t.prototype.error=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.error)===null||a===void 0||a.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,a;return(a=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&a!==void 0?a:X8},t}(xn),fl=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,a=r.thrownError,i=r._value;if(n)throw a;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(xn),$8={now:function(){return($8.delegate||Date).now()},delegate:void 0},WK=function(e){Pe(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(wg),Tb={setInterval:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Tb.delegate;return((r==null?void 0:r.setInterval)||setInterval).apply(void 0,It([],N0(e)))},clearInterval:function(e){var t=Tb.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},XK=function(e){Pe(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.scheduler=r,a.work=n,a.pending=!1,a}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var a=this.id,i=this.scheduler;return a!=null&&(this.id=this.recycleAsyncId(i,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(i,this.id,n),this},t.prototype.requestAsyncId=function(r,n,a){return a===void 0&&(a=0),Tb.setInterval(r.flush.bind(r,this),a)},t.prototype.recycleAsyncId=function(r,n,a){if(a===void 0&&(a=0),a!=null&&this.delay===a&&this.pending===!1)return n;Tb.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(r,n);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var a=!1,i;try{this.work(r)}catch(o){a=!0,i=o||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,a=r.scheduler,i=a.actions;this.work=this.state=this.scheduler=null,this.pending=!1,wb(i,this),n!=null&&(this.id=this.recycleAsyncId(a,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(WK),AD=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=$8.now,e}(),YK=function(e){Pe(t,e);function t(r,n){n===void 0&&(n=AD.now);var a=e.call(this,r,n)||this;return a.actions=[],a._active=!1,a._scheduled=void 0,a}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var a;this._active=!0;do if(a=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,a){for(;r=n.shift();)r.unsubscribe();throw a}},t}(AD),KK=new YK(XK),J8=new os(function(e){return e.complete()});function QK(e){return e&&ba(e.schedule)}function eN(e){return e[e.length-1]}function ZK(e){return QK(eN(e))?e.pop():void 0}function $K(e,t){return typeof eN(e)=="number"?e.pop():t}var tN=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function rN(e){return ba(e==null?void 0:e.then)}function nN(e){return ba(e[dP])}function aN(e){return Symbol.asyncIterator&&ba(e==null?void 0:e[Symbol.asyncIterator])}function iN(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function JK(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var oN=JK();function sN(e){return ba(e==null?void 0:e[oN])}function uN(e){return VW(this,arguments,function(){var r,n,a,i;return ie(this,function(o){switch(o.label){case 0:r=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Bv(r.read())];case 3:return n=o.sent(),a=n.value,i=n.done,i?[4,Bv(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Bv(a)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function lN(e){return ba(e==null?void 0:e.getReader)}function Em(e){if(e instanceof os)return e;if(e!=null){if(nN(e))return eQ(e);if(tN(e))return tQ(e);if(rN(e))return rQ(e);if(aN(e))return cN(e);if(sN(e))return nQ(e);if(lN(e))return aQ(e)}throw iN(e)}function eQ(e){return new os(function(t){var r=e[dP]();if(ba(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function tQ(e){return new os(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function rQ(e){return new os(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,K8)})}function nQ(e){return new os(function(t){var r,n;try{for(var a=Xv(e),i=a.next();!i.done;i=a.next()){var o=i.value;if(t.next(o),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}t.complete()})}function cN(e){return new os(function(t){iQ(e,t).catch(function(r){return t.error(r)})})}function aQ(e){return cN(uN(e))}function iQ(e,t){var r,n,a,i;return se(this,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=HW(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),a={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function cd(e,t,r,n,a){n===void 0&&(n=0),a===void 0&&(a=!1);var i=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!a)return i}function dN(e,t){return t===void 0&&(t=0),mp(function(r,n){r.subscribe(new Gf(n,function(a){return cd(n,e,function(){return n.next(a)},t)},function(){return cd(n,e,function(){return n.complete()},t)},function(a){return cd(n,e,function(){return n.error(a)},t)}))})}function fN(e,t){return t===void 0&&(t=0),mp(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function oQ(e,t){return Em(e).pipe(fN(t),dN(t))}function sQ(e,t){return Em(e).pipe(fN(t),dN(t))}function uQ(e,t){return new os(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function lQ(e,t){return new os(function(r){var n;return cd(r,t,function(){n=e[oN](),cd(r,t,function(){var a,i,o;try{a=n.next(),i=a.value,o=a.done}catch(s){r.error(s);return}o?r.complete():r.next(i)},0,!0)}),function(){return ba(n==null?void 0:n.return)&&n.return()}})}function pN(e,t){if(!e)throw new Error("Iterable cannot be null");return new os(function(r){cd(r,t,function(){var n=e[Symbol.asyncIterator]();cd(r,t,function(){n.next().then(function(a){a.done?r.complete():r.next(a.value)})},0,!0)})})}function cQ(e,t){return pN(uN(e),t)}function dQ(e,t){if(e!=null){if(nN(e))return oQ(e,t);if(tN(e))return uQ(e,t);if(rN(e))return sQ(e,t);if(aN(e))return pN(e,t);if(sN(e))return lQ(e,t);if(lN(e))return cQ(e,t)}throw iN(e)}function fQ(e,t){return t?dQ(e,t):Em(e)}function pQ(e,t){return mp(function(r,n){var a=0;r.subscribe(new Gf(n,function(i){n.next(e.call(t,i,a++))}))})}function vQ(e,t,r,n,a,i,o,s){var u=[],l=0,c=0,d=!1,f=function(){d&&!u.length&&!l&&t.complete()},p=function(m){return l<n?v(m):u.push(m)},v=function(m){i&&t.next(m),l++;var h=!1;Em(r(m,c++)).subscribe(new Gf(t,function(g){a==null||a(g),i?p(g):t.next(g)},function(){h=!0},void 0,function(){if(h)try{l--;for(var g=function(){var y=u.shift();o?cd(t,o,function(){return v(y)}):v(y)};u.length&&l<n;)g();f()}catch(y){t.error(y)}}))};return e.subscribe(new Gf(t,p,function(){d=!0,f()})),function(){s==null||s()}}function vN(e,t,r){return r===void 0&&(r=1/0),ba(t)?vN(function(n,a){return pQ(function(i,o){return t(n,i,a,o)})(Em(e(n,a)))},r):(typeof t=="number"&&(r=t),mp(function(n,a){return vQ(n,a,e,r)}))}function mQ(e){return e===void 0&&(e=1/0),vN(Z8,e)}function il(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ZK(e),n=$K(e,1/0),a=e;return a.length?a.length===1?Em(a[0]):mQ(n)(fQ(a,r)):J8}function vS(e,t){return mp(function(r,n){var a=0;r.subscribe(new Gf(n,function(i){return e.call(t,i,a++)&&n.next(i)}))})}function mN(e,t){return t===void 0&&(t=KK),mp(function(r,n){var a=null,i=null,o=null,s=function(){if(a){a.unsubscribe(),a=null;var l=i;i=null,n.next(l)}};function u(){var l=o+e,c=t.now();if(c<l){a=this.schedule(void 0,l-c),n.add(a);return}s()}r.subscribe(new Gf(n,function(l){i=l,o=t.now(),a||(a=t.schedule(u,e),n.add(a))},function(){s(),n.complete()},void 0,function(){i=a=null}))})}function hQ(e){return e<=0?function(){return J8}:mp(function(t,r){var n=0;t.subscribe(new Gf(r,function(a){++n<=e&&(r.next(a),e<=n&&r.complete())}))})}var El;(function(e){function t(){var r=new gQ,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}e.create=t})(El||(El={}));var gQ=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new xn;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new fl(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function Ms(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function tm(e){return!!e&&!!e[bo]}function qf(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===AQ}(e)||Array.isArray(e)||!!e[OD]||!!e.constructor[OD]||fP(e)||pP(e))}function X0(e,t,r){r===void 0&&(r=!1),Im(e)===0?(r?Object.keys:yP)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function Im(e){var t=e[bo];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:fP(e)?2:pP(e)?3:0}function O_(e,t){return Im(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function yQ(e,t){return Im(e)===2?e.get(t):e[t]}function hN(e,t,r){var n=Im(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function bQ(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function fP(e){return wQ&&e instanceof Map}function pP(e){return _Q&&e instanceof Set}function cf(e){return e.o||e.t}function vP(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=TQ(e);delete t[bo];for(var r=yP(t),n=0;n<r.length;n++){var a=r[n],i=t[a];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function mP(e,t){return t===void 0&&(t=!1),hP(e)||tm(e)||!qf(e)||(Im(e)>1&&(e.set=e.add=e.clear=e.delete=SQ),Object.freeze(e),t&&X0(e,function(r,n){return mP(n,!0)},!0)),e}function SQ(){Ms(2)}function hP(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Pu(e){var t=PQ[e];return t||Ms(18,e),t}function TD(){return Y0}function yC(e,t){t&&(Pu("Patches"),e.u=[],e.s=[],e.v=t)}function Pb(e){B_(e),e.p.forEach(xQ),e.p=null}function B_(e){e===Y0&&(Y0=e.l)}function PD(e){return Y0={p:[],l:Y0,h:e,m:!0,_:0}}function xQ(e){var t=e[bo];t.i===0||t.i===1?t.j():t.O=!0}function bC(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||Pu("ES5").S(t,e,n),n?(r[bo].P&&(Pb(t),Ms(4)),qf(e)&&(e=Eb(t,e),t.l||Ib(t,e)),t.u&&Pu("Patches").M(r[bo].t,e,t.u,t.s)):e=Eb(t,r,[]),Pb(t),t.u&&t.v(t.u,t.s),e!==gN?e:void 0}function Eb(e,t,r){if(hP(t))return t;var n=t[bo];if(!n)return X0(t,function(i,o){return ED(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return Ib(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=vP(n.k):n.o;X0(n.i===3?new Set(a):a,function(i,o){return ED(e,n,a,i,o,r)}),Ib(e,a,!1),r&&e.u&&Pu("Patches").R(n,r,e.u,e.s)}return n.o}function ED(e,t,r,n,a,i){if(tm(a)){var o=Eb(e,a,i&&t&&t.i!==3&&!O_(t.D,n)?i.concat(n):void 0);if(hN(r,n,o),!tm(o))return;e.m=!1}if(qf(a)&&!hP(a)){if(!e.h.F&&e._<1)return;Eb(e,a),t&&t.A.l||Ib(e,a)}}function Ib(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&mP(t,r)}function SC(e,t){var r=e[bo];return(r?cf(r):e)[t]}function ID(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function k_(e){e.P||(e.P=!0,e.l&&k_(e.l))}function xC(e){e.o||(e.o=vP(e.t))}function L_(e,t,r){var n=fP(t)?Pu("MapSet").N(t,r):pP(t)?Pu("MapSet").T(t,r):e.g?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:TD(),P:!1,I:!1,D:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,l=F_;o&&(u=[s],l=zh);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Pu("ES5").J(t,r);return(r?r.A:TD()).p.push(n),n}function CQ(e){return tm(e)||Ms(22,e),function t(r){if(!qf(r))return r;var n,a=r[bo],i=Im(r);if(a){if(!a.P&&(a.i<4||!Pu("ES5").K(a)))return a.t;a.I=!0,n=DD(r,i),a.I=!1}else n=DD(r,i);return X0(n,function(o,s){a&&yQ(a.t,o)===s||hN(n,o,t(s))}),i===3?new Set(n):n}(e)}function DD(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return vP(e)}var MD,Y0,gP=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",wQ=typeof Map!="undefined",_Q=typeof Set!="undefined",RD=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",gN=gP?Symbol.for("immer-nothing"):((MD={})["immer-nothing"]=!0,MD),OD=gP?Symbol.for("immer-draftable"):"__$immer_draftable",bo=gP?Symbol.for("immer-state"):"__$immer_state",AQ=""+Object.prototype.constructor,yP=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,TQ=Object.getOwnPropertyDescriptors||function(e){var t={};return yP(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},PQ={},F_={get:function(e,t){if(t===bo)return e;var r=cf(e);if(!O_(r,t))return function(a,i,o){var s,u=ID(i,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!qf(n)?n:n===SC(e.t,t)?(xC(e),e.o[t]=L_(e.A.h,n,e)):n},has:function(e,t){return t in cf(e)},ownKeys:function(e){return Reflect.ownKeys(cf(e))},set:function(e,t,r){var n=ID(cf(e),t);if(n==null?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=SC(cf(e),t),i=a==null?void 0:a[bo];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(bQ(r,a)&&(r!==void 0||O_(e.t,t)))return!0;xC(e),k_(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return SC(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,xC(e),k_(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=cf(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Ms(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Ms(12)}},zh={};X0(F_,function(e,t){zh[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),zh.deleteProperty=function(e,t){return zh.set.call(this,e,t,void 0)},zh.set=function(e,t,r){return F_.set.call(this,e[0],t,r,e[0])};var EQ=function(){function e(r){var n=this;this.g=RD,this.F=!0,this.produce=function(a,i,o){if(typeof a=="function"&&typeof i!="function"){var s=i;i=a;var u=n;return function(m){var h=this;m===void 0&&(m=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(m,function(S){var C;return(C=i).call.apply(C,[h,S].concat(y))})}}var l;if(typeof i!="function"&&Ms(6),o!==void 0&&typeof o!="function"&&Ms(7),qf(a)){var c=PD(n),d=L_(n,a,void 0),f=!0;try{l=i(d),f=!1}finally{f?Pb(c):B_(c)}return typeof Promise!="undefined"&&l instanceof Promise?l.then(function(m){return yC(c,o),bC(m,c)},function(m){throw Pb(c),m}):(yC(c,o),bC(l,c))}if(!a||typeof a!="object"){if((l=i(a))===void 0&&(l=a),l===gN&&(l=void 0),n.F&&mP(l,!0),o){var p=[],v=[];Pu("Patches").M(a,l,p,v),o(p,v)}return l}Ms(21,a)},this.produceWithPatches=function(a,i){if(typeof a=="function")return function(l){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];return n.produceWithPatches(l,function(p){return a.apply(void 0,[p].concat(d))})};var o,s,u=n.produce(a,i,function(l,c){o=l,s=c});return typeof Promise!="undefined"&&u instanceof Promise?u.then(function(l){return[l,o,s]}):[u,o,s]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){qf(r)||Ms(8),tm(r)&&(r=CQ(r));var n=PD(this),a=L_(this,r,void 0);return a[bo].C=!0,B_(n),a},t.finishDraft=function(r,n){var a=r&&r[bo],i=a.A;return yC(i,n),bC(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!RD&&Ms(20),this.g=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}a>-1&&(n=n.slice(a+1));var o=Pu("Patches").$;return tm(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),So=new EQ,Il=So.produce;So.produceWithPatches.bind(So);var IQ=So.setAutoFreeze.bind(So);So.setUseProxies.bind(So);So.applyPatches.bind(So);So.createDraft.bind(So);So.finishDraft.bind(So);var mf;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,p=d;f<p.length;f++){var v=p[f];s.changeParent(v,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:z0.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=Zn.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '".concat(u,"'."))}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new TF(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return Nn.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,_(_({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var v=this.state.tree.transforms.get(p.value);if(v&&er.hasTags(v,s)){var m=this.to(p.value);return m.updateTagged(l,BD(v.tags,s,c&&c.tags)),m}}var h=u.apply(d,l,_(_({},c),{tags:BD(s,c&&c.tags)}));return this.state.tree.add(h),this.editInfo.count++,this.editInfo.lastUpdate=h.ref,this.state.actions.push({kind:"add",transform:h}),new o(this.state,h.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,p=c;f<p.length;f++){var v=p[f];this.state.tree.changeParent(v,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=Il(c.params,u)}else l=typeof s=="function"?Il(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i})(mf||(mf={}));function BD(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(!!o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var DQ=function(){function e(){this.ev=El.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=We.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(void 0),this},e.prototype.remove=function(t){var r=We.is(t)?t.toAction().id:Jr.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);!s||(If(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){i=!0;break}}if(!i)return a;for(var l=[],c=0,d=a;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),xu;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function a(i){return{type:"info",timestamp:new Date,message:i}}e.info=a})(xu||(xu={}));var K0;(function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(!!this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===er.RootRef)return}},a.prototype.getRootOfType=function(i){if(!!this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===er.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t;function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s==null?void 0:s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(a,i,o){var s=void 0,u=a.cells.get(o);if(!!u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===er.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}e.getRootOfType=n})(K0||(K0={}));var MQ=function(){function e(){this.queue=[],this.signal=new xn}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){j0(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=j0(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var o=i.v,s=i.stillPresent;o===t&&(a.unsubscribe(),n(s))})})},e}(),RQ=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function bP(e,t){return new RQ(e,t)}function N_(){return new OQ}function kD(e){return{previous:null,next:null,inList:!0,value:e}}var OQ=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=kD(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=kD(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){!t.inList||(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),Vr;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(a,i,o){var s=a.keys,u=a.array;return s.has(i)?!1:(s.add(i),u[u.length]=o,!0)}e.add=r;function n(a,i){var o=a.keys;return o.has(i)}e.has=n})(Vr||(Vr={}));var wd=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=El.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:er.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new DQ,this.cells=new Map,this.spine=new K0.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '".concat(o,"' data undefined."));return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new MQ,this._tree=Nn.createEmpty(er.createRoot(r&&r.rootState)).asTransient();var a=this._tree,i=a.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:_({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new mf.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return Fe.create("Undo",function(r){return se(t,void 0,void 0,function(){var n;return ie(this,function(a){switch(a.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:Nn.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=Nn.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(!!n){var a=typeof r=="function"?r(n.state):r;er.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return Kt.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?Kt.select(t,this):Kt.select(t(Kt.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return n===void 0&&(n=er.RootRef),Fe.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'".concat(n,"' does not exist."));if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '".concat(o.status,"'"));return SP(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return Fe.create("State Transaction",function(a){return se(n,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){switch(l.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:l.sent(),this.events.log.next(xu.error("Error during state transaction, reverting")),l.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r==null?void 0:r.rethrowErrors)throw u;return console.error(u),[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||((r==null?void 0:r.canUndo)?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return Fe.create("Update Tree",function(i){return se(n,void 0,void 0,function(){var o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=(r==null?void 0:r.canUndo)?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),mf.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new TF(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),(r==null?void 0:r.canUndo)?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return se(this,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return i=s.sent(),o=(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return se(this,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,kQ(a)];case 2:return n=o.sent(),mf.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(mf.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:mf.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:_(_({},BQ),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(a,i){return!!i&&a.ref===i.transform.ref&&a.state===i.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(wd||(wd={}));var BQ={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function kQ(e){return se(this,void 0,void 0,function(){var t,r,n,a,B,i,o,s,h,u,m,S,l,c,h,S,d,f,p,v,S,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U;return ie(this,function(V){switch(V.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],a=[e.editInfo.lastUpdate];else{for(r=UQ(e),B=e.parent.current,i=!1,o=0,s=r;o<s.length;o++)if(h=s[o],h===B){i=!0;break}for(i&&(u=LD(e.oldTree,B,r,e.cells),e.parent.setCurrent(u)),m=r.length-1;m>=0;m--)S=e.cells.get(r[m]),S&&z_(S.transform,S.obj,S==null?void 0:S.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)h=c[l],S=e.cells.get(h),S&&(S.parent=void 0,qQ(S)),d=S&&S.obj,e.cells.delete(h),n.push(d);a=LQ(e.cells,e.tree)}for(f=XQ(e,a),p=0,v=f.added;p<v.length;p++)S=v[p],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(m=0;m<r.length;m++)h=r[m],g=e.oldTree.transforms.get(h).parent,e.parent.events.object.removed.next({state:e.parent,ref:h,obj:n[m]}),e.parent.events.cell.removed.next({state:e.parent,ref:h,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],a.push(S.transform.ref);GQ(e,a),C=0,x=a,V.label=1;case 1:return C<x.length?(A=x[C],[4,bN(e,A)]):[3,4];case 2:V.sent(),V.label=3;case 3:return C++,[3,1];case 4:for(e.editInfo||VQ(e),P=e.newCurrent,T=0,D=e.results;T<D.length;T++)I=D[T],I.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:I.ref,obj:I.obj}),e.newCurrent||(M=e.tree.transforms.get(I.ref),!M.state.isGhost&&I.obj!==pn.Null&&(P=I.ref))):I.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"in-place",obj:I.obj,oldData:I.oldData}):I.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:I.ref,action:"recreate",obj:I.obj,oldObj:I.oldObj});return P?e.options.doNotUpdateCurrent||e.parent.setCurrent(P):(B=e.parent.current,U=e.cells.get(B),U&&(U.obj===pn.Null||U.status==="error"&&U.errorText===YQ)&&(P=LD(e.oldTree,B,[],e.cells),e.parent.setCurrent(P))),[2,r.length>0||a.length>0||e.changed]}})})}function LQ(e,t){var r={roots:[],cells:e};return Nn.doPreOrder(t,t.root,r,FQ),r.roots}function FQ(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===pn.Null)}function NQ(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function UQ(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return Nn.doPostOrder(e.oldTree,e.oldTree.root,t,NQ),t.deletes}function zQ(e,t,r){var n=r.cells.get(e.ref);!n||!er.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function VQ(e){Nn.doPreOrder(e.tree,e.tree.root,e,zQ)}function Db(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function HQ(e,t,r){r.cells.get(e.ref).transform=e,Db(r,e.ref,"pending")}function GQ(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];Nn.doPreOrder(e.tree,e.tree.transforms.get(a),e,HQ)}}function qQ(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];If(n.dependencies.dependentBy,e)}}function jQ(e,t,r){var n=r.ctx,a=r.added,i=r.visited;if(i.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:_({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function WQ(e,t){if(!!e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r],i=t.tree.transforms.get(a);if(!i)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);On(e.dependencies.dependsOn,o),On(o.dependencies.dependentBy,e)}}function XQ(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++){var i=a[n];Nn.doPreOrder(e.tree,e.tree.transforms.get(i),r,jQ)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];WQ(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,p=d.dependencies.dependentBy;f<p.length;f++){var v=p[f];r.visited.has(v.transform.ref)||(l||(l=Vr.create()),Vr.add(l,v.transform.ref,v))}}),{added:r.added,dependent:l?l.array:void 0}}function LD(e,t,r,n){var a=new Set(r);return yN(e,t,a,n)}function yN(e,t,r,n){if(t===er.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===pn.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||yN(e,a.parent,r,n)}function U_(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Fe.isAbort(r);var i=""+r;Db(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;U_(e,u.value,void 0,n)}}var YQ="Parent is null";function bN(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return ie(this,function(l){switch(l.label){case 0:Db(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=fn(),[4,QQ(e,t)];case 2:return a=l.sent(),i=fn()-n,a.action!=="none"&&(e.changed=!0),Db(e,t,"ok"),e.results.push(a),a.action==="created"?(r=a.obj===pn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(xu.info("Created ".concat(a.obj.label," in ").concat(I1(i),".")))):(a.action==="updated"||a.action==="replaced")&&(r=a.obj===pn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(xu.info("Updated ".concat(a.obj.label," in ").concat(I1(i),".")))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),U_(e,t,o,!1),console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(U_(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,bN(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function KQ(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=E.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=E.getDefaultValues(i);t.params=t.params?QX(t.params,o):o}return E.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}function QQ(e,t){var r;return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){switch(S.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===er.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(i.transform.parent):Kt.findAncestorOfType(a,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '".concat(t,"'"));return e.spine.current=i,u=s.obj,i.sourceRef=s.transform.ref,l=KQ(e,o,u,i),!n.transforms.has(t)||!i.params?(i.params=l,[4,FD(e,i,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),CC(c,o),i.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=i.params.values,f=i.cache,p=(r=i.obj)===null||r===void 0?void 0:r.data,v=l.values,i.params=l,!!i.obj&&i.obj!==pn.Null?[4,ZQ(e,i,o.transformer,u,i.obj,d,v)]:[3,4];case 3:return h=S.sent(),[3,5];case 4:h=We.UpdateResult.Recreate,S.label=5;case 5:switch(m=h,g=m,g){case We.UpdateResult.Recreate:return[3,6];case We.UpdateResult.Updated:return[3,8];case We.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=i.obj,z_(o,y,d,f,e.parent.globalContext),[4,FD(e,i,o.transformer,u,v)];case 7:return b=S.sent(),CC(b,o),i.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return CC(i.obj,o),[2,{ref:t,action:"updated",oldData:p,obj:i.obj}];case 9:return z_(o,i.obj,d,f,e.parent.globalContext),i.obj=pn.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function z_(e,t,r,n,a){var i,o;(o=(i=e.transformer.definition).dispose)===null||o===void 0||o.call(i,{b:t!==pn.Null?t:void 0,params:r,cache:n},a)}function CC(e,t){!e||e===pn.Null||(e.tags=t.tags)}function SP(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function SN(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function FD(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),SP(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:SN(t)},e.parent.globalContext),e.taskCtx)}function ZQ(e,t,r,n,a,i,o){return se(this,void 0,void 0,function(){return ie(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,SP(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:SN(t)},e.parent.globalContext),e.taskCtx)]):[2,We.UpdateResult.Recreate]})})}var fe;(function(e){e.Create=pn.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(_(_({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function a(s){return e.Create(_(_({},s),{typeClass:"Behavior"}))}e.CreateBehavior=a;var i=function(s){Pe(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(s){Pe(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var p=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=p;var v=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=v;var m=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=m;var h=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=h}(e.Format||(e.Format={})),function(s){var u=function(p){Pe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(p){Pe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(p){Pe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(p){Pe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(p){Pe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(p){var v=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));p.Representation3D=v;var m=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));p.Representation3DState=m;var h=function(g){Pe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));p.Selections=h}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Pe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Pe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Pe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(fe||(fe={}));var _t;(function(e){e.CreateBuiltIn=We.factory("ms-plugin"),e.BuiltIn=We.builderFactory("ms-plugin")})(_t||(_t={}));var V_=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(fe.Create({name:"Volume Streaming",typeClass:"Object"})),ND;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(ND||(ND={}));function mS(e,t){return"".concat(e).concat(e[e.length-1]==="/"||t[0]==="/"?"":"/").concat(t)}function kv(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}var nn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,oe.identity()),e.RotationTranslationEpsilon=.005;function t(m,h,g){var y=g||{},b=y.assembly,S=y.ncsId,C=y.hkl,x=y.spgrOp,A=C?w.clone(C):w();x=oa(x,-1),S=S||-1;var P=oe.isIdentity(h),T=n(g,P);return P?{name:m,assembly:b,matrix:h,inverse:oe.identity(),isIdentity:!0,hkl:A,spgrOp:x,ncsId:S,suffix:T}:(oe.isRotationAndTranslation(h,e.RotationTranslationEpsilon)||console.warn("Symmetry operator (".concat(m,") should be a composition of rotation and translation.")),{name:m,assembly:b,matrix:h,inverse:oe.invert(oe(),h),isIdentity:!1,hkl:A,spgrOp:x,ncsId:S,suffix:T})}e.create=t;function r(m){return!!m&&!!m.matrix&&!!m.inverse&&typeof m.name=="string"}function n(m,h){if(!m)return"";if(m.assembly)return r(m)?m.suffix:h?"":"_".concat(m.assembly.operId);if(typeof m.spgrOp!="undefined"&&typeof m.hkl!="undefined"&&m.spgrOp!==-1){var g=m.hkl,y=g[0],b=g[1],S=g[2];return"-".concat(m.spgrOp+1,"_").concat(5+y).concat(5+b).concat(5+S)}return m.ncsId!==-1?"_".concat(m.ncsId):""}function a(m,h){for(var g=oe.identity(),y=0;y<3;y++)for(var b=0;b<3;b++)oe.setValue(g,y,b,wn.getValue(m,y,b));return oe.setTranslation(g,h),oe.isRotationAndTranslation(g,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=a;function i(m,h,g,y){for(var b=oe.identity(),S=0;S<3;S++)for(var C=0;C<3;C++)oe.setValue(b,S,C,wn.getValue(h,S,C));return oe.setTranslation(b,g),t(m,b,{ncsId:y})}e.ofRotationAndOffset=i;var o=$r.identity(),s=$r(),u=$r(),l=w();function c(m,h,g){var y=h.inverse;if(h.isIdentity)return oe.copy(m,y);var b=1-g;oe.getRotation(s,y),$r.slerp(s,o,s,b);var S=$r.getAxisAngle(l,s);return oe.fromRotation(m,S,l),oe.setValue(m,0,3,b*oe.getValue(y,0,3)),oe.setValue(m,1,3,b*oe.getValue(y,1,3)),oe.setValue(m,2,3,b*oe.getValue(y,2,3)),m}e.lerpFromIdentity=c;function d(m,h,g,y){if(Math.abs(y)<=1e-5)return oe.copy(m,h);if(Math.abs(y-1)<=1e-5)return oe.copy(m,g);oe.getRotation(s,h),oe.getRotation(u,g),$r.slerp(u,s,u,y);var b=$r.getAxisAngle(l,u);return oe.fromRotation(m,b,l),oe.setValue(m,0,3,sa(oe.getValue(h,0,3),oe.getValue(g,0,3),y)),oe.setValue(m,1,3,sa(oe.getValue(h,1,3),oe.getValue(g,1,3),y)),oe.setValue(m,2,3,sa(oe.getValue(h,2,3),oe.getValue(g,2,3),y)),m}e.slerp=d;function f(m,h){var g=oe.mul(oe(),h.matrix,m.matrix);return t(h.name,g,h)}e.compose=f;function p(m,h,g){var y=e.createCoordinateMapper(e.Default,h),b=m.isIdentity?y:e.createCoordinateMapper(m,h),S=JQ(m,h),C=S.x,x=S.y,A=S.z;return{operator:m,coordinates:h,invariantPosition:y,position:b,x:C,y:x,z:A,r:g||$Q}}e.createMapping=p;function v(m,h){return m.isIdentity?nZ(h):aZ(m,h)}e.createCoordinateMapper=v})(nn||(nn={}));function $Q(e){return 0}function JQ(e,t){return e.isIdentity?{x:wC(t.x),y:wC(t.y),z:wC(t.z)}:{x:eZ(e,t),y:tZ(e,t),z:rZ(e,t)}}function wC(e){return function(r){return e[r]}}function hS(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function eZ(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return hS(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],v=i[d],m=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/m}}function tZ(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return hS(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],v=i[d],m=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/m}}function rZ(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return hS(r)?function(d){return o*n[d]+s*a[d]+u*i[d]+l}:function(d){var f=n[d],p=a[d],v=i[d],m=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/m}}function nZ(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}function aZ(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return hS(r)?function(s,u){var l=n[s],c=a[s],d=i[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],w.transformMat4(u,u,r),u}}var _C=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],iZ=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],oZ=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],Q0={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function sZ(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function uZ(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '".concat(e,"'"))}var xN=function(){for(var e=Object.create(null),t=0,r=Object.keys(Q0);t<r.length;t++){var n=r[t];e[Q0[n]]=n}return e}(),lZ=function(){for(var e=Object.create(null),t=0,r=Object.keys(Q0);t<r.length;t++){var n=r[t],a=Q0[n];e[a]=uZ(a)}return e}();function cZ(e){var t=typeof e=="number"?sZ(e):Q0[e];return typeof t=="undefined"||typeof xN[t]=="undefined"?-1:t}var Ri;(function(e){e.Zero=r("P 1",w.create(1,1,1),w.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,a,i){var o=cZ(n);if(o<0)return console.warn("Unknown spacegroup '".concat(n,"', returning a 'P 1' with cellsize [1, 1, 1]")),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],l=i[1],c=i[2],d=a[0],f=a[1],p=a[2],v=Math.cos(l),m=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),h=Math.sqrt(1-v*v-m*m),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[v*p,m*p,h*p],S=oe.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),C=oe.invert(oe.zero(),S);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:C,fromFractional:S}}e.create=r})(Ri||(Ri={}));var ss;(function(e){e.ZeroP1=t(Ri.Zero);function t(h){var g=oZ[h.index].map(function(S){return d(iZ[S])}),y=xN[h.index],b=lZ[h.index];return{name:y,num:b,cell:h,operators:g}}e.create=t;var r=w(),n=oe();function a(h,g,y,b,S,C){return w.set(r,y,b,S),oe.fromTranslation(n,r),oe.mul(C,oe.mul(C,oe.mul(C,h.cell.fromFractional,n),h.operators[g]),h.cell.toFractional)}e.setOperatorMatrix=a;function i(h,g,y,b,S){var C=a(h,g,y,b,S,oe.zero());return nn.create("".concat(g+1,"_").concat(5+y).concat(5+b).concat(5+S),C,{hkl:w.create(y,b,S),spgrOp:g})}e.getSymmetryOperator=i;var o=w(),s=w(),u=w(),l=w();function c(h,g,y,b,S,C){var x=oe.zero();w.set(r,y,b,S),w.floor(o,C),oe.copy(x,h.operators[g]),w.floor(s,w.transformMat4(s,C,x)),oe.getTranslation(l,x),w.sub(l,l,s),w.add(l,l,o),w.add(l,l,r),oe.setTranslation(x,l),oe.mul(x,h.cell.fromFractional,x),oe.mul(x,x,h.cell.toFractional),w.sub(u,s,o);var A=y-u[0],P=b-u[1],T=S-u[2];return nn.create("".concat(g+1,"_").concat(5+A).concat(5+P).concat(5+T),x,{hkl:w.create(A,P,T),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(h){var g=_C[h[0]],y=_C[h[1]],b=_C[h[2]];return oe.ofRows([g,y,b,[0,0,0,1]])}function f(h){return[m(p(h[0],h[4],h[8]),v(h[12])),m(p(h[1],h[5],h[9]),v(h[13])),m(p(h[2],h[6],h[10]),v(h[14]))].join(",")}e.getOperatorXyz=f;function p(h,g,y){var b=[];if(h>0?b.push("+X"):h<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),C=b[1].charAt(0);if(S==="+")return"".concat(b[0].substr(1)).concat(b[1]);if(C==="+")return"".concat(b[1].substr(1)).concat(b[0])}throw new Error("unknown rotation '".concat(b,"', ").concat(h," ").concat(g," ").concat(y))}function v(h){switch(h){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function m(h,g){return g===""?h:h.length>2?"".concat(h,"+").concat(g):h.charAt(0)==="-"?"".concat(g).concat(h):"".concat(g,"+").concat(h)}})(ss||(ss={}));var _d;(function(e){function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}e.copy=a})(_d||(_d={}));var Xn;(function(e){e.Zero=0;var t=function(){var h=new ArrayBuffer(8),g=new ArrayBuffer(8);return{_int32:new Int32Array(h),_float64:new Float64Array(h),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}}(),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;function o(h){return typeof h=="number"}e.is=o;function s(h,g){return r[0]=h,r[1]=g,n[0]}e.create=s;function u(h){return n[0]=h,r[1]-r[0]}e.diff=u;function l(h){return n[0]=h,r[0]}e.fst=l;function c(h){return n[0]=h,r[1]}e.snd=c;function d(h,g){return n[0]=h,i[0]=g,r[0]===a[0]&&r[1]===a[1]}e.areEqual=d;function f(h,g){n[0]=h,i[0]=g;var y=r[0]-a[0];return y!==0?y:r[1]-a[1]}e.compare=f;function p(h,g,y){n[0]=h[g],i[0]=h[y];var b=r[0]-a[0];return b!==0?b:r[1]-a[1]}e.compareInArray=p;function v(h){return n[0]=h,pp(r[0],r[1])}e.hashCode=v;function m(h){return n[0]=h,"(".concat(r[0],", ").concat(r[1],")")}e.toString=m})(Xn||(Xn={}));var CN=Xn.Zero;function UD(e,t){return t<e?Xn.create(e,e):Xn.create(e,t+1)}function xP(e,t){return t<=e?Xn.create(e,e):Xn.create(e,t)}function dZ(e){return e<0?Xn.create(0,0):Xn.create(0,e)}var fZ=Xn.is,Dl=Xn.fst,Ad=Xn.snd,Mb=Xn.fst;function Rb(e){return Xn.snd(e)-1}var Df=Xn.diff,pZ=Xn.hashCode,vZ=Xn.toString;function mZ(e,t){return Xn.fst(e)<=t&&t<Xn.snd(e)}function hZ(e,t){var r=Dl(e);return t>=r&&t<Ad(e)?t-r:-1}function gZ(e,t){return Xn.fst(e)+t}var yZ=Xn.areEqual;function wN(e,t){var r=Df(e),n=Df(t);return r===0&&n===0?!0:r>0&&n>0&&Rb(e)>=Mb(t)&&Mb(e)<=Rb(t)}function bZ(e,t){return Df(e)?Df(t)?Dl(e)<=Dl(t)&&Ad(e)>=Ad(t):!0:Df(t)===0}function H_(e,t){var r=Dl(e);if(t<=r)return 0;var n=Ad(e);return t>=n?n-r:t-r}function SZ(e,t,r){var n=Dl(r),a=Dl(e);if(t<=n+a)return n;var i=Ad(r);return t>=i+a?i:t-a}function _N(e,t,r){return xP(H_(e,t),H_(e,r+1))}function xZ(e,t){return wN(e,t)?xP(Math.max(Dl(e),Dl(t)),Math.min(Ad(e),Ad(t))):CN}function CZ(e,t){return Df(_N(e,Mb(t),Rb(t)))}var Ce;(function(e){e.Empty=CN,e.ofSingleton=function(t){return UD(t,t)},e.ofRange=UD,e.ofBounds=xP,e.ofLength=dZ,e.is=fZ,e.has=mZ,e.indexOf=hZ,e.getAt=gZ,e.start=Dl,e.end=Ad,e.min=Mb,e.max=Rb,e.size=Df,e.hashCode=pZ,e.toString=vZ,e.areEqual=yZ,e.areIntersecting=wN,e.isSubInterval=bZ,e.findPredecessorIndex=H_,e.findPredecessorIndexInInterval=SZ,e.findRange=_N,e.intersectionSize=CZ,e.intersect=xZ})(Ce||(Ce={}));var Z0=[];function wZ(e){return[e]}function _Z(e){return e}function AZ(e){return Ns(e),e}function zD(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function TZ(e){return e&&(Array.isArray(e)||!!e.buffer)}function AN(e){return e[e.length-1]-e[0]+1===e.length}function G_(e){return e[0]}function q_(e){return e[e.length-1]+1}function PZ(e){return e[0]}function EZ(e){return e[e.length-1]}function TN(e){return e.length}function IZ(e){var t=e.length;return t?t>2?gY(t,e[0],e[t-1],e[t>>1]):hY(t,e[0],e[t-1]):0}function DZ(e){var t=e.length;return t>5?"[".concat(e[0],", ").concat(e[1],", ..., ").concat(e[t-1],"], length ").concat(t):"[".concat(e.join(", "),"]")}function PN(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?DN(e,t,0,r):-1}function MZ(e,t,r){return EN(e,t,Ce.start(r),Ce.end(r))}function EN(e,t,r,n){var a=e.length;return a===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?DN(e,t,r,n):-1}function RZ(e,t){return PN(e,t)>=0}function IN(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(AN(e))return!0;r--;for(var n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function wf(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:MN(e,t,0,r)}function OZ(e,t,r){var n=Ce.start(r),a=Ce.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?kZ(e,t,n+1,a):MN(e,t,n,a)}function BZ(e,t,r){return Ce.ofBounds(wf(e,t),wf(e,r+1))}function DN(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return-1}function MN(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return a>i?i+1:e[a]>=t?a:a+1}function kZ(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}function LZ(e,t){if(e===t)return!0;for(var r=hp(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else if(s>u)a++;else return!0}return!1}function FZ(e,t){if(e===t)return!0;var r=t.length,n=hp(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var l=e[a],c=t[i];l<c?a++:l>c?i++:(a++,i++,u++)}return u===r}function RN(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return RN(t,e);var a=hp(e,t),i=a.startI,o=a.startJ,s=a.endI,u=a.endJ,l=CP(e,t,i,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,p=0;for(d=0;d<i;d++)c[p++]=e[d];for(;f<u&&e[i]>t[f];)c[p++]=t[f++];for(;d<s&&f<u;){var v=e[d],m=t[f];v<m?(c[p++]=v,d++):v>m?(c[p++]=m,f++):(c[p++]=v,d++,f++)}for(;d<s;d++)c[p++]=e[d];for(;f<u;f++)c[p++]=t[f];for(;d<r;d++)c[p++]=e[d];for(;f<n;f++)c[p++]=t[f];return c}function NZ(e,t){if(e===t)return TN(e);var r=hp(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;return CP(e,t,n,a,i,o)}function CP(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function UZ(e,t){if(e===t)return e;var r=hp(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=CP(e,t,n,a,i,o),u=e.length,l=t.length;if(!s)return Z0;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,p=a;f<i&&p<o;){var v=e[f],m=t[p];v<m?f++:(v>m||(c[d++]=v,f++),p++)}return c}function zZ(e,t){if(e===t)return Z0;for(var r=e.length,n=hp(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,l=i,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return Z0;for(var p=new Int32Array(r-c),v=0,m=0;m<a;m++)p[v++]=e[m];for(u=a,l=i;u<o&&l<s;){var d=e[u],f=t[l];d<f?(p[v++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)p[v++]=e[u];return p}function VZ(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var a=new Int32Array(t),i=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function HZ(e,t){if(IN(e,t))return T_(0,e.length-1);for(var r=hp(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,l=0;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return Z0;if(l===f)return T_(0,e.length-1);var p=new Int32Array(l),v=0;for(s=n,u=a;s<i&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(p[v++]=s,s++),u++)}return p}var Vu={startI:0,startJ:0,endI:0,endJ:0};function hp(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(Vu.startI=wf(e,G_(t)),Vu.startJ=wf(t,G_(e)),Vu.endI=wf(e,q_(t)),Vu.endJ=wf(t,q_(e))):(Vu.startI=0,Vu.startJ=0,Vu.endI=r,Vu.endJ=n),Vu}var ze;(function(e){e.Empty=Z0,e.ofUnsortedArray=AZ,e.ofSingleton=wZ,e.ofSortedArray=_Z,e.ofRange=zD,e.ofBounds=function(t,r){return zD(t,r-1)},e.is=TZ,e.isRange=AN,e.has=RZ,e.indexOf=PN,e.indexOfInInterval=MZ,e.indexOfInRange=EN,e.start=G_,e.end=q_,e.min=PZ,e.max=EZ,e.size=TN,e.hashCode=IZ,e.toString=DZ,e.areEqual=IN,e.areIntersecting=LZ,e.isSubset=FZ,e.union=RN,e.intersect=UZ,e.subtract=zZ,e.findPredecessorIndex=wf,e.findPredecessorIndexInInterval=OZ,e.findRange=BZ,e.intersectionSize=NZ,e.deduplicate=VZ,e.indicesOf=HZ})(ze||(ze={}));var Iu=Ce.Empty,GZ=Ce.ofSingleton,qZ=Ce.ofRange,jZ=Ce.ofBounds;function Js(e){return e.length?ze.isRange(e)?Ce.ofRange(e[0],e[e.length-1]):e:Iu}function Mf(e){return Ce.is(e)?Ce.size(e):ze.size(e)}function WZ(e,t){return Ce.is(e)?Ce.has(e,t):ze.has(e,t)}function XZ(e,t){return Ce.is(e)?Ce.indexOf(e,t):ze.indexOf(e,t)}function j_(e,t){return Ce.is(e)?Ce.getAt(e,t):e[t]}function rm(e){return Ce.is(e)?Ce.min(e):ze.min(e)}function nm(e){return Ce.is(e)?Ce.max(e):ze.max(e)}function YZ(e){return Ce.is(e)?Ce.start(e):ze.start(e)}function KZ(e){return Ce.is(e)?Ce.end(e):ze.end(e)}function QZ(e){return Ce.is(e)?Ce.hashCode(e):ze.hashCode(e)}function ZZ(e){return Ce.is(e)?Ce.toString(e):ze.toString(e)}function $Z(e,t){return Ce.is(e)?Ce.is(t)?Ce.areEqual(e,t):VD(e,t):Ce.is(t)?VD(t,e):ze.areEqual(e,t)}function JZ(e,t){return Ce.is(e)?Ce.is(t)?Ce.areIntersecting(e,t):HD(t,e):Ce.is(t)?HD(e,t):ze.areIntersecting(e,t)}function e$(e,t){return Ce.is(e)?Ce.is(t)?Ce.isSubInterval(e,t):l$(e,t):Ce.is(t)?u$(e,t):ze.isSubset(e,t)}function t$(e,t){return Ce.is(e)?Ce.findPredecessorIndex(e,t):ze.findPredecessorIndex(e,t)}function r$(e,t,r){return Ce.is(e)?Ce.findPredecessorIndexInInterval(e,t,r):ze.findPredecessorIndexInInterval(e,t,r)}function n$(e,t,r){return Ce.is(e)?Ce.findRange(e,t,r):ze.findRange(e,t,r)}function a$(e,t){return Ce.is(e)?Ce.is(t)?Ce.intersectionSize(e,t):qD(t,e):Ce.is(t)?qD(e,t):ze.intersectionSize(e,t)}function i$(e,t){return Ce.is(e)?Ce.is(t)?f$(e,t):GD(t,e):Ce.is(t)?GD(e,t):Js(ze.union(e,t))}function o$(e,t){return Ce.is(e)?Ce.is(t)?Ce.intersect(e,t):jD(t,e):Ce.is(t)?jD(e,t):Js(ze.intersect(e,t))}function s$(e,t){return Ce.is(e)?Ce.is(t)?p$(e,t):m$(e,t):Ce.is(t)?v$(e,t):Js(ze.subtract(e,t))}function VD(e,t){return Ce.size(e)===ze.size(t)&&Ce.start(e)===ze.start(t)&&Ce.end(e)===ze.end(t)}function HD(e,t){return e.length!==0&&Ce.size(ze.findRange(e,Ce.min(t),Ce.max(t)))!==0}function u$(e,t){var r=Ce.min(t),n=Ce.max(t);if(n-r+1===0)return!0;var a=ze.min(e),i=ze.max(e);if(r<a||n>i)return!1;var o=ze.findRange(e,r,n);return Ce.size(o)===Ce.size(t)}function l$(e,t){var r=Ce.min(e),n=Ce.max(e);if(n-r+1===0)return!1;var a=ze.min(t),i=ze.max(t);return a>=r&&i<=n}function c$(e,t){var r=Mf(e),n=Mf(t);return r===0&&n===0?!0:r>0&&n>0&&nm(e)>=rm(t)&&rm(e)<=nm(t)}function d$(e,t){return Mf(e)?Mf(t)?rm(e)<=rm(t)&&nm(e)>=nm(t):!0:Mf(t)===0}function f$(e,t){if(Ce.areEqual(e,t))return e;var r=Ce.size(e),n=Ce.size(t);if(!n)return e;if(!r)return t;var a=Ce.min(e),i=Ce.min(t);if(c$(e,t))return Ce.ofRange(Math.min(a,i),Math.max(Ce.max(e),Ce.max(t)));var o,s,u,l;a<i?(o=r,s=a,u=n,l=i):(o=n,s=i,u=r,l=a);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return Js(c)}function GD(e,t){var r=Ce.size(t);if(!r)return e;if(d$(t,e))return t;for(var n=Ce.min(t),a=Ce.max(t),i=ze.findRange(e,n,a),o=Ce.start(i),s=Ce.end(i),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=a;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return Js(u)}function qD(e,t){if(!Ce.size(t))return 0;var r=ze.findRange(e,Ce.min(t),Ce.max(t));return Ce.end(r)-Ce.start(r)}function jD(e,t){if(!Ce.size(t))return Iu;var r=ze.findRange(e,Ce.min(t),Ce.max(t)),n=Ce.start(r),a=Ce.end(r),i=a-n;if(!i)return Iu;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return Js(o)}function p$(e,t){if(Ce.areEqual(e,t))return Iu;if(!Ce.areIntersecting(e,t))return e;var r=Ce.min(e),n=Ce.max(e),a=Ce.min(t),i=Ce.max(t);if(n<r||i<a)return e;if(Ce.isSubInterval(t,e))return Iu;if(Ce.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return Ce.ofRange(i+1,i+s);if(s<=0)return Ce.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=i+c;return Js(u)}return r<a?Ce.ofRange(r,a-1):Ce.ofRange(i+1,n)}function v$(e,t){var r=Ce.min(t),n=Ce.max(t);if(n<r)return e;var a=ze.findRange(e,r,n),i=Ce.start(a),o=Ce.end(a),s=e.length-(o-i);if(s<=0)return Iu;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<i;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return Js(u)}function m$(e,t){var r=Ce.min(e),n=Ce.max(e);if(n<r)return e;var a=n-r+1,i=ze.findRange(t,r,n),o=Ce.start(i),s=Ce.end(i),u=s-o;if(u===0)return e;var l=a-u;if(l<=0)return Iu;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],v=0,m=r;m<f;m++)c[v++]=m;for(var m=f;m<=p;m++)ze.indexOfInInterval(t,m,i)<0&&(c[v++]=m);for(var m=p+1;m<=n;m++)c[v++]=m;return Js(c)}function h$(e,t,r){if(Ce.is(e))for(var n=Ce.min(e),a=n,i=Ce.max(e);a<=i;a++)t(a,a-n,r);else for(var a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}function g$(e,t,r,n){if(Ce.is(e))for(var a=0,i=Ce.min(e),o=Ce.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(var a=0,i=0,o=e.length;i<o;i++){for(var s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}function y$(e,t,r){if(t===r)return e;var n=Mf(e),a=t.length,i=r.length;if(n===0||a===0||i===0)return Iu;for(var o=ze.findPredecessorIndex(r,t[rm(e)]),s=ze.findPredecessorIndex(r,t[nm(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[j_(e,c)],p=r[d];f<p?c++:(f>p||(u++,c++),d++)}if(u===0)return Iu;if(u===a&&u===i)return e;var v=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[j_(e,c)],p=r[d];f<p?c++:(f>p||(v[l++]=d,c++),d++)}return Js(v)}var Ee;(function(e){e.Empty=Iu,e.ofSingleton=GZ,e.ofRange=qZ,e.ofBounds=jZ,e.ofSortedArray=Js,e.has=WZ,e.indexOf=XZ,e.getAt=j_,e.min=rm,e.max=nm,e.start=YZ,e.end=KZ,e.size=Mf,e.hashCode=QZ,e.areEqual=$Z,e.areIntersecting=JZ,e.isSubset=e$,e.union=i$,e.intersect=o$,e.indexedIntersect=y$,e.subtract=s$,e.findPredecessorIndex=t$,e.findPredecessorIndexInInterval=r$,e.findRange=n$,e.intersectionSize=a$;function t(s,u,l){return h$(s,u,l)}e.forEach=t;function r(s,u,l,c){return g$(s,u,l,c)}e.forEachSegment=r;function n(s){return Ce.is(s)}e.isInterval=n;function a(s){return!Ce.is(s)}e.isSortedArray=a;function i(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=i;function o(s){return ZZ(s)}e.toString=o})(Ee||(Ee={}));function ON(e){for(var t=ze.ofSortedArray(e),r=ze.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function b$(e,t){for(var r=Ce.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=Ce.end(t)-r,ON(n)}function S$(e){var t=e.count;return t}function x$(e,t){var r=e.index;return r[t]}function C$(e,t,r){var n=e.offsets,a=Ee.max(n),i=r>=a?-1:Ee.findPredecessorIndex(n,r-1);return Ee.findRange(t,Ee.getAt(n,i),Ee.getAt(n,i+1)-1)}var w$=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Ce.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Ce.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Ee.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Ce.start(this.setRange),this.value.end=r,this.setRange=Ce.ofBounds(r,Ce.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Ce.min(this.setRange),r=Ce.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Ee.getAt(this.set,t)],this.segmentMax=this.segmentMap[Ee.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Ce.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function _$(e,t,r){var n=typeof r!="undefined"?Ce.ofBounds(r.start,r.end):Ce.ofBounds(0,Ee.size(t));return new w$(e.offsets,e.index,t,n)}var Qt;(function(e){e.create=ON,e.ofOffsets=b$,e.count=S$,e.getSegment=x$,e.projectValue=C$,e.transientSegments=_$})(Qt||(Qt={}));function A$(e){return new T$(e)}var T$=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,a=r.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(i<0?this.head=o:this.head=i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),us;(function(e){e.Empty=new Map;function t(o){return cS(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function a(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=a;function i(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=i})(us||(us={}));var P$=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),WD=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),E$=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),I$=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),D$=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),Ob;(function(e){e.Empty=new WD(0,-1);function t(s){return new P$(s)}e.Array=t;function r(s){return new E$(s)}e.Value=r;function n(s,u){return new WD(s,u)}e.Range=n;function a(s,u){return new I$(s,u)}e.map=a;function i(s,u){return new D$(s,u)}e.filter=i;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(Ob||(Ob={}));function si(){return si.empty()}(function(e){function t(f,p,v,m){return{origin:f,dirA:p,dirB:v,dirC:m}}e.create=t;function r(){return{origin:w(),dirA:w(),dirB:w(),dirC:w()}}e.empty=r;function n(f,p){return w.copy(f.origin,p.origin),w.copy(f.dirA,p.dirA),w.copy(f.dirB,p.dirB),w.copy(f.dirC,p.dirC),f}e.copy=n;function a(f){return n(r(),f)}e.clone=a;function i(f,p){return w.set(f,w.magnitude(p.dirA)*2,w.magnitude(p.dirB)*2,w.magnitude(p.dirC)*2)}e.size=i;var o=w();function s(f){return i(o,f),o[0]*o[1]*o[2]}e.volume=s;function u(f,p){return w.copy(f.origin,p.origin),w.normalize(f.dirA,p.dirA),w.normalize(f.dirB,p.dirB),w.normalize(f.dirC,p.dirC),f}e.normalize=u;var l=wn();function c(f,p,v){w.transformMat4(f.origin,p.origin,v);var m=wn.directionTransform(l,v);return w.transformMat3(f.dirA,p.dirA,m),w.transformMat3(f.dirB,p.dirB,m),w.transformMat3(f.dirC,p.dirC,m),f}e.transform=c;function d(f,p,v){return w.scale(f.dirA,p.dirA,v),w.scale(f.dirB,p.dirB,v),w.scale(f.dirC,p.dirC,v),f}e.scale=d})(si||(si={}));var mr;(function(e){function t(f,p,v){v===void 0&&(v=Float32Array);var m=f*p;return{data:new v(m),size:m,cols:f,rows:p}}e.create=t;function r(f,p,v){return f.data[f.rows*v+p]}e.get=r;function n(f,p,v,m){return f.data[f.rows*v+p]=m,f}e.set=n;function a(f,p,v,m){return f.data[f.rows*v+p]+=m,f}e.add=a;function i(f){return f.data.fill(0),f}e.makeZero=i;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,p,v){return{data:f,size:p*v,cols:p,rows:v}}e.fromArray=s;function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var v=p.rows,m=p.cols,h=p.data,g=f.data,y=0,b=0,S=0;y<v;S+=1,b+=m,++y)for(var C=S,x=0;x<m;C+=v,x++)g[C]=h[b+x];return f}e.transpose=u;function l(f,p,v){for(var m=p.cols,h=p.rows,g=v.rows,y=p.data,b=v.data,S=f.data,C=0,x=0,A=0;C<h;x+=m,C++)for(var P=0,T=0;T<g;A++,T++){for(var D=0,I=x,M=0;M<m;I++,P++,M++)D+=y[I]*b[P];S[A]=D}return f}e.multiplyABt=l;function c(f){for(var p=f.rows,v=f.cols,m=f.data,h=new Array(v),g=0;g<v;++g)h[g]=0;for(var y=0,b=0;y<p;++y)for(var g=0;g<v;++g,++b)h[g]+=m[b];for(var g=0;g<v;++g)h[g]/=p;return h}e.meanRows=c;function d(f,p){for(var v=f.rows,m=f.cols,h=f.data,g=0,y=0;g<v;++g)for(var b=0;b<m;++b,++y)h[y]-=p[b];return f}e.subRows=d})(mr||(mr={}));function AC(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function M$(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var R$=1192092896e-16,O$=1e-37;function B$(e,t,r,n,a,i,o,s){for(var u=R$*2,l=O$,c=0,d=0,f=0,p=0,v=Math.max(i,30),m=0,h=0,g=0,y=0,b=0,S=0,C=0,x=0,A=0,P=0,T=0,D=0,I=0,M=0,B=0,U=0,V=0,F=4660,Y=0,W=0,K=0,$=new Float64Array(o<<3);c<o;c++){for(f=0,T=0;f<i;f++)x=e[c*t+f],T+=x*x;if($[c]=T,n){for(f=0;f<o;f++)n[c*a+f]=0;n[c*a+c]=1}}for(;p<v;p++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(m=c*t|0,h=d*t|0,B=$[c],U=0,V=$[d],f=2,U+=e[m]*e[h],U+=e[m+1]*e[h+1];f<i;f++)U+=e[m+f]*e[h+f];if(!(Math.abs(U)<=u*Math.sqrt(B*V))){for(U*=2,D=B-V,I=M$(U,D),D<0?(M=(I-D)*.5,C=Math.sqrt(M/I),S=U/(I*C*2)):(S=Math.sqrt((I+D)/(I*2)),C=U/(I*S*2)),B=0,V=0,f=2,A=S*e[m]+C*e[h],P=-C*e[m]+S*e[h],e[m]=A,e[h]=P,B+=A*A,V+=P*P,A=S*e[m+1]+C*e[h+1],P=-C*e[m+1]+S*e[h+1],e[m+1]=A,e[h+1]=P,B+=A*A,V+=P*P;f<i;f++)A=S*e[m+f]+C*e[h+f],P=-C*e[m+f]+S*e[h+f],e[m+f]=A,e[h+f]=P,B+=A*A,V+=P*P;if($[c]=B,$[d]=V,b=1,n)for(g=c*a|0,y=d*a|0,f=2,A=S*n[g]+C*n[y],P=-C*n[g]+S*n[y],n[g]=A,n[y]=P,A=S*n[g+1]+C*n[y+1],P=-C*n[g+1]+S*n[y+1],n[g+1]=A,n[y+1]=P;f<o;f++)A=S*n[g+f]+C*n[y+f],P=-C*n[g+f]+S*n[y+f],n[g+f]=A,n[y+f]=P}}if(b===0)break}for(c=0;c<o;c++){for(f=0,T=0;f<i;f++)x=e[c*t+f],T+=x*x;$[c]=Math.sqrt(T)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)$[d]<$[f]&&(d=f);if(c!==d&&(AC($,c,d,T),n)){for(f=0;f<i;f++)AC(e,c*t+f,d*t+f,x);for(f=0;f<o;f++)AC(n,c*a+f,d*a+f,x)}}for(c=0;c<o;c++)r[c]=$[c];if(!!n)for(c=0;c<s;c++){for(T=c<o?$[c]:0;T<=l;){for(W=1/i,f=0;f<i;f++)F=F*214013+2531011,Y=(F>>16&32767&256)!==0?W:-W,e[c*t+f]=Y;for(p=0;p<2;p++)for(d=0;d<c;d++){for(T=0,f=0;f<i;f++)T+=e[c*t+f]*e[d*t+f];for(K=0,f=0;f<i;f++)x=e[c*t+f]-T*e[d*t+f],e[c*t+f]=x,K+=Math.abs(x);for(K=K?1/K:0,f=0;f<i;f++)e[c*t+f]*=K}for(T=0,f=0;f<i;f++)x=e[c*t+f],T+=x*x;T=Math.sqrt(T)}for(C=1/T,f=0;f<i;f++)e[c*t+f]*=C}}function k$(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(a=1,i=u,u=l,l=i);var c=mr.create(u,u),d=mr.create(1,l),f=mr.create(l,l);if(a===0)mr.transpose(c,e);else{for(i=0;i<s*o;i++)c.data[i]=e.data[i];for(;i<l*u;i++)c.data[i]=0}if(B$(c.data,u,d.data,f.data,l,u,l,u),t){for(i=0;i<l;i++)t.data[i]=d.data[i];for(;i<s;i++)t.data[i]=0}a===0?(r&&mr.transpose(r,c),n&&mr.transpose(n,f)):(r&&mr.transpose(r,f),n&&mr.transpose(n,c))}var Td;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return si.create(w.fromArray(w(),u,0),w.create(1,0,0),w.create(0,1,0),w.create(0,1,0));var l=mr.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=mr.create(3,3),p=mr.create(1,3),v=mr.create(3,3),m=mr.create(3,3),h=mr.meanRows(l),g=mr.subRows(mr.clone(l),h),y=mr.transpose(mr.create(c,3),g);mr.multiplyABt(f,y,y),k$(f,p,v,m);var b=w.create(h[0],h[1],h[2]),S=w.create(v.data[0],v.data[3],v.data[6]),C=w.create(v.data[1],v.data[4],v.data[7]),x=w.create(v.data[2],v.data[5],v.data[8]);return w.scale(S,S,Math.sqrt(p.data[0]/d)),w.scale(C,C,Math.sqrt(p.data[1]/d)),w.scale(x,x,Math.sqrt(p.data[2]/d)),si.create(b,S,C,x)}e.calculateMomentsAxes=r;var n=w(),a=w(),i=w(),o=w();function s(u,l){if(u.length===3)return si.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,p=-1/0,v=-1/0,m=-1/0,h=w(),g=w(),y=l.origin,b=w.normalize(a,l.dirA),S=w.normalize(i,l.dirB),C=w.normalize(o,l.dirC),x=0,A=u.length;x<A;x+=3){w.projectPointOnVector(h,w.fromArray(h,u,x),b,y);var P=w.dot(b,w.normalize(g,w.sub(g,h,y))),T=w.distance(h,y);P>0?T>c&&(c=T):T>d&&(d=T),w.projectPointOnVector(h,w.fromArray(h,u,x),S,y);var D=w.dot(S,w.normalize(g,w.sub(g,h,y))),I=w.distance(h,y);D>0?I>f&&(f=I):I>p&&(p=I),w.projectPointOnVector(h,w.fromArray(h,u,x),C,y);var M=w.dot(C,w.normalize(g,w.sub(g,h,y))),B=w.distance(h,y);M>0?B>v&&(v=B):B>m&&(m=B)}var U=w.setMagnitude(w(),b,(c+d)/2),V=w.setMagnitude(w(),S,(f+p)/2),F=w.setMagnitude(w(),C,(v+m)/2),Y=w(),W=function(K,$,J){w.copy(n,y),w.scaleAndAdd(n,n,b,K),w.scaleAndAdd(n,n,S,$),w.scaleAndAdd(n,n,C,J),w.add(Y,Y,n)};return W(c,f,v),W(c,f,-m),W(c,-p,-m),W(c,-p,v),W(-d,-p,-m),W(-d,-p,v),W(-d,f,v),W(-d,f,-m),w.scale(Y,Y,1/8),si.create(Y,U,V,F)}e.calculateBoxAxes=s})(Td||(Td={}));function Me(){return Me.zero()}(function(e){function t(I){return I.extrema!==void 0}e.hasExtrema=t;function r(I,M){return{center:I,radius:M}}e.create=r;function n(){return{center:w(),radius:0}}e.zero=n;function a(I){var M=r(w.clone(I.center),I.radius);return t(I)&&(M.extrema=I.extrema.map(function(B){return w.clone(B)})),M}e.clone=a;function i(I,M,B){return w.copy(I.center,M),I.radius=B,I}e.set=i;function o(I,M){return w.copy(I.center,M.center),I.radius=M.radius,t(M)&&s(I,M.extrema.map(function(B){return w.clone(B)})),I}e.copy=o;function s(I,M){var B;return I.extrema!==void 0?(I.extrema.length=0,(B=I.extrema).push.apply(B,M)):I.extrema=M,I}e.setExtrema=s;function u(I){for(var M=I.x,B=I.y,U=I.z,V=I.indices,F=0,Y=0,W=0,K=0,$=Ee.size(V),J=0;J<$;J++){var Z=Ee.getAt(V,J);F+=M[Z],Y+=B[Z],W+=U[Z]}$>0&&(F/=$,Y/=$,W/=$);for(var J=0;J<$;J++){var Z=Ee.getAt(V,J),N=M[Z]-F,j=B[Z]-Y,L=U[Z]-W,H=N*N+j*j+L*L;H>K&&(K=H)}return{center:w.create(F,Y,W),radius:Math.sqrt(K)}}e.computeBounding=u;function l(I,M,B){return w.transformMat4(I.center,M.center,B),I.radius=M.radius*oe.getMaxScaleOnAxis(B),t(M)&&s(I,M.extrema.map(function(U){return w.transformMat4(w(),U,B)})),I}e.transform=l;function c(I,M,B){return w.add(I.center,M.center,B),t(M)&&s(I,M.extrema.map(function(U){return w.add(w(),U,B)})),I}e.translate=c;function d(I,M,B){w.toArray(I.center,M,B),M[B+3]=I.radius}e.toArray=d;function f(I,M,B){return w.fromArray(I.center,M,B),I.radius=M[B+3],I}e.fromArray=f;function p(I,M){return w.scale(I.center,w.add(I.center,M.max,M.min),.5),I.radius=w.distance(I.center,M.max),e.setExtrema(I,[w.create(M.min[0],M.min[1],M.min[2]),w.create(M.max[0],M.max[1],M.max[2]),w.create(M.max[0],M.min[1],M.min[2]),w.create(M.min[0],M.max[1],M.max[2]),w.create(M.min[0],M.min[1],M.max[2]),w.create(M.max[0],M.min[1],M.max[2]),w.create(M.max[0],M.max[1],M.min[2]),w.create(M.min[0],M.max[1],M.min[2])]),I}e.fromBox3D=p;function v(I,M){return w.copy(I.center,M.origin),I.radius=Math.max(w.magnitude(M.dirA),w.magnitude(M.dirB),w.magnitude(M.dirC)),I}e.fromAxes3D=v;var m=w();function h(I,M,B){var U=M[0],V=M[1],F=M[2],Y=w.create(0,0,0);w.transformMat4(Y,Y,B);var W=w.create(U,V,F);w.transformMat4(W,W,B);var K=w.create(U,0,0);w.transformMat4(K,K,B);var $=w.create(0,V,F);w.transformMat4($,$,B);var J=w.create(0,0,F);w.transformMat4(J,J,B);var Z=w.create(U,0,F);w.transformMat4(Z,Z,B);var N=w.create(U,V,0);w.transformMat4(N,N,B);var j=w.create(0,V,0);w.transformMat4(j,j,B),w.add(m,Y,W),w.scale(m,m,.5);var L=Math.max(w.distance(Y,W),w.distance(K,$));return e.set(I,m,L/2),e.setExtrema(I,[Y,W,K,$,J,Z,N,j]),I}e.fromDimensionsAndTransform=h;var g=w();function y(I,M,B){var U=w.distance(M.center,B);return U<M.radius?e.copy(I,M):(w.sub(g,M.center,B),w.sub(g,M.center,g),w.setMagnitude(g,g,M.radius),w.scale(I.center,w.add(g,g,B),.5),I.radius=w.distance(I.center,B),I)}e.addVec3=y;function b(I,M,B){return w.copy(I.center,M.center),I.radius=Math.max(M.radius,w.distance(M.center,B.center)+B.radius),t(M)&&t(B)&&s(I,It(It([],M.extrema.map(function(U){return w.clone(U)}),!0),B.extrema.map(function(U){return w.clone(U)}),!0)),I}e.expandBySphere=b;var S=w();function C(I,M,B){var U,V;if(w.copy(I.center,M.center),I.radius=M.radius+B,M.radius<1e-12||((V=(U=M.extrema)===null||U===void 0?void 0:U.length)!==null&&V!==void 0?V:0)<=1)return I.extrema=void 0,I;if(t(M)){for(var F=new Float32Array(M.extrema.length*3),Y=0;Y<M.extrema.length;Y++)w.toArray(M.extrema[Y],F,Y*3);var W=Td.calculateMomentsAxes(F);si.scale(W,si.normalize(W,W),B),s(I,M.extrema.map(function(K){w.sub(S,K,M.center);var $=w.clone(K),J=w.dot(S,W.dirA)<0?-1:1;w.scaleAndAdd($,$,W.dirA,J);var Z=w.dot(S,W.dirB)<0?-1:1;w.scaleAndAdd($,$,W.dirB,Z);var N=w.dot(S,W.dirC)<0?-1:1;return w.scaleAndAdd($,$,W.dirC,N),$}))}return I}e.expand=C;function x(I,M){return I.radius===M.radius&&w.exactEquals(I.center,M.center)}e.exactEquals=x;function A(I,M){var B=I.radius,U=M.radius;return Math.abs(B-U)<=zr*Math.max(1,Math.abs(B),Math.abs(U))&&w.equals(I.center,M.center)}e.equals=A;function P(I,M){if(t(M)){for(var B=0,U=M.extrema;B<U.length;B++){var V=U[B];if(w.distance(I.center,V)>I.radius)return!1}return!0}else return w.distance(I.center,M.center)+M.radius<=I.radius}e.includes=P;function T(I,M){return w.distance(I.center,M.center)<=I.radius+M.radius}e.overlaps=T;function D(I,M){return w.distance(I.center,M.center)-I.radius+M.radius}e.distance=D})(Me||(Me={}));function Ut(){return Ut.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:w(),max:w()}}e.zero=r;function n(y,b){return w.copy(y.min,b.min),w.copy(y.max,b.max),y}e.copy=n;function a(y){return n(r(),y)}e.clone=a;function i(y,b){if(Me.hasExtrema(b))return o(y,b.extrema);var S=w.create(b.radius,b.radius,b.radius);return w.sub(y.min,b.center,S),w.add(y.max,b.center,S),y}e.fromSphere3D=i;function o(y,b){e.setEmpty(y);for(var S=0,C=b.length;S<C;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=w.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=w.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),C=y.x,x=y.y,A=y.z,P=y.indices,T=0,D=Ee.size(P);T<D;T++){var I=Ee.getAt(P,T);b[0]=Math.min(C[I],b[0]),b[1]=Math.min(x[I],b[1]),b[2]=Math.min(A[I],b[2]),S[0]=Math.max(C[I],S[0]),S[1]=Math.max(x[I],S[1]),S[2]=Math.max(A[I],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return w.sub(y,b.max,b.min)}e.size=u;var l=w();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return w.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return w.min(y.min,y.min,b),w.max(y.max,y.max,b),y}e.add=f;function p(y,b,S){return w.sub(y.min,b.min,S),w.add(y.max,b.max,S),y}e.expand=p;function v(y,b,S){return w.scale(y.min,b.min,S),w.scale(y.max,b.max,S),y}e.scale=v;var m=w();function h(y,b,S){var C=b.min,x=C[0],A=C[1],P=C[2],T=b.max,D=T[0],I=T[1],M=T[2];return d(y),f(y,w.transformMat4(m,w.set(m,x,A,P),S)),f(y,w.transformMat4(m,w.set(m,x,A,M),S)),f(y,w.transformMat4(m,w.set(m,x,I,P),S)),f(y,w.transformMat4(m,w.set(m,x,I,M),S)),f(y,w.transformMat4(m,w.set(m,D,A,P),S)),f(y,w.transformMat4(m,w.set(m,D,A,M),S)),f(y,w.transformMat4(m,w.set(m,D,I,P),S)),f(y,w.transformMat4(m,w.set(m,D,I,M),S)),y}e.transform=h;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Ut||(Ut={}));function jf(e,t,r){return new L$(e,t,r)}var L$=function(){function e(t,r,n){var a=N$(t,r,n);this.ctx=U$(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=_d.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i!=null?i:this.result;return XD(this.ctx,o),o},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,XD(this.ctx,this.result)},e}();function F$(e){for(var t=e.expandedBox,r=e.size,n=r[0],a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,p=e.delta,v=n*a*i,m=t.min,h=m[0],g=m[1],y=m[2],b=0,S=0,C=new Uint32Array(v),x=new Int32Array(f),A=0;A<f;A++){var P=Ee.getAt(d,A),T=Math.floor((s[P]-h)/p[0]),D=Math.floor((u[P]-g)/p[1]),I=Math.floor((l[P]-y)/p[2]),M=(T*a+D)*i+I;(C[M]+=1)===1&&(S+=1),x[A]=M}if(c)for(var A=0;A<f;A++){var P=Ee.getAt(d,A);c[P]>b&&(b=c[P])}for(var B=new Int32Array(S),P=0,U=0;P<v;P++){var V=C[P];V>0&&(C[P]=U+1,B[U]=V,U+=1)}for(var F=new Uint32Array(S),P=1;P<S;++P)F[P]+=F[P-1]+B[P-1];for(var Y=new Int32Array(S),W=new Int32Array(f),P=0;P<f;P++){var K=C[x[P]];if(K>0){var $=K-1;W[F[$]+Y[$]]=P,Y[$]+=1}}return{size:e.size,bucketArray:W,bucketCounts:B,bucketOffset:F,grid:C,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function N$(e,t,r){var n=Ut.expand(Ut(),t.box,w.create(.5,.5,.5)),a=e.indices,i=Ut.size(w.zero(),n),o,s,u=Ee.size(a),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];var p={x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},v={size:s,data:p,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return F$(v)}function U$(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function XD(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,p=f.x,v=f.y,m=f.z,h=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,C=e.isCheck,x=e.x,A=e.y,P=e.z,T=S+b,D=T*T;_d.reset(t);var I=Math.max(0,Math.floor((x-T-n[0])/y[0])),M=Math.max(0,Math.floor((A-T-n[1])/y[1])),B=Math.max(0,Math.floor((P-T-n[2])/y[2])),U=Math.min(i-1,Math.floor((x+T-n[0])/y[0])),V=Math.min(o-1,Math.floor((A+T-n[1])/y[1])),F=Math.min(s-1,Math.floor((P+T-n[2])/y[2]));if(I>U||M>V||B>F)return!1;for(var Y=I;Y<=U;Y++)for(var W=M;W<=V;W++)for(var K=B;K<=F;K++){var $=d[(Y*o+W)*s+K];if($!==0)for(var J=$-1,Z=u[J],N=l[J],j=Z+N,L=Z;L<j;L++){var H=Ee.getAt(h,c[L]),G=p[H]-x,q=v[H]-A,X=m[H]-P,Q=G*G+q*q+X*X;if(Q<=D){if(b>0&&Math.sqrt(Q)-g[H]>S)continue;if(C)return!0;_d.add(t,c[L],Q)}}}return t.count>0}function z$(e,t,r){if(r)return YD(e,t,r.min,r.max);var n=oo(e),a=n[0],i=n[1];return YD(e,t,a,i)}function YD(e,t,r,n){var a=(n-r)/t;a===0&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}var Ua;(function(e){e.One={transform:{kind:"matrix",matrix:oe.identity()},cells:gr.create(gr.Space([1,1,1],[0,1,2]),gr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=oe.zero(),r=oe.zero();function n(u){if(u.transform.kind==="matrix")return oe.copy(oe(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=oe.fromScaling(t,w.div(w.zero(),Ut.size(w.zero(),u.transform.fractionalBox),w.ofArray(l.dimensions))),d=oe.fromTranslation(r,u.transform.fractionalBox.min);return oe.mul3(oe.zero(),u.transform.cell.fromFractional,d,c)}return oe.identity()}e.getGridToCartesianTransform=n;function a(u,l){return u===l}e.areEquivalent=a;function i(u){return u.cells.data.length===0}e.isEmpty=i;function o(u,l){l||(l=Me());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Me.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=z$(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(Ua||(Ua={}));var Ml=function(){function e(){this.count=0,this.center=w(),this.radiusSq=0}return e.prototype.reset=function(){w.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){w.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&w.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=w.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=w.distance(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=Me()),w.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=w(),n=w();function a(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,p=0;p<f;p++)w.set(r,l[p],c[p],d[p]),t.includeStep(r);t.finishedIncludeStep();for(var p=0;p<f;p++)w.set(r,l[p],c[p],d[p]),t.radiusStep(r);return w.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=a;function i(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return w.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=i;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return w.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(Ml||(Ml={}));var To=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Ml,this.dir=V$(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=w.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,w.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,w.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=w.dot(this.dir[t],r);a-n<this.minDist[t]&&(this.minDist[t]=a-n,w.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),a+n>this.maxDist[t]&&(this.maxDist[t]=a+n,w.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Me.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.includePosition(a)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,a=this.dir.length;n<a;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Me.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.radiusPosition(a)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Me.setExtrema(this.centroidHelper.getSphere(t),It([],this.extrema,!0))},e.prototype.getBox=function(t){return Ut.fromVec3Array(t||Ut(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=w(),this.extrema[t*2+1]=w();this.centroidHelper.reset()},e}();function V$(e){var t;switch(e){case"6":t=It([],py,!0);break;case"14":t=It(It([],py,!0),TC,!0);break;case"26":t=It(It(It([],py,!0),TC,!0),KD,!0);break;case"98":t=It(It(It(It(It(It([],py,!0),TC,!0),KD,!0),H$,!0),G$,!0),q$,!0);break}return t.map(function(r){var n=w.create(r[0],r[1],r[2]);return w.normalize(n,n)})}var py=[[1,0,0],[0,1,0],[0,0,1]],TC=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],KD=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],H$=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],G$=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],q$=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];function xo(e){return e}(function(e){function t(r){return r.__key||(r.__key=Jr.create22()),r.__key}e.getUUID=t})(xo||(xo={}));var Nu=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++){var o=i[a];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.dispose()}})},e}();function j$(e,t){var r=this;return Fe.create("Create Volume",function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){if(n=e.header,a=e.values,i=gr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=a;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,p=0,o=new Float64Array(u*l*c),v=0;v<u;v++)for(m=0;m<l;m++)for(h=0;h<c;h++)o[f++]=a[p],p+=d;return g=gr.create(i,gr.Data1(o)),y=oe.fromTranslation(oe(),n.origin),b=oe.fromBasis(oe(),n.basisX,n.basisY,n.basisZ),oe.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:dS(o),max:Eu(o),mean:fS(o),sigma:pS(o)}},sourceData:Bb.create(e),customProperties:new Nu,_propertyData:Object.create(null)}]})})})}var Bb;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(Bb||(Bb={}));function W$(e,t,r){var n=1,a;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function X$(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function Y$(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=W$(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>a&&(a=l)}}return{mantissaDigits:n,integerDigits:a}}function K$(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function kb(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function W_(e,t){return parseFloat(e.toPrecision(t))}function BN(e,t){var r=this;return Fe.create("Create Volume",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){return a=e.volume_data_3d_info,i=e.volume_data_3d,o=Ri.create(a.spacegroup_number.value(0),w.ofArray(a.spacegroup_cell_size.value(0)),w.scale(w.zero(),w.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=gr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(a.sample_count.value(0)),c=gr.Space(l,gr.invertAxisOrder(s),Float32Array),d=gr.create(c,gr.Data1(i.values.toArray({array:Float32Array}))),f=w.ofArray(u(a.origin.value(0))),p=w.ofArray(u(a.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Ut.create(f,w.add(w.zero(),f,p))},cells:d,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:Lb.create(e),customProperties:new Nu,_propertyData:Object.create(null)}]})})})}var Lb;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(Lb||(Lb={}));var ht;(function(e){function t(v){var m,h,g,y;return((y=(g=(h=(m=v==null?void 0:v.grid)===null||m===void 0?void 0:m.cells)===null||h===void 0?void 0:h.space)===null||g===void 0?void 0:g.dimensions)===null||y===void 0?void 0:y.length)&&(v==null?void 0:v.sourceData)&&(v==null?void 0:v.customProperties)&&(v==null?void 0:v._propertyData)}e.is=t;var r;(function(v){function m(A,P,T){return tn(S(A,T).absoluteValue,S(P,T).absoluteValue,T.sigma/100)}v.areSame=m;function h(A){return{kind:"absolute",absoluteValue:A}}v.absolute=h;function g(A){return{kind:"relative",relativeValue:A}}v.relative=g;function y(A,P){return P*A.sigma+A.mean}v.calcAbsolute=y;function b(A,P){return A.sigma===0?0:(P-A.mean)/A.sigma}v.calcRelative=b;function S(A,P){return A.kind==="absolute"?A:{kind:"absolute",absoluteValue:v.calcAbsolute(P,A.relativeValue)}}v.toAbsolute=S;function C(A,P){return A.kind==="relative"?A:{kind:"relative",relativeValue:v.calcRelative(P,A.absoluteValue)}}v.toRelative=C;function x(A){return A.kind==="relative"?"".concat(A.relativeValue.toFixed(2)," \u03C3"):"".concat(A.absoluteValue.toPrecision(4))}v.toString=x})(r=e.IsoValue||(e.IsoValue={}));function n(v,m,h){if(h==="relative")return r.relative(m);var g=r.absolute(m);if(Lb.is(v.sourceData)){var y={min:v.sourceData.data.volume_data_3d_info.min_source.value(0),max:v.sourceData.data.volume_data_3d_info.max_source.value(0),mean:v.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:v.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(g,y)}return g}e.adjustedIsoValue=n;var a={min:-1,max:1,mean:0,sigma:.1};function i(v,m){var h=m||a,g=h.min,y=h.max,b=h.mean,S=h.sigma,C=(g-b)/S,x=(y-b)/S,A=v;return v.kind==="absolute"?v.absoluteValue<g?A=e.IsoValue.absolute(g):v.absoluteValue>y&&(A=e.IsoValue.absolute(y)):v.relativeValue<C?A=e.IsoValue.relative(C):v.relativeValue>x&&(A=e.IsoValue.relative(x)),E.Conditioned(A,{absolute:E.Converted(function(P){return e.IsoValue.toAbsolute(P,Ua.One.stats).absoluteValue},function(P){return e.IsoValue.absolute(P)},E.Numeric(b,{min:g,max:y,step:W_(S/100,2)})),relative:E.Converted(function(P){return e.IsoValue.toRelative(P,Ua.One.stats).relativeValue},function(P){return e.IsoValue.relative(P)},E.Numeric(Math.min(1,x),{min:C,max:x,step:W_(Math.round((y-g)/S)/100,2)}))},function(P){return P.kind==="absolute"?"absolute":"relative"},function(P,T){return T==="absolute"?e.IsoValue.toAbsolute(P,h):e.IsoValue.toRelative(P,h)},{isEssential:!0})}e.createIsoValueParam=i,e.IsoValueParam=i(e.IsoValue.relative(2)),e.One={label:"",grid:Ua.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Nu,_propertyData:Object.create(null)};function o(v,m){return Ua.areEquivalent(v.grid,m.grid)}e.areEquivalent=o;function s(v){return Ua.isEmpty(v.grid)}e.isEmpty=s;function u(v){return Bb.is(v.sourceData)?v.sourceData.data.header.orbitals:!1}e.isOrbitals=u;function l(v){return{kind:"volume-loci",volume:v}}e.Loci=l;function c(v){return!!v&&v.kind==="volume-loci"}e.isLoci=c;function d(v,m){return v.volume===m.volume}e.areLociEqual=d;function f(v){return Ua.isEmpty(v.volume.grid)}e.isLociEmpty=f;function p(v,m){return Ua.getBoundingSphere(v.grid,m)}e.getBoundingSphere=p,function(v){function m(S,C){return{kind:"isosurface-loci",volume:S,isoValue:C}}v.Loci=m;function h(S){return!!S&&S.kind==="isosurface-loci"}v.isLoci=h;function g(S,C){return S.volume===C.volume&&e.IsoValue.areSame(S.isoValue,C.isoValue,S.volume.grid.stats)}v.areLociEqual=g;function y(S){return S.volume.grid.cells.data.length===0}v.isLociEmpty=y;function b(S,C,x){return e.getBoundingSphere(S,x)}v.getBoundingSphere=b}(e.Isosurface||(e.Isosurface={})),function(v){function m(x,A){return{kind:"cell-loci",volume:x,indices:A}}v.Loci=m;function h(x){return!!x&&x.kind==="cell-loci"}v.isLoci=h;function g(x,A){return x.volume===A.volume&&Ee.areEqual(x.indices,A.indices)}v.areLociEqual=g;function y(x){return Ee.size(x.indices)===0}v.isLociEmpty=y;var b=new To("98"),S=w();function C(x,A,P){b.reset();for(var T=Ua.getGridToCartesianTransform(x.grid),D=x.grid.cells.space.getCoords,I=0,M=Ee.size(A);I<M;I++){var B=Ee.getAt(A,I);D(B,S),w.transformMat4(S,S,T),b.includePosition(S)}b.finishedIncludeStep();for(var I=0,M=Ee.size(A);I<M;I++){var B=Ee.getAt(A,I);D(B,S),w.transformMat4(S,S,T),b.radiusPosition(S)}var U=b.getSphere(P);return Me.expand(U,U,oe.getMaxScaleOnAxis(T)*10)}v.getBoundingSphere=C}(e.Cell||(e.Cell={}))})(ht||(ht={}));function kc(e,t){return{value:e,unit:t}}var $0;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:Jr.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,p=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),p=o(p,c)):Di(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),p=s(p,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,a(d,c),a(f,c),a(p,c)):Di(u.xyzOrdering.index,c)||(d=i(d,u.xyzOrdering.index,c),f=i(f,u.xyzOrdering.index,c),p=i(p,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:Jr.create22(),atomId:l,occupancy:ce.ofConst(1,u.elementCount,ce.Schema.int),B_iso_or_equiv:ce.ofConst(0,u.elementCount,ce.Schema.float),xyzDefined:!0,x:d,y:f,z:p}}e.getAtomicConformation=r;var n=[.123];function a(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function i(u,l,c){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})($0||($0={}));var X_;(function(e){function t(r,n,a,i){return{id:Jr.create22(),label:r,basic:n,sourceData:i,bonds:a}}e.create=t})(X_||(X_={}));function Q$(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,oo(e.x)),n.push.apply(n,oo(e.y)),a.push.apply(a,oo(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,oo(t.spheres.x)),n.push.apply(n,oo(t.spheres.y)),a.push.apply(a,oo(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,oo(t.gaussians.x)),n.push.apply(n,oo(t.gaussians.y)),a.push.apply(a,oo(t.gaussians.z))));var i=oo(r),o=i[0],s=i[1],u=oo(n),l=u[0],c=u[1],d=oo(a),f=d[0],p=d[1],v=o+(s-o)/2,m=l+(c-l)/2,h=f+(p-f)/2;return w.create(v,m,h)}function Z$(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){var i=n.auth_id;t.add(i),r.add(a)}),{auth:t.size,label:r.size}}var eo;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,v=d.b,m=d.offset,h=f.a,g=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(p[b]!==h[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(v[b]!==g[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(m[b]!==y[b])return!1;for(var C=0,x=Object.keys(d.edgeProps);C<x.length;C++){var A=x[C],P=d.edgeProps[A],T=f.edgeProps[A];if(!T)return!1;for(var b=0,S=P.length;b<S;b++)if(P[b]!==T[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,p,v,m,h,g){this.offset=f,this.a=p,this.b=v,this.edgeCount=m,this.props=g,this.vertexCount=f.length-1,this.edgeProps=h||{}}return d.prototype.getEdgeIndex=function(f,p){var v,m;f<p?(v=f,m=p):(v=p,m=f);for(var h=this.offset[v],g=this.offset[v+1];h<g;h++)if(this.b[h]===m)return h;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var v=this.offset[f],m=this.offset[f+1];v<m;v++)if(this.b[v]===p)return v;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,v,m,h){return new r(d,f,p,v,m,h)}e.create=n;var a=function(){function d(f,p,v){this.vertexCount=f,this.xs=p,this.ys=v,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),h=0,g=this.xs.length;h<g;h++)m[this.xs[h]]++;for(var h=0,g=this.ys.length;h<g;h++)m[this.ys[h]]++;for(var y=0,h=0;h<this.vertexCount;h++)this.offsets[h]=y,y+=m[h];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f],m=this.offsets[p]+this.bucketFill[p];this.a[v]=f,this.b[v]=p,this.bucketFill[f]++,this.a[m]=p,this.b[m]=f,this.bucketFill[p]++,this.current++,this.curA=v,this.curB=m},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d}();e.EdgeBuilder=a;var i=function(){function d(f,p,v){this.vertexCount=f,this.xs=p,this.ys=v,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var m=new Int32Array(this.vertexCount),h=0,g=this.xs.length;h<g;h++)m[this.xs[h]]++;for(var y=0,h=0;h<this.vertexCount;h++)this.offsets[h]=y,y+=m[h];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f];this.a[v]=f,this.b[v]=p,this.bucketFill[f]++,this.current++,this.curA=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=i;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var v=f,m=p;f>p&&(v=p,m=f);var h=Jo(v,m);return this.included.has(h)?!1:(this.included.add(h),this.xs[this.xs.length]=v,this.ys[this.ys.length]=m,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,p){var v=new e.EdgeBuilder(d,f,p);return v.addAllEdges(),v.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var p=d.b,v=d.offset,m=d.vertexCount,h=d.edgeProps,g=new Int32Array(m),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var S=0,y=0;y<m;y++)if(g[y]!==0)for(var C=v[y],x=v[y+1];C<x;C++)p[C]>y&&g[p[C]]!==0&&S++;for(var A=new Int32Array(f.length+1),P=new Int32Array(2*S),T=new Int32Array(2*S),D=new Int32Array(2*S),I=0,M=0,y=0;y<m;y++)if(g[y]!==0){for(var B=g[y]-1,C=v[y],x=v[y+1];C<x;C++){var U=g[p[C]];U!==0&&(T[I]=B,D[I]=U-1,P[I]=C,I++)}A[++M]=I}for(var V={},F=0,Y=Object.keys(h);F<Y.length;F++){var W=Y[F];V[W]=kY(h[W],P)}return n(A,T,D,S,V)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var p=new Int32Array(f),v=0,m=f;v<m;v++)p[v]=v;return{componentCount:f,componentIndex:p}}for(var h=new Int32Array(f),v=0,m=f;v<m;v++)h[v]=-1;var g=0;h[0]=g;var y=d.offset,b=d.b,S=[0],C=A$(f);for(C.remove(0);S.length>0;){for(var x=S.pop(),A=h[x],P=y[x],T=y[x+1];P<T;P++){var D=b[P];!C.has(D)||(C.remove(D),S.push(D),h[D]=A)}S.length===0&&C.head>=0&&(S.push(C.head),h[C.head]=++g,C.remove(C.head))}return{componentCount:f,componentIndex:h}}e.connectedComponents=l;function c(d,f,p,v){if(ze.areIntersecting(f,p))return!0;if(v<1)return!1;for(var m=new Set,h=0,g=f.length;h<g;++h)m.add(f[h]);return kN(d,f,p,v,m)}e.areVertexSetsConnected=c})(eo||(eo={}));function kN(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var p=i[d];if(!a.has(p)){if(ze.has(r,p))return!0;a.add(p),s[s.length]=p}}return n>1?kN(e,s,r,n-1,a):!1}var $$=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),Xs;(function(e){function t(r){var n=r.name,a=new $$;return{descriptor:r,formatRegistry:a,isApplicable:function(i){return a.isApplicable(i)},get:function(i){if(i._staticPropertyData[n])return i._staticPropertyData[n];if(!i.customProperties.has(r)){var o=a.get(i.sourceData.kind);if(!!o)return i._staticPropertyData[n]=o(i),i.customProperties.add(r),i._staticPropertyData[n]}},set:function(i,o){i._staticPropertyData[n]=o},delete:function(i){delete i._staticPropertyData[n]}}}e.create=t})(Xs||(Xs={}));function J$(e,t,r,n){for(var a=new eo.EdgeBuilder(n,e,t),i=new Int32Array(a.slotCount),o=new Int8Array(a.slotCount),s=new Array(a.slotCount),u=new Array(a.slotCount),l=0,c=a.edgeCount;l<c;l++)a.addNextEdge(),a.assignProperty(i,r.key?r.key[l]:-1),a.assignProperty(o,r.order?r.order[l]:1),a.assignProperty(s,r.distance?r.distance[l]:-1),a.assignProperty(u,r.flag?r.flag[l]:1);return a.createGraph({key:i,order:o,distance:s,flag:u})}var Ka;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=Xs.create(e.Descriptor),e.DefaultProps={maxDistance:-1};function t(r,n){n===void 0&&(n={});var a=_(_({},e.DefaultProps),n),i=r.pairs,o=r.count,s=i.indexA.toArray(),u=i.indexB.toArray(),l=i.key&&i.key.toArray(),c=i.order&&i.order.toArray(),d=i.distance&&i.distance.toArray(),f=i.flag&&i.flag.toArray();return{bonds:J$(s,u,{key:l,order:c,distance:d,flag:f},o),maxDistance:a.maxDistance}}e.fromData=t})(Ka||(Ka={}));function ur(e){return function(t){return wP(e,t)}}function wP(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o=i==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:i==="int"?function(s){return ud(r,n[2*s],n[2*s+1])||0}:function(s){return bl(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return Ia(a,o,s)},areValuesEqual:LN(e)}}function LN(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function eJ(e){for(var t=e.count,r=e.indices,n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function FN(e,t){return{name:t,blocks:e}}function _P(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split("."),o=i[0],s=i[1];return t[o].getField(s||"")}}}function tJ(e,t,r){return{categoryNames:e,header:r,categories:t}}function Ga(e,t,r,n){return{rowCount:t,name:e,fieldNames:It([],r,!0),getField:function(a){return n[a]}}}(function(e){function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}}e.empty=t;function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.ofFields=r;function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var l=u[s];o[l]=lt.ofColumn(i[l])}return r(a,o)}e.ofTable=n})(Ga||(Ga={}));var lt;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(p){var v=s[p];return!v||v==="."||v==="?"?"":v},c=function(p){var v=s[p];return ud(v,0,v.length)||0},d=function(p){var v=s[p];return bl(v,0,v.length)||0},f=function(p){var v=s[p],m=v.length;if(m>1)return 0;if(m===0)return 1;var h=v.charCodeAt(0);return h===46?1:h===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(p,v){return s[p]===s[v]},toStringArray:function(p){return p?Ia(u,l,p):s},toIntArray:function(p){return Ia(u,c,p)},toFloatArray:function(p){return Ia(u,d,p)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(p){return""+s[p]},c=function(p){return s[p]},d=function(p){return 0},f=function(p){return!p||p.array&&s instanceof p.array?s:Ia(u,c,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(p,v){return s[p]===s[v]},toStringArray:function(p){return Ia(u,l,p)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function a(s){var u=s.data,l=s.indices,c=s.count,d=function(m){var h=u.substring(l[2*m],l[2*m+1]);return h==="."||h==="?"?"":h},f=function(m){return ud(u,l[2*m],l[2*m+1])||0},p=function(m){return bl(u,l[2*m],l[2*m+1])||0},v=function(m){var h=l[2*m],g=l[2*m+1]-h;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(h);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:p,valueKind:v,areValuesEqual:LN(s),toStringArray:function(m){return Ia(c,d,m)},toIntArray:function(m){return Ia(c,f,m)},toFloatArray:function(m){return Ia(c,p,m)}}}e.ofTokens=a;function i(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,p,v;switch(s.schema.valueType){case"float":case"int":f=function(h){return""+s.value(h)},p=s.value,v=s.value;break;case"str":f=s.value,p=function(h){var g=s.value(h);return ud(g,0,g.length)||0},v=function(h){var g=s.value(h);return bl(g,0,g.length)||0};break;case"list":var m=s.schema.separator;f=function(h){return s.value(h).join(m)},p=function(h){return NaN},v=function(h){return NaN};break;default:throw new Error("unsupported valueType '".concat(s.schema.valueType,"'"))}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:v,valueKind:l,areValuesEqual:c,toStringArray:function(h){return Ia(u,f,h)},toIntArray:function(h){return Ia(u,p,h)},toFloatArray:function(h){return Ia(u,v,h)}}}e.ofColumn=i;function o(s,u){return i(ce.Undefined(s,u))}e.ofUndefined=o})(lt||(lt={}));function rJ(e,t,r,n){var a=r?0:1;switch(t){case 1:return n==="brackets"?function(i){return"".concat(e,"[").concat(i+a,"]")}:function(i){return"".concat(e,"_").concat(i+a)};case 2:return n==="brackets"?function(i,o){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"]")}:function(i,o){return"".concat(e,"_").concat(i+a).concat(o+a)};case 3:return n==="brackets"?function(i,o,s){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"][").concat(s+a,"]")}:function(i,o,s){return"".concat(e,"_").concat(i+a).concat(o+a).concat(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function nJ(e,t,r,n){var a=t.create();if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(a,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var p=0;p<f;p++){var s=e.getField(n(o,l,p));t.set(a,o,l,p,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return a}var Lv;(function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(a,i){return t(a)===t(i)}e.equal=r;function n(a,i,o){o===void 0&&(o=!1);var s="".concat(a).concat(i?".".concat(i):"");return o?t(s):s}e.create=n})(Lv||(Lv={}));function aJ(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=tl(e,o,r)}return n}function tl(e,t,r){return lJ(e,t,r)}function iJ(e,t){return new NN(t,e,!0)}function oJ(e){switch(e.valueType){case"str":return function(t,r,n){return PC(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return PC(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return PC(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function PC(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function sJ(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(l){return a(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return Ia(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,l){return Di(o(u),o(l))},toArray:s}}function uJ(e,t,r){var n=e.space,a=t.fieldNames.includes("".concat(r,"[0]"))||t.fieldNames.includes("".concat(r,"[0][0]"))||t.fieldNames.includes("".concat(r,"[0][0][0]")),i=a?0:1,o=t.fieldNames.includes("".concat(r,"_1"))||t.fieldNames.includes("".concat(r,"_11"))||t.fieldNames.includes("".concat(r,"_111"))?"underscore":"brackets",s=rJ(r,n.rank,a,o),u=t.getField(s(i,i,i))||ce.Undefined(t.rowCount,e),l=function(d){return nJ(t,n,d,s)},c=function(d){return Ia(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return gr.areEqualExact(l(d),l(f))},toArray:c}}var NN=function(){function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(i[d])return i[d];var f=r[d];if(f.valueType==="list")i[d]=sJ(f,t,d);else if(f.valueType==="tensor")i[d]=uJ(f,t,d);else{var p=oJ(f),v=t.getField(d);i[d]=v?p(v,t,d):ce.Undefined(t.rowCount,f)}return i[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=a;u<l.length;u++){var c=l[u];o(c)}}return e}();function lJ(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=fJ(o,e[o],t,r)}return A_.ofTables(t.header,e,n)}function cJ(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i],u=Lv.create(a,s,!0);t[u]=e.categories[a].getField(s)}return t}function dJ(e,t,r,n){var a=Lv.create(t,e),i=Lv.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var u=s[o],l=Lv.canonical(u);if(l in r)return r[l]}}function fJ(e,t,r,n){var a=r.categories[e];if(n){for(var i=cJ(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=dJ(d,e,i,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}a={rowCount:u,name:e,fieldNames:It([],s,!0),getField:function(p){return o[p]}}}return new NN(a||Ga.empty(e),t,!!a)}var He;(function(e){function t(f,p,v){return{kind:"element-location",structure:f,unit:p,element:v||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,p,v,m){return p&&(f.structure=p),v&&(f.unit=v),m!==void 0&&(f.element=m),f}e.set=n;function a(f,p){return f.unit=p.unit,f.element=p.element,f}e.copy=a;function i(f){return!!f&&f.kind==="element-location"}e.is=i;function o(f,p){return f.unit===p.unit&&f.element===p.element}e.areEqual=o;var s=w.zero(),u=w.zero();function l(f,p){return f.unit.conformation.position(f.element,s),p.unit.conformation.position(p.element,u),w.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(He||(He={}));var _e;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function a(s){return{kind:"union",types:s}}e.Union=a;function i(s,u,l,c){for(var d=Object.create(null),f=0,p=c;f<p.length;f++){var v=p[f];d[v]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(_e||(_e={}));var ia;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function a(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=a;function i(u){return!o(u)&&!s(u)}e.isLiteral=i;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(ia||(ia={}));function nt(e,t){var r=t||{},n=r.description,a=n===void 0?void 0:n,i=r.isOptional,o=i===void 0?!1:i,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:a}}var Pt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,a){var i=(a||{}).nonEmpty,o=i===void 0?!1:i;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Pt||(Pt={}));function Vh(e,t,r,n){var a=function(i){return ia.Apply(ia.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function QD(e,t,r,n){var a=function(i){return ia.Apply(ia.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id="".concat(e,".").concat(t),a.args=Pt.None,a.type=r,a}function Fb(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Bt(e,t,r){return Vh("",e,t,r)}function UN(e){VN("","",e)}function zN(e){var t=[];return HN(e,t),t}function ZD(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)}).replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)})}function VN(e,t,r){if(Fb(r)){r.info.namespace=e,r.info.name=r.info.name||ZD(t),r.id="".concat(r.info.namespace,".").concat(r.info.name);return}for(var n="".concat(r["@namespace"]||ZD(t)),a=e?"".concat(e,".").concat(n):n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];typeof r[s]!="object"&&!Fb(r[s])||VN(a,s,r[s])}}function HN(e,t){if(Fb(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];typeof e[a]!="object"&&!Fb(e[a])||HN(e[a],t)}}var pr;(function(e){e.AnyVar=_e.Variable("a",_e.Any),e.AnyValueVar=_e.Variable("a",_e.Any),e.ConstrainedVar=_e.Variable("a",_e.Any,!0),e.Regex=_e.Value("Core","Regex"),e.Set=function(t){return _e.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return _e.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return _e.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return _e.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(_e.Num,"BitFlags")})(pr||(pr={}));function ha(e,t){return Bt(Pt.Dictionary({0:nt(e)}),e,t)}function Lc(e,t){return Bt(Pt.List(e,{nonEmpty:!0}),e,t)}function pu(e,t,r){return Bt(Pt.Dictionary({0:nt(e),1:nt(e)}),t,r)}Pt.Dictionary({0:nt(_e.Num),1:nt(_e.Num)});nt(_e.Str);var pJ={"@header":"Types",bool:Bt(Pt.Dictionary({0:nt(_e.AnyValue)}),_e.Bool,"Convert a value to boolean."),num:Bt(Pt.Dictionary({0:nt(_e.AnyValue)}),_e.Num,"Convert a value to number."),str:Bt(Pt.Dictionary({0:nt(_e.AnyValue)}),_e.Str,"Convert a value to string."),regex:Bt(Pt.Dictionary({0:nt(_e.Str,{description:"Expression"}),1:nt(_e.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),pr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Bt(Pt.List(pr.AnyVar),pr.List()),set:Bt(Pt.List(pr.AnyValueVar),pr.Set()),bitflags:Bt(Pt.Dictionary({0:nt(_e.Num)}),pr.BitFlags,"Interpret a number as bitflags."),compositeKey:Bt(Pt.List(_e.AnyValue),_e.AnyValue)},vJ={"@header":"Logic",not:ha(_e.Bool),and:Lc(_e.Bool),or:Lc(_e.Bool)},mJ={"@header":"Control",eval:Bt(Pt.Dictionary({0:nt(pr.Fn(pr.AnyVar))}),pr.AnyVar,"Evaluate a function."),fn:Bt(Pt.Dictionary({0:nt(pr.AnyVar)}),pr.Fn(pr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Bt(Pt.Dictionary({0:nt(_e.Bool,{description:"Condition"}),1:nt(_e.Variable("a",_e.Any),{description:"If true"}),2:nt(_e.Variable("b",_e.Any),{description:"If false"})}),_e.Union([_e.Variable("a",_e.Any),_e.Variable("b",_e.Any)])),assoc:Bt(Pt.Dictionary({0:nt(_e.Str,{description:"Name"}),1:nt(_e.Variable("a",_e.Any),{description:"Value to assign"})}),_e.Variable("a",_e.Any))},hJ={"@header":"Relational",eq:pu(_e.Variable("a",_e.AnyValue,!0),_e.Bool),neq:pu(_e.Variable("a",_e.AnyValue,!0),_e.Bool),lt:pu(_e.Num,_e.Bool),lte:pu(_e.Num,_e.Bool),gr:pu(_e.Num,_e.Bool),gre:pu(_e.Num,_e.Bool),inRange:Bt(Pt.Dictionary({0:nt(_e.Num,{description:"Value to test"}),1:nt(_e.Num,{description:"Minimum value"}),2:nt(_e.Num,{description:"Maximum value"})}),_e.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},gJ={"@header":"Math",add:Lc(_e.Num),sub:Lc(_e.Num),mult:Lc(_e.Num),div:pu(_e.Num,_e.Num),pow:pu(_e.Num,_e.Num),mod:pu(_e.Num,_e.Num),min:Lc(_e.Num),max:Lc(_e.Num),floor:ha(_e.Num),ceil:ha(_e.Num),roundInt:ha(_e.Num),abs:ha(_e.Num),sqrt:ha(_e.Num),cbrt:ha(_e.Num),sin:ha(_e.Num),cos:ha(_e.Num),tan:ha(_e.Num),asin:ha(_e.Num),acos:ha(_e.Num),atan:ha(_e.Num),sinh:ha(_e.Num),cosh:ha(_e.Num),tanh:ha(_e.Num),exp:ha(_e.Num),log:ha(_e.Num),log10:ha(_e.Num),atan2:pu(_e.Num,_e.Num)},yJ={"@header":"Strings",concat:Lc(_e.Str),match:Bt(Pt.Dictionary({0:nt(pr.Regex),1:nt(_e.Str)}),_e.Bool)},bJ={"@header":"Lists",getAt:Bt(Pt.Dictionary({0:nt(pr.List()),1:nt(_e.Num)}),pr.AnyVar),equal:Bt(Pt.Dictionary({0:nt(pr.List()),1:nt(pr.List())}),_e.Bool)},SJ={"@header":"Sets",has:Bt(Pt.Dictionary({0:nt(pr.Set(pr.ConstrainedVar)),1:nt(pr.ConstrainedVar)}),_e.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Bt(Pt.Dictionary({0:nt(pr.Set(pr.ConstrainedVar)),1:nt(pr.Set(pr.ConstrainedVar))}),_e.Bool,"Check if the the 1st argument is a subset of the 2nd.")},xJ={"@header":"Flags",hasAny:Bt(Pt.Dictionary({0:nt(pr.Flags(pr.ConstrainedVar)),1:nt(pr.Flags(pr.ConstrainedVar))}),_e.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Bt(Pt.Dictionary({0:nt(pr.Flags(pr.ConstrainedVar)),1:nt(pr.Flags(pr.ConstrainedVar))}),_e.Bool,"Check if the the 1st argument has all 2nd one's flags.")},AP={"@header":"Language Primitives",type:pJ,logic:vJ,ctrl:mJ,rel:hJ,math:gJ,str:yJ,list:bJ,set:SJ,flags:xJ};UN(AP);var CJ=zN(AP);(function(){for(var e=Object.create(null),t=0,r=CJ;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var mt;(function(e){e.ElementSymbol=_e.Value("Structure","ElementSymbol"),e.AtomName=_e.Value("Structure","AtomName"),e.BondFlag=_e.OneOf("Structure","BondFlag",_e.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=pr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=_e.OneOf("Structure","SecondaryStructureFlag",_e.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=pr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=_e.Value("Structure","RingFingerprint"),e.EntityType=_e.OneOf("Structure","EntityType",_e.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=_e.OneOf("Structure","EntitySubtype",_e.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=_e.OneOf("Structure","ObjectPrimitive",_e.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=_e.Value("Structure","ResidueId"),e.ElementSet=_e.Value("Structure","ElementSet"),e.ElementSelection=_e.Value("Structure","ElementSelection"),e.ElementReference=_e.Value("Structure","ElementReference"),e.ElementSelectionQuery=pr.Fn(e.ElementSelection,"ElementSelectionQuery")})(mt||(mt={}));var wJ={"@header":"Types",elementSymbol:Bt(Pt.Dictionary({0:nt(_e.Str)}),mt.ElementSymbol,"Create element symbol representation from a string value."),atomName:Bt(Pt.Dictionary({0:nt(_e.AnyValue)}),mt.AtomName,"Convert a value to an atom name."),entityType:Bt(Pt.Dictionary({0:nt(mt.EntityType)}),mt.EntityType,"Create normalized representation of entity type: ".concat(_e.oneOfValues(mt.EntityType).join(", "),".")),bondFlags:Bt(Pt.List(mt.BondFlag),mt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: ".concat(_e.oneOfValues(mt.BondFlag).join(", "),".")),ringFingerprint:Bt(Pt.List(mt.ElementSymbol,{nonEmpty:!0}),mt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Bt(Pt.List(mt.SecondaryStructureFlag),mt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: ".concat(_e.oneOfValues(mt.SecondaryStructureFlag).join(", "),".")),authResidueId:Bt(Pt.Dictionary({0:nt(_e.Str,{description:"auth_asym_id"}),1:nt(_e.Num,{description:"auth_seq_id"}),2:nt(_e.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),mt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Bt(Pt.Dictionary({0:nt(_e.Str,{description:"label_entity_id"}),1:nt(_e.Str,{description:"label_asym_id"}),2:nt(_e.Num,{description:"label_seq_id"}),3:nt(_e.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),mt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},_J={"@header":"Iteration Slots",element:Bt(Pt.None,mt.ElementReference,"A reference to the current element."),elementSetReduce:Bt(Pt.None,_e.Variable("a",_e.AnyValue,!0),"Current value of the element set reducer.")},AJ={"@header":"Generators",all:Bt(Pt.None,mt.ElementSelectionQuery,"The entire structure."),atomGroups:Bt(Pt.Dictionary({"entity-test":nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":nt(_e.Bool,{isOptional:!0,defaultValue:!0}),"group-by":nt(_e.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),mt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Bt(Pt.Dictionary({0:nt(_e.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),mt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Bt(Pt.Dictionary({fingerprint:nt(mt.RingFingerprint,{isOptional:!0}),"only-aromatic":nt(_e.Bool,{isOptional:!0,defaultValue:!1})}),mt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),query:nt(mt.ElementSelectionQuery),"in-complement":nt(_e.Bool,{isOptional:!0,defaultValue:!1})}),mt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Bt(Pt.None,mt.ElementSelectionQuery,"Nada.")},TJ={"@header":"Selection Modifications",queryEach:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),query:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),by:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),by:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),by:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),"min-distance":nt(_e.Num,{isOptional:!0,defaultValue:0}),"max-distance":nt(_e.Num),"min-size":nt(_e.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":nt(_e.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),mt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),radius:nt(_e.Num),"atom-radius":nt(_e.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":nt(_e.Bool,{isOptional:!0})}),mt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),radius:nt(_e.Num),"include-water":nt(_e.Bool,{isOptional:!0,defaultValue:!0})}),mt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),"bond-test":nt(_e.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":nt(_e.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":nt(_e.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":nt(_e.Bool,{isOptional:!0})}),mt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),property:nt(_e.AnyValue)}),mt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},PJ={"@header":"Selection Filters",pick:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),test:nt(_e.Bool)}),mt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),source:nt(mt.ElementSelectionQuery),property:nt(_e.Any)}),mt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),by:nt(mt.ElementSelectionQuery)}),mt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),target:nt(mt.ElementSelectionQuery),"min-radius":nt(_e.Num,{isOptional:!0,defaultValue:0}),"max-radius":nt(_e.Num),"atom-radius":nt(_e.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:nt(_e.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),mt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery),target:nt(mt.ElementSelectionQuery),"bond-test":nt(_e.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:nt(_e.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),mt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},EJ={"@header":"Selection Combinators",intersect:Bt(Pt.List(mt.ElementSelectionQuery),mt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Bt(Pt.List(mt.ElementSelectionQuery),mt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Bt(Pt.Dictionary({matrix:nt(pr.List(pr.List(_e.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:nt(pr.List(mt.ElementSelectionQuery),{description:"A list of held selections."})}),mt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},IJ={"@header":"Atom Sets",atomCount:Bt(Pt.None,_e.Num),countQuery:Bt(Pt.Dictionary({0:nt(mt.ElementSelectionQuery)}),_e.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Bt(Pt.Dictionary({initial:nt(_e.Variable("a",_e.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:nt(_e.Variable("a",_e.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),_e.Variable("a",_e.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Bt(Pt.Dictionary({0:nt(pr.ConstrainedVar)}),pr.Set(pr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},DJ={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:dr(mt.ElementSymbol),vdw:dr(_e.Num,"Van der Waals radius"),mass:dr(_e.Num,"Atomic weight"),atomicNumber:dr(_e.Num,"Atomic number"),x:dr(_e.Num,"Cartesian X coordinate"),y:dr(_e.Num,"Cartesian Y coordinate"),z:dr(_e.Num,"Cartesian Z coordinate"),atomKey:dr(_e.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Bt(Pt.Dictionary({0:nt(mt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:nt(mt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),_e.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:dr(_e.Num,"Index of the atom/element in the input file."),operatorName:dr(_e.Str,"Name of the symmetry operator applied to this element."),modelIndex:dr(_e.Num,"Index of the model in the input file."),modelLabel:dr(_e.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:dr(_e.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:dr(mt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:dr(mt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:dr(_e.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:dr(_e.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:dr(_e.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:dr(_e.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:dr(_e.Num,"_atom_site.id"),label_atom_id:dr(mt.AtomName),label_alt_id:dr(_e.Str),label_comp_id:dr(_e.Str),label_asym_id:dr(_e.Str),label_entity_id:dr(_e.Str),label_seq_id:dr(_e.Num),auth_atom_id:dr(mt.AtomName),auth_comp_id:dr(_e.Str),auth_asym_id:dr(_e.Str),auth_seq_id:dr(_e.Num),pdbx_PDB_ins_code:dr(_e.Str),pdbx_formal_charge:dr(_e.Num),occupancy:dr(_e.Num),B_iso_or_equiv:dr(_e.Num),entityType:dr(mt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:dr(mt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:dr(_e.Str,"The PRD ID of the entity."),entityDescription:dr(pr.List(_e.Str)),objectPrimitive:dr(mt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:dr(_e.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:dr(mt.SecondaryStructureFlags),isModified:dr(_e.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:dr(_e.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:dr(_e.Bool,"True if this is a non-standard residue."),chemCompType:dr(_e.Str,"Type of the chemical component as defined in mmCIF.")}},MJ={"@header":"Bond Properties",flags:sh(mt.BondFlags),order:sh(_e.Num),length:sh(_e.Num),atomA:sh(mt.ElementReference),atomB:sh(mt.ElementReference)};function dr(e,t){return Bt(Pt.Dictionary({0:nt(mt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function sh(e,t){return Bt(Pt.None,e,t)}var RJ={"@header":"Structure Queries",type:wJ,slot:_J,generator:AJ,modifier:TJ,filter:PJ,combinator:EJ,atomSet:IJ,atomProperty:DJ,bondProperty:MJ},OJ={"@header":"Generators",bundleElement:Bt(Pt.Dictionary({groupedUnits:nt(_e.Any),set:nt(_e.Any),ranges:nt(_e.Any)}),_e.Any),bundle:Bt(Pt.Dictionary({elements:nt(_e.Any)}),mt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Bt(Pt.None,mt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},BJ={"@header":"Internal Queries",generator:OJ},he={core:AP,structureQuery:RJ,internal:BJ};UN(he);var kJ=zN(he);(function(){for(var e=Object.create(null),t=0,r=kJ;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var ne;(function(e){e.core=he.core,e.struct=he.structureQuery,e.internal=he.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=a;function i(y,b){return e.core.type.regex([y,b])}e.re=i;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function p(y){return l[y]()}e.ammp=p;var v=e.struct.atomSet.propertySet;function m(y){return v([d(y)])}e.acpSet=m;function h(y){return v([f(y)])}e.atpSet=h;function g(y){return v([p(y)])}e.ammpSet=g})(ne||(ne={}));function Fd(e){return{kind:"table-legend",table:e}}function LJ(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var FJ={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Ys;(function(e){function t(r){var n=_(_({},FJ),r),a=n.domain,i=n.reverse,o=n.listOrName,s=typeof o=="string"?as(o).list:o,u=i?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function p(x,A){d=x,f=A,c=f-d||1}p(a[0],a[1]);var v=oa(r.minLabel,d.toString()),m=oa(r.maxLabel,f.toString()),h,g=u.every(function(x){return Array.isArray(x)});if(g){var y=It([],u,!0);y.sort(function(x,A){return x[1]-A[1]});var b=y.map(function(x){return x[0]}),S=ze.ofSortedArray(y.map(function(x){return x[1]})),C=b.length-1;h=function(x){var A=Ha((x-d)/c,0,1),P=ze.findPredecessorIndex(S,A);if(P===0)return b[d];if(P>C)return b[C];var T=S[P-1],D=S[P],I=Ha((A-T)/(D-T),0,1);return $e.interpolate(b[P-1],b[P],I)}}else h=function(x){var A=Math.min(u.length-1,Math.max(0,(x-d)/c*l)),P=Math.floor(A),T=u[P],D=u[Math.ceil(A)];return $e.interpolate(T,D,A-P)};return{color:h,colorToArray:function(x,A,P){$e.toArray(h(x),A,P)},normalizedColorToArray:function(x,A,P){$e.toArrayNormalized(h(x),A,P)},setDomain:p,get legend(){return LJ(v,m,u)}}}e.create=t})(Ys||(Ys={}));var Li,Fi,xt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};Li={},Li[0]="Hexose",Li[1]="HexNAc",Li[2]="Hexosamine",Li[3]="Hexuronate",Li[4]="Deoxyhexose",Li[5]="DeoxyhexNAc",Li[6]="Di-deoxyhexose",Li[7]="Pentose",Li[8]="Deoxynonulosonate",Li[9]="Di-deoxynonulosonate",Li[10]="Unknown",Li[11]="Assigned";var NJ=(Fi={},Fi[0]=0,Fi[1]=1,Fi[2]=2,Fi[3]=3,Fi[4]=4,Fi[5]=5,Fi[6]=6,Fi[7]=7,Fi[8]=8,Fi[9]=9,Fi[10]=10,Fi[11]=11,Fi);function UJ(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:NJ[e]}var GN={abbr:"Unk",name:"Unknown",color:xt.Secondary,type:10},Nb=[{abbr:"Glc",name:"Glucose",color:xt.Blue,type:0},{abbr:"Man",name:"Mannose",color:xt.Green,type:0},{abbr:"Gal",name:"Galactose",color:xt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:xt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:xt.Pink,type:0},{abbr:"All",name:"Allose",color:xt.Purple,type:0},{abbr:"Tal",name:"Talose",color:xt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:xt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:xt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:xt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:xt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:xt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:xt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:xt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:xt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:xt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:xt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:xt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:xt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:xt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:xt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:xt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:xt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:xt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:xt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:xt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:xt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:xt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:xt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:xt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:xt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:xt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:xt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:xt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:xt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:xt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:xt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:xt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:xt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:xt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:xt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:xt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:xt.Red,type:5},{abbr:"Oli",name:"Olivose",color:xt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:xt.Green,type:6},{abbr:"Abe",name:"Abequose",color:xt.Orange,type:6},{abbr:"Par",name:"Paratose",color:xt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:xt.Purple,type:6},{abbr:"Col",name:"Colitose",color:xt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:xt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:xt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:xt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:xt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:xt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:xt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:xt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:xt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:xt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:xt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:xt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:xt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:xt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:xt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:xt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:xt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:xt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:xt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:xt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:xt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:xt.Brown,type:10},{abbr:"Api",name:"Apicose",color:xt.Green,type:11},{abbr:"Fru",name:"Fructose",color:xt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:xt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:xt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:xt.Pink,type:11}],zJ=function(){for(var e=new Map,t=0,r=Nb.length;t<r;++t){var n=Nb[t];e.set(n.abbr,n)}return e}(),VJ=[["Glc-family",xt.Blue],["Man-family",xt.Green],["Gal-family",xt.Yellow],["Gul-family",xt.Orange],["Alt-family",xt.Pink],["All-family",xt.Purple],["Tal-family",xt.LightBlue],["Ido-family",xt.Brown],["Fuc-family",xt.Red],["Generic/Unknown/Secondary",xt.Secondary]],HJ={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},$D=["NGZ","LAT","PUF","GDA","9WJ"],GJ={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},Rf=function(){for(var e=new Map,t=0,r=Nb.length;t<r;++t){var n=Nb[t],a=HJ[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=GJ[n.abbr];if(s)for(var i=0,o=s.length;i<o;++i)e.set(s[i],n)}for(var t=0,r=$D.length;t<r;++t)e.set($D[t],GN);return e}(),Pn;(function(e){function t(p){return cS(p.values())}e.toArray=t;function r(p,v){var m=!0;return v.forEach(function(h){p.has(h)||(m=!1)}),m}e.isSuperset=r;function n(p){for(var v=[],m=1;m<arguments.length;m++)v[m-1]=arguments[m];for(var h=0;h<v.length;h++)v[h].forEach(function(g){return p.add(g)});return p}e.add=n;function a(p,v){var m=new Set(p);return v.forEach(function(h){return m.add(h)}),m}e.union=a;function i(){for(var p=[],v=0;v<arguments.length;v++)p[v]=arguments[v];if(p.length===0)return new Set;p.length===1&&new Set(p[0]);for(var m=new Set(p[0]),h=1,g=p.length;h<g;h++)p[h].forEach(function(y){return m.add(y)});return m}e.unionMany=i;function o(p){if(p.length===0)return new Set;for(var v=new Set(p[0]),m=1;m<p.length;m++)for(var h=0,g=p[m];h<g.length;h++){var y=g[h];v.add(y)}return v}e.unionManyArrays=o;function s(p,v){var m=new Set;return v.forEach(function(h){p.has(h)&&m.add(h)}),m}e.intersection=s;function u(p,v){var m=!1;return v.forEach(function(h){p.has(h)&&(m=!0)}),m}e.areIntersecting=u;function l(p,v){var m=0;return v.forEach(function(h){p.has(h)&&(m+=1)}),m}e.intersectionSize=l;function c(p,v){var m=new Set(p);return v.forEach(function(h){return m.delete(h)}),m}e.difference=c;function d(p,v){var m=p.size;return p.forEach(function(h){v.has(h)&&(m-=1)}),m}e.differenceSize=d;function f(p,v){if(p.size!==v.size)return!1;var m=!0;return v.forEach(function(h){p.has(h)||(m=!1)}),m}e.areEqual=f})(Pn||(Pn={}));var qN=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),jN=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),Hu,qJ=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[i+u+d]=(i+u+d).toUpperCase()}}}return e}();function gp(e){return qJ[e]||e.toUpperCase()}var JD=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],gp(e[1])]}));function jJ(e){return JD.has(e)?JD.get(e):gp("H")}var WJ=(Hu={},Hu[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Hu[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Hu[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Hu[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Hu[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Hu[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Hu[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Hu),Rl=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),gS=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),WN=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),XN=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),XJ=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),YJ=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),KJ=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),YN=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),QJ=Pn.unionMany(WN,XN,YN),KN=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),QN=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),ZN=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),ZJ=new Set(["NON-POLYMER","OTHER"]),$J=new Set(["ION"]),JJ=new Set(["LIPID"]),yS=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),TP=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),$N=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),_g=Pn.unionMany(TP,$N),Ag=new Set(["A","C","T","G","I","U","N"]),Tg=new Set(["DA","DC","DT","DG","DI","DU","DN"]),PP=new Set(["APN","CPN","TPN","GPN"]),eee=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),tee=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),bS=Pn.unionMany(Ag,Tg,PP),JN=function(e){return eee.has(e.toUpperCase())},e7=function(e){return tee.has(e.toUpperCase())},Dm=Pn.unionMany(_g,bS);function Mm(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),PP.has(t)?8:QJ.has(e)?5:QN.has(e)?6:KN.has(e)?7:ZN.has(e)?9:yS.has(t)?2:jN.has(t)?3:qN.has(t)?4:ZJ.has(e)?Rf.has(t)?9:_g.has(t)?5:Ag.has(t)?6:Tg.has(t)?7:1:0}function ree(e,t){return e=e.toUpperCase(),t===5?XJ.has(e)?2:YJ.has(e)?3:KJ.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function t7(e){return e=e.toUpperCase(),_g.has(e)?"peptide linking":Ag.has(e)?"RNA linking":Tg.has(e)?"DNA linking":Rf.has(e)?"saccharide":"other"}function nee(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:Dm.has(e)?"y":"n",pdbx_synonyms:[],type:t7(e)}}function aee(e){return e=e.toUpperCase(),yS.has(e)?"water":Dm.has(e)?"polymer":Rf.has(e)?"branched":"non-polymer"}function iee(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),XN.has(t)?"polypeptide(L)":WN.has(t)?"polypeptide(D)":QN.has(t)?"polyribonucleotide":KN.has(t)?"polydeoxyribonucleotide":ZN.has(t)||Rf.has(e)?"oligosaccharide":PP.has(e)?"peptide nucleic acid":TP.has(e)?"polypeptide(L)":$N.has(e)?"polypeptide(D)":Ag.has(e)?"polyribonucleotide":Tg.has(e)?"polydeoxyribonucleotide":$J.has(t)||jN.has(e)?"ion":JJ.has(t)||qN.has(e)?"lipid":YN.has(t)?"peptide-like":"other"}function SS(e){return Uu(e)||r7(e)}function Uu(e){return e===7||e===6||e===8}function r7(e){return e===5}var Tr;(function(e){e.is=Xa.has,e.create=Xa.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Tr||(Tr={}));var vr;(function(e){e.is=Xa.has;function t(s){return Xa.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(s){return s in e.Names}e.isName=a;function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=i(s[l]);return u}e.fromNames=o})(vr||(vr={}));var Y_={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]},Wf=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);a.set(f,n.length);var p=e.getVertexKey(u,c),v=i.get(p);v===void 0?i.set(p,[n.length]):v.push(n.length),n.push(_(_({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):n7},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,a){return this.getEdgeIndex(t,r,n,a)!==-1},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return i!==-1?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):n7},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return"".concat(o,"|").concat(s,"|").concat(u,"|").concat(l)}e.getEdgeKey=r;function n(o,s){return"".concat(o,"|").concat(s)}e.getVertexKey=n;function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Vr.create(),this.linkedB=Vr.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){a(this.mapAB,s,{indexB:u,props:l}),a(this.mapBA,u,{indexB:s,props:l}),Vr.add(this.linkedA,s,s),Vr.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i})(Wf||(Wf={}));var n7=[],K_;(function(e){e.Empty=eo.create([],[],[],0,{flags:[],order:[]})})(K_||(K_={}));var Ub=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return Be.isAtomic(r.aUnit)&&Be.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return Be.isAtomic(r.aUnit)&&Be.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Wf);(function(e){var t=function(r){Pe(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Wf.UnitPairEdges);e.UnitPairBonds=t})(Ub||(Ub={}));var oee=4,a7={forceCompute:!1,noCompute:!1,maxRadius:oee},EP={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},see={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},uee={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},eM=2.001,J0=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];t.add(EP[a])}return t}();function lee(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function Cu(e){var t=EP[e];return t===void 0?-1:t}function cee(e,t){if(e<0||t<0)return-1;var r=uee[lee(e,t)];return r===void 0?-1:r}function Yc(e){if(e<0)return eM;var t=see[e];return t===void 0?eM:t}function zb(e,t,r,n){var a=cee(e,t);return a>0?a:t<0?r:(r+n)/1.95}var dee=EP.H;function pl(e){return e===dee}var fee=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function pee(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],_g.has(e)&&t==="C"&&r==="O"||bS.has(e)&&t==="OP1"&&r==="P"?2:fee.get("".concat(e,"|").concat(t,"|").concat(r))||1}var vee=new Map([["LYS|NZ|RET|C15",2]]);function i7(e,t,r,n){var a,i;return e>r&&(a=[r,e],e=a[0],r=a[1],i=[n,t],t=i[0],n=i[1]),vee.get("".concat(e,"|").concat(t,"|").concat(r,"|").concat(n))||1}var Nd=ce.Schema,te=Nd.str,Ae=Nd.int,$t=Nd.float,EC=Nd.coord,gt=Nd.Aliased,dc=Nd.Matrix,vy=Nd.Vector,Vd=Nd.List,or={atom_site:{auth_asym_id:te,auth_atom_id:te,auth_comp_id:te,auth_seq_id:Ae,B_iso_or_equiv:$t,Cartn_x:EC,Cartn_y:EC,Cartn_z:EC,group_PDB:gt(te),id:Ae,label_alt_id:te,label_asym_id:te,label_atom_id:te,label_comp_id:te,label_entity_id:te,label_seq_id:Ae,occupancy:$t,type_symbol:te,pdbx_PDB_ins_code:te,pdbx_PDB_model_num:Ae,pdbx_formal_charge:Ae,ihm_model_id:Ae},atom_site_anisotrop:{id:Ae,type_symbol:te,U:dc(3,3),U_esd:dc(3,3),pdbx_auth_seq_id:te,pdbx_auth_asym_id:te,pdbx_auth_atom_id:te,pdbx_auth_comp_id:te,pdbx_label_seq_id:Ae,pdbx_label_alt_id:te,pdbx_label_asym_id:te,pdbx_label_atom_id:te,pdbx_label_comp_id:te,pdbx_PDB_ins_code:te},atom_sites:{entry_id:te,fract_transf_matrix:dc(3,3),fract_transf_vector:vy(3)},audit_author:{name:te,pdbx_ordinal:Ae,identifier_ORCID:te},audit_conform:{dict_location:te,dict_name:te,dict_version:te},cell:{angle_alpha:$t,angle_beta:$t,angle_gamma:$t,entry_id:te,length_a:$t,length_b:$t,length_c:$t,Z_PDB:Ae,pdbx_unique_axis:te},chem_comp:{formula:te,formula_weight:$t,id:te,mon_nstd_flag:gt(te),name:te,type:gt(te),pdbx_synonyms:Vd(";",function(e){return e})},chem_comp_bond:{atom_id_1:te,atom_id_2:te,comp_id:te,value_order:gt(te),pdbx_ordinal:Ae,pdbx_stereo_config:gt(te),pdbx_aromatic_flag:gt(te)},citation:{book_publisher:te,country:te,id:te,journal_abbrev:te,journal_id_ASTM:te,journal_id_CSD:te,journal_id_ISSN:te,journal_volume:te,page_first:te,page_last:te,title:te,year:Ae,pdbx_database_id_DOI:te,pdbx_database_id_PubMed:Ae},citation_author:{citation_id:te,name:te,ordinal:Ae},database_2:{database_id:gt(te),database_code:te},entity:{details:te,formula_weight:$t,id:te,src_method:gt(te),type:gt(te),pdbx_description:Vd(",",function(e){return e}),pdbx_number_of_molecules:Ae,pdbx_mutation:te,pdbx_fragment:te,pdbx_ec:Vd(",",function(e){return e})},entity_poly:{entity_id:te,nstd_linkage:gt(te),nstd_monomer:gt(te),type:gt(te),pdbx_strand_id:Vd(",",function(e){return e}),pdbx_seq_one_letter_code:te,pdbx_seq_one_letter_code_can:te,pdbx_target_identifier:te},entity_poly_seq:{entity_id:te,hetero:gt(te),mon_id:te,num:Ae},entry:{id:te},exptl:{entry_id:te,method:gt(te)},software:{classification:te,date:te,description:te,name:te,type:gt(te),version:te,pdbx_ordinal:Ae},struct:{entry_id:te,title:te,pdbx_descriptor:te},struct_asym:{details:te,entity_id:te,id:te,pdbx_modified:te,pdbx_blank_PDB_chainid_flag:gt(te)},struct_conf:{beg_label_asym_id:te,beg_label_comp_id:te,beg_label_seq_id:Ae,beg_auth_asym_id:te,beg_auth_comp_id:te,beg_auth_seq_id:Ae,conf_type_id:gt(te),details:te,end_label_asym_id:te,end_label_comp_id:te,end_label_seq_id:Ae,end_auth_asym_id:te,end_auth_comp_id:te,end_auth_seq_id:Ae,id:te,pdbx_beg_PDB_ins_code:te,pdbx_end_PDB_ins_code:te,pdbx_PDB_helix_class:te,pdbx_PDB_helix_length:Ae,pdbx_PDB_helix_id:te},struct_conn:{conn_type_id:gt(te),details:te,id:te,ptnr1_label_asym_id:te,ptnr1_label_atom_id:te,ptnr1_label_comp_id:te,ptnr1_label_seq_id:Ae,ptnr1_auth_asym_id:te,ptnr1_auth_comp_id:te,ptnr1_auth_seq_id:Ae,ptnr1_symmetry:te,ptnr2_label_asym_id:te,ptnr2_label_atom_id:te,ptnr2_label_comp_id:te,ptnr2_label_seq_id:Ae,ptnr2_auth_asym_id:te,ptnr2_auth_comp_id:te,ptnr2_auth_seq_id:Ae,ptnr2_symmetry:te,pdbx_ptnr1_PDB_ins_code:te,pdbx_ptnr1_label_alt_id:te,pdbx_ptnr1_standard_comp_id:te,pdbx_ptnr2_PDB_ins_code:te,pdbx_ptnr2_label_alt_id:te,pdbx_ptnr3_PDB_ins_code:te,pdbx_ptnr3_label_alt_id:te,pdbx_ptnr3_label_asym_id:te,pdbx_ptnr3_label_atom_id:te,pdbx_ptnr3_label_comp_id:te,pdbx_ptnr3_label_seq_id:Ae,pdbx_PDB_id:te,pdbx_dist_value:$t,pdbx_value_order:gt(te)},struct_conn_type:{criteria:te,id:gt(te),reference:te},struct_keywords:{entry_id:te,text:Vd(",",function(e){return e}),pdbx_keywords:te},struct_ncs_oper:{code:gt(te),details:te,id:Ae,matrix:dc(3,3),vector:vy(3)},struct_sheet_range:{beg_label_asym_id:te,beg_label_comp_id:te,beg_label_seq_id:Ae,end_label_asym_id:te,end_label_comp_id:te,end_label_seq_id:Ae,beg_auth_asym_id:te,beg_auth_comp_id:te,beg_auth_seq_id:Ae,end_auth_asym_id:te,end_auth_comp_id:te,end_auth_seq_id:Ae,id:te,sheet_id:te,pdbx_beg_PDB_ins_code:te,pdbx_end_PDB_ins_code:te},struct_site:{details:te,id:te,pdbx_num_residues:Ae,pdbx_evidence_code:te,pdbx_auth_asym_id:te,pdbx_auth_comp_id:te,pdbx_auth_seq_id:te,pdbx_auth_ins_code:te},struct_site_gen:{details:te,id:te,label_alt_id:te,label_asym_id:te,label_atom_id:te,label_comp_id:te,label_seq_id:Ae,auth_asym_id:te,auth_comp_id:te,auth_seq_id:te,site_id:te,symmetry:te,pdbx_auth_ins_code:te,pdbx_num_res:Ae},symmetry:{entry_id:te,cell_setting:gt(te),Int_Tables_number:Ae,space_group_name_Hall:te,"space_group_name_H-M":te},pdbx_database_status:{status_code:gt(te),status_code_sf:gt(te),status_code_mr:gt(te),entry_id:te,recvd_initial_deposition_date:te,SG_entry:gt(te),deposit_site:gt(te),process_site:gt(te),status_code_cs:gt(te),methods_development_category:gt(te),pdb_format_compatible:gt(te)},pdbx_nonpoly_scheme:{asym_id:te,entity_id:te,mon_id:te,pdb_strand_id:te,ndb_seq_num:te,pdb_seq_num:te,auth_seq_num:te,pdb_mon_id:te,auth_mon_id:te,pdb_ins_code:te},pdbx_database_related:{db_name:te,details:te,db_id:te,content_type:gt(te)},pdbx_entity_nonpoly:{entity_id:te,comp_id:te,name:te},pdbx_chem_comp_synonyms:{name:te,comp_id:te,provenance:gt(te)},pdbx_chem_comp_identifier:{comp_id:te,identifier:te,type:gt(te),program:te,program_version:te},pdbx_unobs_or_zero_occ_residues:{id:Ae,polymer_flag:gt(te),occupancy_flag:gt(Ae),PDB_model_num:Ae,auth_asym_id:te,auth_comp_id:te,auth_seq_id:te,PDB_ins_code:te,label_asym_id:te,label_comp_id:te,label_seq_id:Ae},pdbx_struct_mod_residue:{id:Ae,auth_asym_id:te,auth_comp_id:te,auth_seq_id:Ae,PDB_ins_code:te,label_asym_id:te,label_comp_id:te,label_seq_id:Ae,parent_comp_id:te,details:te},pdbx_struct_oper_list:{id:te,type:gt(te),name:te,symmetry_operation:te,matrix:dc(3,3),vector:vy(3)},pdbx_struct_assembly:{method_details:te,oligomeric_details:te,oligomeric_count:Ae,details:te,id:te},pdbx_struct_assembly_gen:{asym_id_list:Vd(",",function(e){return e}),assembly_id:te,oper_expression:te},pdbx_reference_entity_list:{prd_id:te,ref_entity_id:te,type:gt(te),details:te,component_id:Ae},pdbx_reference_entity_link:{link_id:Ae,prd_id:te,details:te,ref_entity_id_1:te,ref_entity_id_2:te,entity_seq_num_1:Ae,entity_seq_num_2:Ae,comp_id_1:te,comp_id_2:te,atom_id_1:te,atom_id_2:te,value_order:gt(te),component_1:Ae,component_2:Ae,link_class:gt(te)},pdbx_reference_entity_poly_link:{link_id:Ae,prd_id:te,ref_entity_id:te,component_id:Ae,entity_seq_num_1:Ae,entity_seq_num_2:Ae,comp_id_1:te,comp_id_2:te,atom_id_1:te,atom_id_2:te,value_order:gt(te)},pdbx_molecule:{prd_id:te,instance_id:Ae,asym_id:te},pdbx_molecule_features:{prd_id:te,class:gt(te),type:gt(te),name:te,details:te},entity_src_nat:{entity_id:te,pdbx_organism_scientific:te,pdbx_plasmid_name:te,pdbx_src_id:Ae,pdbx_beg_seq_num:Ae,pdbx_end_seq_num:Ae},entity_src_gen:{entity_id:te,pdbx_gene_src_gene:Vd(",",function(e){return e}),pdbx_gene_src_scientific_name:te,plasmid_name:te,pdbx_src_id:Ae,pdbx_beg_seq_num:Ae,pdbx_end_seq_num:Ae},pdbx_entity_src_syn:{organism_scientific:te,entity_id:te,pdbx_src_id:Ae,pdbx_beg_seq_num:Ae,pdbx_end_seq_num:Ae},pdbx_entity_branch_descriptor:{entity_id:te,descriptor:te,type:gt(te),program:te,program_version:te,ordinal:Ae},pdbx_entity_instance_feature:{details:te,feature_type:gt(te),auth_asym_id:te,asym_id:te,auth_seq_num:te,seq_num:Ae,comp_id:te,auth_comp_id:te,ordinal:Ae},pdbx_entity_branch_list:{entity_id:te,hetero:gt(te),comp_id:te,num:Ae},pdbx_entity_branch_link:{link_id:Ae,details:te,entity_id:te,entity_branch_list_num_1:Ae,entity_branch_list_num_2:Ae,comp_id_1:te,comp_id_2:te,atom_id_1:te,leaving_atom_id_1:te,atom_stereo_config_1:gt(te),atom_id_2:te,leaving_atom_id_2:te,atom_stereo_config_2:gt(te),value_order:gt(te)},pdbx_entity_branch:{entity_id:te,type:gt(te)},pdbx_branch_scheme:{entity_id:te,hetero:gt(te),asym_id:te,mon_id:te,num:Ae,pdb_asym_id:te,pdb_seq_num:te,pdb_mon_id:te,auth_asym_id:te,auth_seq_num:te,auth_mon_id:te},pdbx_chem_comp_related:{comp_id:te,related_comp_id:te,relationship_type:gt(te),details:te},ihm_starting_model_details:{starting_model_id:te,entity_id:te,entity_description:te,asym_id:te,entity_poly_segment_id:Ae,starting_model_source:gt(te),starting_model_auth_asym_id:te,starting_model_sequence_offset:Ae,dataset_list_id:Ae},ihm_starting_comparative_models:{id:Ae,starting_model_id:te,starting_model_auth_asym_id:te,starting_model_seq_id_begin:Ae,starting_model_seq_id_end:Ae,template_auth_asym_id:te,template_seq_id_begin:Ae,template_seq_id_end:Ae,template_sequence_identity:$t,template_sequence_identity_denominator:gt(Ae),template_dataset_list_id:Ae,alignment_file_id:Ae},ihm_starting_model_seq_dif:{id:Ae,entity_id:te,asym_id:te,seq_id:Ae,comp_id:te,starting_model_id:te,db_asym_id:te,db_seq_id:Ae,db_comp_id:te,details:te},ihm_model_representation:{id:Ae,name:te,details:te},ihm_model_representation_details:{id:Ae,representation_id:Ae,entity_poly_segment_id:Ae,entity_id:te,entity_description:te,entity_asym_id:te,model_object_primitive:gt(te),starting_model_id:te,model_mode:gt(te),model_granularity:gt(te),model_object_count:Ae},ihm_struct_assembly_details:{id:Ae,assembly_id:Ae,parent_assembly_id:Ae,entity_description:te,entity_id:te,asym_id:te,entity_poly_segment_id:Ae},ihm_struct_assembly:{id:Ae,name:te,description:te},ihm_modeling_protocol:{id:Ae,num_steps:Ae,protocol_name:te},ihm_modeling_protocol_details:{id:Ae,protocol_id:Ae,step_id:Ae,struct_assembly_id:Ae,dataset_group_id:Ae,struct_assembly_description:te,step_name:te,step_method:te,num_models_begin:Ae,num_models_end:Ae,multi_scale_flag:gt(te),multi_state_flag:gt(te),ordered_flag:gt(te),script_file_id:Ae,software_id:Ae},ihm_multi_state_modeling:{state_id:Ae,state_group_id:Ae,population_fraction:$t,population_fraction_sd:$t,state_type:te,state_name:te,experiment_type:gt(te),details:te},ihm_modeling_post_process:{id:Ae,protocol_id:Ae,analysis_id:Ae,step_id:Ae,type:gt(te),feature:gt(te),num_models_begin:Ae,num_models_end:Ae},ihm_ensemble_info:{ensemble_id:Ae,ensemble_name:te,post_process_id:Ae,model_group_id:Ae,ensemble_clustering_method:gt(te),ensemble_clustering_feature:gt(te),num_ensemble_models:Ae,num_ensemble_models_deposited:Ae,ensemble_precision_value:$t,ensemble_file_id:Ae},ihm_model_list:{model_id:Ae,model_name:te,assembly_id:Ae,protocol_id:Ae,representation_id:Ae},ihm_model_group:{id:Ae,name:te,details:te},ihm_model_group_link:{model_id:Ae,group_id:Ae},ihm_model_representative:{id:Ae,model_group_id:Ae,model_id:Ae,selection_criteria:gt(te)},ihm_dataset_list:{id:Ae,data_type:gt(te),database_hosted:gt(te)},ihm_dataset_group:{id:Ae,name:te,application:gt(te),details:te},ihm_dataset_group_link:{dataset_list_id:Ae,group_id:Ae},ihm_related_datasets:{dataset_list_id_derived:Ae,dataset_list_id_primary:Ae},ihm_dataset_related_db_reference:{id:Ae,dataset_list_id:Ae,db_name:gt(te),accession_code:te,version:te,details:te},ihm_external_reference_info:{reference_id:Ae,reference_provider:te,reference_type:gt(te),reference:te,refers_to:gt(te),associated_url:te},ihm_external_files:{id:Ae,reference_id:Ae,file_path:te,content_type:gt(te),file_size_bytes:$t,details:te},ihm_dataset_external_reference:{id:Ae,dataset_list_id:Ae,file_id:Ae},ihm_localization_density_files:{id:Ae,file_id:Ae,ensemble_id:Ae,entity_id:te,entity_poly_segment_id:Ae,asym_id:te},ihm_predicted_contact_restraint:{id:Ae,group_id:Ae,entity_id_1:te,entity_id_2:te,asym_id_1:te,asym_id_2:te,comp_id_1:te,comp_id_2:te,seq_id_1:Ae,seq_id_2:Ae,rep_atom_1:gt(te),rep_atom_2:gt(te),distance_lower_limit:$t,distance_upper_limit:$t,probability:$t,restraint_type:gt(te),model_granularity:gt(te),dataset_list_id:Ae,software_id:Ae},ihm_cross_link_list:{id:Ae,group_id:Ae,entity_description_1:te,entity_description_2:te,entity_id_1:te,entity_id_2:te,comp_id_1:te,comp_id_2:te,seq_id_1:Ae,seq_id_2:Ae,linker_type:gt(te),dataset_list_id:Ae},ihm_cross_link_restraint:{id:Ae,group_id:Ae,entity_id_1:te,entity_id_2:te,asym_id_1:te,asym_id_2:te,comp_id_1:te,comp_id_2:te,seq_id_1:Ae,seq_id_2:Ae,atom_id_1:te,atom_id_2:te,restraint_type:gt(te),conditional_crosslink_flag:gt(te),model_granularity:gt(te),distance_threshold:$t,psi:$t,sigma_1:$t,sigma_2:$t},ihm_cross_link_result_parameters:{id:Ae,restraint_id:Ae,model_id:Ae,psi:$t,sigma_1:$t,sigma_2:$t},ihm_2dem_class_average_restraint:{id:Ae,dataset_list_id:Ae,number_raw_micrographs:Ae,pixel_size_width:$t,pixel_size_height:$t,image_resolution:$t,image_segment_flag:gt(te),number_of_projections:Ae,struct_assembly_id:Ae,details:te},ihm_2dem_class_average_fitting:{id:Ae,restraint_id:Ae,model_id:Ae,cross_correlation_coefficient:$t,rot_matrix:dc(3,3),tr_vector:vy(3)},ihm_3dem_restraint:{id:Ae,dataset_list_id:Ae,model_id:Ae,struct_assembly_id:Ae,fitting_method:te,number_of_gaussians:Ae,cross_correlation_coefficient:$t},ihm_sas_restraint:{id:Ae,dataset_list_id:Ae,model_id:Ae,struct_assembly_id:Ae,profile_segment_flag:gt(te),fitting_atom_type:te,fitting_method:te,fitting_state:gt(te),radius_of_gyration:$t,chi_value:$t,details:te},ihm_starting_model_coord:{ordinal_id:Ae,starting_model_id:te,group_PDB:gt(te),id:Ae,type_symbol:te,entity_id:te,atom_id:te,comp_id:te,seq_id:Ae,asym_id:te,Cartn_x:$t,Cartn_y:$t,Cartn_z:$t,B_iso_or_equiv:$t},ihm_sphere_obj_site:{id:Ae,entity_id:te,seq_id_begin:Ae,seq_id_end:Ae,asym_id:te,Cartn_x:$t,Cartn_y:$t,Cartn_z:$t,object_radius:$t,rmsf:$t,model_id:Ae},ihm_gaussian_obj_site:{id:Ae,entity_id:te,seq_id_begin:Ae,seq_id_end:Ae,asym_id:te,mean_Cartn_x:$t,mean_Cartn_y:$t,mean_Cartn_z:$t,weight:$t,covariance_matrix:dc(3,3),model_id:Ae},ihm_gaussian_obj_ensemble:{id:Ae,entity_id:te,seq_id_begin:Ae,seq_id_end:Ae,asym_id:te,mean_Cartn_x:$t,mean_Cartn_y:$t,mean_Cartn_z:$t,weight:$t,covariance_matrix:dc(3,3),ensemble_id:Ae},ihm_feature_list:{feature_id:Ae,feature_type:gt(te),entity_type:gt(te)},ihm_poly_residue_feature:{ordinal_id:Ae,feature_id:Ae,entity_id:te,asym_id:te,comp_id_begin:te,comp_id_end:te,seq_id_begin:Ae,seq_id_end:Ae},ihm_derived_distance_restraint:{id:Ae,group_id:Ae,feature_id_1:Ae,feature_id_2:Ae,group_conditionality:gt(te),random_exclusion_fraction:$t,distance_upper_limit:$t,restraint_type:gt(te),dataset_list_id:Ae},ma_model_list:{ordinal_id:Ae,model_id:Ae,model_group_id:Ae,model_name:te,model_group_name:te,model_type:gt(te),data_id:Ae},ma_target_entity:{entity_id:te,data_id:Ae,origin:gt(te)},ma_target_entity_instance:{asym_id:te,entity_id:te,details:te},ma_target_ref_db_details:{target_entity_id:te,db_name:gt(te),db_code:te,db_accession:te,seq_db_isoform:te,seq_db_align_begin:te,seq_db_align_end:te,ncbi_taxonomy_id:te,organism_scientific:te},ma_data:{id:Ae,content_type:gt(te),content_type_other_details:te,name:te},ma_software_group:{ordinal_id:Ae,group_id:Ae,software_id:Ae},ma_qa_metric:{id:Ae,name:te,type:gt(te),mode:gt(te),software_group_id:Ae},ma_qa_metric_global:{ordinal_id:Ae,model_id:Ae,metric_id:Ae,metric_value:$t},ma_qa_metric_local:{ordinal_id:Ae,model_id:Ae,label_asym_id:te,label_seq_id:Ae,label_comp_id:te,metric_id:Ae,metric_value:$t}},mee=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function hee(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}var IC=28672;function gee(e){if(e.length>IC){for(var t=[],r=0;r<e.length;r+=IC)t.push(String.fromCharCode.apply(null,e.subarray(r,r+IC)));return t.join("")}else return String.fromCharCode.apply(null,e)}function Vb(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=yee(t,e.encoding[r]);return t}function yee(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return bee(e);case 2:return See(e);case 5:return xee(e);case 3:return Cee(e);case 6:return wee(e);case 32:return _ee(e);case 33:return Aee(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return Tee(e,t);case"IntervalQuantization":return Pee(e,t);case"RunLength":return Eee(e,t);case"Delta":return Iee(e,t);case"IntegerPacking":return Ree(e,t);case"StringArray":return Oee(e,t)}}function o7(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function s7(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function bee(e){return new Int8Array(e.buffer,e.byteOffset)}function Rm(e,t,r){return mee?new r(e.buffer):new r(hee(e,t))}function See(e){return Rm(e,2,Int16Array)}function xee(e){return Rm(e,2,Uint16Array)}function Cee(e){return Rm(e,4,Int32Array)}function wee(e){return Rm(e,4,Uint32Array)}function _ee(e){return Rm(e,4,Float32Array)}function Aee(e){return Rm(e,8,Float64Array)}function Tee(e,t){for(var r=e.length,n=s7(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}function Pee(e,t){for(var r=e.length,n=s7(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}function Eee(e,t){for(var r=o7(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}function Iee(e,t){var r=e.length,n=o7(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}function Dee(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,i[s]=u,o++,s++}return i}function Mee(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,i++,u=e[i];s+=u,a[o]=s,i++,o++}return a}function Ree(e,t){return e.length===t.srcSize?e:t.isUnsigned?Mee(e,t):Dee(e,t)}function Oee(e,t){var r=Vb({encoding:t.offsetEncoding,data:t.offsets}),n=Vb({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=i[n[o]+1];return l}var Bee="0.3.0",Dc;(function(e){function t(n){var a;return n instanceof Int8Array?a=1:n instanceof Int16Array?a=2:n instanceof Int32Array?a=3:n instanceof Uint8Array?a=4:n instanceof Uint16Array?a=5:n instanceof Uint32Array?a=6:n instanceof Float32Array?a=32:n instanceof Float64Array?a=33:a=3,a}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var a=0,i=n.length;a<i;a++)if(a<0)return!1;return!0}e.isSignedIntegerDataType=r})(Dc||(Dc={}));function Q_(e){return eg.classify(e)}function kee(e){return Z_.classify(e)}var eg;(function(e){function t(p,v){return p>=0?Math.ceil((p+1)/v):Math.ceil((p+1)/(-v-1))}function r(p){for(var v=!1,m=0,h=p.length;m<h;m++)if(p[m]<0){v=!0;break}return v?{signed:v,limit8:127,limit16:32767}:{signed:v,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function a(p,v,m){var h=p.limit8,g=p.limit16;v.pack8+=t(m,h),v.pack16+=t(m,g),v.count+=1}function i(p,v){p.pack8+=t(v,127),p.pack16+=t(v,32767),p.count+=1}function o(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function s(p,v){for(var m=n(),h=0,g=p.length;h<g;h++)a(v,m,p[h]);return _(_({},o(m)),{kind:"pack"})}function u(p,v){for(var m=n(),h=p[0],g=1,y=p.length;g<y;g++)i(m,p[g]-h),h=p[g];return _(_({},o(m)),{kind:"delta"})}function l(p,v){for(var m=n(),h=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(a(v,m,p[g-1]),a(v,m,h),h=1):h++;return a(v,m,p[p.length-1]),a(v,m,h),_(_({},o(m)),{kind:"rle"})}function c(p,v){for(var m=n(),h=1,g=0,y=0,b=1,S=p.length;b<S;b++){var C=p[b]-g;y!==C?(i(m,y),i(m,h),h=1):h++,y=C,g=p[b]}return i(m,y),i(m,h),_(_({},o(m)),{kind:"delta-rle"})}function d(p){var v=r(p),m=[s(p,v),l(p,v),u(p),c(p)];return m.sort(function(h,g){return h.length-g.length}),m}e.getSize=d;function f(p){if(p.length<2)return sr.by(sr.byteArray);var v=d(p),m=v[0];switch(m.kind){case"pack":return sr.by(sr.integerPacking);case"rle":return sr.by(sr.runLength).and(sr.integerPacking);case"delta":return sr.by(sr.delta).and(sr.integerPacking);case"delta-rle":return sr.by(sr.delta).and(sr.runLength).and(sr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})(eg||(eg={}));var Z_;(function(e){var t=1e-6;function r(a){var i=4,o=Y$(a,i,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return sr.by(sr.byteArray);if(s===0)return eg.classify(a);for(var l=n(s),c=new Int32Array(a.length),d=0,f=a.length;d<f;d++)c[d]=Math.round(l*a[d]);var p=eg.getSize(c),v=p[0],m=sr.by(sr.fixedPoint(l));switch(v.kind){case"pack":return m.and(sr.integerPacking);case"rle":return m.and(sr.runLength).and(sr.integerPacking);case"delta":return m.and(sr.delta).and(sr.integerPacking);case"delta-rle":return m.and(sr.delta).and(sr.runLength).and(sr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}})(Z_||(Z_={}));var u7=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var i=a[n],o=i(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),Pd;(function(e){function t(a){return new u7([a])}e.by=t;function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}e.fromEncoding=r;function n(a){switch(a.kind){case"ByteArray":return sr.byteArray;case"FixedPoint":return sr.fixedPoint(a.factor);case"IntervalQuantization":return sr.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return sr.runLength;case"Delta":return sr.delta;case"IntegerPacking":return sr.integerPacking;case"StringArray":return sr.stringArray}}})(Pd||(Pd={}));var sr;(function(e){var t,r;function n(C){return new u7([C])}e.by=n;function a(C){return{encodings:[{kind:"ByteArray",type:4}],data:C}}function i(C){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(C.buffer,C.byteOffset)}}var o=(t={},t[2]=function(C,x,A){C.setInt16(2*x,A,!0)},t[5]=function(C,x,A){C.setUint16(2*x,A,!0)},t[3]=function(C,x,A){C.setInt32(4*x,A,!0)},t[6]=function(C,x,A){C.setUint32(4*x,A,!0)},t[32]=function(C,x,A){C.setFloat32(4*x,A,!0)},t[33]=function(C,x,A){C.setFloat64(8*x,A,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(C){var x=Dc.getDataType(C);if(x===1)return i(C);if(x===4)return a(C);for(var A=new Uint8Array(C.length*s[x]),P=o[x],T=new DataView(A.buffer),D=0,I=C.length;D<I;D++)P(T,D,C[D]);return{encodings:[{kind:"ByteArray",type:x}],data:A}}e.byteArray=u;function l(C,x){for(var A=Dc.getDataType(C),P=new Int32Array(C.length),T=0,D=C.length;T<D;T++)P[T]=Math.round(C[T]*x);return{encodings:[{kind:"FixedPoint",factor:x,srcType:A}],data:P}}function c(C){return function(x){return l(x,C)}}e.fixedPoint=c;function d(C,x,A,P,T){var D=Dc.getDataType(C);if(!C.length)return{encodings:[{kind:"IntervalQuantization",min:x,max:A,numSteps:P,srcType:D}],data:new Int32Array(0)};if(A<x){var I=x;x=A,A=I}for(var M=(A-x)/(P-1),B=new T(C.length),U=0,V=C.length;U<V;U++){var F=C[U];F<=x?B[U]=0:F>=A?B[U]=P-1:B[U]=Math.round((F-x)/M)|0}return{encodings:[{kind:"IntervalQuantization",min:x,max:A,numSteps:P,srcType:D}],data:B}}function f(C,x,A,P){return P===void 0&&(P=Int32Array),function(T){return d(T,C,x,A,P)}}e.intervalQuantizaiton=f;function p(C){var x=Dc.getDataType(C);if(x===void 0&&(C=new Int32Array(C),x=3),!C.length)return{encodings:[{kind:"RunLength",srcType:x,srcSize:0}],data:new Int32Array(0)};for(var A=2,P=1,T=C.length;P<T;P++)C[P-1]!==C[P]&&(A+=2);for(var D=new Int32Array(A),I=0,M=1,P=1,T=C.length;P<T;P++)C[P-1]!==C[P]?(D[I]=C[P-1],D[I+1]=M,M=1,I+=2):++M;return D[I]=C[C.length-1],D[I+1]=M,{encodings:[{kind:"RunLength",srcType:x,srcSize:C.length}],data:D}}e.runLength=p;function v(C){if(!Dc.isSignedIntegerDataType(C))throw new Error("Only signed integer types can be encoded using delta encoding.");var x=Dc.getDataType(C);if(x===void 0&&(C=new Int32Array(C),x=3),!C.length)return{encodings:[{kind:"Delta",origin:0,srcType:x}],data:new C.constructor(0)};var A=new C.constructor(C.length),P=C[0];A[0]=C[0];for(var T=1,D=C.length;T<D;T++)A[T]=C[T]-C[T-1];return A[0]=0,{encodings:[{kind:"Delta",origin:P,srcType:x}],data:A}}e.delta=v;function m(C){for(var x=0,A=C.length;x<A;x++)if(C[x]<0)return!0;return!1}function h(C,x){for(var A=-x-1,P=0,T=0,D=C.length;T<D;T++){var I=C[T];I===0?P+=1:I>0?(P+=Math.ceil(I/x),I%x===0&&(P+=1)):(P+=Math.ceil(I/A),I%A===0&&(P+=1))}return P}function g(C){var x=m(C),A=x?h(C,127):h(C,255),P=x?h(C,32767):h(C,65535);return C.length*4<P*2?{isSigned:x,size:C.length,bytesPerElement:4}:P*2<A?{isSigned:x,size:P,bytesPerElement:2}:{isSigned:x,size:A,bytesPerElement:1}}function y(C,x){for(var A=x.isSigned?x.bytesPerElement===1?127:32767:x.bytesPerElement===1?255:65535,P=-A-1,T=C.length,D=x.isSigned?x.bytesPerElement===1?new Int8Array(x.size):new Int16Array(x.size):x.bytesPerElement===1?new Uint8Array(x.size):new Uint16Array(x.size),I=0,M=0;M<T;M++){var B=C[M];if(B>=0)for(;B>=A;)D[I]=A,++I,B-=A;else for(;B<=P;)D[I]=P,++I,B-=P;D[I]=B,++I}var U=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:x.bytesPerElement,isUnsigned:!x.isSigned,srcSize:T},U.encodings[0]],data:U.data}}function b(C){var x=g(C);return x.bytesPerElement===4?u(C):y(C,x)}e.integerPacking=b;function S(C){var x=Object.create(null),A=[],P=new Int32Array(C.length),T=Le.create(Int32Array,1,Math.min(1024,C.length<32?C.length+1:Math.round(C.length/8)+1));Le.add(T,0);for(var D=0,I=0,M=0,B=C;M<B.length;M++){var U=B[M];if(U==null){P[I++]=-1;continue}var V=x[U];V===void 0&&(D+=U.length,V=A.length,A[V]=U,x[U]=V,Le.add(T,D)),P[I++]=V}var F=Le.compact(T),Y=Q_(F),W=Y.encode(F),K=Q_(P),$=K.encode(P);return{encodings:[{kind:"StringArray",dataEncoding:$.encoding,stringData:A.join(""),offsetEncoding:W.encoding,offsets:W.data}],data:$.data}}e.stringArray=S})(sr||(sr={}));var $_;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount!="undefined"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function a(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:sr.by(sr.delta).and(sr.runLength).and(sr.integerPacking)})}e.index=a;var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int("".concat(u,"[").concat(d+1,"]"),l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i;function o(){return new i}e.build=o})($_||($_={}));var po;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var a=[],i=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),p=f[1],v=d?p?s:i:p?o:a;v[v.length]=c,p&&!a.includes(f[0])&&(a[a.length]=f[0])}}var m=o.map(function(h){return h.split(".")[0]});return{includeCategory:function(h){return i.includes(h)?!1:a.length<=0||a.indexOf(h)!==-1},includeField:function(h,g){var y=h+"."+g;return s.includes(y)?!1:!m.includes(h)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}};function r(n,a){return a?{fields:tM(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return Ob.Array(a)}}]}:{fields:tM(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(po||(po={}));var J_;(function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(c){n.writeCategory({name:c,instance:function(){return po.ofTable(i[c])}})},s=0,u=i._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}e.writeDatabaseCollection=r})(J_||(J_={}));function DC(e){return function(t,r){return r[e].value(t)}}function Lee(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function MC(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,It([a[e].value(n)],t,!1))}}function Hh(e){return function(t,r){return r[e].valueKind(t)}}function Fee(e,t){var r=[],n=2,a=Hh(e);if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s="".concat(e,"[").concat(o+1,"]");r.push({name:s,type:n,value:MC(e,o),valueKind:a})}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var l=0;l<u;l++){var c="".concat(e,"[").concat(o+1,"][").concat(l+1,"]");r.push({name:c,type:n,value:MC(e,o,l),valueKind:a})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var v=0;v<p;v++){var m="".concat(e,"[").concat(o+1,"][").concat(l+1,"][").concat(v+1,"]");r.push({name:m,type:n,value:MC(e,o,l,v),valueKind:a})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function tM(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];if(i.valueType==="int")t.push({name:a,type:1,value:DC(a),valueKind:Hh(a)});else if(i.valueType==="float")t.push({name:a,type:2,value:DC(a),valueKind:Hh(a)});else if(i.valueType==="str")t.push({name:a,type:0,value:DC(a),valueKind:Hh(a)});else if(i.valueType==="list")t.push({name:a,type:0,value:Lee(a),valueKind:Hh(a)});else if(i.valueType==="tensor")t.push.apply(t,Fee(a,i.space));else throw new Error("Unknown valueType ".concat(i.valueType))}return t}function Nee(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount!="undefined"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function IP(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function l7(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var a=n.reduce(function(o,s){return o+s.rowCount},0),i=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():Ob.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:a,source:i}}var Uee=function(){function e(){this.builder=Cr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=po.DefaultFilter,this.formatter=po.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||po.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||po.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Cr.write(this.builder,"data_".concat((t||"").replace(/[ \n\t]/g,"").toUpperCase(),`
#
`))},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n==null?void 0:n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=l7(t,r),i=a.instance,o=a.rowCount,s=a.source;!o||(o===1?zee(t,i,s,this.builder,this.filter,this.formatter):Vee(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Cr.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Cr.getSize(this.builder)},e.prototype.getData=function(){return Cr.getString(this.builder)},e}();function c7(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?jee(e):Wee(e);else{var u=n.value(r,t,i),l=n.type;if(l===0)return Hee(u)?(k1(e,u),!0):Xee(e,u);l===1?Gee(e,u):qee(e,u,a)}return!1}function d7(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);s&&typeof s.digitCount!="undefined"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,Nee(o)):0}return n}function zee(e,t,r,n,a,i){var o=IP(t),s=r[0],u=s.data,l=o.reduce(function(h,g){return a.includeField(e.name,g.name)?Math.max(h,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=d7(e.name,t.fields,i),p=0;p<o.length;p++){var v=o[p];if(!!a.includeField(e.name,v.name)){Cr.writePadRight(n,"_".concat(e.name,".").concat(v.name),l);var m=c7(n,u,d,v,f[p],0);m||Cr.newline(n)}}Cr.write(n,`#
`)}}function Vee(e,t,r,n,a,i){var o=IP(t),s=a===po.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=d7(e.name,s,i);rM(n,"loop_");for(var c=0;c<u;c++)rM(n,"_".concat(e.name,".").concat(s[c].name));for(var d=0,f=0;f<r.length;f++){var p=r[f],v=p.data;if(p.rowCount!==0)for(var m=p.keys();m.hasNext;){for(var h=m.move(),g=!1,y=0;y<u;y++)g=c7(n,v,h,s[y],l[y],d);g||Cr.newline(n),d++}}Cr.write(n,`#
`)}}function Hee(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function rM(e,t){Cr.write(e,t),Cr.newline(e)}function Gee(e,t){Cr.writeInteger(e,t),Cr.whitespace1(e)}function qee(e,t,r){Cr.writeFloat(e,t,r),Cr.whitespace1(e)}function jee(e){Cr.writeSafe(e,". ")}function Wee(e){Cr.writeSafe(e,"? ")}function Xee(e,t){if(!t)return Cr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return k1(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(i)return k1(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return k1(e,t),!0;i=!0,n=!0,a=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Cr.writeSafe(e,a?'"':"'"),Cr.writeSafe(e,t),Cr.writeSafe(e,a?'" ':"' ")):(Cr.writeSafe(e,t),Cr.writeSafe(e," ")),!1}function k1(e,t){Cr.writeSafe(e,`
;`+t),Cr.writeSafe(e,`
;
`)}function Yee(e){var t=new ArrayBuffer(L1(e)),r=new DataView(t),n=new Uint8Array(t);return F1(e,r,n,0),n}function L1(e){var t=typeof e;if(t==="string"){var r=xb(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=L1(e[o])}else{var s=Object.keys(e);a=s.length;for(var o=0;o<a;o++){var u=s[o];i+=L1(u)+L1(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function F1(e,t,r,n){var a=typeof e;if(a==="string"){var i=xb(e);if(i<32)return t.setUint8(n,i|160),gv(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),gv(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),gv(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),gv(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(a==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(a==="boolean")return t.setUint8(n,e?195:194),1;if(a==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=F1(e[f],t,r,n+l);else for(var f=0,p=d.length;f<p;f++){var v=d[f];l+=F1(v,t,r,n+l),l+=F1(e[v],t,r,n+l)}return l}throw new Error("Unknown type "+a)}var Kee=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=po.DefaultFilter,this.formatter=po.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:Bee,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||po.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||po.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n==null?void 0:n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=l7(t,r),i=a.instance,o=a.rowCount,s=a.source;if(!!o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=IP(i),c=0,d=l;c<d.length;c++){var f=d[c];if(!!this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(ete(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}!u.columns.length||this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=Yee(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function Qee(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function Zee(e){return e===0?Pd.by(sr.stringArray):Pd.by(sr.byteArray)}function $ee(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function Jee(e,t){return e===0?Pd.by(sr.stringArray):e===1?Q_(t):kee(t)}function ete(e,t,r,n,a,i,o){var s=tte(t,Qee(t,a),n,r),u=s.array,l=s.allPresent,c=s.mask,d=$ee(e,t,a,i);d||(o?d=Jee(t.type,u):d=Zee(t.type));var f=d.encode(u),p=void 0;if(!l){var v=Pd.by(sr.runLength).and(sr.byteArray).encode(c);v.data.length<c.length?p=v:p=Pd.by(sr.byteArray).encode(c)}return{name:t.name,data:f,mask:p}}function tte(e,t,r,n){for(var a=e.type===0,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var v=p.move(),m=s?s(v,f):0;if(m!==0)o[c]=m,a&&(i[c]=""),l=!1;else{var h=u(v,f,c);typeof h=="string"&&!h?(o[c]=1,l=!1):o[c]=0,i[c]=h}c++}return{array:i,allPresent:l,mask:o}}var ca;(function(e){e.Encoder=J_,e.Category=po,e.Field=$_,e.Encoding=sr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,p=f===void 0?"mol*":f;return d?new Kee(p,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new Uee}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function a(u,l){return{fields:u,source:[l]}}e.categoryInstance=a;function i(u){return{get:function(l,c){var d=u.categories[l];if(!!d){var f=d.getField(c);return f&&f.binaryEncoding?Pd.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=i;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(ca||(ca={}));var tg;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return ca.Category.Empty;var o=i.data;if(!o)return ca.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return ca.Category.ofTable(o,c)}}]}},e.Provider=Xs.create(e.Descriptor);function t(a,i){return kr.pick(i,or.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(a){var i=new Map;function o(x){if(i.has(x))return i.get(x);var A=new n(x);return i.set(x,A),A}for(var s=a.comp_id,u=a.atom_id_1,l=a.atom_id_2,c=a.value_order,d=a.pdbx_aromatic_flag,f=a._rowCount,p=o(s.value(0)),v=0;v<f;v++){var m=s.value(v),h=u.value(v),g=l.value(v),y=c.value(v),b=d.value(v)==="Y";p.id!==m&&(p=o(m));var S=1,C=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":C=2;break;case"trip":C=3;break;case"quad":C=4;break}p.add(h,g,C,S)}return i}e.getEntriesFromChemCompBond=r;var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(i);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(i,f)}l&&this.add(o,i,s,u,!1)},a}();e.Entry=n})(tg||(tg={}));var Du;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||o.entries.length===0)return ca.Category.Empty;for(var s=i.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return ca.Category.ofTable(o.data,u)}}]}},e.Provider=Xs.create(e.Descriptor);function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(i,o){for(var s=i.units,u=0,l=s.length;u<l;u++)if(ze.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,l=i.pdbx_value_order,c={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},f=function(C,x){if(x.label_asym_id.valueKind(C)===0){var A=x.label_asym_id.value(C),P=o.atomicHierarchy.index.findEntity(A);if(!(P<0)){var T=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(P),A,x.auth_seq_id.value(C),x.ins_code.value(C));if(!(T<0)){var D=x.label_atom_id.value(C);if(!!D){var I=o.atomicHierarchy.index.findAtomOnResidue(T,D,x.label_alt_id.value(C));if(!(I<0))return{residueIndex:T,atomIndex:I,symmetry:x.symmetry.value(C)}}}}}},p=[],v=0;v<i._rowCount;v++){var m=f(v,c),h=f(v,d);if(!(m===void 0||h===void 0)){var g=s.value(v),y=(l.value(v)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=i7(i.ptnr1_label_comp_id.value(v),i.ptnr1_label_atom_id.value(v),i.ptnr2_label_comp_id.value(v),i.ptnr2_label_atom_id.value(v))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}p.push({rowIndex:v,flags:b,order:S,distance:u.value(v),partnerA:m,partnerB:h})}}return p}e.getEntriesFromStructConn=a})(Du||(Du={}));function f7(e,t,r,n,a,i){for(var o=new eo.EdgeBuilder(a,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:i})}var nM=w(),aM=w();function rte(e,t,r){return e.conformation.position(t,nM),e.conformation.position(r,aM),w.distance(nM,aM)}var nte=new Set;function ate(e){for(var t=Ka.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.maxDistance,o=t.bonds,s=o.offset,u=o.b,l=o.edgeProps,c=l.order,d=l.distance,f=l.flag,p=e.model.atomicHierarchy.atomSourceIndex,v=zt.getInvertedAtomSourceIndex(e.model).invertedIndex,m=[],h=[],g=[],y=[],b=0;b<a;b++)for(var S=r[b],C=Cu(n.value(S)),x=pl(C),A=p.value(S),P=s[A],T=s[A+1];P<T;++P){var D=v[u[P]];if(!(S>=D)){var I=ze.indexOf(e.elements,D);if(!(I<0)){var M=Cu(n.value(D)),B=d[P],U=rte(e,S,D),V=!1;if(B>=0)V=tn(U,B,.3);else if(i>=0)V=U<i;else{var F=zb(C,M,Yc(C),Yc(M));V=U<F,x&&pl(M)&&(V=!1)}V&&(m[m.length]=b,h[h.length]=I,y[y.length]=c[P],g[g.length]=f[P])}}}return f7(m,h,y,g,a,!1)}function ite(e,t){for(var r=t.maxRadius,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,v=d.label_alt_id,m=d.label_comp_id,h=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=Du.Provider.get(e.model),C=tg.Provider.get(e.model),x=Du.isExhaustive(e.model),A=[],P=[],T=[],D=[],I=-1,M=void 0,B=!0,U=!0,V=!0,F=nte,Y=0;Y<s;Y++){var W=u[Y],K=f.value(W);B&&(K!=="H"||K!=="O")&&(B=!1);var $=t.forceCompute?void 0:S&&S.byAtomIndex.get(W),J=!1;if($)for(var Z=0,N=$;Z<N.length;Z++){var j=N[Z],L=j.partnerA,H=j.partnerB;if(L.symmetry===H.symmetry){var G=L.atomIndex===W?H:L,q=ze.indexOf(e.elements,G.atomIndex);q<0||u[q]<W||(A[A.length]=Y,P[P.length]=q,T[T.length]=j.flags,D[D.length]=j.order,J||F.clear(),J=!0,F.add(q))}}if(!x){var X=l[W],Q=h.value(X),ue=m.value(W);if(!t.forceCompute&&X!==I)if(!!C&&C.entries.has(ue)){var le=y[g.getEntityFromChain(c[W])];le&&le.sequence.microHet.has(Q)?M=void 0:M=C.entries.get(ue).map}else M=void 0;I=X;for(var ve=Cu(K),ge=p.value(W),Se=M?M.get(ge):void 0,ae=b.find(a[W],i[W],o[W],r),re=ae.indices,O=ae.count,z=ae.squaredDistances,de=pl(ve),me=Yc(ve),ye=v.value(W),Te=J0.has(ve),Oe=0;Oe<O;Oe++){var q=re[Oe];if(!(J&&F.has(q))){var Ue=u[q];if(!(Ue<=W)){var Qe=v.value(Ue);if(!(ye&&Qe&&ye!==Qe)){var Ge=Cu(f.value(Ue)),Je=pl(Ge);if(!(de&&Je)){var Ze=(Te||J0.has(Ge))&&!(de||Je),rt=l[Ue];if(X===rt&&Se){var et=Se.get(p.value(Ue));if(et){A[A.length]=Y,P[P.length]=q,D[D.length]=et.order;var St=et.flags;Ze&&(St|1&&(St^=1),St|=2),T[T.length]=St}continue}var De=Math.sqrt(z[Oe]);if(De!==0){var Ie=zb(ve,Ge,me,Yc(Ge));if(De<=Ie){A[A.length]=Y,P[P.length]=q,D[D.length]=pee(ue,ge,p.value(Ue)),T[T.length]=(Ze?2:1)|32;var je=h.value(rt);Q===je&&(U=!1),Math.abs(Q-je)>1&&(V=!1)}}}}}}}}}var st=B||U&&V;return f7(A,P,D,T,s,st)}function ote(e,t){var r=_(_({},a7),t);return r.noCompute||zt.isCoarseGrained(e.model)?K_.Empty:!r.forceCompute&&Ka.Provider.get(e.model)?ate(e):ite(e,r)}var iM=w(),oM=w();function sM(e,t,r,n){return e.conformation.position(t,iM),r.conformation.position(n,oM),w.distance(iM,oM)}var ste=oe(),Hd=w();function ute(e,t,r,n){var a=r.maxRadius,i=e.elements,o=e.residueIndex,s=e.model.atomicConformation,u=s.x,l=s.y,c=s.z,d=t.elements,f=t.residueIndex,p=e.elements.length,v=e.model.atomicHierarchy.atoms,m=v.type_symbol,h=v.label_alt_id,g=v.label_atom_id,y=v.label_comp_id,b=t.model.atomicHierarchy.atoms,S=b.type_symbol,C=b.label_alt_id,x=b.label_atom_id,A=b.label_comp_id,P=e.model.atomicHierarchy.residues.auth_seq_id,T=t.model.atomicHierarchy.residues.auth_seq_id,D=e.model.atomicConformation.occupancy,I=t.model.atomicConformation.occupancy,M=D.isDefined&&I.isDefined,B=e.model===t.model&&Du.Provider.get(e.model),U=!r.forceCompute&&e.model===t.model&&Ka.Provider.get(e.model),V=e.model.atomicHierarchy.atomSourceIndex,F=(U?zt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,Y=e.model===t.model&&Du.isExhaustive(e.model),W=oe.mul(ste,t.conformation.operator.inverse,e.conformation.operator.matrix),K=!oe.isIdentity(W),$=t.boundary.sphere,J=$.center,Z=$.radius,N=(Z+a)*(Z+a);n.startUnitPair(e.id,t.id);for(var j=0;j<p;j++){var L=i[j];if(w.set(Hd,u[L],l[L],c[L]),K&&w.transformMat4(Hd,Hd,W),!(w.squaredDistance(Hd,J)>N)){if(!r.forceCompute&&U){for(var H=U.maxDistance,G=U.bonds,q=G.offset,X=G.b,Q=G.edgeProps,ue=Q.order,le=Q.distance,ve=Q.flag,ge=V.value(L),Se=q[ge],ae=q[ge+1];Se<ae;++Se){var re=F[X[Se]],O=ze.indexOf(t.elements,re);if(!(O<0)){var z=Cu(m.value(L)),de=Cu(m.value(re)),me=le[Se],ye=sM(e,L,t,re),Te=!1;if(me>=0)Te=tn(ye,me,.3);else if(H>=0)Te=ye<H;else{var Oe=zb(z,de,Yc(z),Yc(de));Te=ye<Oe,pl(z)&&pl(de)&&(Te=!1)}Te&&n.add(j,O,{order:ue[Se],flag:ve[Se]})}}continue}var Ue=r.forceCompute?void 0:B&&B.byAtomIndex.get(L);if(Ue&&Ue.length){for(var Qe=!1,Ge=0,Je=Ue;Ge<Je.length;Ge++){var Ze=Je[Ge],rt=Ze.partnerA,et=Ze.partnerB,St=rt.atomIndex===L?et:rt,O=ze.indexOf(t.elements,St.atomIndex);O<0||sM(e,L,t,St.atomIndex)>a||(n.add(j,O,{order:Ze.order,flag:Ze.flags}),Qe=!0)}if(Qe)continue}if(!Y){var De=D.value(L),Ie=t.lookup3d,je=Ie.find(Hd[0],Hd[1],Hd[2],a),st=je.indices,pt=je.count,qe=je.squaredDistances;if(pt!==0)for(var bt=Cu(m.value(L)),yt=pl(bt),Dt=Yc(bt),ee=h.value(L),pe=J0.has(bt),we=g.value(L),Xe=y.value(o[L]),dt=0;dt<pt;dt++){var O=st[dt],re=d[O],vt=C.value(re);if(!(ee&&vt&&ee!==vt)&&!(M&&I.value(re)<1&&De<1&&P.value(L)===T.value(re))){var de=Cu(S.value(re)),Et=pl(de);if(!(yt&&Et)){var _r=(pe||J0.has(de))&&!(yt||Et),ye=Math.sqrt(qe[dt]);if(ye!==0){var Oe=zb(bt,de,Dt,Yc(de));if(ye<=Oe){var qr=x.value(re),Qr=A.value(f[re]);n.add(j,O,{order:i7(Xe,Qr,we,qr),flag:(_r?2:1)|32})}}}}}}}}n.finishUnitPair()}var lte=_(_({},a7),{ignoreWater:!0});function cte(e,t){var r=new Wf.Builder,n=e.models.some(function(a){return Ka.Provider.get(a)});return t.noCompute||e.isCoarseGrained&&!n?new Ub(r.getMap()):(Ne.eachUnitPair(e,function(a,i){ute(a,i,t,r)},{maxRadius:t.maxRadius,validUnit:function(a){return Be.isAtomic(a)},validUnitPair:function(a,i){return t.validUnitPair(e,a,i)}}),new Ub(r.getMap()))}function dte(e,t){var r=_(_({},lte),t);return cte(e,_(_({},r),{validUnitPair:t&&t.validUnitPair||function(n,a,i){var o=a.model.atomicHierarchy.derived.residue.moleculeType,s=i.model.atomicHierarchy.derived.residue.moleculeType,u=(!Be.isAtomic(a)||o[a.residueIndex[a.elements[0]]]!==2)&&(!Be.isAtomic(i)||s[i.residueIndex[i.elements[0]]]!==2);return Ne.validUnitPair(n,a,i)&&(u||!r.ignoreWater)}}))}var Ot;(function(e){function t(h,g,y,b,S,C){return{kind:"bond-location",aStructure:h,aUnit:g,aIndex:y,bStructure:b,bUnit:S,bIndex:C}}e.Location=t;function r(h){return!!h&&h.kind==="bond-location"}e.isLocation=r;function n(h,g){return h.aStructure.label===g.aStructure.label&&h.bStructure.label===g.bStructure.label&&h.aIndex===g.aIndex&&h.bIndex===g.bIndex&&h.aUnit.id===g.aUnit.id&&h.bUnit.id===g.bUnit.id}e.areLocationsEqual=n;function a(h,g){return{kind:"bond-loci",structure:h,bonds:g}}e.Loci=a;function i(h){return!!h&&h.kind==="bond-loci"}e.isLoci=i;function o(h,g){if(h.structure!==g.structure||h.bonds.length!==g.bonds.length)return!1;for(var y=0,b=h.bonds.length;y<b;++y)if(!n(h.bonds[y],g.bonds[y]))return!1;return!0}e.areLociEqual=o;function s(h){return h.bonds.length===0}e.isLociEmpty=s;function u(h,g){if(g===h.structure)return h;var y=[];return h.bonds.forEach(function(b){var S=g.unitMap.get(b.aUnit.id);if(!!S){var C=g.unitMap.get(b.bUnit.id);if(!!C){var x=b.aUnit.elements[b.aIndex],A=ze.indexOf(S.elements,x);if(A!==-1){var P=b.bUnit.elements[b.bIndex],T=ze.indexOf(C.elements,P);T!==-1&&y.push(t(h.structure,S,A,h.structure,C,T))}}}}),a(g,y)}e.remapLoci=u;function l(h){for(var g=[],y=new Map,b=0,S=h.bonds;b<S.length;b++){var C=S[b],x=C.aIndex,A=C.aUnit,P=C.bIndex,T=C.bUnit;A===T?y.has(A.id)?y.get(A.id).push(x,P):y.set(A.id,[x,P]):(y.has(A.id)?y.get(A.id).push(x):y.set(A.id,[x]),y.has(T.id)?y.get(T.id).push(P):y.set(T.id,[P]))}return y.forEach(function(D,I){g.push({unit:h.structure.unitMap.get(I),indices:ze.deduplicate(ze.ofUnsortedArray(D))})}),xe(h.structure,g)}e.toStructureElementLoci=l;function c(h){var g=h.bonds[0],y=g.aUnit,b=g.aIndex;return xe(h.structure,[{unit:y,indices:Ee.ofSingleton(b)}])}e.toFirstStructureElementLoci=c;function d(h,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return b<0?vr.create(0):vr.create(y.edgeProps.flags[b])}else{var S=h.interUnitBonds.getBondFromLocation(g);return S?vr.create(S.props.flag):vr.create(0)}}e.getType=d;function f(h,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return b<0?0:y.edgeProps.order[b]}else{var S=h.interUnitBonds.getBondFromLocation(g);return S?S.props.order:0}}e.getOrder=f;function p(h){for(var g=0,y=0,b=h.units.length;y<b;++y){var S=h.units[y];Be.isAtomic(S)&&(g+=S.bonds.edgeCount)}return g}e.getIntraUnitBondCount=p;var v=function(){function h(){this.current={},this.hasNext=!1}return h.prototype.move=function(){return this.advance(),this.current},h.prototype.setElement=function(g,y,b){this.structure=g,this.unit=y,this.index=b,this.interBondIndices=g.interUnitBonds.getEdgeIndices(b,y.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=y.bonds.offset[b+1],this.intraBondIndex=y.bonds.offset[b],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h}();e.ElementBondIterator=v;function m(h,g){return Ml.fromPairProvider(h.bonds.length,function(y,b,S){var C=h.bonds[y],x=C.aUnit,A=C.aIndex,P=C.bUnit,T=C.bIndex;x.conformation.position(x.elements[A],b),P.conformation.position(P.elements[T],S)},g)}e.getBoundingSphere=m})(Ot||(Ot={}));function fte(e){for(var t=vte(e),r=pte(e,t),n=Qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();mte(r,a.start,a.end)}return r.rings}function pte(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function uM(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,a=0;a<e.count;a++)t[a]=-1,r[a]=-1,n[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function vte(e){for(var t=Qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function mte(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var a=e.unit.elements,i=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(a[o]);On(i,s)}if(If(i,""),i.length===0){uM(e);for(var o=0;o<e.count;o++)n[o]>=0||lM(e,o)}else for(var u=0;u<i.length;u++){uM(e),e.hasAltLoc=!0,e.currentAltLoc=i[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(a[e.startVertex+o]);s&&s!==e.currentAltLoc||lM(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function hte(e,t,r){if(!(r<t)){for(var n=e.pred,a=e.color,i=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(a[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,p=0;u=r;for(var l=0;l<4;l++){if(a[u]===s){p=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(!!f){u=t;for(var l=0;l<4&&(i[c++]=u,!(p===u||(u=n[u],u<0)));l++);var v=c+d;if(!(v<3)){for(var m=new Int32Array(v),h=0,l=0;l<c;l++)m[h++]=e.startVertex+i[l];for(var l=d-1;l>=0;l--)m[h++]=e.startVertex+o[l];if(Ns(m),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(m[0]===b[0]&&m.length===b.length){for(var S=!0,C=0,x=m.length;C<x;C++)if(m[C]!==b[C]){S=!1;break}if(S)return}}e.currentRings.push(ze.ofSortedArray(m))}}}}function lM(e,t){var r=e.bonds,n=e.startVertex,a=e.endVertex,i=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;i[t]=1,o[0]=t;for(var f=0,p=1;f<p;)for(var v=o[f++],m=n+v,h=d[m],g=d[m+1],y=h;y<g;y++){var b=l[y];if(!(b<n||b>=a||!vr.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var C=b-n;if(i[C]>0){s[C]!==v&&s[v]!==C&&hte(e,v,C);continue}i[C]=1,o[p++]=C,s[C]=v}}}function gte(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var a=cM(e),i=cM(r),o=!1,n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?dM(e,a):dM(r,i)}function cM(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(a=e[s%t],i=e[(o+n+1)%t],a!==i);)a<i&&(o=s-n-1),n=r[n];n===-1?(a=e[s%t],i=e[(o+n+1)%t],a!==i?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function dM(e,t){var r=e.length,n=[],a;for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function yte(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(a):r.set(l,[a])}for(var c=0,d=t.length;c<d;c++)for(var a=t[c],o=e[a],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(a):n.set(l,[a])}for(var f=new eo.UniqueEdgeBuilder(e.length),a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var l=o[s],p=r.get(l);if(p.length!==1)for(var v=0,m=p.length;v<m;v++){var h=p[v];a>=h||f.addEdge(a,h)}}for(var g=eo.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}function bte(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}function DP(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=bte(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Mm(n.type,r)}return 0}var Ste=new Set;function Kc(e,t){var r=WJ[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return Ste}var fM=w.zero();function p7(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],fM),w.toArray(fM,n,i*3);return n}var Hb=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=yte(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=xte(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=_te(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),Ko;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return gte(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),a=.05;function i(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,p=c.edgeProps.flags,v=s.model.atomicHierarchy.atoms,m=v.type_symbol,h=v.label_comp_id;if(h.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,S=u.length;b<S;++b){var C=u[b];!y&&n.has(m.value(l[C]))&&(y=!0);for(var x=f[C],A=f[C+1];x<A;++x)vr.is(16,p[x])&&ze.has(u,d[x])&&(g+=1)}if(g===2*u.length)return!0;if(!y||u.length<5)return!1;var P=Td.calculateMomentsAxes(p7(s,u));return w.magnitude(P.dirC)<a}e.isAromatic=i;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var p=c[u[d]],v=l.value(p);if(v)return v}return""}e.getAltId=o})(Ko||(Ko={}));(function(e){function t(n){var a=fte(n);return new e(a,n)}e.create=t;function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++){var u=a[o];wte(n,u,i)}return i}e.byFingerprintAndResidue=r})(Hb||(Hb={}));function xte(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var o=t[a],s=Ko.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function Cte(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function wte(e,t,r){var n=e.byFingerprint.get(t);if(!!n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=Cte(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function _te(e,t){for(var r=[],n=0,a=t.length;n<a;++n)Ko.isAromatic(e,t[n])&&r.push(n);return r}var Br;(function(e){function t(S){return ze.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function a(S){return S[0]}e.min=a;function i(S){return S[S.length-1]}e.max=i;function o(S){for(var C=0,x=0,A=S.length;x<A;x+=2)C+=S[x+1]-S[x]+1;return C}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,C){return S[C*2]}e.startAt=u;function l(S,C){return S[C*2+1]+1}e.endAt=l;function c(S,C){return S[C*2]}e.minAt=c;function d(S,C){return S[C*2+1]}e.maxAt=d;function f(S,C){if(S.length!==C.length)return!1;for(var x=0,A=S.length;x<A;++x)if(S[x]!==C[x])return!1;return!0}e.areEqual=f;function p(S,C){for(var x=0,A=0,P=S.length;A<P;A+=2)for(var T=S[A],D=S[A+1];T<=D;++T)C(T,x),++x}e.forEach=p;function v(S,C){return h(S,C)!==-1}e.has=v;function m(S,C,x){return g(S,C,x)!==-1}e.hasFrom=m;function h(S,C){return g(S,C,0)}e.firstIntersectionIndex=h;function g(S,C,x){if(c(S,x)>Ee.max(C)||i(S)<Ee.min(C))return-1;for(var A=x,P=s(S);A<P;++A){var T=Ce.ofRange(c(S,A),d(S,A));if(Ee.areIntersecting(T,C))return A}return-1}e.firstIntersectionIndexFrom=g;function y(S,C){return new b(S,C)}e.transientSegments=y;var b=function(){function S(C,x){this.ranges=C,this.set=x,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=h(C,x),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Ee.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Ee.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(Br||(Br={}));function Ate(e){for(var t=[],r=e.elements,n=e.model,a=e.model.atomicHierarchy.residueAtomSegments,i=n.atomicHierarchy.derived.residue.traceElementIndex,o=Br.transientSegments(e.model.atomicRanges.polymerRanges,r),s=Qt.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Ee.areIntersecting(Ce.ofRange(r[c],r[d-1]),r)){var p=i[f];t.push(p===-1?a.offsets[f]:p)}}}return ze.ofSortedArray(t)}function Tte(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Be.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=Br.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return ze.ofSortedArray(t)}function Pte(e){for(var t=[],r=e.elements,n=e.model,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=Br.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=a[r[u.start]],c=a[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?i.offsets[l]:d),t.push(f===-1?i.offsets[c]:f)}return ze.ofSortedArray(t)}function Ete(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Be.isSpheres(e)?i.gapRanges:o.gapRanges,u=Br.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return ze.ofSortedArray(t)}function Ite(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=Qt.transientSegments(i,r),d=Qt.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(Uu(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return ze.ofSortedArray(t)}function Dte(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=Qt.transientSegments(i,r),d=Qt.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(r7(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return ze.ofSortedArray(t)}var pM=w.zero();function Mte(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),a=0,i=r.length;a<i;a++)t(r[a],pM),w.toArray(pM,n,a*3);return n}function vM(e){var t=Mte(e);return Td.ofPositions(t)}var mM=w.set,Rte=new To("14"),Ote=new To("98");function Bte(e){return e>1e4?Rte:Ote}var my=w();function am(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=Ee.size(i);if(o>25e4){var s=Ut.computeBounding(e);return{box:s,sphere:Me.fromBox3D(Me(),s)}}var u=Bte(o);u.reset();for(var l=0;l<o;l++){var c=Ee.getAt(i,l);mM(my,t[c],r[c],n[c]),u.includePositionRadius(my,a&&a[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Ee.getAt(i,l);mM(my,t[c],r[c],n[c]),u.radiusPositionRadius(my,a&&a[c]||0)}var d=u.getSphere();if(!a&&Me.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Ee.getAt(i,l);f.push(w.create(t[c],r[c],n[c]))}Me.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var kte=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=ze.hashCode(t);if(!!this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],o=i[0],s=i[1];if(ze.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=ze.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(ze.areEqual(t,s[0])){s[1]=r;return}}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),e4=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,a){return new e(r,n,a)}e.create=t})(e4||(e4={}));var rg;(function(e){e.Default={assemblies:[],spacegroup:ss.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,a){var i=a.toLocaleLowerCase(),o=kn.Provider.get(n);return o?rP(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0}e.findAssembly=t;function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,l=i.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=Fs(l[0]).toFixed(2),v=Fs(l[1]).toFixed(2),m=Fs(l[2]).toFixed(2),h=[];return h.push("Unit Cell <b>".concat(o,"</b> #").concat(s)),h.push("".concat(c,"\xD7").concat(d,"\xD7").concat(f," \u212B")),h.push("\u03B1=".concat(p,"\xB0 \u03B2=").concat(v,"\xB0 \u03B3=").concat(m,"\xB0")),h.join(" | ")}e.getUnitcellLabel=r})(rg||(rg={}));function Lte(e,t,r){if(!e._rowCount)return[];for(var n=Ute(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=Fte(e,t,i,n);return a}function Fte(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===a&&(o[o.length]={assemblyId:a,expression:u.value(c),asymIds:l.value(c)});return e4.create(a,i,Nte(o,n))}function Nte(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],o=Hte(i.expression),s=zte(o),u=Vte(t,s,n,i.assemblyId),l=Hr.generators.atoms({chainTest:Hr.pred.and(Hr.pred.eq(function(c){return tt.unit.operator_name(c.element)},nn.DefaultName),Hr.pred.inSet(function(c){return tt.chain.label_asym_id(c.element)},i.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function Ute(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=0,s=e._rowCount;o<s;o++){var u=gr.toMat4(oe(),a.matrix.space,r.value(o)),l=gr.toVec3(w(),a.vector.space,n.value(o));oe.setTranslation(u,l),oe.setValue(u,3,3,1),i.set(t.value(o),u)}return i}function zte(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return v7(e,t,e.length-1,r),t}function v7(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],v7(e,t,r-1,n)}function Vte(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=oe.identity(),c=0;c<u.length;c++)oe.mul(l,l,e.get(u[c]));i++,a[a.length]=nn.create("ASM_".concat(i),l,{assembly:{id:n,operId:i,operList:u}})}return a}function Hte(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],a;a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var kn;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=Xs.create(e.Descriptor);function t(n){var a=Lte(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=jte(n.symmetry,n.cell),o=Gte(n.atom_sites);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:o,ncsOperators:Wte(n.struct_ncs_oper)}}e.fromData=t;function r(n,a){var i=Ri.create("P 1",n,a),o=ss.create(i);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(kn||(kn={}));function Gte(e,t){return e._rowCount===0,!1}function qte(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function jte(e,t){if(e._rowCount===0||t._rowCount===0)return ss.ZeroP1;var r=qte(e),n=Ri.create(r,w.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),w.scale(w.zero(),w.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return ss.create(n)}function Wte(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,a=or.struct_ncs_oper.matrix.space,i=or.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=gr.toMat3(wn(),a,r.value(s)),l=gr.toVec3(w(),i,n.value(s));if(!!nn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!wn.isIdentity(u)&&!w.isZero(l))){var c=t.value(s);o[o.length]=nn.ofRotationAndOffset("ncs_".concat(c),u,l,c)}}return o}}var Be;(function(e){function t(V){return V.kind===0}e.isAtomic=t;function r(V){return V.kind===1||V.kind===2}e.isCoarse=r;function n(V){return V.kind===1}e.isSpheres=n;function a(V){return V.kind===2}e.isGaussians=a;function i(V,F,Y,W,K,$,J,Z,N){switch(K){case 0:return new v(V,F,Y,W,$,Z,nn.createMapping(J,$.atomicConformation,void 0),N!=null?N:m());case 1:return C(V,F,Y,W,$,1,Z,nn.createMapping(J,$.coarseConformation.spheres,f($)),N!=null?N:y());case 2:return C(V,F,Y,W,$,2,Z,nn.createMapping(J,$.coarseConformation.gaussians,p()),N!=null?N:y())}}e.create=i;function o(V){for(var F=us.Mutable(),Y=0,W=V.length;Y<W;Y++)F.set(V[Y].id,Y);return F}function s(V){for(var F=[],Y=0,W=V.length;Y<W;Y++)F.push(V[Y].id);return vi(F)}function u(V){var F={};return{elements:V[0].elements,units:V,get unitIndexMap(){return F.unitIndexMap||(F.unitIndexMap=o(V)),F.unitIndexMap},hashCode:c(V[0]),transformHash:s(V)}}e.SymmetryGroup=u,function(V){function F(W,K){return W.hashCode!==K.hashCode?!1:ze.areEqual(W.elements,K.elements)}V.areInvariantElementsEqual=F;function Y(W){for(var K=us.Mutable(),$=0,J=W.length;$<J;++$)for(var Z=W[$],N=0,j=Z.units.length;N<j;++N)K.set(Z.units[N].id,$);return K}V.getUnitSymmetryGroupsIndexMap=Y}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(V){return e.isAtomic(V)?V.model.atomicConformation.id:V.model.coarseConformation.id}e.conformationId=l;function c(V){return pp(V.invariantId,ze.hashCode(V.elements))}e.hashUnit=c,function(V){V.is=Xa.has,V.create=Xa.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(V){var F=V.coarseConformation.spheres.radius;return function(Y){return F[Y]}}function p(V){return function(F){return 0}}var v=function(){function V(F,Y,W,K,$,J,Z,N){this.kind=0,this.objectPrimitive="atomistic",this.id=F,this.invariantId=Y,this.chainGroupId=W,this.traits=K,this.model=$,this.elements=J,this.conformation=Z,this.residueIndex=$.atomicHierarchy.residueAtomSegments.index,this.chainIndex=$.atomicHierarchy.chainAtomSegments.index,this.props=N}return V.prototype.getChild=function(F){return F.length===this.elements.length?this:new V(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,F,this.conformation,m())},V.prototype.applyOperator=function(F,Y,W){W===void 0&&(W=!1);var K=W?Y:nn.compose(this.conformation.operator,Y);return new V(F,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,nn.createMapping(K,this.model.atomicConformation,this.conformation.r),this.props)},V.prototype.remapModel=function(F,Y,W){W||(W=_(_({},this.props),{bonds:Y?void 0:T(this,this.props.bonds,F)}),e.isSameConformation(this,F)||(W.boundary=void 0,W.lookup3d=void 0,W.principalAxes=void 0));var K=this.conformation.operator,$=kn.Provider.get(F);if(K.spgrOp!==-1&&$&&$!==kn.Provider.get(this.model)){var J=K.hkl,Z=J[0],N=J[1],j=J[2],L=$.spacegroup.cell.toFractional,H=w.transformMat4(w(),zt.getCenter(F),L);K=ss.getSymmetryOperatorRef($.spacegroup,K.spgrOp,Z,N,j,H)}var G=this.model.atomicConformation!==F.atomicConformation||K!==this.conformation.operator?nn.createMapping(K,F.atomicConformation):this.conformation;return new V(this.id,this.invariantId,this.chainGroupId,this.traits,F,this.elements,G,W)},Object.defineProperty(V.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var F=this.model.atomicConformation,Y=F.x,W=F.y,K=F.z;return this.props.boundary=am({x:Y,y:W,z:K,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var F=this.model.atomicConformation,Y=F.x,W=F.y,K=F.z;return this.props.lookup3d=jf({x:Y,y:W,z:K,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=vM(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var F=kte.get(this.model),Y=F.get(this.elements);return Y||(Y=ote(this),F.set(this.elements,Y)),this.props.bonds=Y,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=Hb.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Ate(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Pte(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=Ite(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=Dte(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var F=0,Y=Qt.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Y.hasNext;)Y.move(),F+=1;return this.props.residueCount=F,this.props.residueCount},enumerable:!1,configurable:!0}),V.prototype.getResidueIndex=function(F){return this.residueIndex[this.elements[F]]},V}();e.Atomic=v;function m(){return d()}var h=function(){function V(F,Y,W,K,$,J,Z,N,j){this.kind=J,this.objectPrimitive=J===1?"sphere":"gaussian",this.id=F,this.invariantId=Y,this.chainGroupId=W,this.traits=K,this.model=$,this.elements=Z,this.conformation=N,this.coarseElements=J===1?$.coarseHierarchy.spheres:$.coarseHierarchy.gaussians,this.coarseConformation=J===1?$.coarseConformation.spheres:$.coarseConformation.gaussians,this.props=j}return V.prototype.getChild=function(F){return F.length===this.elements.length?this:C(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,F,this.conformation,y())},V.prototype.applyOperator=function(F,Y,W){W===void 0&&(W=!1);var K=W?Y:nn.compose(this.conformation.operator,Y);return C(F,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,nn.createMapping(K,this.getCoarseConformation(),this.conformation.r),this.props)},V.prototype.remapModel=function(F,Y,W){var K=this.getCoarseConformation(),$=g(this.kind,F);W||(W=_({},this.props),e.isSameConformation(this,F)||(W.boundary=void 0,W.lookup3d=void 0,W.principalAxes=void 0));var J=K!==$?nn.createMapping(this.conformation.operator,$):this.conformation;return new V(this.id,this.invariantId,this.chainGroupId,this.traits,F,this.kind,this.elements,J,W)},Object.defineProperty(V.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var F=this.getCoarseConformation(),Y=F.x,W=F.y,K=F.z;return this.props.boundary=am({x:Y,y:W,z:K,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var F=this.getCoarseConformation(),Y=F.x,W=F.y,K=F.z;return this.props.lookup3d=jf({x:Y,y:W,z:K,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=vM(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Tte(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Ete(this),this.props.gapElements)},enumerable:!1,configurable:!0}),V.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},V}();function g(V,F){return V===1?F.coarseConformation.spheres:F.coarseConformation.gaussians}function y(){return d()}var b=function(V){Pe(F,V);function F(){return V!==null&&V.apply(this,arguments)||this}return F}(h);e.Spheres=b;var S=function(V){Pe(F,V);function F(){return V!==null&&V.apply(this,arguments)||this}return F}(h);e.Gaussians=S;function C(V,F,Y,W,K,$,J,Z,N){return new h(V,F,Y,W,K,$,J,Z,N)}function x(V,F){return V.chainGroupId===F.chainGroupId&&V.conformation.operator.name===F.conformation.operator.name}e.areSameChainOperatorGroup=x;function A(V,F){return oe.areEqual(V.conformation.operator.matrix,F.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=A;function P(V,F){return ze.areEqual(V.elements,F.elements)?D(V,F.model):!1}e.areConformationsEqual=P;function T(V,F,Y){var W;if(!!F){if(V.model.atomicConformation.id===Y.atomicConformation.id)return F;var K=Ka.Provider.get(V.model);if(K){var $=Ka.Provider.get(Y);return!$||K===$?F:void 0}return((W=F.props)===null||W===void 0?void 0:W.canRemap)||D(V,Y)?F:void 0}}function D(V,F){var Y=zt.CoordinatesHistory.get(zt.getRoot(F));if(Y)return Y.areEqual(V.elements,V.kind,F);for(var W=V.elements,K=V.conformation.coordinates,$=K.x,J=K.y,Z=K.z,N=I(V.kind,F),j=N.x,L=N.y,H=N.z,G=0,q=W.length;G<q;G++){var X=W[G];if($[X]!==j[X]||J[X]!==L[X]||Z[X]!==H[X])return!1}return!0}e.isSameConformation=D;function I(V,F){return V===0?F.atomicConformation:V===1?F.coarseConformation.spheres:F.coarseConformation.gaussians}e.getModelConformationOfKind=I;function M(V){return I(V.kind,V.model)}e.getConformation=M;function B(V,F){return V===0?F.atomicHierarchy:V===1?F.coarseHierarchy.spheres:F.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=B;function U(V){return B(V.kind,V.model)}e.getHierarchy=U})(Be||(Be={}));var Gb;(function(e){function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}e.copy=n})(Gb||(Gb={}));function m7(){return{result:Gb.create(),closeUnitsResult:_d.create(),unitGroupResult:_d.create()}}var Xte=function(){function e(t){this.structure=t,this.pivot=w(),this.findContext=m7();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),l=w(),c=0;c<a;c++){var d=r[c],f=d.boundary.sphere;w.transformMat4(l,f.center,d.conformation.operator.matrix),i[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var p={x:i,y:o,z:s,radius:u,indices:Ee.ofBounds(0,a)};this.unitLookup=jf(p,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i!=null?i:this.findContext)},e.prototype._find=function(t,r,n,a,i){_d.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(s.count===0)return i.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];w.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||w.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),p=0,v=f.count;p<v;p++)Gb.add(i.result,c,f.indices[p],f.squaredDistances[p])}return i.result},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];w.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||w.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(f.count!==0){var p=c.elements;i.beginUnit(c.id);for(var v=0,m=f.count;v<m;v++)i.addElement(p[f.indices[v]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(u.count!==0)for(var l=He.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];w.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||w.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var p=f.lookup3d,v=p.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(v.count!==0){var m=f.elements;l.unit=f,i.beginUnit(f.id);for(var h=0,g=v.count;h<g;h++)l.element=m[v.indices[h]],o(l)&&i.addElement(l.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=He.create(this.structure),f=a+i+o,p=0,v=c.count;p<v;p++){var m=l[c.indices[p]];w.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||w.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);var h=m.lookup3d,g=h.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=m.elements;d.unit=m,u.beginUnit(m.id);for(var b=0,S=g.count;b<S;b++){d.element=y[g.indices[b]];var C=s(d);Math.sqrt(g.squaredDistances[b])-a-C>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=i[o.indices[s]];w.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||w.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function ng(e,t){if(t.length===0)return Ne.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=ze.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(Yte,d),d.getStructure()}function Yte(e,t){this.setUnit(t,e)}function Kte(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!ze.areEqual(o.elements,s.elements))return!1}return!0}function xS(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(!!i.has(u.id)){var l=i.get(u.id);if(ze.areIntersecting(u.elements,l.elements))return!0}}return!1}function h7(e,t){if(e===t)return e;if(!xS(e,t))return Ne.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var l=a[s];if(!!i.has(l.id)){var c=i.get(l.id);if(ze.areIntersecting(l.elements,c.elements)){var d=ze.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return Ne.create(o,{parent:e.parent||t.parent})}function MP(e,t){if(e===t)return Ne.Empty;if(!xS(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(!n.has(s.id)){a[a.length]=s;continue}var u=n.get(s.id),l=ze.subtract(s.elements,u.elements);l.length>0&&(a[a.length]=s.getChild(l))}return Ne.create(a,{parent:e.parent||t.parent})}var ot;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,Ne.Empty)}e.Empty=n;function a(g){return g.kind==="singletons"}e.isSingleton=a;function i(g){return a(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=i;function o(g){return a(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return i(g)?Ne.Empty:a(g)?g.structure:ng(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,S=0,C=s(g).units;S<C.length;S++){var x=C[S];x===b.get(x.id)?y[y.length]={unit:x,indices:Ee.ofBounds(0,x.elements.length)}:y[y.length]={unit:x,indices:Ee.ofSortedArray(ze.indicesOf(b.get(x.id).elements,x.elements))}}return xe(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,S=0,C=s(g).units;S<C.length;S++){var x=C[S],A=b.get(x.id);A===x?y[y.length]={unit:A,indices:Ee.ofBounds(0,A.elements.length)}:y[y.length]={unit:A,indices:Ee.ofSortedArray(ze.indicesOf(A.elements,x.elements))}}return xe(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var S=y.length;return S===0?n(g):b?t(g,ng(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=bP(Ne.hashCode,Ne.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function p(g){return new d(g)}e.LinearBuilder=p;function v(g){return new f(g)}e.UniqueBuilder=v;function m(g,y){var b=0;if(e.isSingleton(g))for(var S=0,C=g.structure.units;S<C.length;S++)for(var x=C[S],A=x.elements,P=0,T=A.length;P<T;P++){var D=Ne.create([x.getChild(ze.ofSingleton(A[P]))],{parent:g.source});y(D,b++)}else for(var I=0,M=g.structures;I<M.length;I++){var D=M[I];y(D,b++)}}e.forEach=m;function h(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=h})(ot||(ot={}));var Mr;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(ot.toLociWithSourceUnits(ot.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(ot.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,p=c.elements;f<p.length;f++){var v=p[f],m=v.unit,h=v.indices;if(Ee.size(h)!==0){var g=[],y=[];if(Ee.isInterval(h))Ee.size(h)===1?y.push(Ce.min(h)):g.push(Ce.min(h),Ce.max(h));else for(var b=0,S=h.length;b<S;){var C=b;for(b++;b<S&&h[b-1]+1===h[b];)b++;var x=b;if(x-C>2)g.push(h[C],h[x-1]);else for(var A=C;A<x;A++)y[y.length]=h[A]}d.push({unit:m,set:ze.ofSortedArray(y),ranges:Br.ofSortedRanges(g)})}}for(var P=new Map,b=0,T=d.length;b<T;++b){var v=d[b],D=pp(vi(v.ranges),vi(v.set));if(P.has(D)){var I=P.get(D).groupedUnits;I.has(v.unit.invariantId)?I.get(v.unit.invariantId).push(v.unit.id):I.set(v.unit.invariantId,[v.unit.id])}else{var I=new Map;I.set(v.unit.invariantId,[v.unit.id]),P.set(D,{groupedUnits:I,set:v.set,ranges:v.ranges})}}var M=[];return P.forEach(function(B){var U=[];B.groupedUnits.forEach(function(V){return U.push(ze.ofUnsortedArray(V))}),U.sort(function(V,F){return V[0]-F[0]}),M.push({groupedUnits:U,set:B.set,ranges:B.ranges})}),{hash:c.structure.hashCode,elements:M}}e.fromLoci=n;function a(c,d){for(var f=[],p=0,v=c.length;p<v;++p){var m=c[p];d.unitMap.has(m)&&f.push(d.unitMap.get(m))}return f}function i(c,d){c.hash!==-1&&c.hash!==d.hashCode;for(var f=[],p=0,v=c.elements;p<v.length;p++)for(var m=v[p],h=function(S){var C=a(S,d);if(C.length===0)return"continue";var x=void 0;if(m.ranges.length===0)x=m.set;else if(m.set.length===0)if(m.ranges.length===2)x=Ce.ofRange(m.ranges[0],m.ranges[1]);else{var A=new Int32Array(Br.size(m.ranges));Br.forEach(m.ranges,function(B,U){return A[U]=B}),x=ze.ofSortedArray(A)}else{var P=Br.size(m.ranges),T=new Int32Array(m.set.length+P);Br.forEach(m.ranges,function(B,U){return T[U]=B}),T.set(m.set,P),x=ze.ofUnsortedArray(T)}for(var D=0,I=C;D<I.length;D++){var M=I[D];f.push({unit:M,indices:x})}},g=0,y=m.groupedUnits;g<y.length;g++){var b=y[g];h(b)}return xe(d,f)}e.toLoci=i;function o(c,d){c.hash!==-1&&c.hash!==d.hashCode;for(var f=[],p=0,v=c.elements;p<v.length;p++)for(var m=v[p],h=function(S){var C=a(S,d);if(C.length===0)return"continue";var x=C[0].elements,A=Br.size(m.ranges),P=m.set.length,T=new Int32Array(P+A),D=void 0;if(A===0){for(var I=0,M=P;I<M;++I)T[I]=x[m.set[I]];D=ze.ofSortedArray(T)}else if(P===0)Br.forEach(m.ranges,function(F,Y){return T[Y]=x[F]}),D=ze.ofSortedArray(T);else if(ze.min(m.set)>Br.max(m.ranges)){Br.forEach(m.ranges,function(F,Y){return T[Y]=x[F]});for(var I=0,M=P;I<M;++I)T[I+A]=x[m.set[I]];D=ze.ofSortedArray(T)}else if(Br.min(m.ranges)>ze.max(m.set)){for(var I=0,M=P;I<M;++I)T[I]=x[m.set[I]];Br.forEach(m.ranges,function(F,Y){return T[Y+P]=x[F]}),D=ze.ofSortedArray(T)}else{Br.forEach(m.ranges,function(F,Y){return T[Y]=x[F]});for(var I=0,M=P;I<M;++I)T[I+A]=x[m.set[I]];D=ze.ofUnsortedArray(T)}for(var B=0,U=C;B<U.length;B++){var V=U[B];f.push(V.getChild(D))}},g=0,y=m.groupedUnits;g<y.length;g++){var b=y[g];h(b)}return Ne.create(f,{parent:d})}e.toStructure=o;function s(c){return ne.internal.generator.bundleElement({groupedUnits:ne.core.type.list(c.groupedUnits.map(function(d){return ne.core.type.list(d)})),ranges:ne.core.type.list(c.ranges),set:ne.core.type.list(c.set)})}function u(c){return ne.internal.generator.bundle({elements:ne.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,p=c.elements.length;f<p;++f){var v=c.elements[f],m=d.elements[f];if(v.groupedUnits.length!==m.groupedUnits.length)return!1;for(var h=0,g=m.groupedUnits.length;h<g;++h)if(!ze.areEqual(v.groupedUnits[h],m.groupedUnits[h]))return!1;if(!ze.areEqual(v.set,m.set)||!Br.areEqual(v.ranges,m.ranges))return!1}return!0}e.areEqual=l})(Mr||(Mr={}));function t4(e){return vr.isCovalent(e.atomicBond.type)}function Qte(){return function(t){for(var r=t.inputStructure,n=He.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],tt.entity.type(n)==="polymer"){for(var l=Qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||a.push(s)}}}return ot.Singletons(r,Ne.create(a,{parent:r}))}}function Zte(){return function(t){for(var r=t.inputStructure,n=He.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],tt.entity.type(n)==="water"&&a.push(s)}}return ot.Singletons(r,Ne.create(a,{parent:r}))}}function $te(){return function(t){for(var r=t.inputStructure,n=He.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],tt.entity.type(n)!=="water"){if(tt.entity.type(n)==="polymer"){for(var l=Qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}a.push(s)}}}return ot.Singletons(r,Ne.create(a,{parent:r}))}}function Jte(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];o.kind===1&&n.push(o)}return ot.Singletons(r,Ne.create(n,{parent:r}))}}function g7(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function y7(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return ot.Sequence(r.inputStructure,[Mr.toStructure(n,r.inputStructure)])}}var ere=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",defaultBondTest:t4,atomicSequence:Qte,water:Zte,atomicHet:$te,spheres:Jte,bundleElementImpl:g7,bundleGenerator:y7}),Co=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=fn(),this.element=He.create(void 0),this.currentStructure=void 0,this.atomicBond=new hM,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=He.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new hM,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&fn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> ".concat(this.timeoutMs/1e3,"s)."))},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),hM=function(){function e(){this.a=He.create(void 0),this.aIndex=0,this.b=He.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=t4}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||t4},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return He.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),r4;(function(e){function t(r,n,a){return r(new Co(n,a))}e.run=t})(r4||(r4={}));var n4=function(){function e(t){this.source=t,this.set=bP(Ne.hashCode,Ne.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){!t.elementCount||(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?ot.Singletons(this.source,ng(this.source,this.structures)):ot.Sequence(this.source,this.structures)},e}(),tre=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=He.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return ot.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return ot.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?ot.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),RP=function(e){return ot.Sequence(e.inputStructure,[])},b7=function(e){return ot.Singletons(e.inputStructure,e.inputStructure)};function rre(e){return OP(_(_({},e),{groupBy:function(t){return tt.residue.key(t.element)}}))}function nre(e){return OP(_(_({},e),{groupBy:function(t){return tt.chain.key(t.element)}}))}function Fc(e){return!0}function are(e){return 0}function OP(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return b7;if(!!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return ire(e.atomTest);var t={unitTest:e.unitTest||Fc,entityTest:e.entityTest||Fc,chainTest:e.chainTest||Fc,residueTest:e.residueTest||Fc,atomTest:e.atomTest||Fc,groupBy:e.groupBy||are};return e.groupBy?sre(t):ore(t)}function ire(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var l=u[s];i.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)i.element=c[d],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),ot.Singletons(n,o.getStructure())}}function ore(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=a===Fc&&i===Fc,p=i===Fc;c.structure=u;for(var v=0,m=l;v<m.length;v++){var h=m[v];if(c.unit=h,!!t(s)){var g=h.elements,y=h.model;if(d.beginUnit(h.id),h.kind===0)for(var b=Qt.transientSegments(h.model.atomicHierarchy.chainAtomSegments,g),S=Qt.transientSegments(h.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var C=b.move();if(c.element=g[C.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,C.start,C.end);continue}for(S.setSegment(C);S.hasNext;){var x=S.move();if(c.element=g[x.start],!!a(s)){if(p){d.addElementRange(g,x.start,x.end);continue}for(var A=x.start,P=x.end;A<P;A++)c.element=g[A],i(s)&&d.addElement(c.element)}}}}else for(var T=y.coarseHierarchy.spheres.chainElementSegments,b=Qt.transientSegments(T,g);b.hasNext;){var C=b.move();if(c.element=g[C.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,C.start,C.end);continue}for(var A=C.start,P=C.end;A<P;A++)c.element=g[A],a(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),ot.Singletons(u,d.getStructure())}}function sre(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new tre(l);d.structure=l;for(var p=0,v=c;p<v.length;p++){var m=v[p];if(d.unit=m,!!t(u)){var h=m.elements,g=m.model;if(m.kind===0)for(var y=Qt.transientSegments(g.atomicHierarchy.chainAtomSegments,h),b=Qt.transientSegments(g.atomicHierarchy.residueAtomSegments,h);y.hasNext;){var S=y.move();if(d.element=h[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var C=b.move();if(d.element=h[C.start],!!a(u))for(var x=C.start,A=C.end;x<A;x++)d.element=h[x],i(u)&&f.add(o(u),m.id,d.element)}}else for(var P=g.coarseHierarchy.spheres.chainElementSegments,y=Qt.transientSegments(P,h);y.hasNext;){var S=y.move();if(d.element=h[S.start],!(!r(u)||!n(u)))for(var x=S.start,A=S.end;x<A;x++)d.element=h[x],a(u)&&f.add(o(u),m.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function RC(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return Ne.create([e.getChild(ze.ofSortedArray(n))],{parent:r})}function ure(e,t){return function(n){var a=n.inputStructure.units,i=ot.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!!Be.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];i.add(RC(u,u.rings.all[d],n.inputStructure))}else for(var f=0,p=u.rings.all;f<p.length;f++){var d=p[f];i.add(RC(u,d,n.inputStructure))}}else{for(var v=Vr.create(),m=0;m<e.length;m++)Vr.add(v,e[m],e[m]);for(var h=0,g=a;h<g.length;h++){var u=g[h];if(!!Be.isAtomic(u))for(var y=u.rings,b=0,S=v.array;b<S.length;b++){var C=S[b];if(!!y.byFingerprint.has(C))for(var x=0,A=y.byFingerprint.get(C);x<A.length;x++){var d=A[x];t&&!y.aromaticRings.includes(d)||i.add(RC(u,y.all[d],n.inputStructure))}}}}return i.getSelection()}}function lre(e,t,r){return r===void 0&&(r=!1),function(a){var i=e(a);if(ot.structureCount(i)===0)return i;var o=r?MP(a.inputStructure,ot.unionStructure(i)):ot.unionStructure(i);if(o.elementCount===0)return ot.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),ot.withInputStructure(s,a.inputStructure)}}function cre(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=ot.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,p=c.edgeProps,v=p.flags,m=p.order;o.a.unit=l,o.b.unit=l;for(var h=0,g=l.elements.length;h<g;h++){o.aIndex=h,o.a.element=l.elements[h];for(var y=d[h],b=d[h+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=v[y],o.order=m[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),i.add(S.getStructure())}}}}for(var C=0,x=a.edges;C<x.length;C++){var A=x[C];if(o.a.unit=n.unitMap.get(A.unitA),o.a.element=o.a.unit.elements[A.indexA],o.aIndex=A.indexA,o.b.unit=n.unitMap.get(A.unitA),o.b.element=o.b.unit.elements[A.indexB],o.bIndex=A.indexB,o.order=A.props.order,o.type=A.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),i.add(S.getStructure())}}return r.popCurrentBond(),i.getSelection()}}var dre=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",none:RP,all:b7,residues:rre,chains:nre,atoms:OP,rings:ure,querySelection:lre,bondedAtomicPairs:cre}),CS=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=us.Mutable(),this.parentId=-1,this.currentUnit=Vr.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)Vr.add(n,r,r)&&this.elementCount++;else{var a=Vr.create();Vr.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?Vr.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Vr.create():this.currentUnit},e.prototype.addElement=function(t){Vr.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return Ne.Empty;var t=[];Ns(this.ids);for(var r=wu.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&Ns(s);var l=o.getChild(ze.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return Ne.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function it(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function a(y){y.tokenStart=y.position}e.markStart=a;function i(y){return y.tokenStart=y.position,n(y)}e.markLine=i;function o(y){return i(y),t(y)}e.readLine=o;function s(y){i(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var C=0,x=0;x<b;x++){if(!i(y))return C;Ke.addUnchecked(S,y.tokenStart,y.tokenEnd),C++}return C}function l(y,b){var S=Ke.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],C=0;C<b;C++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,C){return C===void 0&&(C=1e5),se(this,void 0,void 0,function(){var x,A,P;return ie(this,function(T){switch(T.label){case 0:return x=y.length,A=Ke.create(y.data,b*2),P=0,[4,Pl(S,C,y,function(D,I){var M=Math.min(b-P,D);return u(I,M,A),P+=M,M},function(D,I){return D.update({message:"Parsing...",current:I.position,max:x})})];case 1:return T.sent(),[2,A]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=Ke.create(b.data,Math.max(y.length/80,2));i(b);)Ke.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function p(y,b,S){for(var C=0,x=0;x<b;x++){if(!i(y))return C;Ke.add(S,y.tokenStart,y.tokenEnd),C++}return C}function v(y,b,S){return S===void 0&&(S=1e5),se(this,void 0,void 0,function(){var C,x;return ie(this,function(A){switch(A.label){case 0:return C=e(y),x=Ke.create(C.data,Math.max(y.length/80,2)),[4,Pl(b,S,C,function(P,T){return p(T,P,x),T.position<T.length?P:0},function(P,T){return P.update({message:"Parsing...",current:T.position,max:length})})];case 1:return A.sent(),[2,x]}})})}e.readAllLinesAsync=v;function m(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=m;function h(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=h;function g(y,b,S){for(var C=y.data,x=b,A=S-1,P=C.charCodeAt(x);(P===9||P===32)&&x<=A;)P=C.charCodeAt(++x);for(P=C.charCodeAt(A);(P===9||P===32)&&A>=x;)P=C.charCodeAt(--A);return y.tokenStart=x,y.tokenEnd=A+1,y.position=S,y}e.trim=g})(it||(it={}));function fre(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(i===9||i===32)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(i===9||i===32)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}var Ke;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=a;function i(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=i})(Ke||(Ke={}));var dn;(function(e){function t(i,o){return o===void 0&&(o=-1),new n(i,o)}e.error=t;function r(i,o){return o===void 0&&(o=[]),new a(i,o)}e.success=r;var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line ".concat(this.line,"] ").concat(this.message):this.message},i}();e.Error=n;var a=function(){function i(o,s){this.result=o,this.warnings=s,this.isError=!1}return i}();e.Success=a})(dn||(dn={}));function gM(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function pre(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function vre(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&S7(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function mre(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function hre(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function gre(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function yre(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function S7(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function bre(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function Sre(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function xre(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function Cre(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function wre(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||e.data.charCodeAt(n+i)===46}function x7(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function C7(e,t){return e.data.substring(e.tokenStart,t)}function _re(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function a4(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function yM(e){var t=yre(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:gre(e),e.tokenType=5;break;case 39:if(S7(e)){vre(e),e.tokenType=3;break}case 34:pre(e,r),e.tokenType=3;break;case 59:t===10||t===13?mre(e):gM(e),e.tokenType=3;break;default:e.isImportGet?hre(e):gM(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&Cre(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?bre(e)?e.tokenType=0:Sre(e)?e.tokenType=1:xre(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function dd(e){for(yM(e);e.tokenType===5;)yM(e)}function Are(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function hy(){return{categoryNames:[],categoryData:Object.create(null)}}function BP(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=Ga(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function bM(e,t,r){return _P(e.categoryNames,BP(e.categoryNames,e.categoryData),t,r)}function Tre(e,t){return _P(e.categoryNames,BP(e.categoryNames,e.categoryData),t)}function i4(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function Pre(e,t){for(var r=e.tokenStart,n=x7(e),a=C7(e,n),i=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!wre(e,r,n)){s=!1;break}var u=a4(e).substring(a.length+1);if(dd(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=lt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,dd(e)}return i4(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}function Ere(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;r.tokenType===3&&o<e;)Ke.add(n[i++%a],r.tokenStart,r.tokenEnd),dd(r),o++;return t.tokenCount=i,o}function Ire(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function Dre(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,f,l,c,f,d,d,f;return ie(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,dd(e),n=C7(e,x7(e)),a=_re(e),i=[];e.tokenType===4;)i[i.length]=a?a4(e):a4(e).substring(n.length+1),dd(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=i.length,f=0;f<u;f++)s[f]=Ke.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,Pl(e.runtimeCtx,1e6,l,Ere,Ire)];case 1:if(p.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line ".concat(r," is not a multiple of the number of columns.")}];if(c=l.tokenCount/u|0,a)for(f=0;f<u;f++)d={"":lt.ofTokens(s[f])},i4(t,i[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[i[f]]=lt.ofTokens(s[f]);i4(t,n.substr(1),c,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function zp(e,t){return dn.error(t,e)}function Mre(e){return dn.success(e)}function Rre(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,d;return ie(this,function(f){switch(f.label){case 0:r=[],n=Are(e,t),a="",i=hy(),o=[],s=hy(),u=tJ(s.categoryNames,BP(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),dd(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,zp(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(bM(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=hy(),o=[],dd(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=Tre(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,zp(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=hy()}return dd(n),[3,6];case 3:return c!==2?[3,5]:[4,Dre(n,n.inSaveFrame?s:i)];case 4:return d=f.sent(),d.hasError?[2,zp(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=Pre(n,n.inSaveFrame?s:i),d.hasError)return[2,zp(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,it.getTokenString(n)),[2,zp(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,zp(n.lineNumber,"Unfinished save frame (".concat(u.header,")."))]:((i.categoryNames.length>0||o.length>0)&&r.push(bM(i,a,o)),[2,Mre(FN(r))])}})})}function SM(e){var t=this;return Fe.create("Parse CIF",function(r){return se(t,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,Rre(e,r)];case 1:return[2,n.sent()]}})})})}function Ore(e){var t=e.mask?Vb(e.mask):void 0,r=Vb(e.data),n=tP(r),a=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},i=n?function(l){return r[l]}:function(l){var c=r[l];return ud(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return bl(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return Ia(u,a,l)},toIntArray:n?function(l){return Sb(r,l)}:function(l){return Ia(u,i,l)},toFloatArray:n?function(l){return Sb(r,l)}:function(l){return Ia(u,o,l)}}}function w7(e){return qb({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function OC(e,t){for(var r={},n=0;n<t;n++){var a=qb(e);r[a]=qb(e)}return r}function BC(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function gy(e,t){var r=sP(e.buffer,e.offset,t);return e.offset+=t,r}function kC(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=qb(e);return r}function qb(e){var t=e.buffer[e.offset],r,n;if((t&128)===0)return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,OC(e,n);if((t&240)===144)return n=t&15,e.offset++,kC(e,n);if((t&224)===160)return n=t&31,e.offset++,gy(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,BC(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,BC(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,BC(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,gy(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,gy(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,gy(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,kC(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,kC(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,OC(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,OC(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function Bre(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function kre(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(!!s)return r[o]||(r[o]=Ore(s)),r[o]}}}function xM(e){var t=this;return Fe.create("Parse BinaryCIF",function(r){return se(t,void 0,void 0,function(){var n,a,i;return ie(this,function(o){n=[0,3];try{return a=w7(e),Bre(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=FN(a.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=kre(d)}return _P(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,dn.success(i)]):[2,dn.error("Unsupported format version. Current ".concat(a.version,", required ").concat(n.join("."),"."))]}catch(s){return[2,dn.error(""+s)]}return[2]})})})}var Om=ce.Schema,br=Om.str,Lre=Om.float,CM=Om.List,no=Om.Aliased,uh=Om.int,Vp=Om.coord,Fre={chem_comp:{formula:br,formula_weight:Lre,id:br,mon_nstd_parent_comp_id:CM(",",function(e){return e}),name:br,one_letter_code:br,three_letter_code:br,type:no(br),pdbx_synonyms:CM(";",function(e){return e}),pdbx_type:br,pdbx_ambiguous_flag:br,pdbx_replaced_by:br,pdbx_replaces:br,pdbx_formal_charge:uh,pdbx_model_coordinates_details:br,pdbx_model_coordinates_db_code:br,pdbx_ideal_coordinates_details:br,pdbx_ideal_coordinates_missing_flag:no(br),pdbx_model_coordinates_missing_flag:no(br),pdbx_initial_date:br,pdbx_modified_date:br,pdbx_release_status:no(br),pdbx_processing_site:no(br)},chem_comp_atom:{alt_atom_id:br,atom_id:br,charge:uh,model_Cartn_x:Vp,model_Cartn_y:Vp,model_Cartn_z:Vp,comp_id:br,type_symbol:br,pdbx_align:uh,pdbx_ordinal:uh,pdbx_model_Cartn_x_ideal:Vp,pdbx_model_Cartn_y_ideal:Vp,pdbx_model_Cartn_z_ideal:Vp,pdbx_stereo_config:no(br),pdbx_aromatic_flag:no(br),pdbx_leaving_atom_flag:no(br)},chem_comp_bond:{atom_id_1:br,atom_id_2:br,comp_id:br,value_order:no(br),pdbx_ordinal:uh,pdbx_stereo_config:no(br),pdbx_aromatic_flag:no(br)},pdbx_chem_comp_descriptor:{comp_id:br,descriptor:br,type:no(br),program:br,program_version:br},pdbx_chem_comp_identifier:{comp_id:br,identifier:br,type:no(br),program:br,program_version:br}},wS=ce.Schema,Lt=wS.str,Nre=wS.float,xi=wS.Aliased,Io=wS.int,Ure={pdbx_reference_molecule:{prd_id:Lt,formula_weight:Nre,formula:Lt,type:xi(Lt),type_evidence_code:Lt,class:xi(Lt),class_evidence_code:Lt,name:Lt,represent_as:xi(Lt),chem_comp_id:Lt,compound_details:Lt,description:Lt,representative_PDB_id_code:Lt,release_status:xi(Lt),replaces:Lt,replaced_by:Lt},pdbx_reference_entity_list:{prd_id:Lt,ref_entity_id:Lt,type:xi(Lt),details:Lt,component_id:Io},pdbx_reference_entity_nonpoly:{prd_id:Lt,ref_entity_id:Lt,name:Lt,chem_comp_id:Lt},pdbx_reference_entity_link:{link_id:Io,prd_id:Lt,details:Lt,ref_entity_id_1:Lt,ref_entity_id_2:Lt,entity_seq_num_1:Io,entity_seq_num_2:Io,comp_id_1:Lt,comp_id_2:Lt,atom_id_1:Lt,atom_id_2:Lt,value_order:xi(Lt),component_1:Io,component_2:Io,link_class:xi(Lt)},pdbx_reference_entity_poly_link:{link_id:Io,prd_id:Lt,ref_entity_id:Lt,component_id:Io,entity_seq_num_1:Io,entity_seq_num_2:Io,comp_id_1:Lt,comp_id_2:Lt,atom_id_1:Lt,atom_id_2:Lt,value_order:xi(Lt)},pdbx_reference_entity_poly:{prd_id:Lt,ref_entity_id:Lt,type:xi(Lt),db_code:Lt,db_name:Lt},pdbx_reference_entity_poly_seq:{prd_id:Lt,ref_entity_id:Lt,mon_id:Lt,parent_mon_id:Lt,num:Io,observed:xi(Lt),hetero:xi(Lt)},pdbx_reference_entity_sequence:{prd_id:Lt,ref_entity_id:Lt,type:xi(Lt),NRP_flag:xi(Lt),one_letter_codes:Lt},pdbx_reference_entity_src_nat:{prd_id:Lt,ref_entity_id:Lt,ordinal:Io,organism_scientific:Lt,taxid:Lt,db_code:Lt,db_name:Lt},pdbx_prd_audit:{prd_id:Lt,date:Lt,processing_site:xi(Lt),action_type:xi(Lt)}},_7=ce.Schema,Wn=_7.str,zre=_7.float,Vre={id:Wn,description:Wn},Hre={title:Wn,datablock_id:Wn,version:Wn},Gre={version:Wn,update:Wn,revision:Wn},qre={id:Wn,description:Wn},jre={id:Wn,parent_id:Wn,description:Wn},Wre={code:Wn,primitive_code:Wn,construct:Wn,detail:Wn},Xre={code:Wn,detail:Wn},Yre={from_code:Wn,to_code:Wn,operator:Wn,factor:zre},Kre={datablock:Vre,dictionary:Hre,dictionary_history:Gre,sub_category:qre,category_group_list:jre,item_type_list:Wre,item_units_list:Xre,item_units_conversion:Yre},Pg=ce.Schema,uu=Pg.str,yy=Pg.int,Gu=Pg.float,by=Pg.Aliased,Mc=Pg.Vector;by(uu),by(uu),by(uu),by(uu),Mc(3),Mc(3);var Qre={volume_data_3d_info:{name:uu,axis_order:Mc(3,yy),origin:Mc(3),dimensions:Mc(3),sample_rate:yy,sample_count:Mc(3,yy),spacegroup_number:yy,spacegroup_cell_size:Mc(3),spacegroup_cell_angles:Mc(3),mean_source:Gu,mean_sampled:Gu,sigma_source:Gu,sigma_sampled:Gu,min_source:Gu,min_sampled:Gu,max_source:Gu,max_sampled:Gu},volume_data_3d:{values:Gu}},_S=ce.Schema,En=_S.float,LC=_S.int,Zr=_S.str,Zre=_S.Matrix,$re={cell:{angle_alpha:En,angle_beta:En,angle_gamma:En,formula_units_z:LC,length_a:En,length_b:En,length_c:En,volume:En},chemical:{melting_point:En,name_common:Zr,name_systematic:Zr},chemical_formula:{moiety:Zr,sum:Zr,weight:En},space_group:{crystal_system:Zr,it_number:LC,"name_h-m_full":Zr},space_group_symop:{operation_xyz:Zr},geom_bond:{atom_site_label_1:Zr,atom_site_label_2:Zr,distance:En,publ_flag:Zr,site_symmetry_1:Zr,site_symmetry_2:Zr,valence:En},audit:{block_doi:Zr},database_code:{cod:Zr,csd:Zr,depnum_ccdc_archive:Zr,depnum_ccdc_fiz:Zr,icsd:Zr,mdf:Zr,nbs:Zr},atom_site:{adp_type:Zr,calc_flag:Zr,disorder_assembly:Zr,disorder_group:Zr,fract_x:En,fract_y:En,fract_z:En,label:Zr,occupancy:En,refinement_flags:Zr,site_symmetry_multiplicity:LC,type_symbol:Zr,u_iso_or_equiv:En},atom_site_aniso:{label:Zr,u_11:En,u:Zre(3,3),u_12:En,u_13:En,u_22:En,u_23:En,u_33:En},atom_type:{description:Zr,symbol:Zr},atom_type_scat:{dispersion_imag:En,dispersion_real:En,source:Zr}},Jre={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},Ol={parse:function(e){return typeof e=="string"?SM(e):xM(e)},parseText:SM,parseBinary:xM,toDatabaseCollection:aJ,toDatabase:tl,schema:{mmCIF:function(e){return tl(or,e)},CCD:function(e){return tl(Fre,e)},BIRD:function(e){return tl(Ure,e)},dic:function(e){return tl(Kre,e)},cifCore:function(e){return tl($re,e,Jre)},densityServer:function(e){return tl(Qre,e)}}},ene={type_symbol:ce.Schema.Aliased(or.atom_site.type_symbol),label_atom_id:or.atom_site.label_atom_id,auth_atom_id:or.atom_site.auth_atom_id,label_alt_id:or.atom_site.label_alt_id,label_comp_id:or.atom_site.label_comp_id,auth_comp_id:or.atom_site.auth_comp_id,pdbx_formal_charge:or.atom_site.pdbx_formal_charge},tne={group_PDB:or.atom_site.group_PDB,label_seq_id:or.atom_site.label_seq_id,auth_seq_id:or.atom_site.auth_seq_id,pdbx_PDB_ins_code:or.atom_site.pdbx_PDB_ins_code},rne={label_asym_id:or.atom_site.label_asym_id,auth_asym_id:or.atom_site.auth_asym_id,label_entity_id:or.atom_site.label_entity_id},o4;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(o4||(o4={}));var Xf;(function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(a,i){return r(a,i)-t(a,i)}e.chainResidueCount=n})(Xf||(Xf={}));var AS={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},nne={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},ane={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},ine=1.7,one=10.81,sne=0;function Eg(e){var t=AS[e];return t===void 0?ine:nne[t]}function une(e){var t=AS[e];return t===void 0?one:ane[t]}function Ig(e){var t=AS[e];return t===void 0?sne:t}function A7(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var ag;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=Xs.create(e.Descriptor);function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=lne(r,n);cne(r,s,i,o),dne(n,s,i,r._rowCount,o);var u=a.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&pne(a,s,i,c),A7(c.type,c.key,c.elements,l)}e.fromStruct=t})(ag||(ag={}));function lne(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function cne(e,t,r,n){if(!!e._rowCount)for(var a=e.beg_label_asym_id,i=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,p=e.details,v=t==="label"?i:o,m=t==="label"?u:l,h=0,g=e._rowCount;h<g;h++){var y=Tr.create(d.valueKind(h)===0?Tr.SecondaryStructurePdb[d.value(h)]:f.valueKind(h)===0?Tr.SecondaryStructureMmcif[f.value(h)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(h)===0?f.value(h):"HELIX_P",helix_class:d.value(h),details:p.valueKind(h)===0?p.value(h):void 0},S={startSeqId:v.value(h),startInsCode:s.value(h),endSeqId:m.value(h),endInsCode:c.value(h),type:y,key:n.length};n[n.length]=b;var C=a.value(h);if(r.has(C)){var x=r.get(C);x.has(S.startSeqId)?x.get(S.startSeqId).push(S):x.set(S.startSeqId,[S])}else r.set(C,new Map([[S.startSeqId,[S]]]))}}function dne(e,t,r,n,a){if(!!e._rowCount)for(var i=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,p=t==="label"?o:s,v=t==="label"?l:c,m=new Map,h=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),S=void 0;m.has(b)?S=m.get(b):(S=h++,m.set(b,S));var C=Tr.create(8388612),x={kind:"sheet",flags:C,sheet_id:b,symmetry:void 0},A={startSeqId:p.value(g),startInsCode:u.value(g),endSeqId:v.value(g),endInsCode:d.value(g),type:C,key:a.length};a[a.length]=x;var P=i.value(g);if(r.has(P)){var T=r.get(P);T.has(A.startSeqId)?T.get(A.startSeqId).push(A):T.set(A.startSeqId,[A])}else r.set(P,new Map([[A.startSeqId,[A]]]))}}function fne(e,t,r,n,a,i){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,p=r.type,v=t==="label"?u:s,m=n;m<a;){var h=v.value(m);if(i.type[m]=p,i.key[m]=f,h>c||h===c&&l.value(m)===d)break;m++}}function pne(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<a;d++){var f=Xf.chainStartResidueIndex(e,d),p=Xf.chainEndResidueIndexExcl(e,d),v=i.value(d);if(r.has(v))for(var m=r.get(v),h=f;h<p;h++){var g=c.value(h);if(m.has(g))for(var y=m.get(g),b=0,S=y;b<S.length;b++){var C=S[b],x=l.value(h);C.startInsCode===x&&fne(e,t,C,h,p,n)}}}}var vne={U:or.atom_site_anisotrop.U,U_esd:or.atom_site_anisotrop.U_esd},Mu;(function(e){e.Schema=vne,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var a=e.Provider.get(n.firstModel);return!a||!Xr.is(n.firstModel.sourceData)?ca.Category.Empty:ca.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=Xs.create(e.Descriptor);function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var l=i[a.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(Mu||(Mu={}));var Of;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ce.Schema.Matrix(4,4,ce.Schema.float)},t),e.Descriptor=xo({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=a(u.firstModel);if(!l)return ca.Category.Empty;var c=kr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return ca.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=Xs.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function a(u){return e.Provider.get(u)}e.get=a;function i(u){if(!!Xr.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(!!l){var c=iJ(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=i;function o(u){if(!Xr.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=kr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return ca.Category.ofTable(c)}})}e.writeMmCif=s})(Of||(Of={}));function mne(e){if(!!Xr.is(e.sourceData))return kn.fromData(e.sourceData.data.db)}kn.Provider.formatRegistry.add("mmCIF",mne);function hne(e){if(!!Xr.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return ag.fromStruct(r,n,e.atomicHierarchy)}}ag.Provider.formatRegistry.add("mmCIF",hne);function gne(e){if(!!Xr.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=kr.ofColumns(Mu.Schema,t),n=Mu.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function yne(e){return Xr.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}Mu.Provider.formatRegistry.add("mmCIF",gne,yne);function bne(e){if(!!Xr.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:tg.getEntriesFromChemCompBond(t)}}}tg.Provider.formatRegistry.add("mmCIF",bne);function Sne(e){if(!!Xr.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=Du.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:Du.getAtomIndexFromEntries(r),entries:r}}}}Du.Provider.formatRegistry.add("mmCIF",Sne);Of.Provider.formatRegistry.add("mmCIF",Of.fromMmCif,Of.hasData);var Xr;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,a,i){return a||(a=Ol.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,frame:n,source:i}}}e.fromFrame=r})(Xr||(Xr={}));function T7(e){var t=Xr.fromFrame(e);return Fe.create("Create mmCIF Model",function(r){return Yl(t.data.db,t,r)})}function xne(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(I,M){return I===-1?w.setNaN(M):a(I,M)},c=w(),d=w(),f=w(),p=w(),v=w(),m=w(),h=w();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(i[b],p),l(s[b+1],v),w.squaredDistance(p,v)>6.25)continue e}var S=o[g-2],C=o[g],x=o[g+2],A=i[S],P=i[C],T=i[x];l(A,c),l(P,d),l(T,f),w.sub(m,c,d),w.sub(h,d,f);var D=Fs(w.angle(m,h));D&&D>70&&(r[g]|=32)}}var Cne=9,Sy=-27.888,wne=-.5,wM=-9.9;function _ne(e,t,r,n){var a=w.distance(e,n),i=w.distance(t,n),o=w.distance(t,r),s=w.distance(e,r),u=Sy/a-Sy/i,l=Sy/o-Sy/s,c=u+l;return c<wM?wM:c}function Ane(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],v=[],m=w(),h=w(),g=w(),y=w(),b=w(),S=w(),C=w(),x=0,A=n.length;x<A;++x){var P=x,T=n[x],D=s[P],I=a[P],M=c[T];if(!(D===-1||I===-1)&&u.findAtomOnResidue(T,"OXT")===-1){l(D,m),l(I,h),l(M,g);for(var B=r.find(g[0],g[1],g[2],Cne),U=B.indices,V=B.count,F=0;F<V;++F){var Y=U[F];if(!(Y===P||Y-1===P||Y+1===P)){var W=o[Y];if(W!==-1){l(W,y);var K=i[Y];if(K===-1){if(Y===0)continue;var $=Y-1,J=s[$],Z=a[$];if(J===-1||Z===-1)continue;l(J,C),l(Z,S),w.sub(b,S,C);var N=w.distance(C,S);w.scaleAndAdd(b,y,b,1/N)}else l(K,b);var j=_ne(m,h,y,b);j>wne||(f[f.length]=P,p[p.length]=Y,v[v.length]=j)}}}}}return Tne(d,f,p,v)}function Tne(e,t,r,n){for(var a=new eo.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}var Zt;(function(e){e.is=Xa.has,e.create=Xa.create})(Zt||(Zt={}));var xy=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function Pne(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+i+3)!==-1)if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=a[i+3]|64;else for(var u=0;u<=i+3;++u)n[o+u]|=a[i+3]|64}function Ene(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=Zt.create(r[l]),f=Zt.create(r[l-1]),p=Zt.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(Zt.is(d,1)||Zt.is(p,1))||u===5&&(Zt.is(d,1)||Zt.is(d,8)||Zt.is(p,1)||Zt.is(p,8)))continue}else if(u===4&&(Zt.is(d,8)||Zt.is(p,8))||u===5&&(Zt.is(d,1)||Zt.is(d,8)||Zt.is(p,1)||Zt.is(p,8)))continue;if(Zt.is(d,a[u])&&Zt.is(d,a[u-3])&&Zt.is(f,a[u])&&Zt.is(f,a[u-3]))if(e.params.oldDefinition)for(var v=0;v<u;v++)r[l+v]|=i[u];else for(var v=-1;v<=u;v++)r[l+v]|=i[u]}}function Ine(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function Dne(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?_M(e,t):_M(t,e):!1}function _M(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function Mne(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];Ine(s,a)&&(i=!0,s.firstEnd++,a.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];Dne(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function Rne(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=i[l],f=i[l+1];d<f;d++){var p=o[d];l>p||(s=l+1,u=p,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new xy(s,u,0)),s=l,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new xy(u,s,0)),s=l,u=p,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new xy(u,s,1)),s=l+1,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new xy(u,s,1)))}a.sort(function(v,m){return v.partner1>m.partner1?1:v.partner1<m.partner1?-1:0})}function AM(e){return Zt.is(e,8)||Zt.is(e,1)||Zt.is(e,16)}function One(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var o=a.firstStart-i,s=a.secondStart-o;a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!AM(r[i])&&Zt.is(r[i],4)&&(r[i]|=2),!AM(r[s])&&Zt.is(r[s],4)&&(r[s]|=2))}if(a.nextLadder!==0){for(var u=t[a.nextLadder],i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(a.type===0)for(var i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(var i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}function Bne(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,l=function(x,A){return x===-1?w.setNaN(A):i(x,A)},c=w(),d=w(),f=w(),p=w(),v=w(),m=w(),h=w(),g=w(),y=w();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],p),l(s[a[0]],v),l(n[0],m),l(r[1],h),l(s[a[1]],g),l(n[1],y);for(var C=0;C<u-1;++C)o.findAtomOnResidue(a[C],"OXT")===-1&&(b[C]=Fs(w.dihedralAngle(c,m,v,p)),S[C]=Fs(w.dihedralAngle(m,v,p,y)),c=p,d=v,f=m,p=h,v=g,m=y,l(r[C+1],h),l(s[a[C+1]],g),l(n[C+1],y));return{phi:b,psi:S}}function kne(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:a,z:i,indices:ze.ofSortedArray(s)};return jf(c,am(c))}function Lne(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),l=new Int32Array(a),c=0;c<a;++c){var d=n[r[c]];i[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:ze.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var Fne={oldDefinition:E.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:E.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function Nne(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x;return ie(this,function(A){for(r=Lne(e),n=r.residueIndices,a=kne(e,n),i=Ane(e,r,a),o=n.length,s=new Uint32Array(o),u=Bne(e,r),l=[],c=[],d=t.oldDefinition?Vne:Gne,f=t.oldOrdering?Hne:qne,p={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:l,bridges:c},Pne(p),Ene(p),xne(p),Rne(p),Mne(p),One(p),v=jne(s,d),m=new Uint32Array(o),h=[],g=[],y=function(P){return ze.indexOf(n,P)},b=0,S=n.length;b<S;++b)C=v[b],m[b]=C,x=d(s[b]),(g.length===0||x!==g[g.length-1].flags)&&(g[g.length]=Une(zne(C),s[b],d)),h[b]=g.length-1;return[2,A7(m,h,g,y)]})})}function Une(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function zne(e){return e===Tr.SecondaryStructureDssp.H||e===Tr.SecondaryStructureDssp.G||e===Tr.SecondaryStructureDssp.I?"helix":e===Tr.SecondaryStructureDssp.B||e===Tr.SecondaryStructureDssp.E?"sheet":e===Tr.SecondaryStructureDssp.T?"turn":e===Tr.SecondaryStructureDssp.S?"bend":"none"}function Vne(e){return Zt.is(e,1)?Tr.SecondaryStructureDssp.H:Zt.is(e,4)?Tr.SecondaryStructureDssp.E:Zt.is(e,2)?Tr.SecondaryStructureDssp.B:Zt.is(e,8)?Tr.SecondaryStructureDssp.G:Zt.is(e,16)?Tr.SecondaryStructureDssp.I:Zt.is(e,64)?Tr.SecondaryStructureDssp.T:Zt.is(e,32)?Tr.SecondaryStructureDssp.S:0}function Hne(e){return Zt.is(e,1)?"H":Zt.is(e,4)?"E":Zt.is(e,2)?"B":Zt.is(e,8)?"G":Zt.is(e,16)?"I":Zt.is(e,64)?"T":Zt.is(e,32)?"S":"-"}function Gne(e){return Zt.is(e,16)?Tr.SecondaryStructureDssp.I:Zt.is(e,1)?Tr.SecondaryStructureDssp.H:Zt.is(e,4)?Tr.SecondaryStructureDssp.E:Zt.is(e,2)?Tr.SecondaryStructureDssp.B:Zt.is(e,8)?Tr.SecondaryStructureDssp.G:Zt.is(e,64)?Tr.SecondaryStructureDssp.T:Zt.is(e,32)?Tr.SecondaryStructureDssp.S:0}function qne(e){return Zt.is(e,16)?"I":Zt.is(e,1)?"H":Zt.is(e,4)?"E":Zt.is(e,2)?"B":Zt.is(e,8)?"G":Zt.is(e,64)?"T":Zt.is(e,32)?"S":"-"}function jne(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=Zt.create(e[n]);r[n]=t(i)}return r}var Ed;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:_({},E.getDefaultValues(n.getParams(l))),data:bd.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:bd.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=E.clone(n.getParams(l));return E.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),se(a,void 0,void 0,function(){var p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),p=s(c.root).props,v=s(c),m=E.merge(n.defaultParams,p,d),v.data.value&&E.areEqual(n.defaultParams,v.props,m)?[2]:[4,n.obtain(l,c,m)];case 1:return h=b.sent(),g=h.value,y=h.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,m,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),p=E.merge(n.defaultParams,f.props,c);E.areEqual(n.defaultParams,f.props,p)||(u(l,p,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:E.Value(i,{isHidden:!0})};return t({label:mo(n),descriptor:xo({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:E.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return se(o,void 0,void 0,function(){return ie(this,function(d){return[2,_(_({},E.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(Ed||(Ed={}));function P7(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(zt.isFromPdbArchive(a)||zt.hasSecondaryStructure(a)){t="model";break}}}return{type:E.MappedStatic(t,{model:E.EmptyGroup({label:"Model"}),dssp:E.Group(Fne,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var TM=P7(),ls=Ed.createProvider({label:"Secondary Structure",descriptor:xo({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:TM,getParams:P7,isApplicable:function(e){return!0},obtain:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a,i,o;return ie(this,function(s){switch(s.label){case 0:switch(n=_(_({},E.getDefaultValues(TM)),r),a=n.type.name,a){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,Wne(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,Xne(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function Wne(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o;return ie(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?(i=e.unitSymmetryGroups[n].units[0],Be.isAtomic(i)&&!zt.isCoarseGrained(i.model)?[4,Nne(i,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function Xne(e){return se(this,void 0,void 0,function(){var t,r,n,a,i;return ie(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)a=e.unitSymmetryGroups[r].units[0],Be.isAtomic(a)&&(i=ag.Provider.get(a.model),i&&t.set(a.invariantId,i));return[2,t]})})}var Yne={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function gn(){throw new Error("Property only available for atomic models.")}function qu(e){throw e?new Error("Property only available for coarse models (".concat(e,").")):new Error("Property only available for coarse models.")}var Gh={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):gn()},occupancy:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):gn()},B_iso_or_equiv:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):gn()},sourceIndex:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):gn()},label_atom_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):gn()},auth_atom_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):gn()},label_alt_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):gn()},label_comp_id:jb,auth_comp_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):gn()},pdbx_formal_charge:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):gn()},vdw_radius:function(e){return Be.isAtomic(e.unit)?Eg(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):gn()}};function jb(e){return Be.isAtomic(e.unit)||gn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function kP(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):gn()}function Kne(e){Be.isAtomic(e.unit)||gn();var t=e.unit.model.sequence.byEntityKey[wi(e)];return t&&t.sequence.microHet.has(kP(e))}function PM(e){Be.isAtomic(e.unit)||gn();var t=e.unit.model.sequence.byEntityKey[wi(e)];return t?t.sequence.microHet.get(kP(e))||[jb(e)]:[jb(e)]}var Qne={key:function(e){return Be.isAtomic(e.unit)?e.unit.residueIndex[e.element]:gn()},group_PDB:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):gn()},label_seq_id:kP,auth_seq_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):gn()},pdbx_PDB_ins_code:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):gn()},isNonStandard:function(e){return Be.isAtomic(e.unit)?PM(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):gn()},hasMicroheterogeneity:Kne,microheterogeneityCompIds:PM,secondary_structure_type:function(e){var t;Be.isAtomic(e.unit)||gn();var r=(t=ls.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.type[r.getIndex(e.unit.residueIndex[e.element])]:536870912},secondary_structure_key:function(e){var t;Be.isAtomic(e.unit)||gn();var r=(t=ls.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.key[r.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:function(e){return Be.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(jb(e)).type:gn()}},Zne={key:function(e){return Be.isAtomic(e.unit)?e.unit.chainIndex[e.element]:gn()},label_asym_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):gn()},auth_asym_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):gn()},label_entity_id:function(e){return Be.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):gn()}},$ne={key:Gh.key,entityKey:function(e){return Be.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:qu()},x:Gh.x,y:Gh.y,z:Gh.z,asym_id:function(e){return Be.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):qu()},entity_id:function(e){return Be.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):qu()},seq_id_begin:function(e){return Be.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):qu()},seq_id_end:function(e){return Be.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):qu()},sphere_radius:function(e){return Be.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:qu("spheres")},sphere_rmsf:function(e){return Be.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:qu("spheres")},gaussian_weight:function(e){return Be.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:qu("gaussians")},gaussian_covariance_matrix:function(e){return Be.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:qu("gaussians")}};function wi(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var Jne={key:wi,id:function(e){return e.unit.model.entities.data.id.value(wi(e))},type:function(e){return e.unit.model.entities.data.type.value(wi(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(wi(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(wi(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(wi(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(wi(e))},details:function(e){return e.unit.model.entities.data.details.value(wi(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(wi(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(wi(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(wi(e))},subtype:function(e){return e.unit.model.entities.subtype.value(wi(e))},prd_id:function(e){var t,r;return(r=(t=e.unit.model.entities.prd_id)===null||t===void 0?void 0:t.value(wi(e)))!==null&&r!==void 0?r:""}},eae=[],tae={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return Be.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||nn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||eae},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},tt={constant:Yne,atom:Gh,residue:Qne,chain:Zne,entity:Jne,unit:tae,coarse:$ne},v0=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var a=this._find(t,n);return a?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=EM(t);if(!!this.index.has(a)){var i=this.index.get(a),o=IM(t);if(!!i.has(o))for(var s=i.get(o),u=DM(t),l=MM(t),c=RM(t),d=(r=OM(t))!==null&&r!==void 0?r:"1_555",f=0,p=s;f<p.length;f++){var v=p[f];if(!(v.label_comp_id!==u||v.label_alt_id!==l||v.ins_code!==c)&&!(this.checkOperator&&((n=v.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return v}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),"".concat(t.label_asym_id," ").concat(t.label_comp_id," ").concat(t.label_seq_id,":").concat(t.ins_code,":").concat(t.label_alt_id).concat(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:EM(t),label_comp_id:DM(t),label_seq_id:IM(t),label_alt_id:MM(t),ins_code:RM(t),operator_name:(r=OM(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((a=t.operator_name)!==null&&a!==void 0?a:"1_555")))return!0}return!1},e}(),EM=tt.chain.label_asym_id,IM=tt.residue.label_seq_id,DM=tt.atom.label_comp_id,MM=tt.atom.label_alt_id,RM=tt.residue.pdbx_PDB_ins_code,OM=tt.unit.operator_name;function im(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=Qt.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)ze.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function rae(e){return function(r){var n=e(r);if(ot.isSingleton(n))return ot.Singletons(r.inputStructure,im(r,r.inputStructure,n.structure));for(var a=new n4(r.inputStructure),i=0,o=n.structures;i<o.length;i++){var s=o[i];a.add(im(r,r.inputStructure,s))}return a.getSelection()}}function s4(e,t,r,n){for(var a=new CS(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,p=c.z,v=l.elements,m=0,h=v.length;m<h;m++){var g=v[m];i.findIntoBuilder(d(g),f(g),p(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?im(e,t,a.getStructure()):a.getStructure()}function BM(e,t,r,n){var a=new CS(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var p=f.conformation,v=p.x,m=p.y,h=p.z,g=f.elements,y=0,b=g.length;y<b;y++){var S=g[y];e.element.element=S;var C=o(e);i.findIntoBuilderWithRadius(v(S),m(S),h(S),C,u,l,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?im(e,t,a.getStructure()):a.getStructure()}function nae(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function aae(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function iae(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=_(_({},t),{elementRadius:t.elementRadius,elementRadiusClosure:nae(n,t.elementRadius),sourceMaxRadius:aae(n,t.elementRadius)});if(ot.isSingleton(a)){var o=BM(n,n.inputStructure,a.structure,i),s=ot.Singletons(n.inputStructure,o);return s}else{for(var u=new n4(n.inputStructure),l=0,c=a.structures;l<c.length;l++){var d=c[l];u.add(BM(n,n.inputStructure,d,i))}return u.getSelection()}}if(ot.isSingleton(a)){var o=s4(n,n.inputStructure,a.structure,t),s=ot.Singletons(n.inputStructure,o);return s}else{for(var u=new n4(n.inputStructure),f=0,p=a.structures;f<p.length;f++){var d=p[f];u.add(s4(n,n.inputStructure,d,t))}return u.getSelection()}}}function oae(e,t){return function(n){var a=e(n);if(ot.structureCount(a)===0)return a;var i=ot.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return ot.forEach(a,function(s,u){n.pushInputStructure(s),ot.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function sae(e,t){return function(n){var a=e(n);if(ot.structureCount(a)===0)return a;var i=t(n);if(ot.structureCount(i)===0)return ot.Empty(n.inputStructure);var o=ot.unionStructure(i),s=ot.UniqueBuilder(n.inputStructure);return ot.forEach(a,function(u,l){var c=h7(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function uae(e,t){return function(n){var a=e(n);if(ot.structureCount(a)===0)return a;var i=t(n);if(ot.structureCount(i)===0)return a;var o=ot.unionStructure(i),s=ot.UniqueBuilder(n.inputStructure);return ot.forEach(a,function(u,l){var c=MP(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function lae(e){return function(r){var n=ot.LinearBuilder(r.inputStructure);return n.add(ot.unionStructure(e(r))),n.getSelection()}}function cae(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),ot.forEach(a,function(C,x){n.element.structure=C;for(var A=0,P=C.units;A<P.length;A++){var T=P[A];n.element.unit=T;for(var D=T.elements,I=0,M=D.length;I<M;I++){n.element.element=D[I];var B=t(n),U=void 0;i.has(B)?U=i.get(B):(U=Vr.create(),i.set(B,U)),Vr.add(U,x,x)}}o[x]=n.inputStructure.subsetBuilder(!0),x%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var p=t(n);if(!!i.has(p))for(var v=i.get(p).array,m=0,h=v.length;m<h;m++)o[v[m]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=ot.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];g.add(S.getStructure())}return g.getSelection()}}function dae(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(r,0);return function(u){var l=ot.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),ot.forEach(c,function(d,f){var p=d;if(i)for(;;){var v=p.elementCount;if(p=kM(u,n,p),p.elementCount===v)break}else for(var m=0;m<o;m++)p=kM(u,n,p);l.add(p),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function kM(e,t,r){var n=fae(e,r);return t?im(e,e.inputStructure,n):n}function fae(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new CS(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){a.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)a.addElement(u.elements[l]);a.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,v=f.b,m=f.edgeProps,h=m.flags,g=m.order;i.setStructure(r),i.a.unit=d,i.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){a.addToUnit(u.id,u.elements[l]);for(var y=ze.indexOf(d.elements,u.elements[l]),b=p[y],S=p[y+1];b<S;b++){var C=v[b],x=d.elements[C];ze.has(u.elements,x)||a.has(u.id,x)||(i.aIndex=y,i.a.element=u.elements[l],i.bIndex=C,i.b.element=x,i.type=h[b],i.order=g[b],i.test(e,!0)&&a.addToUnit(u.id,x))}}for(var A=0,P=n.getConnectedUnits(d.id);A<P.length;A++)for(var T=P[A],D=t.unitMap.get(T.unitB),I=r.unitMap.get(T.unitB),M=0,B=T.connectedIndices;M<B.length;M++){var U=B[M];if(!!ze.has(u.elements,d.elements[U]))for(var V=0,F=T.getEdges(U);V<F.length;V++){var Y=F[V],x=I.elements[Y.indexB];D&&ze.has(D.elements,x)||a.has(T.unitB,x)||(i.a.unit=d,i.aIndex=U,i.a.element=d.elements[U],i.b.unit=I,i.bIndex=Y.indexB,i.b.element=x,i.type=Y.props.flag,i.order=Y.props.order,i.test(e,!0)&&a.addToUnit(T.unitB,x))}}}return a.getStructure()}function pae(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=ot.unionStructure(t(i)),s=im(i,i.inputStructure,s4(i,i.inputStructure,o,{radius:r})),u=hae(i.inputStructure),l=gae(i.inputStructure),c=He.create(s),d=new Map,f=new v0({checkOperator:!0}),p=0,v=s.units;p<v.length;p++){var m=v[p];if(m.kind===0){c.unit=m;for(var h=m.elements,g=Qt.transientSegments(m.model.atomicHierarchy.chainAtomSegments,h),y=Qt.transientSegments(m.model.atomicHierarchy.residueAtomSegments,h);g.hasNext;){var b=g.move();c.element=h[b.start];var S=tt.chain.label_asym_id(c),C=tt.unit.operator_name(c);if(u.has(S)){d.has(S)?On(d.get(S),C):d.set(S,[C]);continue}var x=tt.entity.type(c);if(!(x==="water"||x==="polymer"))for(y.setSegment(b);y.hasNext;){var A=y.move();c.element=h[A.start],l.addComponent(v0.getEntryFromLocation(c),f)}}i.throwIfTimedOut()}}for(var P=i.inputStructure.subsetBuilder(!0),T=0,D=i.inputStructure.units;T<D.length;T++){var m=D[T];if(m.kind===0){c.unit=m;var h=m.elements,g=Qt.transientSegments(m.model.atomicHierarchy.chainAtomSegments,h),y=Qt.transientSegments(m.model.atomicHierarchy.residueAtomSegments,h);for(P.beginUnit(m.id);g.hasNext;){var b=g.move();c.element=h[b.start];var S=tt.chain.label_asym_id(c),C=tt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(C)>=0){P.addElementRange(h,b.start,b.end);continue}if(!!f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var A=y.move();c.element=h[A.start],!!f.has(c)&&P.addElementRange(h,A.start,A.end)}}P.commitUnit(),i.throwIfTimedOut()}}var I=ng(i.inputStructure,[P.getStructure(),o]);if(n){for(var M=new CS(i.inputStructure),B=i.inputStructure.lookup3d,U=0,V=I.units;U<V.length;U++){for(var m=V[U],F=m.conformation,Y=F.x,W=F.y,K=F.z,h=m.elements,$=0,J=h.length;$<J;$++){var Z=h[$];B.findIntoBuilderIf(Y(Z),W(Z),K(Z),r,M,mae),M.addToUnit(m.id,Z)}i.throwIfTimedOut()}return ot.Sequence(i.inputStructure,[M.getStructure()])}else return ot.Sequence(i.inputStructure,[I])}}var vae=tt.entity.type;function mae(e){return vae(e)==="water"}function hae(e){var t=e.models[0],r=new Set;if(!Xr.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}function gae(e){var t,r,n=e.models[0],a=new yae;if(!Xr.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,l=i.ptnr1_label_seq_id,c=i.ptnr1_symmetry,d=i.pdbx_ptnr1_label_alt_id,f=i.pdbx_ptnr1_PDB_ins_code,p=i.ptnr2_label_asym_id,v=i.ptnr2_label_comp_id,m=i.ptnr2_label_seq_id,h=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var C={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},x={label_asym_id:p.value(b),label_comp_id:v.value(b),label_seq_id:m.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=h.value(b))!==null&&r!==void 0?r:"1_555"};a.addEdge(C,x)}}return a}var yae=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=v0.getLabel(t),a=v0.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),On(this.edges.get(n),a),On(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=v0.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!a.has(d)&&(o.push(d),!i.has(d))){i.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(_(_({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}(),bae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",wholeResidues:rae,includeSurroundings:iae,querySelection:oae,intersectBy:sae,exceptBy:uae,union:lae,expandProperty:cae,includeConnected:dae,surroundingLigands:pae});function Sae(e,t,r,n,a,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Wb.check(e,t,r,n,a,i):Wb.check(e,r,t,n,a,i)}function xae(e,t,r,n,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Xb.check(e,t,r,n,a):Xb.check(e,r,t,n,a)}var Wb;(function(e){var t=w.zero();function r(o,s,u,l,c,d,f){var p=s.elements,v=s.conformation.position,m=t;o.element.unit=s;for(var h=!1,g=0,y=p.length;g<y;g++){var b=p[g];o.element.element=b;var S=Math.max(0,w.distance(u,v(b,m))-l-f(o));if(S<c)return 0;S<d&&(h=!0)}return h?1:2}function n(o,s,u,l,c,d,f){for(var p=s.units,v=!1,m=0,h=p.length;m<h;m++){var g=r(o,p[m],u,l,c,d,f);if(g===0)return 0;g===1&&(v=!0)}return v?1:2}e.toPoint=n;var a=w.zero();function i(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,p=!1;o.element.structure=s;for(var v=0,m=f.length;v<m;v++){var h=f[v],g=h.elements,y=h.conformation.position;o.element.unit=h;for(var b=0,S=g.length;b<S;b++){var C=g[b];o.element.element=C;var x=n(o,u,y(C,a),d(o),l,c,d);if(x===0)return 0;x===1&&(p=!0)}}return p}e.check=i})(Wb||(Wb={}));var Xb;(function(e){var t=w.zero();function r(o,s,u,l,c,d){var f=s.elements,p=s.conformation.position,v=t;o.element.unit=s;for(var m=0,h=f.length;m<h;m++){var g=f[m];if(o.element.element=g,Math.max(0,w.distance(u,p(g,v))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,p=0,v=f.length;p<v;p++)if(r(o,f[p],u,l,c,d))return!0;return!1}e.toPoint=n;var a=w.zero();function i(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var v=d[f];o.element.unit=v;for(var m=v.elements,h=v.conformation.position,g=0,y=m.length;g<y;g++){var b=m[g];if(o.element.element=b,n(o,u,h(b,a),c(o),l,c))return!0}}return!1}e.check=i})(Xb||(Xb={}));function Cae(e,t){return function(r){var n=e(r),a=ot.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),ot.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function wae(e){return function(t){var r=e(t),n=ot.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var a=r.structure.units[0],i=Ne.create([a.getChild(ze.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function LP(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,l=void 0;if(Be.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)a.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function _ae(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),ot.forEach(a,function(i,o){e.currentStructure=i,LP(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function Aae(e,t,r){return function(n){var a=e(n),i=_ae(n,t,r),o=ot.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),ot.forEach(a,function(s,u){n.currentStructure=s;var l=LP(n,r,new Set);Pn.isSuperset(l,i)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function Tae(e,t){return function(r){var n=ot.unionStructure(t(r)),a=ot.LinearBuilder(r.inputStructure);return ot.forEach(e(r),function(i,o){xS(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function Pae(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius=="undefined"?Eae(r):r.minRadius===0?Iae(r):Dae(r)}}function Eae(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=ot.unionStructure(n).lookup3d,s=ot.LinearBuilder(t.inputStructure),u=w.zero();return ot.forEach(r,function(l,c){for(var d=l.units,f=!1,p=0,v=d.length;p<v;p++){for(var m=d[p],h=m.elements,g=m.conformation,y=g.position,b=g.r,S=0,C=h.length;S<C;S++){var x=h[S];if(y(x,u),o.check(u[0],u[1],u[2],a+b(x))){f=!0;break}}if(f)break}i&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function Iae(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=ot.unionStructure(n),u=ot.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),ot.forEach(r,function(l,c){var d=xae(t,s,l,a,o);i&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function Dae(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=ot.unionStructure(n),l=ot.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),ot.forEach(r,function(c,d){var f=Sae(t,u,c,a,i,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function Mae(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(!!Be.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,p=f.offset,v=f.b,m=f.edgeProps,h=m.flags,g=m.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,C=d.elements,x=0,A=S.length;x<A;x++){var P=ze.indexOf(C,S[x]);o.a.unit=d,o.b.unit=d;for(var T=p[P],D=p[P+1];T<D;T++)if(o.b.element=d.elements[v[T]],!(i&&ze.has(c.elements,o.b.element))&&!!a.hasElement(o.b)&&(o.aIndex=P,o.a.element=S[x],o.bIndex=v[T],o.type=h[T],o.order=g[T],o.test(r,!0)))return!0;for(var I=0;I<b;I++)for(var M=y[I],B=n.unitMap.get(M.unitB),U=B.elements,V=M.getEdges(P),F=0,Y=V.length;F<Y;F++){var W=V[F];if(o.b.unit=B,o.b.element=U[W.indexB],!!a.hasElement(o.b)&&!(i&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=P,o.a.element=S[x],o.bIndex=W.indexB,o.type=W.props.flag,o.order=W.props.order,o.test(r,!0)))return!0}}}return!1}function Rae(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(ot.isEmpty(s))return s;var u=t(o);if(ot.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:ot.unionStructure(s)},c=ot.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),ot.forEach(u,function(d,f){(Mae(l,d)||a)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}var Oae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",pick:Cae,first:wae,getCurrentStructureProperties:LP,withSameAtomProperties:Aae,areIntersectedBy:Tae,within:Pae,isConnectedTo:Rae});function Bae(e){return e.length===0?RP:e.length===1?e[0]:function(t){for(var r=ot.UniqueBuilder(t.inputStructure),n=function(i){ot.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function kae(e){return e.length===0?RP:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var a=0,i=ot.structureCount(r[0]),n=1;n<r.length;n++){var o=ot.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=bP(function(c){return c.hashCode},Ne.areUnitIdsAndIndicesEqual);ot.forEach(r[a],function(c){return s.add(c)});for(var u=ot.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==a&&(ot.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}var Lae=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",merge:Bae,intersect:kae}),u4;(function(e){function t(f){return!!f&&!!f.has}function r(f,p){return function(v){return f(v)===p}}e.eq=r;function n(f,p){return function(v){return f(v)<p}}e.lt=n;function a(f,p){return function(v){return f(v)<=p}}e.lte=a;function i(f,p){return function(v){return f(v)>p}}e.gt=i;function o(f,p){return function(v){return f(v)>=p}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,p){if(t(p))return function(h){return p.has(f(h))};if(p.length===0)return u;for(var v=new Set,m=0;m<p.length;m++)v.add(p[m]);return function(h){return v.has(f(h))}}e.inSet=l;function c(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var v=f[0],m=f[1];return function(K){return v(K)&&m(K)}}case 3:{var h=f[0],g=f[1],y=f[2];return function(K){return h(K)&&g(K)&&y(K)}}case 4:{var b=f[0],S=f[1],C=f[2],x=f[3];return function(K){return b(K)&&S(K)&&C(K)&&x(K)}}case 5:{var A=f[0],P=f[1],T=f[2],D=f[3],I=f[4];return function(K){return A(K)&&P(K)&&T(K)&&D(K)&&I(K)}}case 6:{var M=f[0],B=f[1],U=f[2],V=f[3],F=f[4],Y=f[5];return function(K){return M(K)&&B(K)&&U(K)&&V(K)&&F(K)&&Y(K)}}default:{var W=f.length;return function(K){for(var $=0;$<W;$++)if(!f[$])return!1;return!0}}}}e.and=c;function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var v=f[0],m=f[1];return function(K){return v(K)||m(K)}}case 3:{var h=f[0],g=f[1],y=f[2];return function(K){return h(K)||g(K)||y(K)}}case 4:{var b=f[0],S=f[1],C=f[2],x=f[3];return function(K){return b(K)||S(K)||C(K)||x(K)}}case 5:{var A=f[0],P=f[1],T=f[2],D=f[3],I=f[4];return function(K){return A(K)||P(K)||T(K)||D(K)||I(K)}}case 6:{var M=f[0],B=f[1],U=f[2],V=f[3],F=f[4],Y=f[5];return function(K){return M(K)||B(K)||U(K)||V(K)||F(K)||Y(K)}}default:{var W=f.length;return function(K){for(var $=0;$<W;$++)if(f[$])return!0;return!1}}}}e.or=d})(u4||(u4={}));var Hr={generators:dre,filters:Oae,modifiers:bae,combinators:Lae,pred:u4,internal:ere},wu;(function(e){function t(c,d){var f=this;return Fe.create("Build Assembly",function(p){return se(f,void 0,void 0,function(){var v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B;return ie(this,function(U){if(v=c.models,v.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(m=rg.findAssembly(v[0],d),!m)throw new Error("Assembly '".concat(d,"' is not defined."));for(h=nn.create(m.id,oe.identity(),{assembly:{id:m.id,operId:0,operList:[]}}),g=Ne.Builder({coordinateSystem:h,label:c.label,dynamicBonds:c.dynamicBonds}),y=new Co(c),b=0,S=m.operatorGroups;b<S.length;b++)if(C=S[b],x=C.selector(y),ot.structureCount(x)!==0)for(A=ot.unionStructure(x).units,P=0,T=C.operators;P<T.length;P++)for(D=T[P],I=0,M=A;I<M.length;I++)B=M[I],g.addWithOperator(B,D);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var p=this;return Fe.create("Build Symmetry Assembly",function(v){return se(p,void 0,void 0,function(){var m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y,W,K,$,J,Z,N;return ie(this,function(j){if(m=c.models,m.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(h=w(),g=Ne.Builder({label:c.label,representativeModel:m[0],dynamicBonds:c.dynamicBonds}),y=new Co(c),b=0,S=d;b<S.length;b++)if(C=S[b],x=Fae(C.asymIds),A=x(y),ot.structureCount(A)!==0)for(P=ot.unionStructure(A).units,T=0,D=C.operators;T<D.length;T++)for(I=D[T],M=I.index,B=I.shift,U=B[0],V=B[1],F=B[2],Y=E7(f,M,U,V,F,h),W=0,K=P;W<K.length;W++)for($=K[W],J=0,Z=Y;J<Z.length;J++)N=Z[J],g.addWithOperator($,N);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return Fe.create("Find Symmetry Mates",function(f){return Vae(f,c,d)})}e.builderSymmetryMates=n;function a(c,d,f){return Fe.create("Build Symmetry",function(p){return zae(p,c,d,f)})}e.buildSymmetryRange=a;function i(c){return Fe.create("Build NCS",function(d){return Uae(d,c)})}e.buildNcs=i;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&ze.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return mY(Be.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,p=c.units;f<p.length;f++){var v=p[f];d.add(v.id,v)}for(var m=[],h=0,g=d.groups;h<g.length;h++){var y=g[h];m.push(Be.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return m}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,p=c.length;f<p;++f){var v=c[f].units,m=d[f].units;if(v.length!==m.length||c[f].hashCode!==d[f].hashCode)return!1;for(var h=0,g=v.length;h<g;h++)if(v[h].conformation!==m[h].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(wu||(wu={}));function Fae(e){return Hr.generators.atoms({chainTest:Hr.pred.and(Hr.pred.eq(function(t){return tt.unit.operator_name(t.element)},nn.DefaultName),Hr.pred.inSet(function(t){return tt.chain.label_asym_id(t.element)},e))})}function E7(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=w.transformMat4(w(),i,l),d=ss.getSymmetryOperatorRef(o,t,r,n,a,c);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var v=s[f],m=oe.mul(oe(),d.matrix,v.matrix),h=nn.create("".concat(d.name," ").concat(v.name),m,{assembly:d.assembly,ncsId:v.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(h)}else u.push(d);return u}function I7(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=ss.getSymmetryOperator(a,0,0,0,0));for(var u=0;u<a.operators.length;u++)for(var l=t[0];l<=r[0];l++)for(var c=t[1];c<=r[1];c++)for(var d=t[2];d<=r[2];d++)!o&&u===0&&l===0&&c===0&&d===0||s.push.apply(s,E7(e,u,l,c,d,n));return s}function Nae(e,t){return e._operators_333&&w.equals(t,e._operators_333.ref)||(e._operators_333={ref:w.clone(t),operators:I7(e,w.create(-3,-3,-3),w.create(3,3,3),t)}),e._operators_333.operators}function D7(e,t){for(var r=Ne.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function Uae(e,t){return se(this,void 0,void 0,function(){var r,n,a;return ie(this,function(i){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=kn.Provider.get(r[0]),n?(a=n.ncsOperators,!a||!a.length?[2,t]:[2,D7(t,a)]):[2,t]})})}function zae(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u;return ie(this,function(l){if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=kn.Provider.get(a[0]),i?(o=i.spacegroup,Ri.isZero(o.cell)?[2,t]:(s=zt.getCenter(a[0]),u=I7(i,r,n,s),[2,D7(t,u)])):[2,t]})})}function Vae(e,t,r){return se(this,void 0,void 0,function(){function n(D,I){return"".concat(D.invariantId,"|").concat(I.name)}var a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P,T;return ie(this,function(D){switch(D.label){case 0:if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=kn.Provider.get(a[0]),i?(o=i.spacegroup,Ri.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=zt.getCenter(a[0]),u=Nae(i,s),l=t.lookup3d,c=new Set,d=Ne.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),f=t.units,p=w.zero(),v=0,m=u,D.label=3;case 3:if(!(v<m.length))return[3,6];for(h=m[v],g=0,y=f;g<y.length;g++)for(b=y[g],S=b.lookup3d.boundary.sphere,w.transformMat4(p,S.center,h.matrix),C=l.findUnitIndices(p[0],p[1],p[2],S.radius+r),x=0,A=C.count;x<A;x++)P=f[C.indices[x]],!!P.lookup3d.check(p[0],p[1],p[2],S.radius+r)&&(T=n(b,h),c.has(T)||(d.addWithOperator(b,h),c.add(T)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return v++,[3,3];case 6:return[2,d.getStructure()]}})})}var Hae=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=us.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return Ne.Empty;var r=[];Ns(this.ids);for(var n=wu.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||Ns(u),u=ze.deduplicate(ze.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&Ns(u);var d=s.getChild(ze.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return Ne.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function LM(e,t){for(var r=1;t--;)r*=e--;return r}function Gae(e,t){return t>e?0:LM(e,t)/LM(t,t)}function qae(e){var t=e&-e,r=e+t,n=r&-r,a=(n/t>>1)-1;return r|a}var jae=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=Gae(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=qae(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function M7(e,t){for(var r=[],n=new jae(e,t);n.hasNext;)r.push(n.move().slice());return r}var Gd=[],Wae={links:Gd,terminalLinks:Gd,elements:Gd,partialElements:Gd,getElementIndices:function(){return Gd},getLinkIndices:function(){return Gd},getTerminalLinkIndices:function(){return Gd}},aa=gp("C"),qh=gp("O"),Xae=[Ko.elementFingerprint([aa,aa,aa,qh]),Ko.elementFingerprint([aa,aa,aa,aa,qh]),Ko.elementFingerprint([aa,aa,aa,aa,aa,qh]),Ko.elementFingerprint([aa,aa,aa,aa,aa,aa,qh])];function Yae(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,p=0,v=t.length;p<v;++p){var m=o[t[p]];if(u.value(m)===aa){for(var h=0,g=0,y=f[t[p]],b=f[t[p]+1];y<b;++y){var S=o[d[y]],C=u.value(S);C===qh?++h:C===aa&&++g}if(h===2){r=m;break}else h===1&&g===1?n=m:l.value(m).startsWith("C1")?a=m:i=m}}return r!==-1?r:n!==-1?n:a!==-1?a:i!==-1?i:o[t[0]]}function Kae(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function Qae(e,t,r,n){var a=t.conformation.position;return w.normalize(e,w.sub(e,n,a(r,e))),e}function FM(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function Zae(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,a=new Set,i=M7(is(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],l=n[t[u[0]]],c=n[t[u[1]]];ze.areIntersecting(l,c)&&Ko.getAltId(r,l)===Ko.getAltId(r,c)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){for(var d=[],o=0,s=t.length;o<s;++o)a.has(t[o])||d.push(t[o]);return d}else return t}}function $ae(e,t){return t.properties.saccharideComponentMap.get(e)}function Jae(e){if(e.models.reduce(function(ve,ge){return ve+ge.properties.saccharideComponentMap.size},0)===0)return Wae;var t=[],r=[],n=[],a=[],i=new Map;function o(ve,ge,Se){return"".concat(ve,"|").concat(ge,"|").concat(Se)}function s(ve,ge){i.has(ve)?i.get(ve).push(ge):i.set(ve,[ge])}function u(ve,ge){w.sub(n[ve].geometry.direction,n[ge].geometry.center,n[ve].geometry.center),w.normalize(n[ve].geometry.direction,n[ve].geometry.direction)}var l=w.zero();function c(ve,ge,Se){var ae=Se.conformation.position,re=n[ve].geometry;w.sub(re.direction,ae(Se.elements[ge],l),re.center),w.normalize(re.direction,re.direction)}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];if(!!Be.isAtomic(p))for(var v=p.model,m=p.rings,h=v.atomicHierarchy,g=h.chainAtomSegments,y=h.residueAtomSegments,b=h.atoms,S=b.label_comp_id,C=Qt.transientSegments(g,p.elements),x=Qt.transientSegments(y,p.elements),A=void 0;C.hasNext;)for(x.setSegment(C.move());x.hasNext;){var P=x.move().index,T=$ae(S.value(y.offsets[P]),v);if(!!T){A||(A=Hb.byFingerprintAndResidue(m,Xae));var D=Zae(m,A.get(P));if(!D||!D.length){a.push({unit:p,residueIndex:P,component:T});continue}for(var I=[],M=0,B=D.length;M<B;++M){var U=m.all[D[M]],V=Yae(p,U),F=Td.calculateMomentsAxes(p7(p,U)),Y=w.copy(w.zero(),F.origin),W=w.copy(w.zero(),F.dirC),K=Qae(w.zero(),p,V,Y);w.orthogonalize(K,W,K);var $=Ko.getAltId(p,U),J=n.length;I.push(J),s(o(P,p.id,$),J),$&&s(o(P,p.id,""),J),n.push({geometry:{center:Y,normal:W,direction:K},component:T,ringIndex:D[M],altId:$,unit:p,residueIndex:P})}for(var Z=M7(is(new Array(D.length)),2),M=0,B=Z.length;M<B;++M){var N=Z[M],j=m.all[D[N[0]]],L=m.all[D[N[1]]];if(eo.areVertexSetsConnected(p.bonds,j,L,3)){var H=I[N[0]],G=I[N[1]];n[H].altId===n[G].altId&&(u(H,G),u(G,H),t.push({carbohydrateIndexA:H,carbohydrateIndexB:G}),t.push({carbohydrateIndexA:G,carbohydrateIndexB:H}))}}}}}function q(ve,ge){return i.get(o(ve.getResidueIndex(ge),ve.id,Kae(ve,ge)))||[]}for(var d=0,f=n.length;d<f;++d)for(var X=n[d],p=X.unit,M=d+1;M<f;++M){var Q=n[M];if(!(p!==Q.unit||X.residueIndex===Q.residueIndex)){var ue=p.rings.all[X.ringIndex],le=p.rings.all[Q.ringIndex];eo.areVertexSetsConnected(p.bonds,ue,le,3)&&(u(d,M),u(M,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:M}),t.push({carbohydrateIndexA:M,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];!Be.isAtomic(p)||e.interUnitBonds.getConnectedUnits(p.id).forEach(function(ae){ae.connectedIndices.forEach(function(re){ae.getEdges(re).forEach(function(O){var z=O.props,de=O.indexB;if(!!vr.isCovalent(z.flag)){var me=e.unitMap.get(ae.unitA),ye=e.unitMap.get(ae.unitB),Te=q(me,re),Oe=q(ye,de);if(Te.length>0&&Oe.length>0)for(var Ue=Te.length,Qe=Oe.length,Ge=0,Je=Math.max(Ue,Qe);Ge<Je;++Ge){var Ze=Te[Math.min(Ge,Ue-1)],rt=Oe[Math.min(Ge,Qe-1)],et=FM(me,re);(et.startsWith("O1")||et.startsWith("C1"))&&u(Ze,rt),t.push({carbohydrateIndexA:Ze,carbohydrateIndexB:rt})}else if(Oe.length===0)for(var St=0,De=Te;St<De.length;St++){var Ze=De[St],et=FM(me,re);(et.startsWith("O1")||et.startsWith("C1"))&&c(Ze,de,ye),r.push({carbohydrateIndex:Ze,elementIndex:de,elementUnit:ye,fromCarbohydrate:!0})}else if(Te.length===0)for(var Ie=0,je=Oe;Ie<je.length;Ie++){var rt=je[Ie];r.push({carbohydrateIndex:rt,elementIndex:re,elementUnit:me,fromCarbohydrate:!1})}}})})})}return _({links:t,terminalLinks:r,elements:n,partialElements:a},eie(n,t,r))}function eie(e,t,r){function n(B,U){return Jo(B.id,U)}function a(B,U,V){var F=[],Y=B.get(n(U,V));if(Y!==void 0)for(var W=0,K=Y;W<K.length;W++){var $=K[W];On(F,$)}return F}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),m=i.get(v);m===void 0?i.set(v,[o]):m.push(o)}function h(B,U){return a(i,B,U)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),m=g.get(v);m===void 0?g.set(v,[o]):m.push(o)}function S(B,U){return a(g,B,U)}for(var C=new Map,o=0,s=r.length;o<s;++o){var x=r[o],A=x.fromCarbohydrate,P=x.carbohydrateIndex,T=x.elementUnit,D=x.elementIndex;if(A)for(var I=e[P],l=I.unit,c=I.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),m=C.get(v);m===void 0?C.set(v,[o]):m.push(o)}else{var v=n(T,T.elements[D]),m=C.get(v);m===void 0?C.set(v,[o]):m.push(o)}}function M(B,U){return a(C,B,U)}return{getElementIndices:h,getLinkIndices:S,getTerminalLinkIndices:M}}var Cy=Me(),tie=new To("14"),rie=new To("98");function nie(e){return e>500?tie:rie}function aie(e){var t=e.units,r=nie(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Me.transform(Cy,o.sphere,s.matrix),r.includeSphere(Cy))}r.finishedIncludeStep();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Me.transform(Cy,o.sphere,s.matrix),r.radiusSphere(Cy))}return{box:r.getBox(),sphere:r.getSphere()}}var Ne=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i==null?void 0:i.child,this._target=i==null?void 0:i.target,this._proxy=void 0}return e.prototype.subsetBuilder=function(t){return new Hae(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Ot.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Nu),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=fie(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=pie(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=vie(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=die(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=mie(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return zt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=vi(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*t+a.id|0,t=31*t+ze.hashCode(a.elements)|0}return t=31*t+this.elementCount|0,t=I8(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){var t;return(t=this.state.parent)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=aie(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new Xte(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=dte(this,{ignoreWater:!this.dynamicBonds}),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dynamicBonds",{get:function(){return this.state.dynamicBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=wu.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=Be.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=Jae(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=oie(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=sie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=uie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=lie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=cie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Be.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Be.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Be.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Be.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=hie(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?ze.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=this.state,n=r.dynamicBonds,a=r.interUnitBonds,i=r.parent,o=[],s=0,u=this.unitSymmetryGroups;s<u.length;s++){var l=u[s],c=l.units[0].remapModel(t,n);o.push(c);for(var d=1,f=l.units.length;d<f;++d){var p=l.units[d];o.push(p.remapModel(t,n,c.props))}}return e.create(o,{parent:i==null?void 0:i.remapModel(t),label:this.label,interUnitBonds:n?void 0:a,dynamicBonds:n})},e.prototype.asParent=function(){if(this._proxy)return this._proxy;if(this.parent){var t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,_(_({},r.state),{dynamicBonds:this.dynamicBonds}),{child:this,target:this.parent})}else this._proxy=this;return this._proxy},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function iie(e,t,r){return e[t].id-e[r].id}function oie(e){for(var t=e.units,r=Vr.create(),n=0,a=t;n<a.length;n++){var i=a[n];Vr.add(r,i.model.id,i.model)}return r.array}function sie(e){for(var t=tt.residue.microheterogeneityCompIds,r=new Set,n=He.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Be.isAtomic(s)){var u=Qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var p=f[d];r.add(p)}}}}return r}function uie(e){for(var t=tt.atom.type_symbol,r=new Set,n=He.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Be.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function lie(e){for(var t=e.units,r=He.create(e),n=Vr.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=o.kind===0?tt.entity.key:tt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=Qt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);Vr.add(n,d,d)}}return Ns(n.array),n.array}function cie(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,a=0,i=n;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Be.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=Vr.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=Qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();Vr.add(u,c.index,c.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var v=p[f],m=t.get(v).array;Ns(m),d.set(v,m)}return d}function die(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}function fie(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}function pie(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}function vie(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}function mie(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(!!Be.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function hie(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){a[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var p=u+d;i[p]=s,o[p]=c[d]}u+=c.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(v,m){return a[n.get(v.id)]+Ee.indexOf(v.elements,m)}}}(function(e){e.Empty=u([]);function t(L){return{kind:"structure-loci",structure:L}}e.Loci=t;function r(L){for(var H=[],G=0,q=L.units;G<q.length;G++){var X=q[G];H.push({unit:X,indices:Ce.ofBounds(0,X.elements.length)})}return xe(L,H)}e.toStructureElementLoci=r;function n(L,H){return ot.toLociWithSourceUnits(ot.Singletons(L,H))}e.toSubStructureElementLoci=n;function a(L){return!!L&&L.kind==="structure-loci"}e.isLoci=a;function i(L,H){return L.structure===H.structure}e.areLociEqual=i;function o(L){return L.structure.isEmpty}e.isLociEmpty=o;function s(L,H){return H===L.structure?L:t(H)}e.remapLoci=s;function u(L,H){H===void 0&&(H={});for(var G=us.Mutable(),q=us.Mutable(),X=0,Q=!0,ue=L.length>0?L[0].id:0,le=0,ve=L.length;le<ve;le++){var ge=L[le];G.set(ge.id,ge),X+=ge.elements.length,ge.id<ue&&(Q=!1),ue=ge.id}Q||E8(L,0,L.length,iie,xf);for(var le=0,ve=L.length;le<ve;le++)q.set(L[le].id,le);var Se={hashCode:-1,transformHash:-1,elementCount:X,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:nn.Default,label:""};return H.parent&&(Se.parent=H.parent.parent||H.parent),H.interUnitBonds&&(Se.interUnitBonds=H.interUnitBonds),H.dynamicBonds?Se.dynamicBonds=H.dynamicBonds:H.parent&&(Se.dynamicBonds=H.parent.dynamicBonds),H.coordinateSystem?Se.coordinateSystem=H.coordinateSystem:H.parent&&(Se.coordinateSystem=H.parent.coordinateSystem),H.label?Se.label=H.label:H.parent&&(Se.label=H.parent.label),H.masterModel?Se.masterModel=H.masterModel:H.parent&&(Se.masterModel=H.parent.masterModel),H.representativeModel?Se.representativeModel=H.representativeModel:H.parent&&(Se.representativeModel=H.parent.representativeModel),new e(L,G,q,Se)}e.create=u;function l(L,H){return se(this,void 0,void 0,function(){var G,q,X,Q,ue,le,ve,ge,Se,ae,re,O,z;return ie(this,function(de){switch(de.label){case 0:if(L.frameCount===0)return[2,e.Empty];G=[],q=void 0,X=0,Q=0,ue=L.frameCount,de.label=1;case 1:return Q<ue?[4,Fe.resolveInContext(L.getFrameAtIndex(Q),H)]:[3,4];case 2:for(le=de.sent(),q||(q=le),ve=c(le),ge=0,Se=ve.units.length;ge<Se;++ge)ae=ve.units[ge],re=ae.invariantId+X,O=ae.chainGroupId+X,z=Be.create(G.length,re,O,ae.traits,ae.kind,ae.model,ae.conformation.operator,ae.elements),G.push(z);X=G.length,de.label=3;case 3:return++Q,[3,1];case 4:return[2,u(G,{representativeModel:q,label:q.label})]}})})}e.ofTrajectory=l;function c(L,H){H===void 0&&(H={});for(var G=L.atomicHierarchy.chainAtomSegments,q=L.atomicHierarchy.index,X=L.atomicHierarchy.chains.auth_asym_id,Q=L.atomicChainOperatorMappinng,ue=new v(_({label:L.label},H)),le=0;le<G.count;le++){var ve=Q.get(le)||nn.Default,ge=G.offsets[le];Xf.chainResidueCount(L.atomicHierarchy,le),G.offsets[le+1]-G.offsets[le];var Se=!1;if(d(L,le))for(;le+1<G.count&&d(L,le+1);){var ae=Q.get(le),re=Q.get(le+1);if(ae!==re)break;Se=!0,le++}else for(;le+1<G.count&&G.offsets[le+1]-G.offsets[le]===1&&G.offsets[le+2]-G.offsets[le+1]===1;){var O=q.getEntityFromChain(le),z=q.getEntityFromChain(le+1);if(O!==z)break;var de=X.value(le),me=X.value(le+1);if(de!==me)break;var ae=Q.get(le),re=Q.get(le+1);if(ae!==re)break;Se=!0,le++}var ye=ze.ofBounds(ge,G.offsets[le+1]);ue.addUnit(0,L,ve,ye,Se?1:0)}var Te=L.coarseHierarchy;return Te.isDefined&&(Te.spheres.count>0&&f(ue,L,L.coarseHierarchy.spheres,1),Te.gaussians.count>0&&f(ue,L,L.coarseHierarchy.gaussians,2)),ue.getStructure()}e.ofModel=c;function d(L,H){var G=L.atomicHierarchy.index.getEntityFromChain(H);return L.entities.data.type.value(G)==="water"}function f(L,H,G,q){for(var X=G.chainElementSegments,Q=0;Q<X.count;Q++){var ue=ze.ofBounds(X.offsets[Q],X.offsets[Q+1]);L.addUnit(q,H,nn.Default,ue,0)}}function p(L,H){if(oe.isIdentity(H))return L;if(!oe.isRotationAndTranslation(H,nn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var G=[],q=0,X=L.units;q<X.length;q++){var Q=X[q],ue=Q.conformation.operator,le=nn.create(ue.name,H,ue);G.push(Q.applyOperator(Q.id,le))}var ve=L.coordinateSystem,ge=nn.compose(nn.create(ve.name,H,ve),ve);return u(G,{parent:L,coordinateSystem:ge})}e.transform=p;var v=function(){function L(H){H===void 0&&(H={}),this.props=H,this.units=[],this.invariantId=gi(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=w(),this.singleElementUnits=new Map}return L.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},L.prototype.endChainGroup=function(){this.inChainGroup=!1},L.prototype.addUnit=function(H,G,q,X,Q,ue){ue===void 0&&(ue=this.invariantId());var le=this.inChainGroup?this.chainGroupId:++this.chainGroupId,ve=Be.create(this.units.length,ue,le,Q,H,G,q,X);return this.add(ve)},L.prototype.add=function(H){if(H.elements.length===1){H.conformation.position(H.elements[0],this.p);var G=[H.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(G))return this.singleElementUnits.get(G);this.singleElementUnits.set(G,H)}return this.units.push(H),H},L.prototype.addWithOperator=function(H,G,q){return q===void 0&&(q=!1),this.add(H.applyOperator(this.units.length,G,q))},L.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(L.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),L}();e.StructureBuilder=v;function m(L){return L===void 0&&(L={}),new v(L)}e.Builder=m;function h(L){return L.hashCode}e.hashCode=h;function g(L){return eP(L.units.map(function(H){return Be.conformationId(H)}).join("|"))}e.conformationHash=g;function y(L,H){if(L===H)return!0;if(L.elementCount!==H.elementCount)return!1;var G=L.units.length;if(G!==H.units.length)return!1;for(var q=0;q<G;q++)if(L.units[q].id!==H.units[q].id)return!1;return!0}e.areUnitIdsEqual=y;function b(L,H){if(!y(L,H))return!1;for(var G=0,q=L.units.length;G<q;G++)if(!ze.areEqual(L.units[G].elements,H.units[G].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(L,H){if(L.hashCode!==H.hashCode)return!1;var G=L.models.length;if(G!==H.models.length)return!1;for(var q=0;q<G;q++)if(!zt.areHierarchiesEqual(L.models[q],H.models[q]))return!1;return!0}e.areHierarchiesEqual=S;function C(L,H){return L===H||L.hashCode===H.hashCode&&wu.areTransformGroupsEquivalent(L.unitSymmetryGroups,H.unitSymmetryGroups)}e.areEquivalent=C;function x(L,H){return C(L.root,H.root)}e.areRootsEquivalent=x;function A(L,H){return L.root===H.root}e.areRootsEqual=A;var P=function(){function L(H){this.structure=H,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=He.create(H),this.hasNext=H.elementCount>0,this.hasNext&&(this.elements=H.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=H.units[0])}return L.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},L.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},L}();e.ElementLocationIterator=P;var T=w();function D(L,H,G){for(var q=L.elements,X=L.conformation,Q=X.position,ue=X.r,le=T,ve=Number.MAX_VALUE,ge=0,Se=q.length;ge<Se;ge++){var ae=q[ge],re=w.distance(H,Q(ae,le))-G-ue(ae);re<ve&&(ve=re)}return ve}function I(L,H,G){for(var q=L.units,X=Number.MAX_VALUE,Q=0,ue=q.length;Q<ue;Q++){var le=q[Q],ve=D(le,H,G);ve<X&&(X=ve)}return X}e.minDistanceToPoint=I;var M=w();function B(L,H){if(L.elementCount===0||H.elementCount===0)return 0;for(var G=L.units,q=Number.MAX_VALUE,X=0,Q=G.length;X<Q;X++)for(var ue=G[X],le=ue.elements,ve=ue.conformation,ge=ve.position,Se=ve.r,ae=0,re=le.length;ae<re;ae++){var O=le[ae],z=I(H,ge(O,M),Se(O));z<q&&(q=z)}return q}e.distance=B;function U(L){return L.elementCount===1?"1 element":"".concat(L.elementCount," elements")}e.elementDescription=U;function V(L,H,G){return L.masterModel?H.model===G.model||H.model===L.masterModel||G.model===L.masterModel:H.model===G.model}e.validUnitPair=V;function F(L,H,G){var q=G.maxRadius,X=G.validUnit,Q=G.validUnitPair;if(!!L.units.some(function(de){return X(de)}))for(var ue=L.lookup3d,le=w(),ve=0,ge=L.units;ve<ge.length;ve++){var Se=ge[ve];if(!!X(Se)){var ae=Se.boundary.sphere;w.transformMat4(le,ae.center,Se.conformation.operator.matrix);for(var re=ue.findUnitIndices(le[0],le[1],le[2],ae.radius+q),O=0;O<re.count;O++){var z=L.units[re.indices[O]];!X(z)||Se.id>=z.id||!Q(Se,z)||(z.elements.length>=Se.elements.length?H(Se,z):H(z,Se))}}}}e.eachUnitPair=F;function Y(L,H){for(var G=H.chain,q=H.residue,X=H.atom,Q=He.create(L),ue=0,le=L.units;ue<le.length;ue++){var ve=le[ue];if(ve.kind===0){Q.unit=ve;for(var ge=ve.elements,Se=Qt.transientSegments(ve.model.atomicHierarchy.chainAtomSegments,ge),ae=Qt.transientSegments(ve.model.atomicHierarchy.residueAtomSegments,ge);Se.hasNext;){var re=Se.move();if(G&&(Q.element=ge[re.start],G(Q)),!(!q&&!X))for(ae.setSegment(re);ae.hasNext;){var O=ae.move();if(q&&(Q.element=ge[O.start],q(Q)),!!X)for(var z=O.start,de=O.end;z<de;z++)Q.element=ge[z],X(Q)}}}}}e.eachAtomicHierarchyElement=Y,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function W(L){return L.unitSymmetryGroups.filter(function(H){return H.units[0].polymerElements.length>0})}function K(L,H){var G=W(L);return G.length===1&&G[0].units.length>2&&G[0].units[0].polymerElements.length<H.fiberResidueCount}function $(L,H){var G=W(L);return G.length>=1&&G[0].units.length>H.highSymmetryUnitCount}var J;(function(L){L[L.Small=0]="Small",L[L.Medium=1]="Medium",L[L.Large=2]="Large",L[L.Huge=3]="Huge",L[L.Gigantic=4]="Gigantic"})(J=e.Size||(e.Size={}));function Z(L,H,G){H===void 0&&(H={}),G===void 0&&(G=1);var q=_(_({},e.DefaultSizeThresholds),H);return L.polymerResidueCount>=q.largeResidueCount*G?$(L,q)?J.Huge:J.Gigantic:K(L,q)||L.polymerResidueCount<q.smallResidueCount*G?J.Small:L.polymerResidueCount<q.mediumResidueCount*G?J.Medium:J.Large}e.getSize=Z,e.Index=Ed.createSimple("index","root");var N="__PrincipalAxes__";function j(L){if(L.currentPropertyData[N])return L.currentPropertyData[N];var H=xe.getPrincipalAxes(e.toStructureElementLoci(L));return L.currentPropertyData[N]=H,H}e.getPrincipalAxes=j})(Ne||(Ne={}));var gie=Xn.diff;function xe(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(G){return!!G&&G.kind==="element-loci"}e.is=t;function r(G,q){if(G.structure!==q.structure||G.elements.length!==q.elements.length)return!1;for(var X=0,Q=G.elements.length;X<Q;++X){var ue=G.elements[X],le=q.elements[X];if(ue.unit.id!==le.unit.id||!Ee.areEqual(ue.indices,le.indices))return!1}return!0}e.areEqual=r;function n(G){for(var q=0,X=G.elements;q<X.length;q++){var Q=X[q];if(Ee.size(Q.indices)>0)return!1}return!0}e.isEmpty=n;function a(G){return i(G)===G.structure.elementCount}e.isWholeStructure=a;function i(G){for(var q=0,X=0,Q=G.elements;X<Q.length;X++){var ue=Q[X].indices;typeof ue=="number"?q+=gie(ue):q+=ue.length}return q}e.size=i;function o(G){return e(G,G.units.map(function(q){return{unit:q,indices:Ee.ofBounds(0,q.elements.length)}}))}e.all=o;function s(G){return e(G,[])}e.none=s;function u(G,q){if(!n(G)){var X=G.elements[0].unit,Q=X.elements[Ee.getAt(G.elements[0].indices,0)];return q?(q.structure=G.structure,q.unit=G.elements[0].unit,q.element=Q,q):He.create(G.structure,X,Q)}}e.getFirstLocation=u;function l(G){return n(G)?G:e(G.structure,[{unit:G.elements[0].unit,indices:Ee.ofSingleton(Ee.start(G.elements[0].indices))}])}e.firstElement=l;function c(G){return n(G)?G:S(l(G))}e.firstResidue=c;function d(G){return n(G)?G:T(l(G))}e.firstChain=d;function f(G){for(var q=[],X=function(ve){var ge=ve.unit,Se=ve.indices,ae=new Int32Array(Ee.size(Se));Ee.forEach(Se,function(re,O){return ae[O]=ge.elements[re]}),q.push(ge.getChild(ze.ofSortedArray(ae)))},Q=0,ue=G.elements;Q<ue.length;Q++){var le=ue[Q];X(le)}return Ne.create(q,{parent:G.structure.parent})}e.toStructure=f;function p(G,q){if(q===G.structure)return G;var X=[];return G.elements.forEach(function(Q){if(!!q.unitMap.has(Q.unit.id)){var ue=q.unitMap.get(Q.unit.id),le=Ee.indexedIntersect(Q.indices,Q.unit.elements,ue.elements);Ee.size(le)>0&&X.push({unit:ue,indices:le})}}),e(q,X)}e.remap=p;function v(G,q){if(G.elements.length>q.elements.length)return v(q,G);if(e.isEmpty(G))return q;for(var X=new Map,Q=0,ue=G.elements;Q<ue.length;Q++){var le=ue[Q];X.set(le.unit.id,le.indices)}for(var ve=[],ge=0,Se=q.elements;ge<Se.length;ge++){var le=Se[ge];X.has(le.unit.id)?(ve[ve.length]={unit:le.unit,indices:Ee.union(X.get(le.unit.id),le.indices)},X.delete(le.unit.id)):ve[ve.length]=le}return X.forEach(function(ae,re){ve[ve.length]={unit:G.structure.unitMap.get(re),indices:ae}}),e(G.structure,ve)}e.union=v;function m(G,q){for(var X=new Map,Q=0,ue=q.elements;Q<ue.length;Q++){var le=ue[Q];X.set(le.unit.id,le.indices)}for(var ve=[],ge=0,Se=G.elements;ge<Se.length;ge++){var le=Se[ge];if(X.has(le.unit.id)){var ae=Ee.subtract(le.indices,X.get(le.unit.id));if(Ee.size(ae)===0)continue;ve[ve.length]={unit:le.unit,indices:ae}}else ve[ve.length]=le}return e(G.structure,ve)}e.subtract=m;function h(G,q){for(var X=new Map,Q=0,ue=G.elements;Q<ue.length;Q++){var le=ue[Q];X.set(le.unit.id,le.indices)}for(var ve=[],ge=0,Se=q.elements;ge<Se.length;ge++){var le=Se[ge];if(!!X.has(le.unit.id)){var ae=Ee.intersect(X.get(le.unit.id),le.indices);Ee.size(ae)!==0&&(ve[ve.length]={unit:le.unit,indices:ae})}}return e(G.structure,ve)}e.intersect=h;function g(G,q){if(G.elements.length>q.elements.length)return g(q,G);if(e.isEmpty(G))return e.isEmpty(q);for(var X=new Map,Q=0,ue=G.elements;Q<ue.length;Q++){var le=ue[Q];X.set(le.unit.id,le.indices)}for(var ve=0,ge=q.elements;ve<ge.length;ve++){var le=ge[ve];if(!!X.has(le.unit.id)&&Ee.areIntersecting(X.get(le.unit.id),le.indices))return!0}return!1}e.areIntersecting=g;function y(G,q){if(e.isEmpty(G))return e.isEmpty(q);for(var X=new Map,Q=0,ue=G.elements;Q<ue.length;Q++){var le=ue[Q];X.set(le.unit.id,le.indices)}for(var ve=!1,ge=0,Se=q.elements;ge<Se.length;ge++){var le=Se[ge];if(!!X.has(le.unit.id))if(Ee.isSubset(X.get(le.unit.id),le.indices))ve=!0;else return!1}return ve}e.isSubset=y;function b(G){return G.length>3&&ze.isRange(G)?Ce.ofRange(G[0],G[G.length-1]):ze.ofSortedArray(G)}function S(G,q){for(var X=[],Q=new Set,ue=0,le=G.elements;ue<le.length;ue++){var ve=le[ue];if(x(ve)){X[X.length]=ve;continue}if(ve.unit.kind===0){for(var ge=ve.unit.elements,Se=ve.unit.model.atomicHierarchy,ae=ve.unit.model.atomicHierarchy.atoms.label_alt_id,re=Se.residueAtomSegments,O=re.index,z=re.offsets,de=[],me=ve.indices,ye=Ee.size(me),Te=0;Te<ye;){Q.clear();var Oe=ge[Ee.getAt(me,Te)],Ue=O[Oe];for(Q.add(ae.value(Oe)),Te++;Te<ye;){var Qe=ge[Ee.getAt(me,Te)];if(O[Qe]!==Ue)break;Q.add(ae.value(Qe)),Te++}for(var Ge=Q.has(""),Je=z[Ue],Ze=z[Ue+1];Je<Ze;Je++){var rt=Ee.indexOf(ge,Je);if(rt>=0){var et=ae.value(Je);(!q||Ge||!et||Q.has(et))&&(de[de.length]=rt)}}}X[X.length]={unit:ve.unit,indices:b(de)}}else X[X.length]=ve}return e(G.structure,X)}e.extendToWholeResidues=S;function C(G){switch(G.kind){case 0:return G.model.atomicHierarchy.chainAtomSegments;case 1:return G.model.coarseHierarchy.spheres.chainElementSegments;case 2:return G.model.coarseHierarchy.gaussians.chainElementSegments}}function x(G){return G.unit.elements.length===Ee.size(G.indices)}function A(G,q,X){for(var Q=C(G).index,ue=G.elements,le=0,ve=0,ge=ue.length;ve<ge;ve++){var Se=ue[ve],ae=Q[Se];!q.has(ae)||le++}if(le===G.elements.length){X[X.length]={unit:G,indices:Ce.ofBounds(0,le)};return}var re=new Int32Array(le);le=0;for(var ve=0,ge=ue.length;ve<ge;ve++){var Se=ue[ve],ae=Q[Se];!q.has(ae)||(re[le++]=ve)}re.length>0&&(X[X.length]={unit:G,indices:b(re)})}function P(G,q,X,Q,ue){for(var le=C(G.elements[0].unit).index,ve=new Set,ge=q;ge<X;ge++)for(var Se=G.elements[ge],ae=Se.indices,re=Se.unit.elements,O=0,z=Ee.size(ae);O<z;O++)ve.add(le[re[Ee.getAt(ae,O)]]);if(Q)for(var de=G.elements[0].unit,me=0,ye=G.structure.units;me<ye.length;me++){var Te=ye[me];!Be.areSameChainOperatorGroup(Te,de)||A(Te,ve,ue)}else for(var ge=q;ge<X;ge++)A(G.elements[ge].unit,ve,ue)}function T(G){for(var q=[],X=0,Q=G.elements.length;X<Q;X++){var ue=G.elements[X];if(Be.Traits.is(ue.unit.traits,2)){for(var le=X;X<Q&&Be.areSameChainOperatorGroup(G.elements[X].unit,ue.unit);)X++;var ve=X;X--,P(G,le,ve,!0,q)}else x(ue)?q[q.length]=ue:P(G,X,X+1,!1,q)}return e(G.structure,q)}e.extendToWholeChains=T;function D(G){return"".concat(G.unit.model.id,"|").concat(tt.entity.id(G))}function I(G){for(var q=[],X=He.create(G.structure),Q=new Set,ue=G.structure.units,le=0,ve=G.elements.length;le<ve;le++){var ge=G.elements[le];X.unit=ge.unit,X.element=ge.unit.elements[0],Q.add(D(X))}for(var le=0,Se=ue.length;le<Se;++le){var ae=ue[le];if(X.unit=ae,X.element=ae.elements[0],Q.has(D(X))){var re=Ee.ofBounds(0,ae.elements.length);q[q.length]={unit:ae,indices:re}}}return e(G.structure,q)}e.extendToWholeEntities=I;function M(G){for(var q=[],X=new Set,Q=G.structure.units,ue=0,le=G.elements.length;ue<le;ue++){var ve=G.elements[ue];X.add(ve.unit.model.id)}for(var ue=0,ge=Q.length;ue<ge;++ue){var Se=Q[ue];if(X.has(Se.model.id)){var ae=Ee.ofBounds(0,Se.elements.length);q[q.length]={unit:Se,indices:ae}}}return e(G.structure,q)}e.extendToWholeModels=M;function B(G,q){for(var X=[],Q=0,ue=Ee.size(q);Q<ue;++Q)X.push(G[Ee.getAt(q,Q)]);return ze.ofSortedArray(X)}function U(G,q){return ze.isRange(G)&&ze.areEqual(G,q)?Ce.ofLength(G.length):b(ze.indicesOf(G,q))}function V(G){for(var q=[],X=new Map,Q=0,ue=G.elements.length;Q<ue;Q++){var le=G.elements[Q],ve=le.unit.model,ge=B(le.unit.elements,le.indices);X.has(ve)?X.set(ve,ze.union(ge,X.get(ve))):X.set(ve,ge)}for(var Q=0,Se=G.structure.units.length;Q<Se;++Q){var ae=G.structure.units[Q],ge=X.get(ae.model);if(!!ge){var re=U(ae.elements,ge);Ee.size(re)&&(q[q.length]={unit:ae,indices:re})}}return e(G.structure,q)}e.extendToAllInstances=V;function F(G){for(var q=[],X=new Set,Q=G.structure.units,ue=0,le=G.elements.length;ue<le;ue++){var ve=G.elements[ue];X.add(ve.unit.conformation.operator.name)}for(var ue=0,ge=Q.length;ue<ge;++ue){var Se=Q[ue];if(X.has(Se.conformation.operator.name)){var ae=Ee.ofBounds(0,Se.elements.length);q[q.length]={unit:Se,indices:ae}}}return e(G.structure,q)}e.extendToWholeOperators=F;var Y=new To("98"),W=w();function K(G,q){Y.reset();for(var X=0,Q=G.elements;X<Q.length;X++)for(var ue=Q[X],le=ue.indices,ve=ue.unit.conformation.position,ge=ue.unit.conformation.r,Se=ue.unit.elements,ae=0,re=Ee.size(le);ae<re;ae++){var O=Se[Ee.getAt(le,ae)];ve(O,W),q&&w.transformMat4(W,W,q),Y.includePositionRadius(W,ge(O))}Y.finishedIncludeStep();for(var z=0,de=G.elements;z<de.length;z++)for(var ue=de[z],le=ue.indices,ve=ue.unit.conformation.position,ge=ue.unit.conformation.r,Se=ue.unit.elements,ae=0,re=Ee.size(le);ae<re;ae++){var O=Se[Ee.getAt(le,ae)];ve(O,W),q&&w.transformMat4(W,W,q),Y.radiusPositionRadius(W,ge(O))}return{box:Y.getBox(),sphere:Y.getSphere()}}e.getBoundary=K;var $=w();function J(G,q,X){X===void 0&&(X=0);for(var Q=X,ue=0,le=G.elements;ue<le.length;ue++){for(var ve=le[ue],ge=ve.indices,Se=ve.unit.conformation.position,ae=ve.unit.elements,re=Ee.size(ge),O=0;O<re;O++){var z=ae[Ee.getAt(ge,O)];Se(z,$),w.toArray($,q,Q+O*3)}Q+=re*3}return q}e.toPositionsArray=J;function Z(G){var q=i(G),X=J(G,new Float32Array(3*q));return Td.ofPositions(X)}e.getPrincipalAxes=Z;function N(G){var q=0;G.forEach(function(ue){q+=i(ue)});var X=new Float32Array(3*q),Q=0;return G.forEach(function(ue){J(ue,X,Q),Q+=i(ue)*3}),Td.ofPositions(X)}e.getPrincipalAxesMany=N;function j(G,q){return Be.isAtomic(G)?G.model.atomicHierarchy.atomSourceIndex.value(q):q}function L(G){var q;if(e.isEmpty(G))return ne.struct.generator.empty();for(var X=G.structure.models,Q=new Map,ue=0,le=G.elements;ue<le.length;ue++){var ve=le[ue],ge=ve.indices,Se=ve.unit.elements,ae=ve.unit.conformation.operator.name,re=void 0;Q.has(ae)?re=Q.get(ae).xs:(re=Vr.create(),Q.set(ae,{modelLabel:ve.unit.model.label,modelIndex:ve.unit.model.modelNum,xs:re}));for(var O=0,z=Ee.size(ge);O<z;O++){var de=j(ve.unit,Se[Ee.getAt(ge,O)]);Vr.add(re,de,de)}}for(var me=[],ye=Q.keys();;){var Te=ye.next();if(Te.done)break;var ve=Q.get(Te.value);me.push(H(Te.value,ve.xs.array,X.length>1,ve.modelLabel,ve.modelIndex))}for(var Oe=new Map,O=0,Ue=me.length;O<Ue;++O){var Qe=me[O],Ge=pp(vi(Qe.atom.ranges),vi(Qe.atom.set)),ae="".concat(Ge,"|").concat(Qe.entity?Qe.entity.modelLabel+Qe.entity.modelIndex:"");Oe.has(ae)?(q=Oe.get(ae).chain.opName).push.apply(q,Qe.chain.opName):Oe.set(ae,Qe)}var Je=[];return Oe.forEach(function(Ze){var rt=Ze.atom,et=rt.ranges,St=rt.set,De=Ze.chain.opName,Ie=ne.struct.atomProperty.core.operatorName(),je=ne.struct.atomProperty.core.sourceIndex(),st=[];St.length>0&&(st[st.length]=ne.core.set.has([ne.core.type.set(St),je]));for(var pt=0,qe=et.length/2;pt<qe;pt++)st[st.length]=ne.core.rel.inRange([je,et[2*pt],et[2*pt+1]]);if(Ze.entity){var bt=Ze.entity,yt=bt.modelLabel,Dt=bt.modelIndex;Je.push(ne.struct.generator.atomGroups({"atom-test":st.length>1?ne.core.logic.or(st):st[0],"chain-test":De.length>1?ne.core.set.has([ne.core.type.set(De),Ie]):ne.core.rel.eq([Ie,De[0]]),"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.struct.atomProperty.core.modelLabel(),yt]),ne.core.rel.eq([ne.struct.atomProperty.core.modelIndex(),Dt])])}))}else Je.push(ne.struct.generator.atomGroups({"atom-test":st.length>1?ne.core.logic.or(st):st[0],"chain-test":De.length>1?ne.core.set.has([ne.core.type.set(De),Ie]):ne.core.rel.eq([Ie,De[0]])}))}),ne.struct.modifier.union([Je.length===1?Je[0]:ne.struct.combinator.merge(Je.map(function(Ze){return ne.struct.modifier.union([Ze])}))])}e.toExpression=L;function H(G,q,X,Q,ue){Ns(q);for(var le=[],ve=[],ge=0,Se=q.length;ge<Se;){var ae=ge;for(ge++;ge<Se&&q[ge-1]+1===q[ge];)ge++;var re=ge;if(re-ae>12)le[le.length]=q[ae],le[le.length]=q[re-1];else for(var O=ae;O<re;O++)ve[ve.length]=q[O]}return X?{atom:{set:ve,ranges:le},chain:{opName:[G]},entity:{modelLabel:Q,modelIndex:ue}}:{atom:{set:ve,ranges:le},chain:{opName:[G]}}}})(xe||(xe={}));var Bs;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:He.create(void 0),firstConformationLoc:He.create(void 0),firstResidueLoc:He.create(void 0),firstChainLoc:He.create(void 0),firstUnitLoc:He.create(void 0),firstStructureLoc:He.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,p=f.elements,v=Ee.size(d),m=new Map,h=new Map;if(v>0&&He.set(u.firstElementLoc,l,f,p[Ee.start(d)]),v===p.length)u.unitCount+=1,u.unitCount===1&&He.set(u.firstUnitLoc,l,f,p[Ee.start(d)]);else if(v===1){if(Be.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&He.set(u.firstElementLoc,l,f,p[Ee.start(d)])}else if(Be.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,C=0,x=function(){m.clear();var A=0,P=p[Ee.getAt(d,C)],T=y[P];for(r(m,S.value(P),1),++C,++A;C<v;){var D=p[Ee.getAt(d,C)];if(y[D]!==T)break;r(m,S.value(D),1),++C,++A}if(b[T+1]-b[T]===A)u.residueCount+=1,u.residueCount===1&&He.set(u.firstResidueLoc,l,f,b[T]);else{h.clear();for(var I=b[T],M=b[T+1];I<M;++I)r(h,S.value(I),1);h.get("")===m.get("")&&m.forEach(function(B,U){if(h.get(U)===B){if(U!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var V=b[T],F=b[T+1];V<F;++V)if(U===S.value(V)){He.set(u.firstConformationLoc,l,f,V);break}}A-=B}}),u.elementCount+=A}};C<v;)x();else u.elementCount+=v,u.elementCount===1&&He.set(u.firstElementLoc,l,f,p[Ee.start(d)])}function a(u,l,c){var d=c.indices,f=c.unit,p=Ee.size(d);if(p!==0){var v=f.elements;if(!Be.Traits.is(f.traits,1)){p===v.length&&(u.chainCount+=1,u.chainCount===1&&He.set(u.firstChainLoc,l,f,v[Ee.start(d)]));return}var m=Be.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:Be.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:Be.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!m){console.warn("StructureElement loci stats: unknown unit type");return}for(var h=m.index,g=m.offsets,y=0;y<p;){var b=0,S=v[Ee.getAt(d,y)],C=h[S];for(++y,++b;y<p;){var x=v[Ee.getAt(d,y)];if(h[x]!==C)break;++y,++b}g[C+1]-g[C]===b?(u.chainCount+=1,u.chainCount===1&&He.set(u.firstChainLoc,l,f,g[C])):p===1&&(u.elementCount+=1,u.elementCount===1&&He.set(u.firstElementLoc,l,f,S))}}}function i(u,l,c,d,f){var p=c[d],v=Be.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:Be.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:Be.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=v.index,h=v.offsets,g=new Map,y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,C=Ee.size(b);if(C!==0){var x=S.elements;if(!Be.Traits.is(S.traits,1)){var A=x[Ee.start(b)];r(g,m[A],x.length);continue}for(var P=0;P<C;){var T=0,A=x[Ee.getAt(b,P)],D=m[A];for(++P,++T;P<C;){var I=x[Ee.getAt(b,P)];if(m[I]!==D)break;++P,++T}r(g,D,T)}}}var M=-1;if(g.forEach(function(B,U){h[U+1]-h[U]===B&&(u.chainCount+=1,u.chainCount===1&&(M=U))}),!(M<0))for(var y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,C=Ee.size(b);if(C!==0)for(var x=S.elements,P=0;P<C;){var A=x[Ee.getAt(b,P)],D=m[A];if(D===M){He.set(u.firstChainLoc,l,S,A);return}}}}function o(u){var l=t();if(xe.isEmpty(u))return l;var c=!1;if(xe.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,p=d.indices;He.set(l.firstStructureLoc,u.structure,f,f.elements[Ee.min(p)])}}else for(var v=0,m=u.elements;v<m.length;v++){var h=m[v];n(l,u.structure,h),Be.Traits.is(h.unit.traits,2)?c=!0:a(l,u.structure,h)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var h=u.elements[g];if(!!Be.Traits.is(h.unit.traits,2)){for(var b=g;g<y&&Be.areSameChainOperatorGroup(u.elements[g].unit,h.unit);)g++;var S=g;g--,S-b===1?a(l,u.structure,h):i(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?He.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&He.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?He.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&He.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?He.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&He.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?He.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&He.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?He.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&He.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?He.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&He.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(Bs||(Bs={}));function yie(e){return Be.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function bie(e){return Be.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function Sie(e){return tt.entity.key(e)}ca.Field;ca.Encodings;ca.Field;ca.Category;ca.Category;ca.Category;var NM;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(NM||(NM={}));var UM;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(UM||(UM={}));var xie={molstar_atom_site_operator_mapping:{label_asym_id:ce.Schema.Str(),auth_asym_id:ce.Schema.Str(),operator_name:ce.Schema.Str(),suffix:ce.Schema.Str(),assembly_id:ce.Schema.Str(),assembly_operator_id:ce.Schema.Int(),symmetry_operator_index:ce.Schema.Int(),symmetry_hkl:ce.Schema.Vector(3),ncs_id:ce.Schema.Int()}},zM=function(e,t){return typeof t[e].operator.assembly=="undefined"?1:0},FC=function(e,t){return t[e].operator.spgrOp===-1?1:0};ca.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:zM}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:zM}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:FC}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:FC}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:FC}).getFields();function Cie(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=Ig(o.value(d));for(var f=new Int32Array(u),p=new Int32Array(u),v=new Int32Array(u),m=new Uint8Array(u),h=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=i.value(l[d]),S=n,C=void 0,x=void 0;if(g.has(b))C=g.get(b),x=y.get(b);else{var A=void 0;S.has(b)?A=S.get(b).type:(Cg||console.info("chemComp not found",b),A=t7(b)),C=Mm(A,b),x=ree(A,C),g.set(b,C),y.set(b,x)}m[d]=C,h[d]=x;var P=Kc(x,"trace"),T=r.findAtomsOnResidue(d,P);if(T===-1){var D=Kc(x,"coarseBackbone");T=r.findAtomsOnResidue(d,D),T===-1&&SS(C)&&(T=r.findElementOnResidue(d,gp("C")))}f[d]=T;var I=Kc(x,"directionFrom");p[d]=r.findAtomsOnResidue(d,I);var M=Kc(x,"directionTo");v[d]=r.findAtomsOnResidue(d,M)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:v,moleculeType:m,polymerType:h}}}function m0(e,t){return t?t.length===1?Jo(t.charCodeAt(0),e):t.length===2?Jo(t.charCodeAt(0),Jo(t.charCodeAt(1),e)):"".concat(e," ").concat(t):e}function wie(e,t,r,n){if(e.has(t)){var a=e.get(t);a.has(r)||a.set(r,n)}else{var a=new Map;e.set(t,a),a.set(r,n)}}function _ie(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function Aie(e,t,r){return{entities:e,segments:r,label_seq_id:ze.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var lh=o4.EmptyResidueKey(),Tie=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;arguments.length===1?i=t:(lh.label_entity_id=t,lh.label_asym_id=r,lh.auth_seq_id=n,lh.pdbx_PDB_ins_code=a,i=lh);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=m0(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=m0(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=m0(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=ze.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Xf.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=Xf.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id=="undefined"?NC(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):UC(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id=="undefined"?NC(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):UC(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n=="undefined"?NC(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):UC(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return Pie(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e.prototype.findElementOnResidue=function(t,r){return Eie(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)},e}();function NC(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function Pie(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}function UC(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function Eie(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function Iie(e,t,r){for(var n=Aie(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Ce.ofBounds(0,e.atoms._rowCount),p=Qt.transientSegments(r.chainAtomSegments,f);p.hasNext;){var v=p.move(),m=v.index,h=t.getEntityIndex(l.value(m));h<0&&_ie(l.value(m)),n.chain_index_entity_index[m]=h;var g=d.value(m),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(m);n.label_asym_id.has(b)||n.label_asym_id.set(b,h),wie(n.entity_index_label_asym_id,h,b,m);var S=new Map,C=new Map;n.chain_index_label_seq_id.set(m,S),n.chain_index_auth_seq_id.set(m,C);for(var x=Qt.transientSegments(r.residueAtomSegments,f,v);x.hasNext;){var A=x.move(),P=A.index,T=o.value(P),D=s.value(P);S.set(m0(i.value(P),D),P),C.set(m0(T,D),P),y.set(T,m)}}return new Tie(n)}function Die(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],a=[t],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!i.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(a[a.length]=c)}return{residues:n,chains:a}}function wy(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function Mie(e,t,r){var n=kr.ofColumns(ene,{type_symbol:ce.ofArray({array:ce.mapToArray(e.type_symbol,gp),schema:ce.Schema.Aliased(ce.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=kr.view(e,tne,r.residues),i=kr.view(e,rne,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;a.label_seq_id=ce.ofIntArray(o)}return kr.columnToArray(a,"label_seq_id",Int32Array),kr.columnToArray(a,"auth_seq_id",Int32Array),wy(n,"label_atom_id","auth_atom_id"),wy(n,"label_comp_id","auth_comp_id"),wy(a,"label_seq_id","auth_seq_id"),wy(i,"label_asym_id","auth_asym_id"),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}function Rie(e){return{id:Jr.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ce.ofConst(1,e._rowCount,ce.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function Oie(e,t){return kr.areEqual(e.chains,t.chains)&&kr.areEqual(e.residues,t.residues)&&kr.areEqual(e.atoms,t.atoms)}function Bie(e,t){var r=new Map;if(!Xr.is(t))return r;var n=tl(xie,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=nn.create(n.operator_name.value(o),oe.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:w.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);a.set("".concat(c).concat(l),{name:c,operator:u});var d=n.auth_asym_id.value(o);i.set("".concat(d).concat(l),d)}for(var f=e.chains,p=f.label_asym_id,v=f.auth_asym_id,m=new Array(p.rowCount),h=new Array(p.rowCount),o=0;o<p.rowCount;o++){var c=p.value(o),d=v.value(o);if(!a.has(c)){m[o]=c,h[o]=d;continue}var g=a.get(c),y=g.name,u=g.operator;r.set(o,u),m[o]=y,h[o]=i.get(d)||d}return e.chains.label_asym_id=ce.ofArray({array:m,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ce.ofArray({array:h,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function kie(e,t,r,n,a,i){var o=Die(e),s=Mie(e,t,o),u=Bie(s,a);if(i&&Oie(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:Qt.ofOffsets(o.residues,Ce.ofBounds(0,e._rowCount)),chainAtomSegments:Qt.ofOffsets(o.chains,Ce.ofBounds(0,e._rowCount))},c=Iie(s,r,l),d=Cie(s,l,c,n),f=_(_(_({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function R7(e,t,r,n,a,i){var o=kie(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=Rie(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var VM={chainKey:[],entityKey:[],findSequenceKey:function(){return-1},findChainKey:function(){return-1},getEntityFromChain:function(){return-1},count:0,entity_id:ce.Undefined(0,ce.Schema.str),asym_id:ce.Undefined(0,ce.Schema.str),seq_id_begin:ce.Undefined(0,ce.Schema.int),seq_id_end:ce.Undefined(0,ce.Schema.int),chainElementSegments:Qt.create([]),polymerRanges:Br.ofSortedRanges([]),gapRanges:Br.ofSortedRanges([])},l4;(function(e){e.Empty={isDefined:!1,spheres:VM,gaussians:VM}})(l4||(l4={}));function Lie(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function Fie(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function Nie(e,t,r){var n=e.getEntityIndex,a=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},i=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),p=f.elementIndices,v=f.seqRanges,m=Br.firstIntersectionIndex(v,Ee.ofSingleton(u));return m!==-1?p[m]:-1};return{findChainKey:a,findSequenceKey:i}}function Uie(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function HM(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),v=0;v<o;v++)f[v]=t.getEntityIndex(r.value(v)),f[v]<0&&Uie(r.value(v));for(var m=0;m<s.count;m++){var h=s.offsets[m],g=s.offsets[m+1],y=f[h];p[m]=y;for(var b=Fie(l,y),S=Lie(b,n.value(h),c),v=h;v<g;v++)d[v]=S;for(var C=[],x=[],v=h;v<g;v++){var A=a.value(v),P=i.value(v);C.push(v),x.push(A,P)}var T={elementIndices:C,seqRanges:Br.ofSortedRanges(x)};u.set(S,T)}var D=Nie(t,l,u),I=D.findChainKey,M=D.findSequenceKey,B=function(U){return p[U]};return{chainKey:d,entityKey:f,findSequenceKey:M,findChainKey:I,getEntityFromChain:B}}function GM(e,t){for(var r=[],n=[],a=Qt.transientSegments(e.chainElementSegments,Ce.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var p=o.value(f);f===u?(c=f,d=o.value(f)):i.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=p}return{polymerRanges:Br.ofSortedRanges(r),gapRanges:Br.ofSortedRanges(n)}}or.atom_site.label_comp_id,or.atom_site.label_seq_id,or.atom_site.pdbx_PDB_ins_code,or.atom_site.label_asym_id,or.atom_site.label_entity_id,or.atom_site.auth_atom_id,or.atom_site.auth_seq_id,or.atom_site.auth_asym_id;_(_({},or.chem_comp_bond),{molstar_protonation_variant:ce.Schema.Str()});var zie=_(_({},or.chem_comp),{type:ce.Schema.Aliased(ce.Schema.str)}),Pi={entry:or.entry,struct:or.struct,struct_asym:or.struct_asym,ihm_model_list:or.ihm_model_list,ihm_model_group:or.ihm_model_group,ihm_model_group_link:or.ihm_model_group_link,entity:or.entity,entity_poly:or.entity_poly,entity_poly_seq:or.entity_poly_seq,pdbx_entity_branch:or.pdbx_entity_branch,chem_comp:zie,pdbx_chem_comp_identifier:or.pdbx_chem_comp_identifier,atom_site:or.atom_site,ihm_sphere_obj_site:or.ihm_sphere_obj_site,ihm_gaussian_obj_site:or.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:or.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:or.pdbx_molecule};function yp(e){for(var t=Object.create(null),r=0,n=Object.keys(Pi);r<n.length;r++){var a=n[r];a in e?t[a]=e[a]:t[a]=kr.ofUndefinedColumns(Pi[a],0)}return t}var O7={hierarchy:l4.Empty,conformation:void 0};function Vie(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return O7;var a=qM(r),i=Hie(r),o=HM(a,e.entities),s=GM(a),u=qM(n),l=Gie(n),c=HM(u,e.entities),d=GM(u);return{hierarchy:{isDefined:!0,spheres:_(_(_({},a),o),s),gaussians:_(_(_({},u),c),d)},conformation:{id:Jr.create22(),spheres:i,gaussians:l}}}function Hie(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function Gie(e){for(var t=Pi.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=gr.toMat3(wn(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function qie(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++){var o=!e.areValuesEqual(a-1,a);o&&(n[n.length]=a)}return{chainElementSegments:Qt.ofOffsets(n,Ce.ofBounds(0,e.rowCount))}}function qM(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,a=e.asym_id;return _({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:r,seq_id_end:n},qie(a))}var jie={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},Wie={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},Xie={A:"A",C:"C",G:"G",T:"T",U:"U"};function jM(e){var t=jie[e];return t||"X"}function WM(e){var t=Xie[e];return t||"X"}function XM(e){var t=Wie[e];return t||"X"}var ig;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(jM(d)!=="X")return"protein";if(WM(d)!=="X")return"RNA";if(XM(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=jM;break;case"DNA":c=XM;break;case"RNA":c=WM;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '".concat(u,"'"))}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function a(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new i(c,u,l)}e.ofResidueNames=a;var i=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),p=[],v=[],m=[],h=new Map,g=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var C=d.value(b);if(y.has(C))h.has(C)?h.get(C).push(c.value(b)):h.set(C,[v[y.get(C)],c.value(b)]);else{y.set(C,g);var x=c.value(b);v[g]=x,m[g]=C,p[g]=f(x),g+=1}}for(var A=[],b=0,S=g;b<S;++b){var P=h.get(m[b]);if(P){var T=P.map(function(M){var B=f(M);return B==="X"?M:B});A[b]="(".concat(T.join("|"),")")}else A[b]=p[b]==="X"?v[b]:p[b]}this.length=g,this.code=ce.ofStringArray(p),this.compId=ce.ofStringArray(v),this.seqId=ce.ofIntArray(m),this.label=ce.ofStringArray(A),this.microHet=h,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,p=Number.MAX_SAFE_INTEGER,v=0,m=this.seqIdStart.rowCount;v<m;v++){var h=this.seqIdStart.value(v),g=this.seqIdEnd.value(v);h<p&&(p=h),f<g&&(f=g)}var y=f-p+1;this.code=ce.ofConst("X",y,ce.Schema.str),this.label=ce.ofConst("",y,ce.Schema.str),this.seqId=ce.ofLambda({value:function(b){return b+p+1},rowCount:y,schema:ce.Schema.int}),this.compId=ce.ofConst("",y,ce.Schema.str),this.length=y,this.minSeqId=p}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(ig||(ig={}));var c4;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=a(s,u),d=l.isDefined?i(s,l):t;return r(c,d)}e.fromHierarchy=n;function a(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,p=d.count,v=d.offsets,m={},h=[];if(p===1&&v[0]===0&&v[1]===0)return{byEntityKey:m,sequences:h};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(m[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var C=f.index[v[S]],x=f.index[v[g+1]-1]+1,A=ce.window(c,C,x),P=[],T=C;T<x;++T)P.push(l.value(f.offsets[T]));var D=ce.ofStringArray(P);m[b]={entityId:s.data.id.value(b),sequence:ig.ofResidueNames(D,A)},h.push(m[b])}}return{byEntityKey:m,sequences:h}}e.fromAtomicHierarchy=a;function i(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=i;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,p=l.offsets,v={},m=[];if(f===1&&p[0]===0&&p[1]===0)return{byEntityKey:v,sequences:m};for(var h=0,g=f;h<g;h++){var y=u.getEntityFromChain(h);if(v[y]===void 0){var b=h;for(h++;h<g&&y===u.getEntityFromChain(h);)h++;h--;var S=p[b],C=p[h+1]-1,x=ce.window(c,S,C),A=ce.window(d,S,C);v[y]={entityId:s.data.id.value(y),sequence:ig.ofSequenceRanges(x,A)},m.push(v[y])}}return{byEntityKey:v,sequences:m}}e.fromCoarseElements=o})(c4||(c4={}));function B7(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return c4.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},l=[],c=i.rowCount,d=0;d<c;){for(var f=d;d<c-1&&i.areValuesEqual(d,d+1);)d++;d++;var p=i.value(f),v=ce.window(s,f,d),m=ce.window(o,f,d),h=t.getEntityIndex(p);u[h]={entityId:p,sequence:ig.ofResidueNames(v,m)},l.push(u[h])}return{byEntityKey:u,sequences:l}}function k7(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return a=T_(r,n-1),i=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=cC(a,i.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:m.sent(),m.label=2;case 2:l=0,c=u.length-1,m.label=3;case 3:if(!(l<c))return[3,10];d=cC(a,o.value,{start:u[l],end:u[l+1]}),f=0,p=d.length-1,m.label=4;case 4:return f<p?(v=d[f],s.valueKind(v)!==0?[3,6]:(cC(a,s.value,{sort:!0,start:v,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:m.sent(),m.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:m.sent(),m.label=9;case 9:return l++,[3,3];case 10:return IK(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ce.ofIntArray(a)}]:[2,{atom_site:kr.view(t,t._schema,a),sourceIndex:ce.ofIntArray(a)}]}})})}function YM(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,l=i.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,Kc(c,"backboneStart")),p=n.findAtomsOnResidue(t,Kc(d,"backboneEnd"));(f===-1||p===-1)&&(f=n.findAtomsOnResidue(e,Kc(c,"coarseBackbone")),p=n.findAtomsOnResidue(t,Kc(d,"coarseBackbone")));var v=r.x,m=r.y,h=r.z,g=w.create(v[f],m[f],h[f]),y=w.create(v[p],m[p],h[p]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return w.distance(g,y)<(b?10:3)}function L7(e,t,r,n){for(var a=[],i=[],o=new Map,s=Qt.transientSegments(e.chainAtomSegments,Ce.ofBounds(0,e.atoms._rowCount)),u=Qt.transientSegments(e.residueAtomSegments,Ce.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=c.residue,v=p.moleculeType,m=p.traceElementIndex,h,g,y,b;s.hasNext;){var S=s.move();u.setSegment(S),h=-1,g=-1,y=-1,b=-1;var C=t.getEntityIndex(f.value(S.index)),x=n.byEntityKey[C],A=x?x.sequence.seqId.value(x.sequence.seqId.rowCount-1):-1,P=e.residueAtomSegments.index[S.start],T=e.residueAtomSegments.index[S.end-1],D=d.value(P),I=d.value(T);for(D===1&&I===A&&r.xyzDefined&&YM(P,T,r,l,c)&&(o.set(P,T),o.set(T,P));u.hasNext;){var M=u.move(),B=M.index,U=d.value(B);if(SS(v[B])&&m[B]!==-1)if(b!==-1)if(U!==h+1)a.push(b,y-1),i.push(g,M.end-1),b=M.start;else if(!u.hasNext)a.push(b,M.end-1);else{var V=e.residueAtomSegments.index[M.start],F=e.residueAtomSegments.index[y-1];r.xyzDefined&&!YM(V,F,r,e.index,c)&&(a.push(b,y-1),i.push(g,M.end-1),b=M.start)}else b=M.start;else b!==-1&&(a.push(b,y-1),b=-1);g=M.start,y=M.end,h=U}}return{polymerRanges:Br.ofSortedRanges(a),gapRanges:Br.ofSortedRanges(i),cyclicPolymerMap:o}}function Bl(e){var t=void 0,r=void 0;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var i=0,o=n.length;i<o;i++)if(n[i]!==t[i])return t=n,r=e.apply(void 0,n),r;return r}}function TS(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function Yie(e){for(var t=new Map,r=function(s,u,l){return"".concat(s,"|").concat(u,"|").concat(l)},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function Kie(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),kr.getRow(e.chem_comp,n));else{var i=F7(e);i.forEach(function(o){t.set(o,nee(o))})}return t}function Qie(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if(a.value(o)==="SNFG CARBOHYDRATE SYMBOL"||a.value(o)==="SNFG CARB SYMBOL"){var u=i.value(o),l=zJ.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '".concat(u,"'"))}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,a=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=a.value(o);Rf.has(f)?t.set(f,Rf.get(f)):Mm(p,f)===9&&t.set(f,GN)}}else{var v=F7(e);Rf.forEach(function(m,h){!t.has(h)&&v.has(h)&&t.set(h,m)})}return t}var F7=TS(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,a=r.auth_comp_id,i=n.isDefined?n:a,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function N7(e,t){for(var r=new Map,n=e.chains,a=n.auth_asym_id,i=n.label_asym_id,o=n.label_entity_id,s=0,u=e.chains._rowCount;s<u;s++){var l=i.value(s);r.set(l,{id:l,auth_id:a.value(s),entity_id:o.value(s)})}if(t==null?void 0:t.struct_asym._rowCount)for(var c=t.struct_asym,l=c.id,d=c.entity_id,s=0,f=l.rowCount;s<f;++s){var p=l.value(s);r.has(p)||r.set(p,{id:p,auth_id:"",entity_id:d.value(s)})}return r}var Zie=ce.Schema.Aliased(ce.Schema.Str(""));function U7(e){var t;if(e.entity.id.isDefined)t=e.entity;else{for(var r=new Set,n=[],a=[],i=e.atom_site,o=i.label_entity_id,s=i.label_comp_id,u=0,l=e.atom_site._rowCount;u<l;u++){var c=o.value(u);r.has(c)||(n.push(c),a.push(aee(s.value(u))),r.add(c))}for(var d=e.ihm_sphere_obj_site.entity_id,u=0,l=e.ihm_sphere_obj_site._rowCount;u<l;u++){var c=d.value(u);r.has(c)||(n.push(c),a.push("polymer"),r.add(c))}for(var f=e.ihm_gaussian_obj_site.entity_id,u=0,l=e.ihm_gaussian_obj_site._rowCount;u<l;u++){var c=f.value(u);r.has(c)||(n.push(c),a.push("polymer"),r.add(c))}t=kr.ofPartialColumns(Pi.entity,{id:ce.ofArray({array:n,schema:Pi.entity.id}),type:ce.ofArray({array:a,schema:Pi.entity.type})},n.length)}var p=ce.createIndexer(t.id),v=new Array(t._rowCount);v.fill("other");var m=new Set,h=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var g=e.entity_poly,y=g.entity_id,b=g.type,S=g._rowCount,u=0;u<S;++u){var c=y.value(u);v[p(c)]=b.value(u),m.add(c)}else h=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var C=e.pdbx_entity_branch,y=C.entity_id,b=C.type,S=C._rowCount,u=0;u<S;++u){var c=y.value(u);v[p(c)]=b.value(u),m.add(c)}else h=!0;if(m.size<v.length&&(h=!0),h){var x=new Map;if(e.chem_comp)for(var A=e.chem_comp,P=A.id,b=A.type,u=0,l=e.chem_comp._rowCount;u<l;u++)x.set(P.value(u),b.value(u));if(e.atom_site)for(var T=e.atom_site,o=T.label_entity_id,s=T.label_comp_id,u=0,l=e.atom_site._rowCount;u<l;u++){var c=o.value(u);if(!m.has(c)){var D=s.value(u),I=x.get(D)||"";v[p(c)]=iee(D,I),m.add(c)}}}var M=ce.ofArray({array:v,schema:Zie});return{data:t,subtype:M,getEntityIndex:p}}function z7(e,t,r){var n;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;var a=new Array(t.data._rowCount);a.fill("");for(var i=e.pdbx_molecule,o=i.asym_id,s=i.prd_id,u=i._rowCount,l=0;l<u;++l){var c=o.value(l),d=(n=r.get(c))===null||n===void 0?void 0:n.entity_id;d!==void 0&&(a[t.getEntityIndex(d)]=s.value(l))}var f=ce.ofArray({array:a,schema:ce.Schema.str});return _(_({},t),{prd_id:f})}function $ie(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=kr.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=kr.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}var Yf=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function Yl(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o;return ie(this,function(s){switch(s.label){case 0:return n=Jie(e),e.ihm_model_list._rowCount>0?[4,noe(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,roe(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)zt.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new Yf(a)]}})})}function Jie(e,t){return{missingResidues:Yie(e),chemicalComponentMap:Kie(e),saccharideComponentMap:Qie(e)}}function eoe(e,t,r,n,a,i,o){var s=R7(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return _(_({},o),{id:Jr.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=O7,c=B7(e,n,s.hierarchy,l.hierarchy),d=L7(s.hierarchy,n,s.conformation,c),f=N7(s.hierarchy),p=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,v=[];return p&&v.push(p),e.struct.title.valueKind(0)===0&&v.push(e.struct.title.value(0)),{id:Jr.create22(),entryId:p,label:v.join(" | "),entry:p,sourceData:i,modelNum:u,parent:void 0,entities:z7(e,n,f),sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:_(_({},a),{structAsymMap:f}),customProperties:new Nu,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function toe(e,t,r,n){var a=R7(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Vie(t,r.chemicalComponentMap),o=B7(e,t.entities,a.hierarchy,i.hierarchy),s=L7(a.hierarchy,t.entities,a.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name);var c=N7(a.hierarchy,e);return{id:Jr.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:z7(e,t.entities,c),sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:_(_({},r),{structAsymMap:c}),customProperties:new Nu,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function V7(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function roe(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=U7(t),s=0,p.label=1;case 1:return s<i?(u=V7(t.atom_site.pdbx_PDB_model_num,s),[4,k7(e,t.atom_site,s,u)]):[3,3];case 2:return l=p.sent(),c=l.atom_site,d=l.sourceIndex,f=eoe(t,c,d,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(f),s=u,[3,1];case 3:return[2,a]}})})}function zC(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=V7(t,a),o=t.value(a);r.set(o,{table:kr.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function noe(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x;return ie(this,function(A){switch(A.label){case 0:if(a=U7(t),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=zC(t.atom_site,i),s=zC(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=zC(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,p=0,A.label=1;case 1:return p<t.ihm_model_list._rowCount?(v=d.value(p),m=void 0,h=void 0,o.has(v)?(g=o.get(v),[4,k7(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=A.sent(),b=y.atom_site,S=y.sourceIndex,m=b,h=S,[3,4];case 3:m=kr.window(t.atom_site,t.atom_site._schema,0,0),h=ce.ofIntArray([]),A.label=4;case 4:C={model_id:v,model_name:f.value(p),model_group_name:$ie(v,t),entities:a,atom_site:m,atom_site_sourceIndex:h,ihm_sphere_obj_site:s.has(v)?s.get(v).table:kr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(v)?u.get(v).table:kr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},x=toe(t,C,r,n),l.push(x),A.label=5;case 5:return p++,[3,1];case 6:return[2,l]}})})}var om;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return i in l[o]||(l[o][i]={props:_({},E.getDefaultValues(n.getParams(l))),data:bd.create(void 0)}),l[o][i]},u=function(l,c,d){var f=s(l);l[o][i]={props:c,data:bd.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=E.clone(n.getParams(l));return E.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),se(a,void 0,void 0,function(){var p,v,m,h,g;return ie(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),p=s(c),v=E.merge(n.defaultParams,p.props,d),p.data.value&&E.areEqual(n.defaultParams,p.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return m=y.sent(),h=m.value,g=m.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,v,h),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=E.merge(n.defaultParams,d.props,c);E.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:E.Value(i,{isHidden:!0})};return t({label:mo(n),descriptor:xo({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:E.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return se(o,void 0,void 0,function(){var d;return ie(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:i}]})})}})}e.createSimple=r})(om||(om={}));var zt;(function(e){function t(F,Y){for(var W=[],K=Y.frames,$=F.atomicHierarchy.atomSourceIndex,J=ce.isIdentity($),Z=J?void 0:$.toArray({array:Int32Array}),N=0,j=K.length;N<j;++N){var L=K[N],H=_(_({},F),{id:Jr.create22(),modelNum:N,atomicConformation:$0.getAtomicConformation(L,F.atomicConformation.atomId,Z),customProperties:new Nu,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(L.cell){var G=kn.fromCell(L.cell.size,L.cell.anglesInRadians);kn.Provider.set(H,G)}e.TrajectoryInfo.set(H,{index:N,size:K.length}),W.push(H)}return{trajectory:W,srcIndexArray:Z}}function r(F,Y){return new Yf(t(F,Y).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(F,Y){var W=this;return Fe.create("Create Trajectory",function(K){return se(W,void 0,void 0,function(){var $,J,Z,N,j,L,H,G,q;return ie(this,function(X){switch(X.label){case 0:return[4,Yl(F.basic,F.sourceData,K)];case 1:if($=X.sent(),$.frameCount===0)throw new Error("found no model");for(J=$.representative,Z=t(J,Y).trajectory,N={pairs:F.bonds,count:J.atomicHierarchy.atoms._rowCount},j=Ka.fromData(N),L=0,H=0,G=Z;H<G.length;H++)q=G[H],Ka.Provider.set(q,j),e.TrajectoryInfo.set(q,{index:L++,size:Z.length});return[2,new Yf(Z)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var a="__Center__";function i(F){if(F._dynamicPropertyData[a])return F._dynamicPropertyData[a];var Y=Q$(F.atomicConformation,F.coarseConformation);return F._dynamicPropertyData[a]=Y,Y}e.getCenter=i;function o(F){for(var Y=new Int32Array(F.rowCount),W=!1,K=0,$=F.rowCount;K<$;K++){var J=F.value(K);J!==K&&(W=!1),Y[J]=K}return{isIdentity:W,invertedIndex:Y}}var s="__InvertedAtomSrcIndex__";function u(F){if(F._staticPropertyData[s])return F._staticPropertyData[s];var Y=o(F.atomicHierarchy.atomSourceIndex);return F._staticPropertyData[s]=Y,Y}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(F){return F._dynamicPropertyData[l]||{index:0,size:1}},set:function(F,Y){return F._dynamicPropertyData[l]=Y}};var c="__AsymIdCount__";e.AsymIdCount={get:function(F){if(F._dynamicPropertyData[c])return F._dynamicPropertyData[c];var Y=Z$(F);return F._dynamicPropertyData[c]=Y,Y}},e.AsymIdOffset=om.createSimple("asym_id_offset","static"),e.Index=om.createSimple("index","static");function d(F){return F.parent||F}e.getRoot=d;function f(F,Y){return F.atomicHierarchy===Y.atomicHierarchy&&F.coarseHierarchy===Y.coarseHierarchy}e.areHierarchiesEqual=f;var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(F){return F._staticPropertyData[p]},set:function(F,Y){return F._staticPropertyData[p]=Y}};var v="__CoarseGrained__";function m(F){if(F._staticPropertyData[v]!==void 0)return F._staticPropertyData[v];for(var Y=0,W=F.atomicHierarchy.derived.residue.polymerType,K=0;K<W.length;++K)W[K]!==0&&(Y+=1);for(var $=!1,J=!1,Z=F.atomicHierarchy.atoms,N=Z.label_atom_id,j=Z._rowCount,K=0;K<j;++K){var L=N.value(K);if(!$&&L==="BB"&&($=!0),!J&&L==="SC1"&&(J=!0),$&&J)break}var H=$&&J||(Y&&j?j/Y<3:!1);return F._staticPropertyData[v]=H,H}e.isCoarseGrained=m;function h(F){return F.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=h;function g(F){for(var Y=F.entities.subtype,W=0,K=Y.rowCount;W<K;++W)if(Y.value(W).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(F){for(var Y=F.entities.subtype,W=0,K=Y.rowCount;W<K;++W){var $=Y.value(W);if($.endsWith("ribonucleotide hybrid")||$.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(F){if(!Xr.is(F.sourceData))return!1;for(var Y=F.sourceData.data.db,W=0,K=Y.database_2.database_id.rowCount;W<K;++W)if(Y.database_2.database_id.value(W)==="PDB")return!0;return!1}e.isFromPdbArchive=b;function S(F){return Xr.is(F.sourceData)?F.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||F.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}e.hasPdbId=S;function C(F){if(!Xr.is(F.sourceData))return!1;var Y=F.sourceData.data.db;return Y.struct_conf.id.isDefined||Y.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=C;var x=w.create(1.5707963,1.5707963,1.5707963),A=w.create(1,1,1);function P(F){var Y,W=(Y=kn.Provider.get(F))===null||Y===void 0?void 0:Y.spacegroup;return!!W&&!(W.num===1&&w.equals(W.cell.anglesInRadians,x)&&w.equals(W.cell.size,A))}e.hasCrystalSymmetry=P;function T(F){if(!Xr.is(F.sourceData))return!1;for(var Y=F.sourceData.data.db,W=0;W<Y.exptl.method.rowCount;W++){var K=Y.exptl.method.value(W).toUpperCase();if(K.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=T;function D(F){if(!Xr.is(F.sourceData))return!1;for(var Y=F.sourceData.data.db,W=0;W<Y.exptl.method.rowCount;W++){var K=Y.exptl.method.value(W).toUpperCase();if(K.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=D;function I(F){if(!Xr.is(F.sourceData))return!1;for(var Y=F.sourceData.data.db,W=0;W<Y.exptl.method.rowCount;W++){var K=Y.exptl.method.value(W).toUpperCase();if(K.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=I;function M(F){if(!Xr.is(F.sourceData)||!T(F))return!1;var Y=F.sourceData.data.db,W=Y.pdbx_database_status.status_code_sf;return W.isDefined&&W.value(0)==="REL"}e.hasXrayMap=M;function B(F){if(!Xr.is(F.sourceData))return!1;for(var Y=F.sourceData.data.db,W=Y.pdbx_database_related,K=W.db_name,$=W.content_type,J=0,Z=Y.pdbx_database_related._rowCount;J<Z;++J)if(K.value(J).toUpperCase()==="EMDB"&&$.value(J)==="associated EM volume")return!0;return!1}e.hasEmMap=B;function U(F){return Xr.is(F.sourceData)?M(F)||B(F):!1}e.hasDensityMap=U;function V(F){if(!Xr.is(F.sourceData))return!1;var Y=F.sourceData.data.db;return U(F)||S(F)&&(!Y.exptl.method.isDefined||T(F)&&(!Y.pdbx_database_status.status_code_sf.isDefined||Y.pdbx_database_status.status_code_sf.valueKind(0)===2)||D(F)&&!Y.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=V})(zt||(zt={}));var KM;(function(e){function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var v=f.getElements(d),m={data:v,rowCount:v.elements.length};return p&&(p[f.id]=m),m}e.getCifDataSource=t;function r(d){return new QM(d)}e.fromAtomMap=r;function n(d){return new QM(VC(d))}e.fromAtomArray=n;var a=function(d){return d.atomicHierarchy.residueAtomSegments};function i(d){return new _y("residue",d,a,0)}e.fromResidueMap=i;function o(d){return new _y("residue",VC(d),a,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new _y("chain",d,s,0)}e.fromChainMap=u;function l(d){return new _y("chain",VC(d),s,0)}e.fromChainArray=l;function c(d){return new aoe(d)}e.fromEntityMap=c})(KM||(KM={}));function VC(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var _y=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=Jr.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=Qt.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),i[i.length]=He.create(t,c,c.elements[f.start]))}}return i.sort(function(p,v){return p.element-v.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),QM=function(){function e(t){this.map=t,this.id=Jr.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var p=c[d];!this.has(p)||n.has(p)||(n.add(c[d]),i[i.length]=He.create(t,l,p))}}return i.sort(function(v,m){return v.element-m.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),aoe=function(){function e(t){this.map=t,this.id=Jr.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,i=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=i;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=Qt.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),v=n.getEntityFromChain(p.index);!this.has(v)||a.has(v)||(a.add(v),o[o.length]=He.create(t,d,d.elements[p.start]))}}return o.sort(function(m,h){return m.element-h.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),ZM={get preferWebGl1(){if(typeof navigator=="undefined"||typeof window=="undefined")return!1;var e=["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"];if(e.some(function(a){return navigator.userAgent.indexOf(a)>0}))return!0;var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||r&&n)},get wboit(){return typeof navigator=="undefined"||typeof window=="undefined"?!0:!/Version\/15.\d Safari/.test(navigator.userAgent)}},ioe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function vn(e,t){return new ioe(e,t)}var Lr={item:vn,General:{IsBusyTimeoutMs:vn("plugin-config.is-busy-timeout",750),DisableAntialiasing:vn("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:vn("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:vn("plugin-config.pixel-scale",1),PickScale:vn("plugin-config.pick-scale",.25),PickPadding:vn("plugin-config.pick-padding",3),EnableWboit:vn("plugin-config.enable-wboit",ZM.wboit),PreferWebGl1:vn("plugin-config.prefer-webgl1",ZM.preferWebGl1)},State:{DefaultServer:vn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:vn("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:vn("history-capacity.server",5)},VolumeStreaming:{Enabled:vn("volume-streaming.enabled",!0),DefaultServer:vn("volume-streaming.server","https://ds.litemol.org"),CanStream:vn("volume-streaming.can-stream",function(e,t){return e.models.length===1&&zt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:vn("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:vn("viewer.show-expand-button",!0),ShowControls:vn("viewer.show-controls-button",!0),ShowSettings:vn("viewer.show-settings-button",!0),ShowSelectionMode:vn("viewer.show-selection-model-button",!0),ShowAnimation:vn("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:vn("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:vn("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:vn("structure.size-thresholds",Ne.DefaultSizeThresholds),DefaultRepresentationPreset:vn("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:vn("structure.default-representation-preset-params",{})}},ooe=function(){function e(t){var r=this;this._config=new Map,!!t&&t.forEach(function(n){var a=n[0],i=n[1];return r._config.set(a,i)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function soe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return Xr.is(r.sourceData)?zt.hasEmMap(r)?"em":zt.hasXrayMap(r)?"x-ray":zt.isFromEm(r)?"em":zt.isFromXray(r)?"x-ray":t:t}function uoe(e){var t=[];if(!Xr.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)a.value(o).toUpperCase()==="EMDB"&&i.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function loe(e){return[e.entryId]}function coe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return uoe(r);case"x-ray":return loe(r)}}function $M(e,t,r,n){return se(this,void 0,void 0,function(){return ie(this,function(a){switch(e){case"emdb":return[2,H7(t,r,n)];case"pdbe":return[2,doe(t,r,n)]}return[2]})})}function H7(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o;return ie(this,function(s){switch(s.label){case 0:return n=e.config.get(Lr.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:"".concat(n,"/").concat(r.toUpperCase(),"/header/").concat(r.toLowerCase(),".xml"),type:"xml"}).runInContext(t)];case 1:return a=s.sent(),i=a.getElementsByTagName("map")[0],o=parseFloat(i.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function doe(e,t,r){var n,a,i,o;return se(this,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(a=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||a===void 0?void 0:a.contour,!u||u.length===0?[2,foe(e,t,r)]:[2,(o=(i=u.find(function(c){return c.primary}))===null||i===void 0?void 0:i.level)!==null&&o!==void 0?o:u[0].level]}})})}function foe(e,t,r){var n,a,i;return se(this,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((i=(a=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||a===void 0?void 0:a.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function poe(e,t,r){var n;return se(this,void 0,void 0,function(){var a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/".concat(r),type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a==null?void 0:a[r],o=[],(n=i==null?void 0:i[0])===null||n===void 0?void 0:n.related_structures){if(s=i[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '".concat(r,"'."));o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '".concat(r,"'."));return[2,o]}})})}var Pr;(function(e){var t=function(c){Pe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(fe.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Pe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(fe.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Pe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(fe.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=_t.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:E.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var a=new Map;function i(c){return a.get(c.id)}e.getCategoryId=i;function o(c){var d=_t.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,p){var v=f.params,m=c.label?c.label(v):{label:c.display.name,description:c.display.description};return new n(new c.ctor(p,v),m)},update:function(f){var p=this,v=f.b,m=f.newParams;return Fe.create("Update Behavior",function(){return se(p,void 0,void 0,function(){var h;return ie(this,function(g){switch(g.label){case 0:return v.data.update?[4,v.data.update(m)]:[2,We.UpdateResult.Unchanged];case 1:return h=g.sent(),[2,h?We.UpdateResult.Updated:We.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return a.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=c.subscribe(this.ctx,function(v){return d(v,p.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return Yv(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Pr||(Pr={}));var h0;(function(e){function t(i,o){return{key:i,data:o}}function r(i){return{entries:N_(),capacity:Math.max(1,i)}}e.create=r;function n(i,o){for(var s=i.entries.first;s;s=s.next)if(s.value.key===o)return i.entries.remove(s),i.entries.addLast(s.value),s.value.data}e.get=n;function a(i,o,s){var u=void 0;if(i.entries.count>=i.capacity){var l=i.entries.first;u=l.value.data,i.entries.remove(l)}return i.entries.addLast(t(o,s)),u}e.set=a})(h0||(h0={}));function un(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=Jr.create22(),e}var voe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||(a=[],this.subs.set(t.id,a)),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(!!i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){if(n.disposing){i("disposed");return}var o=n.subs.get(t.id);if(!o){a();return}n.resolve({cmd:t,params:r,resolve:a,reject:i})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return se(this,void 0,void 0,function(){var r,n,a,i,o;return ie(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?(i=a[n],[4,i(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),ft={State:{SetCurrentObject:un(),ApplyAction:un(),Update:un(),RemoveObject:un(),ToggleExpanded:un(),ToggleVisibility:un(),Snapshots:{Add:un(),Replace:un(),Move:un(),Remove:un(),Apply:un(),Clear:un(),Upload:un(),Fetch:un(),DownloadToFile:un(),OpenFile:un(),OpenUrl:un()}},Interactivity:{Object:{Highlight:un()},Structure:{Highlight:un(),Select:un()},ClearHighlights:un()},Layout:{Update:un()},Toast:{Show:un(),Hide:un()},Camera:{Reset:un(),SetSnapshot:un(),Focus:un()},Canvas3D:{SetSettings:un(),ResetSettings:un()}};function moe(e,t){for(var r=0,n=t*3;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}var ji=w();function Kf(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)w.fromArray(ji,t,r+a),w.transformMat4(ji,ji,e),w.toArray(ji,t,r+a)}function hoe(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)w.fromArray(ji,t,r+a),w.transformMat3(ji,ji,e),w.toArray(ji,t,r+a)}function goe(e,t){for(var r=0,n=e.length;r<n;r+=3)w.fromArray(ji,e,r),w.normalize(ji,ji),w.scale(ji,ji,t),w.toArray(ji,e,r)}var JM=w(),HC=w(),eR=w(),Do=w(),tR=w();function G7(e,t,r,n,a){for(var i=0,o=a*3;i<o;i+=3){var s=t[i]*3,u=t[i+1]*3,l=t[i+2]*3;w.fromArray(JM,e,s),w.fromArray(HC,e,u),w.fromArray(eR,e,l),w.sub(Do,eR,HC),w.sub(tR,JM,HC),w.cross(Do,Do,tR),r[s]+=Do[0],r[s+1]+=Do[1],r[s+2]+=Do[2],r[u]+=Do[0],r[u+1]+=Do[1],r[u+2]+=Do[2],r[l]+=Do[0],r[l+1]+=Do[1],r[l+2]+=Do[2]}return moe(r,n)}function Bm(e,t,r){r===void 0&&(r=1);for(var n=Eu(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)a[s]=l,l+=o[s];a[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=a[d]+i[d];c[f]=s,++i[d]}return{indices:c,offsets:a}}function yoe(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var a=n>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}function fa(e,t,r,n){var a=yoe(e,t),i=a.length,o=a.width,s=a.height;return n=n&&n.length>=i?n:new r(i),{array:n,width:o,height:s}}var Fo=w(),boe=new To("14"),Soe=new To("98");function q7(e){return e>1e5?boe:Soe}function Id(e,t,r){var n=r*3,a=q7(t);a.reset();for(var i=0,o=t*3;i<o;i+=n)w.fromArray(Fo,e,i),a.includePosition(Fo);a.finishedIncludeStep();for(var i=0,o=t*3;i<o;i+=n)w.fromArray(Fo,e,i),a.radiusPosition(Fo);var s=a.getSphere();if(t<=98){for(var u=[],i=0,o=t*3;i<o;i+=n)u.push(w.fromArray(w(),e,i));Me.setExtrema(s,u)}return s}var GC=oe();function xa(e,t,r){if(r===1){oe.fromArray(GC,t,0);var n=Me.clone(e);return oe.isIdentity(GC)?n:Me.transform(n,n,GC)}var a=q7(r);a.reset();var i=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];w.transformMat4Offset(Fo,f,t,0,0,u*16),a.includePosition(Fo)}a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var p=0,v=s;p<v.length;p++){var f=v[p];w.transformMat4Offset(Fo,f,t,0,0,u*16),a.radiusPosition(Fo)}}else{for(var u=0,l=r;u<l;++u)w.transformMat4Offset(Fo,i,t,0,0,u*16),a.includePositionRadius(Fo,o);a.finishedIncludeStep();for(var u=0,l=r;u<l;++u)w.transformMat4Offset(Fo,i,t,0,0,u*16),a.radiusPositionRadius(Fo,o)}return a.getSphere()}var Qa=new Uint8Array(771+1);Qa[1]=1;Qa[2]=1;Qa[3]=1;Qa[256]=1;Qa[512]=1;Qa[768]=1;Qa[257]=2;Qa[513]=2;Qa[769]=2;Qa[258]=2;Qa[514]=2;Qa[770]=2;Qa[259]=2;Qa[515]=2;Qa[771]=2;function j7(e,t){if(t===0)return 0;var r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,a=4*n,i=0;if(n<0)for(var o=0;o<t;++o)i+=e[o]&&1;else{for(var o=0;o<n;++o){var s=r[o];i+=Qa[s&65535]+Qa[s>>16]}for(var o=a;o<t;++o)i+=e[o]&&1}return i/t}function ms(e,t){var r=fa(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array),n=j7(r.array,e),a=n===0?0:-1;return t?(R.updateIfChanged(t.uMarker,0),R.update(t.tMarker,r),R.update(t.uMarkerTexDim,ke.create(r.width,r.height)),R.updateIfChanged(t.markerAverage,n),R.updateIfChanged(t.markerStatus,a),t):{uMarker:R.create(0),tMarker:R.create(r),uMarkerTexDim:R.create(ke.create(r.width,r.height)),markerAverage:R.create(n),markerStatus:R.create(a)}}var wo={kind:"null-location"};function W7(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function sn(e,t,r,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:wo,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=i(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=wo,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function bp(e){return{kind:"position-location",position:e?w.clone(e):w()}}var X7=gi();function xoe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(fr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function FP(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=xoe(e,t);throw new Error("Framebuffer status: ".concat(r))}}function rR(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function Coe(e){var t=rR(e),r=!1;return{id:X7(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=rR(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function woe(){return{id:X7(),bind:function(){},reset:function(){},destroy:function(){}}}function nR(e){var t=Oue(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=kue(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=Bue(e);if(n===null)throw new Error('Could not find support for "standard_derivatives"');var a=Fue(e);Ar&&a===null&&console.log('Could not find support for "texture_float"');var i=Nue(e);Ar&&i===null&&console.log('Could not find support for "texture_float_linear"');var o=Uue(e);Ar&&o===null&&console.log('Could not find support for "texture_half_float"');var s=zue(e);Ar&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=Xue(e);Ar&&u===null&&console.log('Could not find support for "depth_texture"');var l=Vue(e);Ar&&l===null&&console.log('Could not find support for "blend_minmax"');var c=Lue(e);Ar&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=Hue(e);Ar&&d===null&&console.log('Could not find support for "frag_depth"');var f=Gue(e);Ar&&f===null&&console.log('Could not find support for "color_buffer_float"');var p=que(e);Ar&&p===null&&console.log('Could not find support for "color_buffer_half_float"');var v=jue(e);Ar&&v===null&&console.log('Could not find support for "draw_buffers"');var m=Wue(e);Ar&&m===null&&console.log('Could not find support for "shader_texture_lod"');var h=Yue(e);return Ar&&h===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:v,shaderTextureLod:m,sRGB:h}}function _oe(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),v=[],m=function(){for(var h=0;h<p;++h)v[h]=0};return m(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(h){t[h]!==!0&&(e.enable(h),t[h]=!0)},disable:function(h){t[h]!==!1&&(e.disable(h),t[h]=!1)},frontFace:function(h){h!==r&&(e.frontFace(h),r=h)},cullFace:function(h){h!==n&&(e.cullFace(h),n=h)},depthMask:function(h){h!==a&&(e.depthMask(h),a=h)},colorMask:function(h,g,y,b){(h!==i[0]||g!==i[1]||y!==i[2]||b!==i[3])&&(e.colorMask(h,g,y,b),i[0]=h,i[1]=g,i[2]=y,i[3]=b)},clearColor:function(h,g,y,b){(h!==o[0]||g!==o[1]||y!==o[2]||b!==o[3])&&(e.clearColor(h,g,y,b),o[0]=h,o[1]=g,o[2]=y,o[3]=b)},blendFunc:function(h,g){(h!==s||g!==u||h!==l||g!==c)&&(e.blendFunc(h,g),s=h,u=g,l=h,c=g)},blendFuncSeparate:function(h,g,y,b){(h!==s||g!==u||y!==l||b!==c)&&(e.blendFuncSeparate(h,g,y,b),s=h,u=g,l=y,c=b)},blendEquation:function(h){(h!==d||h!==f)&&(e.blendEquation(h),d=h,f=h)},blendEquationSeparate:function(h,g){(h!==d||g!==f)&&(e.blendEquationSeparate(h,g),d=h,f=g)},enableVertexAttrib:function(h){e.enableVertexAttribArray(h),v[h]=1},clearVertexAttribsState:m,disableUnusedVertexAttribs:function(){for(var h=0;h<p;++h)v[h]===0&&e.disableVertexAttribArray(h)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),v.length=0;for(var h=0;h<p;++h)v[h]=0}}}var Bf;(function(e){function t(a,i,o){return{array:a,width:i,height:o}}e.create=t;function r(a){for(var i=a.array,o=a.width,s=a.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var p=l*u+d,v=(s-l-1)*u+d,m=i[p];i[p]=i[v],i[v]=m}return a}e.flipY=r;function n(a){for(var i=a.array,o=i instanceof Uint8Array?255:1,s=0,u=i.length;s<u;s+=4){var l=i[s+3]/o;i[s]/=l,i[s+1]/=l,i[s+2]/=l}return a}e.divideByAlpha=n})(Bf||(Bf={}));var Aoe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,Toe=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,Poe=`
#ifdef dIgnoreLight
    gl_FragColor = material;
#else
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0) {
            vec3 bumpNormal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
            #ifdef enabledFragDepth
                if (!isNaN(bumpNormal.x) && !isNaN(bumpNormal.y) && !isNaN(bumpNormal.z)) {
                    normal = bumpNormal;
                }
            #else
                normal = bumpNormal;
            #endif
        }
    #endif

    vec4 color = material;

    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

    PhysicalMaterial physicalMaterial;
    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
    #ifdef enabledFragDepth
        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
    #else
        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
    #endif
    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
    physicalMaterial.specularF90 = 1.0;

    GeometricContext geometry;
    geometry.position = -vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = normalize(vViewPosition);

    IncidentLight directLight;
    #pragma unroll_loop_start
    for (int i = 0; i < dLightCount; ++i) {
        directLight.direction = uLightDirection[i];
        directLight.color = uLightColor[i] * PI; // * PI for punctual light
        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
    }
    #pragma unroll_loop_end

    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

    // indirect specular only metals
    vec3 radiance = uAmbientColor * metalness;
    vec3 iblIrradiance = uAmbientColor * metalness;
    vec3 clearcoatRadiance = vec3(0.0);
    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;

    gl_FragColor = vec4(outgoingLight, color.a);
#endif

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
#endif
`,Eoe=`
if (marker > 0.0) {
    if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
        gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
        gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
    }
}
`,Ioe=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,Doe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
    #endif
#elif defined(dRenderVariant_pick)
    if (uPickType == 1) {
        vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
    } else if (uPickType == 2) {
        vColor = vec4(packIntToRGB(aInstance), 1.0);
    } else {
        vColor = vec4(packIntToRGB(group), 1.0);
    }
#endif

#ifdef dTransparency
    vGroup = group;

    #if defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
#endif
`,Moe=`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,Roe=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
#endif
`,Ooe=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        metalness = mix(metalness, vSubstance.r, vSubstance.a);
        roughness = mix(roughness, vSubstance.g, vSubstance.a);
        bumpiness = mix(bumpiness, vSubstance.b, vSubstance.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepth(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;
    #if defined(dRenderVariant_colorWboit)
        if (vTransparency < 0.2) ta = 1.0; // hard cutoff looks better with wboit
    #endif

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,Boe=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,koe=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,Loe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,Foe=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,Noe=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,Uoe=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif
`,zoe=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    #if defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
#endif
`,Voe=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`,Hoe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform float uHighlightStrength;
uniform float uSelectStrength;
uniform int uMarkerPriority;

#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    uniform float uMarker;
    #if __VERSION__ == 100
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;

uniform bool uRenderWboit;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepth(const in vec2 coords) {
    // always packed due to merged depth from primitives and volumes
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}
`,Goe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,qoe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`,joe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,Woe=`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`,Xoe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,Yoe=`
varying vec3 vNormal;
`,Koe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,Qoe=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,Zoe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,$oe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,Joe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,ese=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,tse=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,rse=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,nse=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #if defined(dPointStyle_fuzzy)
            gl_FragColor.a *= fuzzyAlpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,ase=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,ise=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    if (!uDoubleSided) {
        if (interior) discard;
    }

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    vec3 vModelPosition = (uInvView * vec4(vViewPosition, 1.0)).xyz;

    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        vec3 normal = -cameraNormal;
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,ose=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,sse=`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    if (uDoubleSided) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    }

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    vec3 vModelPosition = (uInvView * vec4(vViewPosition, 1.0)).xyz;

    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
        vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,use=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform vec4 uViewport;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,lse=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,cse=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,dse=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,fse=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`,pse=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    vec3 fdx = dFdx(vViewPosition);
    vec3 fdy = dFdy(vViewPosition);
    vec3 faceNormal = normalize(cross(fdx,fdy));
    bool frontFacing = dot(vNormal, faceNormal) > 0.0;

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #if defined(dFlatShaded)
            vec3 normal = -faceNormal;
        #else
            vec3 normal = -normalize(vNormal);
            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;
        #endif
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,vse=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,mse=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform float uHighlightStrength;
uniform float uSelectStrength;
uniform int uMarkerPriority;

uniform float uMarker;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uMetalness;
uniform float uRoughness;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;

uniform bool uRenderWboit;
uniform bool uDoubleSided;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, isoPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        if (material.a >= 0.01) {
            #ifdef dPackedGroup
                // compute gradient by central differences
                gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
            #else
                gradient = cell.xyz * 2.0 - 1.0;
            #endif
            vec3 normal = -normalize(normalMatrix * normalize(gradient));
            #include apply_light_color
        } else {
            gl_FragColor.rgb = material.rgb;
        }

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        float marker = uMarker;
        if (uMarker == -1.0) {
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
    float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
    bool interior = false;
    #include wboit_write
}
`,hse=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,gse=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;
        if (uPickType == 1) {
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
        } else {
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        }
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;
        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_marking)
        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
        if (uMarkingType == 1) {
            if (marker > 0.0 || imageData.a < 0.05)
                discard;
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
        } else {
            if (marker == 0.0 || imageData.a < 0.05)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepth(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);
        }
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;
        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Y7=gi(),yse={apply_fog:Aoe,apply_interior_color:Toe,apply_light_color:Poe,apply_marker_color:Eoe,assign_clipping_varying:Ioe,assign_color_varying:Doe,assign_group:Moe,assign_marker_varying:Roe,assign_material_color:Ooe,assign_position:Boe,assign_size:koe,check_picking_alpha:Loe,clip_instance:Foe,clip_pixel:Noe,color_frag_params:Uoe,color_vert_params:zoe,common_clip:Voe,common_frag_params:Hoe,common_vert_params:Goe,common:qoe,float_to_rgba:joe,light_frag_params:Woe,matrix_scale:Xoe,normal_frag_params:Yoe,read_from_texture:Koe,rgba_to_float:Qoe,size_vert_params:Zoe,texture3d_from_1d_trilinear:$oe,texture3d_from_2d_linear:Joe,texture3d_from_2d_nearest:ese,wboit_write:tse},bse=/^(?!\/\/)\s*#include\s+(\S+)/gm,Sse=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,xse=/[ \t]*\/\/.*\n/g,Cse=/[ \t]*\/\*[\s\S]*?\*\//g,wse=/\n{2,}/g;function aR(e){return e.replace(bse,function(t,r){var n=yse[r];if(!n)throw new Error("empty chunk, '".concat(r,"'"));return n}).trim().replace(xse,`
`).replace(Cse,`
`).replace(wse,`
`)}function _se(e){return e.replace(Sse,Ase)}function Ase(e,t,r,n){for(var a="",i=parseInt(t);i<parseInt(r);++i)a+=n.replace(/\[\s*i\s*\]/g,"[".concat(i,"]")).replace(/UNROLLED_LOOP_INDEX/g,"".concat(i));return a}function Tse(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,"".concat(t.dLightCount.ref.value))),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,"".concat(t.dClipObjectCount.ref.value))),e}function iR(e,t){return _se(Tse(e,t))}function ln(e,t,r,n,a,i){return n===void 0&&(n={}),a===void 0&&(a={}),{id:Y7(),name:e,vert:aR(t),frag:aR(r),extensions:n,outTypes:a,ignoreDefine:i}}function Dg(e,t,r){var n;if(t.startsWith("color")){if(e==="dLightCount")return!!((n=r.dIgnoreLight)===null||n===void 0?void 0:n.ref.value)}else return["dColorType","dUsePalette","dLightCount","dOverpaintType","dOverpaint","dSubstanceType","dSubstance"].includes(e);return!1}function PS(e,t,r){return e==="dLightCount"?!0:Dg(e,t,r)}var Pse=ln("points",rse,nse,{drawBuffers:"optional"},{},PS),Ese=ln("spheres",ase,ise,{fragDepth:"required",drawBuffers:"optional"},{},Dg),Ise=ln("cylinders",ose,sse,{fragDepth:"required",drawBuffers:"optional"},{},Dg),Dse=ln("text",use,lse,{drawBuffers:"optional"},{},PS),Mse=ln("lines",cse,dse,{drawBuffers:"optional"},{},PS),K7=ln("mesh",fse,pse,{drawBuffers:"optional"},{},Dg),Rse=ln("direct-volume",vse,mse,{fragDepth:"optional",drawBuffers:"optional"},{},Dg),Ose=ln("image",hse,gse,{drawBuffers:"optional"},{},PS);function oR(e,t){var r;if(e===void 0)return"";var n=((r=e.dRenderVariant)===null||r===void 0?void 0:r.ref.value)||"",a=[];for(var i in e)if(!(t==null?void 0:t(i,n,e))){var o=e[i],s=o.ref.value;if(s!==void 0)if(typeof s=="string")a.push("#define ".concat(i,"_").concat(s));else if(typeof s=="number")a.push("#define ".concat(i," ").concat(s));else if(typeof s=="boolean")s&&a.push("#define ".concat(i));else throw new Error("unknown define type")}return a.join(`
`)+`
`}function Bse(e,t){var r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var kse=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,Lse=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function Fse(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp ".concat(n[0]||"vec4"," out_FragData0;")];if(r.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers){a.push("#define requiredDrawBuffers");for(var i=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=i;o<s;++o)a.push("layout(location = ".concat(o,") out highp ").concat(n[o]||"vec4"," out_FragData").concat(o,";"))}return r.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(Lse),a.join(`
`)+`
`}function Nse(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function Use(e,t,r,n){var a=oR(r,n.ignoreDefine),i=oR(r,n.ignoreDefine),o=fr(e)?kse:"",s=fr(e)?Fse(e,t,n.extensions,n.outTypes):Bse(t,n.extensions),u=fr(e)?Nse(n.frag):n.frag;return{id:Y7(),name:n.name,vert:"".concat(o).concat(a).concat(iR(n.vert,r)),frag:"".concat(s).concat(i).concat(iR(u,r)),extensions:n.extensions,outTypes:n.outTypes}}function zse(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '".concat(t,"'"))}}function Vse(e,t,r){e.uniform1f(t,r)}function Hse(e,t,r){e.uniform1fv(t,r)}function Gse(e,t,r){e.uniform1i(t,r)}function qse(e,t,r){e.uniform1iv(t,r)}function jse(e,t,r){e.uniform2fv(t,r)}function Wse(e,t,r){e.uniform3fv(t,r)}function Xse(e,t,r){e.uniform4fv(t,r)}function Yse(e,t,r){e.uniformMatrix3fv(t,!1,r)}function Kse(e,t,r){e.uniformMatrix4fv(t,!1,r)}function sR(e){switch(e){case"f":return Vse;case"f[]":return Hse;case"i":case"t":case"b":return Gse;case"i[]":case"t[]":case"b[]":return qse;case"v2":case"v2[]":return jse;case"v3":case"v3[]":return Wse;case"v4":case"v4[]":return Xse;case"m3":case"m3[]":return Yse;case"m4":case"m4[]":return Kse}}function Qse(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=sR(n.kind):n.type==="texture"&&(t[r]=sR("t"))}),t}function Zse(e){var t={};return Object.keys(e).forEach(function(r){t[r]=R.create(Cd(e[r].ref.value))}),t}var $se=gi();function Jse(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function eue(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function tue(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function uR(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function Q7(e,t,r,n){var a=uR(e),i=Jse(e,r),o=tue(e,n),s=eue(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,a),e.bufferData(o,f,i)}c(t);var d=!1;return{id:$se(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return a},updateData:c,updateSubData:function(f,p,v){e.bindBuffer(o,a),v-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+v))},reset:function(){a=uR(e),c(t)},destroy:function(){d||(e.deleteBuffer(a),d=!0)}}}function rue(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '".concat(t,"' and itemSize '").concat(r,"'"))}function nue(e,t,r,n,a,i,o){o===void 0&&(o="dynamic");var s=r.instancedArrays,u=Q7(e,n,o,"attribute"),l=u._bufferType,c=u._dataType,d=u._bpe;return _(_({},u),{bind:function(f){if(e.bindBuffer(l,u.getBuffer()),a===16)for(var p=0;p<4;++p)t.enableVertexAttrib(f+p),e.vertexAttribPointer(f+p,4,c,!1,4*4*d,p*4*d),s.vertexAttribDivisor(f+p,i);else t.enableVertexAttrib(f),e.vertexAttribPointer(f,a,c,!1,0,0),s.vertexAttribDivisor(f,i)}})}function aue(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];i.type==="attribute"&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}function iue(e,t,r){r===void 0&&(r="static");var n=Q7(e,t,r,"elements");return _(_({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var oue=gi();function sue(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if(i.type==="attribute"){var o=e.getAttribLocation(t,a);n[a]=o}else if(i.type==="uniform"||i.type==="texture"){var o=e.getUniformLocation(t,a);n[a]=o}}),n}function uue(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if(u.type!=="attribute")throw new Error("'".concat(o,"' must be of type 'attribute' but is '").concat(u.type,"'"));var l=rue(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for ".concat(o))}}}function lue(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if(l.type==="uniform"){var c=zse(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for ".concat(o))}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else throw new Error("'".concat(o,"' must be of type 'uniform' or 'texture' but is '").concat(l.type,"'"))}}}function cue(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`.concat(e.getProgramInfoLog(t)))}function d4(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function due(e,t,r,n,a){var i=a.defineValues,o=a.shaderCode,s=a.schema,u=d4(e),l=oue(),c=Use(e,r,i,o),d=n("vert",c.vert),f=n("frag",c.frag),p,v;function m(){d.attach(u),f.attach(u),e.linkProgram(u),Ar&&cue(e,u),p=sue(e,u,s),v=Qse(s),Ar&&(uue(e,u,s),lue(e,u,s))}m();var h=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],C=S[0],x=S[1];if(x){var A=p[C];A!==null&&v[C](e,A,x.ref.value)}}},bindAttributes:function(g){t.clearVertexAttribsState();for(var y=0,b=g.length;y<b;++y){var S=g[y],C=S[0],x=S[1],A=p[C];A!==-1&&x.bind(A)}t.disableUnusedVertexAttribs()},bindTextures:function(g,y){for(var b=0,S=g.length;b<S;++b){var C=g[b],x=C[0],A=C[1],P=p[x];P!=null&&(A.bind(b+y),v[x](e,P,b+y))}},reset:function(){u=d4(e),m()},destroy:function(){h||(d.destroy(),f.destroy(),e.deleteProgram(u),h=!0)}}}var fue=gi();function pue(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function Yb(e,t){var r=t.type,n=t.source,a=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(a===null)throw new Error("Error creating ".concat(r," shader"));if(e.shaderSource(a,n),e.compileShader(a),Ar&&e.getShaderParameter(a,e.COMPILE_STATUS)===!1)throw console.warn("'".concat(r,"' shader info log '").concat(e.getShaderInfoLog(a),`'
`).concat(pue(n))),new Error("Error compiling ".concat(r," shader"));return a}function vue(e,t){var r=Yb(e,t);return{id:fue(),attach:function(n){e.attachShader(n,r)},reset:function(){r=Yb(e,t)},destroy:function(){e.deleteShader(r)}}}function mue(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function hue(e){return{free:function(){e.usageCount-=1},value:e.value}}function lR(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=mue(t(a)),n.set(i,o)),o.usageCount+=1,hue(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var gue=gi();function yue(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(fr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function bue(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function cR(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function Sue(e,t,r,n,a){var i=cR(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=yue(e,t),u=bue(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}l();var c=!1;return{id:gue(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),Ar&&FP(e)},setSize:function(d,f){n=d,a=f,l()},reset:function(){i=cR(e),l()},destroy:function(){c||(e.deleteRenderbuffer(i),c=!0)}}}var xue=gi();function dR(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function fR(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function Cue(e,t,r,n,a){var i=xue(),o=dR(t),s=fR(t);function u(){s.bindVertexArray(o),a&&a.bind(),r.bindAttributes(n),s.bindVertexArray(null)}u();var l=!1;return{id:i,bind:function(){s.bindVertexArray(o)},update:u,reset:function(){o=dR(t),s=fR(t),u()},destroy:function(){l||(a&&(s.bindVertexArray(o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(o),l=!0)}}}function wue(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:eP(e)}function pR(e){var t=_(_({},e.value),{destroy:function(){e.free()}});return t}function _ue(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function i(l,c){return a[l].add(c),r.resourceCounts[l]+=1,_(_({},c),{destroy:function(){c.destroy(),a[l].delete(c),r.resourceCounts[l]-=1}})}var o=lR(function(l){return JSON.stringify(l)},function(l){return i("shader",vue(e,l))},function(l){l.destroy()});function s(l,c){return pR(o.get({type:l,source:c}))}var u=lR(function(l){var c,d=[l.shaderCode.id],f=((c=l.defineValues.dRenderVariant)===null||c===void 0?void 0:c.ref.value)||"";return Object.keys(l.defineValues).forEach(function(p){var v,m;((m=(v=l.shaderCode).ignoreDefine)===null||m===void 0?void 0:m.call(v,p,f,l.defineValues))||d.push(eP(p),wue(l.defineValues[p].ref.value))}),vi(d).toString()},function(l){return i("program",due(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return i("attribute",nue(e,t,n,l,c,d,f))},elements:function(l,c){return i("elements",iue(e,l,c))},framebuffer:function(){return i("framebuffer",Coe(e))},program:function(l,c,d){return pR(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return i("renderbuffer",Sue(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return i("texture",p4(e,n,l,c,d,f))},vertexArray:function(l,c,d){return i("vertexArray",Cue(e,n,l,c,d))},getByteCounts:function(){var l=0;a.texture.forEach(function(f){l+=f.getByteCount()});var c=0;a.attribute.forEach(function(f){c+=f.length*4});var d=0;return a.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){a.attribute.forEach(function(l){return l.reset()}),a.elements.forEach(function(l){return l.reset()}),a.framebuffer.forEach(function(l){return l.reset()}),a.renderbuffer.forEach(function(l){return l.reset()}),a.shader.forEach(function(l){return l.reset()}),a.program.forEach(function(l){return l.reset()}),a.vertexArray.forEach(function(l){return l.reset()}),a.texture.forEach(function(l){return l.reset()})},destroy:function(){a.attribute.forEach(function(l){return l.destroy()}),a.elements.forEach(function(l){return l.destroy()}),a.framebuffer.forEach(function(l){return l.destroy()}),a.renderbuffer.forEach(function(l){return l.destroy()}),a.shader.forEach(function(l){return l.destroy()}),a.program.forEach(function(l){return l.destroy()}),a.vertexArray.forEach(function(l){return l.destroy()}),a.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var Z7=gi();function Aue(e,t,r,n,a,i,o){a===void 0&&(a=!0),i===void 0&&(i="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=i==="fp16"?t.texture("image-float16","rgba","fp16",o):i==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=a?fr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:Z7(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,p){r===f&&n===p||(r=f,n=p,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function Tue(e){return{id:Z7(),texture:Ei(e),framebuffer:woe(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function Pue(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=((t==null?void 0:t.preferWebGl1)?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return Ar&&console.log("isWebgl2: ".concat(fr(n))),n}function $7(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function J7(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '".concat($7(e,t),"'"))}function Eue(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),fr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),Kb(e)}function Kb(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var e9=new Uint8Array(1*4);function t9(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):nP.setImmediate(t9,e,t,r)}function r9(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?nP.setImmediate(t9,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,e9),t())}var vR=!1;function Iue(e){return new Promise(function(t){fr(e)?r9(e,t):(vR||(console.info("Sync object not supported in WebGL"),vR=!0),n9(e),t())})}function n9(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,e9)}function f4(e,t,r,n,a,i){if(Ar&&FP(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&fr(e))e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");Ar&&J7(e)}function Due(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return Kb(e),e.viewport(0,0,t,r),f4(e,0,0,t,r,n),Bf.flipY(Bf.create(n,t,r))}function Mue(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function Rue(e,t){var r=this;t===void 0&&(t={});var n=nR(e),a=_oe(e),i=Mue(),o=_ue(e,a,i,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:fr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new fl(0),c;if(fr(e)){var d=e.createBuffer(),f=void 0,p=void 0,v=!1,m=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,p(),p=void 0,f=void 0};c=function(g,y,b,S,C){return new Promise(function(x,A){if(v){A("Can not call multiple readPixelsAsync at the same time");return}v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(g,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),p=x,f=C,r9(e,m)})}}else c=function(g,y,b,S,C){return se(r,void 0,void 0,function(){return ie(this,function(x){return f4(e,g,y,b,S,C),[2]})})};var h=new Set;return{gl:e,isWebGL2:fr(e),get pixelRatio(){var g=typeof window!="undefined"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,nR(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),h.forEach(function(y){return y.reset()}),g==null||g(),u=!1,l.next(fn())},createRenderTarget:function(g,y,b,S,C){var x=Aue(e,o,g,y,b,S,C);return h.add(x),_(_({},x),{destroy:function(){x.destroy(),h.delete(x)}})},unbindFramebuffer:function(){return Kb(e)},readPixels:function(g,y,b,S,C){f4(e,g,y,b,S,C)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return Iue(e)},waitForGpuCommandsCompleteSync:function(){return n9(e)},getDrawingBufferPixelData:function(){return Due(e)},clear:function(g,y,b,S){Kb(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(g,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y,b;o.destroy(),Eue(e),(g==null?void 0:g.doNotForceWebGLContextLoss)||((y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext(),(b=e.getExtension("STACKGL_destroy_context"))===null||b===void 0||b.destroy())}}}function fr(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext}function Oue(e){if(fr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function Bue(e){if(fr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function kue(e){return fr(e)?{}:e.getExtension("OES_element_index_uint")}function Lue(e){if(fr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function Fue(e){return fr(e)?{}:e.getExtension("OES_texture_float")}function Nue(e){return e.getExtension("OES_texture_float_linear")}function Uue(e){if(fr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function zue(e){return e.getExtension("OES_texture_half_float_linear")}function Vue(e){if(fr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function Hue(e){return fr(e)?{}:e.getExtension("EXT_frag_depth")}function Gue(e){if(fr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),a9(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function que(e){if(fr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),a9(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function jue(e){if(fr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function Wue(e){return fr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function Xue(e){if(fr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function Yue(e){if(fr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var Kue=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,Que=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,Zue=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function a9(e,t){var r=Yb(e,{type:"vert",source:Kue}),n=Yb(e,{type:"frag",source:Que});if(!r||!n)return!1;var a=d4(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return Ar&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,Zue,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Ar&&console.log("error creating framebuffer for '".concat(t,"'")),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return Ar&&console.log("not able to actually render to '".concat(t,"' texture")),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var v=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,v);var m=e.getError();if(m)return Ar&&console.log("error reading float pixels: '".concat($7(e,m),"'")),!1}return!0}var i9=gi();function $ue(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(fr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '".concat(t,"'"))}function o9(e,t,r){switch(t){case"alpha":return fr(e)&&r==="float"?e.RED:fr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return fr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return fr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function Jue(e,t,r){if(fr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return o9(e,t,r)}function ele(e,t,r,n,a){var i=tle(e)*rle(t);return i*r*n*(a||1)}function tle(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function rle(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function nle(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(fr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function mR(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function Ay(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function ale(e){return typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement}function ile(e,t,r){return t===r.TEXTURE_2D}function ole(e,t,r){return t===r.TEXTURE_3D}function hR(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function p4(e,t,r,n,a,i){var o=i9(),s=hR(e);if(r.endsWith("float32")&&a!=="float"||r.endsWith("float16")&&a!=="fp16"||r.endsWith("uint8")&&a!=="ubyte"||r.endsWith("int32")&&a!=="int"||r.endsWith("depth")&&a!=="ushort"&&a!=="float")throw new Error("texture kind '".concat(r,"' and type '").concat(a,"' are incompatible"));var u=$ue(e,r),l=mR(e,i),c=o9(e,n,a),d=Jue(e,n,a),f=nle(e,t,a);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var v=0,m=0,h=0,g,y=!1;function b(x,A,P){if(!(v===x&&m===A&&h===(P||0)))if(v=x,m=A,h=P||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,v,m,0,c,f,null);else if(fr(e)&&u===e.TEXTURE_3D&&h!==void 0)e.texImage3D(u,0,d,v,m,h,0,c,f,null);else throw new Error("unknown texture target")}function S(x,A){if(A===void 0&&(A=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),ale(x))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,x);else if(ile(x,u,e)){var P=x.filter?mR(e,x.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,P),e.texParameteri(u,e.TEXTURE_MIN_FILTER,P),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!x.flipY),A?e.texSubImage2D(u,0,0,0,x.width,x.height,c,f,x.array):(v=x.width,m=x.height,e.texImage2D(u,0,d,v,m,0,c,f,x.array))}else if(fr(e)&&ole(x,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),A?e.texSubImage3D(u,0,0,0,0,x.width,x.height,x.depth,c,f,x.array):(v=x.width,m=x.height,h=x.depth,e.texImage3D(u,0,d,v,m,h,0,c,f,x.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=x}function C(x,A,P){if(x.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Ay(e,t,A),e.TEXTURE_2D,s,0);else if(fr(e)&&u===e.TEXTURE_3D){if(P===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,Ay(e,t,A),s,0,P)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return v},getHeight:function(){return m},getDepth:function(){return h},getByteCount:function(){return ele(n,a,v,m,h)},define:b,load:S,bind:function(x){e.activeTexture(e.TEXTURE0+x),e.bindTexture(u,s)},unbind:function(x){e.activeTexture(e.TEXTURE0+x),e.bindTexture(u,null)},attachFramebuffer:C,detachFramebuffer:function(x,A){if(x.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Ay(e,t,A),e.TEXTURE_2D,null,0);else if(fr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,Ay(e,t,A),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=hR(e),p();var x=[v,m,h],A=x[0],P=x[1],T=x[2];v=0,m=0,h=0,b(A,P,T),g&&S(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function sle(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if(o.type==="texture"){var s=r[i];if(s)if(o.kind==="texture")a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function gR(e,t,r){var n=new Image;n.onload=function(){r.load(n),R.update(t,r)},n.src=e}function Ei(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:i9(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function Po(e,t,r,n){var a=ule(e,t,r,n);return r.palette?(R.updateIfChanged(a.dUsePalette,!0),lle(r.palette,a.tPalette)):R.updateIfChanged(a.dUsePalette,!1),a}function ule(e,t,r,n){switch(Fa.getGranularity(e,r.granularity)){case"uniform":return dle(e,r.color,n);case"instance":return fle(e,r.color,n);case"group":return ple(e,r.color,n);case"groupInstance":return vle(e,r.color,n);case"vertex":return mle(t,r.color,n);case"vertexInstance":return hle(t,r.color,n);case"volume":return yR(r.grid,"volume",n);case"volumeInstance":return yR(r.grid,"volumeInstance",n);case"direct":return gle(n)}}function lle(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=$e.toRgb(u),c=l[0],d=l[1],f=l[2];if(a[i++]!==c||a[i++]!==d||a[i++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(e.colors.length*3),v=0,m=0,h=e.colors;m<h.length;m++){var u=h[m],g=$e.toRgb(u),c=g[0],d=g[1],f=g[2];p[v++]=c,p[v++]=d,p[v++]=f}R.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}function cle(e,t){return t?(R.update(t.uColor,$e.toVec3Normalized(t.uColor.ref.value,e)),R.updateIfChanged(t.dColorType,"uniform"),t):{uColor:R.create($e.toVec3Normalized(w(),e)),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(Ei()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(ke.create(1,1)),uColorGridDim:R.create(w.create(1,1,1)),uColorGridTransform:R.create(Jt.create(0,0,0,1)),dColorType:R.create("uniform"),dUsePalette:R.create(!1)}}function dle(e,t,r){return cle(t(wo,!1),r)}function Mg(e,t,r){return r?(R.update(r.tColor,e),R.update(r.uColorTexDim,ke.create(e.width,e.height)),R.updateIfChanged(r.dColorType,t),r):{uColor:R.create(w()),tColor:R.create(e),tColorGrid:R.create(Ei()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(ke.create(e.width,e.height)),uColorGridDim:R.create(w.create(1,1,1)),uColorGridTransform:R.create(Jt.create(0,0,0,1)),dColorType:R.create(t),dUsePalette:R.create(!1)}}function fle(e,t,r){var n=e.instanceCount,a=fa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.instanceIndex;$e.toArray(t(o,s),a.array,u*3),e.skipInstance()}return Mg(a,"instance",r)}function ple(e,t,r){var n=e.groupCount,a=fa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.groupIndex;$e.toArray(t(o,s),a.array,u*3)}return Mg(a,"group",r)}function vle(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=fa(Math.max(1,i),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;$e.toArray(t(u,l),o.array,c*3)}return Mg(o,"groupInstance",r)}function mle(e,t,r){var n=e.groupCount,a=e.stride,i=fa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<a;++d)$e.toArray(c,i.array,(l+d)*3);return Mg(i,"vertex",r)}function hle(e,t,r){var n=e.groupCount,a=e.instanceCount,i=e.stride,o=a*n,s=fa(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),p=0;p<i;++p)$e.toArray(f,s.array,(d+p)*3);return Mg(s,"vertexInstance",r)}function yR(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(R.update(r.tColorGrid,n),R.update(r.uColorTexDim,ke.create(o,s)),R.update(r.uColorGridDim,w.clone(a)),R.update(r.uColorGridTransform,Jt.clone(i)),R.updateIfChanged(r.dColorType,t),r):{uColor:R.create(w()),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(n),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(ke.create(o,s)),uColorGridDim:R.create(w.clone(a)),uColorGridTransform:R.create(Jt.clone(i)),dColorType:R.create(t),dUsePalette:R.create(!1)}}function gle(e){return e?(R.updateIfChanged(e.dColorType,"direct"),e):{uColor:R.create(w()),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(Ei()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(ke.create(1,1)),uColorGridDim:R.create(w.create(1,1,1)),uColorGridTransform:R.create(Jt.create(0,0,0,1)),dColorType:R.create("direct"),dUsePalette:R.create(!1)}}var bR=wn(),yle=oe();function ble(e,t){for(var r=0;r<t;r++)if(wn.fromMat4(bR,oe.fromArray(yle,e,r*16)),wn.determinant(bR)<0)return!0;return!1}function NP(e,t,r){var n=ble(e,t);if(r){R.update(r.matrix,r.matrix.ref.value);var a=r.transform.ref.value.length>=t*16?r.transform.ref.value:new Float32Array(t*16);a.set(e),R.update(r.transform,a),R.updateIfChanged(r.uInstanceCount,t),R.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);R.update(r.aTransform,i);var o=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);R.update(r.extraTransform,Qb(o,t));var s=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);R.update(r.aInstance,is(s,t)),R.update(r.hasReflection,n)}else r={aTransform:R.create(new Float32Array(t*16)),matrix:R.create(oe.identity()),transform:R.create(new Float32Array(e)),extraTransform:R.create(Qb(new Float32Array(t*16),t)),uInstanceCount:R.create(t),instanceCount:R.create(t),aInstance:R.create(is(new Float32Array(t))),hasReflection:R.create(n)};return s9(r),r}var UP=new Float32Array(16);oe.toArray(oe.identity(),UP,0);function zP(e){return NP(new Float32Array(UP),1,e)}function Qb(e,t){for(var r=0;r<t;r++)e.set(UP,r*16);return e}function s9(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;oe.mulOffset(t,i,a,s,s,s),oe.mulOffset(t,n,t,s,0,s)}R.update(e.aTransform,t)}var tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(tr).forEach(function(t){e.set(tr[t],t)}),e})();var u9=$e(13421772),Sle="Gives everything the same, uniform color.",VP={value:E.Color(u9)};function xle(e){return VP}function ES(e,t){var r=oa(t.value,u9);return{factory:ES,granularity:"uniform",color:function(){return r},props:t,description:Sle,legend:Fd([["uniform",r]])}}var Cle={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:ES,getParams:xle,defaultValues:E.getDefaultValues(VP),isApplicable:function(e){return!0}},wle="Gives everything the same, uniform size.",l9={value:E.Numeric(1,{min:0,max:20,step:.1})};function _le(e){return l9}function HP(e,t){var r=t.value;return{factory:HP,granularity:"uniform",size:function(){return r},props:t,description:wle}}var Ale={name:"uniform",label:"Uniform",category:"",factory:HP,getParams:_le,defaultValues:E.getDefaultValues(l9),isApplicable:function(e){return!0}};function di(e){return _(_({},di.Zero),e)}(function(e){e.Zero={metalness:0,roughness:0,bumpiness:0};function t(a,i,o){return i[o]=a.metalness*255,i[o+1]=a.roughness*255,i[o+2]=a.bumpiness*255,i}e.toArray=t;function r(a){var i=a.metalness,o=a.roughness,s=a.bumpiness;return"M ".concat(i.toFixed(2)," | R ").concat(o.toFixed(2)," | B ").concat(s.toFixed(2))}e.toString=r;function n(a){return E.Group({metalness:E.Numeric(0,{min:0,max:1,step:.01}),roughness:E.Numeric(1,{min:0,max:1,step:.01}),bumpiness:E.Numeric(0,{min:0,max:1,step:.01})},_(_({},a),{presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]}))}e.getParam=n})(di||(di={}));function fd(){}(function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:E.Select("pixel",E.arrayToOptions(["instance","pixel"])),objects:E.ObjectList({type:E.Select("plane",E.objectToOptions(e.Type,function(u){return mo(u)})),invert:E.Boolean(!1),position:E.Vec3(w()),rotation:E.Group({axis:E.Vec3(w.create(1,0,0)),angle:E.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:E.Vec3(w.create(1,1,1))},function(u){return mo(u.type)})};function t(){return{count:0,type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(5*3).fill(0),rotation:new Array(5*4).fill(0),scale:new Array(5*3).fill(1)}}var r=$r(),n=$r(),a=w(),i=w();function o(u,l){for(var c=(l==null?void 0:l.objects)||t(),d=c.type,f=c.invert,p=c.position,v=c.rotation,m=c.scale,h=0,g=u.objects.length;h<g;++h){var y=u.objects[h];d[h]=e.Type[y.type],f[h]=y.invert,w.toArray(y.position,p,h*3),$r.toArray($r.setAxisAngle(r,y.rotation.axis,wr(y.rotation.angle)),v,h*4),w.toArray(y.scale,m,h*3)}return{variant:u.variant,objects:{count:u.objects.length,type:d,invert:f,position:p,rotation:v,scale:m}}}e.getClip=o;function s(u,l){if(u.variant!==l.variant||u.objects.count!==l.objects.count)return!1;for(var c=u.objects,d=l.objects,f=0,p=c.count;f<p;++f)if(c.invert[f]!==d.invert[f]||c.type[f]!==d.type[f]||(w.fromArray(a,c.position,f*3),w.fromArray(i,d.position,f*3),!w.equals(a,i))||(w.fromArray(a,c.scale,f*3),w.fromArray(i,d.scale,f*3),!w.equals(a,i))||($r.fromArray(r,c.rotation,f*4),$r.fromArray(n,d.rotation,f*4),!$r.equals(r,n)))return!1;return!0}e.areEqual=s})(fd||(fd={}));var Tle={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},Ple=Object.keys(Tle),GP=E.arrayToOptions(Ple),c9={smoothColors:E.MappedStatic("auto",{auto:E.Group({}),on:E.Group({resolutionFactor:E.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:E.Numeric(3,{min:1,max:12,step:1})}),off:E.Group({})})};function Sl(e){return!!e.smoothColors}function Ps(e,t,r){if((e.name==="on"||e.name==="auto"&&t)&&r&&r<3){var n=3;return e.name==="on"?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-A8(0,1.1,r),r=Math.max(.5,r),r>1.2&&(n=2)),{resolution:r,stride:n}}}var at;(function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality!="undefined"&&o.quality!=="custom"}},e.Params={alpha:E.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:E.Select("auto",GP,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:di.getParam(),clip:E.Group(fd.Params)};function t(o,s,u){o===void 0&&(o=tr.grey),s===void 0&&(s=1),u||(u=zP());var l=sn(1,u.instanceCount.ref.value,1,function(){return wo},!1,function(){return!1}),c={color:ES({},{value:o}),size:HP({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){var u=fd.getClip(o.clip);return{alpha:R.create(o.alpha),uAlpha:R.create(o.alpha),uVertexCount:R.create(s.vertexCount),uGroupCount:R.create(s.groupCount),drawCount:R.create(s.drawCount),uMetalness:R.create(o.material.metalness),uRoughness:R.create(o.material.roughness),uBumpiness:R.create(o.material.bumpiness),dLightCount:R.create(1),dClipObjectCount:R.create(u.objects.count),dClipVariant:R.create(u.variant),uClipObjectType:R.create(u.objects.type),uClipObjectInvert:R.create(u.objects.invert),uClipObjectPosition:R.create(u.objects.position),uClipObjectRotation:R.create(u.objects.rotation),uClipObjectScale:R.create(u.objects.scale)}}e.createValues=r;function n(o,s){R.updateIfChanged(o.alpha,s.alpha),R.updateIfChanged(o.uMetalness,s.material.metalness),R.updateIfChanged(o.uRoughness,s.material.roughness),R.updateIfChanged(o.uBumpiness,s.material.bumpiness);var u=fd.getClip(s.clip);R.update(o.dClipObjectCount,u.objects.count),R.update(o.dClipVariant,u.variant),R.update(o.uClipObjectType,u.objects.type),R.update(o.uClipObjectInvert,u.objects.invert),R.update(o.uClipObjectPosition,u.objects.position),R.update(o.uClipObjectRotation,u.objects.rotation),R.update(o.uClipObjectScale,u.objects.scale)}e.updateValues=n;function a(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s}}e.createRenderableState=a;function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=i})(at||(at={}));function Ele(e,t,r,n){for(var a=t;a<r;++a)$e.toArray(n,e,a*4),e[a*4+3]=255;return!0}function SR(e,t,r){return e.fill(0,t*4,r*4),!0}function Ile(e,t){var r=fa(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(R.update(t.tOverpaint,r),R.update(t.uOverpaintTexDim,ke.create(r.width,r.height)),R.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:R.create(r),uOverpaintTexDim:R.create(ke.create(r.width,r.height)),dOverpaint:R.create(e>0),tOverpaintGrid:R.create(Ei()),uOverpaintGridDim:R.create(w.create(1,1,1)),uOverpaintGridTransform:R.create(Jt.create(0,0,0,1)),dOverpaintType:R.create("groupInstance")}}var xR={array:new Uint8Array(4),width:1,height:1};function Kl(e){return e?(R.update(e.tOverpaint,xR),R.update(e.uOverpaintTexDim,ke.create(1,1)),e):{tOverpaint:R.create(xR),uOverpaintTexDim:R.create(ke.create(1,1)),dOverpaint:R.create(!1),tOverpaintGrid:R.create(Ei()),uOverpaintGridDim:R.create(w.create(1,1,1)),uOverpaintGridTransform:R.create(Jt.create(0,0,0,1)),dOverpaintType:R.create("groupInstance")}}function Dle(e,t,r,n){for(var a=t;a<r;++a)e[a]=n*255;return!0}function d9(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function Mle(e,t,r){e.fill(0,t,r)}function Rle(e,t){var r=fa(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(R.update(t.tTransparency,r),R.update(t.uTransparencyTexDim,ke.create(r.width,r.height)),R.updateIfChanged(t.dTransparency,e>0),R.updateIfChanged(t.transparencyAverage,d9(r.array,e)),t):{tTransparency:R.create(r),uTransparencyTexDim:R.create(ke.create(r.width,r.height)),dTransparency:R.create(e>0),transparencyAverage:R.create(0),tTransparencyGrid:R.create(Ei()),uTransparencyGridDim:R.create(w.create(1,1,1)),uTransparencyGridTransform:R.create(Jt.create(0,0,0,1)),dTransparencyType:R.create("groupInstance")}}var CR={array:new Uint8Array(1),width:1,height:1};function Ql(e){return e?(R.update(e.tTransparency,CR),R.update(e.uTransparencyTexDim,ke.create(1,1)),e):{tTransparency:R.create(CR),uTransparencyTexDim:R.create(ke.create(1,1)),dTransparency:R.create(!1),transparencyAverage:R.create(0),tTransparencyGrid:R.create(Ei()),uTransparencyGridDim:R.create(w.create(1,1,1)),uTransparencyGridTransform:R.create(Jt.create(0,0,0,1)),dTransparencyType:R.create("groupInstance")}}function Ole(e,t,r,n){return e.fill(n,t,r),!0}function Ble(e,t,r){e.fill(0,t,r)}function kle(e,t){var r=fa(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(R.update(t.tClipping,r),R.update(t.uClippingTexDim,ke.create(r.width,r.height)),R.updateIfChanged(t.dClipping,e>0),t):{tClipping:R.create(r),uClippingTexDim:R.create(ke.create(r.width,r.height)),dClipping:R.create(e>0)}}var wR={array:new Uint8Array(1),width:1,height:1};function Zl(e){return e?(R.update(e.tClipping,wR),R.update(e.uClippingTexDim,ke.create(1,1)),R.updateIfChanged(e.dClipping,!1),e):{tClipping:R.create(wR),uClippingTexDim:R.create(ke.create(1,1)),dClipping:R.create(!1)}}function Lle(e,t,r,n){for(var a=t;a<r;++a)di.toArray(n,e,a*4),e[a*4+3]=255;return!0}function _R(e,t,r){return e.fill(0,t*4,r*4),!0}function Fle(e,t){var r=fa(Math.max(1,e),4,Uint8Array,t&&t.tSubstance.ref.value.array);return t?(R.update(t.tSubstance,r),R.update(t.uSubstanceTexDim,ke.create(r.width,r.height)),R.updateIfChanged(t.dSubstance,e>0),t):{tSubstance:R.create(r),uSubstanceTexDim:R.create(ke.create(r.width,r.height)),dSubstance:R.create(e>0),tSubstanceGrid:R.create(Ei()),uSubstanceGridDim:R.create(w.create(1,1,1)),uSubstanceGridTransform:R.create(Jt.create(0,0,0,1)),dSubstanceType:R.create("groupInstance")}}var AR={array:new Uint8Array(4),width:1,height:1};function $l(e){return e?(R.update(e.tSubstance,AR),R.update(e.uSubstanceTexDim,ke.create(1,1)),e):{tSubstance:R.create(AR),uSubstanceTexDim:R.create(ke.create(1,1)),dSubstance:R.create(!1),tSubstanceGrid:R.create(Ei()),uSubstanceGridDim:R.create(w.create(1,1,1)),uSubstanceGridTransform:R.create(Jt.create(0,0,0,1)),dSubstanceType:R.create("groupInstance")}}var Rt;(function(e){function t(I,M,B,U,V,F,Y){return Y?i(I,M,B,U,V,F,Y):a(I,M,B,U,V,F)}e.create=t;function r(I){var M=I?I.vertexBuffer.ref.value:new Float32Array(0),B=I?I.indexBuffer.ref.value:new Uint32Array(0),U=I?I.normalBuffer.ref.value:new Float32Array(0),V=I?I.groupBuffer.ref.value:new Float32Array(0);return t(M,B,U,V,0,0,I)}e.createEmpty=r;function n(I){return vi([I.vertexCount,I.triangleCount,I.vertexBuffer.ref.version,I.indexBuffer.ref.version,I.normalBuffer.ref.version,I.groupBuffer.ref.version])}function a(I,M,B,U,V,F){var Y=Me(),W,K=-1,$=-1,J={kind:"mesh",vertexCount:V,triangleCount:F,vertexBuffer:R.create(I),indexBuffer:R.create(M),normalBuffer:R.create(B),groupBuffer:R.create(U),get boundingSphere(){var Z=n(J);if(Z!==K){var N=Id(J.vertexBuffer.ref.value,J.vertexCount,1);Me.copy(Y,N),K=Z}return Y},get groupMapping(){return J.groupBuffer.ref.version!==$&&(W=Bm(J.groupBuffer.ref.value,J.vertexCount),$=J.groupBuffer.ref.version),W},setBoundingSphere:function(Z){Me.copy(Y,Z),K=n(J)},meta:{}};return J}function i(I,M,B,U,V,F,Y){return Y.vertexCount=V,Y.triangleCount=F,R.update(Y.vertexBuffer,I),R.update(Y.indexBuffer,M),R.update(Y.normalBuffer,B),R.update(Y.groupBuffer,U),Y}function o(I){var M=I.vertexCount,B=I.triangleCount,U=I.vertexBuffer.ref.value,V=I.indexBuffer.ref.value,F=I.normalBuffer.ref.value.length>=M*3?I.normalBuffer.ref.value:new Float32Array(M*3);F===I.normalBuffer.ref.value&&F.fill(0,0,M*3),G7(U,V,F,M,B),R.update(I.normalBuffer,F)}e.computeNormals=o;function s(I,M){M===void 0&&(M=3);for(var B=I.vertexBuffer.ref.value,U=new Map,V=function(Z,N){return"".concat(Z[0].toFixed(N),"|").concat(Z[1].toFixed(N),"|").concat(Z[2].toFixed(N))},F=0,Y=w(),W=0,K=I.vertexCount;W<K;++W){w.fromArray(Y,B,W*3);var $=V(Y,M),J=U.get($);J!==void 0?(F+=1,U.set($,J+1)):U.set($,1)}return F}e.checkForDuplicateVertices=s;var u=wn();function l(I,M){var B=I.vertexBuffer.ref.value;if(Kf(M,B,0,I.vertexCount),!oe.isTranslationAndUniformScaling(M)){var U=wn.directionTransform(u,M);hoe(U,I.normalBuffer.ref.value,0,I.vertexCount)}R.update(I.vertexBuffer,B)}e.transform=l;function c(I){var M=("kind"in I?I.meta:I.meta.ref.value).originalData;return M}e.getOriginalData=c;function d(I,M){M===void 0&&(M=!0);var B=I.indexBuffer,U=I.vertexBuffer,V=I.groupBuffer,F=I.normalBuffer,Y=I.triangleCount,W=I.vertexCount,K=B.ref.value,$=U.ref.value,J=V.ref.value,Z=F.ref.value,N=Le.create(Uint32Array,3,1024,Y),j=Le.create(Float32Array,3,1024,$);j.currentIndex=W*3,j.elementCount=W;var L=Le.create(Float32Array,3,1024,Z);L.currentIndex=W*3,L.elementCount=W;var H=Le.create(Float32Array,1,1024,J);H.currentIndex=W,H.elementCount=W;var G=w(),q=w(),X=w(),Q=w(),ue=w(),le=w();function ve(De){w.fromArray(G,$,De*3),w.fromArray(Q,Z,De*3),Le.add3(j,G[0],G[1],G[2]),Le.add3(L,Q[0],Q[1],Q[2])}function ge(De,Ie){w.fromArray(G,$,De*3),w.fromArray(q,$,Ie*3),w.scale(G,w.add(G,G,q),.5),w.fromArray(Q,Z,De*3),w.fromArray(ue,Z,Ie*3),w.scale(Q,w.add(Q,Q,ue),.5),Le.add3(j,G[0],G[1],G[2]),Le.add3(L,Q[0],Q[1],Q[2])}function Se(De,Ie,je){w.fromArray(G,$,De*3),w.fromArray(q,$,Ie*3),w.fromArray(X,$,je*3),w.scale(G,w.add(G,w.add(G,G,q),X),1/3),w.fromArray(Q,Z,De*3),w.fromArray(ue,Z,Ie*3),w.fromArray(le,Z,je*3),w.scale(Q,w.add(Q,w.add(Q,Q,ue),le),1/3),Le.add3(j,G[0],G[1],G[2]),Le.add3(L,Q[0],Q[1],Q[2])}function ae(De,Ie,je,st,pt){++O,ve(De),ge(De,Ie),ge(De,je),Le.add3(N,re,re+1,re+2);for(var qe=0;qe<3;++qe)Le.add(H,st);re+=3,O+=2,ve(Ie),ve(je),ge(De,Ie),ge(De,je),Le.add3(N,re,re+1,re+3),Le.add3(N,re,re+3,re+2);for(var qe=0;qe<4;++qe)Le.add(H,pt);re+=4}var re=W,O=0;if(M)for(var z=0,de=Y;z<de;++z){var me=K[z*3],ye=K[z*3+1],Te=K[z*3+2],Oe=J[me],Ue=J[ye],Qe=J[Te];if(Oe===Ue&&Oe===Qe)++O,Le.add3(N,me,ye,Te);else if(Oe===Ue)ae(Te,me,ye,Qe,Oe);else if(Oe===Qe)ae(ye,Te,me,Ue,Qe);else if(Ue===Qe)ae(me,ye,Te,Oe,Ue);else{O+=2,ve(me),ge(me,ye),ge(me,Te),Se(me,ye,Te),Le.add3(N,re,re+1,re+3),Le.add3(N,re,re+3,re+2);for(var Ge=0;Ge<4;++Ge)Le.add(H,Oe);re+=4,O+=2,ve(ye),ge(ye,Te),ge(ye,me),Se(me,ye,Te),Le.add3(N,re,re+1,re+3),Le.add3(N,re,re+3,re+2);for(var Ge=0;Ge<4;++Ge)Le.add(H,Ue);re+=4,O+=2,ve(Te),ge(Te,ye),ge(Te,me),Se(me,ye,Te),Le.add3(N,re+3,re+1,re),Le.add3(N,re+2,re+3,re);for(var Ge=0;Ge<4;++Ge)Le.add(H,Qe);re+=4}}else for(var z=0,de=Y;z<de;++z){var me=K[z*3],ye=K[z*3+1],Te=K[z*3+2],Oe=J[me],Ue=J[ye],Qe=J[Te];if(Oe!==Ue||Oe!==Qe){++O,ve(me),ve(ye),ve(Te),Le.add3(N,re,re+1,re+2);for(var Je=Ue===Qe?Ue:Oe,Ge=0;Ge<3;++Ge)Le.add(H,Je);re+=3}else++O,Le.add3(N,me,ye,Te)}var Ze=Le.compact(N),rt=Le.compact(j),et=Le.compact(L),St=Le.compact(H);return I.vertexCount=re,I.triangleCount=O,R.update(U,rt),R.update(V,St),R.update(B,Ze),R.update(F,et),I.meta.originalData={indexBuffer:K,vertexCount:W,triangleCount:Y},I}e.uniformTriangleGroup=d;function f(I){for(var M=I.vertexCount,B=I.triangleCount,U=I.indexBuffer.ref.value,V=[],F=0;F<M;++F)V[F]=[];for(var F=0;F<B;++F){var Y=U[F*3],W=U[F*3+1],K=U[F*3+2];On(V[Y],W),On(V[Y],K),On(V[W],Y),On(V[W],K),On(V[K],Y),On(V[K],W)}return V}function p(I){for(var M=I.triangleCount,B=I.indexBuffer.ref.value,U=new Map,V=function($,J){var Z=sD($,J),N=U.get(Z)||0;U.set(Z,N+1)},F=0;F<M;++F){var Y=B[F*3],W=B[F*3+1],K=B[F*3+2];V(Y,W),V(Y,K),V(W,K)}return U}function v(I){var M=new Set,B=[0,0];return I.forEach(function(U,V){U===1&&(yY(B,V),M.add(B[0]),M.add(B[1]))}),M}function m(I,M,B){var U=new Map,V=function(F,Y){U.has(F)?On(U.get(F),Y):U.set(F,[Y])};return M.forEach(function(F){for(var Y=I[F],W=0,K=Y;W<K.length;W++){var $=K[W];M.has($)&&B.get(sD(F,$))===1&&V(F,$)}}),U}function h(I,M){for(var B=I.indexBuffer,U=I.triangleCount,V=B.ref.value,F=Le.create(Uint32Array,3,1024,U),Y=0,W=0;W<U;++W){var K=V[W*3],$=V[W*3+1],J=V[W*3+2];M[K].length===2||M[$].length===2||M[J].length===2||(Le.add3(F,K,$,J),Y+=1)}var Z=Le.compact(F);return I.triangleCount=Y,R.update(B,Z),I}function g(I,M,B,U){for(var V,F=I.vertexBuffer,Y=I.indexBuffer,W=I.normalBuffer,K=I.triangleCount,$=F.ref.value,J=Y.ref.value,Z=W.ref.value,N=Le.create(Uint32Array,3,1024,K),j=0,L=0;L<K;++L)Le.add3(N,J[L*3],J[L*3+1],J[L*3+2]),j+=1;var H=w(),G=w(),q=w(),X=w(),Q=w(),ue=w(),le=w(),ve=w(),ge=w(),Se=w(),ae=wr(120),re=new Set,O=Array.from(B.keys()).filter(function(rt){return B.get(rt).length<2}).map(function(rt){var et=B.get(rt);return w.fromArray(H,$,rt*3),w.fromArray(G,$,et[0]*3),w.fromArray(q,$,et[1]*3),w.sub(Q,G,H),w.sub(ue,q,H),[rt,w.angle(Q,ue)]});O.sort(function(rt,et){var St=rt[1],De=et[1];return St-De});for(var z=0,de=O;z<de.length;z++){var me=de[z],ye=me[0],Te=me[1];if(!(re.has(ye)||Te>ae)){var Oe=B.get(ye);if(!(M[Oe[0]].includes(Oe[1])&&!((V=B.get(Oe[0]))===null||V===void 0?void 0:V.includes(Oe[1])))&&(w.fromArray(H,$,ye*3),w.fromArray(G,$,Oe[0]*3),w.fromArray(q,$,Oe[1]*3),w.sub(Q,G,H),w.sub(ue,q,H),w.add(ve,Q,ue),!(w.squaredDistance(H,G)>=U))){for(var Ue=!1,Qe=0,Ge=M[ye];Qe<Ge.length;Qe++){var Je=Ge[Qe];if(!Oe.includes(Je)&&(w.fromArray(X,$,Je*3),w.sub(le,X,H),w.dot(ve,le)<0)){Ue=!0;break}}!Ue||(w.fromArray(ge,Z,ye*3),w.triangleNormal(Se,H,G,q),w.dot(Se,ge)>0?Le.add3(N,ye,Oe[0],Oe[1]):Le.add3(N,Oe[1],Oe[0],ye),re.add(ye),re.add(Oe[0]),re.add(Oe[1]),j+=1)}}}var Ze=Le.compact(N);return I.triangleCount=j,R.update(Y,Ze),I}function y(I,M,B){for(var U=B.iterations,V=B.lambda,F=w(),Y=w(),W=w(),K=w(),$=-V,J=new Float32Array(I.vertexBuffer.ref.value.length),Z=function(j){var L=I.vertexBuffer.ref.value;J.set(L),M.forEach(function(G,q){if(G.length===2){w.fromArray(F,L,q*3),w.fromArray(Y,L,G[0]*3),w.fromArray(W,L,G[1]*3);var X=1/w.distance(F,Y),Q=1/w.distance(F,W);w.scale(Y,Y,X),w.scale(W,W,Q),w.add(K,Y,W),w.scale(K,K,1/(X+Q)),w.sub(K,K,F),w.scale(K,K,j),w.add(K,F,K),w.toArray(K,J,q*3)}});var H=I.vertexBuffer.ref.value;R.update(I.vertexBuffer,J),J=H},N=0;N<U;++N)Z(V),Z($)}function b(I,M){h(I,f(I));for(var B=0;B<10;++B){var U=I.triangleCount,V=p(I),F=f(I),Y=v(V),W=m(F,Y,V);if(g(I,F,W,M.maxNewEdgeLength*M.maxNewEdgeLength),I.triangleCount===U)break}var K=p(I),$=f(I),J=v(K),Z=m($,J,K);return y(I,Z,{iterations:M.iterations,lambda:.5}),I}e.smoothEdges=b,e.Params=_(_({},at.Params),{doubleSided:E.Boolean(!1,at.CustomQualityParamInfo),flipSided:E.Boolean(!1,at.ShadingCategory),flatShaded:E.Boolean(!1,at.ShadingCategory),ignoreLight:E.Boolean(!1,at.ShadingCategory),xrayShaded:E.Boolean(!1,at.ShadingCategory),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:E.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:C,createValuesSimple:x,updateValues:A,updateBoundingSphere:P,createRenderableState:T,updateRenderableState:D,createPositionIterator:S};function S(I,M){var B=I.vertexCount,U=M.instanceCount.ref.value,V=bp(),F=V.position,Y=I.vertexBuffer.ref.value,W=M.aTransform.ref.value,K=function($,J){return J<0?w.fromArray(F,Y,$*3):w.transformMat4Offset(F,Y,W,0,$*3,J*16),V};return sn(B,U,1,K)}function C(I,M,B,U,V){var F=B.instanceCount,Y=B.groupCount,W=S(I,M),K=Po(B,W,U.color),$=ms(F*Y),J=Kl(),Z=Ql(),N=$l(),j=Zl(),L={drawCount:I.triangleCount*3,vertexCount:I.vertexCount,groupCount:Y,instanceCount:F},H=Me.clone(I.boundingSphere),G=xa(H,M.aTransform.ref.value,F);return _(_(_(_(_(_(_(_(_({dGeometryType:R.create("mesh"),aPosition:I.vertexBuffer,aNormal:I.normalBuffer,aGroup:I.groupBuffer,elements:I.indexBuffer,boundingSphere:R.create(G),invariantBoundingSphere:R.create(H),uInvariantBoundingSphere:R.create(Jt.ofSphere(H))},K),$),J),Z),N),j),M),at.createValues(V,L)),{uDoubleSided:R.create(V.doubleSided),dFlatShaded:R.create(V.flatShaded),dFlipSided:R.create(V.flipSided),dIgnoreLight:R.create(V.ignoreLight),dXrayShaded:R.create(V.xrayShaded),uBumpFrequency:R.create(V.bumpFrequency),uBumpAmplitude:R.create(V.bumpAmplitude),meta:R.create(I.meta)})}function x(I,M,B,U,V){var F=at.createSimple(B,U,V),Y=_(_({},E.getDefaultValues(e.Params)),M);return C(I,F.transform,F.locationIterator,F.theme,Y)}function A(I,M){at.updateValues(I,M),R.updateIfChanged(I.uDoubleSided,M.doubleSided),R.updateIfChanged(I.dFlatShaded,M.flatShaded),R.updateIfChanged(I.dFlipSided,M.flipSided),R.updateIfChanged(I.dIgnoreLight,M.ignoreLight),R.updateIfChanged(I.dXrayShaded,M.xrayShaded),R.updateIfChanged(I.uBumpFrequency,M.bumpFrequency),R.updateIfChanged(I.uBumpAmplitude,M.bumpAmplitude)}function P(I,M){var B=Me.clone(M.boundingSphere),U=xa(B,I.aTransform.ref.value,I.instanceCount.ref.value);Me.equals(U,I.boundingSphere.ref.value)||R.update(I.boundingSphere,U),Me.equals(B,I.invariantBoundingSphere.ref.value)||(R.update(I.invariantBoundingSphere,B),R.update(I.uInvariantBoundingSphere,Jt.fromSphere(I.uInvariantBoundingSphere.ref.value,B)))}function T(I){var M=at.createRenderableState(I);return D(M,I),M}function D(I,M){at.updateRenderableState(I,M),I.opaque=I.opaque&&!M.xrayShaded,I.writeDepth=I.opaque}})(Rt||(Rt={}));function Rg(e,t,r){return e=Ha(Math.round(e),0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function qP(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var Ty=255/256,qC=w.create(256*256*256,256*256,256),Nle=Jt.create(Ty/qC[0],Ty/qC[1],Ty/qC[2],Ty/1),TR=Jt();function Ule(e,t,r,n){return Jt.set(TR,e/255,t/255,r/255,n/255),Jt.dot(TR,Nle)}function Jl(e,t,r){switch(Fa.getGranularity(e,t.granularity)){case"uniform":return Gle(e,t.size,r);case"group":return jle(e,t.size,r);case"groupInstance":return Wle(e,t.size,r);case"instance":return qle(e,t.size,r)}}var IS=100;function og(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=qP(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/IS}}var zle={array:new Uint8Array(3),width:1,height:1};function Vle(){return{tSize:R.create(zle),uSizeTexDim:R.create(ke.create(1,1))}}function Hle(e,t){return t?(R.update(t.uSize,e),R.updateIfChanged(t.dSizeType,"uniform"),t):_(_({uSize:R.create(e)},Vle()),{dSizeType:R.create("uniform")})}function Gle(e,t,r){return Hle(t(wo),r)}function jP(e,t,r){return r?(R.update(r.tSize,e),R.update(r.uSizeTexDim,ke.create(e.width,e.height)),R.updateIfChanged(r.dSizeType,t),r):{uSize:R.create(0),tSize:R.create(e),uSizeTexDim:R.create(ke.create(e.width,e.height)),dSizeType:R.create(t)}}function qle(e,t,r){var n=e.instanceCount,a=fa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Rg(t(i.location)*IS,a.array,i.instanceIndex*3),e.skipInstance()}return jP(a,"instance",r)}function jle(e,t,r){var n=e.groupCount,a=fa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Rg(t(i.location)*IS,a.array,i.groupIndex*3)}return jP(a,"group",r)}function Wle(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=fa(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();Rg(t(s.location)*IS,o.array,s.index*3)}return jP(o,"groupInstance",r)}var Qf;(function(e){function t(v,m,h,g){return g?i(v,m,h,g):a(v,m,h)}e.create=t;function r(v){var m=v?v.centerBuffer.ref.value:new Float32Array(0),h=v?v.groupBuffer.ref.value:new Float32Array(0);return t(m,h,0,v)}e.createEmpty=r;function n(v){return vi([v.pointCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function a(v,m,h){var g=Me(),y,b=-1,S=-1,C={kind:"points",pointCount:h,centerBuffer:R.create(v),groupBuffer:R.create(m),get boundingSphere(){var x=n(C);if(x!==b){var A=Id(C.centerBuffer.ref.value,C.pointCount,1);Me.copy(g,A),b=x}return g},get groupMapping(){return C.groupBuffer.ref.version!==S&&(y=Bm(C.groupBuffer.ref.value,C.pointCount),S=C.groupBuffer.ref.version),y},setBoundingSphere:function(x){Me.copy(g,x),b=n(C)}};return C}function i(v,m,h,g){return g.pointCount=h,R.update(g.centerBuffer,v),R.update(g.groupBuffer,m),g}function o(v,m){var h=v.centerBuffer.ref.value;Kf(m,h,0,v.pointCount),R.update(v.centerBuffer,h)}e.transform=o,e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params=_(_({},at.Params),{sizeFactor:E.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:E.Boolean(!1),pointStyle:E.Select("square",E.objectToOptions(e.StyleTypes))}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(v,m){var h=v.pointCount,g=m.instanceCount.ref.value,y=bp(),b=y.position,S=v.centerBuffer.ref.value,C=m.aTransform.ref.value,x=function(A,P){return P<0?w.fromArray(b,S,A*3):w.transformMat4Offset(b,S,C,0,A*3,P*16),y};return sn(h,g,1,x)}function u(v,m,h,g,y){var b=h.instanceCount,S=h.groupCount,C=s(v,m),x=Po(h,C,g.color),A=Jl(h,g.size),P=ms(b*S),T=Kl(),D=Ql(),I=$l(),M=Zl(),B={drawCount:v.pointCount,vertexCount:v.pointCount,groupCount:S,instanceCount:b},U=Me.clone(v.boundingSphere),V=xa(U,m.aTransform.ref.value,b);return _(_(_(_(_(_(_(_(_(_({dGeometryType:R.create("points"),aPosition:v.centerBuffer,aGroup:v.groupBuffer,boundingSphere:R.create(V),invariantBoundingSphere:R.create(U),uInvariantBoundingSphere:R.create(Jt.ofSphere(U))},x),A),P),T),D),I),M),m),at.createValues(y,B)),{uSizeFactor:R.create(y.sizeFactor),dPointSizeAttenuation:R.create(y.pointSizeAttenuation),dPointStyle:R.create(y.pointStyle)})}function l(v,m,h,g,y){var b=at.createSimple(h,g,y),S=_(_({},E.getDefaultValues(e.Params)),m);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,m){at.updateValues(v,m),R.updateIfChanged(v.uSizeFactor,m.sizeFactor),R.updateIfChanged(v.dPointSizeAttenuation,m.pointSizeAttenuation),R.updateIfChanged(v.dPointStyle,m.pointStyle)}function d(v,m){var h=Me.clone(m.boundingSphere),g=xa(h,v.aTransform.ref.value,v.instanceCount.ref.value);Me.equals(g,v.boundingSphere.ref.value)||R.update(v.boundingSphere,g),Me.equals(h,v.invariantBoundingSphere.ref.value)||(R.update(v.invariantBoundingSphere,h),R.update(v.uInvariantBoundingSphere,Jt.fromSphere(v.uInvariantBoundingSphere.ref.value,h)))}function f(v){var m=at.createRenderableState(v);return p(m,v),m}function p(v,m){at.updateRenderableState(v,m),v.opaque=v.opaque&&m.pointStyle!=="fuzzy",v.writeDepth=v.opaque}})(Qf||(Qf={}));function PR(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];ER(n,a,i,o,r);for(var u=0;u<r;u++)e[u*t+s]=a[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];ER(n,a,i,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function ER(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);o++,r[o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}var jC={};function Xle(e){var t=JSON.stringify(e);return jC[t]===void 0&&(jC[t]=new Yle(e)),jC[t]}var f9={fontFamily:E.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:E.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:E.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:E.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:E.Select("normal",[["normal","Normal"],["bold","Bold"]])},Yle=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=_(_({},E.getDefaultValues(f9)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=fa(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font="".concat(r.fontStyle," ").concat(r.fontVariant," ").concat(r.fontWeight," ").concat(n,"px ").concat(r.fontFamily),this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}PR(this.gridOuter,o,r,this.f,this.d,this.v,this.z),PR(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];a[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),cs;(function(e){function t(p,v,m,h,g,y,b,S,C){return C?i(p,v,m,h,g,y,b,S,C):a(p,v,m,h,g,y,b,S)}e.create=t;function r(p){var v=p?p.fontTexture.ref.value:fa(0,1,Uint8Array),m=p?p.centerBuffer.ref.value:new Float32Array(0),h=p?p.mappingBuffer.ref.value:new Float32Array(0),g=p?p.depthBuffer.ref.value:new Float32Array(0),y=p?p.indexBuffer.ref.value:new Uint32Array(0),b=p?p.groupBuffer.ref.value:new Float32Array(0),S=p?p.tcoordBuffer.ref.value:new Float32Array(0);return t(v,m,h,g,y,b,S,0,p)}e.createEmpty=r;function n(p){return vi([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function a(p,v,m,h,g,y,b,S){var C=Me(),x,A=-1,P=-1,T={kind:"text",charCount:S,fontTexture:R.create(p),centerBuffer:R.create(v),mappingBuffer:R.create(m),depthBuffer:R.create(h),indexBuffer:R.create(g),groupBuffer:R.create(y),tcoordBuffer:R.create(b),get boundingSphere(){var D=n(T);if(D!==A){var I=Id(T.centerBuffer.ref.value,T.charCount*4,4);Me.copy(C,I),A=D}return C},get groupMapping(){return T.groupBuffer.ref.version!==P&&(x=Bm(T.groupBuffer.ref.value,T.charCount,4),P=T.groupBuffer.ref.version),x},setBoundingSphere:function(D){Me.copy(C,D),A=n(T)}};return T}function i(p,v,m,h,g,y,b,S,C){return C.charCount=S,R.update(C.fontTexture,p),R.update(C.centerBuffer,v),R.update(C.mappingBuffer,m),R.update(C.depthBuffer,h),R.update(C.indexBuffer,g),R.update(C.groupBuffer,y),R.update(C.tcoordBuffer,b),C}e.Params=_(_(_({},at.Params),f9),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),borderWidth:E.Numeric(0,{min:0,max:.5,step:.01}),borderColor:E.Color(tr.grey),offsetX:E.Numeric(0,{min:0,max:10,step:.1}),offsetY:E.Numeric(0,{min:0,max:10,step:.1}),offsetZ:E.Numeric(0,{min:0,max:10,step:.1}),background:E.Boolean(!1),backgroundMargin:E.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:E.Color(tr.grey),backgroundOpacity:E.Numeric(1,{min:0,max:1,step:.01}),tether:E.Boolean(!1),tetherLength:E.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:E.Numeric(.3,{min:0,max:1,step:.01}),attachment:E.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,v){var m=p.charCount*4,h=v.instanceCount.ref.value,g=bp(),y=g.position,b=p.centerBuffer.ref.value,S=v.aTransform.ref.value,C=function(x,A){return A<0?w.fromArray(y,b,x*3):w.transformMat4Offset(y,b,S,0,x*3,A*16),g};return sn(m,h,4,C)}function s(p,v,m,h,g){var y=m.instanceCount,b=m.groupCount,S=o(p,v),C=Po(m,S,h.color),x=Jl(m,h.size),A=ms(y*b),P=Kl(),T=Ql(),D=$l(),I=Zl(),M={drawCount:p.charCount*2*3,vertexCount:p.charCount*4,groupCount:b,instanceCount:y},B=IR(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,og(x)),U=Me.expand(Me(),p.boundingSphere,B),V=xa(U,v.aTransform.ref.value,y);return _(_(_(_(_(_(_(_(_(_(_({dGeometryType:R.create("text"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:R.create(V),invariantBoundingSphere:R.create(U),uInvariantBoundingSphere:R.create(Jt.ofSphere(U))},C),x),A),P),T),D),I),v),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:R.create(B)}),at.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),uBorderWidth:R.create(Ha(g.borderWidth,0,.5)),uBorderColor:R.create($e.toArrayNormalized(g.borderColor,w.zero(),0)),uOffsetX:R.create(g.offsetX),uOffsetY:R.create(g.offsetY),uOffsetZ:R.create(g.offsetZ),uBackgroundColor:R.create($e.toArrayNormalized(g.backgroundColor,w.zero(),0)),uBackgroundOpacity:R.create(g.backgroundOpacity)})}function u(p,v,m,h,g){var y=at.createSimple(m,h,g),b=_(_({},E.getDefaultValues(e.Params)),v);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,v){at.updateValues(p,v),R.updateIfChanged(p.uSizeFactor,v.sizeFactor),R.updateIfChanged(p.uBorderWidth,v.borderWidth),$e.fromNormalizedArray(p.uBorderColor.ref.value,0)!==v.borderColor&&($e.toArrayNormalized(v.borderColor,p.uBorderColor.ref.value,0),R.update(p.uBorderColor,p.uBorderColor.ref.value)),R.updateIfChanged(p.uOffsetX,v.offsetX),R.updateIfChanged(p.uOffsetY,v.offsetY),R.updateIfChanged(p.uOffsetZ,v.offsetZ),$e.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==v.backgroundColor&&($e.toArrayNormalized(v.backgroundColor,p.uBackgroundColor.ref.value,0),R.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),R.updateIfChanged(p.uBackgroundOpacity,v.backgroundOpacity)}function c(p,v){var m=IR(p.aMapping.ref.value,p.aDepth.ref.value,v.charCount,og(p)),h=Me.expand(Me(),v.boundingSphere,m),g=xa(h,p.aTransform.ref.value,p.instanceCount.ref.value);Me.equals(g,p.boundingSphere.ref.value)||R.update(p.boundingSphere,g),Me.equals(h,p.invariantBoundingSphere.ref.value)||(R.update(p.invariantBoundingSphere,h),R.update(p.uInvariantBoundingSphere,Jt.fromSphere(p.uInvariantBoundingSphere.ref.value,h))),R.update(p.padding,m)}function d(p){var v=at.createRenderableState(p);return f(v,p),v}function f(p,v){at.updateRenderableState(p,v),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}})(cs||(cs={}));function IR(e,t,r,n){for(var a=0,i=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>a&&(a=l);var c=Math.abs(e[u+1]);c>a&&(a=c);var d=Math.abs(t[o]);d>i&&(i=d)}return Math.max(i,n+n*a)}var ru=w(),nu=w(),qd=w(),DR=Le.add,Py=Le.add3,to;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Le.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Le.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Le.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(d,f,p,v,m,h,g){for(var y=0;y<4;++y)Py(o,d,f,p),Py(s,v,m,h),DR(i,g)},l=function(d,f,p){for(var v=0;v<4;++v)Py(o,d[0],d[1],d[2]),Py(s,f[0],f[1],f[2]),DR(i,p)},c=function(d,f,p,v){var m=w.distance(d,f),h=Math.floor(p/2),g=1/p;w.sub(qd,f,d);for(var y=0;y<h;++y){var b=g*(y*2+1);w.setMagnitude(qd,qd,m*b),w.add(ru,d,qd),w.setMagnitude(qd,qd,m*g*((y+1)*2)),w.add(nu,d,qd),u(ru[0],ru[1],ru[2],nu[0],nu[1],nu[2],v)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,p,v){var m=w.distance(d,f);c(d,f,m/p,v)},addCage:function(d,f,p){for(var v=f.vertices,m=f.edges,h=0,g=m.length;h<g;h+=2)w.fromArray(ru,v,m[h]*3),w.fromArray(nu,v,m[h+1]*3),w.transformMat4(ru,ru,d),w.transformMat4(nu,nu,d),u(ru[0],ru[1],ru[2],nu[0],nu[1],nu[2],p)},getLines:function(){var d=i.elementCount/4,f=Le.compact(i,!0),p=Le.compact(o,!0),v=Le.compact(s,!0),m=a&&d<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(d*8),h=a&&d<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(d*6);return(!a||d>a.lineCount)&&Kle(d,m,h),on.create(m,h,f,p,v,d,a)}}}e.create=t})(to||(to={}));function Kle(e,t,r){for(var n=0;n<e;++n){var a=n*8;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(var n=0;n<e;++n){var i=n*4,o=n*6;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}var on;(function(e){function t(p,v,m,h,g,y,b){return b?o(p,v,m,h,g,y,b):i(p,v,m,h,g,y)}e.create=t;function r(p){var v=p?p.mappingBuffer.ref.value:new Float32Array(0),m=p?p.indexBuffer.ref.value:new Uint32Array(0),h=p?p.groupBuffer.ref.value:new Float32Array(0),g=p?p.startBuffer.ref.value:new Float32Array(0),y=p?p.endBuffer.ref.value:new Float32Array(0);return t(v,m,h,g,y,0,p)}e.createEmpty=r;function n(p,v){for(var m=p.vertexBuffer.ref.value,h=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=to.create(p.triangleCount*3,p.triangleCount/10,v),b=0,S=p.triangleCount*3;b<S;b+=3){var C=h[b],x=h[b+1],A=h[b+2],P=m[C*3],T=m[C*3+1],D=m[C*3+2],I=m[x*3],M=m[x*3+1],B=m[x*3+2],U=m[A*3],V=m[A*3+1],F=m[A*3+2];y.add(P,T,D,I,M,B,g[C]),y.add(P,T,D,U,V,F,g[C]),y.add(I,M,B,U,V,F,g[x])}return y.getLines()}e.fromMesh=n;function a(p){return vi([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function i(p,v,m,h,g,y){var b=Me(),S,C=-1,x=-1,A={kind:"lines",lineCount:y,mappingBuffer:R.create(p),indexBuffer:R.create(v),groupBuffer:R.create(m),startBuffer:R.create(h),endBuffer:R.create(g),get boundingSphere(){var P=a(A);if(P!==C){var T=Id(A.startBuffer.ref.value,A.lineCount*4,4),D=Id(A.endBuffer.ref.value,A.lineCount*4,4);Me.expandBySphere(b,T,D),C=P}return b},get groupMapping(){return A.groupBuffer.ref.version!==x&&(S=Bm(A.groupBuffer.ref.value,A.lineCount,4),x=A.groupBuffer.ref.version),S},setBoundingSphere:function(P){Me.copy(b,P),C=a(A)}};return A}function o(p,v,m,h,g,y,b){return y>b.lineCount&&(R.update(b.mappingBuffer,p),R.update(b.indexBuffer,v)),b.lineCount=y,R.update(b.groupBuffer,m),R.update(b.startBuffer,h),R.update(b.endBuffer,g),b}function s(p,v){var m=p.startBuffer.ref.value;Kf(v,m,0,p.lineCount*4),R.update(p.startBuffer,m);var h=p.endBuffer.ref.value;Kf(v,h,0,p.lineCount*4),R.update(p.endBuffer,h)}e.transform=s,e.Params=_(_({},at.Params),{sizeFactor:E.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:E.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:at.createRenderableState,updateRenderableState:at.updateRenderableState,createPositionIterator:u};function u(p,v){var m=p.lineCount*4,h=v.instanceCount.ref.value,g=bp(),y=g.position,b=p.startBuffer.ref.value,S=p.endBuffer.ref.value,C=v.aTransform.ref.value,x=function(A,P){var T=A%4===0?b:S;return P<0?w.fromArray(y,T,A*3):w.transformMat4Offset(y,T,C,0,A*3,P*16),g};return sn(m,h,2,x)}function l(p,v,m,h,g){var y=m.instanceCount,b=m.groupCount,S=u(p,v),C=Po(m,S,h.color),x=Jl(m,h.size),A=ms(y*b),P=Kl(),T=Ql(),D=$l(),I=Zl(),M={drawCount:p.lineCount*2*3,vertexCount:p.lineCount*4,groupCount:b,instanceCount:y},B=Me.clone(p.boundingSphere),U=xa(B,v.aTransform.ref.value,y);return _(_(_(_(_(_(_(_(_(_({dGeometryType:R.create("lines"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:R.create(U),invariantBoundingSphere:R.create(B),uInvariantBoundingSphere:R.create(Jt.ofSphere(B))},C),x),A),P),T),D),I),v),at.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),dLineSizeAttenuation:R.create(g.lineSizeAttenuation),uDoubleSided:R.create(!0),dFlipSided:R.create(!1)})}function c(p,v,m,h,g){var y=at.createSimple(m,h,g),b=_(_({},E.getDefaultValues(e.Params)),v);return l(p,y.transform,y.locationIterator,y.theme,b)}function d(p,v){at.updateValues(p,v),R.updateIfChanged(p.uSizeFactor,v.sizeFactor),R.updateIfChanged(p.dLineSizeAttenuation,v.lineSizeAttenuation)}function f(p,v){var m=Me.clone(v.boundingSphere),h=xa(m,p.aTransform.ref.value,p.instanceCount.ref.value);Me.equals(h,p.boundingSphere.ref.value)||R.update(p.boundingSphere,h),Me.equals(m,p.invariantBoundingSphere.ref.value)||(R.update(p.invariantBoundingSphere,m),R.update(p.uInvariantBoundingSphere,Jt.fromSphere(p.uInvariantBoundingSphere.ref.value,m)))}})(on||(on={}));var MR=w(),RR=w(),OR=w();function DS(e,t){for(var r=t.length,n=km(r/3),a=0;a<r;a+=3)w.fromArray(MR,e,t[a]*3),w.fromArray(RR,e,t[a+1]*3),w.fromArray(OR,e,t[a+2]*3),n.add(MR,RR,OR);return n.getPrimitive()}var Ey=w();function km(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),a=new Uint32Array(e*3),i=0,o=0;return{add:function(s,u,l){w.toArray(s,r,i),w.toArray(u,r,i+3),w.toArray(l,r,i+6),w.triangleNormal(Ey,s,u,l);for(var c=0;c<3;++c)w.toArray(Ey,n,i+3*c),a[o+c]=i/3+c;i+=9,o+=3},addQuad:function(s,u,l,c){w.toArray(s,r,i),w.toArray(u,r,i+3),w.toArray(l,r,i+6),w.toArray(c,r,i+9),w.triangleNormal(Ey,s,u,l);for(var d=0;d<4;++d)w.toArray(Ey,n,i+3*d);var f=i/3;a[o]=f,a[o+1]=f+1,a[o+2]=f+2,a[o+3]=f+2,a[o+4]=f+3,a[o+5]=f,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var Hp=w(),Qle=wn();function WP(e,t){for(var r=e.vertices,n=e.normals,a=wn.directionTransform(Qle,t),i=0,o=r.length;i<o;i+=3)w.transformMat4(Hp,w.fromArray(Hp,r,i),t),w.toArray(Hp,r,i),w.transformMat3(Hp,w.fromArray(Hp,n,i),a),w.toArray(Hp,n,i);return e}function zu(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),a=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+i)/e*Math.PI;n[o*3]=Math.cos(u)*a,n[o*3+1]=Math.sin(u)*a,n[o*3+2]=0}return n}function XP(e,t){return{vertices:e,edges:t}}function p9(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var WC=w.zero();function v9(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)w.transformMat4(WC,w.fromArray(WC,r,n),t),w.toArray(WC,r,n);return e}var ju=w(),Wu=w(),Xu=w(),Gp=w(),In=zu(4,!0);function m9(e){for(var t=12,r=e?12*3:6*4,n=km(t,r),a=0;a<4;++a){var i=(a+1)%4;w.set(ju,In[a*3],In[a*3+1],-.5),w.set(Wu,In[i*3],In[i*3+1],-.5),w.set(Xu,In[i*3],In[i*3+1],.5),w.set(Gp,In[a*3],In[a*3+1],.5),e?n.add(ju,Wu,Xu):n.addQuad(ju,Wu,Xu,Gp)}return w.set(ju,In[0],In[1],-.5),w.set(Wu,In[3],In[4],-.5),w.set(Xu,In[6],In[7],-.5),w.set(Gp,In[9],In[10],-.5),e?n.add(Xu,Wu,ju):n.addQuad(Gp,Xu,Wu,ju),w.set(ju,In[0],In[1],.5),w.set(Wu,In[3],In[4],.5),w.set(Xu,In[6],In[7],.5),w.set(Gp,In[9],In[10],.5),e?n.add(ju,Wu,Xu):n.addQuad(ju,Wu,Xu,Gp),n.getPrimitive()}var XC;function YP(){return XC||(XC=m9(!1)),XC}var YC;function Zle(){return YC||(YC=m9(!0)),YC}var KC;function h9(){return KC||(KC=XP([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),KC}function BR(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function kR(e,t){for(var r=It(It([{x:0,alpha:0},{x:0,alpha:0}],e,!0),[{x:1,alpha:0},{x:1,alpha:0}],!1),n=256,a=t?t.ref.value.array:new Uint8Array(n),i=0,o,s,u,l,c,d,f=e.length+1,p=0;p<f;++p){o=r[p+1].x,s=r[p+2].x,u=r[p].alpha,l=r[p+1].alpha,c=r[p+2].alpha,d=r[p+3].alpha;for(var v=Math.round((s-o)*n),m=0;m<v;++m){var h=m/v;a[i]=Math.max(0,M1(u,l,c,d,h,.5)*255),++i}}var g={array:a,width:256,height:1};return t?(R.update(t,g),t):R.create(g)}var QC=YP(),_o;(function(e){function t(h,g,y,b,S,C,x,A,P,T){return T?a(h,g,y,b,S,C,x,A,P,T):n(h,g,y,b,S,C,x,A,P)}e.create=t;function r(h){return vi([h.bboxSize.ref.version,h.gridDimension.ref.version,h.gridTexture.ref.version,h.transform.ref.version,h.gridStats.ref.version])}function n(h,g,y,b,S,C,x,A,P){var T=Me(),D=-1,I=C.getWidth(),M=C.getHeight(),B=C.getDepth(),U={kind:"direct-volume",gridDimension:R.create(g),gridTexture:R.create(C),gridTextureDim:R.create(w.create(I,M,B)),gridStats:R.create(Jt.create(x.min,x.max,x.mean,x.sigma)),bboxMin:R.create(h.min),bboxMax:R.create(h.max),bboxSize:R.create(w.sub(w(),h.max,h.min)),transform:R.create(y),cellDim:R.create(S),unitToCartn:R.create(b),cartnToUnit:R.create(oe.invert(oe(),b)),get boundingSphere(){var V=r(U);if(V!==D){var F=$le(U.gridDimension.ref.value,U.transform.ref.value);Me.copy(T,F),D=V}return T},packedGroup:R.create(A),axisOrder:R.create(P),setBoundingSphere:function(V){Me.copy(T,V),D=r(U)}};return U}function a(h,g,y,b,S,C,x,A,P,T){var D=C.getWidth(),I=C.getHeight(),M=C.getDepth();return R.update(T.gridDimension,g),R.update(T.gridTexture,C),R.update(T.gridTextureDim,w.set(T.gridTextureDim.ref.value,D,I,M)),R.update(T.gridStats,Jt.set(T.gridStats.ref.value,x.min,x.max,x.mean,x.sigma)),R.update(T.bboxMin,h.min),R.update(T.bboxMax,h.max),R.update(T.bboxSize,w.sub(T.bboxSize.ref.value,h.max,h.min)),R.update(T.transform,y),R.update(T.cellDim,S),R.update(T.unitToCartn,b),R.update(T.cartnToUnit,oe.invert(oe(),b)),R.updateIfChanged(T.packedGroup,A),R.updateIfChanged(T.axisOrder,w.fromArray(T.axisOrder.ref.value,P,0)),T}function i(h){var g=Ut(),y=w(),b=oe.identity(),S=oe.identity(),C=w(),x=Ei(),A=Ua.One.stats,P=!1,T=w.create(0,1,2);return t(g,y,b,S,C,x,A,P,T,h)}e.createEmpty=i,e.Params=_(_({},at.Params),{ignoreLight:E.Boolean(!1,at.ShadingCategory),xrayShaded:E.Boolean(!1,at.ShadingCategory),controlPoints:E.LineGraph([ke.create(.19,0),ke.create(.2,.05),ke.create(.25,.05),ke.create(.26,0),ke.create(.79,0),ke.create(.8,.05),ke.create(.85,.05),ke.create(.86,0)],{isEssential:!0}),stepsPerCell:E.Numeric(3,{min:1,max:10,step:1}),jumpLength:E.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:c,createValuesSimple:d,updateValues:f,updateBoundingSphere:p,createRenderableState:v,updateRenderableState:m,createPositionIterator:o};function o(h,g){var y=h.transform.ref.value,b=h.gridDimension.ref.value,S=b[0],C=b[1],x=b[2],A=S*C*x,P=g.instanceCount.ref.value,T=bp(),D=T.position,I=g.aTransform.ref.value,M=function(B,U){var V=Math.floor(B/x);return D[0]=Math.floor(V/C),D[1]=V%C,D[2]=B%x,w.transformMat4(D,D,y),U>=0&&w.transformMat4Offset(D,D,I,0,0,U*16),T};return sn(A,P,1,M)}function s(h,g){return Math.ceil(w.magnitude(h)*g)}function u(h,g){return Math.min.apply(Math,h)*(1/g)}function l(h){return 1/h}function c(h,g,y,b,S){var C=h.gridTexture,x=h.gridTextureDim,A=h.gridStats,P=h.bboxSize,T=h.bboxMin,D=h.bboxMax,I=h.gridDimension,M=h.transform,B=y.instanceCount,U=y.groupCount,V=e.Utils.createPositionIterator(h,g),F=Po(y,V,b.color),Y=ms(B*U),W=Kl(),K=Ql(),$=$l(),J=Zl(),Z=I.ref.value,N=Z[0],j=Z[1],L=Z[2],H={drawCount:QC.indices.length,vertexCount:N*j*L,groupCount:U,instanceCount:B},G=Me.clone(h.boundingSphere),q=xa(G,g.aTransform.ref.value,B),X=BR(S.controlPoints),Q=kR(X);return _(_(_(_(_(_(_(_(_({dGeometryType:R.create("directVolume")},F),Y),W),K),$),J),g),at.createValues(S,H)),{aPosition:R.create(QC.vertices),elements:R.create(QC.indices),boundingSphere:R.create(q),invariantBoundingSphere:R.create(G),uInvariantBoundingSphere:R.create(Jt.ofSphere(G)),uBboxMin:T,uBboxMax:D,uBboxSize:P,uMaxSteps:R.create(s(I.ref.value,S.stepsPerCell)),uStepScale:R.create(u(h.cellDim.ref.value,S.stepsPerCell)),uJumpLength:R.create(S.jumpLength),uTransform:M,uGridDim:I,tTransferTex:Q,uTransferScale:R.create(l(S.stepsPerCell)),dGridTexType:R.create(C.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:x,tGridTex:C,uGridStats:A,uCellDim:h.cellDim,uCartnToUnit:h.cartnToUnit,uUnitToCartn:h.unitToCartn,dPackedGroup:h.packedGroup,dAxisOrder:R.create(h.axisOrder.ref.value.join("")),dIgnoreLight:R.create(S.ignoreLight),dXrayShaded:R.create(S.xrayShaded)})}function d(h,g,y,b,S){var C=at.createSimple(y,b,S),x=_(_({},E.getDefaultValues(e.Params)),g);return c(h,C.transform,C.locationIterator,C.theme,x)}function f(h,g){at.updateValues(h,g),R.updateIfChanged(h.dIgnoreLight,g.ignoreLight),R.updateIfChanged(h.dXrayShaded,g.xrayShaded);var y=BR(g.controlPoints);kR(y,h.tTransferTex),R.updateIfChanged(h.uMaxSteps,s(h.uGridDim.ref.value,g.stepsPerCell)),R.updateIfChanged(h.uStepScale,u(h.uCellDim.ref.value,g.stepsPerCell)),R.updateIfChanged(h.uTransferScale,l(g.stepsPerCell)),R.updateIfChanged(h.uJumpLength,g.jumpLength)}function p(h,g){var y=Me.clone(g.boundingSphere),b=xa(y,h.aTransform.ref.value,h.instanceCount.ref.value);Me.equals(b,h.boundingSphere.ref.value)||R.update(h.boundingSphere,b),Me.equals(y,h.invariantBoundingSphere.ref.value)||(R.update(h.invariantBoundingSphere,y),R.update(h.uInvariantBoundingSphere,Jt.fromSphere(h.uInvariantBoundingSphere.ref.value,y)))}function v(h){var g=at.createRenderableState(h);return g.opaque=!1,g.writeDepth=!1,g}function m(h,g){at.updateRenderableState(h,g),h.opaque=!1,h.writeDepth=!1}})(_o||(_o={}));function $le(e,t){return Me.fromDimensionsAndTransform(Me(),e,t)}var Dd;(function(e){function t(p,v,m,h,g,y){return y?i(p,v,m,h,g,y):a(p,v,m,h,g)}e.create=t;function r(p){var v=p?p.centerBuffer.ref.value:new Float32Array(0),m=p?p.mappingBuffer.ref.value:new Float32Array(0),h=p?p.indexBuffer.ref.value:new Uint32Array(0),g=p?p.groupBuffer.ref.value:new Float32Array(0);return t(v,m,h,g,0,p)}e.createEmpty=r;function n(p){return vi([p.sphereCount,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version])}function a(p,v,m,h,g){var y=Me(),b,S=-1,C=-1,x={kind:"spheres",sphereCount:g,centerBuffer:R.create(p),mappingBuffer:R.create(v),indexBuffer:R.create(m),groupBuffer:R.create(h),get boundingSphere(){var A=n(x);if(A!==S){var P=Id(x.centerBuffer.ref.value,x.sphereCount*4,4);Me.copy(y,P),S=A}return y},get groupMapping(){return x.groupBuffer.ref.version!==C&&(b=Bm(x.groupBuffer.ref.value,x.sphereCount,4),C=x.groupBuffer.ref.version),b},setBoundingSphere:function(A){Me.copy(y,A),S=n(x)}};return x}function i(p,v,m,h,g,y){return g>y.sphereCount&&(R.update(y.mappingBuffer,v),R.update(y.indexBuffer,m)),y.sphereCount=g,R.update(y.centerBuffer,p),R.update(y.groupBuffer,h),y}e.Params=_(_({},at.Params),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),doubleSided:E.Boolean(!1,at.CustomQualityParamInfo),ignoreLight:E.Boolean(!1,at.ShadingCategory),xrayShaded:E.Boolean(!1,at.ShadingCategory),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:E.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,v){var m=p.sphereCount*4,h=v.instanceCount.ref.value,g=bp(),y=g.position,b=p.centerBuffer.ref.value,S=v.aTransform.ref.value,C=function(x,A){return A<0?w.fromArray(y,b,x*3):w.transformMat4Offset(y,b,S,0,x*3,A*16),g};return sn(m,h,4,C)}function s(p,v,m,h,g){var y=m.instanceCount,b=m.groupCount,S=o(p,v),C=Po(m,S,h.color),x=Jl(m,h.size),A=ms(y*b),P=Kl(),T=Ql(),D=$l(),I=Zl(),M={drawCount:p.sphereCount*2*3,vertexCount:p.sphereCount*4,groupCount:b,instanceCount:y},B=p.boundingSphere.radius?og(x)*g.sizeFactor:0,U=Me.expand(Me(),p.boundingSphere,B),V=xa(U,v.aTransform.ref.value,y);return _(_(_(_(_(_(_(_(_(_(_({dGeometryType:R.create("spheres"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:R.create(V),invariantBoundingSphere:R.create(U),uInvariantBoundingSphere:R.create(Jt.ofSphere(U))},C),x),A),P),T),D),I),v),{padding:R.create(B)}),at.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),uDoubleSided:R.create(g.doubleSided),dIgnoreLight:R.create(g.ignoreLight),dXrayShaded:R.create(g.xrayShaded),uBumpFrequency:R.create(g.bumpFrequency),uBumpAmplitude:R.create(g.bumpAmplitude)})}function u(p,v,m,h,g){var y=at.createSimple(m,h,g),b=_(_({},E.getDefaultValues(e.Params)),v);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,v){at.updateValues(p,v),R.updateIfChanged(p.uSizeFactor,v.sizeFactor),R.updateIfChanged(p.uDoubleSided,v.doubleSided),R.updateIfChanged(p.dIgnoreLight,v.ignoreLight),R.updateIfChanged(p.dXrayShaded,v.xrayShaded),R.updateIfChanged(p.uBumpFrequency,v.bumpFrequency),R.updateIfChanged(p.uBumpAmplitude,v.bumpAmplitude)}function c(p,v){var m=v.boundingSphere.radius?og(p)*p.uSizeFactor.ref.value:0,h=Me.expand(Me(),v.boundingSphere,m),g=xa(h,p.aTransform.ref.value,p.instanceCount.ref.value);Me.equals(g,p.boundingSphere.ref.value)||R.update(p.boundingSphere,g),Me.equals(h,p.invariantBoundingSphere.ref.value)||(R.update(p.invariantBoundingSphere,h),R.update(p.uInvariantBoundingSphere,Jt.fromSphere(p.uInvariantBoundingSphere.ref.value,h))),R.update(p.padding,m)}function d(p){var v=at.createRenderableState(p);return f(v,p),v}function f(p,v){at.updateRenderableState(p,v),p.opaque=p.opaque&&!v.xrayShaded,p.writeDepth=p.opaque}})(Dd||(Dd={}));var ds;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,p,v){var m=c.getWidth(),h=c.getHeight();return v?(v.vertexCount=u,v.groupCount=l,R.update(v.geoTextureDim,ke.set(v.geoTextureDim.ref.value,m,h)),R.update(v.vertexTexture,c),R.update(v.groupTexture,d),R.update(v.normalTexture,f),v.doubleBuffer.set(c,d,f),Me.copy(v.boundingSphere,p),v):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:R.create(ke.create(m,h)),vertexTexture:R.create(c),groupTexture:R.create(d),normalTexture:R.create(f),doubleBuffer:new t,boundingSphere:Me.clone(p),meta:{}}}e.create=r;function n(u){var l=u?u.vertexTexture.ref.value:Ei(),c=u?u.groupTexture.ref.value:Ei(),d=u?u.normalTexture.ref.value:Ei(),f=u?u.boundingSphere:Me();return r(0,0,l,c,d,f,u)}e.createEmpty=n,e.Params=_(_({},at.Params),{doubleSided:E.Boolean(!1,at.CustomQualityParamInfo),flipSided:E.Boolean(!1,at.ShadingCategory),flatShaded:E.Boolean(!1,at.ShadingCategory),ignoreLight:E.Boolean(!1,at.ShadingCategory),xrayShaded:E.Boolean(!1,at.ShadingCategory),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:E.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:i,updateValues:o,updateBoundingSphere:s,createRenderableState:at.createRenderableState,updateRenderableState:at.updateRenderableState,createPositionIterator:function(){return sn(1,1,1,function(){return wo})}};function a(u,l,c,d,f){var p=c.instanceCount,v=c.groupCount,m=e.Utils.createPositionIterator(u,l),h=Po(c,m,d.color),g=ms(p*v),y=Kl(),b=Ql(),S=$l(),C=Zl(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:v,instanceCount:p},A=Me.clone(u.boundingSphere),P=xa(A,l.aTransform.ref.value,p);return _(_(_(_(_(_(_(_(_({dGeometryType:R.create("textureMesh"),uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:R.create(P),invariantBoundingSphere:R.create(A),uInvariantBoundingSphere:R.create(Jt.ofSphere(A))},h),g),y),b),S),C),l),at.createValues(f,x)),{uDoubleSided:R.create(f.doubleSided),dFlatShaded:R.create(f.flatShaded),dFlipSided:R.create(f.flipSided),dIgnoreLight:R.create(f.ignoreLight),dXrayShaded:R.create(f.xrayShaded),uBumpFrequency:R.create(f.bumpFrequency),uBumpAmplitude:R.create(f.bumpAmplitude),meta:R.create(u.meta)})}function i(u,l,c,d,f){var p=at.createSimple(c,d,f),v=_(_({},E.getDefaultValues(e.Params)),l);return a(u,p.transform,p.locationIterator,p.theme,v)}function o(u,l){at.updateValues(u,l),R.updateIfChanged(u.uDoubleSided,l.doubleSided),R.updateIfChanged(u.dFlatShaded,l.flatShaded),R.updateIfChanged(u.dFlipSided,l.flipSided),R.updateIfChanged(u.dIgnoreLight,l.ignoreLight),R.updateIfChanged(u.dXrayShaded,l.xrayShaded),R.updateIfChanged(u.uBumpFrequency,l.bumpFrequency),R.updateIfChanged(u.uBumpAmplitude,l.bumpAmplitude)}function s(u,l){var c=Me.clone(l.boundingSphere),d=xa(c,u.aTransform.ref.value,u.instanceCount.ref.value);Me.equals(d,u.boundingSphere.ref.value)||R.update(u.boundingSphere,d),Me.equals(c,u.invariantBoundingSphere.ref.value)||(R.update(u.invariantBoundingSphere,c),R.update(u.uInvariantBoundingSphere,Jt.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(ds||(ds={}));function Jle(e,t){var r={},n={},a={},i={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(a[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:i[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:a,uniformValues:i,materialUniformValues:o,bufferedUniformValues:s}}function ece(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Rr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Re(e,t){return{type:"uniform",kind:e,variant:t}}function Wt(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function Sp(e){return{type:"elements",kind:e}}function qt(e,t){return{type:"define",kind:e,options:t}}function Rn(e){return{type:"value",kind:e}}var ec={uModel:Re("m4"),uView:Re("m4"),uInvView:Re("m4"),uModelView:Re("m4"),uInvModelView:Re("m4"),uProjection:Re("m4"),uInvProjection:Re("m4"),uModelViewProjection:Re("m4"),uInvModelViewProjection:Re("m4"),uIsOrtho:Re("f"),uPixelRatio:Re("f"),uViewport:Re("v4"),uViewOffset:Re("v2"),uDrawingBufferSize:Re("v2"),uCameraPosition:Re("v3"),uCameraDir:Re("v3"),uNear:Re("f"),uFar:Re("f"),uFogNear:Re("f"),uFogFar:Re("f"),uFogColor:Re("v3"),uTransparentBackground:Re("b"),uLightDirection:Re("v3[]"),uLightColor:Re("v3[]"),uAmbientColor:Re("v3"),uPickingAlphaThreshold:Re("f"),uInteriorDarkening:Re("f"),uInteriorColorFlag:Re("b"),uInteriorColor:Re("v3"),uHighlightColor:Re("v3"),uSelectColor:Re("v3"),uHighlightStrength:Re("f"),uSelectStrength:Re("f"),uMarkerPriority:Re("i"),uXrayEdgeFalloff:Re("f"),uRenderWboit:Re("b"),uMarkingDepthTest:Re("b"),uMarkingType:Re("i"),uPickType:Re("i")},tc={tDepth:Wt("texture","depth","ushort","nearest")},rc={uObjectId:Re("i")},tce={uColor:Re("v3","material"),uColorTexDim:Re("v2"),uColorGridDim:Re("v3"),uColorGridTransform:Re("v4"),tColor:Wt("image-uint8","rgb","ubyte","nearest"),tPalette:Wt("image-uint8","rgb","ubyte","nearest"),tColorGrid:Wt("texture","rgb","ubyte","linear"),dColorType:qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:qt("boolean")},Og={uSize:Re("f","material"),uSizeTexDim:Re("v2"),tSize:Wt("image-uint8","rgb","ubyte","nearest"),dSizeType:qt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Re("f")},rce={uMarker:Re("f"),uMarkerTexDim:Re("v2"),tMarker:Wt("image-uint8","alpha","ubyte","nearest"),markerAverage:Rn("number"),markerStatus:Rn("number")},nce={uOverpaintTexDim:Re("v2"),tOverpaint:Wt("image-uint8","rgba","ubyte","nearest"),dOverpaint:qt("boolean"),uOverpaintGridDim:Re("v3"),uOverpaintGridTransform:Re("v4"),tOverpaintGrid:Wt("texture","rgba","ubyte","linear"),dOverpaintType:qt("string",["groupInstance","volumeInstance"])},ace={uTransparencyTexDim:Re("v2"),tTransparency:Wt("image-uint8","alpha","ubyte","nearest"),dTransparency:qt("boolean"),transparencyAverage:Rn("number"),uTransparencyGridDim:Re("v3"),uTransparencyGridTransform:Re("v4"),tTransparencyGrid:Wt("texture","alpha","ubyte","linear"),dTransparencyType:qt("string",["groupInstance","volumeInstance"])},ice={uSubstanceTexDim:Re("v2"),tSubstance:Wt("image-uint8","rgba","ubyte","nearest"),dSubstance:qt("boolean"),uSubstanceGridDim:Re("v3"),uSubstanceGridTransform:Re("v4"),tSubstanceGrid:Wt("texture","rgba","ubyte","linear"),dSubstanceType:qt("string",["groupInstance","volumeInstance"])},oce={uClippingTexDim:Re("v2"),tClipping:Wt("image-uint8","alpha","ubyte","nearest"),dClipping:qt("boolean")},nc=_(_(_(_(_(_(_({dGeometryType:qt("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"])},tce),rce),nce),ace),ice),oce),{dLightCount:qt("number"),dClipObjectCount:qt("number"),dClipVariant:qt("string",["instance","pixel"]),uClipObjectType:Re("i[]"),uClipObjectInvert:Re("b[]"),uClipObjectPosition:Re("v3[]"),uClipObjectRotation:Re("v4[]"),uClipObjectScale:Re("v3[]"),aInstance:Rr("float32",1,1),aTransform:Rr("float32",16,1),uAlpha:Re("f","material"),uMetalness:Re("f","material"),uRoughness:Re("f","material"),uBumpiness:Re("f","material"),uVertexCount:Re("i"),uInstanceCount:Re("i"),uGroupCount:Re("i"),uInvariantBoundingSphere:Re("v4"),drawCount:Rn("number"),instanceCount:Rn("number"),alpha:Rn("number"),matrix:Rn("m4"),transform:Rn("float32"),extraTransform:Rn("float32"),hasReflection:Rn("boolean"),boundingSphere:Rn("sphere"),invariantBoundingSphere:Rn("sphere")}),sce=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,yi=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,uce=gi();function lce(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var cce={colorBlended:"",colorWboit:"",pick:"",depth:"",marking:""},KP=Object.keys(cce),MS=KP.filter(function(e){return e!=="colorWboit"}),dce=KP.filter(function(e){return e!=="colorBlended"}),fce={compute:""},pce=Object.keys(fce);function LR(e,t,r,n,a){return r=_(_({},r),{dRenderVariant:R.create(t)}),a.dRenderVariant===void 0&&Object.defineProperty(a,"dRenderVariant",{value:qt("string")}),e.resources.program(r,n,a)}function vce(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function mce(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function ac(e,t,r,n,a,i,o){return g9(e,t,r,n,a,i,o)}function ea(e,t,r,n,a,i){return i===void 0&&(i=-1),g9(e,t,r,n,a,i,pce)}function g9(e,t,r,n,a,i,o){var s=uce(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;if(a.uVertexCount){var v=a.uVertexCount.ref.value;a.aVertex=R.create(is(new Float32Array(v))),n.aVertex=Rr("float32",1,0)}for(var m=Jle(n,a),h=m.attributeValues,g=m.defineValues,y=m.textureValues,b=m.uniformValues,S=m.materialUniformValues,C=m.bufferedUniformValues,x=Object.entries(b),A=Object.entries(S),P=Object.entries(C),T=Object.entries(Zse(C)),D=Object.entries(g),I=ece(a),M=lce(e,t),B={},U=0,V=o;U<V.length;U++){var F=V[U];B[F]=LR(e,F,g,r,n)}var Y=sle(e,n,y),W=aue(e,n,h),K,$=a.elements;$&&$.ref.value&&(K=c.elements($.ref.value));for(var J={},Z=0,N=o;Z<N.length;Z++){var F=N[Z];J[F]=p?c.vertexArray(B[F],W,K):null}var j=a.drawCount.ref.value,L=a.instanceCount.ref.value;u.drawCount+=j,u.instanceCount+=L,u.instancedDrawCount+=L*j;var H=vce(),G=!1,q=-1;return{id:s,materialId:i,getProgram:function(X){return B[X]},render:function(X,Q){if(!(j===0||L===0||e.isContextLost)){var ue=B[X];if(ue.id===q&&l.currentRenderItemId===s)ue.setUniforms(x),Q&&Q.length>0?(ue.bindTextures(Q,0),ue.bindTextures(Y,Q.length)):ue.bindTextures(Y,0);else{var le=J[X];(ue.id!==l.currentProgramId||ue.id!==q||i===-1||i!==l.currentMaterialId)&&(ue.id!==l.currentProgramId&&ue.use(),ue.setUniforms(A),l.currentMaterialId=i,q=ue.id),ue.setUniforms(x),ue.setUniforms(T),Q&&Q.length>0?(ue.bindTextures(Q,0),ue.bindTextures(Y,Q.length)):ue.bindTextures(Y,0),le?(le.bind(),K&&K.bind()):(K&&K.bind(),ue.bindAttributes(W)),l.currentRenderItemId=s}if(Ar)try{FP(e.gl)}catch(ve){throw new Error("Framebuffer error rendering item id ".concat(s,": '").concat(ve,"'"))}if(K?f.drawElementsInstanced(M,j,K._dataType,0,L):f.drawArraysInstanced(M,0,j,L),Ar)try{J7(e.gl)}catch(ve){throw new Error("Draw error rendering item id ".concat(s,": '").concat(ve,"'"))}}},update:function(){if(mce(H),a.aVertex){var X=a.uVertexCount.ref.value;a.aVertex.ref.value.length<X&&R.update(a.aVertex,is(new Float32Array(X)))}for(var Q=0,ue=D.length;Q<ue;++Q){var le=D[Q],ve=le[0],ge=le[1];ge.ref.version!==I[ve]&&(H.defines=!0,I[ve]=ge.ref.version)}if(H.defines)for(var Se=0,ae=o;Se<ae.length;Se++){var ve=ae[Se];B[ve].destroy(),B[ve]=LR(e,ve,g,r,n)}a.drawCount.ref.version!==I.drawCount&&(u.drawCount+=a.drawCount.ref.value-j,u.instancedDrawCount+=L*a.drawCount.ref.value-L*j,j=a.drawCount.ref.value,I.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==I.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-L,u.instancedDrawCount+=a.instanceCount.ref.value*j-L*j,L=a.instanceCount.ref.value,I.instanceCount=a.instanceCount.ref.version);for(var Q=0,ue=W.length;Q<ue;++Q){var re=W[Q],ve=re[0],O=re[1],ge=h[ve];if(ge.ref.version!==I[ve]){if(O.length>=ge.ref.value.length)O.updateSubData(ge.ref.value,0,O.length);else{O.destroy();var z=n[ve],de=z.itemSize,me=z.divisor;W[Q][1]=c.attribute(ge.ref.value,de,me),H.attributes=!0}I[ve]=ge.ref.version}}if(K&&a.elements.ref.version!==I.elements&&(K.length>=a.elements.ref.value.length?K.updateSubData(a.elements.ref.value,0,K.length):(K.destroy(),K=c.elements(a.elements.ref.value),H.elements=!0),I.elements=a.elements.ref.version),H.attributes||H.defines||H.elements)for(var ye=0,Te=o;ye<Te.length;ye++){var ve=Te[ye],Oe=J[ve];Oe&&Oe.destroy(),J[ve]=p?c.vertexArray(B[ve],W,K):null}for(var Q=0,ue=Y.length;Q<ue;++Q){var Ue=Y[Q],ve=Ue[0],Qe=Ue[1],ge=y[ve];ge.ref.version!==I[ve]&&(n[ve].kind!=="texture"?(Qe.load(ge.ref.value),H.textures=!0):Y[Q][1]=ge.ref.value,I[ve]=ge.ref.version)}for(var Q=0,ue=P.length;Q<ue;++Q){var Ge=P[Q],ve=Ge[0],Je=Ge[1];Je.ref.version!==I[ve]&&(R.update(T[Q][1],Cd(Je.ref.value)),I[ve]=Je.ref.version)}return H},destroy:function(){if(!G){for(var X=0,Q=o;X<Q.length;X++){var ue=Q[X];B[ue].destroy();var le=J[ue];le&&le.destroy()}Y.forEach(function(ve){var ge=ve[0],Se=ve[1];n[ge].kind!=="texture"&&Se.destroy()}),W.forEach(function(ve){ve[0];var ge=ve[1];return ge.destroy()}),K&&K.destroy(),u.drawCount-=j,u.instanceCount-=L,u.instancedDrawCount-=L*j,G=!0}}}}var y9=gi();function ic(e,t,r){return{id:y9(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&R.updateIfChanged(t.uAlpha,Ha(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function ta(e,t){return{id:y9(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var b9=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Ca={drawCount:Rn("number"),instanceCount:Rn("number"),aPosition:Rr("float32",2,0),uQuadScale:Re("v2")},wa={drawCount:R.create(6),instanceCount:R.create(1),aPosition:R.create(b9),uQuadScale:R.create(ke.create(1,1))},hce=_(_({},Ca),{tColor:Wt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2")}),gce=ln("copy",yi,sce);function FR(e,t){var r=_(_({},wa),{tColor:R.create(t),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight()))}),n=_({},hce),a=ea(e,"triangles",gce,n,r);return ta(a,r)}var NR=new Uint32Array([0,1,2,1,3,2]),yce=new Float32Array([0,1,0,0,1,1,1,0]),S9={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},bce=Object.keys(S9),kl;(function(e){function t(f,p,v,m){return m?a(f,p,v,m):n(f,p,v)}e.create=t;function r(f){return vi([f.cornerBuffer.ref.version])}function n(f,p,v){var m=Me(),h=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:R.create(f),imageTextureDim:R.create(ke.create(g,y)),cornerBuffer:R.create(p),groupTexture:R.create(v),get boundingSphere(){var S=r(b);if(S!==h){var C=Sce(b.cornerBuffer.ref.value);Me.copy(m,C),h=S}return m}};return b}function a(f,p,v,m){var h=f.width,g=f.height;return R.update(m.imageTexture,f),R.update(m.imageTextureDim,ke.set(m.imageTextureDim.ref.value,h,g)),R.update(m.cornerBuffer,p),R.update(m.groupTexture,v),m}function i(f){var p=fa(0,4,Uint8Array),v=f?f.cornerBuffer.ref.value:new Float32Array(8*3),m=fa(0,4,Uint8Array);return t(p,v,m,f)}e.createEmpty=i,e.Params=_(_({},at.Params),{interpolation:E.Select("bspline",E.objectToOptions(S9))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return sn(1,1,1,function(){return wo})}};function o(f,p,v,m,h){var g=v.instanceCount,y=v.groupCount,b=e.Utils.createPositionIterator(f,p),S=Po(v,b,m.color),C=ms(g*y),x=Kl(),A=Ql(),P=$l(),T=Zl(),D={drawCount:NR.length,vertexCount:b9.length/3,groupCount:y,instanceCount:g},I=Me.clone(f.boundingSphere),M=xa(I,p.aTransform.ref.value,g);return _(_(_(_(_(_(_(_(_({dGeometryType:R.create("image")},S),C),x),A),P),T),p),at.createValues(h,D)),{aPosition:f.cornerBuffer,aUv:R.create(yce),elements:R.create(NR),aGroup:R.create(is(new Float32Array(4))),boundingSphere:R.create(M),invariantBoundingSphere:R.create(I),uInvariantBoundingSphere:R.create(Jt.ofSphere(I)),dInterpolation:R.create(h.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,p,v,m,h){var g=at.createSimple(v,m,h),y=_(_({},E.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,p){at.updateValues(f,p),R.updateIfChanged(f.dInterpolation,p.interpolation)}function l(f,p){var v=Me.clone(p.boundingSphere),m=xa(v,f.aTransform.ref.value,f.instanceCount.ref.value);Me.equals(m,f.boundingSphere.ref.value)||R.update(f.boundingSphere,m),Me.equals(v,f.invariantBoundingSphere.ref.value)||(R.update(f.invariantBoundingSphere,v),R.update(f.uInvariantBoundingSphere,Jt.fromSphere(f.uInvariantBoundingSphere.ref.value,v)))}function c(f){var p=at.createRenderableState(f);return p.opaque=!1,p}function d(f,p){at.updateRenderableState(f,p),f.opaque=!1}})(kl||(kl={}));function Sce(e){for(var t=w(),r=[],n=0,a=e.length;n<a;n+=3){var i=w.fromArray(w(),e,n);r.push(i),w.add(t,t,i)}w.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var i=u[s],l=w.distance(t,i);l>o&&(o=l)}var c=Me.create(t,o);return Me.setExtrema(c,r),c}var ho;(function(e){function t(v,m,h,g,y,b,S,C,x){return x?i(v,m,h,g,y,b,S,C,x):a(v,m,h,g,y,b,S,C)}e.create=t;function r(v){var m=v?v.mappingBuffer.ref.value:new Float32Array(0),h=v?v.indexBuffer.ref.value:new Uint32Array(0),g=v?v.groupBuffer.ref.value:new Float32Array(0),y=v?v.startBuffer.ref.value:new Float32Array(0),b=v?v.endBuffer.ref.value:new Float32Array(0),S=v?v.scaleBuffer.ref.value:new Float32Array(0),C=v?v.capBuffer.ref.value:new Float32Array(0);return t(m,h,g,y,b,S,C,0,v)}e.createEmpty=r;function n(v){return vi([v.cylinderCount,v.mappingBuffer.ref.version,v.indexBuffer.ref.version,v.groupBuffer.ref.version,v.startBuffer.ref.version,v.endBuffer.ref.version,v.scaleBuffer.ref.version,v.capBuffer.ref.version])}function a(v,m,h,g,y,b,S,C){var x=Me(),A,P=-1,T=-1,D={kind:"cylinders",cylinderCount:C,mappingBuffer:R.create(v),indexBuffer:R.create(m),groupBuffer:R.create(h),startBuffer:R.create(g),endBuffer:R.create(y),scaleBuffer:R.create(b),capBuffer:R.create(S),get boundingSphere(){var I=n(D);if(I!==P){var M=Id(D.startBuffer.ref.value,D.cylinderCount*6,6),B=Id(D.endBuffer.ref.value,D.cylinderCount*6,6);Me.expandBySphere(x,M,B),P=I}return x},get groupMapping(){return D.groupBuffer.ref.version!==T&&(A=Bm(D.groupBuffer.ref.value,D.cylinderCount,6),T=D.groupBuffer.ref.version),A},setBoundingSphere:function(I){Me.copy(x,I),P=n(D)}};return D}function i(v,m,h,g,y,b,S,C,x){return C>x.cylinderCount&&(R.update(x.mappingBuffer,v),R.update(x.indexBuffer,m)),x.cylinderCount=C,R.update(x.groupBuffer,h),R.update(x.startBuffer,g),R.update(x.endBuffer,y),R.update(x.scaleBuffer,b),R.update(x.capBuffer,S),x}function o(v,m){var h=v.startBuffer.ref.value;Kf(m,h,0,v.cylinderCount*6),R.update(v.startBuffer,h);var g=v.endBuffer.ref.value;Kf(m,g,0,v.cylinderCount*6),R.update(v.endBuffer,g)}e.transform=o,e.Params=_(_({},at.Params),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:E.Numeric(1,{min:0,max:3,step:.01}),doubleSided:E.Boolean(!1,at.CustomQualityParamInfo),ignoreLight:E.Boolean(!1,at.ShadingCategory),xrayShaded:E.Boolean(!1,at.ShadingCategory),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:E.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(v,m){var h=v.cylinderCount*6,g=m.instanceCount.ref.value,y=bp(),b=y.position,S=v.startBuffer.ref.value,C=v.endBuffer.ref.value,x=m.aTransform.ref.value,A=function(P,T){var D=P%6===0?S:C;return T<0?w.fromArray(b,D,P*3):w.transformMat4Offset(b,D,x,0,P*3,T*16),y};return sn(h,g,2,A)}function u(v,m,h,g,y){var b=h.instanceCount,S=h.groupCount,C=s(v,m),x=Po(h,C,g.color),A=Jl(h,g.size),P=ms(b*S),T=Kl(),D=Ql(),I=$l(),M=Zl(),B={drawCount:v.cylinderCount*4*3,vertexCount:v.cylinderCount*6,groupCount:S,instanceCount:b},U=og(A)*y.sizeFactor,V=Me.clone(v.boundingSphere),F=xa(V,m.aTransform.ref.value,b);return _(_(_(_(_(_(_(_(_(_(_({dGeometryType:R.create("cylinders"),aMapping:v.mappingBuffer,aGroup:v.groupBuffer,aStart:v.startBuffer,aEnd:v.endBuffer,aScale:v.scaleBuffer,aCap:v.capBuffer,elements:v.indexBuffer,boundingSphere:R.create(F),invariantBoundingSphere:R.create(V),uInvariantBoundingSphere:R.create(Jt.ofSphere(V))},x),A),P),T),D),I),M),m),{padding:R.create(U)}),at.createValues(y,B)),{uSizeFactor:R.create(y.sizeFactor*y.sizeAspectRatio),uDoubleSided:R.create(y.doubleSided),dIgnoreLight:R.create(y.ignoreLight),dXrayShaded:R.create(y.xrayShaded),uBumpFrequency:R.create(y.bumpFrequency),uBumpAmplitude:R.create(y.bumpAmplitude)})}function l(v,m,h,g,y){var b=at.createSimple(h,g,y),S=_(_({},E.getDefaultValues(e.Params)),m);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,m){at.updateValues(v,m),R.updateIfChanged(v.uSizeFactor,m.sizeFactor*m.sizeAspectRatio),R.updateIfChanged(v.uDoubleSided,m.doubleSided),R.updateIfChanged(v.dIgnoreLight,m.ignoreLight),R.updateIfChanged(v.dXrayShaded,m.xrayShaded),R.updateIfChanged(v.uBumpFrequency,m.bumpFrequency),R.updateIfChanged(v.uBumpAmplitude,m.bumpAmplitude)}function d(v,m){var h=Me.clone(m.boundingSphere),g=xa(h,v.aTransform.ref.value,v.instanceCount.ref.value);Me.equals(g,v.boundingSphere.ref.value)||R.update(v.boundingSphere,g),Me.equals(h,v.invariantBoundingSphere.ref.value)||(R.update(v.invariantBoundingSphere,h),R.update(v.uInvariantBoundingSphere,Jt.fromSphere(v.uInvariantBoundingSphere.ref.value,h)))}function f(v){var m=at.createRenderableState(v);return p(m,v),m}function p(v,m){at.updateRenderableState(v,m),v.opaque=v.opaque&&!m.xrayShaded,v.writeDepth=v.opaque}})(ho||(ho={}));var Fa;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Eu(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Eu(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function a(o){switch(o.kind){case"mesh":return Rt.Utils;case"points":return Qf.Utils;case"spheres":return Dd.Utils;case"cylinders":return ho.Utils;case"text":return cs.Utils;case"lines":return on.Utils;case"direct-volume":return _o.Utils;case"image":return kl.Utils;case"texture-mesh":return ds.Utils}}e.getUtils=a;function i(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=i})(Fa||(Fa={}));var xce=1,Cce="Assigns sizes as defined by the shape object.",x9={};function wce(e){return x9}function QP(e,t){return{factory:QP,granularity:"groupInstance",size:function(r){return _i.isLocation(r)?r.shape.getSize(r.group,r.instance):xce},props:t,description:Cce}}var _ce={name:"shape-group",label:"Shape Group",category:"",factory:QP,getParams:wce,defaultValues:E.getDefaultValues(x9),isApplicable:function(e){return!!e.shape}},Ace=$e(13421772),Tce="Assigns colors as defined by the shape object.",C9={};function Pce(e){return C9}function ZP(e,t){return{factory:ZP,granularity:"groupInstance",color:function(r){return _i.isLocation(r)?r.shape.getColor(r.group,r.instance):Ace},props:t,description:Tce}}var Ece={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:ZP,getParams:Pce,defaultValues:E.getDefaultValues(C9),isApplicable:function(e){return!!e.shape}},Ice=_(_({},nc),{aPosition:Rr("float32",3,0),elements:Sp("uint32"),uBboxMin:Re("v3"),uBboxMax:Re("v3"),uBboxSize:Re("v3"),uMaxSteps:Re("i"),uStepScale:Re("f"),uJumpLength:Re("f"),uTransform:Re("m4"),uGridDim:Re("v3"),tTransferTex:Wt("image-uint8","alpha","ubyte","linear"),uTransferScale:Re("f"),dGridTexType:qt("string",["2d","3d"]),uGridTexDim:Re("v3"),tGridTex:Wt("texture","rgba","ubyte","linear"),uGridStats:Re("v4"),uCellDim:Re("v3"),uCartnToUnit:Re("m4"),uUnitToCartn:Re("m4"),dPackedGroup:qt("boolean"),dAxisOrder:qt("string",["012","021","102","120","201","210"]),dIgnoreLight:qt("boolean"),dXrayShaded:qt("boolean")});function Dce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Ice);e.isWebGL2||(o.uMaxSteps=qt("number"));var s={uObjectId:R.create(t)},u=Rse,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Mce=_(_({},nc),{aGroup:Rr("float32",1,0),aPosition:Rr("float32",3,0),aNormal:Rr("float32",3,0),elements:Sp("uint32"),dFlatShaded:qt("boolean"),uDoubleSided:Re("b"),dFlipSided:qt("boolean"),dIgnoreLight:qt("boolean"),dXrayShaded:qt("boolean"),uBumpFrequency:Re("f"),uBumpAmplitude:Re("f"),meta:Rn("unknown")});function Rce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Mce),s={uObjectId:R.create(t)},u=K7,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Oce=_(_(_({},nc),Og),{aGroup:Rr("float32",1,0),aPosition:Rr("float32",3,0),dPointSizeAttenuation:qt("boolean"),dPointStyle:qt("string",["square","circle","fuzzy"])});function Bce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Oce),s={uObjectId:R.create(t)},u=Pse,l=ac(e,"points",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var kce=_(_(_({},nc),Og),{aGroup:Rr("float32",1,0),aMapping:Rr("float32",2,0),aStart:Rr("float32",3,0),aEnd:Rr("float32",3,0),elements:Sp("uint32"),dLineSizeAttenuation:qt("boolean"),uDoubleSided:Re("b"),dFlipSided:qt("boolean")});function Lce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),kce),s={uObjectId:R.create(t)},u=Mse,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Fce=_(_(_({},nc),Og),{aGroup:Rr("float32",1,0),aPosition:Rr("float32",3,0),aMapping:Rr("float32",2,0),elements:Sp("uint32"),padding:Rn("number"),uDoubleSided:Re("b"),dIgnoreLight:qt("boolean"),dXrayShaded:qt("boolean"),uBumpFrequency:Re("f"),uBumpAmplitude:Re("f")});function Nce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Fce),s={uObjectId:R.create(t)},u=Ese,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Uce=_(_(_({},nc),Og),{aGroup:Rr("float32",1,0),aPosition:Rr("float32",3,0),aMapping:Rr("float32",2,0),aDepth:Rr("float32",1,0),elements:Sp("uint32"),aTexCoord:Rr("float32",2,0),tFont:Wt("image-uint8","alpha","ubyte","linear"),padding:Rn("number"),uBorderWidth:Re("f"),uBorderColor:Re("v3"),uOffsetX:Re("f"),uOffsetY:Re("f"),uOffsetZ:Re("f"),uBackgroundColor:Re("v3"),uBackgroundOpacity:Re("f")});function zce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Uce),s={uObjectId:R.create(t)},u=Dse,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Vce=_(_({},nc),{uGeoTexDim:Re("v2","buffered"),tPosition:Wt("texture","rgb","float","nearest"),tGroup:Wt("texture","alpha","float","nearest"),tNormal:Wt("texture","rgb","float","nearest"),dFlatShaded:qt("boolean"),uDoubleSided:Re("b"),dFlipSided:qt("boolean"),dIgnoreLight:qt("boolean"),dXrayShaded:qt("boolean"),uBumpFrequency:Re("f"),uBumpAmplitude:Re("f"),meta:Rn("unknown")});function Hce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Vce),s={uObjectId:R.create(t)},u=K7,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Gce=_(_({},nc),{aGroup:Rr("float32",1,0),aPosition:Rr("float32",3,0),aUv:Rr("float32",2,0),elements:Sp("uint32"),uImageTexDim:Re("v2"),tImageTex:Wt("image-uint8","rgba","ubyte","nearest"),tGroupTex:Wt("image-uint8","rgba","ubyte","nearest"),dInterpolation:qt("string",bce)});function qce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),Gce),s={uObjectId:R.create(t)},u=Ose,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var jce=_(_(_({},nc),Og),{aGroup:Rr("float32",1,0),aStart:Rr("float32",3,0),aEnd:Rr("float32",3,0),aMapping:Rr("float32",3,0),aScale:Rr("float32",1,0),aCap:Rr("float32",1,0),elements:Sp("uint32"),padding:Rn("number"),uDoubleSided:Re("b"),dIgnoreLight:qt("boolean"),dXrayShaded:qt("boolean"),uBumpFrequency:Re("f"),uBumpAmplitude:Re("f")});function Wce(e,t,r,n,a,i){var o=_(_(_(_({},ec),tc),rc),jce),s={uObjectId:R.create(t)},u=Ise,l=ac(e,"triangles",u,o,_(_({},r),s),a,i);return ic(l,r,n)}var Xce=gi(0,2147483647),oc=gi(0,2147483647);function Lm(e,t,r,n){return{id:Xce(),type:e,values:t,state:r,materialId:n}}function Yce(e,t,r){switch(t.type){case"mesh":return Rce(e,t.id,t.values,t.state,t.materialId,r);case"points":return Bce(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return Nce(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return Wce(e,t.id,t.values,t.state,t.materialId,r);case"text":return zce(e,t.id,t.values,t.state,t.materialId,r);case"lines":return Lce(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return Dce(e,t.id,t.values,t.state,t.materialId,r);case"image":return qce(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return Hce(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}var xr;(function(e){function t(c,d,f,p,v,m,h){return{id:Jr.create22(),name:c,sourceData:d,geometry:f,transforms:h||[oe.identity()],get groupCount(){return Fa.getGroupCount(f)},getColor:p,getSize:v,getLabel:m}}e.create=t;function r(c){return{color:ZP({shape:c},{}),size:QP({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=_i.Location(c),p=function(v,m){return f.group=v,f.instance=m,f};return sn(c.groupCount,d,1,p)}e.groupIterator=n;function a(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),p=0,v=c.length;p<v;++p)oe.toArray(c[p],f,p*16);return NP(f,c.length,d)}e.createTransform=a;function i(c,d){var f=e.getTheme(c),p=Fa.getUtils(c.geometry),v=oc(),m=n(c),h=e.createTransform(c.transforms),g=p.createValues(c.geometry,h,m,f,d),y=p.createRenderableState(d);return Lm(c.geometry.kind,g,y,v)}e.createRenderObject=i;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(xr||(xr={}));var _i;(function(e){function t(p,v,m){return v===void 0&&(v=0),m===void 0&&(m=0),{kind:"group-location",shape:p,group:v,instance:m}}e.Location=t;function r(p){return!!p&&p.kind==="group-location"}e.isLocation=r;function n(p,v){return{kind:"group-loci",shape:p,groups:v}}e.Loci=n;function a(p){return!!p&&p.kind==="group-loci"}e.isLoci=a;function i(p,v){if(p.shape!==v.shape||p.groups.length!==v.groups.length)return!1;for(var m=0,h=p.groups.length;m<h;++m){var g=p.groups[m],y=g.ids,b=g.instance,S=v.groups[m],C=S.ids,x=S.instance;if(b!==x||!Ee.areEqual(y,C))return!1}return!0}e.areLociEqual=i;function o(p){return s(p)===0}e.isLociEmpty=o;function s(p){for(var v=0,m=0,h=p.groups;m<h.length;m++){var g=h[m];v+=Ee.size(g.ids)}return v}e.size=s;var u=new Ml,l=w.zero();function c(p,v,m,h){for(var g=v.indices,y=v.offsets,b=function(T,D){Ee.forEach(T,function(I){for(var M=y[I],B=y[I+1];M<B;++M)w.fromArray(l,m,g[M]*3),w.transformMat4(l,l,h[D]),u.includeStep(l)})},S=0,C=p;S<C.length;S++){var x=C[S],A=x.ids,P=x.instance;b(A,P)}}function d(p,v,m,h){for(var g=v.indices,y=v.offsets,b=function(T,D){Ee.forEach(T,function(I){for(var M=y[I],B=y[I+1];M<B;++M)w.fromArray(l,m,g[M]*3),w.transformMat4(l,l,h[D]),u.radiusStep(l)})},S=0,C=p;S<C.length;S++){var x=C[S],A=x.ids,P=x.instance;b(A,P)}}function f(p,v){v||(v=Me()),u.reset();var m=0,h=p.shape,g=h.geometry,y=h.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var S=g.startBuffer.ref.value,C=g.endBuffer.ref.value;c(p.groups,g.groupMapping,S,y),c(p.groups,g.groupMapping,C,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,S,y),d(p.groups,g.groupMapping,C,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);for(var x=function(B,U){Ee.forEach(B,function(V){var F=p.shape.getSize(V,U);m<F&&(m=F)})},A=0,P=p.groups;A<P.length;A++){var T=P[A],D=T.ids,I=T.instance;x(D,I)}}else return Me.copy(v,g.boundingSphere);return w.copy(v.center,u.center),v.radius=Math.sqrt(u.radiusSq),Me.expand(v,v,m),v}e.getBoundingSphere=f})(_i||(_i={}));var RS={kind:"every-loci"};function go(e){return!!e&&e.kind==="every-loci"}var yr={kind:"empty-loci"};function fi(e){return!!e&&e.kind==="empty-loci"}function g0(e){return!!e&&e.kind==="data-loci"}function Kce(e,t){if(!U0(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!U0(e.elements[r],t.elements[r]))return!1;return!0}function Qce(e){return e.elements.length===0}function OS(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}var Xt;(function(e){var t=new To("98");function r(m){var h=m.loci.map(function(x){return s(x)}).filter(function(x){return!!x});t.reset();for(var g=0,y=h;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,C=h;S<C.length;S++){var b=C[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(m,h){return go(m)&&go(h)||fi(m)&&fi(h)?!0:g0(m)&&g0(h)?Kce(m,h):Ne.isLoci(m)&&Ne.isLoci(h)?Ne.areLociEqual(m,h):xe.is(m)&&xe.is(h)?xe.areEqual(m,h):Ot.isLoci(m)&&Ot.isLoci(h)?Ot.areLociEqual(m,h):xr.isLoci(m)&&xr.isLoci(h)?xr.areLociEqual(m,h):_i.isLoci(m)&&_i.isLoci(h)?_i.areLociEqual(m,h):ht.isLoci(m)&&ht.isLoci(h)?ht.areLociEqual(m,h):ht.Isosurface.isLoci(m)&&ht.Isosurface.isLoci(h)?ht.Isosurface.areLociEqual(m,h):ht.Cell.isLoci(m)&&ht.Cell.isLoci(h)?ht.Cell.areLociEqual(m,h):!1}e.areEqual=n;function a(m){return!!m&&m.kind==="every-loci"}e.isEvery=a;function i(m){return go(m)?!1:fi(m)?!0:g0(m)?Qce(m):Ne.isLoci(m)?Ne.isLociEmpty(m):xe.is(m)?xe.isEmpty(m):Ot.isLoci(m)?Ot.isLociEmpty(m):xr.isLoci(m)?xr.isLociEmpty(m):_i.isLoci(m)?_i.isLociEmpty(m):ht.isLoci(m)?ht.isLociEmpty(m):ht.Isosurface.isLoci(m)?ht.Isosurface.isLociEmpty(m):ht.Cell.isLoci(m)?ht.Cell.isLociEmpty(m):!1}e.isEmpty=i;function o(m,h){return h instanceof Ne&&(xe.is(m)?m=xe.remap(m,h):Ne.isLoci(m)?m=Ne.remapLoci(m,h):Ot.isLoci(m)&&(m=Ot.remapLoci(m,h))),m}e.remap=o;function s(m,h){var g;if(!(m.kind==="every-loci"||m.kind==="empty-loci")){if(h||(h=Me()),m.kind==="structure-loci")return Me.copy(h,m.structure.boundary.sphere);if(m.kind==="element-loci")return Me.copy(h,xe.getBoundary(m).sphere);if(m.kind==="bond-loci")return Ot.getBoundingSphere(m,h);if(m.kind==="shape-loci")return Me.copy(h,m.shape.geometry.boundingSphere);if(m.kind==="group-loci")return _i.getBoundingSphere(m,h);if(m.kind==="data-loci")return(g=m.getBoundingSphere)===null||g===void 0?void 0:g.call(m,h);if(m.kind==="volume-loci")return ht.getBoundingSphere(m.volume,h);if(m.kind==="isosurface-loci")return ht.Isosurface.getBoundingSphere(m.volume,m.isoValue,h);if(m.kind==="cell-loci")return ht.Cell.getBoundingSphere(m.volume,m.indices,h)}}e.getBoundingSphere=s;var u=Me.zero();function l(m,h){var g=s(m,u);return g?w.copy(h||w(),g.center):void 0}e.getCenter=l;function c(m){if(!(m.kind==="every-loci"||m.kind==="empty-loci")){if(m.kind==="structure-loci")return xe.getPrincipalAxes(Ne.toStructureElementLoci(m.structure));if(m.kind==="element-loci")return xe.getPrincipalAxes(m);if(m.kind==="bond-loci")return;if(m.kind==="shape-loci")return;if(m.kind==="group-loci")return;if(m.kind==="data-loci")return;if(m.kind==="volume-loci")return;if(m.kind==="isosurface-loci")return;if(m.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(m){return m},residue:function(m){return xe.is(m)?xe.extendToWholeResidues(m,!0):m},chain:function(m){return xe.is(m)?xe.extendToWholeChains(m):m},entity:function(m){return xe.is(m)?xe.extendToWholeEntities(m):m},model:function(m){return xe.is(m)?xe.extendToWholeModels(m):m},operator:function(m){return xe.is(m)?xe.extendToWholeOperators(m):m},structure:function(m){return xe.is(m)?Ne.toStructureElementLoci(m.structure):_i.isLoci(m)?xr.Loci(m.shape):m},elementInstances:function(m){return xe.is(m)?xe.extendToAllInstances(m):m},residueInstances:function(m){return xe.is(m)?xe.extendToAllInstances(xe.extendToWholeResidues(m,!0)):m},chainInstances:function(m){return xe.is(m)?xe.extendToAllInstances(xe.extendToWholeChains(m)):m}};e.GranularityOptions=E.objectToOptions(d,function(m){switch(m){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return m.indexOf("Instances")?[mo(m),"With Symmetry"]:mo(m)}});function f(m){return m.replace("Instances","")}e.simpleGranularity=f;function p(m,h){return d[h](m)}e.applyGranularity=p;function v(m,h,g){return g===void 0&&(g=!1),(h!=="element"||g)&&Ot.isLoci(m)&&(m=Ot.toStructureElementLoci(m)),Ne.isLoci(m)&&(m=Ne.toStructureElementLoci(m.structure)),xe.is(m)&&(m=xe.remap(m,m.structure.root)),h&&(m=p(m,h)),m}e.normalize=v})(Xt||(Xt={}));var ui=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(fe.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,p,v;return c===void 0&&(c={}),E.Group({isoValue:ht.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:E.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:E.Boolean((p=c.wireframe)!==null&&p!==void 0?p:!1),opacity:E.Numeric((v=c.opacity)!==null&&v!==void 0?v:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(p){return c.set(p.dataId,p)});var d=s?s.entries.map(function(p){return[p.dataId,p.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:E.Mapped(f,d,function(p){return E.Group(a({entryData:c.get(p),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function a(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:ht.IsoValue.relative(0)},p=l&&l.boundary.box||Ut();return{view:E.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:E.Group({}),box:E.Group({bottomLeft:E.Vec3(p.min),topRight:E.Vec3(p.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:E.Vec3(w.create(0,0,0),{},{isHidden:!0}),topRight:E.Vec3(w.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:E.Group({}),auto:E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:E.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,m){return[m,"".concat(m+1," [ ").concat(Math.pow(v.maxVoxels,1/3)|0,"^3 cells ]")]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:E.Boolean(!1,{isHidden:!0}),bottomLeft:E.Vec3(p.min,{},{isHidden:!0}),topRight:E.Vec3(p.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:E.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,m){return[m,"".concat(m+1," [ ").concat(Math.pow(v.maxVoxels,1/3)|0,"^3 cells ]")]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?E.Group({em:t("EM",$e(6524815),f.emDefaultContourLevel||ht.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):E.Group({"2fo-fc":t("2Fo-Fc",$e(3367602),ht.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",$e(3390259),ht.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",$e(12268339),ht.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=a,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var i=function(o){Pe(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=h0.create(25),c.params={},c.lastLoci=yr,c.ref="",c.channels={},c._invTransform=oe(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return se(this,void 0,void 0,function(){var l,c,d,f,p,v,m,h,g;return ie(this,function(y){switch(y.label){case 0:return l=mS(this.data.serverUrl,"".concat(this.info.kind,"/").concat(this.info.dataId.toLowerCase())),u?(c=u.min,d=u.max,l+="/box"+"/".concat(c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+"/".concat(d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail=".concat(f),p=h0.get(this.cache,l),p?[2,p.data]:(v=Kr.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return m=y.sent(),[4,this.parseCif(m.data)];case 2:return h=y.sent(),h?(g=h0.set(this.cache,l,{data:h,asset:m}),g&&g.asset.dispose(),[2,h]):[2]}})})},s.prototype.parseCif=function(u){return se(this,void 0,void 0,function(){var l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return[4,this.plugin.runTask(Ol.parseBinary(u))];case 1:if(l=m.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,m.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],p=Ol.schema.densityServer(f),[4,this.plugin.runTask(BN(p))]):[3,5];case 3:v=m.sent(),c[f.header]=v,m.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=_(_({},this.params),{entry:{name:this.params.entry.name,params:_(_({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);ft.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=_(_({},this.params),{entry:{name:this.params.entry.name,params:_(_({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||w.zero(),topRight:(u==null?void 0:u.max)||w.zero()}}})}}),f=c.build().to(this.ref).update(d);ft.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(Kt.Generators.byRef(this.ref).rootOfType(fe.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!fe.Molecule.Structure.is(c.obj)||!xe.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=yr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!fe.Molecule.Structure.is(c.oldObj)||!xe.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=yr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(!!l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:yr;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(Xt.isEmpty(u)||fi(u))return Ut();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Ut();var p=this.getStructureRoot();if(!p||((l=p.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Ut();var v=Of.get((d=p.obj)===null||d===void 0?void 0:d.data.models[0]);v&&oe.invert(this._invTransform,v);var m=xe.extendToWholeResidues(u),h=xe.getBoundary(m,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return xe.size(m)===1&&Ut.expand(h,h,w.create(1,1,1)),h},s.prototype.updateAuto=function(u){if(this.lastLoci=u,fi(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(Xt.areEqual(this.lastLoci,u)){this.lastLoci=yr,this.updateSelectionBoxParams(Ut());return}if(this.lastLoci=u,fi(u)){this.updateSelectionBoxParams(Ut());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return se(this,void 0,void 0,function(){var l,c,d,f,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Ut.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Ut.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Ut():c=Ut.create(w.clone(u.entry.params.view.params.bottomLeft),w.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Ut.volume(c)<1e-4,Ut.expand(c,c,w.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Ut.create(w.clone(u.entry.params.view.params.bottomLeft),w.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Ut.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Ut.expand(c,c,w.create(f,f,f))));break}return d?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:v=h.sent(),h.label=3;case 3:return p=v,p?(m=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(p["2FO-FC"]||ht.One,m["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(p["FO-FC"]||ht.One,m["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(p["FO-FC"]||ht.One,m["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(p.EM||ht.One,m.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:ht.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Pr.WithSubscribers);e.Behavior=i})(ui||(ui={}));var Iy=$e(13421772),Zce="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",w9={};function $ce(e){return w9}function _9(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!Be.isAtomic(s))return Iy;var l=i(s,u);return l.length>0?a[l[0]].component.color:Iy};r=function(s,u){return u?xt.Secondary:He.is(s)?o(s.unit,s.element):Ot.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):Iy}}else r=function(){return Iy};return{factory:_9,granularity:"group",color:r,props:t,description:Zce,legend:Fd(VJ)}}var Jce={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:_9,getParams:$ce,defaultValues:E.getDefaultValues(w9),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return zt.hasCarbohydrate(t)})}},A9={hue:E.Interval([1,360],{min:0,max:360,step:1}),chroma:E.Interval([40,70],{min:0,max:100,step:1}),luminance:E.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:E.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:E.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function T9(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var qp=2,jd=[0,0,0],Wd=[0,0,0];function ede(e,t){return Ra.toHcl(jd,e),Ra.fromColor(Wd,Ra.toColor(e)),jd[0]>=t.hue[0]&&jd[0]<=t.hue[1]&&jd[1]>=t.chroma[0]&&jd[1]<=t.chroma[1]&&jd[2]>=t.luminance[0]&&jd[2]<=t.luminance[1]&&Wd[0]>=e[0]-qp&&Wd[0]<=e[0]+qp&&Wd[1]>=e[1]-qp&&Wd[1]<=e[1]+qp&&Wd[2]>=e[2]-qp&&Wd[2]<=e[2]+qp}function tde(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=T9(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}function rde(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,a=(t.hue[1]-t.hue[0])/n,i=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=a)for(var u=t.chroma[0];u<=t.chroma[1];u+=i)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=Ra.fromHcl(Ra(),Tu.create(s,u,l));ede(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function nde(e,t){t===void 0&&(t={});var r=_(_({},E.getDefaultValues(A9)),t);if(e<=0)return[];var n=rde(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=Cd(i),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<a.length;f++){var p=T9(n[s],a[f]);p<c&&(c=p,d=f)}l[d].push(n[s])}for(var v=Cd(a),s=0;s<l.length;++s){for(var m=l[s],h=m.length,g=[],y=[],b=[],S=0,C=m;S<C.length;S++){var x=C[S];g.push(x[0]),y.push(x[1]),b.push(x[2])}var A=p0(g)/h,P=p0(y)/h,T=p0(b)/h;a[s]=[A,P,T]}if(Al(v,a))break}return tde(a).map(function(D){return Ra.toColor(D)})}var P9={type:"generate",colorList:"red-yellow-blue"};function Eo(e){e===void 0&&(e={});var t=_(_({},P9),e);return{palette:E.MappedStatic(t.type,{colors:E.Group({list:E.ColorList(t.colorList)},{isFlat:!0}),generate:E.Group(_(_({},A9),{maxCount:E.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}E.getDefaultValues(Eo());var UR={valueLabel:function(e){return"".concat(e+1)},minLabel:"Start",maxLabel:"End"};function hs(e,t,r){var n;r===void 0&&(r={});var a,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=_(_({},UR),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=as(P9.colorList).list);var f=Ys.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});i=f.legend,a=f.color}else{var p;t.palette.name==="colors"?(p=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),p.length===0&&(p=as("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),p=nde(e,t.palette.params));for(var v=(n=r.valueLabel)!==null&&n!==void 0?n:UR.valueLabel,m=p.length,h=[],g=0;g<e;++g){var y=g%m;h[y]===void 0?h[y]=[v(g),p[y]]:h[y][0]+=", ".concat(v(g))}i=Fd(h),a=function(b){return p[b%m]}}return{color:a,legend:i}}var ade="many-distinct",zR=$e(16448250),ide="Gives every chain a color based on its `asym_id` value.",BS=_({asymId:E.Select("auth",E.arrayToOptions(["auth","label"]))},Eo({type:"colors",colorList:ade}));function ode(e){var t,r=E.clone(BS);return((t=e.structure)===null||t===void 0?void 0:t.models.some(function(n){return n.coarseHierarchy.isDefined}))&&(r.asymId.defaultValue="label"),r}function sde(e,t){switch(e.kind){case 0:return t==="auth"?tt.chain.auth_asym_id:tt.chain.label_asym_id;case 1:case 2:return tt.coarse.asym_id}}function VR(e,t){var r=sde(e.unit,t)(e);return e.structure.root.models.length>1?E9(e.unit.model,r):r}function E9(e,t){return"".concat(t,"|").concat((zt.Index.get(e).value||0)+1)}function ude(e,t){for(var r=new Map,n=function(s){var u=zt.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var p=d.auth_id,v=t==="auth"?p:f,m=e.models.length>1?E9(s,v):v;r.has(m)||(r.set(m,c+l),++c)})},a=0,i=e.models;a<i.length;a++){var o=i[a];n(o)}return r}function kS(e,t){var r,n;if(e.structure){var a=He.create(e.structure.root),i=ude(e.structure.root,t.asymId),o=Array.from(i.keys()),s=function(l){return o[l]},u=hs(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(He.is(l)){var d=VR(l,t.asymId);c=i.get(d)}else if(Ot.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=VR(a,t.asymId);c=i.get(d)}return c===void 0?zR:u.color(c)}}else r=function(){return zR};return{factory:kS,granularity:"group",color:r,props:t,description:ide,legend:n}}var I9={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:kS,getParams:ode,defaultValues:E.getDefaultValues(BS),isApplicable:function(e){return!!e.structure}},HR=$e(13421772),lde="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",D9=_({},Eo({type:"colors",colorList:"red-yellow-blue"}));function cde(e){return D9}function M9(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,l=0;l<i;++l)o.set(l,u),u+=a[l].elements.length,s.set(a[l].id,l);var c=hs(u,t);n=c.legend,r=function(d){if(He.is(d)){var f=s.get(d.unit.id),p=Ee.findPredecessorIndex(a[f].elements,d.element);return c.color(o.get(f)+p)}else if(Ot.isLocation(d)){var f=s.get(d.aUnit.id),p=Ee.findPredecessorIndex(a[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+p)}return HR}}else r=function(){return HR};return{factory:M9,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:lde,legend:n}}var dde={name:"element-index",label:"Element Index",category:"Atom Property",factory:M9,getParams:cde,defaultValues:E.getDefaultValues(D9),isApplicable:function(e){return!!e.structure}};function LS(e){var t={};return ns(e,function(r,n){t[n]=E.Color(e[n])}),t}var fde="many-distinct",GR=$e(13421772),pde="Assigns a color based on the operator name of a transformed chain.",$P=_({},Eo({type:"colors",colorList:fde}));function vde(e){var t=E.clone($P);return t}function mde(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}function JP(e,t){var r,n;if(e.structure){var a=mde(e.structure.root),i=Array.from(a.keys()),o=function(u){return i[u]},s=hs(a.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(He.is(u)){var c=u.unit.conformation.operator.name;l=a.get(c)}else if(Ot.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=a.get(d)}return l===void 0?GR:s.color(l)}}else r=function(){return GR};return{factory:JP,granularity:"instance",color:r,props:t,description:pde,legend:n}}var eE={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:JP,getParams:vde,defaultValues:E.getDefaultValues($P),isApplicable:function(e){return!!e.structure}},hde="many-distinct",qR=$e(16448250),gde="Gives every chain a color based on its `label_entity_id` value.",FS=_({},Eo({type:"colors",colorList:hde}));function yde(e){var t=E.clone(FS);return t}function y0(e,t){return"".concat(e,"|").concat(t)}function bde(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r){for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=y0(a.value(i),r);t.has(s)||t.set(s,t.size)}var u=e.models[r].coarseHierarchy;if(u.isDefined){for(var l=u.spheres.entity_id,i=0,o=l.rowCount;i<o;++i){var s=y0(l.value(i),r);t.has(s)||t.set(s,t.size)}for(var c=u.gaussians.entity_id,i=0,o=c.rowCount;i<o;++i){var s=y0(c.value(i),r);t.has(s)||t.set(s,t.size)}}}return t}function jR(e){switch(e.unit.kind){case 0:return tt.chain.label_entity_id(e);case 1:case 2:return tt.coarse.entity_id(e)}}function NS(e,t){var r,n;if(e.structure){var a=He.create(e.structure.root),i=bde(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=hs(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(He.is(l)){var d=jR(l),f=l.structure.models.indexOf(l.unit.model),p=y0(d,f);c=i.get(p)}else if(Ot.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=jR(a),f=a.structure.models.indexOf(a.unit.model),p=y0(d,f);c=i.get(p)}return c===void 0?qR:u.color(c)}}else r=function(){return qR};return{factory:NS,granularity:"group",color:r,props:t,description:gde,legend:n}}var Sde={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:NS,getParams:yde,defaultValues:E.getDefaultValues(FS),isApplicable:function(e){return!!e.structure}};function US(e){return Object.keys(e)}function Zf(e){throw new Error("unreachable")}function tE(e){return typeof(e==null?void 0:e.then)=="function"}var v4="dark-2",Dy=$e(16448250),xde="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",zS=_({},Eo({type:"colors",colorList:v4}));function Cde(e){var t=E.clone(zS);return e.structure&&O9(e.structure.root.models).srcKeySerialMap.size>Ki[v4].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=_(_({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:as(v4).list}})),t}function R9(e,t){return"".concat(e,"|").concat(t)}function wde(e,t,r,n,a,i){return"".concat(e,"|").concat(t,"|").concat(r,"|").concat(i||a||n)}function ZC(e,t,r,n,a,i,o,s){for(var u=a.entity_id,l=a.pdbx_src_id,c=a.pdbx_beg_seq_num,d=a.pdbx_end_seq_num,f=0,p=a._rowCount;f<p;++f){var v=u.value(f),m=R9(r,v),h=void 0;if(e.has(m))h=e.get(m);else{var g=n.entities.getEntityIndex(v),y=n.sequence.sequences[g].sequence;h=new Int16Array(y.length),e.set(m,h)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",C=wde(r,v,i.value(f),l.value(f),b,S),x=c.valueKind(f)===0?c.value(f):1,A=d.valueKind(f)===0?d.value(f):h.length,P=void 0;t.has(C)?P=t.get(C):(P=t.size+1,t.set(C,P));for(var T=x,D=A;T<=D;++T)h[T-1]=P}}function O9(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(!!Xr.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;ZC(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),ZC(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),ZC(t,r,n,i,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function _de(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=K$(n[3])?"Unnamed ".concat(++t):n[3];return"".concat(i).concat(a?" (".concat(a,")"):"")})}function VS(e,t){var r,n;if(e.structure){var a=He.create(e.structure),i=e.structure.root.models,o=O9(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=_de(u),c=function(p){return l[p]},d=hs(u.size,t,{valueLabel:c});n=d.legend;var f=function(p){var v=i.indexOf(p.unit.model),m=tt.entity.id(p),h=R9(v,m),g=s.get(h);if(g){var y=g[tt.residue.label_seq_id(p)-1]-1;return y===-1?Dy:d.color(y)}else return Dy};r=function(p){return He.is(p)?f(p):Ot.isLocation(p)?(a.unit=p.aUnit,a.element=p.aUnit.elements[p.aIndex],f(a)):Dy}}else r=function(){return Dy};return{factory:VS,granularity:"group",color:r,props:t,description:xde,legend:n}}var Ade={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:VS,getParams:Cde,defaultValues:E.getDefaultValues(zS),isApplicable:function(e){return!!e.structure}},B9={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},k9=$e(16777215),Tde="Assigns a color to every atom according to its chemical element.",L9={carbonColor:E.MappedStatic("chain-id",{"chain-id":E.Group(BS),"entity-id":E.Group(FS),"entity-source":E.Group(zS),"operator-name":E.Group($P),"element-symbol":E.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(.2,{min:-6,max:6,step:.1}),colors:E.MappedStatic("default",{default:E.EmptyGroup(),custom:E.Group(LS(B9))})};function Pde(e){return L9}function Ede(e,t){var r=e[t];return r===void 0?k9:r}function F9(e,t){var r=lS(t.colors.name==="default"?B9:t.colors.params,t.saturation,t.lightness),n=t.carbonColor,a=n.name==="chain-id"?kS(e,n.params).color:n.name==="entity-id"?NS(e,n.params).color:n.name==="entity-source"?VS(e,n.params).color:n.name==="operator-name"?JP(e,n.params).color:n.name==="element-symbol"?void 0:Zf();function i(u,l){return a&&u==="C"?a(l,!1):Ede(r,u)}function o(u){if(He.is(u)){if(Be.isAtomic(u.unit)){var l=u.unit.model.atomicHierarchy.atoms.type_symbol;return i(l.value(u.element),u)}}else if(Ot.isLocation(u)&&Be.isAtomic(u.aUnit)){var l=u.aUnit.model.atomicHierarchy.atoms.type_symbol,c=l.value(u.aUnit.elements[u.aIndex]);return i(c,u)}return k9}var s=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:F9,granularity:s,preferSmoothing:!0,color:o,props:t,description:Tde,legend:Fd(Object.keys(r).map(function(u){return[u,r[u]]}))}}var Ide={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:F9,getParams:Pde,defaultValues:E.getDefaultValues(L9),isApplicable:function(e){return!!e.structure}},N9={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},m4=$e(16777113),Dde="Assigns a color based on the molecule type of a residue.",rE={saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(0,{min:-6,max:6,step:.1}),colors:E.MappedStatic("default",{default:E.EmptyGroup(),custom:E.Group(LS(N9))})};function Mde(e){return rE}function WR(e,t,r){var n=DP(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return m4}function nE(e,t){var r=lS(t.colors.name==="default"?N9:t.colors.params,t.saturation,t.lightness);function n(a){return He.is(a)?WR(r,a.unit,a.element):Ot.isLocation(a)?WR(r,a.aUnit,a.aUnit.elements[a.aIndex]):m4}return{factory:nE,granularity:"group",color:n,props:t,description:Dde,legend:Fd(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Other/unknown",m4]]))}}var Rde={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:nE,getParams:Mde,defaultValues:E.getDefaultValues(rE),isApplicable:function(e){return!!e.structure}},h4="dark-2",XR=$e(16448250),Ode="Gives every polymer chain a color based on its `asym_id` value.",U9=_({},Eo({type:"colors",colorList:h4}));function Bde(e){var t=E.clone(U9);return e.structure&&z9(e.structure.root).size>Ki[h4].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=_(_({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:as(h4).list}})),t}function YR(e){switch(e.kind){case 0:return tt.chain.label_asym_id;case 1:case 2:return tt.coarse.asym_id}}function z9(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(Be.isAtomic(a))for(var o=i.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=Qt.transientSegments(s,a.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=u.label_asym_id.value(c);t.has(p)||t.set(p,t.size)}}else if(Be.isCoarse(a))for(var v=Be.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,m=v.chainElementSegments,h=v.asym_id,g=v.entity_id,l=Qt.transientSegments(m,a.elements);l.hasNext;){var c=l.move().index,y=m.offsets[c],d=g.value(y),f=i.entities.getEntityIndex(d);if(i.entities.data.type.value(f)==="polymer"){var p=h.value(y);t.has(p)||t.set(p,t.size)}}}return t}function V9(e,t){var r,n;if(e.structure){var a=He.create(e.structure),i=z9(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=hs(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(He.is(l)){var d=YR(l.unit);c=i.get(d(l))}else if(Ot.isLocation(l)){var d=YR(l.aUnit);a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex],c=i.get(d(a))}return c===void 0?XR:u.color(c)}}else r=function(){return XR};return{factory:V9,granularity:"group",color:r,props:t,description:Ode,legend:n}}var kde={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:V9,getParams:Bde,defaultValues:E.getDefaultValues(U9),isApplicable:function(e){return!!e.structure}},g4="dark-2",KR=$e(13421772),Lde="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",H9=_({},Eo({type:"colors",colorList:g4}));function Fde(e){var t=E.clone(H9);return e.structure&&G9(e.structure.root)>Ki[g4].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=_(_({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:as(g4).list}})),t}function G9(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}function q9(e,t){var r,n;if(e.structure){var a=hs(G9(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,l=i.length;s<l;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(c){var d;return He.is(c)?d=o.get(c.unit.id):Ot.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:KR}}else r=function(){return KR};return{factory:q9,granularity:"instance",color:r,props:t,description:Lde,legend:n}}var Nde={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:q9,getParams:Fde,defaultValues:E.getDefaultValues(H9),isApplicable:function(e){return!!e.structure}},j9={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},y4=$e(16711935),Ude="Assigns a color to every residue according to its name.",W9={saturation:E.Numeric(0,{min:-6,max:6,step:.1}),lightness:E.Numeric(1,{min:-6,max:6,step:.1}),colors:E.MappedStatic("default",{default:E.EmptyGroup(),custom:E.Group(LS(j9))})};function zde(e){return W9}function QR(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function ZR(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function My(e,t){var r=e[t];return r===void 0?y4:r}function X9(e,t){var r=lS(t.colors.name==="default"?j9:t.colors.params,t.saturation,t.lightness);function n(a){if(He.is(a))if(Be.isAtomic(a.unit)){var i=QR(a.unit,a.element);return My(r,i)}else{var i=ZR(a.unit,a.element);if(i)return My(r,i)}else if(Ot.isLocation(a))if(Be.isAtomic(a.aUnit)){var i=QR(a.aUnit,a.aUnit.elements[a.aIndex]);return My(r,i)}else{var i=ZR(a.aUnit,a.aUnit.elements[a.aIndex]);if(i)return My(r,i)}return y4}return{factory:X9,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Ude,legend:Fd(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Unknown",y4]]))}}var Vde={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:X9,getParams:zde,defaultValues:E.getDefaultValues(W9),isApplicable:function(e){return!!e.structure}},Y9={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},b4=$e(8421504),Hde="Assigns a color based on the type of secondary structure and basic molecule type.",K9={saturation:E.Numeric(-1,{min:-6,max:6,step:.1}),lightness:E.Numeric(0,{min:-6,max:6,step:.1}),colors:E.MappedStatic("default",{default:E.EmptyGroup(),custom:E.Group(LS(Y9))})};function Gde(e){return K9}function $R(e,t,r,n){var a=Tr.create(0);if(n&&Be.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(Tr.is(a,2))return Tr.is(a,2048)?e.threeTenHelix:Tr.is(a,32768)?e.piHelix:e.alphaHelix;if(Tr.is(a,4))return e.betaStrand;if(Tr.is(a,8))return e.bend;if(Tr.is(a,16))return e.turn;var o=DP(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:b4}function Q9(e,t){var r=e.structure&&ls.get(e.structure),n=r?pp(r.id,r.version):-1,a=lS(t.colors.name==="default"?Y9:t.colors.params,t.saturation,t.lightness);function i(o){return He.is(o)?$R(a,o.unit,o.element,r==null?void 0:r.value):Ot.isLocation(o)?$R(a,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):b4}return{factory:Q9,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:Hde,legend:Fd(Object.keys(a).map(function(o){return[o,a[o]]}).concat([["Other",b4]]))}}var qde={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:Q9,getParams:Gde,defaultValues:E.getDefaultValues(K9),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?ls.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&ls.ref(e.structure,!1)}}},jde=$e(13421772),Wde="Gives every polymer residue a color based on its `seq_id` value.",Z9={list:E.ColorList("turbo",{presetKind:"scale"})};function Xde(e){return Z9}function JR(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function e6(e,t){var r=e.model,n="";switch(e.kind){case 0:var a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var i=r.entities.getEntityIndex(n);if(i===-1)return 0;var o=r.sequence.byEntityKey[i];return o===void 0?0:o.sequence.length}function $9(e,t){var r=Ys.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(a){if(He.is(a)){var i=a.unit,o=a.element,s=JR(i,o);if(s>0){var u=e6(i,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Ot.isLocation(a)){var l=a.aUnit,c=a.aIndex,s=JR(l,l.elements[c]);if(s>0){var u=e6(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return jde};return{factory:$9,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Wde,legend:r?r.legend:void 0}}var Yde={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:$9,getParams:Xde,defaultValues:E.getDefaultValues(Z9),isApplicable:function(e){return!!e.structure}},S4="dark-2",t6=$e(13421772),Kde="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",J9=_({},Eo({type:"colors",colorList:S4}));function Qde(e){var t=E.clone(J9);return e.structure&&e.structure.root.units.length>Ki[S4].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=_(_({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:as(S4).list}})),t}function eU(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=hs(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(l){return He.is(l)?o.get(l.unit.id):Ot.isLocation(l)?o.get(l.aUnit.id):t6}}else r=function(){return t6};return{factory:eU,granularity:"instance",color:r,props:t,description:Kde,legend:n}}var Zde={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:eU,getParams:Qde,defaultValues:E.getDefaultValues(J9),isApplicable:function(e){return!!e.structure}},$de=$e(16777113),Jde="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",tU={domain:E.Interval([0,100]),list:E.ColorList("red-white-blue",{presetKind:"scale"})};function efe(e){return tU}function r6(e,t){return Be.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Be.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function rU(e,t){var r=Ys.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(a){return He.is(a)?r.color(r6(a.unit,a.element)):Ot.isLocation(a)?r.color(r6(a.aUnit,a.aUnit.elements[a.aIndex])):$de}return{factory:rU,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Jde,legend:r?r.legend:void 0}}var tfe={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:rU,getParams:efe,defaultValues:E.getDefaultValues(tU),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},rfe=$e(15658734),nfe="Assigns an illustrative color that gives every chain a color based on the choosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",nU={style:E.MappedStatic("entity-id",{uniform:E.Group(VP),"chain-id":E.Group(BS),"entity-id":E.Group(FS),"entity-source":E.Group(zS),"molecule-type":E.Group(rE)}),carbonLightness:E.Numeric(.8,{min:-6,max:6,step:.1})};function afe(e){var t=E.clone(nU);return t}function aU(e,t){var r=t.style.name==="uniform"?ES(e,t.style.params):t.style.name==="chain-id"?kS(e,t.style.params):t.style.name==="entity-id"?NS(e,t.style.params):t.style.name==="entity-source"?VS(e,t.style.params):t.style.name==="molecule-type"?nE(e,t.style.params):Zf(t.style),n=r.color,a=r.legend;function i(s,u){var l=n(s,!1);return u==="C"?$e.lighten(l,t.carbonLightness):l}function o(s){if(He.is(s)&&Be.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}else if(Ot.isLocation(s)&&Be.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return rfe}return{factory:aU,granularity:"group",preferSmoothing:!0,color:o,props:t,description:nfe,legend:a}}var ife={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:aU,getParams:afe,defaultValues:E.getDefaultValues(nU),isApplicable:function(e){return!!e.structure}},ofe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',iU={list:E.ColorList("red-yellow-green",{presetKind:"scale"}),scale:E.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function sfe(e){return iU}var ufe={DGwif:0,DGwoct:1,"Oct-IF":2};function lfe(e,t){var r=Y_[e];return r===void 0?0:r[t]}function n6(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function a6(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function oU(e,t){var r=ufe[t.scale],n=1/0,a=-1/0;for(var i in Y_){var o=Y_[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=Ys.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return He.is(l)?Be.isAtomic(l.unit)?c=n6(l.unit,l.element):c=a6(l.unit,l.element):Ot.isLocation(l)&&(Be.isAtomic(l.aUnit)?c=n6(l.aUnit,l.aUnit.elements[l.aIndex]):c=a6(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?lfe(c,r):0)}return{factory:oU,granularity:"group",preferSmoothing:!0,color:u,props:t,description:ofe,legend:s?s.legend:void 0}}var cfe={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:oU,getParams:sfe,defaultValues:E.getDefaultValues(iU),isApplicable:function(e){return!!e.structure}},i6=$e(13421772),dfe="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",sU=_({},Eo({type:"colors",colorList:"purples"}));function ffe(e){return sU}function uU(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=zt.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=hs(s,t);i=d.legend;for(var f=new Map,p=0,v=o.length;p<v;++p){var m=((n=zt.TrajectoryInfo.get(o[p]))===null||n===void 0?void 0:n.index)||0;f.set(m,d.color(m))}a=function(h){return He.is(h)?f.get(zt.TrajectoryInfo.get(h.unit.model).index):Ot.isLocation(h)?f.get(zt.TrajectoryInfo.get(h.aUnit.model).index):i6}}else a=function(){return i6};return{factory:uU,granularity:"instance",color:a,props:t,description:dfe,legend:i}}var pfe={name:"model-index",label:"Model Index",category:"Chain Property",factory:uU,getParams:ffe,defaultValues:E.getDefaultValues(sU),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&zt.TrajectoryInfo.get(e.structure.models[0]).size>1}},vfe=$e(13421772),mfe="Assigns a color based on the occupancy of an atom.",lU={domain:E.Interval([0,1]),list:E.ColorList("purples",{presetKind:"scale"})};function hfe(e){return lU}function o6(e,t){return Be.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function cU(e,t){var r=Ys.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(a){return He.is(a)?r.color(o6(a.unit,a.element)):Ot.isLocation(a)?r.color(o6(a.aUnit,a.aUnit.elements[a.aIndex])):vfe}return{factory:cU,granularity:"group",preferSmoothing:!0,color:n,props:t,description:mfe,legend:r?r.legend:void 0}}var gfe={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:cU,getParams:hfe,defaultValues:E.getDefaultValues(lU),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},x4="dark-2",s6=$e(13421772),yfe="Assigns a color based on the operator HKL value of a transformed chain.",dU=_({},Eo({type:"colors",colorList:x4}));function bfe(e){var t=E.clone(dU);return e.structure&&fU(e.structure.root).map.size>Ki[x4].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=_(_({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:as(x4).list}})),t}var jh=1e4;function C4(e){return e.map(function(t){return"".concat(t+jh).padStart(5,"0")}).join("")}function w4(e){var t=X$(jh,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return[r-jh,n-jh,a-jh]}function $C(e){return e.map(function(t){return t+5}).join("")}function fU(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=C4(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=w4(o[0]),u=w4(o[o.length-1]);return{min:s,max:u,map:t}}function pU(e,t){var r,n;if(e.structure){var a=fU(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(d,f){var p=d%s.size,v=$C(w4(f));u[p]===void 0?u[p]=v:u[p]+=", ".concat(v)});var l={minLabel:$C(i),maxLabel:$C(o),valueLabel:function(d){return u[d]}},c=hs(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(He.is(d)){var p=C4(d.unit.conformation.operator.hkl);f=s.get(p)}else if(Ot.isLocation(d)){var p=C4(d.aUnit.conformation.operator.hkl);f=s.get(p)}return f===void 0?s6:c.color(f)}}else r=function(){return s6};return{factory:pU,granularity:"instance",color:r,props:t,description:yfe,legend:n}}var Sfe={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:pU,getParams:bfe,defaultValues:E.getDefaultValues(dU),isApplicable:function(e){return!!e.structure}},sm;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=Xs.create(e.Descriptor)})(sm||(sm={}));var JC=$e(16777113),xfe="Assigns a color based on the partial charge of an atom.",vU={domain:E.Interval([-1,1]),list:E.ColorList("red-white-blue",{presetKind:"scale"})};function Cfe(e){return vU}function u6(e,t){var r;return(r=sm.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function mU(e,t){var r=Ys.create({domain:t.domain,listOrName:t.list.colors});function n(a){if(He.is(a)){var i=u6(a.unit,a.element);return i!==void 0?r.color(i):JC}else if(Ot.isLocation(a)){var i=u6(a.aUnit,a.aUnit.elements[a.aIndex]);return i!==void 0?r.color(i):JC}return JC}return{factory:mU,granularity:"group",preferSmoothing:!0,color:n,props:t,description:xfe,legend:r?r.legend:void 0}}var wfe={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:mU,getParams:Cfe,defaultValues:E.getDefaultValues(vU),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return sm.Provider.get(t)!==void 0})}},_fe="many-distinct",l6=$e(16448250),Afe="Gives every atom a color based on its `label_atom_id` value.",hU=_({},Eo({type:"colors",colorList:_fe}));function Tfe(e){var t=E.clone(hU);return t}function Pfe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var a=n[r],i=a.atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}function gU(e,t){var r,n;if(e.structure){var a=He.create(e.structure.root),i=Pfe(e.structure.root),o=Array.from(i.keys()),s=function(l){return o[l]},u=hs(i.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(He.is(l)){var d=tt.atom.label_atom_id(l);c=i.get(d)}else if(Ot.isLocation(l)){a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex];var d=tt.atom.label_atom_id(a);c=i.get(d)}return c===void 0?l6:u.color(c)}}else r=function(){return l6};return{factory:gU,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Afe,legend:n}}var Efe={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:gU,getParams:Tfe,defaultValues:E.getDefaultValues(hU),isApplicable:function(e){return!!e.structure}},Ife=$e(13421772),Dfe="Assign color based on the given value of a volume cell.",yU={colorList:E.ColorList({kind:"interpolate",colors:[[tr.white,0],[tr.red,.25],[tr.white,.5],[tr.blue,.75],[tr.white,1]]},{offsets:!0,isEssential:!0})};function Mfe(e){return yU}function bU(e,t){for(var r=Ys.create({domain:[0,1],listOrName:t.colorList.colors}),n=[],a=0;a<256;++a)n[a]=r.color(a/255);var i={colors:n,filter:"linear"};return{factory:bU,granularity:"direct",color:function(){return Ife},props:t,description:Dfe,legend:r.legend,palette:i}}var Rfe={name:"volume-value",label:"Volume Value",category:"Miscellaneous",factory:bU,getParams:Mfe,defaultValues:E.getDefaultValues(yU),isApplicable:function(e){return!!e.volume}},Ru;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=$e(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&Al(a.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new _U(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":Efe,"carbohydrate-symbol":Jce,"chain-id":I9,"element-index":dde,"element-symbol":Ide,"entity-id":Sde,"entity-source":Ade,hydrophobicity:cfe,illustrative:ife,"model-index":pfe,"molecule-type":Rde,occupancy:gfe,"operator-hkl":Sfe,"operator-name":eE,"partial-charge":wfe,"polymer-id":kde,"polymer-index":Nde,"residue-name":Vde,"secondary-structure":qde,"sequence-id":Yde,"shape-group":Ece,uncertainty:tfe,"unit-index":Zde,uniform:Cle,"volume-value":Rfe}})(Ru||(Ru={}));var Ofe=1,Bfe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",SU={scale:E.Numeric(1,{min:.1,max:5,step:.1})};function kfe(e){return SU}function e3(e,t){return Be.isAtomic(e)?Eg(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Be.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function xU(e,t){var r=t.scale===void 0?1:t.scale;function n(a){var i;return He.is(a)?i=r*e3(a.unit,a.element):Ot.isLocation(a)?i=r*Math.min(e3(a.aUnit,a.aUnit.elements[a.aIndex]),e3(a.bUnit,a.bUnit.elements[a.bIndex])):i=r*Ofe,i}return{factory:xU,granularity:"group",size:n,props:t,description:Bfe}}var Lfe={name:"physical",label:"Physical",category:"",factory:xU,getParams:kfe,defaultValues:E.getDefaultValues(SU),isApplicable:function(e){return!!e.structure}},Ffe="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",CU={bfactorFactor:E.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:E.Numeric(.05,{min:0,max:1,step:.01}),baseSize:E.Numeric(.2,{min:0,max:2,step:.1})};function Nfe(e){return CU}function c6(e,t,r){return Be.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Be.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function wU(e,t){function r(n){var a=t.baseSize;return He.is(n)?a+=c6(n.unit,n.element,t):Ot.isLocation(n)&&(a+=c6(n.aUnit,n.aUnit.elements[n.aIndex],t)),a}return{factory:wU,granularity:"group",size:r,props:t,description:Ffe}}var Ufe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:wU,getParams:Nfe,defaultValues:E.getDefaultValues(CU),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},pa;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,a){return n.factory===a.factory&&Al(n.props,a.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new _U(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:Lfe,"shape-group":_ce,uncertainty:Ufe,uniform:Ale}})(pa||(pa={}));var qn;(function(e){function t(i,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=i.colorThemeRegistry.create(l.name,o,l.params),u.size=i.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:Ru.Empty,size:pa.Empty}}e.createEmpty=r;function n(i,o,s,u){var l,c;return se(this,void 0,void 0,function(){return ie(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(i,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function a(i,o,s){var u,l;(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=a})(qn||(qn={}));function d6(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var _U=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,ns(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. ".concat(a.name," ").concat(i));n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return d6(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered theme provider."));return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var a=this.get(t);return a.factory(r,_(_({},E.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return d6(this.getApplicableList(t))},e}(),wt;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(wt||(wt={}));var mi;(function(e){e.is=Xa.has,e.All=wt.Highlight|wt.RemoveHighlight|wt.Select|wt.Deselect|wt.Toggle|wt.Clear,e.Highlighting=wt.Highlight|wt.RemoveHighlight|wt.Clear,e.Selecting=wt.Select|wt.Deselect|wt.Toggle|wt.Clear;function t(r,n){return r===wt.Highlight&&n===wt.RemoveHighlight||r===wt.RemoveHighlight&&n===wt.Highlight||r===wt.Select&&n===wt.Deselect||r===wt.Deselect&&n===wt.Select||r===wt.Toggle&&n===wt.Toggle}e.isReverse=t})(mi||(mi={}));function zfe(e,t,r){e.fill(t,0,r)}function b0(e,t,r){switch(r){case wt.Highlight:e[t]|=1;break;case wt.RemoveHighlight:e[t]&=-2;break;case wt.Select:e[t]|=2;break;case wt.Deselect:e[t]&=-3;break;case wt.Toggle:e[t]^=2;break;case wt.Clear:e[t]=0;break}}function Ks(e,t,r){if(r===wt.None)return!1;if(Ce.is(t)){var n=Ce.start(t),a=Ce.end(t),i=n+3>>2,o=i+(a-4*i>>2);if(o<=i){for(var s=n;s<a;++s)b0(e,s,r);return!0}var u=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),l=n,c=Math.min(4*i,a),d=Math.max(n,4*o),f=a;switch(r){case wt.Highlight:for(var s=i;s<o;++s)u[s]|=16843009;break;case wt.RemoveHighlight:for(var s=i;s<o;++s)u[s]&=-16843010;break;case wt.Select:for(var s=i;s<o;++s)u[s]|=33686018;break;case wt.Deselect:for(var s=i;s<o;++s)u[s]&=-33686019;break;case wt.Toggle:for(var s=i;s<o;++s)u[s]^=33686018;break;case wt.Clear:for(var s=i;s<o;++s)u[s]=0;break;default:Zf()}for(var s=l;s<c;++s)b0(e,s,r);for(var s=d;s<f;++s)b0(e,s,r)}else switch(r){case wt.Highlight:for(var s=0,p=t.length;s<p;++s)e[t[s]]|=1;break;case wt.RemoveHighlight:for(var s=0,p=t.length;s<p;++s)e[t[s]]&=-2;break;case wt.Select:for(var s=0,p=t.length;s<p;++s)e[t[s]]|=2;break;case wt.Deselect:for(var s=0,p=t.length;s<p;++s)e[t[s]]&=-3;break;case wt.Toggle:for(var s=0,p=t.length;s<p;++s)e[t[s]]^=2;break;case wt.Clear:for(var s=0,p=t.length;s<p;++s)e[t[s]]=0;break;default:Zf()}return!0}function Vfe(e,t){var r=-1,n=-1;switch(e){case wt.Highlight:t===0||t===1?(r=1,n=1):t===2||t===3?(r=1,n=3):r=1;break;case wt.RemoveHighlight:t===0||t===1?(r=0,n=0):(t===2||t===3)&&(r=1,n=2);break;case wt.Select:t===1||t===3?(r=1,n=3):t===0||t===2?(r=1,n=2):r=1;break;case wt.Deselect:t===1||t===3?(r=1,n=1):(t===0||t===2)&&(r=0,n=0);break;case wt.Toggle:t===1?(r=1,n=3):t===2?(r=0,n=0):t===3?(r=1,n=1):t===0&&(r=1,n=2);break;case wt.Clear:r=0,n=0;break}return{average:r,status:n}}function Hfe(e,t){switch(e){case wt.Highlight:return .5;case wt.RemoveHighlight:return t===0?0:t===2||t===3?.5:-1;case wt.Select:return .5;case wt.Deselect:return t===1||t===3?.5:t===0?0:-1;case wt.Toggle:return t===-1?-1:.5;case wt.Clear:return t===-1?-1:t===0?0:.5;case wt.None:return-1;default:Zf()}}function Gfe(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function t3(e,t,r){return e&&e[t]!==void 0?e[t]:r}function Ye(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function Ry(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro.".concat(e.info.name),{kind:"macro",symbol:e,translate:t,aliases:It([e.info.name],r,!0)}}function qfe(e){return e.kind==="alias"||e.kind==="macro"}var jfe=[["Core symbols",Ye(he.core.type.bool,"bool"),Ye(he.core.type.num,"num"),Ye(he.core.type.str,"str"),Ye(he.core.type.regex,"regex"),Ye(he.core.type.list,"list"),Ye(he.core.type.set,"set"),Ye(he.core.type.compositeKey,"composite-key"),Ye(he.core.logic.not,"not"),Ye(he.core.logic.and,"and"),Ye(he.core.logic.or,"or"),Ye(he.core.ctrl.if,"if"),Ye(he.core.ctrl.fn,"fn"),Ye(he.core.ctrl.eval,"eval"),Ye(he.core.math.add,"add","+"),Ye(he.core.math.sub,"sub","-"),Ye(he.core.math.mult,"mult","*"),Ye(he.core.math.div,"div","/"),Ye(he.core.math.pow,"pow","**"),Ye(he.core.math.mod,"mod"),Ye(he.core.math.min,"min"),Ye(he.core.math.max,"max"),Ye(he.core.math.floor,"floor"),Ye(he.core.math.ceil,"ceil"),Ye(he.core.math.roundInt,"round"),Ye(he.core.math.abs,"abs"),Ye(he.core.math.sqrt,"sqrt"),Ye(he.core.math.cbrt,"cbrt"),Ye(he.core.math.sin,"sin"),Ye(he.core.math.cos,"cos"),Ye(he.core.math.tan,"tan"),Ye(he.core.math.asin,"asin"),Ye(he.core.math.acos,"acos"),Ye(he.core.math.atan,"atan"),Ye(he.core.math.sinh,"sinh"),Ye(he.core.math.cosh,"cosh"),Ye(he.core.math.tanh,"tanh"),Ye(he.core.math.exp,"exp"),Ye(he.core.math.log,"log"),Ye(he.core.math.log10,"log10"),Ye(he.core.math.atan2,"atan2"),Ye(he.core.rel.eq,"eq","="),Ye(he.core.rel.neq,"neq","!="),Ye(he.core.rel.lt,"lt","<"),Ye(he.core.rel.lte,"lte","<="),Ye(he.core.rel.gr,"gr",">"),Ye(he.core.rel.gre,"gre",">="),Ye(he.core.rel.inRange,"in-range"),Ye(he.core.str.concat,"concat"),Ye(he.core.str.match,"regex.match"),Ye(he.core.list.getAt,"list.get"),Ye(he.core.set.has,"set.has"),Ye(he.core.set.isSubset,"set.subset")],["Structure",["Types",Ye(he.structureQuery.type.entityType,"ent-type"),Ye(he.structureQuery.type.authResidueId,"auth-resid"),Ye(he.structureQuery.type.labelResidueId,"label-resid"),Ye(he.structureQuery.type.ringFingerprint,"ringfp"),Ye(he.structureQuery.type.bondFlags,"bond-flags")],["Slots",Ye(he.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",Ye(he.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),Ye(he.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),Ye(he.structureQuery.generator.rings,"sel.atom.rings"),Ye(he.structureQuery.generator.empty,"sel.atom.empty"),Ye(he.structureQuery.generator.all,"sel.atom.all"),Ye(he.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),Ry(Vh("sel.atom.atoms",Pt.Dictionary({0:nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),mt.ElementSelection,"A selection of singleton atom sets."),function(e){return ne.struct.generator.atomGroups({"atom-test":t3(e,0,!0)})}),Ry(Vh("sel.atom.res",Pt.Dictionary({0:nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),mt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return ne.struct.generator.atomGroups({"residue-test":t3(e,0,!0),"group-by":ne.ammp("residueKey")})}),Ry(Vh("sel.atom.chains",Pt.Dictionary({0:nt(_e.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),mt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return ne.struct.generator.atomGroups({"chain-test":t3(e,0,!0),"group-by":ne.ammp("chainKey")})})],["Modifiers",Ye(he.structureQuery.modifier.queryEach,"sel.atom.query-each"),Ye(he.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),Ye(he.structureQuery.modifier.exceptBy,"sel.atom.except-by"),Ye(he.structureQuery.modifier.unionBy,"sel.atom.union-by"),Ye(he.structureQuery.modifier.union,"sel.atom.union"),Ye(he.structureQuery.modifier.cluster,"sel.atom.cluster"),Ye(he.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),Ye(he.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),Ye(he.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),Ye(he.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",Ye(he.structureQuery.filter.pick,"sel.atom.pick"),Ye(he.structureQuery.filter.first,"sel.atom.first"),Ye(he.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),Ye(he.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),Ye(he.structureQuery.filter.within,"sel.atom.within"),Ye(he.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",Ye(he.structureQuery.combinator.intersect,"sel.atom.intersect"),Ye(he.structureQuery.combinator.merge,"sel.atom.merge"),Ye(he.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",Ye(he.structureQuery.atomSet.atomCount,"atom.set.atom-count"),Ye(he.structureQuery.atomSet.countQuery,"atom.set.count-query"),Ye(he.structureQuery.atomSet.reduce,"atom.set.reduce"),Ye(he.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",Ye(he.structureQuery.atomProperty.core.elementSymbol,"atom.el"),Ye(he.structureQuery.atomProperty.core.vdw,"atom.vdw"),Ye(he.structureQuery.atomProperty.core.mass,"atom.mass"),Ye(he.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),Ye(he.structureQuery.atomProperty.core.x,"atom.x"),Ye(he.structureQuery.atomProperty.core.y,"atom.y"),Ye(he.structureQuery.atomProperty.core.z,"atom.z"),Ye(he.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),Ye(he.structureQuery.atomProperty.core.operatorName,"atom.op-name"),Ye(he.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),Ye(he.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),Ye(he.structureQuery.atomProperty.core.atomKey,"atom.key"),Ye(he.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),Ye(he.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),Ye(he.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),Ye(he.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),Ye(he.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),Ye(he.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),Ye(he.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),Ye(he.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),Ye(he.structureQuery.atomProperty.macromolecular.id,"atom.id"),Ye(he.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),Ye(he.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),Ye(he.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),Ye(he.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),Ye(he.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),Ye(he.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),Ye(he.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),Ye(he.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),Ye(he.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),Ye(he.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),Ye(he.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),Ye(he.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),Ye(he.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),Ye(he.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),Ye(he.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),Ye(he.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),Ye(he.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),Ye(he.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),Ye(he.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),Ye(he.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),Ye(he.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),Ye(he.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),Ye(he.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",Ye(he.structureQuery.bondProperty.order,"bond.order"),Ye(he.structureQuery.bondProperty.length,"bond.length"),Ye(he.structureQuery.bondProperty.atomA,"bond.atom-a"),Ye(he.structureQuery.bondProperty.atomB,"bond.atom-b"),Ry(Vh("bond.is",Pt.List(mt.BondFlag),_e.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: ".concat(_e.oneOfValues(mt.BondFlag).join(", "))),function(e){return ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.struct.type.bondFlags(Gfe(e))])})]]],AU=[];function TU(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];qfe(n)?AU.push(n):n instanceof Array&&TU(n)}}TU(jfe);var Wfe=function(){for(var e=[],t=Object.create(null),r=Vr.create(),n=Vr.create(),a=0,i=AU;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '".concat(l,"' already in use."));t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&_e.oneOfValues(c.type).forEach(function(v){return Vr.add(n,v,v)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&Vr.add(r,l,l);var p=c.map[l];p.type.kind==="oneof"&&_e.oneOfValues(p.type).forEach(function(m){return Vr.add(n,m,m)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),jp=Wfe.symbolMap;function Wh(e){if(ia.isLiteral(e))return e;if(ia.isSymbol(e)){if(!jp[e.name])return e;var t=jp[e.name];if(t.kind==="alias")return ia.Symbol(jp[e.name].symbol.id);throw t.translate([])}var r=ia.isSymbol(e.head)&&!!jp[e.head.name]&&jp[e.head.name].kind==="macro",n=r?e.head:Wh(e.head),a=n!==e.head;if(!e.args)return r?Wh(e.head):a?ia.Apply(n):e;var i=!1,o;if(ia.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=Wh(l);l!==c&&(i=!0),o[o.length]=c}if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var p=f[d],l=e.args[p],c=Wh(l);l!==c&&(i=!0),o[p]=c}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var v=jp[e.head.name];if(v.kind!=="macro")return ia.Apply(n,o);var m=v.translate(o);return m}return ia.Apply(n,o)}function Xfe(e){return Wh(e)}var Ts=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:PU(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=Qfe(t,r),a=new Error(n);throw a},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return r3(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return r3(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;)if(i=Uo(t._(r,n),i),i.status){if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}else return Uo(ti(n,a),i)})},e.prototype.times=function(t,r){var n=this,a=typeof r=="undefined"?t:r;return new e(function(i,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(i,o),l=Uo(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<a&&(u=n._(i,o),l=Uo(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Uo(ti(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return It(It([],r[0],!0),r[1],!0)})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Uo(ti(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return r3(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],a=r[1];return n(a)})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);if(!i.status)return i;var o=t(i.value);return Uo(o._(n,i.index),i)})},e}();(function(e){function t(){for(var S=[],C=0;C<arguments.length;C++)S[C]=arguments[C];var x=S.length;return new e(function(A,P){for(var T,D=new Array(x),I=P,M=0;M<x;M++){if(T=Uo(S[M]._(A,I),T),!T.status)return T;D[M]=T.value,I=T.index}return Uo(ti(I,D),T)})}e.seq=t;function r(){for(var S=[],C=0;C<arguments.length;C++)S[C]=arguments[C];var x=S.length;return x===0?c("zero alternates"):new e(function(A,P){for(var T,D=0;D<S.length;D++)if(T=Uo(S[D]._(A,P),T),T.status)return T;return T})}e.alt=r;function n(S,C){return a(S,C).or(l([]))}e.sepBy=n;function a(S,C){var x=C.then(S).many();return t(S,x).map(function(A){return It([A[0]],A[1],!0)})}e.sepBy1=a;function i(S){var C="'".concat(S,"'");if(S.length===1){var x=S.charCodeAt(0);return new e(function(A,P){return A.charCodeAt(P)===x?ti(P+1,S):Yu(P,C)})}return new e(function(A,P){var T=P+S.length;return A.slice(P,T)===S?ti(T,S):Yu(P,C)})}e.string=i;function o(S){var C=""+S;return C.slice(C.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,C){C===void 0&&(C=0);var x=s(S),A=""+S;return new e(function(P,T){var D=x.exec(P.slice(T));if(D){if(0<=C&&C<=D.length){var I=D[0],M=D[C];return ti(T+I.length,M)}var B="invalid match group (0 to ".concat(D.length,") in ").concat(A);return Yu(T,B)}return Yu(T,A)})}e.regexp=u;function l(S){return new e(function(C,x){return ti(x,S)})}e.succeed=l;function c(S){return new e(function(C,x){return Yu(x,S)})}e.fail=c;function d(S){if($fe(S))return new e(function(C,x){var A=S._(C,x);return A.status&&(A.index=x,A.value=null),A});if(typeof S=="string")return d(i(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(C,x){var A=S._(C,x);return A.status?Yu(x,'not "'+C.slice(x,A.index)+'"'):ti(x,null)})}e.notFollowedBy=f;function p(S){return new e(function(C,x){var A=C.charAt(x);return x<C.length&&S(A)?ti(x+1,A):Yu(x,"a character "+S)})}e.test=p;function v(S){return p(function(C){return S.indexOf(C)>=0})}e.oneOf=v;function m(S){return p(function(C){return S.indexOf(C)<0})}e.noneOf=m;function h(S,C){return p(function(x){return S<=x&&x<=C}).desc(S+"-"+C)}e.range=h;function g(S){return new e(function(C,x){for(var A=x;A<C.length&&S(C.charAt(A));)A++;return ti(A,C.slice(x,A))})}e.takeWhile=g;function y(S){var C=new e(function(x,A){var P=S()._;return C._=P,P(x,A)});return C}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,C){return ti(C,PU(S,C))}),e.anyChar=new e(function(S,C){return C>=S.length?Yu(C,"any character"):ti(C+1,S.charAt(C))}),e.all=new e(function(S,C){return ti(S.length,S.slice(C))}),e.eof=new e(function(S,C){return C<S.length?Yu(C,"EOF"):ti(C,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i(`
`),e.crlf=i(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(Ts||(Ts={}));function r3(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new Ts(function(a,i){for(var o,s,u=i,l=0;l<n;l++){if(o=Uo(t[l]._(a,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Uo(ti(u,s),o)})}function ti(e,t){return{status:!0,index:e,value:t}}function Yu(e,t){return{status:!1,furthest:e,expected:[t]}}function Uo(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?Zfe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function PU(e,t){var r=e.slice(0,t).split(`
`),n=r.length,a=r[r.length-1].length+1;return{offset:t,line:n,column:a}}function Yfe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function Kfe(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line ".concat(r.line," column ").concat(r.column,", got ").concat(a).concat(e.slice(n,n+12)).concat(i)}function Qfe(e,t){return"expected ".concat(Yfe(t.expected)).concat(Kfe(e,t))}function Zfe(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(var o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}function $fe(e){return e instanceof Ts}function Jfe(e){return _4.parse(e)}var _4;(function(e){var t;(function(S){function C(T){return{kind:"string",value:T}}S.str=C;function x(T){return{kind:"symbol",value:T}}S.symb=x;function A(T,D){return{kind:"list",bracket:T,nodes:D}}S.list=A;function P(T){return{kind:"comment",value:T}}S.comment=P})(t||(t={}));var r=Ts.regexp(/[\n\r\s]*/),n=Ts.lazy(function(){return Ts.alt(a,d,i,o).trim(r)}),a=Ts.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),i=Ts.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=Ts.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=Ts.alt(u,l,c),f=n.many();function p(S){return f.tryParse(S)}function v(S){switch(S.kind){case"string":return S.value;case"symbol":{var C=S.value;if(C.length>1){var x=C.charAt(0);switch(x){case".":return ne.atomName(C.substr(1));case"_":return ne.struct.type.elementSymbol([C.substr(1)])}}return C==="true"?!0:C==="false"?!1:y(C)?+C:ia.Symbol(C)}case"list":{switch(S.bracket){case"[":return ne.core.type.list(g(S.nodes).map(v));case"{":return ne.core.type.set(g(S.nodes).map(v));case"(":{var A=v(S.nodes[0]);return ia.Apply(A,m(S.nodes))}}return 0}default:throw new Error("should not happen")}}function m(S){if(!(S.length<=1)){if(!h(S)){for(var C=[],x=1,A=S.length;x<A;x++){var P=S[x];P.kind!=="comment"&&(C[C.length]=v(P))}return C}for(var T={},D=!0,I=0,x=1,A=S.length;x<A;x++){var P=S[x];if(P.kind!=="comment")if(P.kind==="symbol"&&P.value.length>1&&P.value.charAt(0)===":"){var M=P.value.substr(1);for(++x;x<A&&S[x].kind==="comment";)x++;if(x>=A)throw new Error("There must be a value foolowed a named arg ':".concat(M,"'."));T[M]=v(S[x]),isNaN(+M)&&(D=!1)}else T[I++]=v(P)}if(D){for(var B=Object.keys(T).map(function(F){return+F}).sort(function(F,Y){return F-Y}),U=!0,x=0,A=B.length;x<A;x++)if(B[x]!==x){U=!1;break}if(U){for(var V=[],x=0,A=B.length;x<A;x++)V[x]=T[x];return V}}return T}}function h(S){for(var C=1,x=S.length;C<x;C++){var A=S[C];if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":")return!0}return!1}function g(S){for(var C=!1,x=0,A=S.length;x<A;x++)if(S[x].kind==="comment"){C=!0;break}return C?S.filter(function(P){return P.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var C=p(S),x=[],A=0,P=C;A<P.length;A++){var T=P[A];T.kind!=="comment"&&(x[x.length]=v(T))}return x}e.parse=b})(_4||(_4={}));var epe=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '".concat(t.symbol.id,"' already added. Call removeSymbol/removeCustomProps re-adding the symbol.")),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.addSymbol(t.symbols[a])}},e.prototype.removeCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.removeSymbol(t.symbols[a])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),Zb=new epe,tpe=function(){function e(t){this.table=t,this.constQueryContext=new Co(Ne.Empty)}return e}(),f6;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(f6||(f6={}));var kf;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(kf||(kf={}));var S0;(function(e){function t(r,n,a,i){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];a(r[c](n),o++,i)}return i}e.forEachEval=t})(S0||(S0={}));var um;(function(e){function t(n,a){return new p6(n,a,!0)}e.Const=t;function r(n,a){return new p6(n,a,!1)}e.Dynamic=r})(um||(um={}));var p6=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(!r)n=void 0,a=!0;else if(ia.isArgumentsArray(r)){n=[],a=!0;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=A4(t,s);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!0;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=A4(t,r[d]);a=a&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&a?kf.Const(this.fn(t.constQueryContext,n)):kf.Dynamic(v6(this.fn,n)):kf.Dynamic(v6(this.fn,n))},e}();function v6(e,t){return function(n){return e(n,t)}}function A4(e,t){if(ia.isLiteral(t))return kf.Const(t);if(ia.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):kf.Const(t.name)}if(!ia.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '".concat(t.head.name,"' is not implemented."));return n.compile(e,t.args)}function $f(e){var t=new tpe(Zb);return A4(t,e).fn}var jt=um.Const,kt=um.Dynamic,rpe=[jt(he.core.type.bool,function(t,r){return!!r[0](t)}),jt(he.core.type.num,function(t,r){return+r[0](t)}),jt(he.core.type.str,function(t,r){return""+r[0](t)}),jt(he.core.type.list,function(t,r){return S0.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),jt(he.core.type.set,function(t,r){return S0.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),jt(he.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),jt(he.core.type.bitflags,function(t,r){return+r[0](t)}),jt(he.core.type.compositeKey,function(t,r){return S0.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),jt(he.core.logic.not,function(e,t){return!t[0](e)}),jt(he.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(!t[o](e))return!1}return!0}),jt(he.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(t[o](e))return!0}return!1}),jt(he.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),jt(he.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),jt(he.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),jt(he.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),jt(he.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),jt(he.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),jt(he.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),jt(he.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r+=t[s](e)}return r}),jt(he.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(i.length===1)return-t[i[0]](e);r=t[i[0]](e)||0;for(var n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),jt(he.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r*=t[s](e)}return r}),jt(he.core.math.div,function(e,t){return t[0](e)/t[1](e)}),jt(he.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),jt(he.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),jt(he.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.min(t[s](e),r)}return r}),jt(he.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.max(t[s](e),r)}return r}),jt(he.core.math.floor,function(e,t){return Math.floor(t[0](e))}),jt(he.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),jt(he.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),jt(he.core.math.abs,function(e,t){return Math.abs(t[0](e))}),jt(he.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),jt(he.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),jt(he.core.math.sin,function(e,t){return Math.sin(t[0](e))}),jt(he.core.math.cos,function(e,t){return Math.cos(t[0](e))}),jt(he.core.math.tan,function(e,t){return Math.tan(t[0](e))}),jt(he.core.math.asin,function(e,t){return Math.asin(t[0](e))}),jt(he.core.math.acos,function(e,t){return Math.acos(t[0](e))}),jt(he.core.math.atan,function(e,t){return Math.atan(t[0](e))}),jt(he.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),jt(he.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),jt(he.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),jt(he.core.math.exp,function(e,t){return Math.exp(t[0](e))}),jt(he.core.math.log,function(e,t){return Math.log(t[0](e))}),jt(he.core.math.log10,function(e,t){return Math.log10(t[0](e))}),jt(he.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),jt(he.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),jt(he.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r.push(t[s](e).toString())}return r.join("")}),jt(he.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),jt(he.core.list.equal,function(e,t){return uP(t[0](e),t[1](e))}),jt(he.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),jt(he.core.set.isSubset,function(t,r){return Pn.isSuperset(r[1](t),r[0](t))}),jt(he.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),jt(he.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),jt(he.structureQuery.type.elementSymbol,function(e,t){return gp(t[0](e))}),jt(he.structureQuery.type.atomName,function(e,t){return eY(t[0](e))}),jt(he.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=m6(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=m6(r,t[s](e))}return r}),jt(he.structureQuery.type.ringFingerprint,function(e,t){return Ko.elementFingerprint(npe(e,t))}),jt(he.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=h6(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=h6(r,t[s](e))}return r}),kt(he.structureQuery.filter.pick,function(e,t){return Hr.filters.pick(t[0],t.test)(e)}),kt(he.structureQuery.filter.first,function(e,t){return Hr.filters.first(t[0])(e)}),kt(he.structureQuery.filter.withSameAtomProperties,function(e,t){return Hr.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),kt(he.structureQuery.filter.intersectedBy,function(e,t){return Hr.filters.areIntersectedBy(t[0],t.by)(e)}),kt(he.structureQuery.filter.within,function(e,t){return Hr.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),kt(he.structureQuery.filter.isConnectedTo,function(e,t){return Hr.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),kt(he.structureQuery.generator.atomGroups,function(t,r){return Hr.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),kt(he.structureQuery.generator.all,function(t){return Hr.generators.all(t)}),kt(he.structureQuery.generator.empty,function(t){return Hr.generators.none(t)}),kt(he.structureQuery.generator.bondedAtomicPairs,function(t,r){return Hr.generators.bondedAtomicPairs(r&&r[0])(t)}),kt(he.structureQuery.generator.rings,function(t,r){var n,a;return Hr.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(a=r==null?void 0:r["only-aromatic"])===null||a===void 0?void 0:a.call(r,t))(t)}),kt(he.structureQuery.modifier.includeSurroundings,function(t,r){return Hr.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),kt(he.structureQuery.modifier.surroundingLigands,function(t,r){return Hr.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),kt(he.structureQuery.modifier.wholeResidues,function(t,r){return Hr.modifiers.wholeResidues(r[0])(t)}),kt(he.structureQuery.modifier.union,function(t,r){return Hr.modifiers.union(r[0])(t)}),kt(he.structureQuery.modifier.expandProperty,function(t,r){return Hr.modifiers.expandProperty(r[0],r.property)(t)}),kt(he.structureQuery.modifier.exceptBy,function(t,r){return Hr.modifiers.exceptBy(r[0],r.by)(t)}),kt(he.structureQuery.modifier.includeConnected,function(t,r){var n,a;return Hr.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(a=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&a!==void 0?a:!1})(t)}),kt(he.structureQuery.combinator.merge,function(e,t){return Hr.combinators.merge(t)(e)}),kt(he.structureQuery.atomProperty.core.elementSymbol,jr(tt.atom.type_symbol)),kt(he.structureQuery.atomProperty.core.vdw,function(e,t){return Eg(tt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),kt(he.structureQuery.atomProperty.core.mass,function(e,t){return une(tt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),kt(he.structureQuery.atomProperty.core.atomicNumber,function(e,t){return Ig(tt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),kt(he.structureQuery.atomProperty.core.x,jr(tt.atom.x)),kt(he.structureQuery.atomProperty.core.y,jr(tt.atom.y)),kt(he.structureQuery.atomProperty.core.z,jr(tt.atom.z)),kt(he.structureQuery.atomProperty.core.sourceIndex,jr(tt.atom.sourceIndex)),kt(he.structureQuery.atomProperty.core.operatorName,jr(tt.unit.operator_name)),kt(he.structureQuery.atomProperty.core.modelIndex,jr(tt.unit.model_index)),kt(he.structureQuery.atomProperty.core.modelLabel,jr(tt.unit.model_label)),kt(he.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return Jo(r.unit.id,r.element)}),kt(he.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return yie(t&&t[0]&&t[0](e)||e.element)}),kt(he.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return bie(t&&t[0]&&t[0](e)||e.element)}),kt(he.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return Sie(t&&t[0]&&t[0](e)||e.element)}),kt(he.structureQuery.atomProperty.macromolecular.id,jr(tt.atom.id)),kt(he.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return tt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),kt(he.structureQuery.atomProperty.macromolecular.label_atom_id,jr(tt.atom.label_atom_id)),kt(he.structureQuery.atomProperty.macromolecular.label_alt_id,jr(tt.atom.label_alt_id)),kt(he.structureQuery.atomProperty.macromolecular.label_comp_id,jr(tt.atom.label_comp_id)),kt(he.structureQuery.atomProperty.macromolecular.label_seq_id,jr(tt.residue.label_seq_id)),kt(he.structureQuery.atomProperty.macromolecular.label_asym_id,jr(tt.chain.label_asym_id)),kt(he.structureQuery.atomProperty.macromolecular.label_entity_id,jr(tt.entity.id)),kt(he.structureQuery.atomProperty.macromolecular.auth_atom_id,jr(tt.atom.auth_atom_id)),kt(he.structureQuery.atomProperty.macromolecular.auth_comp_id,jr(tt.atom.auth_comp_id)),kt(he.structureQuery.atomProperty.macromolecular.auth_seq_id,jr(tt.residue.auth_seq_id)),kt(he.structureQuery.atomProperty.macromolecular.auth_asym_id,jr(tt.chain.auth_asym_id)),kt(he.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,jr(tt.residue.pdbx_PDB_ins_code)),kt(he.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,jr(tt.atom.pdbx_formal_charge)),kt(he.structureQuery.atomProperty.macromolecular.occupancy,jr(tt.atom.occupancy)),kt(he.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,jr(tt.atom.B_iso_or_equiv)),kt(he.structureQuery.atomProperty.macromolecular.entityType,jr(tt.entity.type)),kt(he.structureQuery.atomProperty.macromolecular.entitySubtype,jr(tt.entity.subtype)),kt(he.structureQuery.atomProperty.macromolecular.entityPrdId,jr(tt.entity.prd_id)),kt(he.structureQuery.atomProperty.macromolecular.entityDescription,jr(tt.entity.pdbx_description)),kt(he.structureQuery.atomProperty.macromolecular.objectPrimitive,jr(tt.unit.object_primitive)),kt(he.structureQuery.atomProperty.macromolecular.isNonStandard,jr(tt.residue.isNonStandard)),kt(he.structureQuery.atomProperty.macromolecular.secondaryStructureKey,jr(tt.residue.secondary_structure_key)),kt(he.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,jr(tt.residue.secondary_structure_type)),kt(he.structureQuery.atomProperty.macromolecular.chemCompType,jr(tt.residue.chem_comp_type)),kt(he.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),kt(he.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),kt(he.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),kt(he.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),kt(he.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),kt(he.internal.generator.bundleElement,function(t,r){return g7(r.groupedUnits(t),r.ranges(t),r.set(t))}),kt(he.internal.generator.bundle,function(t,r){return y7(r.elements(t))(t)}),kt(he.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function jr(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function m6(e,t){return e|(vr.isName(t)?vr.fromName(t):0)}function h6(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function npe(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else for(var i=Object.keys(t),n=1,a=i.length;n<a;n++)r.push(t[i[n]](e));return r}(function(){for(var e=0,t=rpe;e<t.length;e++){var r=t[e];Zb.addSymbol(r)}})();function Qn(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=Jfe(s.expression);if(u.length===0)throw new Error("No query");return Xfe(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function a(s){var u=n(s);return $f(u)}e.toQuery=a;function i(s,u){var l=a(s),c=l(new Co(u));return ot.toLociWithSourceUnits(c)}e.toLoci=i;function o(s,u,l){var c=typeof s=="function"?s(ne):s,d=$f(c);return d(new Co(u,l))}e.getStructureSelection=o})(Qn||(Qn={}));function Oa(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!Xt.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],m=v.loci,h=v.color,g=v.clear;m=xe.remap(m,c),xe.isEmpty(m)||d.push({loci:m,color:h,clear:g})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=xe.none(c),p=0,v=l.layers.length;p<v;++p){var m=l.layers[v-p-1],h=m.loci,g=m.color,y=m.clear;if(h=xe.subtract(h,f),f=xe.union(h,f),!xe.isEmpty(h)){var b=y?-1:g;d.has(b)&&(h=xe.union(h,d.get(b))),d.set(b,h)}}var S=[];return d.forEach(function(C,x){var A=x===-1,P=A?$e(0):x;S.push({loci:C,color:P,clear:A})}),{layers:S}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var m=v[p],h=m.loci,g=m.color,y=m.clear,b=xe.remap(h,c);h=xe.remap(b,d),xe.isEmpty(h)||f.push({loci:h,color:g,clear:y})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.script,h=v.color,g=v.clear,y=Qn.toLoci(m,c);xe.isEmpty(y)||d.push({loci:y,color:h,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.bundle,h=v.color,g=v.clear,y=Mr.toLoci(m,c.root);d.push({loci:y,color:h,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,m=p.color,h=p.clear,g=Mr.fromLoci(v);c.push({bundle:g,color:m,clear:h})}return{layers:c}}e.toBundle=u})(Oa||(Oa={}));function Ba(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!Xt.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],m=xe.remap(v.loci,c);xe.isEmpty(m)||d.push({loci:m,value:v.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function a(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=xe.none(c),p=0,v=l.layers.length;p<v;++p){var m=l.layers[v-p-1],h=m.loci,g=m.value;h=xe.subtract(h,f),f=xe.union(h,f),xe.isEmpty(h)||(d.has(g)&&(h=xe.union(h,d.get(g))),d.set(g,h))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=a;function i(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var m=v[p],h=m.loci,g=m.value,y=xe.remap(h,c);h=xe.remap(y,d),xe.isEmpty(h)||f.push({loci:h,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.script,h=v.value,g=Qn.toLoci(m,c);xe.isEmpty(g)||d.push({loci:g,value:h})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.bundle,h=v.value,g=Mr.toLoci(m,c.root);d.push({loci:g,value:h})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,m=p.value,h=Mr.fromLoci(v);c.push({bundle:h,value:m})}return{kind:"element-loci",layers:c}}e.toBundle=u})(Ba||(Ba={}));var Ou;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Ou||(Ou={}));var ape={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function EU(e,t){t===void 0&&(t={});var r=_(_({},ape),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function ipe(e){if(e.root.models.length===1){var t=kn.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Ri.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Ut.volume(e.root.boundary.box)}function T4(e,t){var r=oa(e.quality,"auto"),n=oa(e.detail,1),a=oa(e.radialSegments,12),i=oa(e.linearSegments,8),o=oa(e.resolution,2),s=oa(e.probePositions,12),u=oa(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof Ne)r=EU(t.root),l=ipe(t);else if(ht.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],p=c[2];l=d*f*p,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||!!e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var $b=w.set,IU=w.normalize,DU=w.sub,MU=w.addScalar,Jb=w.scale,RU=w.toArray;function aE(e,t,r,n){var a=!1;if(ht.isLoci(e)){if(!ht.areEquivalent(e.volume,t))return!1;n(Ce.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(ht.Isosurface.isLoci(e)){if(!ht.areEquivalent(e.volume,t))return!1;if(r){if(!ht.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Ce.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,l=ht.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)tn(l,s[c],u)&&n(Ce.ofSingleton(c))&&(a=!0)}else if(ht.Cell.isLoci(e)){if(!ht.areEquivalent(e.volume,t))return!1;Ce.is(e.indices)?n(e.indices)&&(a=!0):Ee.forEach(e.indices,function(f){n(Ce.ofSingleton(f))&&(a=!0)})}return a}function Bg(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(u=Math.floor(a/i),s=Math.ceil(e[2]/u),i*=u,o*=s):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:a*2}}function OU(e,t,r){r===void 0&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,l=s.min,c=i.dimensions,d=i.dataOffset,f=Bg(c,r),p=f.width,v=f.height,m=t==="data"?1:4,h=new Uint8Array(p*v*m),g={array:h,width:p,height:v},y=u-l,b=c[0],S=c[1],C=c[2],x=b+r,A=S+r,P=w(),T=w(),D=b-1,I=S-1,M=C-1,B=0;B<C;++B)for(var U=0;U<S;++U)for(var V=0;V<b;++V){var F=Math.floor(B*x%p/x),Y=Math.floor(B*x/p),W=F*x+V,K=m*(Y*A*p+U*p+W),$=d(V,U,B);t==="data"?h[K]=Math.round((o[$]-l)/y*255):(t==="groups"?Rg($,h,K):($b(P,o[d(Math.max(0,V-1),U,B)],o[d(V,Math.max(0,U-1),B)],o[d(V,U,Math.max(0,B-1))]),$b(T,o[d(Math.min(D,V+1),U,B)],o[d(V,Math.min(I,U+1),B)],o[d(V,U,Math.min(M,B+1))]),IU(P,DU(P,P,T)),MU(P,Jb(P,P,.5),.5),RU(Jb(P,P,255),h,K)),h[K+3]=Math.round((o[$]-l)/y*255))}return g}function ope(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(l*c*d*4),v={array:p,width:l,height:c,depth:d},m=o-s,h=w(),g=w(),y=l-1,b=c-1,S=d-1,C=0,x=0;x<d;++x)for(var A=0;A<c;++A)for(var P=0;P<l;++P){var T=f(P,A,x);$b(h,a[f(Math.max(0,P-1),A,x)],a[f(P,Math.max(0,A-1),x)],a[f(P,A,Math.max(0,x-1))]),$b(g,a[f(Math.min(y,P+1),A,x)],a[f(P,Math.min(b,A+1),x)],a[f(P,A,Math.min(S,x+1))]),IU(h,DU(h,h,g)),MU(h,Jb(h,h,.5),.5),RU(Jb(h,h,255),p,C),p[C+3]=Math.round((a[T]-s)/m*255),C+=4}return v}function HS(e,t,r,n,a){var i=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=e.itemSize,f=i.endsWith("Instance"),p=Ut.fromSphere3D(Ut(),f?e.boundingSphere:e.invariantBoundingSphere),v=1/t,m=Ut.scale(Ut(),p,v),h=Ut.size(w(),m);w.ceil(h,h),w.add(h,h,w.create(2,2,2));var g=p.min,y=h[0],b=h[1],S=Bg(h),C=S.width,x=S.height,A=new Float32Array(C*x*d),P=new Float32Array(C*x),T=new Uint8Array(C*x*d),D={array:T,width:C,height:x,filter:"linear"},I=f?e.instanceCount:1,M=e.colorData.array;function B(St,De,Ie){var je=Math.floor(Ie*y%C/y),st=Math.floor(Ie*y/C),pt=je*y+St;return d*(st*b*C+De*C+pt)}for(var U=2,V=h[0],F=h[1],Y=h[2],W=w(),K=0;K<I;++K)for(var $=0;$<o;$+=r){w.fromArray(W,u,$*3),f&&w.transformMat4Offset(W,W,l,0,0,K*16),w.sub(W,W,g),w.scale(W,W,v);for(var J=W[0],Z=W[1],N=W[2],j=Math.floor(J),L=Math.floor(Z),H=Math.floor(N),G=(K*s+c[$])*d,q=Math.max(0,j-U),X=Math.max(0,L-U),Q=Math.max(0,H-U),ue=Math.min(V,j+U+2),le=Math.min(F,L+U+2),ve=Math.min(Y,H+U+2),ge=q;ge<ue;++ge)for(var Se=ge-J,ae=X;ae<le;++ae)for(var re=ae-Z,O=Q;O<ve;++O){var z=O-N,de=Math.sqrt(Se*Se+re*re+z*z);if(!(de>U)){for(var me=U-de,ye=B(ge,ae,O),Te=0;Te<d;++Te)A[ye+Te]+=M[G+Te]*me;P[ye/d]+=me}}}for(var K=0,Oe=P.length;K<Oe;++K)for(var Ue=K*d,Qe=P[K],Te=0;Te<d;++Te)T[Ue+Te]=Math.round(A[Ue+Te]/Qe);var Ge=ke.create(C,x),Je=Jt.create(g[0],g[1],g[2],v),Ze=f?"volumeInstance":"volume";if(n){if(!a){var rt=d===4?"rgba":d===3?"rgb":"alpha";a=n.resources.texture("image-uint8",rt,"ubyte","linear")}return a.load(D),{kind:"volume",texture:a,gridTexDim:Ge,gridDim:h,gridTransform:Je,type:Ze}}else{var et=spe({vertexCount:o,instanceCount:I,transformBuffer:l,positionBuffer:u,colorType:Ze,grid:T,gridDim:h,gridTexDim:Ge,gridTransform:Je,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:et,texDim:ke.create(et.width,et.height),type:f?"vertexInstance":"vertex"}}}function spe(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.itemOffset||0,d=e.outputStride;if(d+c>l)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");var f=e.colorType.endsWith("Instance"),p=f?e.instanceCount:1,v=fa(Math.max(1,p*t),d,Uint8Array),m=v.array,h=i[0],g=i[1],y=o[0],b=w.fromArray(w(),s,0),S=s[3];function C(Ue,Qe,Ge){var Je=Math.floor(Ge*h%y/h),Ze=Math.floor(Ge*h/y),rt=Je*h+Ue;return l*(Ze*g*y+Qe*y+rt)}for(var x=w(),A=w(),P=w(),T=w(),D=0;D<p;++D)for(var I=0;I<t;++I){w.fromArray(x,r,I*u),f&&w.transformMat4Offset(x,x,n,0,0,D*16),w.sub(x,x,b),w.scale(x,x,S),w.floor(A,x),w.ceil(P,x),w.sub(T,x,A),w.sub(x,P,A),w.div(T,T,x);for(var M=A[0],B=A[1],U=A[2],V=P[0],F=P[1],Y=P[2],W=T[0],K=T[1],$=T[2],J=C(M,B,U)+c,Z=C(V,B,U)+c,N=C(M,B,Y)+c,j=C(V,B,Y)+c,L=C(M,F,U)+c,H=C(V,F,U)+c,G=C(M,F,Y)+c,q=C(V,F,Y)+c,X=(D*t+I)*d,Q=0;Q<d;++Q){var ue=a[J+Q],le=a[Z+Q],ve=a[N+Q],ge=a[j+Q],Se=a[L+Q],ae=a[H+Q],re=a[G+Q],O=a[q+Q],z=sa(ue,le,W),de=sa(ve,ge,W),me=sa(Se,ae,W),ye=sa(re,O,W),Te=sa(z,me,K),Oe=sa(de,ye,K);m[X+Q]=sa(Te,Oe,$)}}return v}function upe(e){return e==="group"||e==="groupInstance"}function iE(e,t,r,n,a){if(!!upe(e.dColorType.ref.value)){var i=HS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dColorType,i.type),R.update(e.tColorGrid,i.texture),R.update(e.uColorTexDim,i.gridTexDim),R.update(e.uColorGridDim,i.gridDim),R.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dColorType,i.type),R.update(e.tColor,i.texture),R.update(e.uColorTexDim,i.texDim))}}function lpe(e){return e==="groupInstance"}function cpe(e,t,r,n,a){if(!!lpe(e.dOverpaintType.ref.value)){var i=HS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dOverpaintType,i.type),R.update(e.tOverpaintGrid,i.texture),R.update(e.uOverpaintTexDim,i.gridTexDim),R.update(e.uOverpaintGridDim,i.gridDim),R.update(e.uOverpaintGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dOverpaintType,i.type),R.update(e.tOverpaint,i.texture),R.update(e.uOverpaintTexDim,i.texDim))}}function dpe(e){return e==="groupInstance"}function fpe(e,t,r,n,a){if(!!dpe(e.dTransparencyType.ref.value)){var i=HS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dTransparencyType,i.type),R.update(e.tTransparencyGrid,i.texture),R.update(e.uTransparencyTexDim,i.gridTexDim),R.update(e.uTransparencyGridDim,i.gridDim),R.update(e.uTransparencyGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dTransparencyType,i.type),R.update(e.tTransparency,i.texture),R.update(e.uTransparencyTexDim,i.texDim))}}function ppe(e){return e==="groupInstance"}function vpe(e,t,r,n,a){if(!!ppe(e.dSubstanceType.ref.value)){var i=HS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dSubstanceType,i.type),R.update(e.tSubstanceGrid,i.texture),R.update(e.uSubstanceTexDim,i.gridTexDim),R.update(e.uSubstanceGridDim,i.gridDim),R.update(e.uSubstanceGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dSubstanceType,i.type),R.update(e.tSubstance,i.texture),R.update(e.uSubstanceTexDim,i.texDim))}}var mpe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`,hpe=`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`,gpe=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`,ype={drawCount:Rn("number"),instanceCount:Rn("number"),stride:Rn("number"),uTotalCount:Re("i"),uInstanceCount:Re("i"),uGroupCount:Re("i"),aTransform:Rr("float32",16,1),aInstance:Rr("float32",1,1),aSample:Rr("float32",1,0),uGeoTexDim:Re("v2","buffered"),tPosition:Wt("texture","rgba","float","nearest"),tGroup:Wt("texture","rgba","float","nearest"),uColorTexDim:Re("v2"),tColor:Wt("texture","rgba","ubyte","nearest"),dColorType:qt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Re("f"),uCurrentX:Re("f"),uCurrentY:Re("f"),uBboxMin:Re("v3","material"),uBboxSize:Re("v3","material"),uResolution:Re("f","material")},so="color-accumulate",ch="color-count";function BU(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function bpe(e,t,r,n,a){if(e.namedComputeRenderables[so]){var i=w.sub(w(),r.max,r.min),o=e.namedComputeRenderables[so].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&R.update(o.aSample,BU(s,a)),R.updateIfChanged(o.drawCount,s),R.updateIfChanged(o.instanceCount,t.instanceCount),R.updateIfChanged(o.stride,a),R.updateIfChanged(o.uTotalCount,t.vertexCount),R.updateIfChanged(o.uInstanceCount,t.instanceCount),R.updateIfChanged(o.uGroupCount,t.groupCount),R.update(o.aTransform,t.transformBuffer),R.update(o.aInstance,t.instanceBuffer),R.update(o.uGeoTexDim,ke.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),R.update(o.tPosition,t.positionTexture),R.update(o.tGroup,t.groupTexture),R.update(o.uColorTexDim,ke.set(o.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),R.update(o.tColor,t.colorData),R.updateIfChanged(o.dColorType,t.colorType),R.updateIfChanged(o.uCurrentSlice,0),R.updateIfChanged(o.uCurrentX,0),R.updateIfChanged(o.uCurrentY,0),R.update(o.uBboxMin,r.min),R.update(o.uBboxSize,i),R.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[so].update()}else e.namedComputeRenderables[so]=Spe(e,t,r,n,a);return e.namedComputeRenderables[so]}function Spe(e,t,r,n,a){var i=w.sub(w(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:R.create(o),instanceCount:R.create(t.instanceCount),stride:R.create(a),uTotalCount:R.create(t.vertexCount),uInstanceCount:R.create(t.instanceCount),uGroupCount:R.create(t.groupCount),aTransform:R.create(t.transformBuffer),aInstance:R.create(t.instanceBuffer),aSample:R.create(BU(o,a)),uGeoTexDim:R.create(ke.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:R.create(t.positionTexture),tGroup:R.create(t.groupTexture),uColorTexDim:R.create(ke.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:R.create(t.colorData),dColorType:R.create(t.colorType),uCurrentSlice:R.create(0),uCurrentX:R.create(0),uCurrentY:R.create(0),uBboxMin:R.create(r.min),uBboxSize:R.create(i),uResolution:R.create(n)},u=_({},ype),l=ln("accumulate",gpe,hpe,{drawBuffers:"required"}),c=ea(e,"points",l,u,s);return ta(c,s)}function xpe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var Cpe=_(_({},Ca),{tColor:Wt("texture","rgba","float","nearest"),tCount:Wt("texture","alpha","float","nearest"),uTexSize:Re("v2")}),dh="color-normalize";function wpe(e,t,r){if(e.namedComputeRenderables[dh]){var n=e.namedComputeRenderables[dh].values;R.update(n.tColor,t),R.update(n.tCount,r),R.update(n.uTexSize,ke.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[dh].update()}else e.namedComputeRenderables[dh]=_pe(e,t,r);return e.namedComputeRenderables[dh]}function _pe(e,t,r){var n=_(_({},wa),{tColor:R.create(t),tCount:R.create(r),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight()))}),a=_({},Cpe),i=ln("normalize",yi,mpe),o=ea(e,"triangles",i,a,n);return ta(o,n)}function Ape(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function Tpe(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function GS(e,t,r,n,a){var i=n.extensions.drawBuffers;if(!i)throw new Error("need WebGL draw buffers");var o=n.gl,s=n.resources,u=n.state,l=n.extensions,c=l.colorBufferHalfFloat,d=l.textureHalfFloat,f=e.colorType.endsWith("Instance"),p=Ut.fromSphere3D(Ut(),f?e.boundingSphere:e.invariantBoundingSphere),v=1/t,m=Ut.scale(Ut(),p,v),h=Ut.size(w(),m);w.ceil(h,h),w.add(h,h,w.create(2,2,2));var g=p.min,y=h[0],b=h[1],S=h[2],C=Tpe(h),x=C.texDimX,A=C.texDimY,P=C.texCols;n.namedFramebuffers[so]||(n.namedFramebuffers[so]=n.resources.framebuffer());var T=n.namedFramebuffers[so];fr(o)?(n.namedTextures[so]||(n.namedTextures[so]=c&&d?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[ch]||(n.namedTextures[ch]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[so]||(n.namedTextures[so]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[ch]||(n.namedTextures[ch]=s.texture("image-float32","rgba","float","nearest")));var D=n.namedTextures[so],I=n.namedTextures[ch];D.define(x,A),I.define(x,A),D.attachFramebuffer(T,0),I.attachFramebuffer(T,1);var M=bpe(n,e,p,t,r);u.currentRenderItemId=-1,T.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);var B=M.values,U=B.uCurrentSlice,V=B.uCurrentX,F=B.uCurrentY;xpe(n),o.viewport(0,0,x,A),o.scissor(0,0,x,A),o.clear(o.COLOR_BUFFER_BIT),R.update(F,0);for(var Y=0,W=0,K=0,$=0;$<S;++$)Y>=P&&(Y-=P,W+=b,K=0,R.update(F,W)),R.update(V,K),R.update(U,$),o.viewport(K,W,y,b),o.scissor(K,W,y,b),M.render(),++Y,K+=y;D.detachFramebuffer(T,0),I.detachFramebuffer(T,1),i.drawBuffers([o.COLOR_ATTACHMENT0,o.NONE]),a||(a=s.texture("image-uint8","rgba","ubyte","linear")),a.define(x,A);var J=wpe(n,D,I);u.currentRenderItemId=-1,Ape(n),a.attachFramebuffer(T,0),o.viewport(0,0,x,A),o.scissor(0,0,x,A),o.clear(o.COLOR_BUFFER_BIT),J.render();var Z=Jt.create(g[0],g[1],g[2],v),N=f?"volumeInstance":"volume";return{texture:a,gridDim:h,gridTexDim:ke.create(x,A),gridTransform:Z,type:N}}var n3="color-smoothing-rgb",Fv="color-smoothing-rgba",a3="color-smoothing-alpha";function Ppe(e){return e==="group"||e==="groupInstance"}function kU(e,t,r,n,a){if(!!Ppe(e.dColorType.ref.value)){r*=3,n.namedTextures[n3]||(n.namedTextures[n3]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));var i=n.namedTextures[n3];i.load(e.tColor.ref.value);var o=GS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dColorType,o.type),R.update(e.tColorGrid,o.texture),R.update(e.uColorTexDim,o.gridTexDim),R.update(e.uColorGridDim,o.gridDim),R.update(e.uColorGridTransform,o.gridTransform)}}function Epe(e){return e==="groupInstance"}function Ipe(e,t,r,n,a){if(!!Epe(e.dOverpaintType.ref.value)){r*=3,n.namedTextures[Fv]||(n.namedTextures[Fv]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[Fv];i.load(e.tOverpaint.ref.value);var o=GS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dOverpaintType,o.type),R.update(e.tOverpaintGrid,o.texture),R.update(e.uOverpaintTexDim,o.gridTexDim),R.update(e.uOverpaintGridDim,o.gridDim),R.update(e.uOverpaintGridTransform,o.gridTransform)}}function Dpe(e){return e==="groupInstance"}function Mpe(e,t,r,n,a){if(!!Dpe(e.dTransparencyType.ref.value)){r*=3,n.namedTextures[a3]||(n.namedTextures[a3]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));var i=n.namedTextures[a3];i.load(e.tTransparency.ref.value);var o=GS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dTransparencyType,o.type),R.update(e.tTransparencyGrid,o.texture),R.update(e.uTransparencyTexDim,o.gridTexDim),R.update(e.uTransparencyGridDim,o.gridDim),R.update(e.uTransparencyGridTransform,o.gridTransform)}}function Rpe(e){return e==="groupInstance"}function Ope(e,t,r,n,a){if(!!Rpe(e.dSubstanceType.ref.value)){r*=3,n.namedTextures[Fv]||(n.namedTextures[Fv]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[Fv];i.load(e.tSubstance.ref.value);var o=GS({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dSubstanceType,o.type),R.update(e.tSubstanceGrid,o.texture),R.update(e.uSubstanceTexDim,o.gridTexDim),R.update(e.uSubstanceGridDim,o.gridDim),R.update(e.uSubstanceGridTransform,o.gridTransform)}}var ar;(function(e){function t(d,f){d&&(d.state.visible=f)}e.setVisibility=t;function r(d,f){d&&(d.state.alphaFactor=f)}e.setAlphaFactor=r;function n(d,f){d&&(d.state.pickable=f)}e.setPickable=n;function a(d,f){d&&(d.state.colorOnly=f)}e.setColorOnly=a;function i(d,f,p,v,m){if(!d||fi(f))return!1;var h=d.values,g=h.tMarker,y=h.uMarker,b=h.markerAverage,S=h.markerStatus,C=h.uGroupCount,x=h.instanceCount,A=C.ref.value*x.ref.value,P=g.ref.value.array,T=S.ref.value;if(!go(f)){var D=0;if(v(f,function(V){return D+=Ce.size(V),!0},!0),D===0)return!1;D===A&&(f=RS)}var I=!1,M=-1,B=-1;if(go(f)){var U=Vfe(p,T);U.status!==-1?(I=T!==U.status,I&&zfe(P,U.status,A)):I=Ks(P,Ce.ofLength(A),p),M=U.average,B=U.status}else I=v(f,function(V){return Ks(P,V,p)},!0),I&&(M=Hfe(p,T),m&&m.status!==-1&&M===-1&&mi.isReverse(m.action,p)&&Xt.areEqual(f,m.loci)&&(B=m.status,M=B===0?0:.5));return I&&(M===-1&&(M=j7(P,A),M===0&&(B=0)),m&&(m.action=p,m.loci=f,m.status=T),R.updateIfChanged(y,B),B===-1&&R.update(g,g.ref.value),R.updateIfChanged(b,M),R.updateIfChanged(S,B)),I}e.mark=i;function o(d,f,p,v,m){if(!!d){var h=d.values,g=h.tOverpaint,y=h.dOverpaintType,b=h.dOverpaint,S=h.uGroupCount,C=h.instanceCount,x=S.ref.value*C.ref.value;Ile(f.layers.length?x:0,d.values);var A=g.ref.value.array;v&&SR(A,0,x);for(var P=function(K,$){var J=f.layers[K],Z=J.loci,N=J.color,j=J.clear,L=function(H){var G=Ce.start(H),q=Ce.end(H);return j?SR(A,G,q):Ele(A,G,q,N)};p(Z,L,!1)},T=0,D=f.layers.length;T<D;++T)P(T);if(R.update(g,g.ref.value),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(b,f.layers.length>0),f.layers.length!==0&&m&&Sl(m.props)){var I=m.geometry,M=m.props,B=m.webgl;if(I.kind==="mesh"){var U=I.meta,V=U.resolution,F=U.overpaintTexture,Y=Ps(M.smoothColors,!0,V);Y&&(cpe(d.values,Y.resolution,Y.stride,B,F),I.meta.overpaintTexture=d.values.tOverpaintGrid.ref.value)}else if(B&&I.kind==="texture-mesh"){var W=I.meta,V=W.resolution,F=W.overpaintTexture,Y=Ps(M.smoothColors,!0,V);Y&&(Ipe(d.values,Y.resolution,Y.stride,B,F),I.meta.overpaintTexture=d.values.tOverpaintGrid.ref.value)}}}}e.setOverpaint=o;function s(d,f,p,v,m){if(!!d){var h=d.values,g=h.tTransparency,y=h.dTransparencyType,b=h.transparencyAverage,S=h.dTransparency,C=h.uGroupCount,x=h.instanceCount,A=C.ref.value*x.ref.value;Rle(f.layers.length?A:0,d.values);var P=g.ref.value.array;v&&Mle(P,0,A);for(var T=function($,J){var Z=f.layers[$],N=Z.loci,j=Z.value,L=function(H){var G=Ce.start(H),q=Ce.end(H);return Dle(P,G,q,j)};p(N,L,!1)},D=0,I=f.layers.length;D<I;++D)T(D);if(R.update(g,g.ref.value),R.updateIfChanged(b,d9(P,A)),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(S,f.layers.length>0),f.layers.length!==0&&m&&Sl(m.props)){var M=m.geometry,B=m.props,U=m.webgl;if(M.kind==="mesh"){var V=M.meta,F=V.resolution,Y=V.transparencyTexture,W=Ps(B.smoothColors,!0,F);W&&(fpe(d.values,W.resolution,W.stride,U,Y),M.meta.transparencyTexture=d.values.tTransparencyGrid.ref.value)}else if(U&&M.kind==="texture-mesh"){var K=M.meta,F=K.resolution,Y=K.transparencyTexture,W=Ps(B.smoothColors,!0,F);W&&(Mpe(d.values,W.resolution,W.stride,U,Y),M.meta.transparencyTexture=d.values.tTransparencyGrid.ref.value)}}}}e.setTransparency=s;function u(d,f,p,v,m){if(!!d){var h=d.values,g=h.tSubstance,y=h.dSubstanceType,b=h.dSubstance,S=h.uGroupCount,C=h.instanceCount,x=S.ref.value*C.ref.value;Fle(f.layers.length?x:0,d.values);var A=g.ref.value.array;v&&_R(A,0,x);for(var P=function(K,$){var J=f.layers[K],Z=J.loci,N=J.material,j=J.clear,L=function(H){var G=Ce.start(H),q=Ce.end(H);return j?_R(A,G,q):Lle(A,G,q,N)};p(Z,L,!1)},T=0,D=f.layers.length;T<D;++T)P(T);if(R.update(g,g.ref.value),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(b,f.layers.length>0),f.layers.length!==0&&m&&Sl(m.props)){var I=m.geometry,M=m.props,B=m.webgl;if(I.kind==="mesh"){var U=I.meta,V=U.resolution,F=U.substanceTexture,Y=Ps(M.smoothColors,!0,V);Y&&(vpe(d.values,Y.resolution,Y.stride,B,F),I.meta.substanceTexture=d.values.tSubstanceGrid.ref.value)}else if(B&&I.kind==="texture-mesh"){var W=I.meta,V=W.resolution,F=W.substanceTexture,Y=Ps(M.smoothColors,!0,V);Y&&(Ope(d.values,Y.resolution,Y.stride,B,F),I.meta.substanceTexture=d.values.tSubstanceGrid.ref.value)}}}}e.setSubstance=u;function l(d,f,p,v){if(!!d){var m=d.values,h=m.tClipping,g=m.dClipping,y=m.uGroupCount,b=m.instanceCount,S=y.ref.value*b.ref.value,C=f.layers;kle(C.length?S:0,d.values);var x=h.ref.value.array;v&&Ble(x,0,S);for(var A=function(D,I){var M=f.layers[D],B=M.loci,U=M.groups,V=function(F){var Y=Ce.start(F),W=Ce.end(F);return Ole(x,Y,W,U)};p(B,V,!1)},P=0,T=f.layers.length;P<T;++P)A(P);R.update(h,h.ref.value),R.updateIfChanged(g,f.layers.length>0)}}e.setClipping=l;function c(d,f,p){if(!(!d||!f&&!p)){var v=d.values;f&&(oe.copy(v.matrix.ref.value,f),R.update(v.matrix,v.matrix.ref.value)),p?(v.extraTransform.ref.value.set(p),R.update(v.extraTransform,v.extraTransform.ref.value)):p===null&&(Qb(v.extraTransform.ref.value,v.instanceCount.ref.value),R.update(v.extraTransform,v.extraTransform.ref.value)),s9(v);var m=xa(v.invariantBoundingSphere.ref.value,v.aTransform.ref.value,v.instanceCount.ref.value);R.update(v.boundingSphere,m)}}e.setTransform=c})(ar||(ar={}));function an(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=Xa.has;function c(m){return Xa.create(m)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(m){return m in l.Names}l.isName=d;function f(m){switch(m){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function p(m){for(var h=0,g=0,y=m.length;g<y;++g)h|=f(m[g]);return h}l.fromNames=p;function v(m){var h=[];return l.is(m,1)&&h.push("one"),l.is(m,2)&&h.push("two"),l.is(m,4)&&h.push("three"),l.is(m,8)&&h.push("four"),l.is(m,16)&&h.push("five"),l.is(m,32)&&h.push("six"),h}l.toNames=v}(e.Groups||(e.Groups={}));function t(l,c){if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!Xt.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],m=v.loci,h=v.groups;m=xe.remap(m,c),xe.isEmpty(m)||d.push({loci:m,groups:h})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=xe.none(c),p=0,v=l.layers.length;p<v;++p){var m=l.layers[v-p-1],h=m.loci,g=m.groups;h=xe.subtract(h,f),f=xe.union(h,f),xe.isEmpty(h)||(d.has(g)&&(h=xe.union(h,d.get(g))),d.set(g,h))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var m=v[p],h=m.loci,g=m.groups,y=xe.remap(h,c);h=xe.remap(y,d),xe.isEmpty(h)||f.push({loci:h,groups:g})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.script,h=v.groups,g=Qn.toLoci(m,c);xe.isEmpty(g)||d.push({loci:g,groups:h})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.bundle,h=v.groups,g=Mr.toLoci(m,c.root);d.push({loci:g,groups:h})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,m=p.groups,h=Mr.fromLoci(v);c.push({bundle:h,groups:m})}return{layers:c}}e.toBundle=u})(an||(an={}));function ka(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||!uS(l.layers[d].material,c.layers[d].material)||!Xt.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],m=v.loci,h=v.material,g=v.clear;m=xe.remap(m,c),xe.isEmpty(m)||d.push({loci:m,material:h,clear:g})}return{layers:d}}e.remap=n;function a(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=void 0,f=new Map,p=xe.none(c),v=0,m=l.layers.length;v<m;++v){var h=l.layers[m-v-1],g=h.loci,y=h.material,b=h.clear;g=xe.subtract(g,p),p=xe.union(g,p),xe.isEmpty(g)||(b?d=d?xe.union(g,d):g:(f.has(y)&&(g=xe.union(g,f.get(y))),f.set(y,g)))}var S=[];return d&&S.push({loci:d,material:di(),clear:!0}),f.forEach(function(C,x){S.push({loci:C,material:x,clear:!1})}),{layers:S}}e.merge=a;function i(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var m=v[p],h=m.loci,g=m.material,y=m.clear,b=xe.remap(h,c);h=xe.remap(b,d),xe.isEmpty(h)||f.push({loci:h,material:g,clear:y})}return{layers:f}}e.filter=i;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.script,h=v.material,g=v.clear,y=Qn.toLoci(m,c);xe.isEmpty(y)||d.push({loci:y,material:h,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],m=v.bundle,h=v.material,g=v.clear,y=Mr.toLoci(m,c.root);d.push({loci:y,material:h,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,m=p.material,h=p.clear,g=Mr.fromLoci(v);c.push({bundle:g,material:m,clear:h})}return{layers:c}}e.toBundle=u})(ka||(ka={}));var g6;(function(e){function t(r,n,a){return E.getDefaultValues(r.getParams(n,a))}e.getDetaultParams=t})(g6||(g6={}));var Bpe={name:"",label:"",description:"",factory:function(){return Yt.Empty},getParams:function(){return{}},defaultValues:{},defaultColorTheme:Ru.EmptyProvider,defaultSizeTheme:pa.EmptyProvider,isApplicable:function(){return!0}};function y6(e){return e.map(function(t){return[t.name,t.provider.label]})}var LU=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return y6(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered represenatation provider."));return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||Bpe},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return y6(this.getApplicableList(t))},e}(),Yt;(function(e){(function(o){function s(l,c){return l.repr===c.repr&&Xt.areEqual(l.loci,c.loci)}o.areEqual=s;function u(l){return Xt.isEmpty(l.loci)}o.isEmpty=u,o.Empty={loci:yr}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:oe.identity(),overpaint:Oa.Empty,transparency:Ba.Empty,substance:ka.Empty,clipping:an.Empty,markerActions:mi.All}}e.createState=t;function r(o,s){s.visible!==void 0&&(o.visible=s.visible),s.alphaFactor!==void 0&&(o.alphaFactor=s.alphaFactor),s.pickable!==void 0&&(o.pickable=s.pickable),s.colorOnly!==void 0&&(o.colorOnly=s.colorOnly),s.overpaint!==void 0&&(o.overpaint=s.overpaint),s.transparency!==void 0&&(o.transparency=s.transparency),s.substance!==void 0&&(o.substance=s.substance),s.clipping!==void 0&&(o.clipping=s.clipping),s.syncManually!==void 0&&(o.syncManually=s.syncManually),s.transform!==void 0&&oe.copy(o.transform,s.transform),s.markerActions!==void 0&&(o.markerActions=s.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new xn,state:t(),theme:qn.createEmpty(),createOrUpdate:function(){return Fe.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return yr},mark:function(){return!1},destroy:function(){}};var n=function(){function o(){this.curr=new Set,this.next=new Set,this._version=-1}return Object.defineProperty(o.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),o.prototype.add=function(s,u){this.next.add(Jo(s,u))},o.prototype.snapshot=function(){var s;Pn.areEqual(this.curr,this.next)||(this._version+=1),s=[this.next,this.curr],this.curr=s[0],this.next=s[1],this.next.clear()},o}();e.GeometryState=n;function a(o,s,u,l,c){var d=this,f=0,p=new xn,v=new n,m=l.create(),h=qn.createEmpty(),g,y,b,S={},C=Object.keys(c).map(function(x,A){S[A]=x;var P=c[x](s,u);return P.setState(m),P});return{label:o,updated:p,get groupCount(){var x=0;if(y)for(var A=y.visuals,P=0,T=C.length;P<T;++P)(!A||A.includes(S[P]))&&(x+=C[P].groupCount);return x},get renderObjects(){var x=[];if(y)for(var A=y.visuals,P=0,T=C.length;P<T;++P)(!A||A.includes(S[P]))&&x.push.apply(x,C[P].renderObjects);return x},get geometryVersion(){return v.version},get props(){return y},get params(){return g},createOrUpdate:function(x,A){x===void 0&&(x={}),A&&A!==b&&(g=u(s,A),b=A,y||(y=E.getDefaultValues(g)));var P=T4(Object.assign({},y,x),b);Object.assign(y,x,P);var T=y.visuals;return Fe.create("Creating or updating '".concat(o,"' representation"),function(D){return se(d,void 0,void 0,function(){var I,M;return ie(this,function(B){switch(B.label){case 0:I=0,M=C.length,B.label=1;case 1:return I<M?!T||T.includes(S[I])?[4,C[I].createOrUpdate(y,b).runInContext(D)]:[3,3]:[3,5];case 2:B.sent(),B.label=3;case 3:v.add(I,C[I].geometryVersion),B.label=4;case 4:return++I,[3,1];case 5:return v.snapshot(),p.next(f++),[2]}})})})},get state(){return m},get theme(){return h},getLoci:function(x){for(var A=y.visuals,P=0,T=C.length;P<T;++P)if(!A||A.includes(S[P])){var D=C[P].getLoci(x);if(!fi(D))return D}return yr},mark:function(x,A){for(var P=!1,T=0,D=C.length;T<D;++T)P=C[T].mark(x,A)||P;return P},setState:function(x){l.update(m,x);for(var A=0,P=C.length;A<P;++A)C[A].setState(x)},setTheme:function(x){h=x;for(var A=0,P=C.length;A<P;++A)C[A].setTheme(x)},destroy:function(){for(var x=0,A=C.length;x<A;++x)C[x].destroy()}}}e.createMulti=a;function i(o,s){var u=this,l=0,c=new xn,d=new n,f=e.createState(),p=qn.createEmpty(),v=E.clone(at.Params),m=E.getDefaultValues(at.Params);return{label:o,updated:c,get groupCount(){return s.values.uGroupCount.ref.value},get renderObjects(){return[s]},get geometryVersion(){return d.version},get props(){return m},get params(){return v},createOrUpdate:function(h){h===void 0&&(h={});var g=T4(Object.assign({},m,h));return Object.assign(m,h,g),Fe.create("Updating '".concat(o,"' representation"),function(y){return se(u,void 0,void 0,function(){return ie(this,function(b){return d.add(0,s.id),d.snapshot(),c.next(l++),[2]})})})},get state(){return f},get theme(){return p},getLoci:function(){return yr},mark:function(h,g){return!1},setState:function(h){h.visible!==void 0&&ar.setVisibility(s,h.visible),h.alphaFactor!==void 0&&ar.setAlphaFactor(s,h.alphaFactor),h.pickable!==void 0&&ar.setPickable(s,h.pickable),h.colorOnly!==void 0&&ar.setColorOnly(s,h.colorOnly),h.overpaint!==void 0,h.transparency!==void 0,h.substance!==void 0,h.transform!==void 0&&ar.setTransform(s,h.transform),e.updateState(f,h)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=i})(Yt||(Yt={}));function Kn(e,t,r){r===void 0&&(r={});var n=0,a=new xn,i=Yt.createState(),o=oc(),s=[],u,l,c=-1,d=qn.createEmpty(),f=E.getDefaultValues(t.Params),p,v,m;r.modifyState&&Yt.updateState(i,r.modifyState(i));var h=Ou.create();function g(S,C){Ou.reset(h),!(!C&&!l)&&(C&&!l?h.createNew=!0:C&&l&&C.id===l.id||(C&&l&&C.id!==l.id?(h.updateTransform=!0,h.createGeometry=!0):C&&console.warn("unexpected state")),h.updateTransform&&(h.updateColor=!0,h.updateSize=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0))}function y(S,C){var x=this;return S===void 0&&(S={}),r.modifyProps&&(S=r.modifyProps(S)),Fe.create("ShapeRepresentation.create",function(A){return se(x,void 0,void 0,function(){var P,T,D,I,M,B,U,V;return ie(this,function(F){switch(F.label){case 0:return P=Object.assign(f,S),C?[4,e(A,C,P,l)]:[3,2];case 1:return D=F.sent(),[3,3];case 2:D=void 0,F.label=3;case 3:if(T=D,g(S,T),T&&(l=T,Object.assign(d,xr.getTheme(l))),h.createNew)s.length=0,v=xr.groupIterator(l),I=xr.createTransform(l.transforms),M=t.createValues(l.geometry,I,v,d,P),B=t.createRenderableState(P),r.modifyState&&Object.assign(B,r.modifyState(B)),Yt.updateState(i,B),u=Lm(l.geometry.kind,M,B,o),u&&s.push(u),m=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");h.updateTransform&&(xr.createTransform(l.transforms,u.values),v=xr.groupIterator(l),U=v.instanceCount,V=v.groupCount,ms(U*V,u.values)),h.createGeometry&&(R.updateIfChanged(u.values.drawCount,Fa.getDrawCount(l.geometry)),R.updateIfChanged(u.values.uVertexCount,Fa.getVertexCount(l.geometry))),(h.updateTransform||h.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),m=t.createPositionIterator(l.geometry,u.values)),h.updateColor&&Po(v,m,d.color,u.values),h.updateSize&&"uSize"in u.values&&Jl(v,d.size,u.values),t.updateValues(u.values,P),t.updateRenderableState(u.state,P)}return f=P,(h.createGeometry||h.createNew)&&(c+=1),a.next(n++),[2]}})})})}function b(S,C){return go(S)||xr.isLoci(S)&&S.shape===l?C(Ce.ofBounds(0,l.groupCount*l.transforms.length)):kpe(S,l,C)}return{label:"Shape geometry",get groupCount(){return v?v.count:0},get props(){return f},get params(){return p},get state(){return i},get theme(){return d},renderObjects:s,get geometryVersion(){return c},updated:a,createOrUpdate:y,getLoci:function(S){if(S===void 0)return xr.Loci(l);var C=S.objectId,x=S.groupId,A=S.instanceId;return u&&u.id===C?_i.Loci(l,[{ids:Ee.ofSingleton(x),instance:A}]):yr},mark:function(S,C){if(!mi.is(i.markerActions,C))return!1;if(_i.isLoci(S)||xr.isLoci(S)){if(S.shape!==l)return!1}else if(!go(S))return!1;return ar.mark(u,S,C,b)},setState:function(S){r.modifyState&&(S=r.modifyState(S)),u&&(S.visible!==void 0&&ar.setVisibility(u,S.visible),S.alphaFactor!==void 0&&ar.setAlphaFactor(u,S.alphaFactor),S.pickable!==void 0&&ar.setPickable(u,S.pickable),S.colorOnly!==void 0&&ar.setColorOnly(u,S.colorOnly),S.overpaint!==void 0&&ar.setOverpaint(u,S.overpaint,b,!0),S.transparency!==void 0&&ar.setTransparency(u,S.transparency,b,!0),S.substance!==void 0&&ar.setSubstance(u,S.substance,b,!0),S.transform!==void 0&&ar.setTransform(u,S.transform)),Yt.updateState(i,S)},setTheme:function(S){Ar&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function kpe(e,t,r){if(!_i.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,i=e.groups,o=0,s=i;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Ce.is(l)){var d=c*a+Ce.start(l),f=c*a+Ce.end(l);r(Ce.ofBounds(d,f))&&(n=!0)}else for(var p=0,v=l.length;p<v;p++){var m=c*a+l[p];r(Ce.ofSingleton(m))&&(n=!0)}}return n}var b6=oe(),lm=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=us.Mutable(),this.groupIndexMap=us.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}return e.prototype.reset=function(){this.version=0,Qb(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(oe.fromArray(b6,this.unitTransforms,t),!oe.isIdentity(b6)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,oe.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return oe.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),S6=oe();function x6(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];nn.lerpFromIdentity(S6,i.conformation.operator,r),t.setTransform(S6,i)}}var C6=w(),yv=w(),e2=oe();function w6(e,t,r,n){for(var a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];w.transformMat4(C6,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),w.sub(yv,C6,n.center),w.setMagnitude(yv,yv,a),oe.fromTranslation(e2,yv),t.setTransform(e2,s)}}var Lpe={axis:E.MappedStatic("custom",{structure:E.Group({principalAxis:E.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:E.Group({vector:E.Vec3(w.create(0,0,1))})}),origin:E.MappedStatic("structure",{structure:E.Group({}),custom:E.Group({vector:E.Vec3(w.create(0,0,0))})})};function _6(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var a=Ne.getPrincipalAxes(e);r=a.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var a=Ne.getPrincipalAxes(e);n=a.momentsAxes.origin}return{axis:r,origin:n}}var A6=oe(),T6=oe(),Oy=oe();function P6(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];w.negate(yv,a),oe.fromTranslation(e2,yv),oe.fromRotation(A6,Math.PI*r*2,n),oe.fromTranslation(T6,a),oe.mul(Oy,A6,e2),oe.mul(Oy,T6,Oy),t.setTransform(Oy,s)}}var Fpe={radius:1,detail:0};function Npe(e,t,r){var n=_(_({},Fpe),r),a=n.radius,i=n.detail,o=Upe(),s=o.vertices,u=o.indices;c(i),goe(s,a);var l=new Float32Array(s.length);return G7(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var p=w(),v=w(),m=w(),h=0;h<t.length;h+=3)w.fromArray(p,e,t[h+0]*3),w.fromArray(v,e,t[h+1]*3),w.fromArray(m,e,t[h+2]*3),d(p,v,m,f)}function d(f,p,v,m){for(var h=Math.pow(2,m),g=[],y=0;y<=h;++y){g[y]=[];var b=w();w.lerp(b,f,v,y/h);var S=w();w.lerp(S,p,v,y/h);for(var C=h-y,x=0;x<=C;++x)if(x===0&&y===h)g[y][x]=b;else{var A=w();w.lerp(A,b,S,x/C),g[y][x]=A}}for(var y=0;y<h;++y)for(var x=0;x<2*(h-y)-1;++x){var P=Math.floor(x/2);x%2===0?o.add(g[y][P+1],g[y+1][P],g[y][P]):o.add(g[y][P+1],g[y+1][P+1],g[y+1][P])}}}function Upe(){var e=[],t=[],r=new Map;function n(a){var i="".concat(a[0].toFixed(5),"|").concat(a[1].toFixed(5),"|").concat(a[2].toFixed(5)),o=r.get(i);return o===void 0&&(o=e.length/3,r.set(i,o),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}var Mo=(1+Math.sqrt(5))/2,zpe=[-1,Mo,0,1,Mo,0,-1,-Mo,0,1,-Mo,0,0,-1,Mo,0,1,Mo,0,-1,-Mo,0,1,-Mo,Mo,0,-1,Mo,0,1,-Mo,0,-1,-Mo,0,1],Vpe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i3;function Hpe(){return i3||(i3=DS(zpe,Vpe)),i3}var FU=Hpe(),Gpe=FU.vertices,qpe=FU.indices;function qS(e){return 10*Math.pow(Math.pow(2,e),2)+2}function jpe(e){return Npe(Gpe,qpe,{detail:e,radius:1})}var E6=new Map,Wpe=oe.identity();function Xpe(e,t,r){return oe.scaleUniformly(e,oe.fromTranslation(e,t),r)}function NU(e){var t=E6.get(e);return t===void 0&&(t=jpe(e),E6.set(e,t)),t}function la(e,t,r,n){ct.addPrimitive(e,Xpe(Wpe,t,r),NU(n))}var lu={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function Ype(e){var t=_(_({},lu),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],p=[],v=0,m=[],h=a/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function g(){for(var b=w.zero(),S=(n-r)/a,C=0;C<=o;++C){for(var x=[],A=C/o,P=A*(n-r)+r,T=0;T<=i;++T){var D=T/i,I=D*c+l,M=Math.sin(I),B=Math.cos(I);f.push(P*M,-A*a+h,P*B),w.normalize(b,w.set(b,M,S,B)),p.push.apply(p,b),x.push(v++)}m.push(x)}for(var T=0;T<i;++T)for(var C=0;C<o;++C){var U=m[C][T],V=m[C+1][T],F=m[C+1][T+1],Y=m[C][T+1];d.push(U,V,Y),d.push(V,F,Y)}}function y(b){for(var S=b===!0?r:n,C=b===!0?1:-1,x=v,A=1;A<=i;++A)f.push(0,h*C,0),p.push(0,C,0),++v;for(var P=v,A=0;A<=i;++A){var T=A/i,D=T*c+l,I=Math.cos(D),M=Math.sin(D);f.push(S*M,h*C,S*I),p.push(0,C,0),++v}for(var A=0;A<i;++A){var B=x+A,U=P+A;b===!0?d.push(U,U+1,B):d.push(U+1,U,B)}}}var I6=w(),D6=w(),Ni=w(),Ui=w(),au=w(),Wp=w(),Kpe={height:1,topCap:!0,bottomCap:!0};function Fm(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=_(_({},Kpe),t),a=n.height,i=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(i?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=km(s,u),d=a*.5;w.set(I6,0,0,-d),w.set(D6,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;w.set(Ni,e[f*3],e[f*3+1],-d),w.set(Ui,e[p*3],e[p*3+1],-d),w.set(au,e[p*3],e[p*3+1],d),w.set(Wp,e[f*3],e[f*3+1],d),c.addQuad(Ni,Ui,au,Wp)}if(r===3)i&&(w.set(Ni,e[0],e[1],-d),w.set(Ui,e[3],e[4],-d),w.set(au,e[6],e[7],-d),c.add(au,Ui,Ni)),o&&(w.set(Ni,e[0],e[1],d),w.set(Ui,e[3],e[4],d),w.set(au,e[6],e[7],d),c.add(Ni,Ui,au));else if(r===4)i&&(w.set(Ni,e[0],e[1],-d),w.set(Ui,e[3],e[4],-d),w.set(au,e[6],e[7],-d),w.set(Wp,e[9],e[10],-d),c.addQuad(Wp,au,Ui,Ni)),o&&(w.set(Ni,e[0],e[1],d),w.set(Ui,e[3],e[4],d),w.set(au,e[6],e[7],d),w.set(Wp,e[9],e[10],d),c.addQuad(Ni,Ui,au,Wp));else for(var f=0;f<r;++f){var p=(f+1)%r;i&&(w.set(Ni,e[f*3],e[f*3+1],-d),w.set(Ui,e[p*3],e[p*3+1],-d),c.add(I6,Ui,Ni)),o&&(w.set(Ni,e[f*3],e[f*3+1],d),w.set(Ui,e[p*3],e[p*3+1],d),c.add(Ni,Ui,D6))}return c.getPrimitive()}var o3;function Qpe(){return o3||(o3=Fm(zu(4,!1))),o3}var s3;function Zpe(){return s3||(s3=Fm(zu(5,!1))),s3}var u3;function $pe(){return u3||(u3=Fm(zu(6,!1))),u3}var l3;function Jpe(){return l3||(l3=Fm(zu(6,!0))),l3}var c3;function eve(){return c3||(c3=Fm(zu(7,!1))),c3}var M6=new Map,R6=w.create(0,1,0),hu=w(),By=w(),O6=w(),Qc=oe(),B6=oe(),k6=w(),bv=w(),d3=w();function t2(e,t,r,n,a){return w.setMagnitude(By,r,n/2),w.add(O6,t,By),a?w.matchDirection(d3,R6,By):w.copy(d3,R6),w.set(k6,1,n,1),w.makeRotation(B6,d3,By),oe.scale(e,B6,k6),oe.setTranslation(e,O6)}var iu=new Int32Array(9);function tve(e){var t,r,n,a,i,o,s,u,l;return iu[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:lu.radiusTop)),iu[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:lu.radiusBottom)),iu[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:lu.height)),iu[3]=(a=e.radialSegments)!==null&&a!==void 0?a:lu.radialSegments,iu[4]=(i=e.heightSegments)!==null&&i!==void 0?i:lu.heightSegments,iu[5]=((o=e.topCap)!==null&&o!==void 0?o:lu.topCap)?1:0,iu[6]=((s=e.bottomCap)!==null&&s!==void 0?s:lu.bottomCap)?1:0,iu[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:lu.thetaStart)),iu[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:lu.thetaLength)),vi(iu)}function oE(e){var t=tve(e),r=M6.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),a=Fm(zu(n,!0,e.radiusTop),e);r=WP(a,oe.rotX90)}else r=Ype(e);M6.set(t,r)}return r}function ga(e,t,r,n,a){var i=w.distance(t,r)*n;w.sub(hu,r,t),t2(Qc,t,hu,i,!0),ct.addPrimitive(e,Qc,oE(a))}function rve(e,t,r,n,a,i){var o=w.distance(t,r)*n,s=oE(i);w.sub(hu,r,t),w.add(bv,t,a),t2(Qc,bv,hu,o,!0),ct.addPrimitive(e,Qc,s),w.sub(bv,t,a),t2(Qc,bv,hu,o,!0),ct.addPrimitive(e,Qc,s)}function x0(e,t,r,n,a,i){var o=Math.floor(a/2),s=1/a;if(n<1){var u=n/2/a;n+=a%2===1?u:-u}var l=w.distance(t,r)*n,c=oE(i);w.sub(hu,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);w.setMagnitude(hu,hu,l*f),w.add(bv,t,hu),t2(Qc,bv,hu,l*s,!1),ct.addPrimitive(e,Qc,c)}}var Dn=w(),L6=wn(),Ku=w(),ou=w(),Xd=w(),ky=w(),ao=w.fromArray,nve=w.triangleNormal,F6=w.copy,Ly=w.transformMat4,N6=w.transformMat3,U6=wn.directionTransform,Ss=Le.add3,f3=Le.add,ct;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:Le.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:Le.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:Le.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:Le.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,p){var v=c.vertices,m=c.normals,h=c.indices,g=c.groups,y=c.currentGroup,b=v.elementCount;Ss(v,d[0],d[1],d[2]),Ss(v,f[0],f[1],f[2]),Ss(v,p[0],p[1],p[2]),nve(Dn,d,f,p);for(var S=0;S<3;++S)Ss(m,Dn[0],Dn[1],Dn[2]),f3(g,y);Ss(h,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){ao(Xd,d,f[0]*3),ao(ky,d,f[1]*3);for(var p=2,v=f.length;p<v;p+=2)F6(Ku,Xd),F6(ou,ky),ao(Xd,d,f[p]*3),ao(ky,d,f[p+1]*3),r(c,Ku,ou,Xd),r(c,ou,ky,Xd)}e.addTriangleStrip=n;function a(c,d,f){ao(Ku,d,f[0]*3);for(var p=2,v=f.length;p<v;++p)ao(ou,d,f[p-1]*3),ao(Xd,d,f[p]*3),r(c,Ku,Xd,ou)}e.addTriangleFan=a;function i(c,d,f){for(var p=f.vertices,v=f.normals,m=f.indices,h=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,C=h.elementCount,x=U6(L6,d),A=0,P=p.length;A<P;A+=3)Ly(Dn,ao(Dn,p,A),d),Ss(h,Dn[0],Dn[1],Dn[2]),N6(Dn,ao(Dn,v,A),x),Ss(g,Dn[0],Dn[1],Dn[2]),f3(b,S);for(var A=0,P=m.length;A<P;A+=3)Ss(y,m[A]+C,m[A+1]+C,m[A+2]+C)}e.addPrimitive=i;function o(c,d,f){for(var p=f.vertices,v=f.normals,m=f.indices,h=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,C=h.elementCount,x=U6(L6,d),A=0,P=p.length;A<P;A+=3)Ly(Dn,ao(Dn,p,A),d),Ss(h,Dn[0],Dn[1],Dn[2]),N6(Dn,ao(Dn,v,A),x),Ss(g,-Dn[0],-Dn[1],-Dn[2]),f3(b,S);for(var A=0,P=m.length;A<P;A+=3)Ss(y,m[A+2]+C,m[A+1]+C,m[A]+C)}e.addPrimitiveFlipped=o;function s(c,d,f,p,v,m){for(var h=f.vertices,g=f.edges,y={radiusTop:p,radiusBottom:p,radialSegments:m},b=0,S=g.length;b<S;b+=2)ao(Ku,h,g[b]*3),ao(ou,h,g[b+1]*3),Ly(Ku,Ku,d),Ly(ou,ou,d),la(c,Ku,p,v),la(c,ou,p,v),ga(c,Ku,ou,1,y)}e.addCage=s;function u(c,d,f){i(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,p=c.indices,v=c.groups,m=c.mesh,h=Le.compact(d,!0),g=Le.compact(p,!0),y=Le.compact(f,!0),b=Le.compact(v,!0);return Rt.create(h,g,y,b,c.vertices.elementCount,c.indices.elementCount,m)}e.getMesh=l})(ct||(ct={}));var ave=oe.fromTranslation(oe(),w.create(.5,.5,.5)),ive=v9(p9(h9()),ave),xs=w(),z6=oe(),ove={origin:"Origin",model:"Model"},sve={corner:"Corner",center:"Center"},uve=_(_({},Rt.Params),{cellColor:E.Color(tr.orange),cellScale:E.Numeric(2,{min:.1,max:5,step:.1}),ref:E.Select("model",E.objectToOptions(ove),{isEssential:!0}),attachment:E.Select("corner",E.objectToOptions(sve),{isEssential:!0})}),lve={mesh:function(e,t){return Kn(dve,Rt.Utils)}},V6=_({},uve);function cve(e,t,r){var n=ct.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;w.copy(xs,e.ref),t.attachment==="center"?(w.trunc(xs,xs),w.subScalar(xs,xs,.5)):w.floor(xs,xs),oe.fromTranslation(z6,xs);var i=v9(p9(ive),z6),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,ct.addCage(n,a,i,o,2,20);var s=Me.fromDimensionsAndTransform(Me(),w.unit,a);w.transformMat4(xs,xs,a),Me.translate(s,s,xs),Me.expand(s,s,o);var u=ct.getMesh(n);return u.setBoundingSphere(s),u}function dve(e,t,r,n){var a=cve(t,r,n&&n.geometry),i=rg.getUnitcellLabel(t.symmetry);return xr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function H6(e,t,r){var n=w();return r.ref==="model"&&w.transformMat4(n,zt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function fve(e,t){return Yt.createMulti("Unit Cell",e,t,Yt.StateBuilder,lve)}var Ro=new Uint16Array([0,1,2,1,3,2]),Yd=Le.add3,Ta=Le.add2,G6=Le.add,Ll;(function(e){function t(r,n,a,i){r===void 0&&(r={}),n===void 0&&(n=2048),a===void 0&&(a=1024),n*=2,a*=2;var o=Le.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=Le.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=Le.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),l=Le.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),c=Le.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),d=Le.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),f=_(_({},E.getDefaultValues(cs.Params)),r),p=f.attachment,v=f.background,m=f.backgroundMargin,h=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=Xle(f),S=1/2.5*m,C=b.buffer/b.lineHeight,x=function(A,P,T,D,I){Yd(o,A,P,T),G6(u,D),G6(c,I)};return{add:function(A,P,T,D,I,M,B){for(var U=0,V=A.length,F=0;F<V;++F){var Y=b.get(A[F]);U+=Y.nw-2*C}var W=1/1.25,K,$;if(p.startsWith("top")?K=W:p.startsWith("middle")?K=W/2:K=0,p.endsWith("right")?$=U:p.endsWith("center")?$=U/2:$=0,h)switch(p){case"bottom-left":$-=g/2+S+.1,K-=g/2+S;break;case"bottom-center":K-=g+S;break;case"bottom-right":$+=g/2+S+.1,K-=g/2+S;break;case"middle-left":$-=g+S+.1;break;case"middle-center":break;case"middle-right":$+=g+S+.1;break;case"top-left":$-=g/2+S+.1,K+=g/2+S;break;case"top-center":K+=g+S;break;case"top-right":$+=g/2+S+.1,K+=g/2+S;break}var J=(-$-S-.1)*M,Z=(U-$+S+.1)*M,N=(W-K+S)*M,j=(-K-S)*M;if(v){Ta(s,J,N),Ta(s,J,j),Ta(s,Z,N),Ta(s,Z,j);for(var L=o.elementCount,H=0;H<4;++H)Ta(d,10,10),x(P,T,D,I,B);Yd(l,L+Ro[0],L+Ro[1],L+Ro[2]),Yd(l,L+Ro[3],L+Ro[4],L+Ro[5])}if(h){var G=void 0,q=void 0,X=void 0,Q=void 0,ue=void 0,le=void 0,ve=void 0,ge=void 0,Se=g*M,ae=y*M;switch(p){case"bottom-left":G=J-Se/2,X=J+ae/2,ue=J,ve=J,q=j-Se/2,Q=j,le=j+ae/2,ge=j;break;case"bottom-center":G=0,X=ae/2,ue=-ae/2,ve=0,q=j-Se,Q=j,le=j,ge=j;break;case"bottom-right":G=Z+Se/2,X=Z,ue=Z-ae/2,ve=Z,q=j-Se/2,Q=j+ae/2,le=j,ge=j;break;case"middle-left":G=J-Se,X=J,ue=J,ve=J,q=0,Q=-ae/2,le=ae/2,ge=0;break;case"middle-center":G=0,X=0,ue=0,ve=0,q=0,Q=0,le=0,ge=0;break;case"middle-right":G=Z+Se,X=Z,ue=Z,ve=Z,q=0,Q=ae/2,le=-ae/2,ge=0;break;case"top-left":G=J-Se/2,X=J+ae/2,ue=J,ve=J,q=N+Se/2,Q=N,le=N-ae/2,ge=N;break;case"top-center":G=0,X=ae/2,ue=-ae/2,ve=0,q=N+Se,Q=N,le=N,ge=N;break;case"top-right":G=Z+Se/2,X=Z,ue=Z-ae/2,ve=Z,q=N+Se/2,Q=N-ae/2,le=N,ge=N;break;default:throw new Error("unsupported attachment")}Ta(s,G,q),Ta(s,X,Q),Ta(s,ue,le),Ta(s,ve,ge);for(var L=o.elementCount,H=0;H<4;++H)Ta(d,10,10),x(P,T,D,I,B);Yd(l,L,L+1,L+3),Yd(l,L,L+3,L+2)}$+=C,K+=C;for(var re=0,F=0;F<V;++F){var Y=b.get(A[F]),O=(re-$)*M,z=(re+Y.nw-$)*M,de=(Y.nh-K)*M,me=-K*M;Ta(s,O,de),Ta(s,O,me),Ta(s,z,de),Ta(s,z,me);var ye=b.texture.width,Te=b.texture.height;Ta(d,Y.x/ye,Y.y/Te),Ta(d,Y.x/ye,(Y.y+Y.h)/Te),Ta(d,(Y.x+Y.w)/ye,Y.y/Te),Ta(d,(Y.x+Y.w)/ye,(Y.y+Y.h)/Te),re+=Y.nw-2*C;for(var L=o.elementCount,H=0;H<4;++H)x(P,T,D,I,B);Yd(l,L+Ro[0],L+Ro[1],L+Ro[2]),Yd(l,L+Ro[3],L+Ro[4],L+Ro[5])}},getText:function(){var A=b.texture,P=Le.compact(o,!0),T=Le.compact(s,!0),D=Le.compact(u,!0),I=Le.compact(l,!0),M=Le.compact(c,!0),B=Le.compact(d,!0);return cs.create(A,P,T,D,I,M,B,l.elementCount/2,i)}}}e.create=t})(Ll||(Ll={}));var Nm={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Jf(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return sg(Bs.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?sE(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Ee.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return["".concat(e.volume.label||"Volume"),"Isosurface at ".concat(ht.IsoValue.toString(e.isoValue))].join(" | ");case"cell-loci":var a=Ee.size(e.indices),i=Ee.start(e.indices),o=ht.IsoValue.absolute(e.volume.grid.cells.data[i]),s=ht.IsoValue.toRelative(o,e.volume.grid.stats),u=["".concat(e.volume.label||"Volume"),"".concat(a===1?"Cell #".concat(i):"".concat(a," Cells"))];return a===1&&u.push("".concat(ht.IsoValue.toString(o)," (").concat(ht.IsoValue.toString(s),")")),u.join(" | ")}}function lv(e,t){return e===1?"1 ".concat(t):"".concat(e," ").concat(t,"s")}function fh(e,t,r,n,a,i){return"".concat(As(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})," <small>[+ ").concat(lv(e-1,"other ".concat(Pm(r))),"]</small>")}function pve(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments,o=a.offsets[a.index[t[0]]],s=a.offsets[a.index[t[t.length-1]]+1]-1;return i.index[s]-i.index[o]+1}function sg(e,t){t===void 0&&(t={});var r=_(_({},Nm),t),n=vve(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:jc(n)}function kg(e,t){t===void 0&&(t={});for(var r=Bs.create(),n=0,a=e;n<a.length;n++){var i=a[n];Bs.add(r,r,Bs.ofLoci(i))}return sg(r,t)}function vve(e,t,r,n,a){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return As(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&l===0&&s===1&&o===0)return As(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=Be.isAtomic(c)&&pve(c)===1||Be.Traits.is(c.traits,1)?"residue":"chain";return As(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:a})}else if(t){var f=[];return i>0&&f.push(lv(i,"Structure")),o>0&&f.push(lv(o,"Chain")),s>0&&f.push(lv(s,"Residue")),u>0&&f.push(lv(u,"Conformation")),l>0&&f.push(lv(l,"Element")),f.join("<small> + </small>")}else{var f=[];return i>0&&f.push(i===1?As(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):fh(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(f.push(o===1?As(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):fh(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(f.push(s===1?As(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):fh(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(f.push(u===1?As(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):fh(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),l>0&&f.push(l===1?As(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):fh(l,e.firstElementLoc,"element",r,a,n)),f.join("<small> + </small>")}}function sE(e,t){return t===void 0&&(t={}),jS({loci:[xe(e.aStructure,[{unit:e.aUnit,indices:Ee.ofSingleton(e.aIndex)}]),xe(e.bStructure,[{unit:e.bUnit,indices:Ee.ofSingleton(e.bIndex)}])]},t)}function jS(e,t){t===void 0&&(t={});var r=_(_({},Nm),t),n=mve(e,r);return r.htmlStyling?n:jc(n)}function mve(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!xe.is(l)||xe.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],C=S.unit,x=S.indices;return He.create(b.structure,C,C.elements[Ee.start(x)])}),d=c.map(function(b){return UU(b,r,n,a||i)});if(i)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" \u2014 ");for(var f=0,p=0,v=Math.min.apply(Math,d.map(function(b){return b.length}))-1;p<v;++p){for(var m=!0,h=1,g=d.length;h<g;++h)if(d[0][p]!==d[h][p]){m=!1;break}if(m)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],h=1,g=d.length;h<g;++h)y.push(d[h].slice(f).filter(function(C){return!!C}).join(" | "));return y.join(" \u2014 ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return Jf(S,t)});return d.filter(function(S){return!!S}).join(i?" \u2014 ":"</br>")}}function As(e,t){var r,n;t===void 0&&(t={});var a=_(_({},Nm),t),i=UU(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:jc(o)}function UU(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>".concat(i,"</small>")),t!=="structure"&&(a.push("<small>Model ".concat(e.unit.model.modelNum,"</small>")),a.push("<small>Instance ".concat(e.unit.conformation.operator.name,"</small>")))}return Be.isAtomic(e.unit)?a.push.apply(a,hve(e,t,n)):Be.isCoarse(e.unit)?a.push.apply(a,gve(e,t)):a.push("Unknown"),n?a.reverse():a}function hve(e,t,r){r===void 0&&(r=!1);var n=He.residueIndex(e),a=tt.chain.label_asym_id(e),i=tt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=tt.residue.label_seq_id(e),u=tt.residue.auth_seq_id(e),l=tt.residue.pdbx_PDB_ins_code(e),c=tt.atom.label_comp_id(e),d=tt.atom.label_atom_id(e),f=tt.atom.label_alt_id(e),p=tt.atom.occupancy(e),v=tt.residue.microheterogeneityCompIds(e),m=t==="residue"&&v.length>1?"(".concat(v.join("|"),")"):c,h=[];switch(t){case"element":h.push("<b>".concat(d,"</b>").concat(f?"%".concat(f):""));case"conformation":t==="conformation"&&f&&h.push("<small>Conformation</small> <b>".concat(f,"</b>"));case"residue":var g=s===u||!o?u:s;h.push("<b>".concat(m," ").concat(g,"</b>").concat(g!==u?" <small>[auth</small> <b>".concat(u,"</b><small>]</small>"):"","<b>").concat(l||"","</b>"));case"chain":a===i?h.push("<b>".concat(a,"</b>")):t==="chain"&&Be.Traits.is(e.unit.traits,1)?h.push("<small>[auth</small> <b>".concat(i,"</b><small>]</small>")):h.push("<b>".concat(a,"</b> <small>[auth</small> <b>").concat(i,"</b><small>]</small>"))}return h.length>0&&p!==1&&!r&&(h[0]="".concat(h[0]," <small>[occupancy</small> <b>").concat(Math.round(100*p)/100,"</b><small>]</small>")),h.reverse()}function gve(e,t){var r=tt.coarse.asym_id(e),n=tt.coarse.seq_id_begin(e),a=tt.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=tt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);i.push("<b>".concat(u," ").concat(n,"</b>"))}else i.push("<b>".concat(n,"-").concat(a,"</b>"));case"chain":i.push("<b>".concat(r,"</b>"))}return i.reverse()}function WS(e,t){t===void 0&&(t={});var r=_(_(_({},Nm),{measureOnly:!1,unitLabel:"\u212B"}),t),n=e.loci.map(function(u){return Xt.getCenter(u)}),a=n[0],i=n[1],o="".concat(w.distance(a,i).toFixed(2)," ").concat(r.unitLabel);if(r.measureOnly)return o;var s=jS(e,r);return r.condensed?"".concat(o," | ").concat(s):"Distance ".concat(o,"</br>").concat(s)}function XS(e,t){t===void 0&&(t={});var r=_(_(_({},Nm),{measureOnly:!1}),t),n=e.loci.map(function(d){return Xt.getCenter(d)}),a=n[0],i=n[1],o=n[2],s=w.sub(w(),a,i),u=w.sub(w(),o,i),l="".concat(Fs(w.angle(s,u)).toFixed(2),"\xB0");if(r.measureOnly)return l;var c=jS(e,r);return r.condensed?"".concat(l," | ").concat(c):"Angle ".concat(l,"</br>").concat(c)}function YS(e,t){t===void 0&&(t={});var r=_(_(_({},Nm),{measureOnly:!1}),t),n=e.loci.map(function(c){return Xt.getCenter(c)}),a=n[0],i=n[1],o=n[2],s=n[3],u="".concat(Fs(w.dihedralAngle(a,i,o,s)).toFixed(2),"\xB0");if(r.measureOnly)return u;var l=jS(e,r);return r.condensed?"".concat(u," | ").concat(l):"Dihedral ".concat(u,"</br>").concat(l)}var zU={customText:E.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:E.Color(tr.black,{isEssential:!0}),textSize:E.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},KS=_(_(_({},cs.Params),zU),{borderWidth:E.Numeric(.2,{min:0,max:.5,step:.01})}),VU={unitLabel:E.Text("\u212B",{isEssential:!0})},yve=_(_(_({},on.Params),VU),{lineSizeAttenuation:E.Boolean(!0),linesColor:E.Color(tr.lightgreen,{isEssential:!0}),linesSize:E.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.2,{min:.01,max:.2,step:.01})}),bve=_(_({},KS),VU),HU={lines:function(e,t){return Kn(Cve,on.Utils,{modifyState:function(r){return _(_({},r),{markerActions:mi.Highlighting})}})},text:function(e,t){return Kn(_ve,cs.Utils,{modifyState:function(r){return _(_({},r),{markerActions:wt.None})}})}},q6=_(_(_({},yve),bve),{visuals:E.MultiSelect(["lines","text"],E.objectToOptions(HU))});function Sve(){return{sphereA:Me(),sphereB:Me(),center:w(),distance:0}}function GU(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,o=i[0],s=i[1];return Xt.getBoundingSphere(o,r),Xt.getBoundingSphere(s,n),w.add(a,r.center,n.center),w.scale(a,a,.5),t.distance=w.distance(r.center,n.center),t}var Nc=Sve();function qU(e,t){return e.pairs.length===1?"Distance ".concat(WS(e.pairs[0],{unitLabel:t,measureOnly:!0})):"".concat(e.pairs.length," Distances")}function xve(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)GU(e.pairs[a],Nc),n.addFixedLengthDashes(Nc.sphereA.center,Nc.sphereB.center,t.dashLength,a);return n.getLines()}function Cve(e,t,r,n){var a=xve(t,r,n&&n.geometry),i=qU(t,r.unitLabel),o=function(s){return WS(t.pairs[s],r)};return xr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},o)}function wve(e,t,r){for(var n=Ll.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){GU(e.pairs[a],Nc);var o=Nc.center,s=Nc.distance,u=Nc.sphereA,l=Nc.sphereB,c=t.customText||"".concat(s.toFixed(2)," ").concat(t.unitLabel),d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,a)}return n.getText()}function _ve(e,t,r,n){var a=wve(t,r,n&&n.geometry),i=qU(t,r.unitLabel),o=function(s){return WS(t.pairs[s],r)};return xr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function Ave(e,t){return Yt.createMulti("Distance",e,t,Yt.StateBuilder,HU)}function j6(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function W6(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function X6(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,a=e[3].loci;return{quads:[{loci:[t,r,n,a]}]}}function Y6(e){var t=e[0].loci;return{infos:[{loci:t}]}}function K6(e){return{locis:e.map(function(t){return t.loci})}}function Q6(e){return{locis:e.map(function(t){return t.loci})}}var Tve=_(_({},KS),{offsetZ:E.Numeric(2,{min:0,max:10,step:.1})}),jU={text:function(e,t){return Kn(Dve,cs.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})}},Z6=_(_({},Tve),{scaleByRadius:E.Boolean(!0),visuals:E.MultiSelect(["text"],E.objectToOptions(jU))}),Pve=Me();function uE(e,t){return t===void 0&&(t=!1),e.label||Jf(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function Eve(e){return e.infos.length===1?uE(e.infos[0]):"".concat(e.infos.length," Labels")}function Ive(e,t,r){for(var n=Ll.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=Xt.getBoundingSphere(s.loci,Pve);if(!!u){var l=u.center,c=u.radius,d=a||uE(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}}return n.getText()}function Dve(e,t,r,n){var a=Ive(t,r,n&&n.geometry),i=Eve(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return uE(t.infos[u])};return xr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},s)}function Mve(e,t){return Yt.createMulti("Label",e,t,Yt.StateBuilder,jU)}var Kd=w(),Rve=oe.identity(),Qd=new Float32Array(6*3),Ove=new Uint8Array([0,1,2,3,4,5]);function Bve(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;w.add(Kd,i,o),w.toArray(w.add(Kd,i,o),Qd,0),w.toArray(w.sub(Kd,i,o),Qd,3),w.toArray(w.add(Kd,i,s),Qd,6),w.toArray(w.sub(Kd,i,s),Qd,9),w.toArray(w.add(Kd,i,u),Qd,12),w.toArray(w.sub(Kd,i,u),Qd,15);var l=XP(Qd,Ove),c=si.volume(t),d=Math.cbrt(c)/300*r;ct.addCage(e,Rve,l,d,n,a)}w.zero();w.zero();var fc=w(),kve=w(),Lve=w(),Fve=w(),Nve=oe.identity(),$6=new Float32Array(8*3),Uve=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function zve(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=w.negate(kve,o),c=w.negate(Lve,s),d=w.negate(Fve,u),f=0,p=function(g,y,b){w.copy(fc,i),w.add(fc,fc,g),w.add(fc,fc,y),w.add(fc,fc,b),w.toArray(fc,$6,f),f+=3};p(o,s,u),p(o,s,d),p(o,c,d),p(o,c,u),p(l,c,d),p(l,c,u),p(l,s,u),p(l,s,d);var v=XP($6,Uve),m=si.volume(t),h=Math.cbrt(m)/300*r;ct.addCage(e,Nve,v,h,n,a)}var Vve=oe.identity(),J6=w();function Hve(e,t,r,n,a){return w.add(J6,t,r),oe.targetTo(e,t,J6,n),oe.setTranslation(e,t),oe.scale(e,e,a)}function lE(e,t,r,n,a,i){ct.addPrimitive(e,Hve(Vve,t,r,n,a),NU(i))}var cE={color:E.Color(tr.orange),scaleFactor:E.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:E.Numeric(2,{min:.1,max:10,step:.1})},Gve=_(_({},Rt.Params),cE),qve=_(_({},Rt.Params),cE),jve=_(_({},Rt.Params),cE),WU={axes:function(e,t){return Kn(Yve,Rt.Utils)},box:function(e,t){return Kn(Zve,Rt.Utils)},ellipsoid:function(e,t){return Kn(eme,Rt.Utils)}},eO=_(_(_(_({},Gve),qve),jve),{visuals:E.MultiSelect(["box"],E.objectToOptions(WU))});function Wve(e){var t=kg(e,{countsOnly:!0});return"Principal Axes of ".concat(t)}function Xve(e,t,r){var n=ct.createState(256,128,r),a=xe.getPrincipalAxesMany(e.locis);return si.scale(a.momentsAxes,a.momentsAxes,t.scaleFactor),n.currentGroup=0,Bve(n,a.momentsAxes,t.radiusScale,2,20),ct.getMesh(n)}function Yve(e,t,r,n){var a=Xve(t,r,n&&n.geometry),i=Wve(t.locis);return xr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function Kve(e){var t=kg(e,{countsOnly:!0});return"Oriented Box of ".concat(t)}function Qve(e,t,r){var n=ct.createState(256,128,r),a=xe.getPrincipalAxesMany(e.locis);return si.scale(a.boxAxes,a.boxAxes,t.scaleFactor),n.currentGroup=0,zve(n,a.boxAxes,t.radiusScale,2,20),ct.getMesh(n)}function Zve(e,t,r,n){var a=Qve(t,r,n&&n.geometry),i=Kve(t.locis);return xr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function $ve(e){var t=kg(e,{countsOnly:!0});return"Oriented Ellipsoid of ".concat(t)}function Jve(e,t,r){var n=ct.createState(256,128,r),a=xe.getPrincipalAxesMany(e.locis),i=a.boxAxes,o=i.origin,s=i.dirA,u=i.dirB,l=si.size(w(),i);w.scale(l,l,.5*t.scaleFactor);var c=w.create(l[2],l[1],l[0]);return n.currentGroup=0,lE(n,o,s,u,c,2),ct.getMesh(n)}function eme(e,t,r,n){var a=Jve(t,r,n&&n.geometry),i=$ve(t.locis);return xr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function tme(e,t){var r=Yt.createMulti("Orientation",e,t,Yt.StateBuilder,WU);return r.setState({markerActions:mi.Highlighting}),r}var rme={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function XU(e){var t=_(_({},rme),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=a+d/n*i;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var v=(n-1)*3;c[v]=n,c[v+1]=1,c[v+2]=0}else{var p=a+i,f=(n+1)*3;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0;var v=(n-1)*3;c[v]=n,c[v+1]=n+1,c[v+2]=0}return{vertices:u,normals:l,indices:c}}var YU={color:E.Color(tr.lightgreen),arcScale:E.Numeric(.7,{min:.01,max:1,step:.01})},KU=_(_(_({},on.Params),YU),{lineSizeAttenuation:E.Boolean(!0),linesSize:E.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.04,{min:.01,max:.2,step:.01})}),nme=_({},KU),ame=_({},KU),ime=_(_(_({},Rt.Params),YU),{ignoreLight:E.Boolean(!0),sectorOpacity:E.Numeric(.75,{min:0,max:1,step:.01})}),QU={vectors:function(e,t){return Kn(ume,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},arc:function(e,t){return Kn(cme,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},sector:function(e,t){return Kn(fme,Rt.Utils,{modifyProps:function(r){return _(_({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return _(_({},r),{markerActions:mi.Highlighting})}})},text:function(e,t){return Kn(vme,cs.Utils,{modifyState:function(r){return _(_({},r),{markerActions:wt.None})}})}},tO=_(_(_(_(_({},nme),ame),ime),KS),{visuals:E.MultiSelect(["vectors","sector","text"],E.objectToOptions(QU))});function ome(){return{sphereA:Me(),sphereB:Me(),sphereC:Me(),arcDirA:w(),arcDirC:w(),arcNormal:w(),radius:0,angle:0}}var pc=w(),ph=oe();function QS(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];Xt.getBoundingSphere(c,n),Xt.getBoundingSphere(d,a),Xt.getBoundingSphere(f,i),w.sub(o,n.center,a.center),w.sub(s,i.center,a.center),w.cross(u,o,s);var p=Math.min(w.magnitude(o),w.magnitude(s)),v=p*r;return t.radius=v,t.angle=w.angle(o,s),t}function ZU(e,t){var r=e.radius,n=e.angle,a=t?_8(n,r)/t:32;oe.targetTo(ph,e.sphereB.center,e.sphereA.center,e.arcNormal),oe.setTranslation(ph,e.sphereB.center),oe.mul(ph,ph,oe.rotY180);var i=XU({radius:r,thetaLength:n,segments:a});return WP(i,ph)}var Da=ome();function ZS(e){return e.triples.length===1?"Angle ".concat(XS(e.triples[0],{measureOnly:!0})):"".concat(e.triples.length," Angles")}function sme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.triples.length;a<i;++a)QS(e.triples[a],Da,t.arcScale),n.addFixedLengthDashes(Da.sphereB.center,Da.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Da.sphereB.center,Da.sphereC.center,t.dashLength,a);return n.getLines()}function ume(e,t,r,n){var a=sme(t,r,n&&n.geometry),i=ZS(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function lme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.triples.length;a<i;++a){QS(e.triples[a],Da,t.arcScale);for(var o=ZU(Da,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],v=u[d+1],m=u[d+2],h=u[f],g=u[f+1],y=u[f+2];n.add(p,v,m,h,g,y,a)}}return n.getLines()}function cme(e,t,r,n){var a=lme(t,r,n&&n.geometry),i=ZS(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function dme(e,t,r){for(var n=ct.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){QS(e.triples[a],Da,t.arcScale);var o=ZU(Da);n.currentGroup=a,ct.addPrimitive(n,oe.id,o),ct.addPrimitiveFlipped(n,oe.id,o)}return ct.getMesh(n)}function fme(e,t,r,n){var a=dme(t,r,n&&n.geometry),i=ZS(t),o=function(s){return XS(t.triples[s])};return xr.create(i,t,a,function(){return r.color},function(){return 1},o)}function pme(e,t,r){for(var n=Ll.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){QS(e.triples[a],Da,t.arcScale),w.add(pc,Da.arcDirA,Da.arcDirC),w.setMagnitude(pc,pc,Da.radius),w.add(pc,Da.sphereB.center,pc);var o=Fs(Da.angle).toFixed(2),s=t.customText||"".concat(o,"\xB0"),u=Math.max(2,Da.sphereA.radius,Da.sphereB.radius,Da.sphereC.radius),l=u/2;n.add(s,pc[0],pc[1],pc[2],.1,l,a)}return n.getText()}function vme(e,t,r,n){var a=pme(t,r,n&&n.geometry),i=ZS(t),o=function(s){return XS(t.triples[s])};return xr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function mme(e,t){return Yt.createMulti("Angle",e,t,Yt.StateBuilder,QU)}var $U={color:E.Color(tr.lightgreen),arcScale:E.Numeric(.7,{min:.01,max:1,step:.01})},$S=_(_(_({},on.Params),$U),{lineSizeAttenuation:E.Boolean(!0),linesSize:E.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:E.Numeric(.04,{min:.01,max:.2,step:.01})}),hme=_({},$S),gme=_({},$S),yme=_({},$S),bme=_({},$S),Sme=_(_(_({},Rt.Params),$U),{ignoreLight:E.Boolean(!0),sectorOpacity:E.Numeric(.75,{min:0,max:1,step:.01})}),JU={vectors:function(e,t){return Kn(wme,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},extenders:function(e,t){return Kn(Ime,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},connector:function(e,t){return Kn(Ame,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},arms:function(e,t){return Kn(Pme,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},arc:function(e,t){return Kn(Mme,on.Utils,{modifyState:function(r){return _(_({},r),{pickable:!1})}})},sector:function(e,t){return Kn(Ome,Rt.Utils,{modifyProps:function(r){return _(_({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return _(_({},r),{markerActions:mi.Highlighting})}})},text:function(e,t){return Kn(kme,cs.Utils,{modifyState:function(r){return _(_({},r),{markerActions:wt.None})}})}},rO=_(_(_(_(_(_(_({},hme),gme),yme),bme),Sme),KS),{visuals:E.MultiSelect(["extenders","arms","sector","text"],E.objectToOptions(JU))});function xme(){return{sphereA:Me(),sphereB:Me(),sphereC:Me(),sphereD:Me(),dirBA:w(),dirCD:w(),projA:w(),projD:w(),arcPointA:w(),arcPointD:w(),arcDirA:w(),arcDirD:w(),arcCenter:w(),arcNormal:w(),radius:0,angle:0}}var ni=w(),vh=oe();function xp(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,v=t.arcDirD,m=t.arcCenter,h=t.arcNormal,g=e.loci,y=g[0],b=g[1],S=g[2],C=g[3];Xt.getBoundingSphere(y,n),Xt.getBoundingSphere(b,a),Xt.getBoundingSphere(S,i),Xt.getBoundingSphere(C,o),w.add(m,a.center,i.center),w.scale(m,m,.5),w.sub(s,n.center,a.center),w.sub(u,o.center,i.center),w.add(d,m,s),w.add(f,m,u),w.sub(h,i.center,a.center),w.orthogonalize(p,h,s),w.orthogonalize(v,h,u),w.projectPointOnVector(l,d,p,m),w.projectPointOnVector(c,f,v,m);var x=Math.min(w.distance(l,m),w.distance(c,m)),A=x*r;w.setMagnitude(p,p,A),w.setMagnitude(v,v,A),w.add(d,m,p),w.add(f,m,v),t.radius=A,t.angle=w.dihedralAngle(n.center,a.center,i.center,o.center),w.matchDirection(ni,h,w.sub(ni,d,n.center));var P=w.angle(s,ni),T=A/Math.cos(P-l0);w.add(l,a.center,w.setMagnitude(ni,s,T)),w.matchDirection(ni,h,w.sub(ni,f,o.center));var D=w.angle(u,ni),I=A/Math.cos(D-l0);return w.add(c,i.center,w.setMagnitude(ni,u,I)),t}function ez(e,t){var r=e.radius,n=e.angle,a=t?_8(n,r)/t:32;oe.targetTo(vh,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),oe.setTranslation(vh,e.arcCenter),oe.mul(vh,vh,oe.rotY180);var i=XU({radius:r,thetaLength:Math.abs(n),segments:a});return WP(i,vh)}var Yr=xme();function Cp(e){return e.quads.length===1?"Dihedral ".concat(YS(e.quads[0],{measureOnly:!0})):"".concat(e.quads.length," Dihedrals")}function Cme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.quads.length;a<i;++a)xp(e.quads[a],Yr,t.arcScale),n.addFixedLengthDashes(Yr.arcCenter,Yr.arcPointA,t.dashLength,a),n.addFixedLengthDashes(Yr.arcCenter,Yr.arcPointD,t.dashLength,a);return n.getLines()}function wme(e,t,r,n){var a=Cme(t,r,n&&n.geometry),i=Cp(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function _me(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.quads.length;a<i;++a)xp(e.quads[a],Yr,t.arcScale),n.addFixedLengthDashes(Yr.sphereB.center,Yr.sphereC.center,t.dashLength,a);return n.getLines()}function Ame(e,t,r,n){var a=_me(t,r,n&&n.geometry),i=Cp(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Tme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.quads.length;a<i;++a)xp(e.quads[a],Yr,t.arcScale),n.addFixedLengthDashes(Yr.sphereB.center,Yr.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Yr.sphereC.center,Yr.sphereD.center,t.dashLength,a);return n.getLines()}function Pme(e,t,r,n){var a=Tme(t,r,n&&n.geometry),i=Cp(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Eme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.quads.length;a<i;++a)xp(e.quads[a],Yr,t.arcScale),n.addFixedLengthDashes(Yr.arcPointA,Yr.projA,t.dashLength,a),n.addFixedLengthDashes(Yr.arcPointD,Yr.projD,t.dashLength,a);return n.getLines()}function Ime(e,t,r,n){var a=Eme(t,r,n&&n.geometry),i=Cp(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Dme(e,t,r){for(var n=to.create(128,64,r),a=0,i=e.quads.length;a<i;++a){xp(e.quads[a],Yr,t.arcScale);for(var o=ez(Yr,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],v=u[d+1],m=u[d+2],h=u[f],g=u[f+1],y=u[f+2];n.add(p,v,m,h,g,y,a)}}return n.getLines()}function Mme(e,t,r,n){var a=Dme(t,r,n&&n.geometry),i=Cp(t);return xr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Rme(e,t,r){for(var n=ct.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){xp(e.quads[a],Yr,t.arcScale);var o=ez(Yr);n.currentGroup=a,ct.addPrimitive(n,oe.id,o),ct.addPrimitiveFlipped(n,oe.id,o)}return ct.getMesh(n)}function Ome(e,t,r,n){var a=Rme(t,r,n&&n.geometry),i=Cp(t),o=function(s){return YS(t.quads[s])};return xr.create(i,t,a,function(){return r.color},function(){return 1},o)}function Bme(e,t,r){for(var n=Ll.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){xp(e.quads[a],Yr,t.arcScale),w.add(ni,Yr.arcDirA,Yr.arcDirD),w.setMagnitude(ni,ni,Yr.radius),w.add(ni,Yr.arcCenter,ni);var o=Fs(Yr.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||"".concat(o,"\xB0"),u=Math.max(2,Yr.sphereA.radius,Yr.sphereB.radius,Yr.sphereC.radius,Yr.sphereD.radius),l=u/2;n.add(s,ni[0],ni[1],ni[2],.1,l,a)}return n.getText()}function kme(e,t,r,n){var a=Bme(t,r,n&&n.geometry),i=Cp(t),o=function(s){return YS(t.quads[s])};return xr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function Lme(e,t){return Yt.createMulti("Dihedral",e,t,Yt.StateBuilder,JU)}var Fme=_t.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:fe.Root,to:fe.Shape.Provider,params:{bottomLeft:E.Vec3(w()),topRight:E.Vec3(w.create(1,1,1)),radius:E.Numeric(.15,{min:.01,max:4,step:.01}),color:E.Color(tr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return Fe.create("Shape Representation",function(n){return se(t,void 0,void 0,function(){return ie(this,function(a){return[2,new fe.Shape.Provider({label:"Box",data:r,params:Rt.Params,getShape:function(i,o){var s=dE(Ut.create(r.bottomLeft,r.topRight),r.radius);return xr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Rt.Utils},{label:"Box"})]})})})}});function dE(e,t,r){var n=w.sub(w(),e.max,e.min),a=oe.fromTranslation(oe(),w.create(.5,.5,.5)),i=oe.fromScaling(oe(),n),o=oe.fromTranslation(oe(),e.min),s=oe.mul3(oe(),o,i,a),u=ct.createState(256,128,r);u.currentGroup=1,ct.addCage(u,s,h9(),t,2,20);var l=ct.getMesh(u),c=w.scaleAndAdd(w(),e.min,n,.5),d=w.distance(e.min,c);return l.setBoundingSphere(Me.create(c,d)),l}var Nme=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",BoxShape3D:Fme,getBoxMesh:dE}),tz={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};tz.vertices,new Uint32Array([0,1,2,3,3,1,2,0]);function Ume(){return tz}var zme=_(_({},Rt.Params),{color:E.Color(tr.orange),scaleFactor:E.Numeric(1,{min:.1,max:10,step:.1})}),rz={plane:function(e,t){return Kn(Gme,Rt.Utils)}},nO=_(_({},zme),{visuals:E.MultiSelect(["plane"],E.objectToOptions(rz))});function Vme(e){var t=kg(e,{countsOnly:!0});return"Best Fit Plane of ".concat(t)}var vc=oe(),p3=w();function Hme(e,t,r){var n=ct.createState(256,128,r),a=xe.getPrincipalAxesMany(e.locis),i=a.boxAxes,o=Ume();return w.add(p3,i.origin,i.dirC),oe.targetTo(vc,p3,i.origin,i.dirB),oe.scale(vc,vc,si.size(p3,i)),oe.scaleUniformly(vc,vc,t.scaleFactor),oe.setTranslation(vc,i.origin),n.currentGroup=0,ct.addPrimitive(n,vc,o),ct.addPrimitiveFlipped(n,vc,o),ct.getMesh(n)}function Gme(e,t,r,n){var a=Hme(t,r,n&&n.geometry),i=Vme(t.locis);return xr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function qme(e,t){var r=Yt.createMulti("Plane",e,t,Yt.StateBuilder,rz);return r.setState({markerActions:mi.Highlighting}),r}var r2=_t.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:fe.Molecule.Structure,to:fe.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory({},d);return{description:p.description,legend:p.legend}}};return{type:E.Mapped(n.default.name,n.types,function(l){return E.Group(n.get(l).getParams(a,Ne.Empty))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(l){return E.Group(a.colorThemeRegistry.get(l).getParams({structure:Ne.Empty}))},o),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(l){return E.Group(a.sizeThemeRegistry.get(l).getParams({structure:Ne.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=a.colorThemeRegistry.get(c),p=f.factory(s,d);return{description:p.description,legend:p.legend}}};return{type:E.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return E.Group(n.get(l).getParams(a,e.data))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(l){return E.Group(a.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(s),function(l){return E.Group(a.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,a=e.params;return e.cache,Fe.create("Structure Representation",function(i){return se(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.structure.registry.get(a.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,a.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:p.sent(),p.label=2;case 2:return l=s.factory(_({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,qn.ensureDependencies(o,t.representation.structure.themes,{structure:u},a)];case 3:return p.sent(),l.setTheme(qn.create(t.representation.structure.themes,{structure:u},a)),c=a.type.params||{},[4,l.createOrUpdate(c,u).runInContext(i)];case 4:return p.sent(),[2,new fe.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return e.cache,Fe.create("Structure Representation",function(s){return se(r,void 0,void 0,function(){var u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return o.type.name!==i.type.name?[2,We.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),((f=u.mustRecreate)===null||f===void 0?void 0:f.call(u,i.type.params,o.type.params))?[2,We.UpdateResult.Recreate]:(l=((p=u.getData)===null||p===void 0?void 0:p.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:v.sent(),v.label=2;case 2:return qn.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,qn.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return v.sent(),a.data.repr.setTheme(qn.create(t.representation.structure.themes,{structure:l},o)),d=_(_({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return v.sent(),a.data.sourceData=n.data,[2,We.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),qn.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,a=t.colorTheme.params.value,i=$e.interpolate(n,a,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),jme=_t.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:E.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new lm(n);return x6(n,a,r.t),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new lm(n)},info:n,repr:t.data.repr},{label:"Unwind T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;if(a.t===n.t)return We.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return x6(i,o,n.t),r.label="Unwind T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,We.UpdateResult.Updated}}),Wme=_t.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:E.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new lm(n);return w6(n,a,r.t,n.root.boundary.sphere),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new lm(n)},info:n,repr:t.data.repr},{label:"Explode T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;if(a.t===n.t)return We.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return w6(i,o,n.t,i.root.boundary.sphere),r.label="Explode T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,We.UpdateResult.Updated}}),Xme=_t.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:_({t:E.Numeric(0,{min:0,max:1,step:.01})},Lpe)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new lm(n),i=_6(n.root,r),o=i.axis,s=i.origin;return P6(n,a,r.t,o,s),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new lm(n)},info:n,repr:t.data.repr},{label:"Spin T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return We.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=_6(i.root,n),u=s.axis,l=s.origin;return P6(i,o,n.t,u,l),r.label="Spin T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,We.UpdateResult.Updated}}),Yme=_t.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(Qn("(sel.atom.all)","mol-script")),color:E.Color(tr.blueviolet),clear:E.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":$e.toRgbString(e.color))},{defaultValue:[{script:Qn("(sel.atom.all)","mol-script"),color:tr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Oa.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Oa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.overpaint,u=Oa.ofScript(n.layers,i);return Oa.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.overpaint=u,r.data.repr=t.data.repr,r.label="Overpaint (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),Kme=_t.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Mr.Empty),color:E.Color(tr.blueviolet),clear:E.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":$e.toRgbString(e.color))},{defaultValue:[{bundle:Mr.Empty,color:tr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Oa.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Oa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.overpaint,u=Oa.ofBundle(n.layers,i);return Oa.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.overpaint=u,r.data.repr=t.data.repr,r.label="Overpaint (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),Qme=_t.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(Qn("(sel.atom.all)","mol-script")),value:E.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{script:Qn("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Ba.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Ba.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.transparency,u=Ba.ofScript(n.layers,i);return Ba.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.transparency=u,r.data.repr=t.data.repr,r.label="Transparency (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),Zme=_t.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Mr.Empty),value:E.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{bundle:Mr.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Ba.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Ba.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.transparency,u=Ba.ofBundle(n.layers,i);return Ba.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.transparency=u,r.data.repr=t.data.repr,r.label="Transparency (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),$me=_t.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(Qn("(sel.atom.all)","mol-script")),material:di.getParam(),clear:E.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":di.toString(e.material))},{defaultValue:[{script:Qn("(sel.atom.all)","mol-script"),material:di({roughness:1}),clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=ka.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:ka.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.substance,u=ka.ofScript(n.layers,i);return ka.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.substance=u,r.data.repr=t.data.repr,r.label="Substance (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),Jme=_t.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Mr.Empty),material:di.getParam(),clear:E.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":di.toString(e.material))},{defaultValue:[{bundle:Mr.Empty,material:di({roughness:1}),clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=ka.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:ka.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&Sl(t.data.repr.props))return We.UpdateResult.Unchanged;var s=r.data.state.substance,u=ka.ofBundle(n.layers,i);return ka.areEqual(s,u)?We.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.substance=u,r.data.repr=t.data.repr,r.label="Substance (".concat(u.layers.length," Layers)"),We.UpdateResult.Updated)}}),ehe=_t.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({script:E.Script(Qn("(sel.atom.all)","mol-script")),groups:E.Converted(function(e){return an.Groups.toNames(e)},function(e){return an.Groups.fromNames(e)},E.MultiSelect(US(an.Groups.Names),E.objectToOptions(an.Groups.Names)))},function(e){return"".concat(an.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{script:Qn("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=an.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:an.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var i=r.data.state.clipping,o=an.ofScript(n.layers,a);return an.areEqual(i,o)?We.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping (".concat(o.layers.length," Layers)"),We.UpdateResult.Updated)}}),the=_t.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:E.ObjectList({bundle:E.Value(Mr.Empty),groups:E.Converted(function(e){return an.Groups.toNames(e)},function(e){return an.Groups.fromNames(e)},E.MultiSelect(US(an.Groups.Names),E.objectToOptions(an.Groups.Names)))},function(e){return"".concat(an.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{bundle:Mr.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=an.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:an.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return We.UpdateResult.Recreate;var i=r.data.state.clipping,o=an.ofBundle(n.layers,a);return an.areEqual(i,o)?We.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping (".concat(o.layers.length," Layers)"),We.UpdateResult.Updated)}}),xl;(function(e){function t(a,i,o,s){var u=a.representation.volume.registry.get(i),l={volume:o},c=a.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=a.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=E.getDefaultValues(u.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?_(_({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:E.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:E.getDefaultValues(d)}}}e.getDefaultParams=t;function r(a,i,o,s,u,l,c){var d=a.representation.volume.registry.get(i),f=a.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=a.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:i,params:o?_(_({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?_(_({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?_(_({},p.defaultValues),c):p.defaultValues}}}e.getDefaultParamsStatic=r;function n(a){var i,o,s,u;if(a.isoValue)return ht.IsoValue.toString(a.isoValue);if((o=(i=a.renderMode)===null||i===void 0?void 0:i.params)===null||o===void 0?void 0:o.isoValue)return ht.IsoValue.toString((u=(s=a.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(xl||(xl={}));var rhe=_t.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:fe.Volume.Data,to:fe.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:E.Mapped(n.default.name,n.types,function(s){return E.Group(n.get(s).getParams(a,ht.One))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return E.Group(a.colorThemeRegistry.get(s).getParams({volume:ht.One}))}),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return E.Group(a.sizeThemeRegistry.get(s).getParams({volume:ht.One}))})};var o={volume:e.data};return{type:E.Mapped(n.default.name,n.types,function(s){return E.Group(n.get(s).getParams(a,e.data))}),colorTheme:E.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return E.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:E.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(o),function(s){return E.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Volume Representation",function(i){return se(r,void 0,void 0,function(){var o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.volume.registry.get(a.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(_({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(qn.create(t.representation.volume.themes,{volume:n.data},a)),l=a.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(i)];case 3:return d.sent(),[2,new fe.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:xl.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Fe.create("Volume Representation",function(s){return se(r,void 0,void 0,function(){var u,l,c;return ie(this,function(d){switch(d.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,We.UpdateResult.Recreate]):(l=_(_({},a.data.repr.props),o.type.params),a.data.repr.setTheme(qn.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),a.data.sourceData=n.data,a.description=xl.getDescription(l),[2,We.UpdateResult.Updated]}})})})}}),nhe=_t.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:fe.Shape.Provider,to:fe.Shape.Representation3D,params:function(e,t){return e?e.data.params:at.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Shape Representation",function(i){return se(r,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return o=_(_({},E.getDefaultValues(n.data.params)),a),s=Kn(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Shape Representation",function(o){return se(r,void 0,void 0,function(){var s;return ie(this,function(u){switch(u.label){case 0:return s=_(_({},a.data.repr.props),i),[4,a.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),a.data.sourceData=n.data,[2,We.UpdateResult.Updated]}})})})}}),ahe=_t.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:fe.Molecule.Model,to:fe.Shape.Representation3D,params:function(){return _({},V6)}})({isApplicable:function(e){return!!kn.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Model Unit Cell",function(i){return se(r,void 0,void 0,function(){var o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return o=kn.Provider.get(n.data),o?(s=H6(n.data,o,a),u=fve(_({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return V6}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,pn.Null];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return Fe.create("Model Unit Cell",function(i){return se(t,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=kn.Provider.get(r.data),o?(s=_(_({},n.data.repr.props),a),u=H6(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,We.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),ihe=_t.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:fe.Molecule.Structure,to:fe.Shape.Representation3D,params:_({radius:E.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:E.Color(tr.red,{isEssential:!0})},Rt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Bounding Box",function(i){return se(r,void 0,void 0,function(){var o;return ie(this,function(s){switch(s.label){case 0:return o=Kn(function(u,l,c,d){var f=dE(l.box,l.radius,d==null?void 0:d.geometry);return xr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Rt.Utils),[4,o.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new fe.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Bounding Box",function(o){return se(r,void 0,void 0,function(){return ie(this,function(s){switch(s.label){case 0:return[4,a.data.repr.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(o)];case 1:return s.sent(),a.data.sourceData=n.data,[2,We.UpdateResult.Updated]}})})})}}),ohe=_t.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},q6)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Distance",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=j6(n.data),s=Ave(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return q6}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Distance",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=j6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),she=_t.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},tO)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Angle",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=W6(n.data),s=mme(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return tO}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Angle",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=W6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),uhe=_t.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},rO)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Dihedral",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=X6(n.data),s=Lme(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return rO}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Dihedral",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=X6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),lhe=_t.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},Z6)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Label",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=Y6(n.data),s=Mve(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Z6}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Label",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=Y6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),che=_t.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},eO)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Orientation",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=K6(n.data),s=tme(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return eO}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Orientation",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=K6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),dhe=_t.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return _({},nO)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Structure Plane",function(i){return se(r,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:return o=Q6(n.data),s=qme(_({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return nO}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Plane"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Fe.create("Structure Plane",function(o){return se(r,void 0,void 0,function(){var s,u;return ie(this,function(l){switch(l.label){case 0:return s=_(_({},a.data.repr.props),i),u=Q6(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),a.data.sourceData=u,[2,We.UpdateResult.Updated]}})})})}}),fhe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",StructureRepresentation3D:r2,ExplodeStructureRepresentation3D:Wme,SpinStructureRepresentation3D:Xme,UnwindStructureAssemblyRepresentation3D:jme,OverpaintStructureRepresentation3DFromScript:Yme,OverpaintStructureRepresentation3DFromBundle:Kme,TransparencyStructureRepresentation3DFromScript:Qme,TransparencyStructureRepresentation3DFromBundle:Zme,SubstanceStructureRepresentation3DFromScript:$me,SubstanceStructureRepresentation3DFromBundle:Jme,ClippingStructureRepresentation3DFromScript:ehe,ClippingStructureRepresentation3DFromBundle:the,VolumeRepresentation3D:rhe,get VolumeRepresentation3DHelpers(){return xl},ShapeRepresentation3D:nhe,ModelUnitcell3D:ahe,StructureBoundingBox3D:ihe,StructureSelectionsDistance3D:ohe,StructureSelectionsAngle3D:she,StructureSelectionsDihedral3D:uhe,StructureSelectionsLabel3D:lhe,StructureSelectionsOrientation3D:che,StructureSelectionsPlane3D:dhe});function mc(e,t,r){return{i:e,j:t,k:r}}function Oo(e,t){return{a:e,b:t}}var Mn=[mc(0,0,0),mc(1,0,0),mc(1,1,0),mc(0,1,0),mc(0,0,1),mc(1,0,1),mc(1,1,1),mc(0,1,1)],phe=[Oo(Mn[0],Mn[1]),Oo(Mn[1],Mn[2]),Oo(Mn[2],Mn[3]),Oo(Mn[3],Mn[0]),Oo(Mn[4],Mn[5]),Oo(Mn[5],Mn[6]),Oo(Mn[6],Mn[7]),Oo(Mn[7],Mn[4]),Oo(Mn[0],Mn[4]),Oo(Mn[1],Mn[5]),Oo(Mn[2],Mn[6]),Oo(Mn[3],Mn[7])],vhe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],mhe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Nv=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],v3=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function hhe(e,t){var r=Math.min(65536,e*4),n=Le.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=Le.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=Le.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=Le.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,Le.add3(n,l,c,d)},addNormal:function(l,c,d){Le.add3(a,l,c,d)},addGroup:function(l){Le.add(i,l)},addTriangle:function(l,c,d,f){var p=l[c],v=l[d],m=l[f];p>=0&&v>=0&&m>=0&&(++u,Le.add3(o,p,v,m))},get:function(){var l=Le.compact(n,!0),c=Le.compact(a,!0),d=Le.compact(o,!0),f=Le.compact(i,!0);return Rt.create(l,d,c,f,s,u,t)}}}function ghe(e,t){var r=Le.create(Float32Array,3,e),n=Le.create(Float32Array,1,e),a=Le.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return Le.add3(r,o,s,u)},addNormal:function(){return Oc},addGroup:function(o){Le.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],p=o[l];d>=0&&f>=0&&p>=0&&(v3[s][u]&c&&(++i,Le.add2(a,o[s],o[u])),v3[u][l]&c&&(++i,Le.add2(a,o[u],o[l])),v3[s][l]&c&&(++i,Le.add2(a,o[s],o[l])))},get:function(){for(var o=Le.compact(r,!0),s=Le.compact(a,!0),u=Le.compact(n,!0),l=to.create(i,i/10,t),c=0;c<i;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function nz(e){return _(_({},e),{bottomLeft:oa(e.bottomLeft,[0,0,0]),topRight:oa(e.topRight,e.scalarField.space.dimensions)})}function az(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function JS(e,t){var r=this;return Fe.create("Marching Cubes Mesh",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return a=nz(e),i=az(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=hhe(l,t),[4,new iz(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}function fE(e,t){var r=this;return Fe.create("Marching Cubes Lines",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return a=nz(e),i=az(a),o=i.dX,s=i.dY,u=i.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=ghe(l,t),[4,new iz(n,c,a).run()];case 1:return d.sent(),[2,c.get()]}})})})}var iz=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new yhe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return se(this,void 0,void 0,function(){var t,r;return ie(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return se(this,void 0,void 0,function(){return ie(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),yhe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=vhe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=phe[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=l.i+this.i,v=l.j+this.j,m=l.k+this.k,h=o(i,c,d,f),g=o(i,p,v,m),y=(this.isoLevel-h)/(h-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,p,v,m),C=y<.5?b:S;if(C===-1&&(C=y<.5?S:b),C===-2)return-1;this.builder.addGroup(C)}else this.builder.addGroup(0);var x=this.builder.addVertex(c+y*(c-p),d+y*(d-v),f+y*(f-m));this.verticesOnEdges[n]=x+1;var A=o(i,Math.max(0,c-1),d,f)-o(i,Math.min(this.nX-1,c+1),d,f),P=o(i,c,Math.max(0,d-1),f)-o(i,c,Math.min(this.nY-1,d+1),f),T=o(i,c,d,Math.max(0,f-1))-o(i,c,d,Math.min(this.nZ,f+1)),D=o(i,Math.max(0,p-1),v,m)-o(i,Math.min(this.nX-1,p+1),v,m),I=o(i,p,Math.max(0,v-1),m)-o(i,p,Math.min(this.nY-1,v+1),m),M=o(i,p,v,Math.max(0,m-1))-o(i,p,v,Math.min(this.nZ-1,m+1)),B=A+y*(A-D),U=P+y*(P-I),V=T+y*(T-M);return this.isoLevel>=0?this.builder.addNormal(B,U,V):this.builder.addNormal(-B,-U,-V),x},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),!(i===0||i===255)){this.i=t,this.j=r,this.k=n;var o=mhe[i];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Nv[i],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,a):this.builder.addTriangle(this.vertList,d,c,l,a)}}},e}();function bhe(e,t,r,n,a,i){var o=Fa.getUtils(t),s=o.createValues,u=o.createRenderableState,l=zP(),c=s(t,l,r,n,a),d=u(a);return Lm(t.kind,c,d,i)}function Lg(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,p=c.updateRenderableState,v=c.createPositionIterator,m=Ou.create(),h,g,y,b,S=Object.assign({},r),C=qn.createEmpty(),x,A,P=-1,T,D;function I(U,V,F){if(!F&&!x)throw new Error("missing volume");if(g=Object.assign({},S,V),y=U,b=F,Ou.reset(m),h?(!x||!ht.areEquivalent(b,x))&&(m.createNew=!0):m.createNew=!0,m.createNew){m.createGeometry=!0;return}s(m,F,g,S,y,C),Ru.areEqual(U.color,C.color)||(m.updateColor=!0),m.createGeometry&&(m.updateColor=!0)}function M(U){if(m.createNew)if(T=a(b),U)h=bhe(b,U,T,y,g,t),D=v(U,h.values);else throw new Error("expected geometry to be given");else{if(!h)throw new Error("expected renderObject to be available");if(T.reset(),m.createGeometry)if(U)R.updateIfChanged(h.values.drawCount,Fa.getDrawCount(U)),R.updateIfChanged(h.values.uVertexCount,Fa.getVertexCount(U));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(f(h.values,U||A),D=v(U||A,h.values)),m.updateSize&&"uSize"in h.values&&Jl(T,y.size,h.values),m.updateColor&&Po(T,D,y.color,h.values),d(h.values,g),p(h.state,g)}S=g,C=y,x=b,U&&(A=U,P+=1)}function B(U,V){return go(U)?V(Ce.ofBounds(0,T.groupCount*T.instanceCount)):o(U,x,S,V)}return{get groupCount(){return T?T.count:0},get renderObject(){return h},get geometryVersion(){return P},createOrUpdate:function(U,V,F,Y){return F===void 0&&(F={}),se(this,void 0,void 0,function(){var W;return ie(this,function(K){return I(V,F,Y||x),m.createGeometry?(W=n(U,b,y,g,A),[2,tE(W)?W.then(M):M(W)]):(M(),[2])})})},getLoci:function(U){return h?i(U,x,S,h.id):yr},mark:function(U,V){return ar.mark(h,U,V,B)},setVisibility:function(U){ar.setVisibility(h,U)},setAlphaFactor:function(U){ar.setAlphaFactor(h,U)},setPickable:function(U){ar.setPickable(h,U)},setColorOnly:function(U){ar.setColorOnly(h,U)},setTransform:function(U,V){ar.setTransform(h,U,V)},setOverpaint:function(U){return ar.setOverpaint(h,U,B,!0)},setTransparency:function(U){return ar.setTransparency(h,U,B,!0)},setSubstance:function(U){return ar.setSubstance(h,U,B,!0)},setClipping:function(U){return ar.setClipping(h,U,B,!0)},destroy:function(){l==null||l(A),h&&(h.state.disposed=!0,h=void 0)},mustRecreate:u}}_({},at.Params);function n2(e,t,r,n,a){var i=0,o=t.webgl,s=new xn,u=new Yt.GeometryState,l=oc(),c=[],d=Yt.createState(),f,p,v,m,h=qn.createEmpty();function g(x,A){var P=this;x===void 0&&(x={}),A&&A!==p&&(v=r(t,A),p=A,m||(m=E.getDefaultValues(v)));var T=T4(Object.assign({},m,x),p);return Object.assign(m,x,T),Fe.create("Creating or updating VolumeRepresentation",function(D){return se(P,void 0,void 0,function(){var I,M;return ie(this,function(B){switch(B.label){case 0:return f?((M=f.mustRecreate)===null||M===void 0?void 0:M.call(f,p,m,o))&&(f.destroy(),f=n(l,p,m,o)):f=n(l,p,m,o),I=f.createOrUpdate({webgl:o,runtime:D},h,m,A),I?[4,I]:[3,2];case 1:B.sent(),B.label=2;case 2:return c.length=0,f&&f.renderObject&&(c.push(f.renderObject),u.add(f.renderObject.id,f.geometryVersion)),u.snapshot(),s.next(i++),[2]}})})})}function y(x,A){return f?f.mark(x,A):!1}function b(x){x.visible!==void 0&&f&&f.setVisibility(x.visible),x.alphaFactor!==void 0&&f&&f.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&f&&f.setPickable(x.pickable),x.overpaint!==void 0&&f&&f.setOverpaint(x.overpaint),x.transparency!==void 0&&f&&f.setTransparency(x.transparency),x.transform!==void 0&&f&&f.setTransform(x.transform),Yt.updateState(d,x)}function S(x){h=x}function C(){f&&f.destroy()}return{label:e,get groupCount(){return f?f.groupCount:0},get props(){return m},get params(){return v},get state(){return d},get theme(){return h},get geometryVersion(){return u.version},renderObjects:c,updated:s,createOrUpdate:g,setState:b,setTheme:S,getLoci:function(x){return x===void 0?a(p,m):f?f.getLoci(x):yr},mark:y,destroy:C}}var She=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,xhe=_(_({},Ca),{tTexture:Wt("texture","rgba","float","nearest")}),zo="histopyramid-sum";function Che(e,t){if(e.namedComputeRenderables[zo]){var r=e.namedComputeRenderables[zo].values;R.update(r.tTexture,t),e.namedComputeRenderables[zo].update()}else e.namedComputeRenderables[zo]=whe(e,t);return e.namedComputeRenderables[zo]}function whe(e,t){var r=_(_({},wa),{tTexture:R.create(t)}),n=_({},xhe),a=ln("sum",yi,She,{},{0:"ivec4"}),i=ea(e,"triangles",a,n,r);return ta(i,r)}function _he(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var Fy=new Uint8Array(4),aO=new Int32Array(4);function Ahe(e,t){var r=e.gl,n=e.resources,a=Che(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[zo]||(e.namedFramebuffers[zo]=n.framebuffer());var i=e.namedFramebuffers[zo];e.namedTextures[zo]||(e.namedTextures[zo]=fr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[zo].define(1,1));var o=e.namedTextures[zo];return o.attachFramebuffer(i,0),_he(e),r.viewport(0,0,1,1),a.render(),r.finish(),e.readPixels(0,0,1,1,fr(r)?aO:Fy),e.unbindFramebuffer(),fr(r)?aO[0]:qP(Fy[0],Fy[1],Fy[2])}var The=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,Phe=_(_({},Ca),{tInputLevel:Wt("texture","rgba","float","nearest"),tPreviousLevel:Wt("texture","rgba","float","nearest"),uSize:Re("f"),uTexSize:Re("f"),uFirst:Re("b")}),Uc="histogram-pyramid";function Ehe(e,t,r){if(e.namedComputeRenderables[Uc]){var n=e.namedComputeRenderables[Uc].values;R.update(n.tInputLevel,t),R.update(n.tPreviousLevel,r),e.namedComputeRenderables[Uc].update()}else e.namedComputeRenderables[Uc]=Ihe(e,t,r);return e.namedComputeRenderables[Uc]}function Ihe(e,t,r){var n=_(_({},wa),{tInputLevel:R.create(t),tPreviousLevel:R.create(r),uSize:R.create(0),uTexSize:R.create(0),uFirst:R.create(!0)}),a=_({},Phe),i=ln("reduction",yi,The,{},{0:"ivec4"}),o=ea(e,"triangles",i,a,n);return ta(o,n)}function Dhe(e,t){var r=Math.pow(2,t),n="level".concat(t),a=e.isWebGL2?a2(n,e,"image-int32","alpha","int","nearest"):a2(n,e,"image-uint8","rgba","ubyte","nearest");a.define(r,r);var i=Rhe(n,e);return i||(i=oz(n,e),a.attachFramebuffer(i,0)),{texture:a,framebuffer:i}}function Mhe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function oz(e,t){var r="".concat(Uc,"-").concat(e);return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function a2(e,t,r,n,a,i){var o="".concat(Uc,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function Rhe(e,t){var r="".concat(Uc,"-").concat(e);return t.namedFramebuffers[r]}function Ohe(e,t,r,n){var a=e.gl,i=t.getWidth(),o=t.getHeight();if(i!==o||!jX(i))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(i)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?a2("pyramid",e,"image-int32","alpha","int","nearest"):a2("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=oz("pyramid",e);d.attachFramebuffer(f,0),a.viewport(0,0,l,c),fr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var p=[],v=0;v<s;++v)p.push(Dhe(e,v));var m=Ehe(e,t,p[0].texture);e.state.currentRenderItemId=-1,Mhe(e);for(var h=0,v=0;v<s;v++){var g=s-1-v,y=p[g];y.framebuffer.bind();var b=Math.pow(2,g);R.update(m.values.uSize,Math.pow(2,v+1)/u),R.update(m.values.uTexSize,b),R.updateIfChanged(m.values.uFirst,v===0),v>0&&(R.update(m.values.tPreviousLevel,p[s-v].texture),m.update()),e.state.currentRenderItemId=-1,a.viewport(0,0,b,b),a.scissor(0,0,b,b),fr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),m.render(),d.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,h,0,0,0,b,b),d.unbind(0),h+=b}a.finish();var S=Math.max(1,Ahe(e,p[0].texture)),C=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:C,levels:s,scale:r}}var mh;function Bhe(){if(mh!==void 0)return mh;mh=fa(16*16,1,Uint8Array);for(var e=mh.array,t=0,r=Nv.length;t<r;++t)e[t]=Nv[t].length/3;return mh}var hh;function khe(){if(hh!==void 0)return hh;hh=fa(64*64,1,Uint8Array);for(var e=hh.array,t=0,r=Nv.length;t<r;++t)for(var n=0;n<16;++n)n<Nv[t].length?e[t*16+n]=Nv[t][n]:e[t*16+n]=255;return hh}var Lhe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,Fhe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,Nhe=_(_({},Ca),{tTriCount:Wt("image-uint8","alpha","ubyte","nearest"),tVolumeData:Wt("texture","rgba","ubyte","nearest"),uIsoValue:Re("f"),uGridDim:Re("v3"),uGridTexDim:Re("v3"),uScale:Re("v2")}),Es="active-voxels";function Uhe(e,t,r,n,a,i){if(e.namedComputeRenderables[Es]){var o=e.namedComputeRenderables[Es].values;R.update(o.uQuadScale,i),R.update(o.tVolumeData,t),R.updateIfChanged(o.uIsoValue,a),R.update(o.uGridDim,r),R.update(o.uGridTexDim,n),R.update(o.uScale,i),e.namedComputeRenderables[Es].update()}else e.namedComputeRenderables[Es]=zhe(e,t,r,n,a,i);return e.namedComputeRenderables[Es]}function zhe(e,t,r,n,a,i){var o=_(_({},wa),{tTriCount:R.create(Bhe()),uQuadScale:R.create(i),tVolumeData:R.create(t),uIsoValue:R.create(a),uGridDim:R.create(r),uGridTexDim:R.create(n),uScale:R.create(i)}),s=_({},Nhe),u=ln("active-voxels",yi,Fhe),l=ea(e,"triangles",u,s,o);return ta(l,o)}function Vhe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Hhe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[Es]||(e.namedFramebuffers[Es]=s.framebuffer());var c=e.namedFramebuffers[Es];c.bind(),e.namedTextures[Es]||(e.namedTextures[Es]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[Es];d.define(u,l);var f=Uhe(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),Vhe(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var Ghe=_(_({},Ca),{tTriIndices:Wt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:Wt("texture","rgba","float","nearest"),tActiveVoxelsBase:Wt("texture","rgba","float","nearest"),tVolumeData:Wt("texture","rgba","ubyte","nearest"),uIsoValue:Re("f"),uSize:Re("f"),uLevels:Re("f"),uCount:Re("f"),uInvert:Re("b"),uGridDim:Re("v3"),uGridTexDim:Re("v3"),uGridTransform:Re("m4"),uScale:Re("v2"),dPackedGroup:qt("boolean"),dAxisOrder:qt("string",["012","021","102","120","201","210"])}),zc="isosurface";function qhe(e,t,r,n,a,i,o,s,u,l,c,d,f,p){if(e.namedComputeRenderables[zc]){var v=e.namedComputeRenderables[zc].values;R.update(v.tActiveVoxelsPyramid,t),R.update(v.tActiveVoxelsBase,r),R.update(v.tVolumeData,n),R.updateIfChanged(v.uIsoValue,s),R.updateIfChanged(v.uSize,Math.pow(2,u)),R.updateIfChanged(v.uLevels,u),R.updateIfChanged(v.uCount,c),R.updateIfChanged(v.uInvert,d),R.update(v.uGridDim,a),R.update(v.uGridTexDim,i),R.update(v.uGridTransform,o),R.update(v.uScale,l),R.update(v.dPackedGroup,f),R.updateIfChanged(v.dAxisOrder,p.join("")),e.namedComputeRenderables[zc].update()}else e.namedComputeRenderables[zc]=jhe(e,t,r,n,a,i,o,s,u,l,c,d,f,p);return e.namedComputeRenderables[zc]}function jhe(e,t,r,n,a,i,o,s,u,l,c,d,f,p){var v=_(_({},wa),{tTriIndices:R.create(khe()),tActiveVoxelsPyramid:R.create(t),tActiveVoxelsBase:R.create(r),tVolumeData:R.create(n),uIsoValue:R.create(s),uSize:R.create(Math.pow(2,u)),uLevels:R.create(u),uCount:R.create(c),uInvert:R.create(d),uGridDim:R.create(a),uGridTexDim:R.create(i),uGridTransform:R.create(o),uScale:R.create(l),dPackedGroup:R.create(f),dAxisOrder:R.create(p.join(""))}),m=_({},Ghe),h=ln("isosurface",yi,Lhe,{drawBuffers:"required"}),g=ea(e,"triangles",h,m,v);return ta(g,v)}function Whe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Xhe(e,t,r,n,a,i,o,s,u,l,c,d,f,p){var v=e.extensions.drawBuffers;if(!v)throw new Error("need WebGL draw buffers");var m=e.gl,h=e.resources,g=e.extensions,y=n.pyramidTex,b=n.height,S=n.levels,C=n.scale,x=n.count,A=y.getWidth();e.namedFramebuffers[zc]||(e.namedFramebuffers[zc]=h.framebuffer());var P=e.namedFramebuffers[zc];fr(m)?(d||(d=g.colorBufferHalfFloat&&g.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest")),f||(f=h.texture("image-uint8","rgba","ubyte","nearest")),p||(p=g.colorBufferHalfFloat&&g.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest"))):(d||(d=h.texture("image-float32","rgba","float","nearest")),f||(f=h.texture("image-float32","rgba","float","nearest")),p||(p=h.texture("image-float32","rgba","float","nearest"))),d.define(A,b),f.define(A,b),p.define(A,b),d.attachFramebuffer(P,0),f.attachFramebuffer(P,1),p.attachFramebuffer(P,2);var T=qhe(e,y,t,r,a,i,o,s,S,C,x,u,l,c);return e.state.currentRenderItemId=-1,P.bind(),v.drawBuffers([v.COLOR_ATTACHMENT0,v.COLOR_ATTACHMENT1,v.COLOR_ATTACHMENT2]),Whe(e),m.viewport(0,0,A,b),m.clear(m.COLOR_BUFFER_BIT),T.render(),m.finish(),{vertexTexture:d,groupTexture:f,normalTexture:p,vertexCount:x}}function pE(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=Hhe(e,t,r,n,o,a),v=Ohe(e,p,a,n),m=Xhe(e,p,t,v,r,n,i,o,s,u,l,c,d,f);return m}var sz={isoValue:ht.IsoValueParam};function Yhe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var Xh=1;function vE(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;var r=e.grid.cells.space.dimensions,n=Bg(r,Xh).powerOfTwoSize;return n<=t.maxTextureSize/2}function Khe(e,t,r,n){return r.tryUseGpu&&n&&Yhe(n)&&vE(t,n)?Jhe(e):Zhe(e)}function iO(e,t){return ht.Isosurface.Loci(e,t.isoValue)}function mE(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?ht.Cell.Loci(t,Ce.ofSingleton(i)):yr}function hE(e,t,r,n){return aE(e,t,r.isoValue,n)}function Qhe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=is(new Int32Array(t.grid.cells.data.length)),[4,JS({isoLevel:ht.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:gr.create(t.grid.cells.space,gr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Ua.getGridToCartesianTransform(t.grid),Rt.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Rt.uniformTriangleGroup(o,!1),o.setBoundingSphere(ht.getBoundingSphere(t)),[2,o]}})})}var gE=_(_(_(_({},Rt.Params),ds.Params),sz),{quality:_(_({},Rt.Params.quality),{isEssential:!1}),tryUseGpu:E.Boolean(!0)});function Zhe(e){return Lg({defaultProps:E.getDefaultValues(gE),createGeometry:Qhe,createLocationIterator:function(t){return sn(t.grid.cells.data.length,1,1,function(){return wo})},getLoci:mE,eachLocation:hE,setUpdateState:function(t,r,n,a){ht.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Rt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&vE(t,n)}},e)}var P4;(function(e){var t="volume-isosurface-texture";e.descriptor=xo({name:t});function r(n,a){var i=a.resources,o=Ua.getGridToCartesianTransform(n.grid),s=w.clone(n.grid.cells.space.dimensions),u=Bg(s,Xh),l=u.width,c=u.height,d=u.powerOfTwoSize,f=w.create(l,c,0),p=ke.create(l/d,c/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var v=n._propertyData[t];v.define(d,d),v.load(OU(n,"data",Xh),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return v.destroy()}}])}return s[0]+=Xh,s[1]+=Xh,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}e.get=r})(P4||(P4={}));function $he(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S;return ie(this,function(C){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return t.grid.cells.data.length<=1?[2,ds.createEmpty(a)]:(i=t.grid.stats,o=i.max,s=i.min,u=o-s,l=ht.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=P4.get(t,e.webgl),f=d.texture,p=d.gridDimension,v=d.gridTexDim,m=d.gridTexScale,h=d.transform,g=t.grid.cells.space.axisOrderSlowToFast,y=a==null?void 0:a.doubleBuffer.get(),b=pE(e.webgl,f,p,v,m,h,c,l<0,!1,g,y==null?void 0:y.vertex,y==null?void 0:y.group,y==null?void 0:y.normal),S=ds.create(b.vertexCount,1,b.vertexTexture,b.groupTexture,b.normalTexture,ht.getBoundingSphere(t),a),[2,S])})})}function Jhe(e){return Lg({defaultProps:E.getDefaultValues(gE),createGeometry:$he,createLocationIterator:function(t){return sn(t.grid.cells.data.length,1,1,function(){return wo})},getLoci:mE,eachLocation:hE,setUpdateState:function(t,r,n,a){ht.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ds.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!vE(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function e0e(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=is(new Int32Array(t.grid.cells.data.length)),[4,fE({isoLevel:ht.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:gr.create(t.grid.cells.space,gr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Ua.getGridToCartesianTransform(t.grid),on.transform(o,s),o.setBoundingSphere(ht.getBoundingSphere(t)),[2,o]}})})}var uz=_(_(_({},on.Params),sz),{quality:_(_({},on.Params.quality),{isEssential:!1}),sizeFactor:E.Numeric(3,{min:0,max:10,step:.1})});function t0e(e){return Lg({defaultProps:E.getDefaultValues(uz),createGeometry:e0e,createLocationIterator:function(t){return sn(t.grid.cells.data.length,1,1,function(){return wo})},getLoci:mE,eachLocation:hE,setUpdateState:function(t,r,n,a){ht.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:on.Utils},e)}var lz={solid:function(e,t){return n2("Isosurface mesh",e,t,Khe,iO)},wireframe:function(e,t){return n2("Isosurface wireframe",e,t,t0e,iO)}},cz=_(_(_({},gE),uz),{visuals:E.MultiSelect(["solid"],E.objectToOptions(lz)),bumpFrequency:E.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)});function r0e(e,t){var r=E.clone(cz);return r.isoValue=ht.createIsoValueParam(ht.IsoValue.relative(2),t.grid.stats),r}function n0e(e,t){return Yt.createMulti("Isosurface",e,t,Yt.StateBuilder,lz)}var a0e={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:n0e,getParams:r0e,defaultValues:E.getDefaultValues(cz),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!ht.isEmpty(e)}};function i0e(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y,W,K,$,J,Z,N,j,L,H;return ie(this,function(G){for(i=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,p=ht.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,v=r.color.color(wo,!1),m=$e.toRgbNormalized(v),h=m[0],g=m[1],y=m[2],b=yE(t.grid,n),S=b.width,C=b.height,x=b.x,A=b.y,P=b.z,T=b.x0,D=b.y0,I=b.z0,M=b.nx,B=b.ny,U=b.nz,V=new Float32Array(i==="x"?[x,0,0,x,A,0,x,0,P,x,A,P]:i==="y"?[0,A,0,x,A,0,0,A,P,x,A,P]:[0,0,P,0,A,P,x,0,P,x,A,P]),F=new Uint8Array(S*C*4),Y=o0e(t.grid,n),W=0,K=D;K<B;++K)for($=T;$<M;++$)for(J=I;J<U;++J)Z=u.get(l,$,K,J),N=(Z-d)/(f-d),F[W]=h*N*2*255,F[W+1]=g*N*2*255,F[W+2]=y*N*2*255,F[W+3]=Z>=p?255:0,W+=4;return j={width:S,height:C,array:F,flipY:!0},L={width:S,height:C,array:Y,flipY:!0},H=Ua.getGridToCartesianTransform(t.grid),Kf(H,V,0,4),[2,kl.create(j,V,L,a)]})})}function yE(e,t){var r=t.dimension,n=r.name,a=r.params,i=e.cells.space,o,s,u,l,c,d=0,f=0,p=0,v=i.dimensions,m=v[0],h=v[1],g=v[2];return n==="x"?(u=a,l=h-1,c=g-1,o=g,s=h,d=u,m=d+1):n==="y"?(u=m-1,l=a,c=g-1,o=g,s=m,f=l,h=f+1):(u=m-1,l=h-1,c=a,o=m,s=h,p=c,g=p+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:p,nx:m,ny:h,nz:g}}function o0e(e,t){for(var r=e.cells.space,n=yE(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(a*i*4),p=0,v=s;v<c;++v)for(var m=o;m<l;++m)for(var h=u;h<d;++h)Rg(r.dataOffset(m,v,h),f,p),p+=4;return f}function s0e(e,t){for(var r=e.cells.space,n=yE(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(a*i),p=0,v=s;v<c;++v)for(var m=o;m<l;++m)for(var h=u;h<d;++h)f[p]=r.dataOffset(m,v,h),p+=1;return f}function u0e(e,t){var r=s0e(e.grid,t);return ht.Cell.Loci(e,ze.ofUnsortedArray(r))}function l0e(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?ht.Cell.Loci(t,Ce.ofSingleton(i)):yr}function c0e(e,t,r,n){return aE(e,t,void 0,n)}var bE=_(_({},kl.Params),{quality:_(_({},kl.Params.quality),{isEssential:!1}),dimension:E.MappedStatic("x",{x:E.Numeric(0,{min:0,max:0,step:1}),y:E.Numeric(0,{min:0,max:0,step:1}),z:E.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:ht.IsoValueParam});function d0e(e,t){var r=E.clone(bE),n=t.grid.cells.space.dimensions;return r.dimension=E.MappedStatic("x",{x:E.Numeric(0,{min:0,max:n[0]-1,step:1}),y:E.Numeric(0,{min:0,max:n[1]-1,step:1}),z:E.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=ht.createIsoValueParam(ht.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function f0e(e){return Lg({defaultProps:E.getDefaultValues(bE),createGeometry:i0e,createLocationIterator:function(t){return sn(t.grid.cells.data.length,1,1,function(){return wo})},getLoci:l0e,eachLocation:c0e,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!ht.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!Ru.areEqual(i.color,o.color)},geometryUtils:_(_({},kl.Utils),{createRenderableState:function(t){var r=kl.Utils.createRenderableState(t);return oO(r,t),r},updateRenderableState:oO})},e)}function oO(e,t){kl.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function p0e(e,t){return n2("Slice",e,t,f0e,u0e)}var v0e={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:p0e,getParams:d0e,defaultValues:E.getDefaultValues(bE),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!ht.isEmpty(e)}};function dz(e,t){var r=Ut();return Ut.add(r,e),Ut.transform(r,r,t),r}function m0e(e,t,r,n){var a=r.grid.cells.space.dimensions,i=Bg(a),o=i.width,s=i.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=OU(r,"normals"),l=Ua.getGridToCartesianTransform(r.grid),c=dz(a,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=fz(r.grid),p=f.unitToCartn,v=f.cellDim,m=r.grid.cells.space.axisOrderSlowToFast;return _o.create(c,a,l,p,v,d,r.grid.stats,!1,m,n)}function fz(e){if(e.transform.kind==="matrix")return{unitToCartn:oe.mul(oe(),e.transform.matrix,oe.fromScaling(oe(),e.cells.space.dimensions)),cellDim:oe.getScaling(w(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Ut.size(w(),t);return{unitToCartn:oe.mul3(oe(),e.transform.cell.fromFractional,oe.fromTranslation(oe(),t.min),oe.fromScaling(oe(),r)),cellDim:w.div(w(),e.transform.cell.size,e.cells.space.dimensions)}}function h0e(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=ope(r),o=Ua.getGridToCartesianTransform(r.grid),s=dz(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var l=fz(r.grid),c=l.unitToCartn,d=l.cellDim,f=r.grid.cells.space.axisOrderSlowToFast;return _o.create(s,a,o,c,d,u,r.grid.stats,!1,f,n)}function g0e(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o;return ie(this,function(s){if(i=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?h0e(i,o,t,a):m0e(i,o,t,a)]})})}function y0e(e,t){return ht.Loci(e)}function b0e(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?ht.Cell.Loci(t,Ce.ofSingleton(i)):yr}function S0e(e,t,r,n){return aE(e,t,void 0,n)}var SE=_(_({},_o.Params),{quality:_(_({},_o.Params.quality),{isEssential:!1})});function x0e(e,t){return E.clone(SE)}function C0e(e){return Lg({defaultProps:E.getDefaultValues(SE),createGeometry:g0e,createLocationIterator:function(t){return sn(t.grid.cells.data.length,1,1,function(){return wo})},getLoci:b0e,eachLocation:S0e,setUpdateState:function(t,r,n,a){},geometryUtils:_o.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function w0e(e,t){return n2("Direct Volume",e,t,C0e,y0e)}var _0e={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:w0e,getParams:x0e,defaultValues:E.getDefaultValues(SE),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!ht.isEmpty(e)}},i2=function(e){Pe(t,e);function t(){var r=e.call(this)||this;return ns(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return t}(LU);(function(e){e.BuiltIn={isosurface:a0e,slice:v0e,"direct-volume":_0e}})(i2||(i2={}));function sO(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:ht.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var E4=Ji.build({display:{name:"Volume Streaming"},from:fe.Molecule.Structure,params:function(e,t){var r=soe(e&&e.data),n=coe(r,e&&e.data);return{method:E.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:E.ObjectList({id:E.Text(n[0]||"")},function(a){var i=a.id;return i},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:E.Select(r==="em"?"cell":"selection-box",ui.ViewTypeOptions),options:E.Group({serverUrl:E.Text(t.config.get(Lr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:E.Text("",{isHidden:!0}),emContourProvider:E.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:E.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(Lr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&zt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return Fe.create("Volume Streaming",function(i){return se(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x;return ie(this,function(A){switch(A.label){case 0:o=[],s=0,u=a.entries.length,A.label=1;case 1:return s<u?(l=a.entries[s].id.toLowerCase(),c=void 0,a.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return A.sent(),[4,poe(t,i,l)];case 3:d=A.sent(),f=0,p=d.length,A.label=4;case 4:if(!(f<p))return[3,10];v=d[f],m=void 0,A.label=5;case 5:return A.trys.push([5,7,,8]),[4,$M(a.options.emContourProvider,t,i,v)];case 6:return m=A.sent(),[3,8];case 7:return h=A.sent(),console.info("Could not get map info for ".concat(v,": ").concat(h)),[3,9];case 8:sO(o,a.method,v,m||0),A.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return A.trys.push([11,13,,14]),[4,$M(a.options.emContourProvider,t,i,l)];case 12:return c=A.sent(),[3,14];case 13:return g=A.sent(),console.info("Could not get map info for ".concat(l,": ").concat(g)),[3,15];case 14:sO(o,a.method,l,c||0),A.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(ui.RootTag,P0e,{serverUrl:a.options.serverUrl,entries:o}),[4,y.commit()];case 17:return A.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),(S==null?void 0:S.size)>0?[4,t.managers.structure.hierarchy.remove(S==null?void 0:S.toArray())]:[3,19]):[2];case 18:A.sent(),A.label=19;case 19:return C=b.cell.obj,x=n.build().to(y.ref).apply(xE,E.getDefaultValues(ui.createParams({data:C.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),a.method==="em"?x.apply(Ny,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(x.apply(Ny,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),x.apply(Ny,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),x.apply(Ny,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(x).runInContext(i)];case 20:return A.sent(),[2]}})})})}),A0e=Ji.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:ui,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,a=e.state,i=r.data.params;if(i.entry.params.view.name==="selection-box"){var o=Ut.create(w.clone(i.entry.params.view.params.bottomLeft),w.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Ut.expand(o,o,w.create(s,s,s));var u=_(_({},i),{entry:{name:i.entry.name,params:_(_({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),T0e={dataId:E.Text(""),source:E.MappedStatic("x-ray",{em:E.Group({isoValue:ht.createIsoValueParam(ht.IsoValue.relative(1))}),"x-ray":E.Group({})})},P0e=_t.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:fe.Molecule.Structure,to:V_,params:function(e){return{serverUrl:E.Text("https://ds.litemol.org"),entries:E.ObjectList(T0e,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return Fe.create("",function(a){return se(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:i=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:ht.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:mS(n.serverUrl,"".concat(u.source.name,"/").concat(l.toLocaleLowerCase())),type:"json"}).runInContext(a)];case 3:d=p.sent(),i.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),p.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:i,structure:r.data},[2,new V_(f,{label:"Volume Server",description:"".concat(i.map(function(v){return v.dataId}).join(", "))})]}})})})}}),xE=_t.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:V_,to:ui,params:function(e){return ui.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return Fe.create("Volume streaming",function(a){return se(void 0,void 0,void 0,function(){var i;return ie(this,function(o){switch(o.label){case 0:return i=new ui.Behavior(t,r.data),[4,i.update(n)];case 1:return o.sent(),[2,new ui(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,a=e.newParams;return Fe.create("Update Volume Streaming",function(i){return se(t,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return n.entry.name!==a.entry.name&&"em"in a.entry.params.channels&&(o=r.data.infoMap.get(a.entry.name).emDefaultContourLevel,o&&(a.entry.params.channels.em.isoValue=o)),[4,r.data.update(a)];case 1:return s=u.sent()?We.UpdateResult.Updated:We.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),Ny=_t.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:ui,to:fe.Volume.Representation3D,params:{channel:E.Select("em",ui.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return Fe.create("Volume Representation",function(i){return se(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return o=r.data.channels[n.channel],o?(s=uO(r.data,n.channel),u=i2.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(_({webgl:(p=t.canvas3d)===null||p===void 0?void 0:p.webgl},t.representation.volume.themes),u.getParams),c.setTheme(qn.create(t.representation.volume.themes,{volume:o.data},s)),d=(v=a.getAncestorOfType(fe.Molecule.Structure))===null||v===void 0?void 0:v.data,f=(d==null?void 0:d.models.length)===0?void 0:Of.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(i)]):[2,pn.Null];case 1:return m.sent(),f&&c.setState({transform:f}),[2,new fe.Volume.Representation3D({repr:c,sourceData:o.data},{label:"".concat(Math.round(o.isoValue.relativeValue*100)/100," \u03C3 [").concat(n.channel,"]")})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return e.spine,Fe.create("Volume Representation",function(i){return se(void 0,void 0,void 0,function(){var o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return o=r.data.channels[a.channel],o?(s=n.data.repr.state.visible,u=uO(r.data,a.channel),l=_(_({},n.data.repr.props),u.type.params),n.data.repr.setTheme(qn.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(i)]):[2,We.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,We.UpdateResult.Updated]}})})})}});function uO(e,t){var r=e.channels[t];return xl.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var Fl;(function(e){function t(n){return n}e.create=t;function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=(o=(i=a.definition).getDuration)===null||o===void 0?void 0:o.call(i,a.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(Fl||(Fl={}));var zs;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=oa(c,0),d=oa(d,0),f=oa(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function a(s,u,l,c,d){for(var f=0,p=l;f<p;f+=c)for(var v=0;v<c;v++)u[d+f+c-v-1]=s[d+f+v]}e.flipByteOrder=a;function i(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var p=c[d];c[d]=(p&255)<<8|p>>8&255}}e.flipByteOrderInPlace2=i;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||a(s,u,l,c,d)}e.ensureLittleEndian=o})(zs||(zs={}));var o2;(function(e){function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,l;if(typeof i=="number"){o=oa(o,i);var c=a,d=Math.min(r.length,c+o);u=d-c,l=zs.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=oa(o,i.length);var c=a,d=Math.min(r.length,c+o);i.set(r.subarray(c,d),s),u=d-c,l=i}return o!==u&&console.warn("byteCount ".concat(o," and bytesRead ").concat(u," differ")),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(a,i,o){return o=oa(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=oa(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:Oc}}e.fromBuffer=t})(o2||(o2={}));var qa;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(qa||(qa={}));function pz(e){return e===qa.Float32?4:e===qa.Int16||e===qa.Uint16?2:1}function E0e(e,t,r,n){return r===void 0&&(r=0),e===qa.Float32?new Float32Array(t,r,n):e===qa.Int16?new Int16Array(t,r,n):e===qa.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function I0e(e,t){var r=pz(t),n=new ArrayBuffer(r*e),a=zs.fromArrayBuffer(n),i=zs.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:E0e(t,i)}}function D0e(e,t,r,n,a,i){return se(this,void 0,void 0,function(){return ie(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(i!==void 0&&i!==zs.IsNativeEndianLittle||!zs.IsNativeEndianLittle)&&zs.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function M0e(e){return se(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1,a[0]===68&&a[1]===65?i=!0:a[0]===17&&a[1]===17?i=!1:(o=r.readInt32LE(3*4),o<=16&&(i=!0)),s=i?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=i?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},[2,{header:l,littleEndian:i}]}})})}function R0e(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return mz(e)?(o=3*a,[4,r.readBuffer(n,t.readBuffer,a,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=a;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,D0e(t,r,n,a,0,i)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function vz(e){switch(e){case 0:return qa.Int8;case 1:return qa.Int16;case 2:return qa.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:qa.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '".concat(e,"'"))}function mz(e){return e.userFlag1===-128&&e.userFlag2===127}function hz(e){return mz(e)?qa.Float32:vz(e.MODE)}function O0e(e){return 256*4+e.NSYMBT}function B0e(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return v.sent(),[4,M0e(e)];case 2:return n=v.sent(),a=n.header,i=n.littleEndian,o=O0e(a),s=vz(a.MODE),u=hz(a),l=a.NC*a.NR*a.NS,c=pz(s),d=l*c,f=I0e(l,u),R0e(a,f,e,o,d,i),p={header:a,values:f.values,name:e.name},[2,p]}})})}function k0e(e,t){var r=this;return Fe.create("Parse CCP4/MRC/MAP",function(n){return se(r,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=dn).success,[4,B0e(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,dn.error(o)];case 3:return[2]}})})})}function L0e(e,t){return k0e(o2.fromBuffer(zs.fromUint8Array(e),t),e.length)}var I4=512;function F0e(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function N0e(e,t){var r=t?function(a){return e.readInt16LE(a*2)}:function(a){return e.readInt16BE(a*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function gz(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=Math.ceil(t/8),i=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:a,yBlocks:i,zBlocks:o}}function U0e(e){return se(this,void 0,void 0,function(){var t,r,n,a,i;return ie(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,I4)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||t.readInt16LE(18*2)===100,i=n?F0e(r):N0e(t,a),[2,{header:i,littleEndian:a}]}})})}function z0e(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A;return ie(this,function(P){for(n||zs.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=gz(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,p=0,v=0;v<f;++v)for(m=0;m<d;++m)for(h=0;h<c;++h)for(g=0;g<8;++g)for(y=8*v+g,b=0;b<8;++b)for(S=8*m+b,C=0;C<8;++C)if(x=8*h+C,x<o&&S<s&&y<u)A=(x*s+S)*u+y,r[A]=(t[p]-i)/a,++p;else{p+=8-C;break}return[2]})})}function V0e(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=gz(e),i=a.xBlocks,o=a.yBlocks,s=a.zBlocks,u=t*r*n,l=i*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function H0e(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,U0e(e)];case 2:return n=c.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(I4,t-I4)];case 3:return o=c.sent().buffer,s=V0e(a).valueCount,u=new Float32Array(s),[4,z0e(a,o,u,i)];case 4:return c.sent(),l={header:a,values:u,name:e.name},[2,l]}})})}function G0e(e,t){var r=this;return Fe.create("Parse DSN6/BRIX",function(n){return se(r,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=dn).success,[4,H0e(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,dn.error(o)];case 3:return[2]}})})})}function q0e(e,t){return G0e(o2.fromBuffer(zs.fromUint8Array(e),t),e.length)}var j0e={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},W0e=new Set(Object.keys(j0e));function m3(e){if(!W0e.has(e))throw new Error("unknown ply type '".concat(e,"'"));return e}function X0e(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function Y0e(e,t){var r=it(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function K0e(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,it.eatLine(e)}function Q0e(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;K0e(t);var a=it.getTokenString(t).split(/\r?\n/);if(a[0]!=="ply")throw new Error("data not starting with 'ply'");if(a[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var i,o,s;function u(){if(i!==void 0&&o!==void 0&&s!==void 0){for(var p=!1,v=0,m=s.length;v<m;++v){var h=s[v];if(h.kind==="list"){p=!0;break}}p&&s.length!==1,p?n.push({kind:"list",name:i,count:o,property:s[0]}):n.push({kind:"table",name:i,count:o,properties:s})}}for(var l=2,c=a.length;l<c;++l){var d=a[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],i=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:m3(f[2]),dataType:m3(f[3]),name:f[4]}):s.push({kind:"column",type:m3(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function Z0e(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];a.kind==="table"?$0e(e,a):a.kind==="list"&&J0e(e,a)}}function yz(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ce.Schema.int;case"float":case"double":case"float32":case"float64":return ce.Schema.float}}function $0e(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var p=Ke.create(n.data,a*2);l.push(p)}for(var d=0,f=a;d<f;++d)for(var v=0,m=o;v<m;++v)it.skipWhitespace(n),it.markStart(n),it.eatValue(n),Ke.addUnchecked(l[v],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var h=i[d],g=h.type,y=h.name,b=wP(l[d],yz(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function J0e(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=Ke.create(n.data,a*2*3),s=new Uint32Array(a+1),u=0,l=0,c=a;l<c;++l){for(it.skipWhitespace(n),it.markStart(n);it.skipWhitespace(n)!==10;)++u,it.markStart(n),it.eatValue(n),Ke.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=wP(o,yz(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(p){for(var v=s[p]+1,m=f.value(v-1),h=v,g=v+m;h<g;++h)d.entries[h-v]=f.value(h);return d.count=m,d}})}function ege(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s;return ie(this,function(u){return r=Y0e(e,t),t.update({message:"Parsing...",current:0,max:e.length}),Q0e(r),Z0e(r),n=r.elements,a=r.elementSpecs,i=r.comments,o=a.map(function(l){return l.name}),s=X0e(n,o,i),[2,dn.success(s)]})})}function tge(e){var t=this;return Fe.create("Parse PLY",function(r){return se(t,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,ege(e,r)];case 1:return[2,n.sent()]}})})})}var s2=it.readLine,bz=it.skipWhitespace,Sz=it.eatValue,rge=it.eatLine,D4=it.markStart,N1=/\s+/,nge=/(^\*|REMARK)*/;function age(e,t){return{tokenizer:e,runtimeCtx:t}}function ige(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,v,m,h;return ie(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=Ke.create(r.data,t*2),a=Ke.create(r.data,t*2),i=Ke.create(r.data,t*2),o=Ke.create(r.data,t*2),s=Ke.create(r.data,t*2),u=Ke.create(r.data,t*2),l=Ke.create(r.data,t*2),c=Ke.create(r.data,t*2),d=r.position,f=s2(r).trim(),r.position=d,p=f.split(N1).length===7,v=p?6:8,m=r.length,h=0,[4,Pl(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-h,y),S=0;S<b;++S){for(var C=0;C<v;++C)if(bz(r),D4(r),Sz(r),p)switch(C){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:Ke.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:Ke.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:Ke.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:Ke.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(C){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:Ke.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:Ke.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:Ke.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:Ke.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:Ke.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:Ke.addUnchecked(c,r.tokenStart,r.tokenEnd);break}rge(r),D4(r)}return h+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:m})})];case 1:return g.sent(),[2,{count:t,atomId:ur(n)(ce.Schema.int),segmentName:p?ur(i)(ce.Schema.str):ur(a)(ce.Schema.str),residueId:ur(i)(ce.Schema.int),residueName:p?ur(i)(ce.Schema.str):ur(o)(ce.Schema.str),atomName:ur(s)(ce.Schema.str),atomType:ur(u)(ce.Schema.str),charge:ur(l)(ce.Schema.float),mass:ur(c)(ce.Schema.float)}]}})})}function oge(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o;return ie(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=Ke.create(r.data,t*2),a=Ke.create(r.data,t*2),i=r.length,o=0,[4,Pl(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(bz(r),D4(r),Sz(r),d){case 0:Ke.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:Ke.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:ur(n)(ce.Schema.int),atomIdB:ur(a)(ce.Schema.int)}]}})})}function sge(e,t){for(var r=[],n=0;n<t;++n){var a=s2(e.tokenizer);r.push(a.replace(nge,"").trim())}return r}function uge(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:r=it(e),n=age(r,t),a=void 0,i=void 0,o=void 0,s=s2(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=s2(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(N1)[0]),a=sge(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(N1)[0]),[4,ige(n,c)]):[3,4];case 3:return i=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(N1)[0]),[4,oge(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return a===void 0&&(a=[]),i===void 0?[2,dn.error("no atoms data")]:o===void 0?[2,dn.error("no bonds data")]:(f={id:s,title:a,atoms:i,bonds:o},[2,dn.success(f)])}})})}function lge(e){var t=this;return Fe.create("Parse PSF",function(r){return se(t,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,uge(e,r)];case 1:return[2,n.sent()]}})})})}var lO=.529177210859;function cge(e){var t=it.readLines(e,6),r=function(D,I){var M=+t[D].trim().split(/\s+/g)[I];return Number.isNaN(M)?0:M},n=function(D){var I=r(D+2,0),M=lO;return[Math.abs(I),w.create(r(D+2,1)*M,r(D+2,2)*M,r(D+2,3)*M),I]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],p=n(2),v=p[0],m=p[1],h=n(3),g=h[0],y=h[1],b=dge(e,s,lO),S=[];if(l>=0){var C=r(2,4);C===0&&(C=1);for(var x=0;x<C;x++)S.push(x)}else for(var A=it.readLine(e).trim().split(/\s+/g),x=0,P=+A[0];x<P;x++)S.push(+A[x+1]);var T={orbitals:l<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:w.create(d,v,g),basisX:f,basisY:m,basisZ:y,dataSetIds:S};return{header:T,atoms:b}}function dge(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=it.readLine(e).trim().split(/\s+/g);n[u]=+l[0],a[u]=+l[1],i[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ce.ofArray({array:n,schema:ce.Schema.int}),nuclearCharge:ce.ofArray({array:a,schema:ce.Schema.float}),x:ce.ofArray({array:i,schema:ce.Schema.float}),y:ce.ofArray({array:o,schema:ce.Schema.float}),z:ce.ofArray({array:s,schema:ce.Schema.float})}}function fge(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=100*100*100,i=new Float64Array(n),o=0;return Pl(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)it.skipWhitespace(t),t.tokenStart=t.position,it.eatValue(t),u[c]=bl(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function pge(e,t){var r=this;return Fe.create("Parse Cube",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u;return ie(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),a=it(e),i=cge(a),o=i.header,s=i.atoms,[4,fge(n,a,o)];case 2:return u=l.sent(),[2,dn.success({header:o,atoms:s,values:u,name:t})]}})})})}function xz(e){for(var t={h:w()},r=0,n=0,a=/\s+/g;;){var i=it.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=w.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=w.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function vge(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=100*100*100,i=new Float64Array(n),o=0;return Pl(e,a,i,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)it.skipWhitespace(t),t.tokenStart=t.position,it.eatValue(t),u[c]=bl(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:a},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function mge(e,t,r){return se(this,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=it(t),a=xz(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,vge(e,n,a)];case 3:return i=o.sent(),[2,dn.success({header:a,values:i,name:r})]}})})}function hge(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=sP(t,0,1e3),a=it(n),i=xz(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,dn.success({header:o,values:c,name:r})]}})})}function gge(e,t){return Fe.create("Parse Cube",function(r){return typeof e=="string"?mge(r,e,t):hge(r,e,t)})}var Cz=_t.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{url:E.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:E.Optional(E.Text("")),isBinary:E.Optional(E.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Fe.create("Download",function(i){return se(r,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return o=Kr.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new fe.Data.Binary(s.data,{label:n.label?n.label:o.url}):new fe.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?We.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),We.UpdateResult.Updated):We.UpdateResult.Unchanged}}),wz=_t.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:fe.Root,to:fe.Data.Blob,params:{sources:E.ObjectList({id:E.Text("",{label:"Unique ID"}),url:E.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:E.Optional(E.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:E.Optional(E.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return"".concat(e.id,": ").concat(e.url)}),maxConcurrency:E.Optional(E.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Fe.create("Download Blob",function(i){return se(r,void 0,void 0,function(){var o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return o=[],[4,PK(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download ".concat(c.id," (").concat(d.url,") failed: ").concat(c.error)):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return a.assets=u,[2,new fe.Data.Blob(o,{label:"Data Blob",description:"".concat(o.length," ").concat(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,a=(r=n)===null||r===void 0?void 0:r.assets;if(!!a)for(var i=0,o=a;i<o.length;i++){var s=o[i];s.dispose()}}}),_z=_t.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{data:E.Value("",{isHidden:!0}),label:E.Optional(E.Text(""))}})({apply:function(e){var t=this,r=e.params;return Fe.create("Raw Data",function(){return se(t,void 0,void 0,function(){return ie(this,function(n){if(typeof r.data=="string")return[2,new fe.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new fe.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new fe.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new fe.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?We.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,We.UpdateResult.Updated):We.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),Az=_t.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:fe.Root,to:[fe.Data.String,fe.Data.Binary],params:{file:E.File(),label:E.Optional(E.Text("")),isBinary:E.Optional(E.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Fe.create("Open File",function(i){return se(r,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,pn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,s=n.isBinary?new fe.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new fe.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,a=e.b;return r.label!==n.label?(a.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",We.UpdateResult.Updated):We.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),yge=_t.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:fe.Data.Blob,to:fe.Format.Blob,params:{formats:E.ObjectList({id:E.Text("",{label:"Unique ID"}),format:E.Select("cif",[["cif","cif"]])},function(e){return"".concat(e.id,": ").concat(e.format)})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Parse Blob",function(i){return se(r,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,m.label=1;case 1:return d<f.length?(p=f[d],o.has(p.id)?[4,(p.kind==="string"?Ol.parse(p.data):Ol.parseBinary(p.data)).runInContext(i)]:[3,3]):[3,4];case 2:if(v=m.sent(),v.isError)throw new Error("".concat(p.id,": ").concat(v.message));c.push({id:p.id,kind:"cif",data:v.result}),m.label=3;case 3:return d++,[3,1];case 4:return[2,new fe.Format.Blob(c,{label:"Format Blob",description:"".concat(c.length," ").concat(c.length===1?"entry":"entries")})]}})})})}}),bge=_t.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[fe.Data.String,fe.Data.Binary],to:fe.Format.Cif})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse CIF",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,(fe.Data.String.is(r)?Ol.parse(r.data):Ol.parseBinary(r.data)).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Cif(a.result)]}})})})}}),Sge=_t.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:fe.Data.String,to:fe.Format.Cube})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse Cube",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,pge(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Cube(a.result)]}})})})}}),xge=_t.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[fe.Data.String],to:fe.Format.Psf})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse PSF",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,lge(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Psf(a.result)]}})})})}}),Cge=_t.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[fe.Data.String],to:fe.Format.Ply})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse PLY",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,tge(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),wge=_t.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[fe.Data.Binary],to:fe.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse CCP4/MRC/MAP",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,L0e(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Ccp4(a.result)]}})})})}}),_ge=_t.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[fe.Data.Binary],to:fe.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse DSN6/BRIX",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,q0e(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Dsn6(a.result)]}})})})}}),Age=_t.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[fe.Data.Binary,fe.Data.String],to:fe.Format.Dx})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse DX",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,gge(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Dx(a.result)]}})})})}}),Tge=_t.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:fe.Root,to:fe.Data.String,params:{data:E.Value(""),label:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new fe.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?We.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",We.UpdateResult.Updated):We.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),Pge=_t.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:fe.Root,to:fe.Format.Json,params:{data:E.Value({}),label:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new fe.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?We.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",We.UpdateResult.Updated):We.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),Ege=_t.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[fe.Data.String],to:fe.Format.Json})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse JSON",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new fe.Format.Json(a)]}})})})}}),Ige=_t.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:fe.Root,to:fe.Volume.Lazy,params:{url:E.Url(""),isBinary:E.Boolean(!1),format:E.Text("ccp4"),entryId:E.Value("",{isHidden:!0}),isovalues:E.ObjectList({type:E.Text("relative"),value:E.Numeric(0),color:E.Color(tr.black),alpha:E.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:E.Numeric(0)},function(e){return"".concat(e.type," ").concat(e.value)})}})({apply:function(e){var t=this;e.a;var r=e.params;return Fe.create("Lazy Volume",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){return a=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new fe.Volume.Lazy(r,{label:"".concat(a||r.url),description:"Lazy Volume"})]})})})}}),Dge=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Download:Cz,DownloadBlob:wz,RawData:_z,ReadFile:Az,ParseBlob:yge,ParseCif:bge,ParseCube:Sge,ParsePsf:xge,ParsePly:Cge,ParseCcp4:wge,ParseDsn6:_ge,ParseDx:Age,ImportString:Tge,ImportJson:Pge,ParseJson:Ege,LazyVolume:Ige}),Mge=_t.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:fe.Group,params:{label:E.Text("Group"),description:E.Optional(E.Text(""))}})({apply:function(e){var t=e.params;return new fe.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return Yv(t,r)?We.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,We.UpdateResult.Updated)}}),Rge=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",CreateGroup:Mge});function Oge(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(i[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(i[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(i[22]!==0&&(c=!0,i[12]!==0&&(d=!0),i[13]===1&&(f=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),i[22]!==84)throw new Error("dcd bad format, header block end");a=a+21*4+8;var p=t.getInt32(a,o),v=a+1;if((p-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=gee(e.subarray(v,p)),t.getInt32(v+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(a=a+p+8,t.getInt32(a,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),t.getInt32(a+8,o)!==4)throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var m=r.NATOM,h=m*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=m,d&&(a+=4,g.cell=[t.getFloat64(a,o),t.getFloat64(a+1,o),t.getFloat64(a+2*8,o),t.getFloat64(a+3*8,o),t.getFloat64(a+4*8,o),t.getFloat64(a+5*8,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==h)throw new Error("dcd bad format, coord block start: ".concat(u,", ").concat(y));a+=4;var b=new Float32Array(e.buffer,a,m);if(y===0?g.x=b:y===1?g.y=b:g.z=b,a+=h,t.getInt32(a,o)!==h)throw new Error("dcd bad format, coord block end: ".concat(u,", ").concat(y));a+=4}if(f){var S=t.getInt32(a,o);a+=4+S+4}n.push(g)}return{header:r,frames:n}}function Bge(e){var t=this;return Fe.create("Parse DCD",function(r){return se(t,void 0,void 0,function(){var n;return ie(this,function(a){try{return n=Oge(e),[2,dn.success(n)]}catch(i){return[2,dn.error(i)]}return[2]})})})}function kge(e){return function(t,r,n){return Lge(e,t,r,n)}}function Lge(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=i[2*l]+t,d=i[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),fre(a,c,f)}:s==="int"?function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:lf(a,c,c+r)}:function(l){var c=i[2*l]+t;return c>i[2*l+1]?0:SY(a,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return Ia(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function Fge(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function Nge(e,t){return{tokenizer:e,header:Fge(),numberOfAtoms:0,runtimeCtx:t}}function Uge(e){var t=e.tokenizer,r=e.header,n=it.readLine(t);n.trim().length===0&&(n=it.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function zge(e){var t=e.tokenizer;it.markLine(t);var r=it.getTokenString(t);e.numberOfAtoms=parseInt(r)}function Vge(e){return se(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,it.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=v.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),o=i.length===6,e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=kge(n),f=ce.Undefined(e.numberOfAtoms,ce.Schema.float),p={count:e.numberOfAtoms,residueNumber:d(0,5,ce.Schema.int),residueName:d(5,5,ce.Schema.str),atomName:d(10,5,ce.Schema.str),atomNumber:d(15,5,ce.Schema.int),x:d(s,u,ce.Schema.float),y:d(s+u,u,ce.Schema.float),z:d(s+2*u,u,ce.Schema.float),vx:o?d(l,c,ce.Schema.float):f,vy:o?d(l+c,c,ce.Schema.float):f,vz:o?d(l+2*c,c,ce.Schema.float):f},[2,p]}})})}function Hge(e){var t=e.tokenizer,r=it.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function Gge(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o;return ie(this,function(s){switch(s.label){case 0:return r=it(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=Nge(r,t),Uge(a),zge(a),[4,Vge(a)]):[3,4];case 3:return i=s.sent(),Hge(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return o={structures:n},[2,dn.success(o)]}})})}function qge(e){var t=this;return Fe.create("Parse GRO",function(r){return se(t,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,Gge(e,r)];case 1:return[2,n.sent()]}})})})}function jge(e,t,r){var n=this;return r===void 0&&(r=!1),Fe.create("Parse PDB",function(a){return se(n,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return o=(i=dn).success,s={},[4,it.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function Tz(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&a.push([u,u]),(l==="uchar"||l==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return _(_({},Rt.Params),{coloring:E.MappedStatic(f,{vertex:E.Group({red:E.Select(n.vRed,i,{label:"Red Property"}),green:E.Select(n.vGreen,i,{label:"Green Property"}),blue:E.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:E.Group({red:E.Select(n.mRed,c,{label:"Red Property"}),green:E.Select(n.mGreen,c,{label:"Green Property"}),blue:E.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:E.Group({color:E.Color(tr.grey)},{isFlat:!0})}),grouping:E.MappedStatic(n.group?"vertex":"none",{vertex:E.Group({group:E.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:E.Group({})})})}var cO=Tz();function Wge(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),v=!!d&&!!f&&!!p,m=e;m<t;++m)Le.add3(i,u.value(m),l.value(m),c.value(m)),v&&Le.add3(o,d.value(m),f.value(m),p.value(m)),Le.add(s,a[m])}function Xge(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;u===3?Le.add3(a,s[0],s[1],s[2]):u===4&&(Le.add3(a,s[2],s[1],s[0]),Le.add3(a,s[2],s[0],s[3]))}}function Yge(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,v,m,h;return ie(this,function(g){switch(g.label){case 0:if(i=ct.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,p=1e5,v=0,m=t.rowCount,g.label=1;case 1:return v<m?(Wge(v,Math.min(v+p,m),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:v,max:m})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return v+=p,[3,1];case 4:v=0,m=r.rowCount,g.label=5;case 5:return v<m?(Xge(v,Math.min(v+p,m),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:v,max:m})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return v+=p,[3,5];case 8:return h=ct.getMesh(i),f||Rt.computeNormals(h),[2,h]}})})}var Qu=ce.Schema.int;function Kge(e,t){for(var r=t.grouping,n=e.rowCount,a=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?mo(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):is(new Uint32Array(n)),s=a?Eu(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:i}}function dO(e,t,r){var n=r.coloring,a=e.rowCount,i,o,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||ce.ofConst(127,a,Qu),o=e.getProperty(n.params.green)||ce.ofConst(127,a,Qu),s=e.getProperty(n.params.blue)||ce.ofConst(127,a,Qu);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||ce.ofConst(127,a,Qu),o=t&&t.getProperty(n.params.green)||ce.ofConst(127,a,Qu),s=t&&t.getProperty(n.params.blue)||ce.ofConst(127,a,Qu);else{var u=$e.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];i=ce.ofConst(l,a,Qu),o=ce.ofConst(c,a,Qu),s=ce.ofConst(d,a,Qu)}return{kind:n.name,red:i,green:o,blue:s}}function fO(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return xr.create("ply-mesh",e,t,function(d){var f=a==="material"?d:l[d];return $e.fromRgb(i.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return"".concat(c," ").concat(u[d])})}function Qge(){var e=this,t,r,n,a,i,o,s=function(u,l,c,d){return se(e,void 0,void 0,function(){var f,p,v,m,h;return ie(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(p=l.getElement("face"),!p)throw new Error("missing face element");return v=l.getElement("material"),m=!1,h=!1,(!t||t!==l)&&(m=!0),(!r||!E.isParamEqual(cO.grouping,r.grouping,c.grouping))&&(m=!0),(!r||!E.isParamEqual(cO.coloring,r.coloring,c.coloring))&&(h=!0),m?(i=dO(f,v,c),o=Kge(f,c),[4,Yge(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return a=g.sent(),n=fO(l,a,i,o),[3,3];case 2:h&&(i=dO(f,v,c),n=fO(l,a,i,o)),g.label=3;case 3:return t=l,r=Cd(c),[2,n]}})})};return s}function Zge(e,t){var r=this;return Fe.create("Shape Provider",function(n){return se(r,void 0,void 0,function(){return ie(this,function(a){return[2,{label:"Mesh",data:e,params:Tz(e),getShape:Qge(),geometryUtils:Rt.Utils}]})})})}function Lf(){return Lf.empty()}(function(e){function t(a,i){return{size:a,anglesInRadians:i}}e.create=t;function r(){return t(w(),w())}e.empty=r;function n(a,i,o){var s=w.magnitude(a),u=w.magnitude(i),l=w.magnitude(o),c=Math.acos(w.dot(i,o)/(u*l)),d=Math.acos(w.dot(a,o)/(s*l)),f=Math.acos(w.dot(a,i)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(w.create(s,u,l),w.create(c,d,f))}e.fromBasis=n})(Lf||(Lf={}));var $ge=20.45482949774598;function Jge(e){var t=this;return Fe.create("Parse DCD",function(r){return se(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,a=n.DELTA?kc(n.DELTA*$ge,"ps"):kc(1,"step"),i=n.ISTART>=1?kc((n.ISTART-1)*a.value,a.unit):kc(0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:kc(i.value+a.value*s,a.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=Lf.create(w.create(d[0],d[2],d[5]),w.create(wr(90-Math.asin(d[1])*90/l0),wr(90-Math.asin(d[3])*90/l0),wr(90-Math.asin(d[4])*90/l0))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=Lf.fromBasis(w.create(d[0],d[1],d[3]),w.create(d[1],d[2],d[4]),w.create(d[3],d[4],d[5])):c.cell=Lf.create(w.create(d[0],d[2],d[5]),w.create(wr(tn(d[1],0,zr)?90:d[1]),wr(tn(d[3],0,zr)?90:d[3]),wr(tn(d[4],0,zr)?90:d[4])))),o.push(c);return[2,$0.create(o,a,i)]}})})})}function u2(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(++i,a===i||a+1===i)return Ke.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return Ke.add(e,a,a+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return Ke.add(e,a,a+1);Ke.add(e,a,a)}var eye=/^[\s\d]+|[\s\d]+$/g;function ex(e){e=e.replace(eye,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var tye=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],rye=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],nye=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],aye=new Set(["FMN","NCN","FNS","FMA"]),pO=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),vO=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Ud=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(Dm.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var a=this.seqId.value(t);if(a!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!Pn.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,tye)?"peptide linking":this.hasAtomIds(t,rye)?"RNA linking":this.hasAtomIds(t,nye)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(pO.has(t))this.set(pO.get(t));else if(yS.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(aye.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&vO.has(t))this.set(vO.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return kr.ofPartialColumns(Pi.chem_comp,{id:ce.ofStringArray(this.ids),name:ce.ofStringArray(this.names),type:ce.ofStringAliasArray(this.types),mon_nstd_flag:ce.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),h3="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function iye(e){for(var t=h3.length,r=e,n=0,a=h3[r%t];r>=t;)r=Math.floor(r/t),a+=h3[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),a}var M4=TS(iye),zd=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push("".concat(this.count)),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return r===2?(this.waterId===void 0&&(this.set("water",(a==null?void 0:a.customName)||"Water"),this.waterId="".concat(this.count)),this.waterId):SS(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(a==null?void 0:a.customName)||"Polymer ".concat(this.chainMap.size+1)),this.chainMap.set(n,"".concat(this.count))),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(a==null?void 0:a.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,"".concat(this.count))),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return kr.ofPartialColumns(Pi.entity,{id:ce.ofStringArray(this.ids),type:ce.ofStringAliasArray(this.types),pdbx_description:ce.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains,o=a.description;this.set("polymer",o);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],"".concat(this.count))}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function oye(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new zd,l=new Ud(e.residueNumber,e.atomName),c="",d=0,f="",p=0,v=0,m=-1,h=0,g=e.count;h<g;++h){var y=e.residueNumber.value(h);if(y!==m){var b=e.residueName.value(h),S=Mm(l.add(b,h).type,b);(S!==v||y!==m+1&&!(m===99999&&y===0))&&(f=M4(d),d+=1,p=0),c=u.getEntityId(b,S,f),p+=1,m=y,v=S}a[h]=c,i[h]=f,o[h]=p,s[h]=h}var C=ce.ofStringArray(i),x=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:C,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ce.ofFloatArray(ce.mapToArray(e.x,function(A){return A*10},Float32Array)),Cartn_y:ce.ofFloatArray(ce.mapToArray(e.y,function(A){return A*10},Float32Array)),Cartn_z:ce.ofFloatArray(ce.mapToArray(e.z,function(A){return A*10},Float32Array)),id:ce.ofIntArray(s),label_asym_id:C,label_atom_id:r,label_comp_id:n,label_seq_id:ce.ofIntArray(o),label_entity_id:ce.ofStringArray(a),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(ce.mapToArray(e.atomName,function(A){return ex(A)})),pdbx_PDB_model_num:ce.ofConst(t,e.count,ce.Schema.int)},e.count);return yp({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:x})}var R4;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(R4||(R4={}));function sye(e){var t=this;return Fe.create("Parse GRO",function(r){return se(t,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){switch(l.label){case 0:n=R4.fromGro(e),a=[],i=0,o=e.structures.length,l.label=1;case 1:return i<o?(s=oye(e.structures[i].atoms,i+1),[4,Yl(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&a.push(u.representative),l.label=3;case 3:return++i,[3,1];case 4:return[2,new Yf(a)]}})})})}function uye(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:lt.ofString(e),length_a:lt.ofString(r(6,9)),length_b:lt.ofString(r(15,9)),length_c:lt.ofString(r(24,9)),angle_alpha:lt.ofString(r(33,7)),angle_beta:lt.ofString(r(40,7)),angle_gamma:lt.ofString(r(47,7)),Z_PDB:lt.ofString(r(66,4)),pdbx_unique_axis:lt.ofString("?")},a={entry_id:lt.ofString(e),"space_group_name_H-M":lt.ofString(r(55,11)),Int_Tables_number:lt.ofString("?"),cell_setting:lt.ofString("?"),space_group_name_Hall:lt.ofString("?")};return[Ga.ofFields("cell",n),Ga.ofFields("symmetry",a)]}function mO(e,t){return{id:e,details:t,groups:[]}}function lye(e,t,r){for(var n=[],a,i,o,s=1,u=1,l=function(j){return e.data.substring(e.indices[2*j],e.indices[2*j+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),p="Biomolecule ".concat(f);d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,p=d.substr(11).trim()),a=mO(f,p),n.push(a)}else if(d.substr(13,5)==="BIOMT"){var v=d.split(/\s+/),m=parseInt(d[18])-1;m===0&&(o=oe.identity(),i.operators.push({id:s++,matrix:o})),oe.setValue(o,m,0,parseFloat(v[4])),oe.setValue(o,m,1,parseFloat(v[5])),oe.setValue(o,m,2,parseFloat(v[6])),oe.setValue(o,m,3,parseFloat(v[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},a.groups.push(i));for(var h=d.substr(41,30).split(","),g=0,y=h.length;g<y;++g){var b=h[g].trim();b&&i.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){a=mO("".concat(u),"Biomolecule ".concat(u)),n.push(a),u+=1,i={chains:[],operators:[]},a.groups.push(i),c++,d=l(c);for(var h=d.substr(11,69).split(","),g=0,y=h.length;g<y;++g){var b=h[g].trim();b&&i.chains.push(b)}}}if(n.length===0)return[];for(var S={id:lt.ofStrings(n.map(function(j){return j.id})),details:lt.ofStrings(n.map(function(j){return j.details}))},C=[],x=0,A=n;x<A.length;x++)for(var P=A[x],T=0,D=P.groups;T<D.length;T++){var I=D[T];C.push({assembly_id:P.id,oper_expression:I.operators.map(function(j){return j.id}).join(","),asym_id_list:I.chains.join(",")})}for(var M={assembly_id:lt.ofStrings(C.map(function(j){return j.assembly_id})),oper_expression:lt.ofStrings(C.map(function(j){return j.oper_expression})),asym_id_list:lt.ofStrings(C.map(function(j){return j.asym_id_list}))},B=[],U=0,V=n;U<V.length;U++)for(var P=V[U],F=0,Y=P.groups;F<Y.length;F++)for(var W=Y[F],K=0,$=W.operators;K<$.length;K++){for(var J=$[K],m={id:""+J.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)m["matrix[".concat(c+1,"][").concat(g+1,"]")]=""+oe.getValue(J.matrix,c,g);m["vector[".concat(c+1,"]")]=""+oe.getValue(J.matrix,c,3)}B.push(m)}for(var Z={id:lt.ofStrings(B.map(function(j){return j.id})),type:lt.ofStrings(B.map(function(j){return j.type})),name:lt.ofStrings(B.map(function(j){return j.name})),symmetry_operation:lt.ofStrings(B.map(function(j){return j.symmetry_operation}))},N=function(j){for(var L=function(q){var X="matrix[".concat(j+1,"][").concat(q+1,"]");Z[X]=lt.ofStrings(B.map(function(Q){return Q[X]}))},H=0;H<3;H++)L(H);var G="vector[".concat(j+1,"]");Z[G]=lt.ofStrings(B.map(function(q){return q[G]}))},c=0;c<3;c++)N(c);return[Ga.ofFields("pdbx_struct_assembly",S),Ga.ofFields("pdbx_struct_assembly_gen",M),Ga.ofFields("pdbx_struct_oper_list",Z)]}function cye(e,t,r){for(var n=[],a,i=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=i(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(a=oe.identity(),n.push(a)),oe.setValue(a,l,0,parseFloat(u[2])),oe.setValue(a,l,1,parseFloat(u[3])),oe.setValue(a,l,2,parseFloat(u[4])),oe.setValue(a,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,p=n;f<p.length;f++){for(var v=p[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var m=0;m<3;m++)l["matrix[".concat(o+1,"][").concat(m+1,"]")]=""+oe.getValue(v,o,m);l["vector[".concat(o+1,"]")]=""+oe.getValue(v,o,3)}c.push(l)}for(var h={id:lt.ofStrings(c.map(function(y){return y.id})),code:lt.ofStrings(c.map(function(y){return y.code})),details:lt.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(x){var A="matrix[".concat(y+1,"][").concat(x+1,"]");h[A]=lt.ofStrings(c.map(function(P){return P[A]}))},S=0;S<3;S++)b(S);var C="vector[".concat(y+1,"]");h[C]=lt.ofStrings(c.map(function(x){return x[C]}))},o=0;o<3;o++)g(o);return[Ga.ofFields("struct_ncs_oper",h)]}var dye={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function fye(e){return dye[e]||"HELX_P"}function pye(e,t,r){for(var n=[],a=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},i=t;i<r;i++){var o=a(i);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=lt.ofStrings(n.map(function(f){return f.initChainID})),u=lt.ofStrings(n.map(function(f){return f.initResName})),l=lt.ofStrings(n.map(function(f){return f.endChainID})),c=lt.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:lt.ofUndefined(n.length,ce.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:lt.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:lt.ofStrings(n.map(function(f){return fye(f.helixClass)})),details:lt.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:lt.ofUndefined(n.length,ce.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:lt.ofStrings(n.map(function(f){return f.endSeqNum})),id:lt.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:lt.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:lt.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:lt.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:lt.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:lt.ofStrings(n.map(function(f){return f.helixID}))};return Ga.ofFields("struct_conf",d)}function vye(e,t,r){for(var n=[],a=function(v){return e.data.substring(e.indices[2*v],e.indices[2*v+1])},i=t;i<r;i++){var o=a(i);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=lt.ofStrings(n.map(function(v){return v.initChainID})),u=lt.ofStrings(n.map(function(v){return v.initResName})),l=lt.ofStrings(n.map(function(v){return v.initSeqNum})),c=lt.ofStrings(n.map(function(v){return v.endChainID})),d=lt.ofStrings(n.map(function(v){return v.endResName})),f=lt.ofStrings(n.map(function(v){return v.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:lt.ofStrings(n.map(function(v){return v.strand})),sheet_id:lt.ofStrings(n.map(function(v){return v.sheetID})),pdbx_beg_PDB_ins_code:lt.ofStrings(n.map(function(v){return v.initICode})),pdbx_end_PDB_ins_code:lt.ofStrings(n.map(function(v){return v.endICode}))};return Ga.ofFields("struct_sheet_range",p)}var mye={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function hye(e,t,r){for(var n=function(S){return e.data.substring(e.indices[2*S],e.indices[2*S+1])},a,i={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in mye?(a=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),a==="MOL_ID"?(i={chains:[],description:""},o.push(i)):a==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=f):a==="CHAIN"&&Array.prototype.push.apply(i.chains,f.split(/\s*,\s*/))}for(var p=[],v=0,m=o;v<m.length;v++)for(var h=m[v],g=0,y=h.chains;g<y.length;g++){var b=y[g];p.push({description:h.description,chains:[b]})}return p}function gye(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},a=new Map,i=t;i<r;i++){var o=n(i),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,"".concat(a.get(s)," ").concat(u)):a.set(s,u)}return a}function yye(e,t){var r=function(){return[]},n=function(){return Ke.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function bye(e){var t=lt.ofTokens(e.auth_asym_id),r=lt.ofTokens(e.auth_atom_id),n=lt.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:lt.ofTokens(e.auth_seq_id),B_iso_or_equiv:lt.ofTokens(e.B_iso_or_equiv),Cartn_x:lt.ofTokens(e.Cartn_x),Cartn_y:lt.ofTokens(e.Cartn_y),Cartn_z:lt.ofTokens(e.Cartn_z),group_PDB:lt.ofTokens(e.group_PDB),id:lt.ofStrings(e.id),label_alt_id:lt.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:lt.ofUndefined(e.index,ce.Schema.int),label_entity_id:lt.ofStrings(e.label_entity_id),occupancy:eJ(e.occupancy)?lt.ofUndefined(e.index,ce.Schema.float):lt.ofTokens(e.occupancy),type_symbol:lt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:lt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:lt.ofStrings(e.pdbx_PDB_model_num),partial_charge:lt.ofTokens(e.partial_charge)}}function hO(e,t,r,n,a,i){var o=r.data,s=a-n;Ke.addToken(e.group_PDB,it.trim(r,n,n+6)),it.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),Ke.addToken(e.auth_atom_id,it.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?Ke.add(e.label_alt_id,0,0):Ke.add(e.label_alt_id,n+16,n+17),Ke.addToken(e.auth_comp_id,it.trim(r,n+17,n+20)),Ke.add(e.auth_asym_id,n+21,n+22),Ke.addToken(e.auth_seq_id,it.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?Ke.add(e.pdbx_PDB_ins_code,0,0):Ke.add(e.pdbx_PDB_ins_code,n+26,n+27),Ke.addToken(e.Cartn_x,it.trim(r,n+30,n+38)),Ke.addToken(e.Cartn_y,it.trim(r,n+38,n+46)),Ke.addToken(e.Cartn_z,it.trim(r,n+46,n+54)),Ke.addToken(e.occupancy,it.trim(r,n+54,n+60)),s>=66?Ke.addToken(e.B_iso_or_equiv,it.trim(r,n+60,n+66)):Ke.add(e.B_iso_or_equiv,0,0),i&&Ke.addToken(e.partial_charge,it.trim(r,n+70,n+76)),s>=78&&!i?(it.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Ke.addToken(e.type_symbol,r):u2(e.type_symbol,o,n+12,n+16)):u2(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function Sye(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},a=function(){return Ke.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}function xye(e){var t=lt.ofTokens(e.pdbx_auth_seq_id),r=lt.ofTokens(e.pdbx_auth_comp_id),n=lt.ofTokens(e.pdbx_auth_asym_id),a=lt.ofTokens(e.pdbx_auth_atom_id),i={id:lt.ofStrings(e.id),type_symbol:lt.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:lt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:lt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=lt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=lt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=lt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=lt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=lt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=lt.ofNumbers(e["U[2][3]"]),i}function Cye(e,t,r,n,a){var i=r.data,o=a-n;it.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),Ke.addToken(e.pdbx_auth_atom_id,it.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?Ke.add(e.pdbx_label_alt_id,0,0):Ke.add(e.pdbx_label_alt_id,n+16,n+17),Ke.addToken(e.pdbx_auth_comp_id,it.trim(r,n+17,n+20)),Ke.add(e.pdbx_auth_asym_id,n+21,n+22),Ke.addToken(e.pdbx_auth_seq_id,it.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?Ke.add(e.pdbx_PDB_ins_code,0,0):Ke.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=lf(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=lf(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=lf(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=lf(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=lf(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=lf(i,n+63,n+70)/1e4,o>=78?(it.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?Ke.addToken(e.type_symbol,r):u2(e.type_symbol,i,n+12,n+16)):u2(e.type_symbol,i,n+12,n+16),e.index++}function wye(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;for(var s=function(I){return e.data.substring(e.indices[2*I],e.indices[2*I+1])},u=[],l=[],c=[],d=[],f=[],p=[],v=[],m=[],h=[],g=[],y=[11,16,21,26],b=1,i=t;i<r;i++){var S=s(i),C=a[parseInt(S.substr(6,5))],x={};if(C!==void 0)for(var A=0;A<4;++A){var P=parseInt(S.substr(y[A],5));if(!Number.isNaN(P)){var T=a[P];T!==void 0&&(C>T||x[T]===void 0&&(u.push("covale".concat(b)),l.push("covale"),c.push(n.label_asym_id.str(C)),f.push(n.auth_seq_id.int(C)),d.push(n.label_seq_id.int(C)),p.push(n.label_atom_id.str(C)),v.push(n.label_asym_id.str(T)),h.push(n.auth_seq_id.int(T)),m.push(n.label_seq_id.int(T)),g.push(n.label_atom_id.str(T)),b+=1))}}}var D={id:lt.ofStrings(u),conn_type_id:lt.ofStrings(l),ptnr1_label_asym_id:lt.ofStrings(c),ptnr1_auth_seq_id:lt.ofNumbers(f),ptnr1_label_seq_id:lt.ofNumbers(d),ptnr1_label_atom_id:lt.ofStrings(p),ptnr2_label_asym_id:lt.ofStrings(v),ptnr2_label_seq_id:lt.ofNumbers(m),ptnr2_auth_seq_id:lt.ofNumbers(h),ptnr2_label_atom_id:lt.ofStrings(g)};return Ga.ofFields("struct_conn",D)}function _ye(e){return se(this,void 0,void 0,function(){var t,r,n,a,i,o,s,T,h,g,y,u,l,c,d,f,p,v,m,T,h,g,y,b,b,b,b,b,b,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y;return ie(this,function(W){for(t=e.lines,r=t.data,n=t.indices,a=it(r),i=!!e.isPdbqt,o=0,s=0,T=0,h=t.count;T<h;T++)switch(g=n[2*T],y=n[2*T+1],r[g]){case"A":Vn(r,g,y,"ATOM  ")?o++:Vn(r,g,y,"ANISOU")&&s++;break;case"H":Vn(r,g,y,"HETATM")&&o++;break}for(u=yye(r,o),l=Sye(r,s),c=new zd,d=[],f=[],p=0,v="",m=void 0,T=0,h=t.count;T<h;T++)switch(g=n[2*T],y=n[2*T+1],r[g]){case"A":Vn(r,g,y,"ATOM  ")?(p||(p++,v=""+p),hO(u,v,a,g,y,i)):Vn(r,g,y,"ANISOU")&&Cye(l,v,a,g,y);break;case"C":if(Vn(r,g,y,"CRYST1"))d.push.apply(d,uye(e.id||"?",r.substring(g,y)));else if(Vn(r,g,y,"CONECT")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"CONECT");)b++;m?Ar&&console.log("only single CONECT block allowed, ignoring others"):m=[T,b],T=b-1}else if(Vn(r,g,y,"COMPND")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"COMPND");)b++;c.setCompounds(hye(t,T,b)),T=b-1}break;case"H":if(Vn(r,g,y,"HETATM"))p||(p++,v=""+p),hO(u,v,a,g,y,i);else if(Vn(r,g,y,"HELIX")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"HELIX");)b++;d.push(pye(t,T,b)),T=b-1}else if(Vn(r,g,y,"HETNAM")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(gye(t,T,b).entries())),T=b-1}break;case"M":if(Vn(r,g,y,"MODEL ")&&(p++,v=""+p),Vn(r,g,y,"MTRIX")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"MTRIX");)b++;d.push.apply(d,cye(t,T,b)),T=b-1}break;case"O":break;case"R":if(Vn(r,g,y,"REMARK 350")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"REMARK 350");)b++;d.push.apply(d,lye(t,T,b)),T=b-1}break;case"S":if(Vn(r,g,y,"SHEET")){for(b=T+1;g=n[2*b],y=n[2*b+1],!!Vn(r,g,y,"SHEET");)b++;d.push(vye(t,T,b)),T=b-1}break}for(S=ce.ofIntTokens(u.auth_seq_id),C=ce.ofStringTokens(u.auth_atom_id),x=ce.ofStringTokens(u.auth_comp_id),A=ce.ofStringTokens(u.auth_asym_id),P=new Ud(S,C),P.setNames(f),c.setNames(f),T=0,D=x.rowCount;T<D;++T)I=x.value(T),M=Mm(P.add(I,T).type,I),u.label_entity_id[T]=c.getEntityId(I,M,A.value(T));for(B=bye(u),i||delete B.partial_charge,m&&d.push(wye(t,m[0],m[1],B)),U={entity:Ga.ofTable("entity",c.getEntityTable()),chem_comp:Ga.ofTable("chem_comp",P.getChemCompTable()),atom_site:Ga.ofFields("atom_site",B),atom_site_anisotrop:Ga.ofFields("atom_site_anisotrop",xye(l))},V=0,F=d;V<F.length;V++)Y=F[V],U[Y.name]=Y;return[2,{header:e.id||"PDB",categoryNames:Object.keys(U),categories:U}]})})}var O4;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(O4||(O4={}));function Aye(e){var t=this;return Fe.create("Parse PDB",function(r){return se(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return v.sent(),[4,_ye(e)];case 2:return n=v.sent(),a=Xr.fromFrame(n,void 0,O4.create(e)),[4,Yl(a.data.db,a,r)];case 3:return i=v.sent(),o=(p=n.categories.atom_site)===null||p===void 0?void 0:p.getField("partial_charge"),o&&i.frameCount===1&&(s=i.representative,u=s.atomicHierarchy.atomSourceIndex,l=ce.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ce.ofFloatArray(ce.mapToArray(u,function(m){return d[m]},Float32Array)):ce.ofFloatArray(d),sm.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,i]}})})})}function Tye(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new zd,o=new Ud(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,p=0,v=-1,m=0,h=e.count;m<h;++m){var g=e.residueId.value(m),y=e.segmentName.value(m);if(d!==y?(l=M4(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==v){var b=e.residueName.value(m),S=Mm(o.add(b,m).type,b);!f&&(S!==p||g!==v+1)&&(l=M4(u),u+=1,c=0),s=i.getEntityId(b,S,l),c+=1,v=g,p=S}t[m]=s,r[m]=l,n[m]=c,a[m]=m}var C=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ce.ofIntArray(a),label_asym_id:ce.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ce.ofIntArray(n),label_entity_id:ce.ofStringArray(t),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(ce.mapToArray(e.atomName,function(x){return ex(x)})),pdbx_PDB_model_num:ce.ofConst(1,e.count,ce.Schema.int)},e.count);return yp({entity:i.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:C})}var B4;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(B4||(B4={}));function Pye(e){var t=this;return Fe.create("Parse PSF",function(r){return se(t,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){return n=B4.fromPsf(e),a=Tye(e.atoms),i=e.bonds,o=i.atomIdA,s=i.atomIdB,u={indexA:ce.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ce.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ce.ofConst(1,e.bonds.count,ce.Schema.int)},[2,X_.create(e.id,a,u,n)]})})})}var Xp={dynamicBonds:E.Optional(E.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules."}))},Ff;(function(e){function t(u,l){var c=u&&kn.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,"".concat(S.id,": ").concat(mo(S.details))]}):[],f=c?!Ri.isZero(c.spacegroup.cell):!0,p=[];if(c)for(var v=c.spacegroup.operators,m=0,h=v.length;m<h;m++)p.push([m,"".concat(m+1,": ").concat(ss.getOperatorXyz(v[m]))]);var g=[];u&&u.properties.structAsymMap.forEach(function(S){var C=S.id===S.auth_id?S.id:"".concat(S.id," [auth ").concat(S.auth_id,"]");g.push([S.id,C])});var y={auto:E.Group(Xp),model:E.Group(Xp),assembly:E.Group(_({id:E.Optional(u?E.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):E.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},Xp),{isFlat:!0}),"symmetry-mates":E.Group(_({radius:E.Numeric(5,{min:0,max:50,step:1})},Xp),{isFlat:!0}),symmetry:E.Group(_({ijkMin:E.Vec3(w.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:E.Vec3(w.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},Xp),{isFlat:!0}),"symmetry-assembly":E.Group(_({generators:E.ObjectList({operators:E.ObjectList({index:E.Select(0,p),shift:E.Vec3(w(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return"".concat(S.index+1,"_").concat(S.shift.map(function(C){return C+5}).join(""))},{defaultValue:[]}),asymIds:E.MultiSelect([],g)},function(S){return"".concat(S.asymIds.length," asym ids, ").concat(S.operators.length," operators")},{defaultValue:[]})},Xp),{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:E.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d,f){return se(this,void 0,void 0,function(){var p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return p=void 0,v=kn.Provider.get(c),!d&&v&&v.assemblies.length!==0&&(d=v.assemblies[0].id),!v||v.assemblies.length===0?u.log.warn("Model '".concat(c.entryId,"' has no assembly, returning model structure.")):(p=rg.findAssembly(c,d||""),p||u.log.warn("Model '".concat(c.entryId,"' has no assembly called '").concat(d,"', returning model structure."))),m=Ne.ofModel(c,f),p?(d=p.id,[4,wu.buildAssembly(m,d).runInContext(l)]):(h={label:"Model",description:Ne.elementDescription(m)},[2,new fe.Molecule.Structure(m,h)]);case 1:return g=b.sent(),y={label:"Assembly ".concat(d),description:Ne.elementDescription(g)},[2,new fe.Molecule.Structure(g,y)]}})})}function a(u,l,c,d,f){return se(this,void 0,void 0,function(){var p,v,m;return ie(this,function(h){switch(h.label){case 0:return p=Ne.ofModel(l,f),[4,wu.buildSymmetryRange(p,c,d).runInContext(u)];case 1:return v=h.sent(),m={label:"Symmetry [".concat(c,"] to [").concat(d,"]"),description:Ne.elementDescription(v)},[2,new fe.Molecule.Structure(v,m)]}})})}function i(u,l,c,d){return se(this,void 0,void 0,function(){var f,p,v;return ie(this,function(m){switch(m.label){case 0:return f=Ne.ofModel(l,d),[4,wu.builderSymmetryMates(f,c).runInContext(u)];case 1:return p=m.sent(),v={label:"Symmetry Mates",description:Ne.elementDescription(p)},[2,new fe.Molecule.Structure(p,v)]}})})}function o(u,l,c,d,f){return se(this,void 0,void 0,function(){var p,v,m;return ie(this,function(h){switch(h.label){case 0:return p=Ne.ofModel(l,f),[4,wu.buildSymmetryAssembly(p,c,d).runInContext(u)];case 1:return v=h.sent(),m={label:"Symmetry Assembly",description:Ne.elementDescription(v)},[2,new fe.Molecule.Structure(v,m)]}})})}function s(u,l,c,d){return se(this,void 0,void 0,function(){var f,p,v,v;return ie(this,function(m){if(f=d==null?void 0:d.params,p=kn.Provider.get(c),!p||!d||d.name==="model")return v=Ne.ofModel(c,f),[2,new fe.Molecule.Structure(v,{label:"Model",description:Ne.elementDescription(v)})];if(d.name==="auto")return p.assemblies.length===0?(v=Ne.ofModel(c,f),[2,new fe.Molecule.Structure(v,{label:"Model",description:Ne.elementDescription(v)})]):[2,n(u,l,c,void 0,f)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id,f)];if(d.name==="symmetry")return[2,a(l,c,d.params.ijkMin,d.params.ijkMax,f)];if(d.name==="symmetry-mates")return[2,i(l,c,d.params.radius,f)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,p,f)];throw new Error("Unknown represetation type: ".concat(d.name))})})}e.create=s})(Ff||(Ff={}));var ii;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:Qn.is(u)?!!s.script&&Qn.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=Qn.is(u)?u:void 0,c=Qn.is(u)?Qn.toExpression(u):u,d=$f(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new Co(u))}e.run=n;function a(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=a;function i(s,u){return s.currentStructure=u,s.compiled(new Co(u))}e.updateStructure=i;function o(s,u,l){var c=ot.unionStructure(u);s.label="".concat(l||"Selection"),s.description=Ne.elementDescription(c),s.data=c}e.updateStructureObject=o})(ii||(ii={}));var Eye={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},Iye=new Set(["LI","NA","K","RB","CS","FR"]);function Dye(e){return Iye.has(e)}var Mye=new Set(["BE","MG","CA","SR","BA","RA"]);function Rye(e){return Mye.has(e)}var Oye=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function Bye(e){return Oye.has(e)}var kye=new Set(["F","CL","BR","I","AT"]);function Lye(e){return kye.has(e)}function Pz(e){var t=Ig(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function Fye(e){var t=Ig(e);return t>=57&&t<=71}function Nye(e){var t=Ig(e);return t>=89&&t<=103}function Uye(e){return Dye(e)||Rye(e)||Fye(e)||Nye(e)||Pz(e)||Bye(e)}var Ir;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Ir||(Ir={}));function Dr(e,t,r){var n;r===void 0&&(r={});var a;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Ir.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=$f(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return se(this,void 0,void 0,function(){var u,l;return ie(this,function(c){switch(c.label){case 0:return u=i.managers.structure.selection.getStructure(s),l=u?ot.Sequence(s,[u]):ot.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return a||(a=$f(t)),[2,a(new Co(s,{currentSelection:l}))]}})})}}}var zye=Dr("All",ne.struct.generator.all(),{category:"",priority:1e3}),Vye=Dr("Current Selection",ne.internal.generator.current(),{category:"",referencesCurrent:!0}),Hye=Dr("Polymer",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])])})]),{category:Ir.Type}),Gye=Dr("Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"atom-test":ne.core.set.has([ne.set("CA","P"),ne.ammp("label_atom_id")])})])])]),{category:Ir.Structure}),Um=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ne.ammp("entitySubtype")])]),tx=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])]),ep=ne.core.str.match([ne.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ne.ammp("chemCompType")]),qye=Dr("Backbone",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.set.has([ne.set.apply(ne,Pn.toArray(Rl)),ne.ammp("label_atom_id")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":tx,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.set.has([ne.set.apply(ne,Pn.toArray(gS)),ne.ammp("label_atom_id")])})])])]),{category:Ir.Structure}),jye=Dr("Sidechain",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Pn.toArray(Rl)),ne.ammp("label_atom_id")])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":tx,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Pn.toArray(gS)),ne.ammp("label_atom_id")])])])})])])]),{category:Ir.Structure}),Wye=Dr("Sidechain with Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Pn.toArray(Rl)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"CA"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("auth_comp_id"),"PRO"]),ne.core.rel.eq([ne.ammp("label_atom_id"),"N"])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":tx,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ep]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Pn.toArray(gS)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"P"])])})])])]),{category:Ir.Structure}),Xye=Dr("Protein",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um})]),{category:Ir.Type}),Yye=Dr("Nucleic",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":tx})]),{category:Ir.Type}),Kye=Dr("Helix",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([2])])})]),{category:Ir.Structure,ensureCustomProperties:function(e,t){return ls.attach(e,t)}}),Qye=Dr("Beta Strand/Sheet",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Um,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([4])])})]),{category:Ir.Structure,ensureCustomProperties:function(e,t){return ls.attach(e,t)}}),Zye=Dr("Water",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"water"])})]),{category:Ir.Type}),$ye=Dr("Ion",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"ion"])})]),{category:Ir.Type}),Jye=Dr("Lipid",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"lipid"])})]),{category:Ir.Type}),rx=Dr("Carbohydrate",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"branched"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.str.match([ne.re("oligosaccharide","i"),ne.ammp("entitySubtype")])])])})]),{category:Ir.Type}),Ez=Dr("Carbohydrate with Connected",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:rx.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Ir.Internal,isHidden:!0}),Iz=Dr("Connected to Carbohydrate",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:Ez.expression,by:rx.expression})]),{category:Ir.Internal,isHidden:!0}),CE=Dr("Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.rel.neq([ne.ammp("entityPrdId"),""])]),ne.core.logic.not([ne.core.str.match([ne.re("(oligosaccharide|lipid|ion)","i"),ne.ammp("entitySubtype")])])]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ne.core.str.match([ne.re("saccharide","i"),ne.ammp("chemCompType")])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ep})])])]),by:ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.set.has([ne.set.apply(ne,Pn.toArray(Dm)),ne.ammp("label_comp_id")])})])})]),{category:Ir.Type}),Dz=Dr("Ligand with Connected",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:CE.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([3])])})]),by:rx.expression})]),{category:Ir.Internal,isHidden:!0}),Mz=Dr("Connected to Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:Dz.expression,by:CE.expression})]),{category:Ir.Internal,isHidden:!0}),e1e=Dr("Connected to Ligand or Carbohydrate",ne.struct.modifier.union([ne.struct.combinator.merge([Iz.expression,Mz.expression])]),{category:Ir.Internal,isHidden:!0}),t1e=Dr("Disulfide Bridges",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.bondedAtomicPairs({0:ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([8])])})])])])])]),{category:Ir.Bond}),r1e=Dr("NOS Bridges",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Ir.Bond}),n1e=Dr("Non-standard Residues in Polymers",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.ammp("isNonStandard")})]),{category:Ir.Residue}),a1e=Dr("Coarse Elements",ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),{category:Ir.Type}),i1e=Dr("Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings()]),{category:Ir.Residue}),o1e=Dr("Aromatic Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings({"only-aromatic":!0})]),{category:Ir.Residue}),s1e=Dr("Surrounding Residues (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ne.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:Ir.Manipulate,referencesCurrent:!0}),u1e=Dr("Surrounding Ligands (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.surroundingLigands({0:ne.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:Ir.Manipulate,referencesCurrent:!0}),l1e=Dr("Surrounding Atoms (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:ne.internal.generator.current()})]),{description:"Select atoms within 5 \u212B of the current selection.",category:Ir.Manipulate,referencesCurrent:!0}),c1e=Dr("Inverse / Complement of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.generator.all(),by:ne.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Ir.Manipulate,referencesCurrent:!0}),d1e=Dr("Residues Covalently Bonded to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Ir.Manipulate,referencesCurrent:!0}),f1e=Dr("Covalently Bonded Component",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Ir.Manipulate,referencesCurrent:!0}),p1e=Dr("Residues with Cov. or Metallic Bond to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Ir.Manipulate,referencesCurrent:!0}),v1e=Dr("Whole Residues of Selection",ne.struct.modifier.union([ne.struct.modifier.wholeResidues({0:ne.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Ir.Manipulate,referencesCurrent:!0}),m1e=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),h1e=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function k4(e,t,r){var n=e[0],a=e[1];r===void 0&&(r=0);var i=n.length===1&&!Rz.has(n[0])?"[".concat(n[0],"] ").concat(a):"".concat(a," (").concat(n.join(", "),")");return Dr(i,ne.struct.modifier.union([ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set.apply(ne,n),ne.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}function g1e(e,t,r){var n=e[0],a=e[1],i="".concat(a," (").concat(n.join(", "),")");return Dr(i,ne.struct.modifier.union([ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set.apply(ne,n),ne.acp("elementSymbol")])})]),{category:t,priority:r,description:i})}function y1e(e,t,r){var n=e[0],a=e[1],i="".concat(a);return Dr("".concat(a),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.list.equal([ne.list.apply(ne,n),ne.ammp("entityDescription")])})]),{category:t,priority:r,description:i})}var Rz=Pn.unionMany(TP,Ag,Tg,yS);function b1e(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];a.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var i=[];return t.forEach(function(o){var s=Eye[o]||o;i.push(g1e([[o],s],"Element Symbol",0))}),i}function S1e(e){for(var t=new Map,r=new Set,n=0,a=e;n<a.length;n++){var i=a[n];i.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){i.uniqueResidueNames.forEach(function(f){var p=d.properties.chemicalComponentMap.get(f);p&&t.set(f,p.name)})},s=0,u=i.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return Pn.difference(r,Rz).forEach(function(d){var f=t.get(d)||d;c.push(k4([[d],f],"Ligand/Non-standard Residue",200))}),c}function x1e(e){for(var t=new Map,r=He.create(),n=0,a=e;n<a.length;n++){var i=a[n];r.structure=i;for(var o=0,s=i.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=tt.entity.type(r);if(l==="polymer"||l==="branched"){var c=tt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,p){d.push(y1e([f,p],"Polymer/Carbohydrate Entities",300))}),d}var Hn={all:zye,current:Vye,polymer:Hye,trace:Gye,backbone:qye,sidechain:jye,sidechainWithTrace:Wye,protein:Xye,nucleic:Yye,helix:Kye,beta:Qye,water:Zye,ion:$ye,lipid:Jye,branched:rx,branchedPlusConnected:Ez,branchedConnectedOnly:Iz,ligand:CE,ligandPlusConnected:Dz,ligandConnectedOnly:Mz,connectedOnly:e1e,disulfideBridges:t1e,nosBridges:r1e,nonStandardPolymer:n1e,coarse:a1e,ring:i1e,aromaticRing:o1e,surroundings:s1e,surroundingLigands:u1e,surroundingAtoms:l1e,complement:c1e,covalentlyBonded:d1e,covalentlyOrMetallicBonded:p1e,covalentlyBondedComponent:f1e,wholeResidues:v1e},C1e=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,It(It(It([],Object.values(Hn),!1),m1e.map(function(n){return k4(n,Ir.AminoAcid)}),!1),h1e.map(function(n){return k4(n,Ir.NucleicBase)}),!1)),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),w1e=function(){return{type:E.MappedStatic("static",{static:E.Text("polymer"),expression:E.Value(ne.struct.generator.all),bundle:E.Value(Mr.Empty),script:E.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:E.Optional(E.Boolean(!0,{isHidden:!0})),label:E.Text("",{isHidden:!0})}};function _1e(e,t,r){r.source=e;var n=Ne.Empty,a=void 0;switch(t.type.name){case"static":{var i=void 0;switch(t.type.params){case"all":i=Hn.all.query,a="All";break;case"polymer":i=Hn.polymer.query,a="Polymer";break;case"protein":i=Hn.protein.query,a="Protein";break;case"nucleic":i=Hn.nucleic.query,a="Nucleic";break;case"water":i=Hr.internal.water(),a="Water";break;case"ion":i=Hn.ion.query,a="Ion";break;case"lipid":i=Hn.lipid.query,a="Lipid";break;case"branched":i=Hn.branchedPlusConnected.query,a="Branched";break;case"ligand":i=Hn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=Hn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=Hn.coarse.query,a="Coarse";break;default:throw new Error("".concat(t.type," is a not valid complex element."))}var o=i(new Co(e));n=ot.unionStructure(o);break}case"script":case"expression":{var s=ii.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=ot.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=Mr.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return pn.Null;var c={label:"".concat(t.label||a||"Component"),description:Ne.elementDescription(n)};return new fe.Molecule.Structure(n,c)}function A1e(e,t,r,n,a){if(r.type.name!==n.type.name)return We.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!Ne.areEquivalent(e,a.source)?We.UpdateResult.Recreate:t.data.model===e.model?We.UpdateResult.Unchanged:zt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),We.UpdateResult.Updated):We.UpdateResult.Recreate;case"script":if(!Qn.areEqual(r.type.params,n.type.params))return We.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return We.UpdateResult.Recreate;if(e===a.source)break;var o=a.entry,s=ii.updateStructure(o,e);a.source=e,t.data=ot.unionStructure(s),ii.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===a.source&&Mr.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:Ne.Empty):(i=!0,t.data=Mr.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return We.UpdateResult.Null;t.description=Ne.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label="".concat(n.label||t.label)),i?We.UpdateResult.Updated:We.UpdateResult.Unchanged}function T1e(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return console.error("Value ".concat(e," is outside the 0-7 range, defaulting to 0.")),0}}function Oz(e,t){for(var r=Ke.create(e.data,t*2),n=Ke.create(e.data,t*2),a=Ke.create(e.data,t*2),i=Ke.create(e.data,t*2),o=Ke.create(e.data,t*2),s=0;s<t;++s){it.markLine(e);var u=e.tokenStart,l=e.position;it.trim(e,u,u+10),Ke.addUnchecked(r,e.tokenStart,e.tokenEnd),it.trim(e,u+10,u+20),Ke.addUnchecked(n,e.tokenStart,e.tokenEnd),it.trim(e,u+20,u+30),Ke.addUnchecked(a,e.tokenStart,e.tokenEnd),it.trim(e,u+31,u+34),Ke.addUnchecked(i,e.tokenStart,e.tokenEnd),it.trim(e,u+36,u+39),Ke.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=l}return{count:t,x:ur(r)(ce.Schema.float),y:ur(n)(ce.Schema.float),z:ur(a)(ce.Schema.float),type_symbol:ur(i)(ce.Schema.str),formal_charge:ur(o)(ce.Schema.int)}}function Bz(e,t){for(var r=Ke.create(e.data,t*2),n=Ke.create(e.data,t*2),a=Ke.create(e.data,t*2),i=0;i<t;++i){it.markLine(e);var o=e.tokenStart,s=e.position;it.trim(e,o,o+3),Ke.addUnchecked(r,e.tokenStart,e.tokenEnd),it.trim(e,o+3,o+6),Ke.addUnchecked(n,e.tokenStart,e.tokenEnd),it.trim(e,o+6,o+9),Ke.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:ur(r)(ce.Schema.int),atomIdxB:ur(n)(ce.Schema.int),order:ur(a)(ce.Schema.int)}}function P1e(e,t,r){it.trim(e,t+6,t+9);for(var n=parseInt(it.getTokenString(e)),a=0;a<n;++a){var i=9+a*8;it.trim(e,t+i,t+i+4);var o=it.getTokenString(e);r.atomIdx.push(+o),it.trim(e,t+i+4,t+i+8);var s=it.getTokenString(e);r.charge.push(+s)}it.eatLine(e)}function kz(e){for(var t=[],r=[],n={atomIdx:t,charge:r};e.position<e.length;){var a=e.position;it.trim(e,a+3,a+6);var i=it.getTokenString(e);if(i==="END")break;switch(it.eatLine(e),i){case"CHG":P1e(e,a,n);break}}var o={atomIdx:ce.ofIntArray(n.atomIdx),charge:ce.ofIntArray(n.charge)};return o}function E1e(e){var t=it(e),r=it.readLine(t).trim(),n=it.readLine(t).trim(),a=it.readLine(t).trim(),i=it.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=Oz(t,o),l=Bz(t,s),c=kz(t),d={title:r,program:n,comment:a,atoms:u,bonds:l,formalCharges:c};return dn.success(d)}function I1e(e){var t=this;return Fe.create("Parse Mol",function(){return se(t,void 0,void 0,function(){return ie(this,function(r){return[2,E1e(e)]})})})}function Lz(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,d,f,p,v,m,h,g,y,b,S;return ie(this,function(C){switch(C.label){case 0:if(n=e.atoms,a=e.bonds,i=e.formalCharges,o=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),s=ce.ofConst("A",e.atoms.count,ce.Schema.str),u=ce.asArrayColumn(n.type_symbol),l=ce.ofConst(1,n.count,ce.Schema.int),c=new Int32Array(e.atoms.count),i.atomIdx.rowCount>0)for(d=0;d<i.atomIdx.rowCount;d++)c[i.atomIdx.value(d)-1]=i.charge.value(d);else for(d=0;d<e.atoms.count;d++)c[d]=T1e(n.formal_charge.value(d));return f=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:s,auth_atom_id:u,auth_comp_id:o,auth_seq_id:l,Cartn_x:ce.asArrayColumn(n.x,Float32Array),Cartn_y:ce.asArrayColumn(n.y,Float32Array),Cartn_z:ce.asArrayColumn(n.z,Float32Array),id:ce.range(0,n.count-1),label_asym_id:s,label_atom_id:u,label_comp_id:o,label_seq_id:l,label_entity_id:ce.ofConst("1",n.count,ce.Schema.str),occupancy:ce.ofConst(1,n.count,ce.Schema.float),type_symbol:u,pdbx_PDB_model_num:ce.ofConst(1,n.count,ce.Schema.int),pdbx_formal_charge:ce.ofIntArray(c)},n.count),p=new zd,p.setNames([["MOL","Unknown Entity"]]),p.getEntityId("MOL",0,"A"),v=new Ud(l,u),v.setNames([["MOL","Unknown Molecule"]]),v.add("MOL",0),m=yp({entity:p.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:f}),[4,Yl(m,t!=null?t:L4.create(e),r)];case 1:return h=C.sent(),h.frameCount>0&&(g=ce.ofIntArray(ce.mapToArray(a.atomIdxA,function(x){return x-1},Int32Array)),y=ce.ofIntArray(ce.mapToArray(a.atomIdxB,function(x){return x-1},Int32Array)),b=ce.asArrayColumn(a.order,Int32Array),S=Ka.fromData({pairs:{indexA:g,indexB:y,order:b},count:n.count}),Ka.Provider.set(h.representative,S)),[2,h]}})})}var L4;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(L4||(L4={}));function D1e(e){return Fe.create("Parse MOL",function(t){return Lz(e,void 0,t)})}function M1e(e){var t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):r}function R1e(e){var t=e.cell,r=e.space_group,n=M1e(r),a=Ri.create(n,w.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),w.scale(w(),w.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:ss.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function O1e(e,t,r){var n;return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v,m,h,g,Se,y,b,S,C,x,D,A,Se,P,T,D,Se,I,M,B,U,V,F,Y,W,K,$,Se,J,Z,N,j,L,H,G,q,X,Q,ue,le,ve,ge,Se,ae,re,O,z;return ie(this,function(de){switch(de.label){case 0:for(a=e.atom_site._rowCount,i=ce.ofConst("MOL",a,ce.Schema.str),o=ce.ofConst("A",a,ce.Schema.str),s=ce.ofConst(1,a,ce.Schema.int),u=R1e(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,p=c.fract_z,v=new Float32Array(a),m=new Float32Array(a),h=new Float32Array(a),g=w(),Se=0;Se<a;++Se)w.set(g,d.value(Se),f.value(Se),p.value(Se)),w.transformMat4(g,g,l),v[Se]=g[0],m[Se]=g[1],h[Se]=g[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(D=new Array(a),A=new Int8Array(a),Se=0;Se<a;++Se)P=b.value(Se),T=P.length,P[T-1]==="+"?(D[Se]=P.substring(0,T-2),A[Se]=parseInt(P[T-2])):P[T-2]==="+"?(D[Se]=P.substring(0,T-2),A[Se]=parseInt(P[T-1])):P[T-1]==="-"?(D[Se]=P.substring(0,T-2),A[Se]=-parseInt(P[T-2])):P[T-2]==="-"?(D[Se]=P.substring(0,T-2),A[Se]=-parseInt(P[T-1])):(D[Se]=P,A[Se]=0);C=ce.ofStringArray(D),x=ce.ofIntArray(A)}else{for(D=new Array(a),Se=0;Se<a;++Se)D[Se]=ex(S.value(Se));C=ce.ofStringArray(D),x=ce.Undefined(a,ce.Schema.int)}return I=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:i,auth_seq_id:s,Cartn_x:ce.ofFloatArray(v),Cartn_y:ce.ofFloatArray(m),Cartn_z:ce.ofFloatArray(h),id:ce.range(0,a-1),label_asym_id:o,label_atom_id:S,label_comp_id:i,label_seq_id:s,label_entity_id:ce.ofConst("1",a,ce.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ce.ofConst(1,a,ce.Schema.float),type_symbol:C,pdbx_formal_charge:x,pdbx_PDB_model_num:ce.ofConst(1,a,ce.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},a),M=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),B=new zd,B.setNames([["MOL",M||"Unknown Entity"]]),B.getEntityId("MOL",0,"A"),U=new Ud(s,e.atom_site.type_symbol),U.setNames([["MOL",M||"Unknown Molecule"]]),U.add("MOL",0),V=yp({entity:B.getEntityTable(),chem_comp:U.getChemCompTable(),atom_site:I}),[4,Yl(V,t,r)];case 1:if(F=de.sent(),F.frameCount>0&&(Y=F.representative,kn.Provider.set(Y,u),W=e.geom_bond._rowCount,W>0)){for(K={},$=e.atom_site.label,Se=0,J=$.rowCount;Se<J;++Se)K[$.value(Se)]=Se;for(Z=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),N=[],j=[],L=[],H=[],G=[],q=new Set,X=0,Q=e.geom_bond,ue=Q.atom_site_label_1,le=Q.atom_site_label_2,ve=Q.valence,ge=Q.distance,Se=0;Se<W;++Se)ae=K[ue.value(Se)],re=K[le.value(Se)],O=ae<re?Jo(ae,re):Jo(re,ae),!q.has(O)&&(q.add(O),N[X]=ae,j[X]=re,H[X]=ge.value(Se)||-1,Z?(z=Z.str(Se),z==="D"?(L[X]=2,G[X]=1):z==="A"?(L[X]=1,G[X]=17):(L[X]=1,G[X]=1)):(G[X]=1,L[X]=ve.isDefined?ve.value(Se):1),X+=1);Ka.Provider.set(Y,Ka.fromData({pairs:{indexA:ce.ofIntArray(N),indexB:ce.ofIntArray(j),order:ce.ofIntArray(L),distance:ce.ofFloatArray(H),flag:ce.ofIntArray(G)},count:a}))}return[2,F]}})})}function B1e(e){if(!!ug.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,a=kr.ofPartialColumns(Mu.Schema,{U:n.u},n._rowCount),i=Mu.getElementToAnsiotropFromLabel(r.label,n.label);return{data:a,elementToAnsiotrop:i}}}function k1e(e){return ug.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}Mu.Provider.formatRegistry.add("cifCore",B1e,k1e);var ug;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,a){a||(a=Ol.schema.cifCore(n));var i=a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.icsd.value(0)||a.database_code.mdf.value(0)||a.database_code.nbs.value(0)||a.database_code.csd.value(0)||a.database_code.cod.value(0)||a._name;return{kind:"cifCore",name:i,data:{db:a,frame:n}}}e.fromFrame=r})(ug||(ug={}));function L1e(e){var t=ug.fromFrame(e);return Fe.create("Parse CIF Core",function(r){return O1e(t.data.db,t,r)})}function F1e(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),a=ce.ofConst("A",e.atoms.count,ce.Schema.str),i=ce.ofArray({array:ce.mapToArray(r.number,function(f){return jJ(f)}),schema:ce.Schema.Aliased(ce.Schema.str)}),o=ce.ofConst(1,r.count,ce.Schema.int),s=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ce.asArrayColumn(r.x,Float32Array),Cartn_y:ce.asArrayColumn(r.y,Float32Array),Cartn_z:ce.asArrayColumn(r.z,Float32Array),id:ce.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ce.ofConst("1",r.count,ce.Schema.str),occupancy:ce.ofConst(1,r.count,ce.Schema.float),type_symbol:i,pdbx_PDB_model_num:ce.ofConst(1,r.count,ce.Schema.int)},r.count),u=new zd,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new Ud(o,i),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=yp({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,Yl(c,F4.create(e),t)];case 1:return[2,d.sent()]}})})}var F4;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(F4||(F4={}));function N1e(e){return Fe.create("Parse Cube",function(t){return F1e(e,t)})}var wE=it.skipWhitespace,Fz=it.eatValue,Vo=it.markLine,Ho=it.getTokenString,Nz=it.readLine;function U1e(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function z1e(e,t){return{tokenizer:e,molecule:U1e(),runtimeCtx:t}}var Uz=/\s+/g;function V1e(e){for(var t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Vo(t);Vo(t),r.mol_name=Ho(t),Vo(t);var n=Ho(t).trim().split(Uz);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Vo(t);var a=Ho(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,Vo(t);var i=Ho(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,Vo(t);var o=Ho(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Vo(t);var s=Ho(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function H1e(e){return se(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A;return ie(this,function(P){switch(P.label){case 0:for(t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Vo(t);return n=t.position,a=t.lineNumber,i=Nz(t),o=i.trim().split(/\s+/g),s=o.length,u=Ke.create(t.data,r.num_atoms*2),l=Ke.create(t.data,r.num_atoms*2),c=Ke.create(t.data,r.num_atoms*2),d=Ke.create(t.data,r.num_atoms*2),f=Ke.create(t.data,r.num_atoms*2),p=Ke.create(t.data,r.num_atoms*2),v=Ke.create(t.data,r.num_atoms*2),m=Ke.create(t.data,r.num_atoms*2),h=Ke.create(t.data,r.num_atoms*2),g=Ke.create(t.data,r.num_atoms*2),y=ce.Undefined(r.num_atoms,ce.Schema.float),b=ce.Undefined(r.num_atoms,ce.Schema.int),S=ce.Undefined(r.num_atoms,ce.Schema.str),t.position=n,t.lineNumber=a,C=t.length,x=0,[4,Pl(e.runtimeCtx,1e5,void 0,function(T){for(var D=Math.min(r.num_atoms-x,T),I=0;I<D;I++)for(var M=0;M<s;M++)switch(wE(t),t.tokenStart=t.position,Fz(t),M){case 0:Ke.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Ke.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:Ke.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:Ke.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:Ke.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:Ke.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:Ke.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 7:Ke.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 8:Ke.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 9:Ke.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return x+=D,D},function(T){return T.update({message:"Parsing...",current:t.position,max:C})})];case 1:return P.sent(),A={count:r.num_atoms,atom_id:ur(u)(ce.Schema.int),atom_name:ur(l)(ce.Schema.str),x:ur(c)(ce.Schema.float),y:ur(d)(ce.Schema.float),z:ur(f)(ce.Schema.float),atom_type:s>5?ur(p)(ce.Schema.str):S,subst_id:s>6?ur(v)(ce.Schema.int):b,subst_name:s>7?ur(m)(ce.Schema.str):S,charge:s>8?ur(h)(ce.Schema.float):y,status_bit:s>9?ur(g)(ce.Schema.str):S},[2,A]}})})}function G1e(e){return se(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:for(t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Vo(t);return n=t.position,a=t.lineNumber,i=Nz(t),o=i.trim().split(/\s+/g),s=o.length,u=Ke.create(t.data,r.num_bonds*2),l=Ke.create(t.data,r.num_bonds*2),c=Ke.create(t.data,r.num_bonds*2),d=Ke.create(t.data,r.num_bonds*2),f=Ke.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=a,p=t.length,v=0,[4,Pl(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-v,g),b=0;b<y;b++)for(var S=0;S<s;S++)switch(wE(t),t.tokenStart=t.position,Fz(t),S){case 0:Ke.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:Ke.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:Ke.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:Ke.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:Ke.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return v+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return h.sent(),m={count:r.num_bonds,bond_id:ur(u)(ce.Schema.int),origin_atom_id:ur(l)(ce.Schema.int),target_atom_id:ur(c)(ce.Schema.int),bond_type:ur(d)(ce.Schema.str),status_bits:s>4?ur(f)(ce.Schema.str):ce.Undefined(r.num_bonds,ce.Schema.str)},[2,m]}})})}function q1e(e){for(var t=e.tokenizer;t.position<t.data.length;){var r=Ho(t);if(r==="@<TRIPOS>MOLECULE")return;if(r==="@<TRIPOS>CRYSIN")break;Vo(t)}if(!(t.position>=t.data.length)){Vo(t);var n=Ho(t).trim().split(Uz);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}}function j1e(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:n=it(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],c.label=1;case 1:return n.position<t.length?(i=z1e(n,e),V1e(i),[4,H1e(i)]):[3,4];case 2:return o=c.sent(),[4,G1e(i)];case 3:for(s=c.sent(),u=q1e(i),a.push({molecule:i.molecule,atoms:o,bonds:s,crysin:u}),wE(n);Ho(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Vo(n);return[3,1];case 4:return l={name:r,structures:a},[2,dn.success(l)]}})})}function W1e(e,t){var r=this;return Fe.create("Parse MOL2",function(n){return se(r,void 0,void 0,function(){return ie(this,function(a){switch(a.label){case 0:return[4,j1e(n,e,t)];case 1:return[2,a.sent()]}})})})}function X1e(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B;return ie(this,function(U){switch(U.label){case 0:r=[],n=0,a=e.structures.length,U.label=1;case 1:if(!(n<a))return[3,4];for(i=e.structures[n],o=i.molecule,s=i.atoms,u=i.bonds,l=i.crysin,c=ce.ofConst("A",s.count,ce.Schema.str),d=new Array(s.count),f=!1,p=0;p<s.count;++p)if(s.atom_type.value(p).includes(".")){f=!0;break}for(v=0;v<s.count;++v)d[v]=f?s.atom_type.value(v).split(".")[0].toUpperCase():ex(s.atom_name.value(v));for(m=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:c,auth_atom_id:ce.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ce.asArrayColumn(s.x,Float32Array),Cartn_y:ce.asArrayColumn(s.y,Float32Array),Cartn_z:ce.asArrayColumn(s.z,Float32Array),id:ce.asArrayColumn(s.atom_id),label_asym_id:c,label_atom_id:ce.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ce.ofConst("1",s.count,ce.Schema.str),occupancy:ce.ofConst(1,s.count,ce.Schema.float),type_symbol:ce.ofStringArray(d),pdbx_PDB_model_num:ce.ofConst(n,s.count,ce.Schema.int)},s.count),h=new zd,h.setNames([["MOL",o.mol_name||"Unknown Entity"]]),h.getEntityId("MOL",0,"A"),g=new Ud(s.subst_id,s.atom_name),y=0,b=s.subst_name.rowCount;y<b;++y)g.add(s.subst_name.value(y),y);return S=yp({entity:h.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:m}),[4,Yl(S,N4.create(e),t)];case 2:C=U.sent(),C.frameCount>0&&(x=ce.ofIntArray(ce.mapToArray(u.origin_atom_id,function(V){return V-1},Int32Array)),A=ce.ofIntArray(ce.mapToArray(u.target_atom_id,function(V){return V-1},Int32Array)),P=u.bond_id,T=ce.ofIntArray(ce.mapToArray(u.bond_type,function(V){switch(V){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(V)}},Int8Array)),D=ce.ofIntArray(ce.mapToArray(u.bond_type,function(V){switch(V){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),I=Ka.fromData({pairs:{key:P,indexA:x,indexB:A,order:T,flag:D},count:s.count}),M=C.representative,Ka.Provider.set(M,I),sm.Provider.set(M,{data:s.charge,type:o.charge_type}),l&&(B=Y1e(l),B&&kn.Provider.set(M,B)),r.push(M)),U.label=3;case 3:return++n,[3,1];case 4:return[2,new Yf(r)]}})})}function Y1e(e){if(e.setting===1){var t=Ri.create(e.spaceGroup,w.create(e.a,e.b,e.c),w.scale(w(),w.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:ss.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}}var N4;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(N4||(N4={}));function K1e(e){return Fe.create("Parse MOL2",function(t){return X1e(e,t)})}var Yp=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),g3=9,Hi;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,p=0;r[0]=1;for(var v=0;v<c;v++){var m=void 0,h=0;for(m=0;m<f;m++)h+=r[m]*d[v],r[m]=h&255,h>>=8;for(;h!==0;)r[m++]=h&255,h>>=8;f=m}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+f*8}e.sizeOfInts=n;var a=new ArrayBuffer(8*3);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(c,d,f){for(var p=f,v=(1<<p)-1,m=i[1],h=i[2],g=e.buf[0],y=0;p>=8;)h=h<<8|c[d+g++],y|=h>>m<<p-8,p-=8;return p>0&&(m<p&&(m+=8,h=h<<8|c[d+g++]),m-=p,y|=h>>m&(1<<p)-1),y&=v,e.buf[0]=g,e.buf[1]=m,e.buf[2]=h,y}e.decodeBits=o;function s(c,d){var f=i[2],p=e.buf[0];return f=f<<8|c[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>i[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,p,v){var m=f,h=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;m>8;)u[h++]=s(c,d),m-=8;m>0&&(u[h++]=o(c,d,m));for(var g=2;g>0;g--){for(var y=0,b=p[g],S=h-1;S>=0;S--){y=y<<8|u[S];var C=y/b|0;u[S]=C,y=y-C*b}v[g]=y}v[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(Hi||(Hi={}));function Q1e(){throw new Error("(xdrfile error) Undefined error.")}function Z1e(e,t){return se(this,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,B,B,y,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y,W;return ie(this,function(K){switch(K.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},a=n.frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,v=Hi.buf,K.label=1;case 1:for(m=void 0,h=r.getInt32(p+4),p+=12,o.push(r.getFloat32(p)),p+=4,g=new Float32Array(9),B=0;B<9;++B)g[B]=r.getFloat32(p)*10,p+=4;if(i.push(g),h<=9)for(m={count:h/3,x:new Float32Array(h/3),y:new Float32Array(h/3),z:new Float32Array(h/3)},B=0;B<h/3;++B)m.x[B]=r.getFloat32(p),m.y[B]=r.getFloat32(p),m.z[B]=r.getFloat32(p),p+=4;else{for(v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,m={count:h,x:new Float32Array(h),y:new Float32Array(h),z:new Float32Array(h)},y=0,b=r.getInt32(p),p+=4,S=r.getFloat32(p),p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,C=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=Hi.sizeOfInt(u[0]),l[1]=Hi.sizeOfInt(u[1]),l[2]=Hi.sizeOfInt(u[2]),C=0):C=Hi.sizeOfInts(3,u),x=r.getInt32(p),p+=4,A=x-1,A=g3>A?g3:A,P=Yp[A]/2|0,T=Yp[x]/2|0,c[0]=c[1]=c[2]=Yp[x],D=Math.ceil(r.getInt32(p)/4)*4,p+=4,I=1/S,M=0,B=0,d[0]=d[1]=d[2]=0;B<b;){if(C===0?(d[0]=Hi.decodeBits(t,p,l[0]),d[1]=Hi.decodeBits(t,p,l[1]),d[2]=Hi.decodeBits(t,p,l[2])):Hi.decodeInts(t,p,C,u,d),B++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],U=Hi.decodeBits(t,p,1),V=0,U===1&&(M=Hi.decodeBits(t,p,5),V=M%3,M-=V,V--),M>0)for(d[0]=d[1]=d[2]=0,F=0;F<M;F+=3)Hi.decodeInts(t,p,x,c,d),B++,d[0]+=f[0]-T,d[1]+=f[1]-T,d[2]+=f[2]-T,F===0?(Y=d[0],d[0]=f[0],f[0]=Y,Y=d[1],d[1]=f[1],f[1]=Y,Y=d[2],d[2]=f[2],f[2]=Y,m.x[y]=f[0]*I,m.y[y]=f[1]*I,m.z[y]=f[2]*I,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),m.x[y]=d[0]*I,m.y[y]=d[1]*I,m.z[y]=d[2]*I,y++;else m.x[y]=d[0]*I,m.y[y]=d[1]*I,m.z[y]=d[2]*I,y++;x+=V,V<0?(T=P,x>g3?P=Yp[x-1]/2|0:P=0):V>0&&(P=T,T=Yp[x]/2|0),c[0]=c[1]=c[2]=Yp[x],(c[0]===0||c[1]===0||c[2]===0)&&Q1e()}p+=D}for(W=0;W<h;W++)m.x[W]*=10,m.y[W]*=10,m.z[W]*=10;return a.push(m),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:K.sent(),K.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function $1e(e){var t=this;return Fe.create("Parse XTC",function(r){return se(t,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,Z1e(r,e)];case 1:return n=i.sent(),[2,dn.success(n)];case 2:return a=i.sent(),[2,dn.error(""+a)];case 3:return[2]}})})})}function J1e(e){var t=this;return Fe.create("Parse XTC",function(r){return se(t,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=kc(e.deltaTime,"step"),a=kc(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=w.fromArray(w(),u,0),c=w.fromArray(w(),u,3),d=w.fromArray(w(),u,6),i.push({elementCount:e.frames[o].count,cell:Lf.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:kc(a.value+n.value*o,n.unit)});return[2,$0.create(i,n,a)]}})})})}function ebe(e){var t=e.position>=e.data.length-1?0:+it.readLine(e);isNaN(t)&&(t=0);for(var r=it.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=it.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],a[s]=+l[2],i[s]=+l[3]}return{count:t,comment:r,x:ce.ofFloatArray(n),y:ce.ofFloatArray(a),z:ce.ofFloatArray(i),type_symbol:ce.ofStringArray(o)}}function tbe(e){for(var t=it(e),r=[];;){var n=ebe(t);if(n.count===0)break;r.push(n)}var a={molecules:r};return dn.success(a)}function rbe(e){var t=this;return Fe.create("Parse Mol",function(){return se(t,void 0,void 0,function(){return ie(this,function(r){return[2,tbe(e)]})})})}function nbe(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++){var o=i[a];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,v=0;v<r.length;v++)for(var o=r[v],m=0;m<o.count;m++)s[p]=o.type_symbol.value(m),l[p]=o.x.value(m),c[p]=o.y.value(m),d[p]=o.z.value(m),u[p]=m,f[p]=v,p++;var h=ce.ofConst("MOL",n,ce.Schema.str),g=ce.ofConst("A",n,ce.Schema.str),y=ce.ofConst(1,n,ce.Schema.int),b=ce.ofStringArray(s),S=kr.ofPartialColumns(Pi.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:h,auth_seq_id:y,Cartn_x:ce.ofFloatArray(l),Cartn_y:ce.ofFloatArray(c),Cartn_z:ce.ofFloatArray(d),id:ce.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:h,label_seq_id:y,label_entity_id:ce.ofConst("1",n,ce.Schema.str),occupancy:ce.ofConst(1,n,ce.Schema.float),type_symbol:b,pdbx_PDB_model_num:ce.ofIntArray(f)},n),C=new zd;C.setNames([["MOL","Unknown Entity"]]),C.getEntityId("MOL",0,"A");var x=new Ud(y,b);x.setNames([["MOL","Unknown Molecule"]]),x.add("MOL",0);var A=yp({entity:C.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:S});return Yl(A,U4.create(e),t)}var U4;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(U4||(U4={}));function abe(e){return Fe.create("Parse XYZ",function(t){return nbe(e,t)})}function ibe(e){return e.trim().endsWith("V3000")}function obe(e){var t=Ke.create(e.data,1),r=Ke.create(e.data,1);return it.eatLine(e),Cl(e),Cl(e),Cl(e),vl(e,t),vl(e,r),it.eatLine(e),{atomCount:ur(t)(ce.Schema.int).value(0),bondCount:ur(r)(ce.Schema.int).value(0)}}function sbe(e,t){for(var r=Ke.create(e.data,t*2),n=Ke.create(e.data,t*2),a=Ke.create(e.data,t*2),i=Ke.create(e.data,t*2),o=0;o<t;++o){it.markLine(e),Cl(e),Cl(e),Cl(e);var s=e.position;vl(e,i),vl(e,r),vl(e,n),vl(e,a),e.position=s}return it.eatLine(e),it.eatLine(e),{count:t,x:ur(r)(ce.Schema.float),y:ur(n)(ce.Schema.float),z:ur(a)(ce.Schema.float),type_symbol:ur(i)(ce.Schema.str),formal_charge:ce.ofConst(0,t,ce.Schema.int)}}function ube(e,t){for(var r=Ke.create(e.data,t*2),n=Ke.create(e.data,t*2),a=Ke.create(e.data,t*2),i=0;i<t;++i){it.markLine(e),Cl(e),Cl(e),Cl(e);var o=e.position;vl(e,a),vl(e,r),vl(e,n),e.position=o}return it.eatLine(e),it.eatLine(e),{count:t,atomIdxA:ur(r)(ce.Schema.float),atomIdxB:ur(n)(ce.Schema.float),order:ur(a)(ce.Schema.float)}}function Cl(e){it.skipWhitespace(e),it.eatValue(e)}function vl(e,t){var r=e.position;it.skipWhitespace(e),it.eatValue(e),it.trim(e,r,e.position),Ke.addUnchecked(t,e.tokenStart,e.tokenEnd)}var z4="$$$$";function lbe(e){for(var t=Ke.create(e.data,32),r=Ke.create(e.data,32);e.position<e.length;){var n=it.readLine(e);if(n.startsWith(z4))break;if(!!n&&n.startsWith("> ")){Ke.add(t,e.tokenStart+2,e.tokenEnd),it.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=it.readLine(e);if(!s||s.startsWith(z4)||s.startsWith("> ")){Ke.add(r,a,i),o=!0;break}i=e.tokenEnd}o||Ke.add(r,a,i)}}return{dataHeader:ur(t)(ce.Schema.str),data:ur(r)(ce.Schema.str)}}function cbe(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function dbe(e){var t=it.readLine(e).trim(),r=it.readLine(e).trim(),n=it.readLine(e).trim(),a=it.readLine(e),i=ibe(a),o=i?obe(e):cbe(a),s=o.atomCount,u=o.bondCount;if(Number.isNaN(s)||Number.isNaN(u)){for(;e.position<e.length;){var l=it.readLine(e);if(l.startsWith(z4))break}return}var c={atomIdx:ce.ofConst(0,s,ce.Schema.int),charge:ce.ofConst(0,s,ce.Schema.int)},d=i?sbe(e,s):Oz(e,s),f=i?ube(e,u):Bz(e,u),p=i?c:kz(e),v=lbe(e);return{molFile:{title:t,program:r,comment:n,atoms:d,bonds:f,formalCharges:p},dataItems:v}}function fbe(e){for(var t=it(e),r=[];t.position<t.length;){var n=dbe(t);n&&r.push(n)}return dn.success({compounds:r})}function pbe(e){var t=this;return Fe.create("Parse Sdf",function(){return se(t,void 0,void 0,function(){return ie(this,function(r){return[2,fbe(e)]})})})}var V4;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(V4||(V4={}));function vbe(e){return Fe.create("Parse SDF",function(t){return Lz(e.molFile,V4.create(e),t)})}var mbe=_t.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse DCD",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,Bge(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,Jge(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new fe.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),hbe=_t.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse XTC",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,$1e(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,J1e(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new fe.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),gbe=_t.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[fe.Format.Psf],to:fe.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Fe.create("Create Topology",function(n){return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,Pye(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new fe.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function ybe(e,t,r){return se(this,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return t.type!==fe.Molecule.Topology.type?[3,2]:(n=t.data,[4,zt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,i.sent()];case 2:if(t.type===fe.Molecule.Model.type)return a=t.data,[2,zt.trajectoryFromModelAndCoordinates(a,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var zz=_t.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:fe.Root,to:fe.Molecule.Trajectory,params:{modelRef:E.Text("",{isHidden:!0}),coordinatesRef:E.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return Fe.create("Create trajectory from model/topology and coordinates",function(a){return se(t,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return i=n[r.coordinatesRef].data,[4,ybe(a,n[r.modelRef],i)];case 1:return o=u.sent(),s={label:"Trajectory",description:"".concat(o.frameCount," model").concat(o.frameCount===1?"":"s")},[2,new fe.Molecule.Trajectory(o,s)]}})})})}}),bbe=_t.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:fe.Format.Blob,to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse Format Blob",function(n){return se(t,void 0,void 0,function(){var a,i,o,s,u,l,d,c,d,f;return ie(this,function(p){switch(p.label){case 0:a=[],i=0,o=r.data,p.label=1;case 1:return i<o.length?(s=o[i],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,T7(u).runInContext(n)])):[3,7];case 2:if(l=p.sent(),l.frameCount===0)throw new Error("No models found.");d=0,p.label=3;case 3:return d<l.frameCount?[4,Fe.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=p.sent(),a.push(c),p.label=5;case 5:return d++,[3,3];case 6:return i++,[3,1];case 7:for(d=0;d<a.length;d++)zt.TrajectoryInfo.set(a[d],{index:d,size:a.length});return f={label:"Trajectory",description:"".concat(a.length," model").concat(a.length===1?"":"s")},[2,new fe.Molecule.Trajectory(new Yf(a),f)]}})})})}});function sc(e){var t=e.representative;return{label:"".concat(t.entry),description:"".concat(e.frameCount," model").concat(e.frameCount===1?"":"s")}}var Sbe=_t.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Parse mmCIF",function(a){return se(t,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return[4,T7(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=sc(s),[2,new fe.Molecule.Trajectory(s,u)]}})})})}}),xbe=_t.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory,params:{isPdbqt:E.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Parse PDB",function(a){return se(t,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return[4,jge(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if(i=u.sent(),i.isError)throw new Error(i.message);return[4,Aye(i.result).runInContext(a)];case 2:return o=u.sent(),s=sc(o),[2,new fe.Molecule.Trajectory(o,s)]}})})})}}),Cbe=_t.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse GRO",function(n){return se(t,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return[4,qge(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,sye(a.result).runInContext(n)];case 2:return i=s.sent(),o=sc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),wbe=_t.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse XYZ",function(n){return se(t,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return[4,rbe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,abe(a.result).runInContext(n)];case 2:return i=s.sent(),o=sc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),_be=_t.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse MOL",function(n){return se(t,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return[4,I1e(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,D1e(a.result).runInContext(n)];case 2:return i=s.sent(),o=sc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),Abe=_t.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse SDF",function(n){return se(t,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return[4,pbe(r.data).runInContext(n)];case 1:if(a=m.sent(),a.isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,m.label=2;case 2:return o<s.length?(u=s[o],[4,vbe(u).runInContext(n)]):[3,8];case 3:l=m.sent(),c=0,m.label=4;case 4:return c<l.frameCount?(f=(d=i).push,[4,Fe.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[m.sent()]),m.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return p=new Yf(i),v=sc(p),[2,new fe.Molecule.Trajectory(p,v)]}})})})}}),Tbe=_t.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse MOL2",function(n){return se(t,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return[4,W1e(r.data,r.label).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,K1e(a.result).runInContext(n)];case 2:return i=s.sent(),o=sc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),Pbe=_t.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:fe.Format.Cube,to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse MOL",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,N1e(r.data).runInContext(n)];case 1:return a=o.sent(),i=sc(a),[2,new fe.Molecule.Trajectory(a,i)]}})})})}}),Ebe=_t.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Parse CIF Core",function(a){return se(t,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){switch(l.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return[4,L1e(o).runInContext(a)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=sc(s),[2,new fe.Molecule.Trajectory(s,u)]}})})})}}),Ibe=function(e){return e+1},Dbe=function(e){return e-1},Mbe=_t.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Model,params:function(e){return e?{modelIndex:E.Converted(Ibe,Dbe,E.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:E.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Model from Trajectory",function(a){return se(t,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){switch(l.label){case 0:return i=n.modelIndex%r.data.frameCount,i<0&&(i+=r.data.frameCount),[4,Fe.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=l.sent(),s="Model ".concat(i+1),u=r.data.frameCount===1?void 0:"of ".concat(r.data.frameCount),[2,new fe.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Rbe=_t.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return Fe.create("Build Structure",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,Ne.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:Ne.elementDescription(a)},[2,new fe.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Obe=_t.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:fe.Molecule.Model,to:fe.Molecule.Structure,params:function(e){return Ff.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return Ff.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Build Structure",function(i){return se(r,void 0,void 0,function(){return ie(this,function(o){return[2,Ff.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams;return Al(n,a)?r.data.model===t.data?We.UpdateResult.Unchanged:zt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),We.UpdateResult.Updated):We.UpdateResult.Recreate:We.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),gO=w(),yO=oe(),bO=oe(),Bbe=_t.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{transform:E.MappedStatic("components",{components:E.Group({axis:E.Vec3(w.create(1,0,0)),angle:E.Numeric(0,{min:-180,max:180,step:.1}),translation:E.Vec3(w.create(0,0,0))},{isFlat:!0}),matrix:E.Group({data:E.Mat4(oe.identity()),transpose:E.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=oe();if(r.transform.name==="components"){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;oe.fromTranslation(yO,w.negate(gO,u)),oe.fromTranslation(bO,w.add(gO,u,s));var l=oe.fromRotation(oe(),Math.PI/180*o,w.normalize(w(),i));oe.mul3(n,bO,l,yO)}else r.transform.name==="matrix"&&(oe.copy(n,r.transform.params.data),r.transform.params.transpose&&oe.transpose(n,n));var c=Ne.transform(t.data,n);return new fe.Molecule.Structure(c,{label:t.label,description:"".concat(t.description," [Transformed]")})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),kbe=_t.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{expression:E.Value(ne.struct.generator.all,{isHidden:!0}),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=ii.createAndRun(t.data,r.expression),i=a.selection,o=a.entry;if(n.entry=o,ot.isEmpty(i))return pn.Null;var s=ot.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ne.elementDescription(s)};return new fe.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(n.expression!==a.expression)return We.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return We.UpdateResult.Unchanged;var s=ii.updateStructure(o,t.data);return ot.isEmpty(s)?We.UpdateResult.Null:(ii.updateStructureObject(r,s,a.label),We.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Lbe=_t.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:fe.Root,to:fe.Molecule.Structure.Selections,params:function(){return{selections:E.ObjectList({key:E.Text(void 0,{description:"A unique key."}),ref:E.Text(),groupId:E.Optional(E.Text()),expression:E.Value(ne.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:E.Optional(E.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=ii.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;a.set(l.key,f);var p=ot.toLociWithSourceUnits(d);i.push({key:l.key,loci:p,groupId:l.groupId}),o+=xe.size(p)}r.entries=a;var v={label:"".concat(t.label||"Multi-selection"),description:"".concat(t.selections.length," source(s), ").concat(o," element(s) total")};return new fe.Molecule.Structure.Selections(i,v)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,a=e.cache,i=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return We.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,p=0,v=[],m=0,h=n.selections;m<h.length;m++){var g=h[m],y=i[g.ref].data,b=!1;if(o.has(g.key)){var S=o.get(g.key);if(ii.isUnchanged(S,g.expression,y)&&u.has(g.key)){var C=u.get(g.key);C.groupId!==g.groupId&&(C.groupId=g.groupId,f=!0),s.set(g.key,S),v.push(C),p+=xe.size(C.loci);continue}if(S.expression!==g.expression)b=!0;else{var x=!1;if(n.isTransitive)if(Ne.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var A=ii.run(S,S.originalStructure);S.currentStructure=y,s.set(g.key,S);var C=xe.remap(ot.toLociWithSourceUnits(A),y);v.push({key:g.key,loci:C,groupId:g.groupId}),p+=xe.size(C),f=!0}else x=!0;else x=!0;if(x){f=!0;var A=ii.updateStructure(S,y);s.set(g.key,S);var C=ot.toLociWithSourceUnits(A);v.push({key:g.key,loci:C,groupId:g.groupId}),p+=xe.size(C)}}}else b=!0;if(b){f=!0;var P=ii.createAndRun(y,g.expression),A=P.selection,S=P.entry;s.set(g.key,S);var C=ot.toLociWithSourceUnits(A);v.push({key:g.key,loci:C}),p+=xe.size(C)}}return f?(a.entries=s,t.data=v,t.label="".concat(n.label||"Multi-selection"),t.description="".concat(v.length," source(s), ").concat(p," element(s) total"),We.UpdateResult.Updated):We.UpdateResult.Unchanged}}),Fbe=_t.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{script:E.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:E.Optional(E.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=ii.createAndRun(t.data,r.script),i=a.selection,o=a.entry;n.entry=o;var s=ot.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:Ne.elementDescription(s)};return new fe.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Qn.areEqual(n.script,a.script))return We.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return We.UpdateResult.Unchanged;var s=ii.updateStructure(o,t.data);return ii.updateStructureObject(r,s,a.label),We.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Nbe=_t.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{bundle:E.Value(Mr.Empty,{isHidden:!0}),label:E.Optional(E.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return pn.Null;n.source=t.data;var a=Mr.toStructure(r.bundle,t.data);if(a.elementCount===0)return pn.Null;var i={label:"".concat(r.label||"Selection"),description:Ne.elementDescription(a)};return new fe.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Mr.areEqual(n.bundle,a.bundle))return We.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return We.UpdateResult.Null;if(i.source===t.data)return We.UpdateResult.Unchanged;i.source=t.data;var o=Mr.toStructure(a.bundle,t.data);return o.elementCount===0?We.UpdateResult.Null:(r.label="".concat(a.label||"Selection"),r.description=Ne.elementDescription(o),r.data=o,We.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Vz={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Ube=E.objectToOptions(Vz),zbe=_t.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{type:E.Select("atomic-sequence",Ube,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,a;switch(r.type){case"polymer":n=Hn.polymer.query,a="Polymer";break;case"protein":n=Hn.protein.query,a="Protein";break;case"nucleic":n=Hn.nucleic.query,a="Nucleic";break;case"water":n=Hr.internal.water(),a="Water";break;case"branched":n=Hn.branchedPlusConnected.query,a="Branched";break;case"ligand":n=Hn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=Hn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=Hn.coarse.query,a="Coarse";break;case"atomic-sequence":n=Hr.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=Hr.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=Hr.internal.spheres(),a="Coarse Spheres";break;default:throw new Error("".concat(r.type," is a not valid complex element."))}var i=n(new Co(t.data)),o=ot.unionStructure(i);return o.elementCount===0?pn.Null:new fe.Molecule.Structure(o,{label:a,description:Ne.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Vbe=_t.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:w1e})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return _1e(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;return A1e(t.data,r,n,a,i)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Hz=_t.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:fe.Molecule.Model,to:fe.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Custom Props",function(i){return se(r,void 0,void 0,function(){return ie(this,function(o){switch(o.label){case 0:return[4,SO(n.data,t,i,a)];case 1:return o.sent(),[2,new fe.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Fe.create("Custom Props",function(s){return se(r,void 0,void 0,function(){var u,l,c,d;return ie(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),!!d&&n.data.customProperties.reference(d.descriptor,!1);return[4,SO(n.data,t,s,o)];case 1:return f.sent(),[2,We.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function SO(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '".concat(l,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var Gz=_t.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Fe.create("Custom Props",function(i){return se(r,void 0,void 0,function(){return ie(this,function(o){switch(o.label){case 0:return[4,xO(n.data.root,t,i,a)];case 1:return o.sent(),[2,new fe.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?We.UpdateResult.Recreate:Fe.create("Custom Props",function(s){return se(r,void 0,void 0,function(){var u,l,c,d;return ie(this,function(f){switch(f.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,l=i.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),!!d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,xO(n.data.root,t,s,o)];case 1:return f.sent(),[2,We.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function xO(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(i.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(a,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '".concat(l,"': ").concat(f)),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var Hbe=_t.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:fe.Format.Ply,to:fe.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,Fe.create("Create shape from PLY",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,Zge(r.data).runInContext(n)];case 1:return a=o.sent(),i={label:"Shape"},[2,new fe.Shape.Provider(a,i)]}})})})}}),Gbe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",CoordinatesFromDcd:mbe,CoordinatesFromXtc:hbe,TopologyFromPsf:gbe,TrajectoryFromModelAndCoordinates:zz,TrajectoryFromBlob:bbe,TrajectoryFromMmCif:Sbe,TrajectoryFromPDB:xbe,TrajectoryFromGRO:Cbe,TrajectoryFromXYZ:wbe,TrajectoryFromMOL:_be,TrajectoryFromSDF:Abe,TrajectoryFromMOL2:Tbe,TrajectoryFromCube:Pbe,TrajectoryFromCifCore:Ebe,ModelFromTrajectory:Mbe,StructureFromTrajectory:Rbe,StructureFromModel:Obe,TransformStructureConformation:Bbe,StructureSelectionFromExpression:kbe,MultiStructureSelectionFromExpression:Lbe,StructureSelectionFromScript:Fbe,StructureSelectionFromBundle:Nbe,StructureComplexElement:zbe,StructureComponent:Vbe,CustomModelProperties:Hz,CustomStructureProperties:Gz,ShapeFromPly:Hbe,StructureComplexElementTypes:Vz});function qbe(e){return e.originX===0&&e.originY===0&&e.originZ===0?w.create(e.NCSTART,e.NRSTART,e.NSSTART):w.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function jbe(e){var t=hz(e);switch(t){case qa.Float32:return Float32Array;case qa.Int8:return Int8Array;case qa.Int16:return Int16Array;case qa.Uint16:return Uint16Array}throw Error("".concat(t," is not a supported value format."))}function Wbe(e,t){var r=this;return Fe.create("Create Volume",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S;return ie(this,function(C){return a=e.header,i=e.values,o=w.create(a.xLength,a.yLength,a.zLength),t&&t.voxelSize&&w.mul(o,o,t.voxelSize),s=w.create(wr(a.alpha),wr(a.beta),wr(a.gamma)),u=a.ISPG>65536?0:a.ISPG,l=Ri.create(u||"P 1",o,s),c=w.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),d=gr.convertToCanonicalAxisIndicesFastToSlow(c),f=[a.NX,a.NY,a.NZ],p=d([a.NC,a.NR,a.NS]),v=qbe(a),(t==null?void 0:t.offset)&&w.add(v,v,t.offset),m=d(v),h=w.create(m[0]/f[0],m[1]/f[1],m[2]/f[2]),g=w.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=gr.Space(p,gr.invertAxisOrder(c),jbe(a)),b=gr.create(y,gr.Data1(i)),S=a.AMIN===0&&a.AMAX===0&&a.AMEAN===0&&a.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Ut.create(h,w.add(w.zero(),h,g))},cells:b,stats:{min:isNaN(a.AMIN)||S?dS(i):a.AMIN,max:isNaN(a.AMAX)||S?Eu(i):a.AMAX,mean:isNaN(a.AMEAN)||S?fS(i):a.AMEAN,sigma:isNaN(a.ARMS)||a.ARMS===0?pS(i):a.ARMS}},sourceData:H4.create(e),customProperties:new Nu,_propertyData:Object.create(null)}]})})})}var H4;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(H4||(H4={}));function Xbe(e,t){var r=this;return Fe.create("Create Volume",function(n){return se(r,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){return a=e.header,i=e.values,o=w.create(a.xlen,a.ylen,a.zlen),t&&t.voxelSize&&w.mul(o,o,t.voxelSize),s=w.create(wr(a.alpha),wr(a.beta),wr(a.gamma)),u=Ri.create("P 1",o,s),l=[a.xRate,a.yRate,a.zRate],c=[a.xExtent,a.yExtent,a.zExtent],d=[a.xStart,a.yStart,a.zStart],f=w.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),p=w.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),v=gr.Space(c,[0,1,2],Float32Array),m=gr.create(v,gr.Data1(i)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Ut.create(f,w.add(w.zero(),f,p))},cells:m,stats:{min:dS(i),max:Eu(i),mean:fS(i),sigma:a.sigma!==void 0?a.sigma:pS(i)}},sourceData:G4.create(e),customProperties:new Nu,_propertyData:Object.create(null)}]})})})}var G4;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(G4||(G4={}));function Ybe(e,t){var r=this;return Fe.create("Create Volume",function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){return n=e.header,a=e.values,i=gr.Space(n.dim,[0,1,2],Float64Array),o=gr.create(i,gr.Data1(a)),s=oe.fromTranslation(oe(),n.min),u=oe.fromScaling(oe(),n.h),oe.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:dS(a),max:Eu(a),mean:fS(a),sigma:pS(a)}},sourceData:q4.create(e),customProperties:new Nu,_propertyData:Object.create(null)}]})})})}var q4;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(q4||(q4={}));var Kbe=_t.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:fe.Format.Ccp4,to:fe.Volume.Data,params:function(e){return{voxelSize:E.Vec3(w.create(1,1,1)),offset:E.Vec3(w.create(0,0,0)),entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Create volume from CCP4/MRC/MAP",function(a){return se(t,void 0,void 0,function(){var i,o;return ie(this,function(s){switch(s.label){case 0:return[4,Wbe(r.data,_(_({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.NX,"\xD7").concat(r.data.header.NX,"\xD7").concat(r.data.header.NX)},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Qbe=_t.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:fe.Format.Dsn6,to:fe.Volume.Data,params:function(e){return{voxelSize:E.Vec3(w.create(1,1,1)),entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Create volume from DSN6/BRIX",function(a){return se(t,void 0,void 0,function(){var i,o;return ie(this,function(s){switch(s.label){case 0:return[4,Xbe(r.data,_(_({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.xExtent,"\xD7").concat(r.data.header.yExtent,"\xD7").concat(r.data.header.zExtent)},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Zbe=_t.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:fe.Format.Cube,to:fe.Volume.Data,params:function(e){var t=e?E.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,"".concat(r)]})):E.Numeric(0);return{dataIndex:t,entryId:E.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Create volume from Cube",function(a){return se(t,void 0,void 0,function(){var i,o;return ie(this,function(s){switch(s.label){case 0:return[4,j$(r.data,_(_({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xD7").concat(r.data.header.dim[1],"\xD7").concat(r.data.header.dim[2])},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),$be=_t.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:fe.Format.Dx,to:fe.Volume.Data})({apply:function(e){var t=this,r=e.a;return Fe.create("Parse DX",function(n){return se(t,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,Ybe(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xD7").concat(r.data.header.dim[1],"\xD7").concat(r.data.header.dim[2])},[2,new fe.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Jbe=_t.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Volume.Data,params:function(e){if(!e)return{blockHeader:E.Optional(E.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:E.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:E.Optional(E.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:E.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Fe.create("Parse density-server CIF",function(a){return se(t,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(h){return h.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return s=Ol.schema.densityServer(o),[4,BN(s,{entryId:n.entryId}).runInContext(a)];case 1:return u=m.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],p={label:(v=n.entryId)!==null&&v!==void 0?v:s.volume_data_3d_info.name.value(0),description:"Volume ".concat(c,"\xD7").concat(d,"\xD7").concat(f)},[2,new fe.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),e2e=_t.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,to:fe.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:E.Text()};var r=t.state.data.select(Kt.Generators.root.subtree().ofType(fe.Volume.Data).filter(function(n){var a;return!!n.obj&&!((a=n.obj)===null||a===void 0?void 0:a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:E.Text("",{isHidden:!0})}:{ref:E.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return Fe.create("Assign Color Volume",function(i){return se(t,void 0,void 0,function(){var o,s,u;return ie(this,function(l){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=_(_({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new fe.Volume.Data(s,u)]})})})}}),t2e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VolumeFromCcp4:Kbe,VolumeFromDsn6:Qbe,VolumeFromCube:Zbe,VolumeFromDx:$be,AssignColorVolume:e2e,VolumeFromDensityServerCif:Jbe}),Ve={Data:Dge,Misc:Rge,Model:Gbe,Volume:t2e,Representation:fhe,Shape:Nme},r2e=Fl.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure)),n=0,a=r;n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:E.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:E.Boolean(!1),target:E.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=er.RootRef,n=t.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,a=!e.target||e.target==="all"?er.RootRef:e.target,i=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D,a)),o=n.build(),s=!1,u=0,l=i;u<l.length;u++){var c=l[u],d=n.select(Kt.Generators.ofTransformer(Ve.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(Ve.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(!!s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:if(n=r.plugin.state.data,a=!r.params.target||r.params.target==="all"?er.RootRef:r.params.target,i=n.select(Kt.Generators.ofTransformer(Ve.Representation.UnwindStructureAssemblyRepresentation3D,a)),i.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=i;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,ft.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),Uy=w(),CO=w(),wO=$r(),n2e=Fl.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:E.Numeric(4e3,{min:100,max:2e4,step:100}),speed:E.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:E.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return se(this,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):Ha(t.current/r.params.durationInMs,0,1),s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),w.sub(Uy,i.position,i.target),w.normalize(CO,i.up),$r.setAxisAngle(wO,CO,s),w.transformQuat(Uy,Uy,wO),u=w.add(w(),i.target,Uy),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:_(_({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}]))})})}}),a2e=Fl.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:E.MappedStatic("loop",{palindrome:E.Group({}),loop:E.Group({direction:E.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:E.Group({direction:E.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:E.MappedStatic("fixed",{fixed:E.Group({durationInS:E.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:E.Group({targetFps:E.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:E.Group({maxFps:E.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(Kt.Generators.ofTransformer(Ve.Model.ModelFromTrajectory)),n=0,a=r;n<a.length;n++){var i=a[n],o=Kt.findAncestorOfType(t.tree,t.cells,i.transform.ref,fe.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,a=n.select(Kt.Generators.ofTransformer(Ve.Model.ModelFromTrajectory)),i=0,o=0,s=a;o<s.length;o++){var u=s[o],l=Kt.findAncestorOfType(n.tree,n.cells,u.transform.ref,fe.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;i=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),i)}}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,a=n.select(Kt.Generators.ofTransformer(Ve.Model.ModelFromTrajectory)),a.length===0)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(m){var h=Kt.findAncestorOfType(n.tree,n.cells,m.transform.ref,fe.Molecule.Trajectory);if(!h||!h.obj)return"continue";var g=h.obj;if(g.data.frameCount<=1)return"continue";i.to(m).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[m.transform.ref]||1);s[m.transform.ref]=S;var C=(y.modelIndex+S)%b;return C<0&&(C+=b),u=u||S===-1&&C===0||S===1&&C===b-1,{modelIndex:C}}else{var x=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),A=t.current%x/x;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(A=1-A),o.mode.name==="palindrome"&&(A=2*A,A>1&&(A=2-A));var C=Math.min(Math.floor(g.data.frameCount*A),g.data.frameCount-1);return u=u||C===g.data.frameCount-1,{modelIndex:C}}})},d=0,f=a;d<f.length;d++)p=f[d],c(p);return l?[3,2]:[4,ft.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:v.sent(),v.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function _O(e,t,r){var n;return r===void 0&&(r=!1),se(this,void 0,void 0,function(){return ie(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var i2e=Fl.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r==null?void 0:r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);_O(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+((a=n.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+((i=a.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return se(this,void 0,void 0,function(){var a,i,o,s,u;return ie(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],a+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(_O(r.plugin,e.snapshots[i]),[2,{kind:"next",state:_(_({},e),{currentIndex:i})}])})})}}),Fg=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs=="undefined"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&If(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=El.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),uc=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=$X(a,r);return i!==a?(this._state=i,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(Fg),j4="3.1.0",o2e=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__!="undefined"?__MOLSTAR_DEBUG_TIMESTAMP__:1644191704560),l2=function(e){Pe(t,e);function t(r){var n=e.call(this,{current:void 0,entries:Ef(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return se(n,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,a=this.getNextId(this.state.current,1),!a||a===this.state.current?(this.stop(),[2]):(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]);case 1:return s.sent(),o=typeof i.durationInMs!="undefined"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(!!r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);!n||(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)},t.prototype.replace=function(r,n){var a=this.getEntry(r);if(!!a){var i=this.getIndex(a),o=t.Entry(n,{name:a.name,description:a.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(i,o)}),this.events.changed.next(void 0)}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(!!i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,i),l.set(o,u),this.updateState({current:i.snapshot.id,entries:l.asImmutable()}),this.events.changed.next(void 0)}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:Ef()}),this.events.changed.next(void 0))},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(a===0)return;var i=n===-1?a-1:0;return this.state.entries.get(i).snapshot.id}var o=this.getEntry(r);if(!!o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%a,s<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:for(r.version!==j4,this.clear(),n=Ef().asMutable(),a=0,i=r.entries;a<i.length;a++)o=i[a],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:j4,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h,g;return ie(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r==null?void 0:r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:a=new Uint8Array(xb(n)),gv(a,0,n),i={"state.json":a},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=i,p="assets/".concat(c.id),v=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[p]=new(v.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(m=JSON.stringify(o,null,2),h=new Uint8Array(xb(m)),gv(h,0,m),i["assets.json"]=h),[4,this.plugin.runTask(vK(i))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return se(this,void 0,void 0,function(){var n,a,g,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(Xc(r,"string"))]:[3,2];case 1:return a=b.sent(),g=JSON.parse(a),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(Xc(r,"zip"))];case 3:return a=b.sent(),i=Object.create(null),ns(a,function(S,C){if(!(C==="state.json"||C==="assets.json")){var x=C.substring(C.indexOf("/")+1);i[x]=new File([S],x)}}),o=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(Xc(o,"string"))];case 4:return s=b.sent(),a["assets.json"]?(u=new File([a["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(Xc(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,p=l;f<p.length;f++)v=p[f],m=v[0],h=v[1],this.plugin.managers.asset.set(h,i[m]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),console.error(y),this.plugin.log.error("Error reading state"),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next(void 0);var a=n.snapshot,i=typeof a.durationInMs!="undefined"?a.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle!="undefined"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(uc);(function(e){function t(n,a){return _({timestamp:+new Date,snapshot:n},a)}e.Entry=t;function r(n){var a=n;return!!a&&!!a.timestamp&&!!a.entries}e.isStateSnapshot=r})(l2||(l2={}));function s2e(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+a+"-"+i+"-"+o}function u2e(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function AO(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function qz(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,AO(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return AO(r)}))}else if(typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(l){u2e(i?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(typeof e=="string"?new Blob([e]):e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function l2e(e){jz(e),Wz(e),Xz(e),Yz(e),Kz(e),Qz(e),Zz(e),$z(e),Jz(e),eV(e)}function jz(e){e.state.events.object.created.subscribe(function(t){!fe.isBehavior(t.obj)||t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){!fe.isBehavior(t.obj)||t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&fe.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&fe.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function Wz(e){ft.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function Xz(e){ft.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,a=t.options;return e.runTask(r.updateTree(n,a))})}function Yz(e){ft.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,a=t.ref;return e.runTask(r.applyAction(n.action,n.params,a))})}function Kz(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}ft.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref,i=r.removeParentGhosts;if(i){var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,a)})}function Qz(e){ft.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(a){var i=a.isCollapsed;return{isCollapsed:!i}})})}function Zz(e){ft.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return tp(r,n,!r.cells.get(n).state.isHidden)})}function tp(e,t,r){Nn.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},c2e)}function c2e(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function $z(e){ft.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var a=typeof n=="string"?[n]:n,i=0,o=a;i<o.length;i++){var s=o[i],u=r.cells.get(s);if(!!u){if(fe.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:Ne.Loci(u.obj.data)},!1);else if(u&&fe.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(fe.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function Jz(e){ft.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function eV(e){var t=this;e.config.set(Lr.State.CurrentServer,e.config.get(Lr.State.DefaultServer)),ft.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),ft.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),ft.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,a=r.description,i=r.params,o=l2.Entry(e.state.getSnapshot(i),{name:n,description:a});e.managers.snapshot.add(o)}),ft.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(a))}),ft.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,a=r.dir;e.managers.snapshot.move(n,a)}),ft.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,a=e.managers.snapshot.setCurrent(n);if(!!a)return e.state.setSnapshot(a)}),ft.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return r.params,fetch(mS(o,"set?name=".concat(encodeURIComponent(n||""),"&description=").concat(encodeURIComponent(a||""))),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i}))})}),ft.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return se(t,void 0,void 0,function(){var a;return ie(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),ft.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return se(t,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return o="mol-star_state_".concat(n||s2e(),".").concat(a==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return s=u.sent(),qz(s,"".concat(o)),[2]}})})}),ft.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),ft.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return se(t,void 0,void 0,function(){var i;return ie(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state.".concat(a)))]}})})})}var d2e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:l2e,SyncBehaviors:jz,SetCurrentObject:Wz,Update:Xz,ApplyAction:Yz,RemoveObject:Kz,ToggleExpanded:Qz,ToggleVisibility:Zz,setSubtreeVisibility:tp,Highlight:$z,ClearHighlights:Jz,Snapshots:eV});function f2e(e){tV(e),rV(e),nV(e)}function tV(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;!fe.isRepresentation3D(r.obj)||(W4(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&fe.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),!!fe.isRepresentation3D(r.obj)&&(W4(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(a=e.canvas3d)===null||a===void 0||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;!fe.isRepresentation3D(r.obj)||((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function rV(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}})}function nV(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);!fe.isRepresentation3D(n.obj)||W4(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function W4(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var p2e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:f2e,SyncRepresentationToCanvas:tV,SyncStructureRepresentation3DState:rV,UpdateRepresentationVisibility:nV});function v2e(e){aV(e),oV(e),iV(e)}function aV(e){ft.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function iV(e){ft.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function oV(e){ft.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,a=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:a}),e.events.canvas3d.settingsUpdated.next(void 0)})}var m2e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:v2e,Reset:aV,SetSnapshot:iV,Focus:oV});function _f(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function Sv(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function zy(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var TO={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:function(e,t){return!0},pixelScale:1},Vs;(function(e){e.None=n();function t(a,i){return a.shift===i.shift&&a.alt===i.alt&&a.control===i.control&&a.meta===i.meta}e.areEqual=t;function r(a){if(!a)return 0;var i=0;return a.shift&&i++,a.alt&&i++,a.control&&i++,a.meta&&i++,i}e.size=r;function n(a){return a===void 0&&(a={}),{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}e.create=n})(Vs||(Vs={}));var rp;(function(e){e.has=Xa.has,e.create=Xa.create})(rp||(rp={}));function PO(){return{drag:new xn,interactionEnd:new xn,click:new xn,move:new xn,wheel:new xn,pinch:new xn,gesture:new xn,resize:new xn,leave:new xn,enter:new xn,modifiers:new xn,key:new xn}}var h2e=["Backspace","Delete"],X4;(function(e){function t(n){n===void 0&&(n={});var a=_(_({},TO),n),i=a.noScroll,o=a.noContextMenu;return _(_({noScroll:i,noContextMenu:o,width:0,height:0,pixelRatio:1},PO()),{dispose:Oc})}e.create=t;function r(n,a){a===void 0&&(a={});var i=_(_({},TO),a),o=i.noScroll,s=i.noMiddleClickScroll,u=i.noContextMenu,l=i.noPinchZoom,c=i.noTextSelect,d=i.mask,f=i.pixelScale,p=i.preventGestures,v=n.clientWidth*P(),m=n.clientHeight*P(),h=0,g=0,y=ke(),b=ke(),S=ke(),C=ke(),x=ke(),A={shift:!1,alt:!1,control:!1,meta:!1};function P(){return window.devicePixelRatio*f}function T(){return _({},A)}var D=0,I=!1,M=rp.create(0),B=0,U=!1,V=PO(),F=V.drag,Y=V.interactionEnd,W=V.wheel,K=V.pinch,$=V.gesture,J=V.click,Z=V.move,N=V.leave,j=V.enter,L=V.resize,H=V.modifiers,G=V.key;return q(),_(_({get noScroll(){return o},set noScroll(ee){o=ee},get noContextMenu(){return u},set noContextMenu(ee){u=ee},get width(){return v},get height(){return m},get pixelRatio(){return P()}},V),{dispose:X});function q(){n.addEventListener("contextmenu",Q,!1),n.addEventListener("wheel",Je,!1),n.addEventListener("mousedown",me,!1),window.addEventListener("mousemove",ye,!1),window.addEventListener("mouseup",Te,!1),n.addEventListener("mouseenter",st,!1),n.addEventListener("mouseleave",pt,!1),n.addEventListener("touchstart",O,!1),n.addEventListener("touchmove",de,!1),n.addEventListener("touchend",z,!1),n.addEventListener("gesturechange",Ie,!1),n.addEventListener("gesturestart",St,!1),n.addEventListener("gestureend",je,!1),window.addEventListener("blur",le),window.addEventListener("keyup",ge,!1),window.addEventListener("keydown",ve,!1),window.addEventListener("keypress",Se,!1),window.addEventListener("resize",qe,!1)}function X(){I||(I=!0,n.removeEventListener("contextmenu",Q,!1),n.removeEventListener("wheel",Je,!1),n.removeEventListener("mousedown",me,!1),window.removeEventListener("mousemove",ye,!1),window.removeEventListener("mouseup",Te,!1),n.removeEventListener("mouseenter",st,!1),n.removeEventListener("mouseleave",pt,!1),n.removeEventListener("touchstart",O,!1),n.removeEventListener("touchmove",de,!1),n.removeEventListener("touchend",z,!1),n.removeEventListener("gesturechange",Ie,!1),n.removeEventListener("gesturestart",St,!1),n.removeEventListener("gestureend",je,!1),window.removeEventListener("blur",le),window.removeEventListener("keyup",ge,!1),window.removeEventListener("keydown",ve,!1),window.removeEventListener("keypress",Se,!1),window.removeEventListener("resize",qe,!1))}function Q(ee){!d(ee.clientX,ee.clientY)||u&&ee.preventDefault()}function ue(ee){A.alt=ee.altKey,A.shift=ee.shiftKey,A.control=ee.ctrlKey,A.meta=ee.metaKey}function le(){(M||A.shift||A.alt||A.meta||A.control)&&(M=0,A.shift=A.alt=A.control=A.meta=!1)}function ve(ee){var pe=!1;!A.alt&&ee.altKey&&(pe=!0,A.alt=!0),!A.shift&&ee.shiftKey&&(pe=!0,A.shift=!0),!A.control&&ee.ctrlKey&&(pe=!0,A.control=!0),!A.meta&&ee.metaKey&&(pe=!0,A.meta=!0),pe&&U&&H.next(T())}function ge(ee){var pe=!1;A.alt&&!ee.altKey&&(pe=!0,A.alt=!1),A.shift&&!ee.shiftKey&&(pe=!0,A.shift=!1),A.control&&!ee.ctrlKey&&(pe=!0,A.control=!1),A.meta&&!ee.metaKey&&(pe=!0,A.meta=!1),pe&&U&&H.next(T()),h2e.includes(ee.key)&&Se(ee)}function Se(ee){G.next({key:ee.key,modifiers:T()})}function ae(ee){var pe=ee.touches[0],we=ee.touches[1];return{clientX:(pe.clientX+we.clientX)/2,clientY:(pe.clientY+we.clientY)/2,pageX:(pe.pageX+we.pageX)/2,pageY:(pe.pageY+we.pageY)/2}}function re(ee){var pe=ee.touches[0].pageX-ee.touches[1].pageX,we=ee.touches[0].pageY-ee.touches[1].pageY;return Math.sqrt(pe*pe+we*we)}function O(ee){if(ee.preventDefault(),ee.touches.length===1)M=B=1,Ue(ee.touches[0]);else if(ee.touches.length===2){M=0,B=2,Ue(ae(ee));var pe=re(ee);h=pe,K.next({distance:pe,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:M,button:B,modifiers:T()})}else ee.touches.length===3&&(M=B=8,Ue(ae(ee)))}function z(ee){Oe()}function de(ee){if(B=0,l&&(ee.preventDefault(),ee.stopPropagation(),ee.originalEvent&&(ee.originalEvent.preventDefault(),ee.originalEvent.stopPropagation())),ee.touches.length===1)M=1,Ge(ee.touches[0]);else if(ee.touches.length===2){var pe=re(ee),we=h-pe;if(Math.abs(we)<4)M=2,Ge(ae(ee));else{M=4,ue(ee);var Xe=h/pe;K.next({delta:we,fraction:Xe,fractionDelta:g-Xe,distance:pe,isStart:!1,buttons:M,button:B,modifiers:T()}),g=Xe}h=pe}else ee.touches.length===3&&(M=8,Ge(ae(ee)))}function me(ee){ue(ee),M=_f(ee),B=Sv(ee),s&&M===4&&ee.preventDefault,Ue(ee)}function ye(ee){ue(ee),M=_f(ee),B=0,Ge(ee)}function Te(ee){ue(ee),M=_f(ee),B=Sv(ee),Qe(ee),Oe()}function Oe(){Y.next(void 0)}function Ue(ee){!d(ee.clientX,ee.clientY)||(Dt(b,ee),ke.copy(y,b),bt(b)&&(D=1))}function Qe(ee){if(D=0,!!d(ee.clientX,ee.clientY)&&(Dt(S,ee),ke.distance(S,y)<4)){var pe=ee.pageX,we=ee.pageY,Xe=S[0],dt=S[1];J.next({x:Xe,y:dt,pageX:pe,pageY:we,buttons:M,button:B,modifiers:T()})}}function Ge(ee){var pe;Dt(S,ee);var we=ee.pageX,Xe=ee.pageY,dt=S[0],vt=S[1],Et=bt(S);if(Z.next({x:dt,y:vt,pageX:we,pageY:Xe,buttons:M,button:B,modifiers:T(),inside:Et}),D!==0&&(c&&((pe=ee.preventDefault)===null||pe===void 0||pe.call(ee)),ke.div(C,ke.sub(C,S,b),yt(x)),!(ke.magnitude(C)<zr))){var _r=D===1;if(!(_r&&!d(ee.clientX,ee.clientY))){var qr=C[0],Qr=C[1];F.next({x:dt,y:vt,dx:qr,dy:Qr,pageX:we,pageY:Xe,buttons:M,button:B,modifiers:T(),isStart:_r}),ke.copy(b,S),D=2}}}function Je(ee){if(!!d(ee.clientX,ee.clientY)){Dt(S,ee);var pe=ee.pageX,we=ee.pageY,Xe=S[0],dt=S[1];o&&ee.preventDefault();var vt=g2e(ee);M=B=4,(vt.dx||vt.dy||vt.dz)&&W.next(_(_({x:Xe,y:dt,pageX:pe,pageY:we},vt),{buttons:M,button:B,modifiers:T()}))}}function Ze(ee){var pe,we;!p||(ee.preventDefault(),(pe=ee.stopImmediatePropagation)===null||pe===void 0||pe.call(ee),(we=ee.stopPropagation)===null||we===void 0||we.call(ee))}var rt=0,et=0;function St(ee){Ze(ee),rt=ee.scale,et=ee.rotation,$.next({scale:ee.scale,rotation:ee.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function De(ee,pe){$.next({scale:ee.scale,rotation:ee.rotation,deltaRotation:et-ee.rotation,deltaScale:rt-ee.scale,isEnd:pe}),et=ee.rotation,rt=ee.scale}function Ie(ee){Ze(ee),De(ee)}function je(ee){Ze(ee),De(ee,!0)}function st(ee){U=!0,j.next(void 0)}function pt(ee){U=!1,N.next(void 0)}function qe(ee){L.next({})}function bt(ee){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var pe=n.getBoundingClientRect();return ee[0]>=0&&ee[1]>=0&&ee[0]<pe.width&&ee[1]<pe.height}function yt(ee){return ee[0]=n.clientWidth,ee[1]=n.clientHeight,ee}function Dt(ee,pe){v=n.clientWidth*P(),m=n.clientHeight*P();var we=pe.clientX||0,Xe=pe.clientY||0,dt=n.getBoundingClientRect();return ee[0]=we-dt.left,ee[1]=Xe-dt.top,ee}}e.fromElement=r})(X4||(X4={}));function g2e(e){var t=10,r=40,n=800,a=0,i=0,o=0,s=0,u=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(a=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(a=i,i=0),o=a*t,s=i*t,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(o=e.deltaX),"deltaZ"in e&&(u=e.deltaZ),(o||s||u)&&e.deltaMode&&(e.deltaMode===1?(o*=r,s*=r,u*=r):(o*=n,s*=n,u*=n)),o&&!a&&(a=o<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:a,spinY:i,dx:o,dy:s,dz:u}}function Sa(){return Sa.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return _({},u)}e.clone=n;function a(u,l){return Object.assign(u,l)}e.copy=a;function i(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=i;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(Sa||(Sa={}));var su=Jt();function y2e(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;Jt.set(su,t[0],t[1],t[2],1),Jt.transformMat4(su,su,n);var u=su[3];return u!==0&&(su[0]/=u,su[1]/=u,su[2]/=u),e[0]=(su[0]+1)*o*.5+a,e[1]=(1-su[1])*s*.5+i,e[2]=(su[2]+1)*.5,e[3]=u===0?0:1/u,e}function U1(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height,u=t[0]-a,l=s-t[1]-1-i,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,w.transformMat4(e,e,n)}var Y4={backgroundColor:E.Color($e(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:E.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:E.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:E.Boolean(!0,{label:"Use Interior Color"}),interiorColor:E.Color($e.fromNormalizedRgb(.3,.3,.3)),highlightColor:E.Color($e.fromNormalizedRgb(1,.4,.6)),selectColor:E.Color($e.fromNormalizedRgb(.2,1,.1)),highlightStrength:E.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:E.Numeric(.3,{min:0,max:1,step:.1}),markerPriority:E.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:E.Numeric(1,{min:0,max:3,step:.1}),light:E.ObjectList({inclination:E.Numeric(180,{min:0,max:180,step:1}),azimuth:E.Numeric(0,{min:0,max:360,step:1}),color:E.Color($e.fromNormalizedRgb(1,1,1)),intensity:E.Numeric(.6,{min:0,max:1,step:.01})},function(e){return $e.toHexString(e.color)},{defaultValue:[{inclination:180,azimuth:0,color:$e.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:E.Color($e.fromNormalizedRgb(1,1,1)),ambientIntensity:E.Numeric(.4,{min:0,max:1,step:.01})},EO=w(),y3=w();function IO(e,t){for(var r=t||{direction:new Array(15).fill(0),color:new Array(15).fill(0)},n=r.direction,a=r.color,i=0,o=e.length;i<o;++i){var s=e[i];w.directionFromSpherical(EO,wr(s.inclination),wr(s.azimuth),1),w.toArray(EO,n,i*3),w.scale(y3,$e.toVec3Normalized(y3,s.color),s.intensity),w.toArray(y3,a,i*3)}return{count:e.length,direction:n,color:a}}var K4;(function(e){function t(r,n){n===void 0&&(n={});var a=r.gl,i=r.state,o=r.stats,s=E.merge(Y4,E.getDefaultValues(Y4),n),u=IO(s.light),l=Sa(),c=ke.create(a.drawingBufferWidth,a.drawingBufferHeight),d=$e.toVec3Normalized(w(),s.backgroundColor),f=!1,p=Ei(a),v=[["tDepth",p]],m=oe(),h=oe(),g=oe(),y=oe(),b=oe(),S=oe(),C=oe(),x=w(),A=ke(),P=w();w.scale(P,$e.toArrayNormalized(s.ambientColor,P,0),s.ambientIntensity);var T={uModel:R.create(oe.identity()),uView:R.create(m),uInvView:R.create(h),uModelView:R.create(g),uInvModelView:R.create(y),uInvProjection:R.create(b),uProjection:R.create(oe()),uModelViewProjection:R.create(S),uInvModelViewProjection:R.create(C),uIsOrtho:R.create(1),uViewOffset:R.create(A),uPixelRatio:R.create(r.pixelRatio),uViewport:R.create(Sa.toVec4(Jt(),l)),uDrawingBufferSize:R.create(c),uCameraPosition:R.create(w()),uCameraDir:R.create(x),uNear:R.create(1),uFar:R.create(1e4),uFogNear:R.create(1),uFogFar:R.create(1e4),uFogColor:R.create(d),uRenderWboit:R.create(!1),uMarkingDepthTest:R.create(!1),uPickType:R.create(0),uMarkingType:R.create(0),uTransparentBackground:R.create(!1),uLightDirection:R.create(u.direction),uLightColor:R.create(u.color),uAmbientColor:R.create(P),uPickingAlphaThreshold:R.create(s.pickingAlphaThreshold),uInteriorDarkening:R.create(s.interiorDarkening),uInteriorColorFlag:R.create(s.interiorColorFlag),uInteriorColor:R.create($e.toVec3Normalized(w(),s.interiorColor)),uHighlightColor:R.create($e.toVec3Normalized(w(),s.highlightColor)),uSelectColor:R.create($e.toVec3Normalized(w(),s.selectColor)),uHighlightStrength:R.create(s.highlightStrength),uSelectStrength:R.create(s.selectStrength),uMarkerPriority:R.create(s.markerPriority),uXrayEdgeFalloff:R.create(s.xrayEdgeFalloff)},D=Object.entries(T),I=!0,M=function(H,G){if(!(H.state.disposed||!H.state.visible||!H.state.pickable&&G==="pick")){var q=!1;H.values.dLightCount.ref.value!==u.count&&(R.update(H.values.dLightCount,u.count),q=!0),q&&H.update();var X=H.getProgram(G);if(i.currentProgramId!==X.id&&(I=!0,X.use()),I&&(X.setUniforms(D),I=!1),H.values.dGeometryType.ref.value==="directVolume"){if(G!=="colorWboit"&&G!=="colorBlended")return;i.disable(a.CULL_FACE),i.frontFace(a.CCW),G==="colorBlended"&&(i.disable(a.DEPTH_TEST),i.depthMask(!1))}else H.values.uDoubleSided?H.values.uDoubleSided.ref.value||H.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),H.values.dFlipSided&&H.values.dFlipSided.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK));H.render(G,v)}},B=function(H){R.update(T.uView,H.view),R.update(T.uInvView,oe.invert(h,H.view)),R.update(T.uProjection,H.projection),R.update(T.uInvProjection,oe.invert(b,H.projection)),R.updateIfChanged(T.uIsOrtho,H.state.mode==="orthographic"?1:0),R.update(T.uViewOffset,H.viewOffset.enabled?ke.set(A,H.viewOffset.offsetX*16,H.viewOffset.offsetY*16):ke.set(A,0,0)),R.update(T.uCameraPosition,H.state.position),R.update(T.uCameraDir,w.normalize(x,w.sub(x,H.state.target,H.state.position))),R.updateIfChanged(T.uFar,H.far),R.updateIfChanged(T.uNear,H.near),R.updateIfChanged(T.uFogFar,H.fogFar),R.updateIfChanged(T.uFogNear,H.fogNear),R.updateIfChanged(T.uTransparentBackground,f)},U=function(H,G,q,X,Q){DK(v,"tDepth",q||p),R.update(T.uModel,H.view),R.update(T.uModelView,oe.mul(g,H.view,G.view)),R.update(T.uInvModelView,oe.invert(y,g)),R.update(T.uModelViewProjection,oe.mul(S,g,G.projection)),R.update(T.uInvModelViewProjection,oe.invert(C,S)),R.updateIfChanged(T.uRenderWboit,X),R.updateIfChanged(T.uMarkingDepthTest,Q),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var ue=l.x,le=l.y,ve=l.width,ge=l.height;a.viewport(ue,le,ve,ge),a.scissor(ue,le,ve,ge),I=!0,i.currentRenderItemId=-1},V=function(H,G,q,X,Q){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,X,!1,!1),R.updateIfChanged(T.uPickType,Q);for(var ue=H.renderables,le=0,ve=ue.length;le<ve;++le)ue[le].state.colorOnly||M(ue[le],q)},F=function(H,G,q){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,q,!1,!1);for(var X=H.renderables,Q=0,ue=X.length;Q<ue;++Q)M(X[Q],"depth")},Y=function(H,G,q){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,q,!1,!1),R.updateIfChanged(T.uMarkingType,1);for(var X=H.renderables,Q=0,ue=X.length;Q<ue;++Q){var le=X[Q];le.values.markerAverage.ref.value!==1&&M(X[Q],"marking")}},W=function(H,G,q){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,q,!1,!!q),R.updateIfChanged(T.uMarkingType,2);for(var X=H.renderables,Q=0,ue=X.length;Q<ue;++Q){var le=X[Q];le.values.markerAverage.ref.value>0&&M(X[Q],"marking")}},K=function(H,G,q){$(H,G,q),J(H,G,q)},$=function(H,G,q){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,q,!1,!1);for(var X=H.renderables,Q=0,ue=X.length;Q<ue;++Q){var le=X[Q];le.state.opaque&&M(le,"colorBlended")}},J=function(H,G,q){i.enable(a.DEPTH_TEST),U(H,G,q,!1,!1);var X=H.renderables;f?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var Q=0,ue=X.length;Q<ue;++Q){var le=X[Q];!le.state.opaque&&le.state.writeDepth&&M(le,"colorBlended")}i.depthMask(!1);for(var Q=0,ue=X.length;Q<ue;++Q){var le=X[Q];!le.state.opaque&&!le.state.writeDepth&&M(le,"colorBlended")}},Z=function(H,G,q){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),U(H,G,q,!1,!1);for(var Q=H.renderables,ue=0,le=Q.length;ue<le;++ue){var ve=Q[ue],ge=Ha(ve.values.alpha.ref.value*ve.state.alphaFactor,0,1);ge===1&&ve.values.transparencyAverage.ref.value!==1&&!((X=ve.values.dXrayShaded)===null||X===void 0?void 0:X.ref.value)&&M(ve,"colorBlended")}},N=function(H,G,q){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),U(H,G,q,!1,!1);for(var Q=H.renderables,ue=0,le=Q.length;ue<le;++ue){var ve=Q[ue],ge=Ha(ve.values.alpha.ref.value*ve.state.alphaFactor,0,1);(ge<1||ve.values.transparencyAverage.ref.value>0||((X=ve.values.dXrayShaded)===null||X===void 0?void 0:X.ref.value))&&M(ve,"colorBlended")}},j=function(H,G,q){var X,Q;i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),U(H,G,q,!1,!1);for(var ue=H.renderables,le=0,ve=ue.length;le<ve;++le){var ge=ue[le],Se=Ha(ge.values.alpha.ref.value*ge.state.alphaFactor,0,1);Se===1&&ge.values.transparencyAverage.ref.value!==1&&ge.values.dGeometryType.ref.value!=="directVolume"&&((X=ge.values.dPointStyle)===null||X===void 0?void 0:X.ref.value)!=="fuzzy"&&!((Q=ge.values.dXrayShaded)===null||Q===void 0?void 0:Q.ref.value)&&M(ge,"colorWboit")}},L=function(H,G,q){var X,Q;U(H,G,q,!0,!1);for(var ue=H.renderables,le=0,ve=ue.length;le<ve;++le){var ge=ue[le],Se=Ha(ge.values.alpha.ref.value*ge.state.alphaFactor,0,1);(Se<1||ge.values.transparencyAverage.ref.value>0||ge.values.dGeometryType.ref.value==="directVolume"||((X=ge.values.dPointStyle)===null||X===void 0?void 0:X.ref.value)==="fuzzy"||!!ge.values.uBackgroundColor||((Q=ge.values.dXrayShaded)===null||Q===void 0?void 0:Q.ref.value))&&M(ge,"colorWboit")}};return{clear:function(H,G){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),f&&!G?i.clearColor(0,0,0,0):H?i.clearColor(d[0],d[1],d[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},update:B,renderPick:V,renderDepth:F,renderMarkingDepth:Y,renderMarkingMask:W,renderBlended:K,renderBlendedOpaque:$,renderBlendedTransparent:J,renderBlendedVolumeOpaque:Z,renderBlendedVolumeTransparent:N,renderWboitOpaque:j,renderWboitTransparent:L,setProps:function(H){H.backgroundColor!==void 0&&H.backgroundColor!==s.backgroundColor&&(s.backgroundColor=H.backgroundColor,$e.toVec3Normalized(d,s.backgroundColor),R.update(T.uFogColor,w.copy(T.uFogColor.ref.value,d))),H.pickingAlphaThreshold!==void 0&&H.pickingAlphaThreshold!==s.pickingAlphaThreshold&&(s.pickingAlphaThreshold=H.pickingAlphaThreshold,R.update(T.uPickingAlphaThreshold,s.pickingAlphaThreshold)),H.interiorDarkening!==void 0&&H.interiorDarkening!==s.interiorDarkening&&(s.interiorDarkening=H.interiorDarkening,R.update(T.uInteriorDarkening,s.interiorDarkening)),H.interiorColorFlag!==void 0&&H.interiorColorFlag!==s.interiorColorFlag&&(s.interiorColorFlag=H.interiorColorFlag,R.update(T.uInteriorColorFlag,s.interiorColorFlag)),H.interiorColor!==void 0&&H.interiorColor!==s.interiorColor&&(s.interiorColor=H.interiorColor,R.update(T.uInteriorColor,$e.toVec3Normalized(T.uInteriorColor.ref.value,s.interiorColor))),H.highlightColor!==void 0&&H.highlightColor!==s.highlightColor&&(s.highlightColor=H.highlightColor,R.update(T.uHighlightColor,$e.toVec3Normalized(T.uHighlightColor.ref.value,s.highlightColor))),H.selectColor!==void 0&&H.selectColor!==s.selectColor&&(s.selectColor=H.selectColor,R.update(T.uSelectColor,$e.toVec3Normalized(T.uSelectColor.ref.value,s.selectColor))),H.highlightStrength!==void 0&&H.highlightStrength!==s.highlightStrength&&(s.highlightStrength=H.highlightStrength,R.update(T.uHighlightStrength,s.highlightStrength)),H.selectStrength!==void 0&&H.selectStrength!==s.selectStrength&&(s.selectStrength=H.selectStrength,R.update(T.uSelectStrength,s.selectStrength)),H.markerPriority!==void 0&&H.markerPriority!==s.markerPriority&&(s.markerPriority=H.markerPriority,R.update(T.uMarkerPriority,s.markerPriority)),H.xrayEdgeFalloff!==void 0&&H.xrayEdgeFalloff!==s.xrayEdgeFalloff&&(s.xrayEdgeFalloff=H.xrayEdgeFalloff,R.update(T.uXrayEdgeFalloff,s.xrayEdgeFalloff)),H.light!==void 0&&!Al(H.light,s.light)&&(s.light=H.light,Object.assign(u,IO(H.light,u)),R.update(T.uLightDirection,u.direction),R.update(T.uLightColor,u.color)),H.ambientColor!==void 0&&H.ambientColor!==s.ambientColor&&(s.ambientColor=H.ambientColor,w.scale(P,$e.toArrayNormalized(s.ambientColor,P,0),s.ambientIntensity),R.update(T.uAmbientColor,P)),H.ambientIntensity!==void 0&&H.ambientIntensity!==s.ambientIntensity&&(s.ambientIntensity=H.ambientIntensity,w.scale(P,$e.toArrayNormalized(s.ambientColor,P,0),s.ambientIntensity),R.update(T.uAmbientColor,P))},setViewport:function(H,G,q,X){a.viewport(H,G,q,X),a.scissor(H,G,q,X),(H!==l.x||G!==l.y||q!==l.width||X!==l.height)&&(Sa.set(l,H,G,q,X),R.update(T.uViewport,Jt.set(T.uViewport.ref.value,H,G,q,X)))},setTransparentBackground:function(H){f=H},setDrawingBufferSize:function(H,G){(H!==c[0]||G!==c[1])&&R.update(T.uDrawingBufferSize,ke.set(c,H,G))},setPixelRatio:function(H){R.update(T.uPixelRatio,H)},props:s,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(K4||(K4={}));function rr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),rr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function a(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=a;function i(s,u){u===void 0&&(u="");var l=s.description||mo(u);return nY(l,{triggers:"<i>"+a(s)+"</i>"})}e.format=i;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,p){var v=d.buttons,m=d.modifiers;return v!==void 0&&(v===f||rp.has(v,f))&&(!m||Vs.areEqual(m,p))}s.match=l;function c(d){var f=[],p=b2e(d.buttons);p&&f.push(p);var v=S2e(d.modifiers);return v&&f.push(v),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(rr||(rr={}));var Vy=rp;function b2e(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(Vy.has(e,1)&&t.push("left mouse button"),Vy.has(e,2)&&t.push("right mouse button"),Vy.has(e,4)&&t.push("wheel/middle mouse button"),Vy.has(e,8)&&t.push("three fingers")),t.join(" + ")}function S2e(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var hc=Vs,gc=rr.Trigger,x2e={dragRotate:rr([gc(1,hc.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:rr([gc(1,hc.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:rr([gc(2,hc.create()),gc(1,hc.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:rr.Empty,dragFocus:rr([gc(8,hc.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:rr([gc(4,hc.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:rr([gc(4,hc.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:rr([gc(4,hc.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:rr.Empty},sV={noScroll:E.Boolean(!0,{isHidden:!0}),rotateSpeed:E.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:E.Numeric(7,{min:1,max:15,step:1}),panSpeed:E.Numeric(1,{min:.1,max:5,step:.1}),animate:E.MappedStatic("off",{off:E.EmptyGroup(),spin:E.Group({speed:E.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:E.Group({speed:E.Numeric(.3,{min:-5,max:5,step:.1}),angle:E.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:E.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:E.Numeric(.2,{},{isHidden:!0}),minDistance:E.Numeric(.01,{},{isHidden:!0}),maxDistance:E.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:E.Numeric(1,{},{isHidden:!0}),maxWheelDelta:E.Numeric(.02,{},{isHidden:!0}),bindings:E.Value(x2e,{isHidden:!0}),autoAdjustMinMaxDistance:E.MappedStatic("on",{off:E.EmptyGroup(),on:E.Group({minDistanceFactor:E.Numeric(0),minDistancePadding:E.Numeric(5),maxDistanceFactor:E.Numeric(10),maxDistanceMin:E.Numeric(20)})},{isHidden:!0})},Q4;(function(e){function t(r,n,a){a===void 0&&(a={});var i=_(_({},E.getDefaultValues(sV)),a),o=Sa.clone(n.viewport),s=!1,u=r.drag.subscribe(me),l=r.interactionEnd.subscribe(ye),c=r.wheel.subscribe(Te),d=r.pinch.subscribe(Oe),f=r.gesture.subscribe(Ue),p=!1,v=w(),m=w(),h=ke(),g=ke(),y=w(),b=0,S=ke(),C=ke(),x=0,A=ke(),P=ke(),T=ke(),D=ke(),I=ke(),M=ke(),B=w.clone(n.target),U=w.clone(n.position),V=w.clone(n.up),F=ke();function Y(Ie,je){return ke.set(F,(Ie-o.x)/o.width,(je-o.y)/o.height)}var W=ke();function K(Ie,je){return ke.set(W,(Ie-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-je))/o.width)}function $(){var Ie=r.width/r.height;return i.rotateSpeed*r.pixelRatio*Ie}var J=w(),Z=$r(),N=w(),j=w(),L=w(),H=w();function G(){var Ie=g[0]-h[0],je=g[1]-h[1];w.set(H,Ie,je,0);var st=w.magnitude(H)*$();st?(w.sub(m,n.position,n.target),w.normalize(N,m),w.normalize(j,n.up),w.normalize(L,w.cross(L,j,N)),w.setMagnitude(j,j,je),w.setMagnitude(L,L,Ie),w.add(H,j,L),w.normalize(J,w.cross(J,H,m)),$r.setAxisAngle(Z,J,st),w.transformQuat(m,m,Z),w.transformQuat(n.up,n.up,Z),w.copy(y,J),b=st):!i.staticMoving&&b&&(b*=Math.sqrt(1-i.dynamicDampingFactor),w.sub(m,n.position,n.target),$r.setAxisAngle(Z,y,b),w.transformQuat(m,m,Z),w.transformQuat(n.up,n.up,Z)),ke.copy(h,g)}var q=$r();function X(){var Ie=C[0]-S[0],je=C[1]-S[1],st=i.rotateSpeed*(-Ie+je)*-.05;st?(w.sub(m,n.position,n.target),$r.setAxisAngle(q,m,st),w.transformQuat(n.up,n.up,q),x=st):!i.staticMoving&&x&&(x*=Math.sqrt(1-i.dynamicDampingFactor),w.sub(m,n.position,n.target),$r.setAxisAngle(q,m,x),w.transformQuat(n.up,n.up,q)),ke.copy(S,C)}function Q(){var Ie=1+(P[1]-A[1])*i.zoomSpeed;Ie!==1&&Ie>0&&w.scale(m,m,Ie),i.staticMoving?ke.copy(A,P):A[1]+=(P[1]-A[1])*i.dynamicDampingFactor}function ue(){var Ie=(D[1]-T[1])*i.zoomSpeed;if(Ie!==0){var je=Math.max(1,n.state.radius+n.state.radius*Ie);n.setState({radius:je})}i.staticMoving?ke.copy(T,D):T[1]+=(D[1]-T[1])*i.dynamicDampingFactor}var le=ke(),ve=w(),ge=w();function Se(){if(ke.sub(le,ke.copy(le,M),I),ke.squaredMagnitude(le)){var Ie=r.pixelRatio*i.panSpeed;le[0]*=1/n.zoom*n.viewport.width*Ie,le[1]*=1/n.zoom*n.viewport.height*Ie,w.cross(ge,w.copy(ge,m),n.up),w.setMagnitude(ge,ge,le[0]),w.setMagnitude(ve,n.up,le[1]),w.add(ge,ge,ve),w.add(n.position,n.position,ge),w.add(n.target,n.target,ge),i.staticMoving?ke.copy(I,M):(ke.sub(le,M,I),ke.scale(le,le,i.dynamicDampingFactor),ke.add(I,I,le))}}function ae(){var Ie=Math.min(Math.max(n.state.radiusMax*1e3,.01),i.maxDistance);w.squaredMagnitude(m)>Ie*Ie&&(w.setMagnitude(m,m,Ie),w.add(n.position,n.target,m),ke.copy(A,P),ke.copy(T,D)),w.squaredMagnitude(m)<i.minDistance*i.minDistance&&(w.setMagnitude(m,m,i.minDistance),w.add(n.position,n.target,m),ke.copy(A,P),ke.copy(T,D))}function re(Ie,je){return Ie*=r.pixelRatio,je*=r.pixelRatio,Ie>o.x+o.width||r.height-je>o.y+o.height||Ie<o.x||r.height-je<o.y}var O=-1;function z(Ie){O!==Ie&&(O>0&&(i.animate.name==="spin"?Je(Ie-O):i.animate.name==="rock"&&et(Ie-O)),w.sub(m,n.position,n.target),G(),X(),Q(),ue(),Se(),w.add(n.position,n.target,m),ae(),w.squaredDistance(v,n.position)>zr&&w.copy(v,n.position),O=Ie)}function de(){w.copy(n.target,B),w.copy(n.position,U),w.copy(n.up,V),w.sub(m,n.position,n.target),w.copy(v,n.position)}function me(Ie){var je=Ie.x,st=Ie.y,pt=Ie.pageX,qe=Ie.pageY,bt=Ie.buttons,yt=Ie.modifiers,Dt=Ie.isStart,ee=re(je,st);if(!(Dt&&ee)&&!(!Dt&&!p)){p=!0,St();var pe=rr.match(i.bindings.dragRotate,bt,yt),we=rr.match(i.bindings.dragRotateZ,bt,yt),Xe=rr.match(i.bindings.dragPan,bt,yt),dt=rr.match(i.bindings.dragZoom,bt,yt),vt=rr.match(i.bindings.dragFocus,bt,yt),Et=rr.match(i.bindings.dragFocusZoom,bt,yt);if(K(pt,qe),Y(pt,qe),Dt&&(pe&&(ke.copy(g,W),ke.copy(h,g)),we&&(ke.copy(C,W),ke.copy(S,C)),(dt||Et)&&(ke.copy(A,F),ke.copy(P,A)),vt&&(ke.copy(T,F),ke.copy(D,T)),Xe&&(ke.copy(I,F),ke.copy(M,I))),pe&&ke.copy(g,W),we&&ke.copy(C,W),(dt||Et)&&ke.copy(P,F),vt&&ke.copy(D,F),Et){var _r=w.distance(n.state.position,n.state.target);n.setState({radius:_r/5})}Xe&&ke.copy(M,F)}}function ye(){p=!1}function Te(Ie){var je=Ie.x,st=Ie.y,pt=Ie.spinX,qe=Ie.spinY,bt=Ie.dz,yt=Ie.buttons,Dt=Ie.modifiers;if(!re(je,st)){var ee=WX(pt*.075,qe*.075,bt*1e-4);ee<-i.maxWheelDelta?ee=-i.maxWheelDelta:ee>i.maxWheelDelta&&(ee=i.maxWheelDelta),rr.match(i.bindings.scrollZoom,yt,Dt)&&(P[1]+=ee),rr.match(i.bindings.scrollFocus,yt,Dt)&&(D[1]+=ee)}}function Oe(Ie){var je=Ie.fractionDelta,st=Ie.buttons,pt=Ie.modifiers;rr.match(i.bindings.scrollZoom,st,pt)&&(p=!0,P[1]+=i.gestureScaleFactor*je)}function Ue(Ie){var je=Ie.deltaScale;p=!0,P[1]+=i.gestureScaleFactor*je}function Qe(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),f.unsubscribe(),l.unsubscribe())}var Ge=ke.create(.005,0);function Je(Ie){if(!(i.animate.name!=="spin"||i.animate.params.speed===0||p)){var je=i.animate.params.speed/1e3;Ge[0]=60*Math.min(Math.abs(Ie),1e3/8)/1e3*je,ke.add(g,h,Ge)}}var Ze=0,rt=ke.create(.005,0);function et(Ie){if(!(i.animate.name!=="rock"||i.animate.params.speed===0||p)){var je=Ie/1e3*i.animate.params.speed,st=wr(i.animate.params.angle)/$(),pt=Math.sin(Ze*Math.PI*2)*st,qe=Math.sin((Ze+je)*Math.PI*2)*st;rt[0]=qe-pt,ke.add(g,h,rt),Ze+=je,Ze>=1&&(Ze=0)}}function St(){Ze=0}function De(Ie){O=-1,z(Ie)}return{viewport:o,get isAnimating(){return i.animate.name!=="off"},get props(){return i},setProps:function(Ie){var je;((je=Ie.animate)===null||je===void 0?void 0:je.name)==="rock"&&i.animate.name!=="rock"&&St(),Object.assign(i,Ie)},start:De,update:z,reset:de,dispose:Qe}}e.create=t})(Q4||(Q4={}));var c2;(function(e){function t(){return{view:oe.identity(),position:w.create(0,0,0),direction:w.create(0,0,-1),up:w.create(0,1,0)}}e.create=t;var r=w.zero();function n(a){w.add(r,a.position,a.direction),oe.lookAt(a.view,a.position,r,a.up)}e.update=n})(c2||(c2={}));var C2e=function(){function e(){this.removeList=N_(),this.removeMap=new Map,this.addList=N_(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),gh=new To("98");function DO(e,t,r){gh.reset();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var i=e[n].values.boundingSphere.ref.value;!i.radius||gh.includeSphere(i)}gh.finishedIncludeStep();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;!o.radius||gh.radiusSphere(o)}return gh.getSphere(t)}function w2e(e,t){var r=(e.getProgram("colorBlended")||e.getProgram("colorWboit")).id,n=(t.getProgram("colorBlended")||e.getProgram("colorWboit")).id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}var cm;(function(e){function t(r,n){n===void 0&&(n=KP);var a=new Map,i=[],o=Me(),s=Me(),u=[],l=[],c=!0,d=!0,f=c2.create(),p=f.view,v=f.position,m=f.direction,h=f.up;function g(T){if(a.has(T))return console.warn("RenderObject with id '".concat(T.id,"' already present")),a.get(T);var D=Yce(r,T,n);return i.push(D),T.type==="direct-volume"?l.push(D):u.push(D),a.set(T,D),c=!0,d=!0,D}function y(T){var D=a.get(T);D&&(D.dispose(),If(i,D),If(u,D),If(l,D),a.delete(T),c=!0,d=!0)}var b=100;function S(T){for(var D=fn(),I=0;;){var M=C.tryGetRemove();if(!M)break;if(y(M),++I%b===0&&fn()-D>T)return!1}for(;;){var M=C.tryGetAdd();if(!M)break;if(g(M),++I%b===0&&fn()-D>T)return!1}return i.sort(w2e),!0}var C=new C2e,x=-1;function A(){for(var T=23,D=0,I=i.length;D<I;++D)!i[D].state.visible||(T=31*T+i[D].id|0);return T=I8(T),T===-1&&(T=0),T}function P(){var T=A();return T!==x?(d=!0,!0):!1}return{view:p,position:v,direction:m,up:h,renderables:i,primitives:{view:p,position:v,direction:m,up:h,renderables:u},volumes:{view:p,position:v,direction:m,up:h,renderables:l},syncVisibility:P,update:function(T,D){var I;if(c2.update(f),T)for(var M=0,B=T.length;M<B;++M)(I=a.get(T[M]))===null||I===void 0||I.update();else for(var M=0,B=i.length;M<B;++M)i[M].update();D?P():(c=!0,d=!0)},add:function(T){return C.add(T)},remove:function(T){return C.remove(T)},commit:function(T){return T===void 0&&(T=Number.MAX_VALUE),S(T)},get needsCommit(){return!C.isEmpty},has:function(T){return a.has(T)},clear:function(){for(var T=0,D=i.length;T<D;++T)i[T].dispose();i.length=0,a.clear(),c=!0,d=!0},forEach:function(T){a.forEach(T)},get count(){return i.length},get boundingSphere(){return c&&(DO(i,o,!1),c=!1),o},get boundingSphereVisible(){return d&&(DO(i,s,!0),d=!1,x=A()),s}}}e.create=t})(cm||(cm={}));var Z4=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Un.createDefaultSnapshot(),this._target=Un.createDefaultSnapshot(),this._current=Un.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&Un.copySnapshot(this._source,this.camera.state),this.inTransition||Un.copySnapshot(this._target,this.camera.state),Un.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode!="undefined"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){Un.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(!!this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),Un.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=$r.identity();function r(n,a,i,o){Un.copySnapshot(n,o),$r.slerp(t,$r.Identity,$r.rotationTo(t,i.up,o.up),a),w.transformQuat(n.up,i.up,t),w.lerp(n.target,i.target,o.target,a),w.lerp(n.position,i.position,o.position,a),n.radius=sa(i.radius,o.radius,a),n.radiusMax=sa(i.radiusMax,o.radiusMax,a),n.fov=sa(i.fov,o.fov,a),n.fog=sa(i.fog,o.fog,a)}e.defaultTransition=r})(Z4||(Z4={}));var MO=w(),RO=w(),Hy=Jt(),Un=function(){function e(t,r,n){r===void 0&&(r=Sa.create(0,0,128,128)),n===void 0&&(n={}),this.view=oe.identity(),this.projection=oe.identity(),this.projectionView=oe.identity(),this.inverseProjectionView=oe.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new Z4(this),this.stateChanged=new fl(this.state),this.prevProjection=oe.identity(),this.prevView=oe.identity(),this.deltaDirection=w(),this.newPosition=w(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window!="undefined"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){w.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){w.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){w.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*w.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,T2e(this),this.state.mode){case"orthographic":_2e(this);break;case"perspective":A2e(this);break;default:throw new Error("unknown camera mode")}var n=!oe.areEqual(this.projection,this.prevProjection,zr)||!oe.areEqual(this.view,this.prevView,zr);if(n){if(oe.mul(this.projectionView,this.projection,this.view),!oe.tryInvert(this.inverseProjectionView,this.projectionView))return oe.copy(this.view,this.prevView),oe.copy(this.projection,this.prevProjection),oe.mul(this.projectionView,this.projection,this.view),!1;oe.copy(this.prevView,this.view),oe.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);w.sub(this.deltaDirection,this.target,this.position),a&&w.matchDirection(this.deltaDirection,a,this.deltaDirection),w.setMagnitude(this.deltaDirection,this.deltaDirection,o),w.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=w.clone(t),s.radius=i,s.position=w.clone(this.newPosition),n&&w.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);w.copy(this.deltaDirection,a),w.setMagnitude(this.deltaDirection,this.deltaDirection,o),w.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=w.clone(t),s.radius=i,s.position=w.clone(this.newPosition),w.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.project=function(t,r){return y2e(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return U1(t,r,this.viewport,this.inverseProjectionView)},e.prototype.getPixelSize=function(t){return this.project(Hy,t),this.unproject(MO,Hy),Hy[0]+=1,this.unproject(RO,Hy),w.distance(MO,RO)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,p,v){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=p,u.height=v}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function a(u,l,c,d){var f=Math.max(u,.01),p=c/d,v=d<c?1:p;return Math.abs(f/v/Math.sin(l/2))}e.targetDistance=a;function i(){return{mode:"perspective",fov:Math.PI/4,position:w.create(0,0,100),up:w.create(0,1,0),target:w.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=i;function o(u,l){return l&&(typeof l.mode!="undefined"&&(u.mode=l.mode),typeof l.fov!="undefined"&&(u.fov=l.fov),typeof l.position!="undefined"&&w.copy(u.position,l.position),typeof l.up!="undefined"&&w.copy(u.up,l.up),typeof l.target!="undefined"&&w.copy(u.target,l.target),typeof l.radius!="undefined"&&(u.radius=l.radius),typeof l.radiusMax!="undefined"&&(u.radiusMax=l.radiusMax),typeof l.fog!="undefined"&&(u.fog=l.fog),typeof l.clipFar!="undefined"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&w.exactEquals(u.position,l.position)&&w.exactEquals(u.up,l.up)&&w.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(Un||(Un={}));function _2e(e){var t=e.viewport,r=e.zoom,n=e.near,a=e.far,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,p=(u+l)/2,v=f-c,m=f+c,h=p+d,g=p-d;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),S=(s-o)/i.width,C=(u-l)/i.height;v+=S*(i.offsetX/y),m=v+S*(i.width/y),h-=C*(i.offsetY/b),g=h-C*(i.height/b)}oe.ortho(e.projection,v,m,h,g,n,a),oe.lookAt(e.view,e.position,e.target,e.up)}function A2e(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),oe.perspective(e.projection,u,u+s,i,i-o,r,n),oe.lookAt(e.view,e.position,e.target,e.up)}function T2e(e){var t=e.state,r=t.radius,n=t.radiusMax,a=t.mode,i=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=w.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-i)/50,f=u-s*d,p=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=p}var _E={sceneBoundingSpheres:E.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:E.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:E.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:E.Boolean(!1,{description:"Show bounding spheres of visible instances."})},P2e=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=cm.create(t,MS),this.parent=r,this._props=_(_({},E.getDefaultValues(_E)),n)}return e.prototype.update=function(){var t=this,r=Gy(this.scene,this.parent.boundingSphere,this.sceneData,tr.lightgrey,I2e);r&&(this.sceneData=r);var n=Gy(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,tr.black,D2e);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=Gy(t.scene,a.values.boundingSphere.ref.value,o,tr.tomato,M2e);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),l=Gy(t.scene,a.values.invariantBoundingSphere.ref.value,u,tr.skyblue,R2e,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});l&&t.instancesData.set(i,l)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function Gy(e,t,r,n,a,i){if(!r||!Me.equals(r.boundingSphere,t)){var o=E2e(t,r&&r.mesh),s=r?r.renderObject:O2e(o,n,a,i);return r?R.updateIfChanged(s.values.drawCount,Fa.getDrawCount(o)):e.add(s),{boundingSphere:Me.clone(t),renderObject:s,mesh:o}}}function E2e(e,t){var r=2,n=qS(r),a=ct.createState(n,n/2,t);if(e.radius&&(la(a,e.center,e.radius,r),Me.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++){var s=o[i];la(a,s,1,0)}return ct.getMesh(a)}var I2e=oc(),D2e=oc(),M2e=oc(),R2e=oc();function O2e(e,t,r,n){var a=Rt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return Lm("mesh",a,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}var b3=w(),S3=w(),OO=w(),uV={maxFps:E.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:E.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})},B2e=function(){function e(t,r,n,a,i){var o=this;i===void 0&&(i={}),this.canvasIdentify=t,this.lociGetter=r,this.input=n,this.camera=a,this.ev=El.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=Yt.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=rp.create(0),this.button=rp.create(0),this.modifiers=Vs.None,this.props=_(_({},E.getDefaultValues(uV)),i),n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,p=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,p)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:ke.create(this.startX,this.startY),pageEnd:ke.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a==null?void 0:a.id,this.position=a==null?void 0:a.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var i=this.getLoci(this.id,this.position);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:ke.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id,this.position);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:ke.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,Yt.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Yt.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(1,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(2,0)},e.prototype.modify=function(t){Vs.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:ke.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,a=n.input,i=n.camera.viewport;return t*=a.pixelRatio,r*=a.pixelRatio,t>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.getLoci=function(t,r){var n,a=this.lociGetter(t),i=a.repr,o=a.loci;if(r&&i&&Ot.isLoci(o)&&o.bonds.length===2){var s=o.bonds[0],u=s.aUnit,l=s.aIndex;u.conformation.position(u.elements[l],b3),w.sub(OO,this.camera.state.position,this.camera.state.target),w.projectPointOnPlane(S3,r,OO,b3);var c=this.camera.getPixelSize(S3),d=i.theme.size.size(o.bonds[0])*((n=i.props.sizeFactor)!==null&&n!==void 0?n:1);if(i.props.lineSizeAttenuation===!1&&(d*=c/2),d+=this.props.preferAtomPixelPadding*c,w.distance(S3,b3)<d)return{repr:i,loci:Ot.toFirstStructureElementLoci(o)}}return{repr:i,loci:o}},e.prototype.dispose=function(){this.ev.dispose()},e}(),k2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,L2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,F2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,N2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb = mix(uOutlineColor, color.rgb, outline);
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,U2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,z2e={edgeThresholdMin:E.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:E.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:E.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:E.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},V2e=function(){function e(t,r){this.webgl=t,this.renderable=q2e(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){R.update(this.renderable.values.uTexSizeInv,ke.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(R.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),R.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),R.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),R.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),R.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),H2e=_(_({},Ca),{tColor:Wt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),dEdgeThresholdMin:qt("number"),dEdgeThresholdMax:qt("number"),dIterations:qt("number"),dSubpixelQuality:qt("number")}),G2e=ln("fxaa",yi,U2e);function q2e(e,t){var r=t.getWidth(),n=t.getHeight(),a=_(_({},wa),{tColor:R.create(t),uTexSizeInv:R.create(ke.create(1/r,1/n)),dEdgeThresholdMin:R.create(.0312),dEdgeThresholdMax:R.create(.125),dIterations:R.create(12),dSubpixelQuality:R.create(.3)}),i=_({},H2e),o=ea(e,"triangles",G2e,i,a);return ta(o,a)}var j2e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,W2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,X2e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Y2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,K2e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Q2e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,Z2e={edgeThreshold:E.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:E.Numeric(16,{min:0,max:32,step:1})},$2e=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement=="undefined"){Ar&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=tSe(t,r),this.weightsRenderable=aSe(t,this.edgesTarget.texture),this.blendRenderable=sSe(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),R.update(this.edgesRenderable.values.uViewport,Sa.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),R.update(this.weightsRenderable.values.uViewport,Sa.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),R.update(this.blendRenderable.values.uViewport,Sa.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),R.update(this.edgesRenderable.values.uTexSizeInv,ke.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.weightsRenderable.values.uTexSizeInv,ke.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.blendRenderable.values.uTexSizeInv,ke.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(R.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(R.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(R.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(R.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),J2e=_(_({},Ca),{tColor:Wt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uViewport:Re("v4"),dEdgeThreshold:qt("number")}),eSe=ln("smaa-edges",K2e,Q2e);function tSe(e,t){var r=t.getWidth(),n=t.getHeight(),a=_(_({},wa),{tColor:R.create(t),uTexSizeInv:R.create(ke.create(1/r,1/n)),uViewport:R.create(Jt()),dEdgeThreshold:R.create(.1)}),i=_({},J2e),o=ea(e,"triangles",eSe,i,a);return ta(o,a)}var rSe=_(_({},Ca),{tEdges:Wt("texture","rgba","ubyte","linear"),tArea:Wt("texture","rgb","ubyte","linear"),tSearch:Wt("texture","rgba","ubyte","nearest"),uTexSizeInv:Re("v2"),uViewport:Re("v4"),dMaxSearchSteps:qt("number")}),nSe=ln("smaa-weights",X2e,Y2e);function aSe(e,t){var r=t.getWidth(),n=t.getHeight(),a=p4(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),i=p4(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=_(_({},wa),{tEdges:R.create(t),tArea:R.create(a),tSearch:R.create(i),uTexSizeInv:R.create(ke.create(1/r,1/n)),uViewport:R.create(Jt()),dMaxSearchSteps:R.create(16)});gR(uSe(),o.tArea,a),gR(lSe(),o.tSearch,i);var s=_({},rSe),u=ea(e,"triangles",nSe,s,o);return ta(u,o)}var iSe=_(_({},Ca),{tColor:Wt("texture","rgba","ubyte","linear"),tWeights:Wt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uViewport:Re("v4")}),oSe=ln("smaa-blend",j2e,W2e);function sSe(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=_(_({},wa),{tColor:R.create(t),tWeights:R.create(r),uTexSizeInv:R.create(ke.create(1/n,1/a)),uViewport:R.create(Jt())}),o=_({},iSe),s=ea(e,"triangles",oSe,o,i);return ta(s,i)}function uSe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function lSe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var cSe=_(_({},Ca),{tDepth:Wt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),dOrthographic:qt("number"),uNear:Re("f"),uFar:Re("f"),uMaxPossibleViewZDiff:Re("f")});function dSe(e,t){var r=_(_({},wa),{tDepth:R.create(t),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight())),dOrthographic:R.create(0),uNear:R.create(1),uFar:R.create(1e4),uMaxPossibleViewZDiff:R.create(.5)}),n=_({},cSe),a=ln("outlines",yi,k2e),i=ea(e,"triangles",a,n,r);return ta(i,r)}var fSe=_(_({},Ca),{tDepth:Wt("texture","rgba","ubyte","nearest"),uSamples:Re("v3[]"),dNSamples:qt("number"),uProjection:Re("m4"),uInvProjection:Re("m4"),uBounds:Re("v4"),uTexSize:Re("v2"),uRadius:Re("f"),uBias:Re("f")});function pSe(e,t){var r=_(_({},wa),{tDepth:R.create(t),uSamples:R.create([0,0,1]),dNSamples:R.create(32),uProjection:R.create(oe.identity()),uInvProjection:R.create(oe.identity()),uBounds:R.create(Jt()),uTexSize:R.create(ke.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:R.create(8),uBias:R.create(.025)}),n=_({},fSe),a=ln("ssao",yi,L2e),i=ea(e,"triangles",a,n,r);return ta(i,r)}var vSe=_(_({},Ca),{tSsaoDepth:Wt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uKernel:Re("f[]"),dOcclusionKernelSize:qt("number"),uBlurDirectionX:Re("f"),uBlurDirectionY:Re("f"),uMaxPossibleViewZDiff:Re("f"),uNear:Re("f"),uFar:Re("f"),uBounds:Re("v4"),dOrthographic:qt("number")});function BO(e,t,r){var n=_(_({},wa),{tSsaoDepth:R.create(t),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight())),uKernel:R.create([0]),dOcclusionKernelSize:R.create(15),uBlurDirectionX:R.create(r==="horizontal"?1:0),uBlurDirectionY:R.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:R.create(.5),uNear:R.create(0),uFar:R.create(1e4),uBounds:R.create(Jt()),dOrthographic:R.create(0)}),a=_({},vSe),i=ln("ssao_blur",yi,F2e),o=ea(e,"triangles",i,a,n);return ta(o,n)}function mSe(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}function hSe(e,t){for(var r=[],n=0;n<t;n++){var a=(n*n+2*n+1)/(t*t);a=.1+a*(1-.1),r.push(e[n][0]*a),r.push(e[n][1]*a),r.push(e[n][2]*a)}return r}var gSe=_(_({},Ca),{tSsaoDepth:Wt("texture","rgba","ubyte","nearest"),tColor:Wt("texture","rgba","ubyte","nearest"),tDepth:Wt("texture","rgba","ubyte","nearest"),tOutlines:Wt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),dOrthographic:qt("number"),uNear:Re("f"),uFar:Re("f"),uFogNear:Re("f"),uFogFar:Re("f"),uFogColor:Re("v3"),uOutlineColor:Re("v3"),uTransparentBackground:Re("b"),uMaxPossibleViewZDiff:Re("f"),dOcclusionEnable:qt("boolean"),dOutlineEnable:qt("boolean"),dOutlineScale:qt("number"),uOutlineThreshold:Re("f")});function ySe(e,t,r,n,a){var i=_(_({},wa),{tSsaoDepth:R.create(a),tColor:R.create(t),tDepth:R.create(r),tOutlines:R.create(n),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight())),dOrthographic:R.create(0),uNear:R.create(1),uFar:R.create(1e4),uFogNear:R.create(1e4),uFogFar:R.create(1e4),uFogColor:R.create(w.create(1,1,1)),uOutlineColor:R.create(w.create(0,0,0)),uTransparentBackground:R.create(!1),uMaxPossibleViewZDiff:R.create(.5),dOcclusionEnable:R.create(!0),dOutlineEnable:R.create(!1),dOutlineScale:R.create(1),uOutlineThreshold:R.create(.33)}),o=_({},gSe),s=ln("postprocessing",yi,N2e),u=ea(e,"triangles",s,o,i);return ta(u,i)}var AE={occlusion:E.MappedStatic("on",{on:E.Group({samples:E.Numeric(32,{min:1,max:256,step:1}),radius:E.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:E.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:E.Numeric(15,{min:1,max:25,step:2})}),off:E.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:E.MappedStatic("off",{on:E.Group({scale:E.Numeric(1,{min:1,max:5,step:1}),threshold:E.Numeric(.33,{min:.01,max:1,step:.01}),color:E.Color($e(0))}),off:E.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:E.MappedStatic("smaa",{fxaa:E.Group(z2e),smaa:E.Group(Z2e),off:E.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},rl=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,a=r.depthTexture,i=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(i,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(i,o,!1),this.outlinesRenderable=dSe(t,a),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=w();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),w.normalize(u,u),w.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(i*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=pSe(t,a),this.ssaoBlurFirstPassRenderable=BO(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=BO(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=ySe(t,n.texture,a,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale();if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),R.update(this.renderable.values.uTexSize,ke.set(this.renderable.values.uTexSize.ref.value,t,r)),R.update(this.outlinesRenderable.values.uTexSize,ke.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),R.update(this.ssaoRenderable.values.uTexSize,ke.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),R.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,ke.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),R.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,ke.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,a){var i=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=a.outline.name==="on",c=a.occlusion.name==="on",d=oe.identity();if(oe.invert(d,t.projection),a.occlusion.name==="on"){R.update(this.ssaoRenderable.values.uProjection,t.projection),R.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,p=f[0],v=f[1],m=this.ssaoRenderable.values.uBounds,h=t.viewport,g=this.ssaoScale;if(Jt.set(m.ref.value,Math.floor(h.x*g)/(p*g),Math.floor(h.y*g)/(v*g),Math.ceil((h.x+h.width)*g)/(p*g),Math.ceil((h.y+h.height)*g)/(v*g)),R.update(m,m.ref.value),R.update(this.ssaoBlurFirstPassRenderable.values.uBounds,m.ref.value),R.update(this.ssaoBlurSecondPassRenderable.values.uBounds,m.ref.value),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==a.occlusion.params.samples&&(o=!0,this.nSamples=a.occlusion.params.samples,R.update(this.ssaoRenderable.values.uSamples,hSe(this.randomHemisphereVector,this.nSamples)),R.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),R.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius)),R.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var y=mSe(this.blurKernelSize);R.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),R.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(a.outline.name==="on"){var b=a.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var S=Math.pow(1e3,b)/1e3,C=S*t.state.radiusMax,x=a.outline.params.scale-1;R.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),R.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),R.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,C),R.update(this.renderable.values.uOutlineColor,$e.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,a.outline.params.color)),R.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,C),this.renderable.values.dOutlineScale.ref.value!==x&&(i=!0),R.updateIfChanged(this.renderable.values.dOutlineScale,x)}R.updateIfChanged(this.renderable.values.uFar,t.far),R.updateIfChanged(this.renderable.values.uNear,t.near),R.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),R.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),R.update(this.renderable.values.uFogColor,$e.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),R.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(i=!0),R.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(i=!0),R.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(i=!0),R.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),i&&this.renderable.update();var A=this.webgl,P=A.gl,T=A.state;T.enable(P.SCISSOR_TEST),T.disable(P.BLEND),T.disable(P.DEPTH_TEST),T.depthMask(!1);var D=t.viewport,I=D.x,M=D.y,B=D.width,U=D.height;P.viewport(I,M,B,U),P.scissor(I,M,B,U)},e.prototype.render=function(t,r,n,a,i){if(this.updateState(t,n,a,i),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),p=Math.ceil(l*this.ssaoScale),v=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,p,v),this.webgl.gl.scissor(d,f,p,v),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var m=this.webgl,h=m.gl,g=m.state;g.clearColor(0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),this.renderable.render()},e}(),x3=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.fxaa=new V2e(t,this.target.texture),this.smaa=new $2e(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var a=rl.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var a=rl.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),bSe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,SSe=_(_({},Ca),{tColor:Wt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uWeight:Re("f")}),xSe=ln("compose",yi,bSe);function CSe(e,t){var r=_(_({},wa),{tColor:R.create(t),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight())),uWeight:R.create(1)}),n=_({},SSe),a=ea(e,"triangles",xSe,n,r);return ta(a,r)}var lV={mode:E.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:E.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."})},d2=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":a&&i?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=CSe(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),R.update(this.compose.values.uTexSize,ke.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i){return n.multiSample.mode==="temporal"&&!i?this.renderTemporalMultiSample(t,r,n,a):(this.renderMultiSample(r,a,n),-2)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n){var a=t.camera,i=this,o=i.compose,s=i.composeTarget,u=i.drawPass,l=i.webgl,c=l.gl,d=l.state,f=$4[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],p=a.viewport,v=p.x,m=p.y,h=p.width,g=p.height,y=1/f.length,b=1/32;a.viewOffset.enabled=!0,R.update(o.values.tColor,u.getColorTarget(n.postprocessing).texture),o.update();for(var S=0;S<f.length;++S){var C=f[S];Un.setViewOffset(a.viewOffset,h,g,C[0],C[1],h,g),a.update();var x=-.5+(S+.5)/f.length,A=y+b*x;R.update(o.values.uWeight,A),u.render(t,n,!1),s.bind(),d.enable(c.BLEND),d.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),d.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE),d.disable(c.DEPTH_TEST),d.depthMask(!1),c.viewport(v,m,h,g),c.scissor(v,m,h,g),S===0&&(d.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),o.render()}R.update(o.values.uWeight,1),R.update(o.values.tColor,s.texture),o.update(),this.bindOutputTarget(r),c.viewport(v,m,h,g),c.scissor(v,m,h,g),d.disable(c.BLEND),o.render(),a.viewOffset.enabled=!1,a.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,a){var i=r.camera,o=this,s=o.compose,u=o.composeTarget,l=o.holdTarget,c=o.drawPass,d=o.webgl,f=d.gl,p=d.state,v=$4[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(t===-2||t>=v.length)return-2;var m=i.viewport,h=m.x,g=m.y,y=m.width,b=m.height,S=1/v.length;if(t===-1)c.render(r,n,!1),R.update(s.values.uWeight,1),R.update(s.values.tColor,c.getColorTarget(n.postprocessing).texture),s.update(),l.bind(),p.disable(f.BLEND),p.disable(f.DEPTH_TEST),p.depthMask(!1),f.viewport(h,g,y,b),f.scissor(h,g,y,b),s.render(),t+=1;else{i.viewOffset.enabled=!0,R.update(s.values.tColor,c.getColorTarget(n.postprocessing).texture),R.update(s.values.uWeight,S),s.update();for(var C=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2)),x=0;x<C;++x){var A=v[t];if(Un.setViewOffset(i.viewOffset,y,b,A[0],A[1],y,b),i.update(),c.render(r,n,!1),u.bind(),p.enable(f.BLEND),p.blendEquationSeparate(f.FUNC_ADD,f.FUNC_ADD),p.blendFuncSeparate(f.ONE,f.ONE,f.ONE,f.ONE),p.disable(f.DEPTH_TEST),p.depthMask(!1),f.viewport(h,g,y,b),f.scissor(h,g,y,b),t===0&&(p.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),s.render(),t+=1,t>=v.length)break}}this.bindOutputTarget(a),f.viewport(h,g,y,b),f.scissor(h,g,y,b);var P=t*S;return P>0&&(R.update(s.values.uWeight,1),R.update(s.values.tColor,u.texture),s.update(),p.disable(f.BLEND),s.render()),P<1&&(R.update(s.values.uWeight,1-P),R.update(s.values.tColor,l.texture),s.update(),P===0?p.disable(f.BLEND):p.enable(f.BLEND),s.render()),i.viewOffset.enabled=!1,i.update(),t>=v.length?-2:t},e}(),$4=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];$4.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var cV=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,a){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!a),this.sampleIndex<0},e}(),dV={eyeSeparation:E.Numeric(.064,{min:.01,max:.5,step:.001}),focus:E.Numeric(10,{min:1,max:100,step:.01})},wSe=E.getDefaultValues(dV),dm=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new kO,this.right=new kO,this.props=_(_({},wSe),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),_Se(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(dm||(dm={}));var kO=function(){function e(){this.viewport=Sa.create(0,0,0,0),this.view=oe(),this.projection=oe(),this.projectionView=oe(),this.inverseProjectionView=oe(),this.state=Un.createDefaultSnapshot(),this.viewOffset=Un.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),LO=oe.identity(),FO=oe.identity();function _Se(e,t,r,n){Sa.copy(r.viewport,e.viewport),oe.copy(r.view,e.view),oe.copy(r.projection,e.projection),Un.copySnapshot(r.state,e.state),Un.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,Sa.copy(n.viewport,e.viewport),oe.copy(n.view,e.view),oe.copy(n.projection,e.projection),Un.copySnapshot(n.state,e.state),Un.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;LO[12]=-o,FO[12]=o,l=-u*i+s,c=u*i+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),oe.mul(r.view,r.view,LO),oe.mul(r.projectionView,r.projection,r.view),oe.invert(r.inverseProjectionView,r.projectionView),l=-u*i-s,c=u*i-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),oe.mul(n.view,n.view,FO),oe.mul(n.projectionView,n.projection,n.view),oe.invert(n.inverseProjectionView,n.projectionView)}var C3=Math.pow(2,24)-2,ASe=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,a,i,o){var s=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,i,null,o),t.renderPick(n.volumes,r,i,s,o),t.renderPick(a.handle.scene,r,i,null,o),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderPick(a.camera.scene,a.camera.camera,i,null,o))},e.prototype.render=function(t,r,n,a){this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",1),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pick",2),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",3),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth",0)},e}(),TSe=function(){function e(t,r,n,a,i,o,s){s===void 0&&(s=1),this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.pickPadding=s,this.dirty=!0,this.viewport=Sa(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){Sa.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=XX(Math.round(this.pickScale*this.pickPadding))},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return Ule(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return qP(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),l.setPixelRatio(this.pickScale),dm.is(t)?(l.setViewport(n,a,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,a,i-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,a,i,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identifyInternal=function(t,r,n){var a=this,i=a.webgl,o=a.pickScale;if(!i.isContextLost){t*=i.pixelRatio,r*=i.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===C3)){var p=this.getId(c,d,this.instanceBuffer);if(!(p===-1||p===C3)){var v=this.getId(c,d,this.groupBuffer);if(!(v===-1||v===C3)){var m=this.getDepth(c,d),h=w.create(t,s.height-r,m);if(dm.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(h[0]=s.x+(u-g)*2,U1(h,h,s,n.right.inverseProjectionView)):(h[0]=s.x+u*2,U1(h,h,s,n.left.inverseProjectionView))}else U1(h,h,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:v},position:h}}}}}}},e.prototype.identify=function(t,r,n){for(var a=0,i=this.spiral;a<i.length;a++){var o=i[a],s=this.identifyInternal(t+o[0],r+o[1],n);if(s)return s}},e}(),PSe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,ESe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,ISe=_(_({},Ca),{tWboitA:Wt("texture","rgba","float","nearest"),tWboitB:Wt("texture","rgba","float","nearest"),uTexSize:Re("v2")}),DSe=ln("evaluate-wboit",yi,ESe);function MSe(e,t,r){var n=_(_({},wa),{tWboitA:R.create(t),tWboitB:R.create(r),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight()))}),a=_({},ISe),i=ea(e,"triangles",DSe,a,n);return ta(i,n)}var RSe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var a=t.resources;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=MSe(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.textureA.define(t,r),this.textureB.define(t,r),R.update(this.renderable.values.uTexSize,ke.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(!a||!i||!o||!n){if(Ar){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "wboit"'))}return!1}else return!0},e}(),OSe=`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`,BSe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`,fV={enabled:E.Boolean(!0),highlightEdgeColor:E.Color($e.darken($e.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:E.Color($e.darken($e.fromNormalizedRgb(.2,1,.1),1)),edgeScale:E.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),ghostEdgeStrength:E.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:E.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},NO=function(){function e(t,r,n){this.webgl=t,this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=FSe(t,this.maskTarget.texture),this.overlay=zSe(t,this.edgesTarget.texture)}return e.isEnabled=function(t){return t.enabled},e.prototype.setEdgeState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.ONE,n.ONE),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setOverlayState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u)},e.prototype.setSize=function(t,r){var n=this.depthTarget.getWidth(),a=this.depthTarget.getHeight();(t!==n||r!==a)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),R.update(this.edge.values.uTexSizeInv,ke.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.overlay.values.uTexSizeInv,ke.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t){var r=t.highlightEdgeColor,n=t.selectEdgeColor,a=t.edgeScale,i=t.innerEdgeFactor,o=t.ghostEdgeStrength,s=this.edge.values,u=Math.round(a*this.webgl.pixelRatio);s.dEdgeScale.ref.value!==u&&(R.update(s.dEdgeScale,u),this.edge.update());var l=this.overlay.values;R.update(l.uHighlightEdgeColor,$e.toVec3Normalized(l.uHighlightEdgeColor.ref.value,r)),R.update(l.uSelectEdgeColor,$e.toVec3Normalized(l.uSelectEdgeColor.ref.value,n)),R.update(l.uInnerEdgeFactor,i),R.update(l.uGhostEdgeStrength,o)},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render()},e}(),kSe=_(_({},Ca),{tMaskTexture:Wt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),dEdgeScale:qt("number")}),LSe=ln("edge",yi,BSe);function FSe(e,t){var r=t.getWidth(),n=t.getHeight(),a=_(_({},wa),{tMaskTexture:R.create(t),uTexSizeInv:R.create(ke.create(1/r,1/n)),dEdgeScale:R.create(1)}),i=_({},kSe),o=ea(e,"triangles",LSe,i,a);return ta(o,a)}var NSe=_(_({},Ca),{tEdgeTexture:Wt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uHighlightEdgeColor:Re("v3"),uSelectEdgeColor:Re("v3"),uGhostEdgeStrength:Re("f"),uInnerEdgeFactor:Re("f")}),USe=ln("overlay",yi,OSe);function zSe(e,t){var r=t.getWidth(),n=t.getHeight(),a=_(_({},wa),{tEdgeTexture:R.create(t),uTexSizeInv:R.create(ke.create(1/r,1/n)),uHighlightEdgeColor:R.create(w()),uSelectEdgeColor:R.create(w()),uGhostEdgeStrength:R.create(0),uInnerEdgeFactor:R.create(0)}),i=_({},NSe),o=ea(e,"triangles",USe,i,a);return ta(o,a)}var VSe=_(_({},Ca),{tDepthPrimitives:Wt("texture","depth","ushort","nearest"),tDepthVolumes:Wt("texture","depth","ushort","nearest"),uTexSize:Re("v2"),dPackedDepth:qt("boolean")}),HSe=ln("depth-merge",yi,PSe);function GSe(e,t,r,n){var a=_(_({},wa),{tDepthPrimitives:R.create(t),tDepthVolumes:R.create(r),uTexSize:R.create(ke.create(t.getWidth(),t.getHeight())),dPackedDepth:R.create(n)}),i=_({},VSe),o=ea(e,"triangles",HSe,i,a);return ta(o,a)}var pV=function(){function e(t,r,n,a){this.webgl=t;var i=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=Tue(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!i.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=GSe(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=a?new RSe(t,r,n):void 0,this.marking=new NO(t,r,n),this.postprocessing=new rl(t,this),this.antialiasing=new x3(t,this),this.copyFboTarget=FR(t,this.colorTarget.texture),this.copyFboPostprocessing=FR(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!((t=this.wboit)===null||t===void 0?void 0:t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,a=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),R.update(this.depthMerge.values.uTexSize,ke.set(this.depthMerge.values.uTexSize.ref.value,t,r)),R.update(this.copyFboTarget.values.uTexSize,ke.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),R.update(this.copyFboPostprocessing.values.uTexSize,ke.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),((n=this.wboit)===null||n===void 0?void 0:n.supported)&&this.wboit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(!((o=this.wboit)===null||o===void 0?void 0:o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),rl.isEnabled(i)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,i),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),rl.isEnabled(i)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,a,i,o){if(a?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!a){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),rl.isEnabled(o)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=rl.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o){var s=n.volumes.renderables.length>0,u=rl.isEnabled(o.postprocessing),l=x3.isEnabled(o.postprocessing),c=NO.isEnabled(o.marking),d=r.viewport,f=d.x,p=d.y,v=d.width,m=d.height;if(t.setViewport(f,p,v,m),t.update(r),o.transparentBackground&&!l&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o.transparentBackground,o.postprocessing):this._renderBlended(t,r,n,!s&&!u&&!l&&i,o.transparentBackground,o.postprocessing),u?this.postprocessing.target.bind():!i||s||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),c){var h=o.marking.ghostEdgeStrength<1;h&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,h?this.marking.depthTarget.texture:null),this.marking.update(o.marking),this.marking.render(r.viewport,u?this.postprocessing.target:this.colorTarget)}a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r,null)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderBlended(a.camera.scene,a.camera.camera,null)),l?this.antialiasing.render(r,i,o.postprocessing):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),u?this.copyFboPostprocessing.render():(s||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n){var a=t.renderer,i=t.camera,o=t.scene,s=t.helper;a.setTransparentBackground(r.transparentBackground),a.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),a.setPixelRatio(this.webgl.pixelRatio),dm.is(i)?(this._render(a,i.left,o,s,n,r),this._render(a,i.right,o,s,n,r)):this._render(a,i,o,s,n,r)},e.prototype.getColorTarget=function(t){return x3.isEnabled(t)?this.antialiasing.target:rl.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),qSe=_(_({},Rt.Params),{alpha:_(_({},Rt.Params.alpha),{defaultValue:.51}),ignoreLight:_(_({},Rt.Params.ignoreLight),{defaultValue:!0}),colorX:E.Color(tr.red,{isEssential:!0}),colorY:E.Color(tr.green,{isEssential:!0}),colorZ:E.Color(tr.blue,{isEssential:!0}),scale:E.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),nx={axes:E.MappedStatic("on",{on:E.Group(qSe),off:E.Group({})},{cycle:!0,description:"Show camera orientation axes"})},vV=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(a,i){if(!n.renderObject||!J4(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,v=p*s+f;i(Ce.ofSingleton(v))&&(o=!0)}return o},this.scene=cm.create(t,MS),this.camera=new Un,w.set(this.camera.up,0,1,0),w.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Il(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var a=_(_({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=QSe(a),r.scene.add(r.renderObject),r.scene.commit(),w.set(r.camera.position,0,0,a.scale*200),oe.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=_({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?yr:WSe(this,n,a)},e.prototype.mark=function(t,r){return!mi.is(mi.Highlighting,r)||!J4(t)||t.data!==this?!1:ar.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(!!this.renderObject){XSe(this.camera,t.viewport,t.viewOffset),oe.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;oe.setTranslation(this.scene.view,w.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function jSe(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function WSe(e,t,r){return OS("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return jSe(t)})}function J4(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function XSe(e,t,r){var n=e.near,a=e.far,i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-i)/2,c=(s-u)/2,d=(o+i)/2,f=(s+u)/2,p=d-l,v=d+l,m=f+c,h=f-c;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;p+=g*r.offsetX,v=p+g*r.width,m-=y*r.offsetY,h=m-y*r.height}oe.ortho(e.projection,p,v,m,h,n,a)}function YSe(e,t){var r=ct.createState(512,256,t),n=.075*e,a=w.scale(w(),w.unitX,e),i=w.scale(w(),w.unitY,e),o=w.scale(w(),w.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,la(r,w.origin,n,2),r.currentGroup=1,la(r,a,n,2),ga(r,w.origin,a,1,s),r.currentGroup=2,la(r,i,n,2),ga(r,w.origin,i,1,s),r.currentGroup=3,la(r,o,n,2),ga(r,w.origin,o,1,s),w.scale(a,a,.5),w.scale(i,i,.5),w.scale(o,o,.5),r.currentGroup=4,ct.addTriangle(r,w.origin,a,i),ct.addTriangle(r,w.origin,i,a);var u=w.add(w(),a,i);ct.addTriangle(r,u,a,i),ct.addTriangle(r,u,i,a),r.currentGroup=5,ct.addTriangle(r,w.origin,a,o),ct.addTriangle(r,w.origin,o,a);var l=w.add(w(),a,o);ct.addTriangle(r,l,a,o),ct.addTriangle(r,l,o,a),r.currentGroup=6,ct.addTriangle(r,w.origin,i,o),ct.addTriangle(r,w.origin,o,i);var c=w.add(w(),i,o);return ct.addTriangle(r,c,i,o),ct.addTriangle(r,c,o,i),ct.getMesh(r)}function KSe(e,t){var r=100*e.scale,n=YSe(r,t==null?void 0:t.geometry);n.setBoundingSphere(Me.create(w.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return tr.grey}};return xr.create("axes",{},n,a,function(){return 1},function(){return""})}function QSe(e){var t=KSe(e);return xr.createRenderObject(t,e)}var ZSe={transparentBackground:E.Boolean(!1),multiSample:E.Group(lV),postprocessing:E.Group(AE),marking:E.Group(fV),cameraHelper:E.Group(nx)},$Se=function(){function e(t,r,n,a,i,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=a,this._width=0,this._height=0,this._camera=new Un,this.props=_(_({},E.getDefaultValues(ZSe)),s),this.drawPass=new pV(t,128,128,o),this.multiSamplePass=new d2(t,this.drawPass),this.multiSampleHelper=new cV(this.multiSamplePass),this.helper={camera:new vV(t,this.props.cameraHelper),debug:i.debug,handle:i.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){Un.copySnapshot(this._camera.state,this.camera.state),Sa.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();var t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};d2.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(a=n==null?void 0:n.width)!==null&&a!==void 0?a:t,s=(i=n==null?void 0:n.height)!==null&&i!==void 0?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=Bf.create(u,o,s);return Bf.flipY(l),Bf.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),JSe=_(_({},Rt.Params),{alpha:_(_({},Rt.Params.alpha),{defaultValue:1}),ignoreLight:_(_({},Rt.Params.ignoreLight),{defaultValue:!0}),colorX:E.Color(tr.red,{isEssential:!0}),colorY:E.Color(tr.green,{isEssential:!0}),colorZ:E.Color(tr.blue,{isEssential:!0}),scale:E.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),mV={handle:E.MappedStatic("off",{on:E.Group(JSe),off:E.Group({})},{cycle:!0,description:"Show handle tool"})},exe=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=oe(),this.eachGroup=function(a,i){if(!n.renderObject||!UO(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,v=p*s+f;i(Ce.ofSingleton(v))&&(o=!0)}return o},this.scene=cm.create(t,MS),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Me.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),oe.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Me.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Il(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var a=_(_({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=axe(a),r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=_({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){!this.renderObject||(oe.setTranslation(this.renderObject.values.aTransform.ref.value,r),oe.fromMat3(this.renderObject.values.aTransform.ref.value,n),R.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id?yr:rxe(this,n,a)},e.prototype.mark=function(t,r){return!mi.is(mi.Highlighting,r)||!UO(t)||t.data!==this?!1:ar.mark(this.renderObject,t,r,this.eachGroup)},e}();function txe(e,t){var r=ct.createState(512,256,t),n=.05*e,a=w.scale(w(),w.unitX,e),i=w.scale(w(),w.unitY,e),o=w.scale(w(),w.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=Af.TranslateScreenXY,la(r,w.origin,n*3,2),r.currentGroup=Af.TranslateObjectX,la(r,a,n,2),ga(r,w.origin,a,1,s),r.currentGroup=Af.TranslateObjectY,la(r,i,n,2),ga(r,w.origin,i,1,s),r.currentGroup=Af.TranslateObjectZ,la(r,o,n,2),ga(r,w.origin,o,1,s),ct.getMesh(r)}var Af={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function rxe(e,t,r){return OS("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id ".concat(t," | Instance Id ").concat(r)})}function UO(e){return e.kind==="data-loci"&&e.tag==="handle"}function nxe(e,t){var r=10*e.scale,n=txe(r,t==null?void 0:t.geometry);n.setBoundingSphere(Me.create(w.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case Af.TranslateObjectX:return e.colorX;case Af.TranslateObjectY:return e.colorY;case Af.TranslateObjectZ:return e.colorZ;default:return tr.grey}};return xr.create("handle",{},n,a,function(){return 1},function(){return""})}function axe(e){var t=nxe(e);return xr.createRenderObject(t,e)}var ixe={debug:E.Group(_E),camera:E.Group({helper:E.Group(nx)}),handle:E.Group(mV)},oxe=E.getDefaultValues(ixe),sxe=function(){function e(t,r,n){n===void 0&&(n={});var a=_(_({},oxe),n);this.debug=new P2e(t,r,a.debug),this.camera=new vV(t,a.camera.helper),this.handle=new exe(t,a.handle)}return e}(),uxe=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new pV(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new ASe(t,this.draw,r.pickScale||.25),this.multiSample=new d2(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),ol={camera:E.Group({mode:E.Select("perspective",E.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:E.Group(nx,{isFlat:!0}),stereo:E.MappedStatic("off",{on:E.Group(dV),off:E.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:E.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:E.MappedStatic("on",{on:E.Group({intensity:E.Numeric(15,{min:1,max:100,step:1})}),off:E.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:E.Group({radius:E.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:E.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:E.MappedStatic("canvas",{canvas:E.Group({}),"static-frame":E.Group({x:E.Numeric(0),y:E.Numeric(0),width:E.Numeric(128),height:E.Numeric(128)}),"relative-frame":E.Group({x:E.Numeric(.33,{min:0,max:1,step:.01}),y:E.Numeric(.33,{min:0,max:1,step:.01}),width:E.Numeric(.5,{min:.01,max:1,step:.01}),height:E.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:E.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:E.Boolean(!1),multiSample:E.Group(lV),postprocessing:E.Group(AE),marking:E.Group(fV),renderer:E.Group(Y4),trackball:E.Group(sV),interaction:E.Group(uV),debug:E.Group(_E),handle:E.Group(mV)},TE=E.getDefaultValues(ol),eA;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,pickPadding:1,enableWboit:!0,preferWebGl1:!1};function t(r,n){n===void 0&&(n={});var a=_(_({},e.DefaultAttribs),n),i=a.antialias,o=a.preserveDrawingBuffer,s=a.pixelScale,u=a.preferWebGl1,l=Pue(r,{antialias:i,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:u});if(l===null)throw new Error("Could not create a WebGL rendering context");var c=X4.fromElement(r,{pixelScale:s,preventGestures:!0}),d=Rue(l,{pixelScale:s}),f=new uxe(d,n);if(Ar){var p=l.getExtension("WEBGL_lose_context");p&&r.addEventListener("mousedown",function(g){d.isContextLost||!g.shiftKey||!g.ctrlKey||!g.altKey||(Ar&&console.log("lose context"),p.loseContext(),setTimeout(function(){!d.isContextLost||(Ar&&console.log("restore context"),p.restoreContext())},1e3))},!1)}var v=new fl(0),m=function(g){d.setContextLost(),g.preventDefault(),Ar&&console.log("context lost"),v.next(fn())},h=function(){!d.isContextLost||(d.handleContextRestored(function(){f.draw.reset()}),Ar&&console.log("context restored"))};return r.addEventListener("webglcontextlost",m,!1),r.addEventListener("webglcontextrestored",h,!1),{canvas:r,webgl:d,input:c,passes:f,attribs:a,contextLost:v,contextRestored:d.contextRestored,dispose:function(g){c.dispose(),r.removeEventListener("webglcontextlost",m,!1),r.removeEventListener("webglcontextrestored",h,!1),d.destroy(g)}}}e.fromCanvas=t})(eA||(eA={}));var lxe=typeof window!="undefined"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},cxe=typeof window!="undefined"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},tA;(function(e){function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=_(_({},TE),n),l=new Map,c=new Map,d=new fl(0),f=fn(),p=new fl(0),v=new fl(0),m=a.gl,h=a.contextRestored,g=0,y=0,b=128,S=128;et();var C=cm.create(a,o.draw.wboitEnabled?dce:MS),x=new Un({position:w.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:S},{pixelScale:s.pixelScale}),A=new dm(x,u.camera.stereo.params),P=Q4.create(i,x,u.trackball),T=K4.create(a,u.renderer),D=new sxe(a,C,u),I=new TSe(a,T,C,D,o.pick,{x:g,y,width:b,height:S},s.pickPadding),M=new B2e(ge,K,i,x,u.interaction),B=new cV(o.multiSample),U=!1,V=void 0,F=void 0,Y=!1,W=!0;function K(De){var Ie=yr,je=Yt.Empty;if(De){var st=D.camera.getLoci(De);if(st!==yr)return{loci:st,repr:je};Ie=D.handle.getLoci(De),l.forEach(function(pt,qe){var bt=qe.getLoci(De);fi(bt)||(fi(Ie)||console.warn("found another loci, this should not happen"),Ie=bt,je=qe)})}return{loci:Ie,repr:je}}function $(De,Ie,je){je===void 0&&(je=!1);var st=De.repr,pt=De.loci,qe=!1;if(st?qe=st.mark(pt,Ie):(qe=D.handle.mark(pt,Ie),qe=D.camera.mark(pt,Ie)||qe,l.forEach(function(yt,Dt){qe=Dt.mark(pt,Ie)||qe})),qe)if(je)Z=!0;else{C.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var bt=I.dirty;H({force:!0,allowMulti:!0}),I.dirty=bt}}function J(De,Ie){if(a.isContextLost)return!1;var je=!1;if(Y&&(rt(!1),Y=!1,je=!0),g>m.drawingBufferWidth||g+b<0||y>m.drawingBufferHeight||y+S<0)return!1;var st=!1;P.update(j);var pt=x.update(),qe=De||pt||je||Z;Z=!1;var bt=B.update(qe,u.multiSample);if(qe||bt){var yt=x;u.camera.stereo.name==="on"&&(A.update(),yt=A);var Dt={renderer:T,camera:yt,scene:C,helper:D};if(d2.isEnabled(u.multiSample)){var ee=!pt&&Ie&&!P.isAnimating;B.render(Dt,u,!0,ee)}else o.draw.render(Dt,u,!0);I.dirty=!0,st=!0}return st}var Z=!1,N=!1,j=0,L=!1;function H(De){L||J(!!(De==null?void 0:De.force),!!(De==null?void 0:De.allowMulti))&&W&&p.next(fn()-f)}function G(){Z=!0}var q=0;function X(De,Ie){j=De,Se(Ie==null?void 0:Ie.isSynchronous),x.transition.tick(j),!(Ie==null?void 0:Ie.manualDraw)&&(H(),!x.transition.inTransition&&!a.isContextLost&&M.tick(j))}function Q(){X(fn()),q=lxe(Q)}function ue(De){f=De,P.start(De)}function le(){L=!1,P.start(fn()),q===0&&Q()}function ve(De){De===void 0&&(De=!1),L=De,cxe(q),q=0}function ge(De,Ie){var je=u.camera.stereo.name==="on"?A:x;return a.isContextLost?void 0:I.identify(De,Ie,je)}function Se(De){De===void 0&&(De=!1);var Ie=me(De);Ie&&(ae(),N&&(D.debug.isEnabled&&D.debug.update(),H({force:!0}),N=!1),v.next(fn()))}function ae(){if(!!U){var De=C.boundingSphereVisible,Ie=De.center,je=De.radius,st=P.props.autoAdjustMinMaxDistance;if(st.name==="on"){var pt=st.params.minDistanceFactor*je+st.params.minDistancePadding,qe=Math.max(st.params.maxDistanceFactor*je,st.params.maxDistanceMin);P.setProps({minDistance:pt,maxDistance:qe})}if(je>0){var bt=V===void 0?u.cameraResetDurationMs:V,yt=x.getFocus(Ie,je),Dt=typeof F=="function"?F(C,x):F,ee=Dt?_(_({},yt),Dt):yt;x.setState(_(_({},ee),{radiusMax:C.boundingSphere.radius}),bt)}V=void 0,F=void 0,U=!1}}var re=Me(),O=Me();function z(){if(x.state.radiusMax===0)return!0;if(x.transition.inTransition||F)return!1;var De=!0,Ie=!0;Me.set(O,x.state.target,x.state.radius);for(var je=0,st=C.renderables;je<st.length;je++){var pt=st[je];if(!!pt.state.visible){var qe=pt.values.boundingSphere.ref.value;if(!!qe.radius){Ie=!1;var bt=w.distance(O.center,qe.center);if((bt>O.radius||bt>qe.radius||qe.radius>x.state.radiusMax)&&!Me.includes(re,qe))return!0;Me.overlaps(O,qe)&&(De=!1)}}}return De||!Ie&&O.radius<=.1}var de=250;function me(De){return C.needsCommit?(Me.copy(re,C.boundingSphereVisible),C.commit(De?void 0:de)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(d.value===0||z())&&(U=!0),re.radius===0&&(V=0),x.setState({radiusMax:C.boundingSphere.radius},0),d.next(l.size),Ar&&ye(),!0):!1):!0}function ye(){console.table(C.renderables.map(function(pt){return{drawCount:pt.values.drawCount.ref.value,instanceCount:pt.values.instanceCount.ref.value,materialId:pt.materialId,renderItemId:pt.id}})),console.log(a.stats);var De=a.resources.getByteCounts(),Ie=De.texture,je=De.attribute,st=De.elements;console.log({texture:"".concat((Ie/1024/1024).toFixed(3)," MiB"),attribute:"".concat((je/1024/1024).toFixed(3)," MiB"),elements:"".concat((st/1024/1024).toFixed(3)," MiB")})}function Te(De){Ue(De);var Ie=l.get(De),je=new Set;De.renderObjects.forEach(function(st){return je.add(st)}),Ie?Pn.areEqual(je,Ie)||(je.forEach(function(st){Ie.has(st)||C.add(st)}),Ie.forEach(function(st){je.has(st)||C.remove(st)})):De.renderObjects.forEach(function(st){return C.add(st)}),l.set(De,je),C.update(De.renderObjects,!1),N=!0,Ar&&ye()}function Oe(De){Qe(De);var Ie=l.get(De);Ie&&(Ie.forEach(function(je){return C.remove(je)}),l.delete(De),N=!0,Ar&&ye())}function Ue(De){c.has(De)||c.set(De,De.updated.subscribe(function(Ie){De.state.syncManually||Te(De)}))}function Qe(De){var Ie=c.get(De);Ie&&(Ie.unsubscribe(),c.delete(De))}function Ge(){var De=C.boundingSphere.radius>0?100-Math.round(x.transition.target.radius/C.boundingSphere.radius*100):0;return{camera:{mode:x.state.mode,helper:_({},D.camera.props),stereo:_({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:x.state.fog>0?{name:"on",params:{intensity:x.state.fog}}:{name:"off",params:{}},cameraClipping:{far:x.state.clipFar,radius:De},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:_({},u.postprocessing),marking:_({},u.marking),multiSample:_({},u.multiSample),renderer:_({},T.props),trackball:_({},P.props),interaction:_({},M.props),debug:_({},D.debug.props),handle:_({},D.handle.props)}}var Je=h.subscribe(function(){I.dirty=!0,H({force:!0}),H({force:!0})}),Ze=new fl(0);function rt(De){De===void 0&&(De=!0),o.updateSize(),et(),St(),De&&G(),Ze.next(+new Date)}return{webgl:a,add:Te,remove:Oe,commit:Se,update:function(De,Ie){if(De){if(!l.has(De))return;C.update(De.renderObjects,!!Ie)}else C.update(void 0,!!Ie);N=!0},clear:function(){c.forEach(function(De){return De.unsubscribe()}),c.clear(),l.clear(),C.clear(),D.debug.clear(),G(),d.next(l.size)},syncVisibility:function(){x.state.radiusMax===0&&(U=!0,V=0),C.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),G()},requestDraw:G,tick:X,animate:le,resetTime:ue,pause:ve,resume:function(){L=!1},identify:ge,mark:$,getLoci:K,handleResize:rt,requestResize:function(){Y=!0},requestCameraReset:function(De){V=De==null?void 0:De.durationMs,F=De==null?void 0:De.snapshot,U=!0},camera:x,boundingSphere:C.boundingSphere,boundingSphereVisible:C.boundingSphereVisible,get notifyDidDraw(){return W},set notifyDidDraw(De){W=De},didDraw:p,commited:v,reprCount:d,resized:Ze,setProps:function(De,Ie){var je,st,pt;Ie===void 0&&(Ie=!1);var qe=typeof De=="function"?Il(Ge(),De):De,bt=Object.create(null);if(qe.camera&&qe.camera.mode!==void 0&&qe.camera.mode!==x.state.mode&&(bt.mode=qe.camera.mode),qe.cameraFog!==void 0&&qe.cameraFog.params){var yt=qe.cameraFog.name==="on"?qe.cameraFog.params.intensity:0;yt!==x.state.fog&&(bt.fog=yt)}if(qe.cameraClipping!==void 0&&(qe.cameraClipping.far!==void 0&&qe.cameraClipping.far!==x.state.clipFar&&(bt.clipFar=qe.cameraClipping.far),qe.cameraClipping.radius!==void 0)){var Dt=C.boundingSphere.radius/100*(100-qe.cameraClipping.radius);Dt>0&&Dt!==bt.radius&&(bt.radius=Math.max(Dt,.01))}if(Object.keys(bt).length>0&&x.setState(bt),((je=qe.camera)===null||je===void 0?void 0:je.helper)&&D.camera.setProps(qe.camera.helper),((st=qe.camera)===null||st===void 0?void 0:st.manualReset)!==void 0&&(u.camera.manualReset=qe.camera.manualReset),((pt=qe.camera)===null||pt===void 0?void 0:pt.stereo)!==void 0&&Object.assign(u.camera.stereo,qe.camera.stereo),qe.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=qe.cameraResetDurationMs),qe.transparentBackground!==void 0&&(u.transparentBackground=qe.transparentBackground),qe.viewport!==void 0){var ee=u.viewport===qe.viewport||u.viewport.name===qe.viewport.name&&U0(u.viewport.params,qe.viewport.params);ee||(u.viewport=qe.viewport,et(),St())}qe.postprocessing&&Object.assign(u.postprocessing,qe.postprocessing),qe.marking&&Object.assign(u.marking,qe.marking),qe.multiSample&&Object.assign(u.multiSample,qe.multiSample),qe.renderer&&T.setProps(qe.renderer),qe.trackball&&P.setProps(qe.trackball),qe.interaction&&M.setProps(qe.interaction),qe.debug&&D.debug.setProps(qe.debug),qe.handle&&D.handle.setProps(qe.handle),bt.mode==="orthographic"&&(u.camera.stereo.name="off"),Ie||G()},getImagePass:function(De){return De===void 0&&(De={}),new $Se(a,T,C,x,D,o.draw.wboitEnabled,De)},getRenderObjects:function(){var De=[];return C.forEach(function(Ie,je){return De.push(je)}),De},get props(){return Ge()},get input(){return i},get stats(){return T.stats},get interaction(){return M.events},dispose:function(){Je.unsubscribe(),C.clear(),D.debug.clear(),P.dispose(),T.dispose(),M.dispose()}};function et(){var De=g,Ie=y,je=b,st=S;u.viewport.name==="canvas"?(g=0,y=0,b=m.drawingBufferWidth,S=m.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*a.pixelRatio,S=u.viewport.params.height*a.pixelRatio,y=m.drawingBufferHeight-S-u.viewport.params.y*a.pixelRatio,b=u.viewport.params.width*a.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*m.drawingBufferWidth),S=Math.round(u.viewport.params.height*m.drawingBufferHeight),y=Math.round(m.drawingBufferHeight-S-u.viewport.params.y*m.drawingBufferHeight),b=Math.round(u.viewport.params.width*m.drawingBufferWidth)),(De!==g||Ie!==y||je!==b||st!==S)&&(Z=!0)}function St(){I.setViewport(g,y,b,S),T.setViewport(g,y,b,S),Sa.set(x.viewport,g,y,b,S),Sa.set(P.viewport,g,y,b,S)}}e.create=t})(tA||(tA={}));function dxe(e){hV(e)}function hV(e){ft.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(TE),e.events.canvas3d.settingsUpdated.next(void 0)}),ft.Canvas3D.SetSettings.subscribe(e,function(t){var r;!e.canvas3d||((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var fxe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:dxe,Canvas3DSetSettings:hV}),pd=Vs,Nf=rr.Trigger,pxe={hoverHighlightOnly:rr([Nf(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:rr([Nf(0,pd.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},vxe={bindings:E.Value(pxe,{isHidden:!0}),ignore:E.Value([],{isHidden:!0}),preferAtoms:E.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:E.Boolean(!0)},mxe=Pr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a,i){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a,i)},r}return t.prototype.getLoci=function(r){return this.params.preferAtoms&&Ot.isLoci(r)&&r.bonds.length===2?Ot.toFirstStructureElementLoci(r):r},t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a=n.current,i=n.buttons,o=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){var s=r.getLoci(a.loci);if(r.params.ignore.includes(s.kind)){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:yr});return}var u=!1;rr.match(r.params.bindings.hoverHighlightOnly,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:s}),u=!0),rr.match(r.params.bindings.hoverHighlightOnlyExtend,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:s}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:yr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Pr.Handler),params:function(){return vxe},display:{name:"Highlight Loci on Canvas"}}),hxe={clickSelect:rr.Empty,clickToggleExtend:rr([Nf(1,pd.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:rr.Empty,clickToggle:rr([Nf(1,pd.create())],"Toggle selection","${triggers} on element"),clickDeselect:rr.Empty,clickDeselectAllOnEmpty:rr([Nf(1,pd.create())],"Deselect all","Click on nothing using ${triggers}")},gxe={bindings:E.Value(hxe,{isHidden:!0}),ignore:E.Value([],{isHidden:!0}),preferAtoms:E.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:E.Boolean(!0)},gV=Pr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Pe(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o,s){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o,s)},a.spine=new K0.Impl(r.state.data.cells),a}return t.prototype.getLoci=function(r){return this.params.preferAtoms&&Ot.isLoci(r)&&r.bonds.length===2?Ot.toFirstStructureElementLoci(r):r},t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&fe.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(fe.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:Ne.Loci(i.data)},wt.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},wt.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return Xt.isEmpty(o)},a=function(o){return!Xt.isEmpty(o)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];i.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Eu(u.triggers.map(function(f){return pd.size(f.modifiers)})),d=l.triggers.length===0?0:Eu(l.triggers.map(function(f){return pd.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s=o.current,u=o.button,l=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)){var c=r.getLoci(s.loci);if(!r.params.ignore.includes(c.kind))for(var d=0,f=i;d<f.length;d++){var p=f[d],v=p[0],m=p[1],h=p[2];if(rr.match(r.params.bindings[v],u,l)&&(!h||h(c))){m({repr:s.repr,loci:c});break}}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&fe.Molecule.Structure.is(f.obj)){var p=u.data,v=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(v&&Ne.areEquivalent(p,v)&&Ne.areHierarchiesEqual(p,v))return;for(var m=r.ctx.state.data.select(Kt.children(s).ofType(fe.Molecule.Structure.Representation3D)),h=0,g=m;h<g.length;h++){var y=g[h];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Pr.Handler),params:function(){return gxe},display:{name:"Select Loci on Canvas"}}),yxe=Pr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(xe.is(r)){for(var a=new Set,i=0,o=r.elements;i<o.length;i++){var s=o[i].unit,u=He.create(r.structure,s,s.elements[0]),l=tt.entity.pdbx_description(u).join(", ");a.add(l)}a.size===1&&a.forEach(function(c){return n.push(c)})}return n.push(Jf(r)),n.filter(function(c){return!!c}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),bxe={clickFocus:rr([Nf(1,pd.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:rr([Nf(1,pd.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:rr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:rr([],"Representation Focus Add","Click element using ${triggers}")},Sxe={bindings:E.Value(bxe,{isHidden:!0})},ax=Pr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if(!(p!=="residue"&&p!=="element")){var v=r.ctx.selectionMode?d:l,m=rr.match(v,o,s),h=r.ctx.selectionMode?f:c,g=rr.match(h,o,s);if(!(!m&&!g)){var y=Xt.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&Xt.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(m)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(a=r.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Pr.Handler),params:function(){return Sxe},display:{name:"Representation Focus Loci on Canvas"}}),xxe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",HighlightLoci:mxe,SelectLoci:gV,DefaultLociLabelProvider:yxe,FocusLoci:ax}),yh=Vs,bh=rr.Trigger,Cxe={clickCenterFocus:rr([bh(1,yh.create()),bh(2,yh.create()),bh(1,yh.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:rr([bh(2,yh.create()),bh(1,yh.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},wxe={minRadius:E.Numeric(8,{min:1,max:50,step:1}),extraRadius:E.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:E.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:E.Value(Cxe,{isHidden:!0})},_xe=Pr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a=n.current,i=n.button,o=n.modifiers;if(!!r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(rr.match(s,i,o)){if(Xt.isEmpty(a.loci)){ft.Camera.Reset(r.ctx,{});return}var u=Xt.normalize(a.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Pr.Handler),params:function(){return wxe},display:{name:"Camera Focus Loci on Canvas"}}),Axe=Pr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(!(!r.ctx.canvas3d||!J4(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,a=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,a=0;var d=w.sub(w(),u.target,u.position),f=w.cross(w(),d,u.up);c=w(),c[s-1]=1,l=w.cross(w(),c,f),w.magnitude(l)===0&&(l=d)}else n===s?a=(a+1)%2:(n=s,a=0),s===4?(c=a?w.unitX:w.unitY,l=w.negUnitZ):s===5?(c=a?w.unitX:w.unitZ,l=w.negUnitY):(c=a?w.unitY:w.unitZ,l=w.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,v){return v.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,c,l)}})}})},t}(Pr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),Txe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",FocusLoci:_xe,CameraAxisHelper:Axe}),Pxe=Pr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&zt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure)),o=0,s=i;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&Ne.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>a&&(a=l)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,i=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=zt.AsymIdCount.get(l),d=zt.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),a=Math.max(a,d.label+c.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(zt.Index.get(r).value===void 0){var a=n&&zt.Index.get(n).value,i=a!=null?a:this.maxModelIndex+1;zt.Index.set(r,{value:i})}if(zt.AsymIdOffset.get(r).value===void 0){var o=n&&zt.AsymIdOffset.get(n).value,i=o!=null?o:_({},this.asymIdOffset);zt.AsymIdOffset.set(r,{value:i})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&Ne.Index.get(r).value===void 0){var a=n&&Ne.Index.get(n).value,i=a!=null?a:this.maxStructureIndex+1;Ne.Index.set(r,{value:i})}},t.prototype.handle=function(r,n,a){if(fe.Molecule.Structure.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);!i.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,a==null?void 0:a.data)}else if(fe.Molecule.Model.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);i.transformer.definition.isDecorator||this.handleModel(n.data,a==null?void 0:a.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(zt.AsymIdOffset,!0),this.ctx.customModelProperties.register(zt.Index,!0),this.ctx.customStructureProperties.register(Ne.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(zt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(zt.Index.descriptor.name),this.ctx.customStructureProperties.unregister(Ne.Index.descriptor.name)},t}(Pr.Handler)}),Zc=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],yV={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},Exe=121;function Ixe(e){var t=tt.residue.key,r=tt.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=He.create(o),c=0,d=0,f=-1;l.structure=o;for(var p=0,v=0,m=o.units.length;p<m;++p){var h=o.units[p],g=h.elements;l.unit=h,c=-1;for(var y=0,b=g.length;y<b;++y){var S=g[y],C=v+y;l.element=S,d=t(l),c!==d&&++f,c=d;var x=n(l),A=Cu(x);if(pl(A)){s[C]=0,u[C]=-1;continue}var P=a(l),T=DP(h,S);if(T===2||!e.nonPolymer&&!SS(T)){s[C]=0,u[C]=-1;continue}var D=i(l);if(e.traceOnly&&(P!=="CA"&&P!=="BB"||!yV[D])){s[C]=0,u[C]=f;continue}Uu(T)?s[C]=Mxe(P,x):T===5?s[C]=Dxe(P,x,D):s[C]=PE(x),u[C]=f}v+=g.length}}function Dxe(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return PE(t)}function Mxe(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return PE(t)}function PE(e){var t=Eg(e),r=Zc.indexOf(t);return r===-1&&(r=Zc.length,Zc[r]=t),r}var zO=5e3;function Rxe(e,t){return se(this,void 0,void 0,function(){var r,n;return ie(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:Oxe(t,n,Math.min(n+zO,r.length)),a.label=4;case 4:return n+=zO,[3,1];case 5:return[2]}})})}function Oxe(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,v=n.units,m=f.cumulativeUnitElementCount,h=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=Zc[a[y]];if(b===Zc[0])continue;for(var S=v[g[y]],C=h[y],x=S.conformation.x(C),A=S.conformation.y(C),P=S.conformation.z(C),T=d.find(x,A,P,l),D=T.count,I=T.units,M=T.indices,B=T.squaredDistances,U=c+b,V=c+U,F=[],Y=0;Y<D;++Y){var W=I[Y],K=m[p.get(W.id)]+M[Y],$=h[K],J=Zc[a[K]];if(!(S===W&&C===$||J===Zc[0])){var Z=c+J;if(B[Y]<(V+J)*(V+J)){var N=h[K];F[F.length]=[B[Y],(B[Y]+U*U-Z*Z)/(2*U),W.conformation.x(N)-x,W.conformation.y(N)-A,W.conformation.z(N)-P]}}}F.sort(function(re,O){return re[0]-O[0]});var j=0;e:for(var L=0;L<s.length;++L){for(var H=s[L],G=H[0],q=H[1],X=H[2],Q=0;Q<F.length;++Q){var ue=F[Q],le=ue[1],ve=ue[2],ge=ue[3],Se=ue[4],ae=G*ve+q*ge+X*Se;if(ae>le)continue e}++j}o[i[y]]+=u*j*U*U}}var bV={numberOfSpherePoints:E.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:E.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:E.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:E.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},fm;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=_(_({},E.getDefaultValues(bV)),c);return Fe.create("Compute Accessible Surface Area",function(p){return se(d,void 0,void 0,function(){return ie(this,function(v){switch(v.label){case 0:return[4,r(p,l,f)];case 1:return[2,v.sent()]}})})})}e.compute=t;function r(l,c,d){return se(this,void 0,void 0,function(){var f,p,v;return ie(this,function(m){switch(m.label){case 0:return f=n(c,d),Ixe(f),[4,Rxe(l,f)];case 1:return m.sent(),p=f.area,v=f.serialResidueIndex,[2,{area:p,serialResidueIndex:v}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,p=c.probeSize,v=c.nonPolymer,m=c.traceOnly,h=c.numberOfSpherePoints;return{structure:l,probeSize:p,nonPolymer:v,traceOnly:m,spherePoints:a(h),scalingConstant:4*Math.PI/h,maxLookupRadius:2*c.probeSize+2*Zc[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function a(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,p=0;p<l;++p){var v=p*f-1+f/2,m=Math.sqrt(1-v*v),h=p*d;c[c.length]=w.create(Math.cos(h)*m,v,Math.sin(h)*m)}return c}function i(l,c){var d=yV[l]||Exe;return c/d}e.normalize=i;function o(l,c){var d=c.area,f=c.serialResidueIndex,p=f[ze.indexOf(ze.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return p===-1?-1:d[p]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:i(tt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(fm||(fm={}));var w3=_({},bV),EE={isBuried:um.Dynamic(QD("computed","accessible-surface-area.is-buried",_e.Bool),function(e){if(!Be.isAtomic(e.element.unit))return!1;var t=Qo.get(e.element.structure).value;return t?fm.getFlag(e.element,t)===1:!1}),isAccessible:um.Dynamic(QD("computed","accessible-surface-area.is-accessible",_e.Bool),function(e){if(!Be.isAtomic(e.element.unit))return!1;var t=Qo.get(e.element.structure).value;return t?fm.getFlag(e.element,t)===2:!1})},Qo=Ed.createProvider({label:"Accessible Surface Area",descriptor:xo({name:"molstar_accessible_surface_area",symbols:EE}),type:"root",defaultParams:w3,getParams:function(e){return w3},isApplicable:function(e){return!0},obtain:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=_(_({},E.getDefaultValues(w3)),r),a={},[4,fm.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),_3=$e(16448250),Bxe="Assigns a color based on the relative accessible surface area of a residue.",SV={list:E.ColorList("rainbow",{presetKind:"scale"})};function kxe(e){return SV}function xV(e,t){var r,n=Ys.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&Qo.get(e.structure),i=a?pp(a.id,a.version):-1;if((a==null?void 0:a.value)&&e.structure){var o=He.create(e.structure),s=a.value,u=function(l){var c=fm.getNormalizedValue(l,s);return c===-1?_3:n.color(c)};r=function(l){return He.is(l)&&Be.isAtomic(l.unit)?u(l):Ot.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):_3}}else r=function(){return _3};return{factory:xV,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:Bxe,legend:n?n.legend:void 0}}var VO={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:xV,getParams:kxe,defaultValues:E.getDefaultValues(SV),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Qo.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Qo.ref(e.structure,!1)}}},Lxe=Pr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Qo,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return Fxe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){Zb.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(VO),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(HO),this.ctx.query.structure.registry.add(GO)},t.prototype.unregister=function(){Zb.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(VO),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(HO),this.ctx.query.structure.registry.remove(GO)},t}(Pr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}});function Fxe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Qo.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Qo.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(v,m){var h=m.elements;Ee.forEach(v,function(g){var y=a[r(m,h[g])];y!==-1&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(i.size===0)return;var p="<small>(".concat(i.size," ").concat(i.size>1?"Residues sum":"Residue",")</small>");return"Accessible Surface Area ".concat(p,": ").concat(o.toFixed(2)," \u212B<sup>2</sup>")}else if(e.kind==="structure-loci"){var t=Qo.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Qo.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: ".concat(p0(t.area).toFixed(2)," \u212B<sup>2</sup>")}}var HO=Dr("Buried Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":EE.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Ir.Residue,ensureCustomProperties:function(e,t){return Qo.attach(e,t)}}),GO=Dr("Accessible Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":EE.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Ir.Residue,ensureCustomProperties:function(e,t){return Qo.attach(e,t)}});function Er(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function CV(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function lg(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function f2(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function IE(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function Nxe(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]];vr.isCovalent(s.props.flag)&&(n+=1)}return n}function Uxe(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)vr.isCovalent(i[o])&&(r+=1);return r}function Bu(e,t,r){return Nxe(e,t,r)+Uxe(t,r)}function Ii(e,t,r,n){var a=0;return fs(e,t,r,function(i,o){Er(i,o)===n&&(a+=1)}),a}function zxe(e,t,r){var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags;vr.is;for(var s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&vr.isCovalent(o[s]))return!0;return!1}function Vxe(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&vr.isCovalent(i.props.flag)}function Hxe(e,t,r,n,a){return t===n?zxe(t,r,a):Vxe(e,t,r,n,a)}function Gxe(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);vr.isCovalent(s.props.flag)&&n(u,s.indexB)}}function qxe(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)vr.isCovalent(o[s])&&r(e,i[s])}function fs(e,t,r,n){Gxe(e,t,r,n),qxe(t,r,n)}function jxe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function Kp(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var qO=new Map([[2,wr(180)],[3,wr(120)],[4,wr(109.4721)],[6,wr(90)]]),p2=w(),v2=w(),Tf=w(),m2=w(),xv=w();function h2(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],Tf),n.conformation.position(n.elements[a],m2),w.sub(p2,m2,Tf),fs(e,t,r,function(o,s){Er(o,s)!=="H"&&(o.conformation.position(o.elements[s],xv),w.sub(v2,xv,Tf),i.push(w.angle(p2,v2)))}),i}function jO(e,t,r,n,a){t.conformation.position(t.elements[r],Tf),n.conformation.position(n.elements[a],m2),w.sub(p2,m2,Tf);var i=[w(),w()],o=0,s,u;if(fs(e,t,r,function(l,c){o>1||Er(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],xv),w.sub(i[o++],xv,Tf))}),o===1&&s&&u&&fs(e,s,u,function(l,c){o>1||l===t&&c===r||Er(l,c)!=="H"&&(l.conformation.position(l.elements[c],xv),w.sub(i[o++],xv,Tf))}),o===2)return w.cross(v2,i[0],i[1]),Math.abs(Math.PI/2-w.angle(v2,p2))}var A3=new Ot.ElementBondIterator,T3=new Ot.ElementBondIterator;function Wxe(e,t,r){var n=Er(t,r),a=n==="O"||n==="N";if(a&&Bu(e,t,r)===4)return!1;for(A3.setElement(e,t,r);A3.hasNext;){var i=A3.move();if(i.order>1)return!0;if(a){var o=Er(i.otherUnit,i.otherIndex);for(T3.setElement(e,i.otherUnit,i.otherIndex);T3.hasNext;){var s=T3.move();if(s.order>1){if((o==="P"||o==="S")&&Er(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function Xxe(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,l=i[r],c=i[r+1];l<c;++l)vr.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];vr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var Qp=new Ot.ElementBondIterator,P3=new Ot.ElementBondIterator;function Yxe(e,t,r,n){var a=Ii(e,t,r,"H"),i=Er(t,r),o=CV(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&a===0,l=Bu(e,t,r),c=Xxe(e,t,r),d=Wxe(e,t,r),f=c-l>0,p=0,v=8;switch(i){case"H":s&&(l===0?(o=1,v=0):l===1&&(o=0,v=1));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-c-Math.abs(o))),v=Kp(l+p+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-a===1&&c-a===2?o=1:o=0;else for(Qp.setElement(e,t,r);Qp.hasNext;){var m=Qp.move(),h=Er(m.otherUnit,m.otherIndex);if(h==="S"||Uye(h)){o=0;break}else o=1}u&&(p=Math.max(0,3-c+o)),d&&!f?v=Kp(l+p-o):v=Kp(l+p+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){Qp.setElement(e,t,r);e:for(;Qp.hasNext;){var g=Qp.move();for(P3.setElement(e,g.otherUnit,g.otherIndex);P3.hasNext;){var y=P3.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Er(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(p=Math.max(0,2-c+o)),d&&!f?v=Kp(l+p-o+1):v=Kp(l+p-o+2);break;case"S":s&&(u||(c<=3&&Ii(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(p=Math.max(0,2-c+o)),c<=3&&(v=Kp(l+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Ar&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,p,p+a,v]}function Kxe(e,t,r){var n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=ze.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,p=Yxe(e,t,f,r),v=p[0],m=p[1],h=p[2],g=p[3];a[d]=v,i[d]=m,o[d]=h,s[d]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var wV={assignCharge:E.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:E.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function Qxe(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){for(n=_(_({},E.getDefaultValues(wV)),r),a=new Map,i=0,o=t.units.length;i<o;++i)s=t.units[i],Be.isAtomic(s)&&(u=Kxe(t,s,n),a.set(s.id,u));return[2,a]})})}var E3=_({},wV),Ng=Ed.createProvider({label:"Valence Model",descriptor:xo({name:"molstar_computed_valence_model"}),type:"local",defaultParams:E3,getParams:function(e){return E3},isApplicable:function(e){return!0},obtain:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=_(_({},E.getDefaultValues(E3)),r),a={},[4,Qxe(e.runtime,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),cn;(function(e){function t(d,f,p,v){return w.set(d,v.x[p],v.y[p],v.z[p]),w.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var p=new Int32Array(f+1),v=new Int32Array(f),m=new Int32Array(f),h=d.members,g=d.count,y=d.offsets,b=0,S=y[g];b<S;++b)++m[h[b]];for(var C=0,b=0;b<f;b++)p[b]=C,C+=m[b];p[f]=C;for(var x=new Int32Array(C),b=0;b<g;++b)for(var A=y[b],P=y[b+1];A<P;++A){var T=h[A],D=p[T]+v[T];x[D]=b,++v[T]}return{indices:x,offsets:p}}e.createElementsIndex=r;function n(d,f){var p,v;return _(_({},f),{get lookup3d(){if(!p){var m={x:f.x,y:f.y,z:f.z,indices:Ee.ofBounds(0,f.count)};p=jf(m,am(m))}return p},get elementsIndex(){return v||(v=r(f,d))},subset:function(m){return a(f,m)}})}e.create=n;function a(d,f){for(var p,v=d.count,m=d.types,h=[],g=0;g<v;++g)f.has(m[g])&&h.push(g);var y=ze.ofSortedArray(h);return{indices:y,get lookup3d(){if(!p){var b={x:d.x,y:d.y,z:d.z,indices:y};p=jf(b,am(b))}return p}}}e.createSubset=a;function i(d,f,p){var v=Ng.get(d).value;if(!v||!v.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:v.get(f.id).idealGeometry}}e.Info=i;function o(d,f){return w.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),w.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=w(),u=w();function l(d,f){var p=d.members[d.offsets[d.feature]],v=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[p],s),f.unit.conformation.position(f.unit.elements[v],u),w.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(cn||(cn={}));var rA;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Le.create(Float32Array,1,n,a?a.x:r),o=Le.create(Float32Array,1,n,a?a.y:r),s=Le.create(Float32Array,1,n,a?a.z:r),u=Le.create(Uint8Array,1,n,a?a.types:r),l=Le.create(Uint8Array,1,n,a?a.groups:r),c=Le.create(Uint32Array,1,n,a?a.offsets:r),d=Le.create(Uint32Array,1,n,a?a.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,v,m,h){Le.add(d,h),f.x+=p,f.y+=v,f.z+=m,f.count+=1},finishState:function(p,v){var m=f.count;m!==0&&(Le.add(u,p),Le.add(l,v),Le.add(i,f.x/m),Le.add(o,f.y/m),Le.add(s,f.z/m),Le.add(c,f.offset))},add:function(p,v,m,h,g,y){Le.add(u,p),Le.add(l,v),Le.add(i,m),Le.add(o,h),Le.add(s,g),Le.add(c,d.elementCount),Le.add(d,y)},getFeatures:function(p){Le.add(c,d.elementCount);var v=Le.compact(i,!0),m=Le.compact(o,!0),h=Le.compact(s,!0),g=i.elementCount;return cn.create(p,{x:v,y:m,z:h,count:g,types:Le.compact(u,!0),groups:Le.compact(l,!0),offsets:Le.compact(c,!0),members:Le.compact(d,!0)})}}}e.create=t})(rA||(rA={}));var nA;(function(e){function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var v=l[f],m=l[f+1];v<m;++v)++s[u[v]];for(var v=l[p],m=l[p+1];v<m;++v)++s[u[v]]}}for(var h=0,c=0;c<a;c++)i[c]=h,h+=s[c];i[a]=h;for(var g=new Int32Array(h),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var v=l[f],m=l[f+1];v<m;++v){var y=u[v],b=i[y]+o[y];g[b]=c,++o[y]}for(var v=l[p],m=l[p+1];v<m;++v){var y=u[v],b=i[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:i}}e.createElementsIndex=t})(nA||(nA={}));var Zxe=function(e){Pe(t,e);function t(r,n){var a=e.call(this,r)||this;a.elementKeyIndex=new Map;for(var i=0,o=a.edges.length;i<o;++i)for(var s=a.edges[i],u=s.unitA,l=s.indexA,c=n.get(u),d=c.offsets,f=c.members,p=d[l],v=d[l+1];p<v;++p){var m=a.getElementKey(f[p],u),h=a.elementKeyIndex.get(m);h===void 0?a.elementKeyIndex.set(m,[i]):h.push(i)}return a}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return"".concat(r,"|").concat(n)},t}(Wf);function WO(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function $xe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function Jxe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var aA;(function(e){function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,l){a[a.length]=s,i[i.length]=u,o[o.length]=l},getContacts:function(){for(var s=new eo.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),p,v=Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=nA.createElementsIndex(f,r,n))}});return v}}}e.create=t})(aA||(aA={}));var iA;(function(e){function t(){var r=new Wf.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:0})},getContacts:function(n){return new Zxe(r.getMap(),n)}}}e.create=t})(iA||(iA={}));var eCe={lineOfSightDistFactor:E.Numeric(1,{min:0,max:3,step:.1})},tCe=3;function _V(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=f2(t.unit,n),o=f2(r.unit,a);return!(i&&o&&i!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]&&t.unit===r.unit||Hxe(e,t.unit,n,r.unit,a))}function XO(e,t,r,n){var a=f2(e,t),i=f2(r,n);return a&&i&&a!==i}function YO(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var yc=w(),I3=w(),D3=w(),rCe=m7();function AV(e,t,r,n){var a=t.feature,i=r.feature,o=t.members[t.offsets[a]],s=r.members[r.offsets[i]];cn.position(I3,t),cn.position(D3,r),w.scale(yc,w.add(yc,I3,D3),.5);var u=n*tCe,l=e.lookup3d.find(yc[0],yc[1],yc[2],u,rCe),c=l.count,d=l.indices,f=l.units,p=l.squaredDistances;if(c===0)return!0;for(var v=0;v<c;++v){var m=d[v],h=f[v];if(!!Be.isAtomic(h)){var g=Er(h,m);if(g!=="H"){var y=Eg(g);if(!(y*y*n*n<=p[v])&&!(XO(h,m,t.unit,o)||XO(h,m,r.unit,s))&&!(t.unit===h&&YO(m,t)||r.unit===h&&YO(m,r))&&(h.conformation.position(h.elements[m],yc),!(w.squaredDistance(yc,I3)<1||w.squaredDistance(yc,D3)<1)))return!1}}}return!0}function nCe(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++){var u=s[o];aCe(e,t,r,n,u,i)}}function aCe(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,l=r.subset(a.requiredFeatures),c=l.lookup3d,d=l.indices,f=cn.Info(e,t,r),p=_({},f),v=i.lineOfSightDistFactor,m=0,h=Ee.size(d);m<h;++m){var g=Ee.getAt(d,m),y=c.find(o[g],s[g],u[g],a.maxDistance),b=y.count,S=y.indices,C=y.squaredDistances;if(b!==0){f.feature=g;for(var x=0;x<b;++x){var A=Ee.getAt(d,S[x]);if(!(A<=g)&&(p.feature=A,!!_V(e,f,p))){var P=a.getType(e,f,p,C[x]);P&&AV(e,f,p,v)&&n.add(g,A,P)}}}}}var iCe=oe();function oCe(e,t,r,n,a,i,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=a.lookup3d,p=oe.mul(iCe,n.conformation.operator.inverse,t.conformation.operator.matrix),v=!oe.isIdentity(p),m=w(),h=Math.max.apply(Math,o.map(function($){return $.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,S=(b+h)*(b+h),C=s.lineOfSightDistFactor,x=cn.Info(e,t,r),A=cn.Info(e,n,a);i.startUnitPair(t,n);for(var P=0;P<u;++P)if(w.set(m,l[P],c[P],d[P]),v&&w.transformMat4(m,m,p),!(w.squaredDistance(m,y)>S)){var T=f.find(m[0],m[1],m[2],h),D=T.indices,I=T.count,M=T.squaredDistances;if(I!==0){x.feature=P;for(var B=0;B<I;++B){var U=D[B];if(A.feature=U,!!_V(e,x,A))for(var V=M[B],F=0,Y=o;F<Y.length;F++){var W=Y[F];if(V<W.maxDistance*W.maxDistance){var K=W.getType(e,x,A,V);if(K&&AV(e,x,A,C)){i.add(P,U,K);break}}}}}}i.finishUnitPair()}var sCe={distanceMax:E.Numeric(4,{min:1,max:5,step:.1}),angleMax:E.Numeric(30,{min:0,max:60,step:1})},uCe=["CL","BR","I","AT"];function lCe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Er(t,u);uCe.includes(c)&&r.add(6,0,i[n[u]],o[n[u]],s[n[u]],u)}}var cCe=["N","O","S"],dCe=["C","N","P","S"];function fCe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Er(t,d);if(cCe.includes(p)){var v=!1;fs(e,t,d,function(m,h){dCe.includes(Er(m,h))&&(v=!0)}),v&&r.add(7,0,i[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function pCe(e,t){return e===7&&t===6||e===6&&t===7}var vCe=wr(180),mCe=wr(120);function hCe(e){return{angleMax:wr(e.angleMax)}}function gCe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!pCe(a,i)){var o=a===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=h2(e,s.unit,l,u.unit,c);if(d.length===1&&!(vCe-d[0]>n.angleMax)){var f=h2(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(p){return mCe-p>n.angleMax}))return 5}}}var yCe=cn.Provider([6],lCe),bCe=cn.Provider([7],fCe),SCe={name:"halogen-bonds",params:sCe,createTester:function(e){var t=hCe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return gCe(r,n,a,t)}}}},TV={distanceMax:E.Numeric(3.5,{min:1,max:5,step:.1}),backbone:E.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:E.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:E.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:E.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:E.Numeric(45,{min:0,max:180,step:1})},xCe=_(_({},TV),{water:E.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:E.Numeric(4.1,{min:1,max:5,step:.1})}),CCe=_({},TV);function DE(e,t){var r=Ng.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function wCe(e,t,r){for(var n=DE(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=0,c=a.length;l<c;++l){var d=Er(t,l);(PV(t,l)||n[l]>0&&(d==="N"||d==="O"||d==="S"))&&r.add(4,0,o[a[l]],s[a[l]],u[a[l]],l)}}function _Ce(e,t,r){for(var n=DE(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=0,c=a.length;l<c;++l)Er(t,l)==="C"&&n[l]>0&&(Ii(e,t,l,"N")>0||Ii(e,t,l,"O")>0||ACe(t,l))&&r.add(9,0,o[a[l]],s[a[l]],u[a[l]],l)}function ACe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,a=r.all,i=n.get(t);if(i===void 0)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],l=0,c=u.length;l<c;++l){var d=Er(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function TCe(e,t,r){for(var n=DE(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=function(b){r.add(5,0,l[s[b]],c[s[b]],d[s[b]],b)},p=0,v=s.length;p<v;++p){var m=Er(t,p);if(m==="O")f(p);else if(m==="N"){if(PV(t,p))f(p);else if(a[p]<1){var h=Bu(e,t,p)+i[p],g=o[p];(g===4&&h<4||g===3&&h<3||g===2&&h<2)&&f(p)}}else if(m==="S"){var y=IE(t,p);(y==="CYS"||y==="MET"||CV(t,p)===-1)&&f(p)}}}function KO(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function QO(e,t){return Rl.has(lg(e,t))}function PCe(e,t){return e.rings.elementRingIndices.has(t)}function PV(e,t){return IE(e,t)==="HIS"&&Er(e,t)==="N"&&PCe(e,t)}function ECe(e,t,r,n){return QO(e,t)&&QO(r,n)}function ICe(e,t,r,n){return KO(e,t)&&KO(r,n)}function DCe(e,t){return e===5&&t===4||e===4&&t===5}function MCe(e,t){return e===9&&t===5||e===5&&t===9}function EV(e){return{includeBackbone:e.backbone,maxAccAngleDev:wr(e.accAngleDevMax),maxDonAngleDev:wr(e.donAngleDevMax),maxAccOutOfPlaneAngle:wr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:wr(e.donOutOfPlaneAngleMax)}}function RCe(e){return _(_({},EV(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var ZO=wr(120);function IV(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&ECe(t.unit,a,r.unit,i))){var o=h2(e,t.unit,a,r.unit,i),s=qO.get(t.idealGeometry[a])||ZO;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[a]===3){var u=jO(e,t.unit,a,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=h2(e,r.unit,i,t.unit,a),c=qO.get(r.idealGeometry[i])||ZO;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[i]===3){var u=jO(e,r.unit,i,t.unit,a);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function OCe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!DCe(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Er(u.unit,c)==="S"||Er(l.unit,d)==="S"?a.maxSulfurDistSq:a.maxDistSq;if(!(n>f)&&!(!a.includeWater&&ICe(u.unit,c,l.unit,d))&&!!IV(e,u,l,a))return 4}}function BCe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!MCe(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(!!IV(e,u,l,a))return 8}}var kCe=cn.Provider([4],wCe),LCe=cn.Provider([9],_Ce),FCe=cn.Provider([5],TCe),NCe={name:"hydrogen-bonds",params:xCe,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=RCe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return OCe(n,a,i,o,r)}}}},UCe={name:"weak-hydrogen-bonds",params:CCe,createTester:function(e){var t=EV(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return BCe(r,n,a,i,t)}}}};function zCe(e,t,r){return Er(t,r)==="S"&&Ii(e,t,r,"O")===3}function VCe(e,t,r){return Er(t,r)==="S"&&Ii(e,t,r,"O")===4}function $O(e,t,r){return Er(t,r)==="P"&&Ii(e,t,r,"O")===Bu(e,t,r)}function HCe(e,t,r){var n=0;return Er(t,r)==="C"&&Ii(e,t,r,"O")===2&&Ii(e,t,r,"C")===1&&fs(e,t,r,function(a,i){Er(a,i)==="O"&&Bu(e,a,i)-Ii(e,a,i,"H")===1&&(n+=1)}),n===2}function GCe(e,t,r){var n=0;return Er(t,r)==="C"&&Bu(e,t,r)===3&&Ii(e,t,r,"N")===3&&fs(e,t,r,function(a,i){Bu(e,a,i)-Ii(e,a,i,"H")===1&&(n+=1)}),n===2}function qCe(e,t,r){var n=0;return Er(t,r)==="C"&&Bu(e,t,r)===3&&Ii(e,t,r,"N")===2&&Ii(e,t,r,"C")===1&&fs(e,t,r,function(a,i){Bu(e,a,i)-Ii(e,a,i,"H")===1&&(n+=1)}),n===2}var jCe={distanceMax:E.Numeric(5,{min:0,max:8,step:.1})},WCe={distanceMax:E.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:E.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:E.Numeric(30,{min:0,max:180,step:1})},XCe={distanceMax:E.Numeric(6,{min:1,max:8,step:.1}),offsetMax:E.Numeric(2,{min:0,max:4,step:.1})},YCe=["ARG","HIS","LYS"],KCe=["GLU","ASP"];function DV(e,t){var r=Ng.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function QCe(e,t,r){for(var n=DV(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=Qt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,v=f.start,m=f.end,h=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(YCe.includes(h)){r.startState();for(var g=v;g<m;++g)Er(t,g)==="N"&&!Rl.has(lg(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,0)}else if(!Dm.has(h)){l.clear();for(var g=v;g<m;++g){var y=0;GCe(e,t,g)?y=8:qCe(e,t,g)&&(y=9),y&&(r.startState(),fs(e,t,g,function(S,C){Er(t,C)==="N"&&(l.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(1,y))}for(var g=v;g<m;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function ZCe(e,t,r){for(var n=DV(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=Qt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);d.hasNext;){var f=d.move(),p=f.index,v=f.start,m=f.end,h=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(KCe.includes(h)){r.startState();for(var g=v;g<m;++g)Er(t,g)==="O"&&!Rl.has(lg(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,0)}else if(bS.has(h))for(var g=v;g<m;++g)$O(e,t,g)&&(r.startState(),fs(e,t,g,function(S,C){Er(t,C)==="O"&&r.pushMember(o[a[C]],s[a[C]],u[a[C]],C)}),r.finishState(2,6));else if(!Dm.has(h)){for(var g=v;g<m;++g){r.startState(),Er(t,g)==="N"&&!Rl.has(lg(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,0);var y=0;zCe(e,t,g)?y=4:$O(e,t,g)?y=6:VCe(e,t,g)?y=5:HCe(e,t,g)&&(y=10),y&&(r.startState(),fs(e,t,g,function(S,C){Er(t,C)==="O"&&(l.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(2,y))}for(var g=v;g<m;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function $Ce(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,p=d.length;f<p;++f){var v=d[f];r.pushMember(i[n[v]],o[n[v]],s[n[v]],v)}r.finishState(3,0)}}function JCe(e,t){return e===2&&t===1||e===1&&t===2}function e3e(e,t){return e===3&&t===3}function t3e(e,t){return e===3&&t===1||e===1&&t===3}var JO=w(),eB=w();function r3e(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,l=a[n],c=a[n+1];l<c;++l){var d=i[l];e.unit.conformation.position(e.unit.elements[d],JO);for(var f=s[o],p=s[o+1];f<p;++f){var v=u[f];if(t.unit.conformation.position(t.unit.elements[v],eB),w.squaredDistance(JO,eB)<r)return!0}}return!1}var g2=w(),Cv=w(),y2=w(),qy=w();function oA(e,t){var r=t.unit,n=t.feature,a=t.offsets,i=t.members,o=r.elements,s=a[n];return t.unit.conformation.position(o[i[s]],g2),t.unit.conformation.position(o[i[s+1]],Cv),t.unit.conformation.position(o[i[s+2]],y2),w.triangleNormal(e,g2,Cv,y2)}var sA=function(e,t,r){return cn.position(g2,e),cn.position(Cv,t),w.sub(y2,g2,Cv),w.projectOnPlane(qy,y2,r),w.add(qy,qy,Cv),w.distance(qy,Cv)};function n3e(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function a3e(e){return{offsetMax:e.offsetMax,angleDevMax:wr(e.angleDevMax)}}function i3e(e){return{offsetMax:e.offsetMax}}var o3e=wr(180),tB=wr(90),C0=w(),M3=w();function s3e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(JCe(i,o)&&r3e(t,r,a.distanceMaxSq))return 1}function u3e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(e3e(i,o)){oA(C0,t),oA(M3,r);var s=w.angle(C0,M3),u=Math.min(sA(t,r,M3),sA(r,t,C0));if(u<=a.offsetMax){if(s<=a.angleDevMax||s>=o3e-a.angleDevMax)return 3;if(s<=a.angleDevMax+tB&&s>=tB-a.angleDevMax)return 3}}}function l3e(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(t3e(i,o)){var s=i===3?[t,r]:[r,t],u=s[0],l=s[1];oA(C0,u);var c=sA(l,u,C0);if(c<=a.offsetMax)return 2}}var c3e=cn.Provider([2],ZCe),d3e=cn.Provider([1],QCe),f3e=cn.Provider([3],$Ce),p3e={name:"ionic",params:jCe,createTester:function(e){var t=n3e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return s3e(r,n,a,i,t)}}}},v3e={name:"pi-stacking",params:WCe,createTester:function(e){var t=a3e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return u3e(r,n,a,i,t)}}}},m3e={name:"cation-pi",params:XCe,createTester:function(e){var t=i3e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return l3e(r,n,a,i,t)}}}},h3e={distanceMax:E.Numeric(4,{min:1,max:5,step:.1})};function g3e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(d,f){var p=Er(t,d),v=!1;p==="C"?(v=!0,fs(e,t,d,function(m,h){var g=Er(m,h);g!=="C"&&g!=="H"&&(v=!1)})):p==="F"&&(v=!0),v&&r.add(8,0,i[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function y3e(e,t){return e===8&&t===8}function b3e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!y3e(a,i)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Er(t.unit,o)==="F"&&Er(r.unit,s)==="F"))return 6}}var S3e=cn.Provider([8],g3e),x3e={name:"hydrophobic",params:h3e,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return b3e(t,r,n)}}}},C3e={distanceMax:E.Numeric(3,{min:1,max:5,step:.1})},w3e=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function _3e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Er(t,u),d=0;w3e.includes(c)?d=13:(Pz(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,i[n[u]],o[n[u]],s[n[u]],u)}}function rB(e){return!Rl.has(e)}function A3e(e){return Rl.has(e)}function T3e(e){return gS.has(e)}function P3e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,l=n.length;u<l;++u){var c=Er(t,u),d=IE(t,u),f=lg(t,u),p=!1,v=!1,m=_g.has(d),h=bS.has(d);!m&&!h?Lye(c)||c==="O"||c==="S"?(p=!0,v=!0):c==="N"&&(p=!0):m?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&rB(f)||A3e(f))&&(p=!0,v=!0):c==="S"&&(d==="CYS"||d==="MET")?(p=!0,v=!0):c==="N"&&d==="HIS"&&rB(f)&&(p=!0):h&&(c==="O"&&T3e(f)?(p=!0,v=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,v=!0)),p&&r.add(11,0,i[n[u]],o[n[u]],s[n[u]],u),v&&r.add(10,0,i[n[u]],o[n[u]],s[n[u]],u)}}function nB(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function E3e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!(!nB(a,i)&&!nB(i,a)))return 7}var I3e=cn.Provider([13,12],_3e),D3e=cn.Provider([10,11],P3e),M3e={name:"metal-coordination",params:C3e,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return E3e(t,r,n)}}}};function R3e(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[O3e(e,t),B3e(e,t),k3e(e,t),L3e(e,t),F3e(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=cn.Info(e,l,a.get(u.unitA));d.feature=u.indexA;var f=cn.Info(e,c,a.get(u.unitB));f.feature=u.indexB;for(var p=0,v=i;p<v.length;p++){var m=v[p];m.isApplicable(u.props.type)&&m.handleInterContact(o,d,f)}}for(var h=n.keys();;){var g=h.next(),y=g.done,b=g.value;if(y)break;var S=n.get(b),C=a.get(b),x=e.unitMap.get(b);if(!!Be.isAtomic(x)){for(var d=cn.Info(e,x,C),f=cn.Info(e,x,C),A=0,P=i;A<P.length;A++){var m=P[A];m.startUnit(x,S,C)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var T=0,D=i;T<D.length;T++){var m=D[T];m.isApplicable(S.edgeProps.type[o])&&m.handleIntraContact(o,d,f)}}}}}function O3e(e,t){var r=t.contacts,n=function(l,c,d,f,p){var v=f.get(d)||[1/0,-1],m=v[0],h=v[1];l<m?(h!==-1&&p(h),f.set(d,[l,c])):p(c)};function a(l,c,d,f,p){var v=c.members[c.offsets[c.feature]],m=d.members[d.offsets[d.feature]],h=c.unit.getResidueIndex(v),g=d.unit.getResidueIndex(m),y="".concat(v,"|").concat(c.unit.id,"|").concat(g,"|").concat(d.unit.id,"|A"),b="".concat(m,"|").concat(d.unit.id,"|").concat(h,"|").concat(c.unit.id,"|B"),S=cn.distance(c,d);n(S,l,y,f,p),n(S,l,b,f,p)}var i=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){a(l,c,d,i,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){a(l,c,d,s,u)}}}function B3e(e,t){var r=t.contacts,n=function(a,i){for(var o=a.types[a.feature]===9?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,p=d[s],v=d[s+1];p<v;++p)if(l[f[p]]===4)return!0;for(var m=r.getEdgeIndices(o.feature,o.unit.id),p=0,v=m.length;p<v;++p)if(r.edges[m[p]].props.type===4)return!0;return!1};return{isApplicable:function(a){return a===8},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=1)},startUnit:function(){},handleIntraContact:function(a,i,o){if(n(i,o)){var s=t.unitsContacts.get(i.unit.id).edgeProps.flag;s[a]=1}}}}function ME(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=i[o],c=i[o+1];l<c;++l)for(var d=r.members[l],f=a.getContactIndicesForElement(d,r.unit),p=0,v=f.length;p<v;++p){var m=f[p];if(e.includes(a.edges[m].props.type))for(var h=s[u],g=s[u+1];h<g;++h){var y=n.members[h];if(a.getContactIndicesForElement(y,n.unit).includes(m)){a.edges[t].props.flag=1;return}}}}function RE(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,p=n.offsets,v=n.feature,m=d[f],h=d[f+1];m<h;++m)for(var g=r.members[m],y=l[g],b=l[g+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var C=p[v],x=p[v+1];C<x;++C)for(var A=n.members[C],P=l[A],T=l[A+1];P<T;++P)if(S===c[P]){s[t]=1;return}}}}function k3e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){ME([4,8],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){RE([4,8],n,a,i,t.unitsContacts.get(a.unit.id))}}}function L3e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,a,i){ME([3],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){RE([3],n,a,i,t.unitsContacts.get(a.unit.id))}}}function F3e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){ME([7],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){RE([7],n,a,i,t.unitsContacts.get(a.unit.id))}}}var Nl;(function(e){function t(c,d,f,p,v,m){return W7("interactions",{structure:d,interactions:c},{unitA:f,indexA:p,unitB:v,indexB:m})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function a(c,d){var f=d.unitA,p=d.indexA,v=d.unitB,m=d.indexB,h=c.contacts,g=c.unitsContacts;if(f===v){var y=g.get(f.id),b=y.getDirectedEdgeIndex(p,m);return WO(y.edgeProps.type[b])}else{var b=h.getEdgeIndex(p,f.id,m,v.id);return WO(h.edges[b].props.type)}}function i(c){return a(c.data.interactions,c.element)}e.locationLabel=i;function o(c,d,f){return OS("interactions",{structure:c,interactions:d},f,function(p){return u(d,f,p)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var p=c.unitsFeatures;return Ml.fromPairProvider(d.length,function(v,m,h){var g=d[v];cn.setPosition(m,g.unitA,g.indexA,p.get(g.unitA.id)),cn.setPosition(h,g.unitB,g.indexB,p.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var p=f[0];if(p===void 0)return"";var v=p.unitA,m=p.indexA,h=p.unitB,g=p.indexB,y=d.unitsFeatures,b=y.get(v.id),S=b.members,C=b.offsets,x=y.get(h.id),A=x.members,P=x.offsets,T={granularity:"element"};return(C[m+1]-C[m]>1||P[g+1]-P[g]>1)&&(T.granularity="residue"),[a(d,p),sE(Ot.Location(c,v,S[C[m]],c,h,A[P[g]]),T)].join("</br>")}e.getLabel=l})(Nl||(Nl={}));var N3e=[kCe,LCe,FCe,c3e,d3e,f3e,yCe,bCe,S3e,I3e,D3e],b2={ionic:p3e,"pi-stacking":v3e,"cation-pi":m3e,"halogen-bonds":SCe,"hydrogen-bonds":NCe,"weak-hydrogen-bonds":UCe,hydrophobic:x3e,"metal-coordination":M3e};function U3e(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(b2).forEach(function(r){t[r]=E.MappedStatic(e.includes(r)?"on":"off",{on:E.Group(b2[r].params),off:E.Group({})},{cycle:!0})}),t}var z3e=U3e(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),MV={providers:E.Group(z3e,{isFlat:!0}),contacts:E.Group(eCe,{label:"Advanced Options"})};function V3e(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return n=_(_({},E.getDefaultValues(MV)),r),[4,Ng.attach(e,t)];case 1:b.sent(),a=[],US(b2).forEach(function(S){var C=n.providers[S],x=C.name,A=C.params;x==="on"&&a.push(b2[S].createTester(A))}),i=new Set,a.forEach(function(S){return Pn.add(i,S.requiredFeatures)}),o=N3e.filter(function(S){return Pn.areIntersecting(i,S.types)}),s=us.Mutable(),u=us.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=H3e(t,d.units[0],o),p=G3e(t,d.units[0],f,a,n.contacts),v=0,m=d.units.length;v<m;++v)h=d.units[v],s.set(h.id,f),u.set(h.id,p);b.label=5;case 5:return++l,[3,2];case 6:return g=q3e(t,s,a,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},R3e(t,y),[2,y]}})})}function H3e(e,t,r){var n=t.elements.length,a=rA.create(n,n/2);if(Be.isAtomic(t))for(var i=0,o=r;i<o.length;i++){var s=o[i];s.add(e,t,a)}return a.getFeatures(n)}function G3e(e,t,r,n,a){var i=aA.create(r,t.elements.length);return Be.isAtomic(t)&&nCe(e,t,r,i,n,a),i.getContacts()}function q3e(e,t,r,n){var a=iA.create();return Ne.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);oCe(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return Be.isAtomic(i)},validUnitPair:function(i,o){return Ne.validUnitPair(e,i,o)}}),a.getContacts(t)}var R3=_({},MV),_n=Ed.createProvider({label:"Interactions",descriptor:xo({name:"molstar_computed_interactions"}),type:"local",defaultParams:R3,getParams:function(e){return R3},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=_(_({},E.getDefaultValues(R3)),r),a={},[4,V3e(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),uA=$e(13421772),j3e="Assigns colors according the interaction type of a link.",ai={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},W3e=[["Hydrogen Bond",ai.HydrogenBond],["Hydrophobic",ai.Hydrophobic],["Halogen Bond",ai.HalogenBond],["Ionic",ai.Ionic],["Metal Coordination",ai.MetalCoordination],["Cation Pi",ai.CationPi],["Pi Stacking",ai.PiStacking],["Weak HydrogenBond",ai.WeakHydrogenBond]];function aB(e){switch(e){case 4:return ai.HydrogenBond;case 6:return ai.Hydrophobic;case 5:return ai.HalogenBond;case 1:return ai.Ionic;case 7:return ai.MetalCoordination;case 2:return ai.CationPi;case 3:return ai.PiStacking;case 8:return ai.WeakHydrogenBond;case 0:return uA}}var RV={};function X3e(e){return RV}function OV(e,t){var r,n=e.structure?_n.get(e.structure):void 0,a=n?pp(n.id,n.version):-1;return n&&n.value?r=function(i){if(Nl.isLocation(i)){var o=i.data.interactions,s=o.unitsContacts,u=o.contacts,l=i.element,c=l.unitA,d=l.unitB,f=l.indexA,p=l.indexB;if(c===d){var v=s.get(c.id),m=v.getDirectedEdgeIndex(f,p);return aB(v.edgeProps.type[m])}else{var m=u.getEdgeIndex(f,c.id,p,d.id);return aB(u.edges[m].props.type)}}return uA}:r=function(){return uA},{factory:OV,granularity:"group",color:r,props:t,contextHash:a,description:j3e,legend:Fd(W3e)}}var lA={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:OV,getParams:X3e,defaultValues:E.getDefaultValues(RV),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?_n.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&_n.ref(e.structure,!1)}}};function Hs(e,t,r,n){var a=0,i=t.webgl,o=new xn,s=new Yt.GeometryState,u=oc(),l=[],c=va.create(),d,f,p,v,m=qn.createEmpty();function h(x,A){var P=this;return x===void 0&&(x={}),A&&A!==f&&(p=r(t,A),f=A,v||(v=E.getDefaultValues(p))),v=Object.assign({},v,x),Fe.create("Creating or updating ComplexRepresentation",function(T){return se(P,void 0,void 0,function(){var D,I,M;return ie(this,function(B){switch(B.label){case 0:return D=!1,d?((M=d.mustRecreate)===null||M===void 0?void 0:M.call(d,f,v,i))&&(d.destroy(),d=n(u,f,v,i),D=!0):(d=n(u,f,v,i),D=!0),I=d.createOrUpdate({webgl:i,runtime:T},m,v,A),I?[4,I]:[3,2];case 1:B.sent(),B.label=2;case 2:return D&&b(c),l.length=0,d&&d.renderObject&&(l.push(d.renderObject),s.add(d.renderObject.id,d.geometryVersion)),s.snapshot(),a+=1,o.next(a),[2]}})})})}function g(x){return x===void 0?Ne.Loci(f.target):d?d.getLoci(x):yr}function y(x,A){if(!f||!mi.is(c.markerActions,A))return!1;if(Ne.isLoci(x)||xe.is(x)||Ot.isLoci(x)){if(!Ne.areRootsEquivalent(x.structure,f))return!1;x=Xt.remap(x,f),(Ne.isLoci(x)||xe.is(x)&&xe.isWholeStructure(x))&&(x=RS)}else if(!go(x)&&!g0(x))return!1;return Xt.isEmpty(x)?!1:d?d.mark(x,A):!1}function b(x){if(va.update(c,x),x.visible!==void 0&&d&&d.setVisibility(x.visible&&(c.unitTransforms===null||c.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d){var A=Oa.remap(x.overpaint,f);d.setOverpaint(A,i)}if(x.transparency!==void 0&&d){var P=Ba.remap(x.transparency,f);d.setTransparency(P,i)}if(x.substance!==void 0&&d){var T=ka.remap(x.substance,f);d.setSubstance(T,i)}if(x.clipping!==void 0&&d){var D=an.remap(x.clipping,f);d.setClipping(D)}x.transform!==void 0&&d&&d.setTransform(x.transform),x.unitTransforms!==void 0&&d&&d.setVisibility(c.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function S(x){m=x}function C(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return p},get state(){return c},get theme(){return m},get geometryVersion(){return s.version},renderObjects:l,updated:o,createOrUpdate:h,setState:b,setTheme:S,getLoci:g,mark:y,destroy:C}}function BV(e,t,r){var n=t.elements,a=t.model;if(Ee.indexOf(n,r)!==-1){for(var i=a.atomicHierarchy.residueAtomSegments,o=i.index,s=i.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Ee.indexOf(n,c);f!==-1&&l.push(f)}var p=Ee.ofSortedArray(ze.ofSortedArray(l));return xe(e,[{unit:t,indices:p}])}return yr}function Y3e(e,t,r){var n=t.elements,a=t.model,i=a.atomicHierarchy.atoms.label_alt_id,o=i.value(r);if(Ee.indexOf(n,r)!==-1){var s=a.atomicHierarchy.residueAtomSegments.index,u=s[r];return cg(e,t,u,o)}return xe(e,[])}function cg(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Ee.indexOf(a,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var p=Ee.ofSortedArray(ze.ofSortedArray(u));return xe(e,[{unit:t,indices:p}])}function kV(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,i=a.length,o=i*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)oe.toArray(a[u].conformation.operator.matrix,s,u*16);return NP(s,i,r)}var K3e={atomic:{},spheres:{},gaussians:{}},Q3e=E.objectToOptions(K3e);function Z3e(e,t){for(var r=0,n=e.length;r<n;++r)if(Be.isAtomic(t)&&e[r]==="atomic"||Be.isSpheres(t)&&e[r]==="spheres"||Be.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var LV=5e8;function FV(e,t,r){r===void 0&&(r=LV);var n=Ut.size(w(),e);w.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],o=Math.ceil(i/(t*t));return{area:i,areaCells:o,maxAreaCells:a}}function wp(e,t,r){r===void 0&&(r=LV);var n=FV(e,t.resolution,r),a=n.area,i=n.areaCells,o=n.maxAreaCells,s=i>o?Math.sqrt(a/o):t.resolution;return _(_({},t),{resolution:s})}function $3e(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var ix={ignoreHydrogens:E.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:E.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:E.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};E.getDefaultValues(ix);var J3e=w();function ewe(e,t,r,n){return w.squaredDistance(w.set(J3e,e,t,r),n)}function twe(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=ze.indexOfInRange(t,r[i],n,a);s===-1?e[i]=-2:(e[i]=s,n=s)}}function ox(e,t,r,n){var a=n.ignoreHydrogens,i=n.traceOnly,o=n.includeParent,s=o?e.root.unitMap.get(t.id):t,u=$3e(s),l=u.x,c=u.y,d=u.z,f=s.elements,p=t.boundary.sphere,v=p.center,m=p.radius,h=(2+1.5)*2,g=(m+h)*(m+h),y,b;if(a||i||o&&s!==t){for(var S=[],C=[],x=0,A=f.length;x<A;++x){var P=f[x];a&&S2(s,P)||i&&!BE(s,P)||o&&ewe(l[P],c[P],d[P],v)>g||(S.push(P),C.push(x))}y=ze.ofSortedArray(S),b=C}else y=f,b=is(new Int32Array(y.length));o&&s!==t&&twe(b,t.elements,y);var T={indices:y,x:l,y:c,z:d,id:b},D=t===s?t.boundary:am(T),I=He.create(e,s),M=function(B){return I.element=B,r.size(I)};return{position:T,boundary:D,radius:M}}function OE(e,t,r,n){var a=He.create(e),i,o,s,u,l;if(r||n){for(var c=[],d=[],f=[],p=[],v=[],m=0,h=0,g=e.units.length;m<g;++m){var y=e.units[m],b=y.elements,S=y.conformation,C=S.x,x=S.y,A=S.z;a.unit=y;for(var P=0,T=b.length;P<T;++P){var D=b[P];r&&S2(y,D)||n&&!BE(y,D)||(c.push(C(D)),d.push(x(D)),f.push(A(D)),a.element=D,p.push(t.size(a)),v.push(h+P))}h+=b.length}i=c,o=d,s=f,u=p,l=v}else{for(var I=e.elementCount,c=new Float32Array(I),d=new Float32Array(I),f=new Float32Array(I),p=new Float32Array(I),m=0,h=0,g=e.units.length;m<g;++m){var y=e.units[m],b=y.elements,M=y.conformation,C=M.x,x=M.y,A=M.z;a.unit=y;for(var P=0,T=b.length;P<T;++P){var D=b[P],B=h+P;c[B]=C(D),d[B]=x(D),f[B]=A(D),a.element=D,p[B]=t.size(a)}h+=b.length}i=c,o=d,s=f,u=p,l=is(new Uint32Array(I))}var U={indices:Ee.ofRange(0,l.length),x:i,y:o,z:s,id:l},V=function(F){return u[F]};return{position:U,radius:V}}var NV=AS.H;function S2(e,t){return Be.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===NV}function x2(e,t){return e[t]===NV}function BE(e,t){if(Be.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function zm(e){if(Be.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,a=0,i=r.length;a<i;a++){var o=n(r[a]);o>t&&(t=o)}return t+1}function sx(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var a=n[r],i=zm(a.units[0]);i>t&&(t=i)}return t}function Ug(e){return E.MultiSelect(e,Q3e,{description:"For which kinds of units/chains to show the representation visuals."})}var ro={unitKinds:Ug(["atomic","spheres"]),includeParent:E.Boolean(!1,{isHidden:!0})},UV=_({},Rt.Params),rwe=_({},Dd.Params),zV=_({},ho.Params),nwe=_({},Qf.Params),VV=_({},on.Params),HV=_({},cs.Params),GV=_({},_o.Params),qV=_({},ds.Params);function awe(e,t,r,n,a,i){var o=Fa.getUtils(t),s=o.createValues,u=o.createRenderableState,l=zP(),c=s(t,l,r,n,a),d=u(a);return Lm(t.kind,c,d,i)}function Vm(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,v=d.updateRenderableState,m=d.createPositionIterator,h=Ou.create(),g={loci:yr,action:wt.None,status:-1},y,b,S,C,x=Object.assign({},r),A=qn.createEmpty(),P,T,D=-1,I,M;function B(W,K,$){if(!$&&!P)throw new Error("missing structure");if(b=Object.assign({},x,K),S=W,C=$,Ou.reset(h),!y||!P){h.createNew=!0,h.createGeometry=!0;return}s(h,b,x,S,A,C,P),Ne.areEquivalent(C,P)||(h.createGeometry=!0),Ne.areHierarchiesEqual(C,P)||(h.updateTransform=!0,h.createGeometry=!0),Ru.areEqual(W.color,A.color)||(h.updateColor=!0),Al(b.unitKinds,x.unitKinds)||(h.createGeometry=!0),P.child!==C.child&&(h.createGeometry=!0),h.updateSize&&!("uSize"in y.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}function U(W){if(h.createNew)if(I=a(C),W)y=awe(C,W,I,S,b,t),M=m(W,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(h.updateTransform){I=a(C);var K=I.instanceCount,$=I.groupCount;ms(K*$,y.values)}if(h.createGeometry)if(W)R.updateIfChanged(y.values.drawCount,Fa.getDrawCount(W)),R.updateIfChanged(y.values.uVertexCount,Fa.getVertexCount(W));else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(p(y.values,W||T),M=m(T,y.values)),h.updateSize&&"uSize"in y.values&&Jl(I,S.size,y.values),h.updateColor&&Po(I,M,S.color,y.values),f(y.values,b),v(y.state,b)}x=b,A=S,P=C,W&&(T=W,D+=1)}function V(W){return!!(go(W)||Ne.isLoci(W)&&Ne.areRootsEquivalent(W.structure,P)||xe.is(W)&&Ne.areRootsEquivalent(W.structure,P)&&xe.isWholeStructure(W))}function F(W,K,$){return V(W)?K(Ce.ofBounds(0,I.groupCount*I.instanceCount)):o(W,P,K,$)}function Y(W){y&&(l==null||l(y.values,T,x,A,W.webgl))}return{get groupCount(){return I?I.count:0},get renderObject(){return I&&I.count?y:void 0},get geometryVersion(){return D},createOrUpdate:function(W,K,$,J){if($===void 0&&($={}),B(K,$,J||P),h.createGeometry){var Z=n(W,C,S,b,T);if(tE(Z))return Z.then(function(N){U(N),Y(W)});U(Z)}else U();Y(W)},getLoci:function(W){return y?i(W,P,y.id):yr},mark:function(W,K){return ar.mark(y,W,K,F,g)},setVisibility:function(W){ar.setVisibility(y,W)},setAlphaFactor:function(W){ar.setAlphaFactor(y,W)},setPickable:function(W){ar.setPickable(y,W)},setColorOnly:function(W){ar.setColorOnly(y,W)},setTransform:function(W,K){ar.setTransform(y,W,K)},setOverpaint:function(W,K){var $={geometry:T,props:x,webgl:K};ar.setOverpaint(y,W,F,!0,$)},setTransparency:function(W,K){var $={geometry:T,props:x,webgl:K};ar.setTransparency(y,W,F,!0,$)},setSubstance:function(W,K){var $={geometry:T,props:x,webgl:K};ar.setSubstance(y,W,F,!0,$)},setClipping:function(W){ar.setClipping(y,W,F,!0)},destroy:function(){c==null||c(T),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var zg=_(_({},UV),ro);function _p(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Rt.Utils}),t)}var iwe=_(_({},zV),ro);function owe(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ho.Utils}),t)}var swe=_(_({},VV),ro);function uwe(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:on.Utils}),t)}var lwe=_(_({},HV),ro);function cwe(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:cs.Utils}),t)}var dwe=_(_({},GV),ro);function fwe(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:_o.Utils}),t)}var pwe=_(_({},qV),ro);function vwe(e,t){return Vm(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ds.Utils}),t)}function yn(e,t,r,n){var a=0,i=t.webgl,o=new xn,s=oc(),u=[],l=new Yt.GeometryState,c=va.create(),d=new Map,f,p,v,m,h=qn.createEmpty();function g(P,T){var D=this;return P===void 0&&(P={}),T&&T!==f&&(v=r(t,T),m||(m=E.getDefaultValues(v))),m=Object.assign({},m,P),Fe.create("Creating or updating UnitsRepresentation",function(I){return se(D,void 0,void 0,function(){var F,$,K,J,M,F,$,U,K,J,J,B,K,J,F,$,U,K,J,J,V,F,Y,W,K,$,J,J,Z,N,j;return ie(this,function(L){switch(L.label){case 0:if(!(!f&&!T))return[3,1];throw new Error("missing structure");case 1:if(!(T&&!f))return[3,8];p=T.unitSymmetryGroups,F=0,L.label=2;case 2:return F<p.length?($=p[F],K=n(s,T,m,i),J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,4]):[3,7];case 3:L.sent(),L.label=4;case 4:return S(K,$,c),d.set($.hashCode,{visual:K,group:$}),I.shouldUpdate?[4,I.update({message:"Creating or updating UnitsVisual",current:F,max:p.length})]:[3,6];case 5:L.sent(),L.label=6;case 6:return F++,[3,2];case 7:return[3,43];case 8:if(!(T&&(!Ne.areUnitIdsAndIndicesEqual(T,f)||T.child!==f.child)))return[3,22];p=T.unitSymmetryGroups,M=d,d=new Map,F=0,L.label=9;case 9:return F<p.length?($=p[F],U=M.get($.hashCode),U?(K=U.visual,((Z=K.mustRecreate)===null||Z===void 0?void 0:Z.call(K,{group:$,structure:T},m,i))?(K.destroy(),K=n(s,T,m,i),J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,11]):[3,12]):[3,15]):[3,21];case 10:L.sent(),L.label=11;case 11:return S(K,$,c),[3,14];case 12:return J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,14];case 13:L.sent(),L.label=14;case 14:return d.set($.hashCode,{visual:K,group:$}),M.delete($.hashCode),K.renderObject&&(B=K.renderObject.values.tMarker.ref.value.array,Ks(B,Ce.ofBounds(0,B.length),wt.RemoveHighlight)),[3,18];case 15:return K=n(s,T,m,i),J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,17];case 16:L.sent(),L.label=17;case 17:S(K,$,c),d.set($.hashCode,{visual:K,group:$}),L.label=18;case 18:return I.shouldUpdate?[4,I.update({message:"Creating or updating UnitsVisual",current:F,max:p.length})]:[3,20];case 19:L.sent(),L.label=20;case 20:return F++,[3,9];case 21:return M.forEach(function(H){var G=H.visual;G.destroy()}),[3,43];case 22:if(!(T&&T!==f&&Ne.areUnitIdsAndIndicesEqual(T,f)))return[3,34];p=T.unitSymmetryGroups,F=0,L.label=23;case 23:return F<p.length?($=p[F],U=d.get($.hashCode),U?(K=U.visual,((N=K.mustRecreate)===null||N===void 0?void 0:N.call(K,{group:$,structure:T},m,t.webgl))?(K.destroy(),K=n(s,T,m,t.webgl),U.visual=K,J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,25]):[3,26]):[3,29]):[3,33];case 24:L.sent(),L.label=25;case 25:return S(K,$,c),[3,28];case 26:return J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:T}),J?[4,J]:[3,28];case 27:L.sent(),L.label=28;case 28:return U.group=$,[3,30];case 29:throw new Error("expected to find visual for hashCode ".concat($.hashCode));case 30:return I.shouldUpdate?[4,I.update({message:"Creating or updating UnitsVisual",current:F,max:p.length})]:[3,32];case 31:L.sent(),L.label=32;case 32:return F++,[3,23];case 33:return[3,43];case 34:V=[],d.forEach(function(H){return V.push(H)}),F=0,Y=V.length,L.label=35;case 35:return F<Y?(W=V[F],K=W.visual,$=W.group,((j=K.mustRecreate)===null||j===void 0?void 0:j.call(K,{group:$,structure:f},m,t.webgl))?(K.destroy(),K=n(s,f,m,i),V[F].visual=K,J=K.createOrUpdate({webgl:i,runtime:I},h,m,{group:$,structure:f}),J?[4,J]:[3,37]):[3,38]):[3,43];case 36:L.sent(),L.label=37;case 37:return S(K,$,c),[3,40];case 38:return J=K.createOrUpdate({webgl:i,runtime:I},h,m),J?[4,J]:[3,40];case 39:L.sent(),L.label=40;case 40:return I.shouldUpdate?[4,I.update({message:"Creating or updating UnitsVisual",current:F,max:Y})]:[3,42];case 41:L.sent(),L.label=42;case 42:return++F,[3,35];case 43:return u.length=0,d.forEach(function(H){var G=H.visual;G.renderObject&&(u.push(G.renderObject),l.add(G.renderObject.id,G.geometryVersion))}),l.snapshot(),T&&(f=T),o.next(a++),[2]}})})})}function y(P){if(P===void 0)return Ne.Loci(f.target);var T=yr;return d.forEach(function(D){var I=D.visual,M=I.getLoci(P);fi(M)||(T=M)}),T}function b(P,T){if(!f||!mi.is(c.markerActions,T))return!1;if(Ne.isLoci(P)||xe.is(P)||Ot.isLoci(P)){if(!Ne.areRootsEquivalent(P.structure,f))return!1;P=Xt.remap(P,f),(Ne.isLoci(P)||xe.is(P)&&xe.isWholeStructure(P))&&(P=RS)}else if(!go(P)&&!g0(P))return!1;if(Xt.isEmpty(P))return!1;var D=!1;return d.forEach(function(I){var M=I.visual;D=M.mark(P,T)||D}),D}function S(P,T,D){var I=D.visible,M=D.alphaFactor,B=D.pickable,U=D.overpaint,V=D.transparency,F=D.substance,Y=D.clipping,W=D.transform,K=D.unitTransforms;I!==void 0&&P.setVisibility(I),M!==void 0&&P.setAlphaFactor(M),B!==void 0&&P.setPickable(B),U!==void 0&&P.setOverpaint(U,i),V!==void 0&&P.setTransparency(V,i),F!==void 0&&P.setSubstance(F,i),Y!==void 0&&P.setClipping(Y),W!==void 0&&P.setTransform(W),K!==void 0&&(K?P.setTransform(void 0,K.getSymmetryGroupTransforms(T)):P.setTransform(void 0,null))}function C(P){var T=P.visible,D=P.alphaFactor,I=P.pickable,M=P.overpaint,B=P.transparency,U=P.substance,V=P.clipping,F=P.transform,Y=P.unitTransforms,W=P.syncManually,K=P.markerActions,$={};T!==c.visible&&($.visible=T),D!==c.alphaFactor&&($.alphaFactor=D),I!==c.pickable&&($.pickable=I),M!==void 0&&f&&($.overpaint=Oa.remap(M,f)),B!==void 0&&f&&($.transparency=Ba.remap(B,f)),U!==void 0&&f&&($.substance=ka.remap(U,f)),V!==void 0&&f&&($.clipping=an.remap(V,f)),F!==void 0&&!oe.areEqual(F,c.transform,zr)&&($.transform=F),(Y!==c.unitTransforms||(Y==null?void 0:Y.version)!==P.unitTransformsVersion)&&($.unitTransforms=Y,c.unitTransformsVersion=Y?Y==null?void 0:Y.version:-1),W!==c.syncManually&&($.syncManually=W),K!==c.markerActions&&($.markerActions=K),d.forEach(function(J){var Z=J.visual,N=J.group;return S(Z,N,$)}),va.update(c,$)}function x(P){h=P}function A(){d.forEach(function(P){var T=P.visual;return T.destroy()}),d.clear()}return{label:e,get groupCount(){var P=0;return d.forEach(function(T){var D=T.visual;D.renderObject&&(P+=D.groupCount)}),P},get geometryVersion(){return l.version},get props(){return m},get params(){return v},get state(){return c},get theme(){return h},renderObjects:u,updated:o,createOrUpdate:g,setState:C,setTheme:x,getLoci:y,mark:b,destroy:A}}function mwe(e,t,r,n,a,i){var o=Fa.getUtils(t),s=o.createValues,u=o.createRenderableState,l=kV(e,a.includeParent),c=s(t,l,r,n,a),d=u(a);return Lm(t.kind,c,d,i)}function Ap(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,v=d.updateBoundingSphere,m=d.updateRenderableState,h=d.createPositionIterator,g=Ou.create(),y={loci:yr,action:wt.None,status:-1},b,S=Object.assign({},r),C=qn.createEmpty(),x,A,P,T,D,I=-1,M,B;function U($,J,Z){if(!Z&&!T)throw new Error("missing structureGroup");if(S=J,C=$,x=Z,Ou.reset(g),!b||!T){g.createNew=!0,g.createGeometry=!0;return}s(g,S,A,C,P,x,T),Ne.areHierarchiesEqual(T.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),Ru.areEqual(C.color,P.color)||(g.updateColor=!0),T.structure.child!==x.structure.child&&(g.createGeometry=!0),Al(S.unitKinds,A.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==T.group.transformHash&&(x.group.units.length!==T.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var N=x.group.units[0],j=T.group.units[0];Be.areOperatorsEqual(N,j)||(g.updateTransform=!0),Be.areConformationsEqual(N,j)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in b.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(T.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(C.color.granularity.startsWith("vertex")||b.values.dColorType.ref.value.startsWith("vertex")||C.color.granularity.startsWith("volume")||b.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function V($){if(g.createNew)if(M=a(x),$)b=mwe(x,$,M,C,S,t),B=h($,b.values);else throw new Error("expected geometry to be given");else{if(!b)throw new Error("expected renderObject to be available");if(g.updateTransform){M=a(x);var J=M.instanceCount,Z=M.groupCount;ms(J*Z,b.values)}if(g.updateMatrix&&kV(x,S.includeParent,b.values),g.createGeometry)if($)R.updateIfChanged(b.values.drawCount,Fa.getDrawCount($)),R.updateIfChanged(b.values.uVertexCount,Fa.getVertexCount($));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(v(b.values,$||D),B=h($||D,b.values)),g.updateSize&&"uSize"in b.values&&Jl(M,C.size,b.values),g.updateColor&&Po(M,B,C.color,b.values),p(b.values,S),m(b.state,S)}A=S,P=C,T=x,$&&(D=$,I+=1)}function F($,J,Z,N,j,L){return Z3e(j.unitKinds,J)?n($,J,Z,N,j,L):f(L)}function Y($){return!!(go($)||Ne.isLoci($)&&Ne.areRootsEquivalent($.structure,T.structure)||xe.is($)&&Ne.areRootsEquivalent($.structure,T.structure)&&xe.isWholeStructure($))}function W($,J,Z){return Y($)?J(Ce.ofBounds(0,M.groupCount*M.instanceCount)):o($,T,J,Z)}function K($){b&&(l==null||l(b.values,D,A,P,$.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?b:void 0},get geometryVersion(){return I},createOrUpdate:function($,J,Z,N){if(U(J,Z,N||T),g.createGeometry){var j=F($,x.group.units[0],x.structure,C,S,D);if(tE(j))return j.then(function(L){V(L),K($)});V(j)}else V();K($)},getLoci:function($){return b?i($,T,b.id):yr},mark:function($,J){var Z=!0;if(xe.is($)){Z=!1;for(var N=T.group.units[0].invariantId,j=0,L=$.elements;j<L.length;j++){var H=L[j];if(H.unit.invariantId===N){Z=!0;break}}}return Z?ar.mark(b,$,J,W,y):!1},setVisibility:function($){ar.setVisibility(b,$)},setAlphaFactor:function($){ar.setAlphaFactor(b,$)},setPickable:function($){ar.setPickable(b,$)},setColorOnly:function($){ar.setColorOnly(b,$)},setTransform:function($,J){ar.setTransform(b,$,J)},setOverpaint:function($,J){var Z={geometry:D,props:A,webgl:J};ar.setOverpaint(b,$,W,!0,Z)},setTransparency:function($,J){var Z={geometry:D,props:A,webgl:J};ar.setTransparency(b,$,W,!0,Z)},setSubstance:function($,J){var Z={geometry:D,props:A,webgl:J};ar.setSubstance(b,$,W,!0,Z)},setClipping:function($){ar.setClipping(b,$,W,!0)},destroy:function(){c==null||c(D),b&&(b.state.disposed=!0,b=void 0)},mustRecreate:u}}var $a=_(_({},UV),ro);function Bi(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:Rt.Utils}),t)}var jV=_(_({},rwe),ro);function WV(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Dd.Utils}),t)}var XV=_(_({},zV),ro);function YV(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:ho.Utils}),t)}var hwe=_(_({},nwe),ro);function gwe(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Qf.Utils}),t)}var ux=_(_({},VV),ro);function lx(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:on.Utils}),t)}_(_({},HV),ro);var ywe=_(_({},GV),ro);function bwe(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:_o.Utils}),t)}var Swe=_(_({},qV),ro);function xwe(e,t){return Ap(_(_({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),pa.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ds.Utils}),t)}var va={create:function(){return _(_({},Yt.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){Yt.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};var jy=w(),Wy=w(),Zd=w(),O3=Le.add,iB=Le.add3,C2;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Le.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Le.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Le.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=Le.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),l=Le.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),c=function(f,p,v,m,h,g,y,b,S,C){for(var x=0;x<6;++x)iB(o,f,p,v),iB(s,m,h,g),O3(i,C),O3(u,y),O3(l,(b?1:0)+(S?2:0))},d=function(f,p,v,m,h,g,y){var b=w.distance(f,p),S=Math.floor(v/2),C=1/v;w.sub(Zd,p,f);for(var x=0;x<S;++x){var A=C*(x*2+1);w.setMagnitude(Zd,Zd,b*A),w.add(jy,f,Zd),w.setMagnitude(Zd,Zd,b*C*((x+1)*2)),w.add(Wy,f,Zd),c(jy[0],jy[1],jy[2],Wy[0],Wy[1],Wy[2],m,h,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,v,m,h,g,y){var b=w.distance(f,p);d(f,p,b/v,m,h,g,y)},getCylinders:function(){var f=i.elementCount/6,p=Le.compact(i,!0),v=Le.compact(o,!0),m=Le.compact(s,!0),h=Le.compact(u,!0),g=Le.compact(l,!0),y=a&&f<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(f*18),b=a&&f<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(f*12);return(!a||f>a.cylinderCount)&&Cwe(f,y,b),ho.create(y,b,p,v,m,h,g,f,a)}}}e.create=t})(C2||(C2={}));function Cwe(e,t,r){for(var n=0;n<e;++n){var a=n*18;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(var n=0;n<e;++n){var i=n*6,o=n*12;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}var Tp={linkScale:E.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:E.Numeric(1,{min:0,max:2,step:.01}),linkCap:E.Boolean(!1),aromaticScale:E.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:E.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:E.Numeric(2,{min:2,max:6,step:2}),dashCount:E.Numeric(4,{min:2,max:10,step:2}),dashScale:E.Numeric(.8,{min:0,max:2,step:.1}),dashCap:E.Boolean(!0),stubCap:E.Boolean(!0),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)};E.getDefaultValues(Tp);var KV={linkScale:E.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:E.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:E.Numeric(2,{min:2,max:6,step:2}),dashCount:E.Numeric(4,{min:2,max:10,step:2})};E.getDefaultValues(KV);var hr=w(),bc=w(),Bo=w(),wwe=w.create(0,1,0);function kE(e,t,r,n){w.normalize(bc,w.sub(bc,t,r)),n!==null?w.sub(Bo,t,n):w.copy(Bo,t),w.normalize(Bo,Bo);var a=w.dot(bc,Bo);return 1-Math.abs(a)<1e-5&&(w.set(Bo,1,0,0),a=w.dot(bc,Bo),1-Math.abs(a)<1e-5&&(w.set(Bo,0,1,0),a=w.dot(bc,Bo))),w.setMagnitude(bc,bc,a),w.sub(Bo,Bo,bc),w.normalize(e,Bo)}var co=w.scale,Ma=w.add,rn=w.sub,za=w.setMagnitude,_we=w.dot;function Pp(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return Rt.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,v=r.linkCap,m=r.aromaticScale,h=r.aromaticSpacing,g=r.aromaticDashCount,y=r.dashCount,b=r.dashScale,S=r.dashCap,C=r.stubCap,x=p*2*a*2,A=ct.createState(x,x/4,n),P=w(),T=w(),D=w(),I={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:v,bottomCap:v},M=y+1,B=0,U=a;B<U;++B)if(!(l&&l(B))){o(P,T,B),rn(hr,T,P);var V=_we(hr,wwe)>0,F=u(B),Y=s?s(B):0,W=C&&(c?c(B):!1),K=V?[W,v]:[v,W],$=K[0],J=K[1];A.currentGroup=B;var Z=g+1;if(Y===0)I.radiusTop=I.radiusBottom=F,I.topCap=$,I.bottomCap=J,ga(A,P,T,.5,I);else if(Y===1)I.radiusTop=I.radiusBottom=F*b,I.topCap=I.bottomCap=S,x0(A,P,T,.5,M,I);else if(Y===2||Y===3||Y===4||Y===5||Y===7||Y===8){var N=Y===2||Y===3?2:Y===4||Y===5?3:1.5,j=F*(d/(.5*N)),L=(F-j)*f;if(kE(D,P,T,i?i(B):null),I.topCap=$,I.bottomCap=J,Y===7||Y===8){I.radiusTop=I.radiusBottom=F,ga(A,P,T,.5,I);var H=F+m*F+m*F*h;za(hr,rn(hr,T,P),F*.5),Ma(P,P,hr),rn(T,T,hr),I.radiusTop=I.radiusBottom=F*m,I.topCap=I.bottomCap=S,za(D,D,H),rn(P,P,D),rn(T,T,D),x0(A,P,T,.5,Z,I),Y===8&&(za(D,D,H*2),Ma(P,P,D),Ma(T,T,D),x0(A,P,T,.5,Z,I))}else if(Y===3||Y===5){var G=F+j+d*F*f;za(D,D,G),I.radiusTop=I.radiusBottom=F,ga(A,P,T,.5,I),co(hr,hr,f*d*.2),Ma(P,P,hr),rn(T,T,hr),I.radiusTop=I.radiusBottom=j,I.topCap=V?W:S,I.bottomCap=V?S:W,za(D,D,G),rn(P,P,D),rn(T,T,D),ga(A,P,T,.5,I),N===3&&(za(D,D,G*2),Ma(P,P,D),Ma(T,T,D),ga(A,P,T,.5,I))}else za(D,D,L),I.radiusTop=I.radiusBottom=j,N===3&&ga(A,P,T,.5,I),rve(A,P,T,.5,D,I)}else Y===6&&(co(hr,hr,.475),Ma(P,P,hr),rn(T,T,hr),I.radiusTop=I.radiusBottom=F,I.topCap=$,I.bottomCap=J,ga(A,P,T,.5,I))}return ct.getMesh(A)}function QV(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!a)return ho.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,v=r.aromaticScale,m=r.aromaticSpacing,h=r.aromaticDashCount,g=r.dashCount,y=r.dashScale,b=r.dashCap,S=r.stubCap,C=a*2,x=C2.create(C,C/4,n),A=w(),P=w(),T=w(),D=w(),I=g%2===1?g:g+1,M=.5-.5/2/I,B=h+1,U=.5-.5/2/B,V=0,F=a;V<F;++V)if(!(l&&l(V))){o(A,P,V);var Y=u(V),W=s?s(V):0,K=S&&(c?c(V):!1);if(W===0)co(T,Ma(T,A,P),.5),x.add(A[0],A[1],A[2],T[0],T[1],T[2],1,p,K,V);else if(W===1)co(hr,rn(hr,P,A),M),rn(P,P,hr),x.addFixedCountDashes(A,P,I,y,b,b,V);else if(W===2||W===3||W===4||W===5||W===7||W===8){var $=W===2||W===3?2:W===4||W===5?3:1.5,J=d/(.5*$),Z=(Y-J*Y)*f;if(co(T,Ma(T,A,P),.5),kE(D,A,P,i?i(V):null),W===7||W===8){x.add(A[0],A[1],A[2],T[0],T[1],T[2],1,p,K,V);var N=Y+v*Y+v*Y*m;co(hr,rn(hr,P,A),U),rn(P,P,hr),za(hr,rn(hr,P,A),Y*.5),Ma(A,A,hr),za(D,D,N),rn(A,A,D),rn(P,P,D),x.addFixedCountDashes(A,P,B,v,b,b,V),W===8&&(za(D,D,N*2),Ma(A,A,D),Ma(P,P,D),x.addFixedCountDashes(A,P,B,v,b,b,V))}else if(W===3||W===5){var j=Y+J*Y+d*Y*f;za(D,D,j),x.add(A[0],A[1],A[2],T[0],T[1],T[2],1,p,K,V),za(hr,rn(hr,A,P),Y/1.5),rn(A,A,hr),$===3&&x.add(A[0]+D[0],A[1]+D[1],A[2]+D[2],T[0]+D[0],T[1]+D[1],T[2]+D[2],J,p,K,V),x.add(A[0]-D[0],A[1]-D[1],A[2]-D[2],T[0]-D[0],T[1]-D[1],T[2]-D[2],J,b,K,V)}else za(D,D,Z),$===3&&x.add(A[0],A[1],A[2],T[0],T[1],T[2],J,p,K,V),x.add(A[0]+D[0],A[1]+D[1],A[2]+D[2],T[0]+D[0],T[1]+D[1],T[2]+D[2],J,p,K,V),x.add(A[0]-D[0],A[1]-D[1],A[2]-D[2],T[0]-D[0],T[1]-D[1],T[2]-D[2],J,p,K,V)}else W===6&&(co(hr,rn(hr,P,A),.475),Ma(A,A,hr),rn(P,P,hr),x.add(A[0],A[1],A[2],P[0],P[1],P[2],1,p,K,V))}return x.getCylinders()}function ZV(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return on.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.aromaticDashCount,f=r.dashCount,p=a*2,v=to.create(p,p/4,n),m=w(),h=w(),g=w(),y=w(),b=f%2===1?f:f+1,S=.5-.5/2/b,C=d+1,x=.5-.5/2/C,A=4.5,P=3,T=0,D=a;T<D;++T)if(!(u&&u(T))){o(m,h,T);var I=s?s(T):0;if(I===0)co(g,Ma(g,m,h),.5),v.add(m[0],m[1],m[2],g[0],g[1],g[2],T);else if(I===1)co(hr,rn(hr,h,m),S),rn(h,h,hr),v.addFixedCountDashes(m,h,b,T);else if(I===2||I===3||I===4||I===5||I===7||I===8){var M=I===2||I===3?2:I===4||I===5?3:1.5,B=1*(l/(.5*M)),U=(1-B)*c;co(g,Ma(g,m,h),.5),kE(y,m,h,i?i(T):null),I===7||I===8?(v.add(m[0],m[1],m[2],g[0],g[1],g[2],T),co(hr,rn(hr,h,m),x),rn(h,h,hr),za(y,y,U*A),rn(m,m,y),rn(h,h,y),v.addFixedCountDashes(m,h,C,T),I===8&&(za(y,y,U*A*2),Ma(m,m,y),Ma(h,h,y),v.addFixedCountDashes(m,h,C,T))):I===3||I===5?(za(y,y,U*P),v.add(m[0],m[1],m[2],g[0],g[1],g[2],T),co(hr,rn(hr,m,h),c*l),rn(m,m,hr),M===3&&v.add(m[0]+y[0],m[1]+y[1],m[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],T),v.add(m[0]-y[0],m[1]-y[1],m[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],T)):(za(y,y,U*1.5),M===3&&v.add(m[0],m[1],m[2],g[0],g[1],g[2],T),v.add(m[0]+y[0],m[1]+y[1],m[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],T),v.add(m[0]-y[0],m[1]-y[1],m[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],T))}else I===6&&(co(hr,rn(hr,h,m),.475),Ma(m,m,hr),rn(h,h,hr),v.add(m[0],m[1],m[2],h[0],h[1],h[2],T))}return v.getLines()}function Awe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P;return ie(this,function(T){return Be.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Rt.createEmpty(i)]:(u=He.create(r,t),l=_n.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,p=c.y,v=c.z,m=c.members,h=c.offsets,g=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,C=a.sizeFactor,g?(x={linkCount:g*2,position:function(D,I,M){w.set(D,f[y[M]],p[y[M]],v[y[M]]),w.set(I,f[b[M]],p[b[M]],v[b[M]])},style:function(D){return 1},radius:function(D){u.element=t.elements[m[h[y[D]]]];var I=n.size.size(u);u.element=t.elements[m[h[b[D]]]];var M=n.size.size(u);return Math.min(I,M)*C},ignore:function(D){if(S[D]===1)return!0;if(s)for(var I=y[D],M=h[I],B=h[I+1];M<B;++M){var U=t.elements[m[h[M]]];if(!ze.has(s.elements,U))return!0}return!1}},A=Pp(e,x,a,i),P=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*C),A.setBoundingSphere(P),[2,A]):[2,Rt.createEmpty(i)])):[2,Rt.createEmpty(i)]})})}var $V=_(_(_({},$a),Tp),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),dashCount:E.Numeric(6,{min:2,max:10,step:2}),dashScale:E.Numeric(.4,{min:0,max:2,step:.1}),includeParent:E.Boolean(!1)});function Twe(e){return Bi({defaultProps:E.getDefaultValues($V),createGeometry:Awe,createLocationIterator:Iwe,getLoci:Pwe,eachLocation:Ewe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=_n.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function Pwe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[a].id),l=_n.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return Nl.Loci(o,l,[{unitA:u,indexA:d[i],unitB:u,indexB:f[i]},{unitA:u,indexA:f[i],unitB:u,indexB:d[i]}])}return yr}var B3=new Set;function Ewe(e,t,r,n){var a=!1;if(Nl.isLoci(e)){var i=t.structure,o=t.group;if(!Ne.areEquivalent(e.data.structure,i))return!1;var s=_n.get(i).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var p=f[d];if(p.unitA===p.unitB){var v=o.unitIndexMap.get(p.unitA.id);if(v!==void 0){var m=l.getDirectedEdgeIndex(p.indexA,p.indexB);m!==-1&&r(Ce.ofSingleton(v*c+m))&&(a=!0)}}}}else if(xe.is(e)){var i=t.structure,o=t.group;if(!Ne.areEquivalent(e.structure,i))return!1;var s=_n.get(i).value;if(!s)return!1;for(var u=o.units[0],h=s.unitsContacts.get(u.id),g=s.unitsFeatures.get(u.id),y=h.edgeCount*2,b=h.offset,S=g.elementsIndex,C=S.offsets,x=S.indices,A=g.members,P=g.offsets,T=function(F){var Y=o.unitIndexMap.get(F.unit.id);if(Y===void 0)return"continue";Ee.forEach(F.indices,function(W){for(var K=C[W],$=C[W+1];K<$;++K)for(var J=x[K],Z=b[J],N=b[J+1];Z<N;++Z)B3.add(Z)}),B3.forEach(function(W){if(n){for(var K=h.a[W],$=P[K],J=P[K+1];$<J;++$)if(!Ee.has(F.indices,A[$]))return;for(var Z=h.b[W],$=P[Z],J=P[Z+1];$<J;++$)if(!Ee.has(F.indices,A[$]))return}r(Ce.ofSingleton(Y*y+W))&&(a=!0)}),B3.clear()},D=0,I=e.elements;D<I.length;D++){var p=I[D];T(p)}}return a}function Iwe(e){var t=e.structure,r=e.group,n=r.units[0],a=_n.get(t).value,i=a.unitsContacts.get(n.id),o=i.edgeCount*2,s=r.units.length,u=Nl.Location(a,t),l=u.element,c=function(d,f){var p=r.units[f];return l.unitA=p,l.indexA=i.a[d],l.unitB=p,l.indexB=i.b[d],u};return sn(o,s,1,c)}function Dwe(e,t,r,n,a){if(!t.hasAtomic)return Rt.createEmpty(a);var i=He.create(t),o=_n.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Rt.createEmpty(a);var f=t.child,p={linkCount:l,position:function(h,g,y){var b=c[y],S=b.unitA,C=b.indexA,x=b.unitB,A=b.indexB,P=u.get(S),T=u.get(x),D=t.unitMap.get(S),I=t.unitMap.get(x);w.set(h,P.x[C],P.y[C],P.z[C]),w.transformMat4(h,h,D.conformation.operator.matrix),w.set(g,T.x[A],T.y[A],T.z[A]),w.transformMat4(g,g,I.conformation.operator.matrix)},style:function(h){return 1},radius:function(h){var g=c[h],y=u.get(g.unitA);i.unit=t.unitMap.get(g.unitA),i.element=i.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(i),S=u.get(g.unitB);i.unit=t.unitMap.get(g.unitB),i.element=i.unit.elements[S.members[S.offsets[g.indexB]]];var C=r.size.size(i);return Math.min(b,C)*d},ignore:function(h){if(c[h].props.flag===1)return!0;if(f){var g=c[h],y=f.unitMap.get(g.unitA);if(!y)return!0;for(var b=t.unitMap.get(g.unitA),S=u.get(g.unitA),C=S.offsets,x=S.members,A=C[g.indexA],P=C[g.indexA+1];A<P;++A){var T=b.elements[x[A]];if(!ze.has(y.elements,T))return!0}}return!1}},v=Pp(e,p,n,a),m=Me.expand(Me(),(f!=null?f:t).boundary.sphere,1*d);return v.setBoundingSphere(m),v}var JV=_(_(_({},zg),Tp),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),dashCount:E.Numeric(6,{min:2,max:10,step:2}),dashScale:E.Numeric(.4,{min:0,max:2,step:.1}),includeParent:E.Boolean(!1)});function Mwe(e){return _p({defaultProps:E.getDefaultValues(JV),createGeometry:Dwe,createLocationIterator:Bwe,getLoci:Rwe,eachLocation:Owe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=_n.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function Rwe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=_n.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Nl.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return yr}var Xy=new Map,k3=new Set;function Owe(e,t,r,n){var a=!1;if(Nl.isLoci(e)){if(!Ne.areEquivalent(e.data.structure,t))return!1;var i=_n.get(t).value;if(e.data.interactions!==i)return!1;for(var o=i.contacts,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=o.getEdgeIndex(l.indexA,l.unitA.id,l.indexB,l.unitB.id);c!==-1&&r(Ce.ofSingleton(c))&&(a=!0)}}else if(xe.is(e)){if(!Ne.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var i=_n.get(t).value;if(!i)return!1;for(var d=i.contacts,f=i.unitsFeatures,p=0,v=e.elements;p<v.length;p++){var m=v[p];Xy.set(m.unit.id,m.indices)}for(var h=function(S){var C=S.unit;if(!Be.isAtomic(C))return"continue";Ee.forEach(S.indices,function(x){for(var A=0,P=d.getContactIndicesForElement(x,C);A<P.length;A++){var T=P[A];k3.add(T)}})},g=0,y=e.elements;g<y.length;g++){var m=y[g];h(m)}k3.forEach(function(S){if(n){var C=d.edges[S],x=C.indexA,A=C.unitA,P=C.indexB,T=C.unitB,D=Xy.get(A),I=Xy.get(T);if(!D||!I)return;for(var M=f.get(A),B=M.offsets,U=M.members,V=B[x],F=B[x+1];V<F;++V)if(!Ee.has(D,U[V]))return;for(var Y=f.get(T),W=Y.offsets,K=Y.members,V=W[P],F=W[P+1];V<F;++V)if(!Ee.has(I,K[V]))return}r(Ce.ofSingleton(S))&&(a=!0)}),Xy.clear(),k3.clear()}return a}function Bwe(e){var t=_n.get(e).value,r=t.contacts,n=r.edgeCount,a=1,i=Nl.Location(t,e),o=i.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,i};return sn(n,a,1,s,!0)}var eH={"intra-unit":function(e,t){return yn("Intra-unit interactions cylinder",e,t,Twe)},"inter-unit":function(e,t){return Hs("Inter-unit interactions cylinder",e,t,Mwe)}},tH=_(_(_({},$V),JV),{unitKinds:Ug(["atomic"]),sizeFactor:E.Numeric(.2,{min:.01,max:1,step:.01}),visuals:E.MultiSelect(["intra-unit","inter-unit"],E.objectToOptions(eH))});function kwe(e,t){return E.clone(tH)}function Lwe(e,t){return Yt.createMulti("Interactions",e,t,va,eH)}var w2={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:Lwe,getParams:kwe,defaultValues:E.getDefaultValues(tH),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&_n.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return _n.attach(e,t,void 0,!0)},detach:function(e){return _n.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},Fwe=Pr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=_n,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=xe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Ee.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(!!f){for(var p=[],v=[],m=[],h=Ee.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,C=b.offsets,x=C[h],A=C[h+1];x<A;++x){var P=S[x],T=g[P],D=y[P];T&&p.push($xe(T)),D&&v.push(Jxe(D))}p.length&&m.push("<small>Types</small> ".concat(p.join(", "))),v.length&&m.push("<small>Groups</small> ".concat(v.join(", "))),m.length&&a.push("Interaction Feature: ".concat(m.join(" | ")))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(Kt.Generators.ofType(fe.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&On(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(lA),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(w2)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(lA),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(w2)},t}(Pr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}}),Nwe=Pr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=ls,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Pr.Handler),params:function(){return{autoAttach:E.Boolean(!1)}}}),Uwe=Pr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ng,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(!!l){var c=xe.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Ee.size(d.indices)===1){var f=l.get(d.unit.id);if(!!f){var p=Ee.start(d.indices),v=f.charge[p],m=f.idealGeometry[p],h=f.implicitH[p],g=f.totalH[p];a.push("Valence Model: <small>Charge</small> ".concat(v," | <small>Ideal Geometry</small> ").concat(jxe(m)," | <small>Implicit H</small> ").concat(h," | <small>Total H</small> ").concat(g))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(Kt.Generators.ofType(fe.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&On(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Pr.Handler),params:function(){return{autoAttach:E.Boolean(!1),showTooltip:E.Boolean(!0)}}}),Gs;(function(e){var t=this;e.Provider=om.createProvider({label:"Best Database Sequence Mapping",descriptor:xo({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(i){var o,s;return Xr.is(i.sourceData)&&((s=(o=i.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("pdbx_sifts_xref_db_name"))>=0},obtain:function(i,o){return se(t,void 0,void 0,function(){return ie(this,function(s){return[2,{value:a(o)}]})})}});function r(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.index[u];return s.accession[l]}e.getKey=r;function n(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!!s){var u=i.unit.elements[i.element],l=o.atomicHierarchy.residueAtomSegments.index[u],c=s.dbName[l];if(!!c)return"".concat(c," ").concat(s.accession[l]," ").concat(s.num[l]," ").concat(s.residue[l])}}e.getLabel=n;function a(i){if(!!Xr.is(i.sourceData)){var o=i.sourceData.data.frame.categories.atom_site,s=o.getField("pdbx_sifts_xref_db_name"),u=o.getField("pdbx_sifts_xref_db_acc"),l=o.getField("pdbx_sifts_xref_db_num"),c=o.getField("pdbx_sifts_xref_db_res");if(!(!s||!u||!l||!c)){for(var d=i.atomicHierarchy.atomSourceIndex,f=i.atomicHierarchy.residueAtomSegments,p=f.count,v=f.offsets,m=new Array(p),h=new Array(p),g=new Array(p),y=new Array(p),b=0;b<p;b++){var S=d.value(v[b]);if(s.valueKind(S)!==0){m[b]="",h[b]="",g[b]=0,y[b]="";continue}m[b]=s.str(S),h[b]=u.str(S),g[b]=l.int(S),y[b]=c.str(S)}return{dbName:m,accession:h,num:g,residue:y}}}}})(Gs||(Gs={}));var L3=$e(16448250),zwe="Assigns a color based on best dababase sequence mapping.",Sh=new Map,rH=_({},Eo({type:"colors",colorList:"set-1"}));function Vwe(e){return rH}function nH(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var i=a[n],o=Gs.Provider.get(i).value;if(!!o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||Sh.has(l)||Sh.set(l,Sh.size)}}var c=He.create(e.structure),d=hs(Sh.size+1,t,{valueLabel:function(v){return"".concat(v)}}),f=new Map,p=function(v){var m=Gs.getKey(v);if(!m)return L3;if(f.has(m))return f.get(m);var h=d.color(Sh.get(m));return f.set(m,h),h};r=function(v){return He.is(v)&&Be.isAtomic(v.unit)?p(v):Ot.isLocation(v)?(c.unit=v.aUnit,c.element=v.aUnit.elements[v.aIndex],p(c)):L3}}else r=function(){return L3};return{factory:nH,granularity:"group",preferSmoothing:!0,color:r,props:t,description:zwe}}var oB={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:nH,getParams:Vwe,defaultValues:E.getDefaultValues(rH),isApplicable:function(e){var t;return!!((t=e.structure)===null||t===void 0?void 0:t.models.some(function(r){return Gs.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return se(void 0,void 0,void 0,function(){var r,n,a;return ie(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?(a=n[r],[4,Gs.Provider.attach(e,a,void 0,!0)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(!!e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];Gs.Provider.ref(n,!1)}}}},Hwe=Pr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Gs.Provider,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return Gwe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(oB),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(oB),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Pr.Handler),params:function(){return{autoAttach:E.Boolean(!0),showTooltip:E.Boolean(!0)}}});function Gwe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=He.create(e.structure,r,r.elements[Ee.getAt(t.indices,0)]);return Gs.getLabel(n)}}var Ul;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=Xs.create(e.Descriptor);function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(v,m,h){var g=v.get(m);g?g.push(h):v.set(m,[h])}function s(v,m){var h=m.entity_id.value(v),g=m.asym_id.value(v),y=m.seq_id.value(v);if(r.model_granularity.value(v)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:m.atom_id.value(v),label_entity_id:h});b>=0&&o(l,b,v)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(h,g,y);if(S>=0)o(c,S,v);else{var C=n.coarseHierarchy.gaussians.findSequenceKey(h,g,y);C>=0&&o(d,C,v)}}}function u(v){switch(v){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,a),s(p,i);return{getIndicesByElement:function(v,m){var h=u(m),g=h.get(v);return g!==void 0?g:f},data:r}}e.fromTable=t})(Ul||(Ul={}));var qwe=[];function sB(e,t,r,n){return"".concat(e,"|").concat(t.id,"|").concat(r,"|").concat(n.id)}var uB=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=sB(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=sB(t,r,n,a);return this.pairKeyIndices.get(i)||qwe},e.prototype.getPairs=function(t,r,n,a){var i=this,o=this.getPairIndices(t,r,n,a);return o.map(function(s){return i.pairs[s]})},e}(),zl=Ed.createProvider({label:"Cross Link Restraint",descriptor:xo({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!Ul.Provider.get(t)})},obtain:function(e,t,r){return se(void 0,void 0,void 0,function(){return ie(this,function(n){return[2,{value:Xwe(t)}]})})}}),qs;(function(e){(function(v){v.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(v){return v.models.some(function(m){return!!Ul.Provider.get(m)})}e.isApplicable=t;var r=w(),n=w();function a(v){return v.unitA.conformation.position(v.unitA.elements[v.indexA],r),v.unitB.conformation.position(v.unitB.elements[v.indexB],n),w.distance(r,n)}e.distance=a;function i(v,m,h){return W7("cross-link-restraints",{structure:m,crossLinkRestraints:v},h)}e.Location=i;function o(v){return!!v&&v.kind==="data-location"&&v.tag==="cross-link-restraints"}e.isLocation=o;function s(v,m){return v.data.structure===m.data.structure&&v.data.crossLinkRestraints===m.data.crossLinkRestraints&&v.element===m.element}e.areLocationsEqual=s;function u(v,m){var h=v.pairs[m];return"Cross Link Restraint | Type: ".concat(h.restraintType," | Threshold: ").concat(h.distanceThreshold," \u212B | Psi: ").concat(h.psi," | Sigma 1: ").concat(h.sigma1," | Sigma 2: ").concat(h.sigma2," | Distance: ").concat(a(h).toFixed(2)," \u212B")}function l(v){return u(v.data.crossLinkRestraints,v.element)}e.locationLabel=l;function c(v,m,h){return OS("cross-link-restraints",{structure:v,crossLinkRestraints:m},h,function(g){return f(m,h,g)},function(){return p(v,m,h)})}e.Loci=c;function d(v){return!!v&&v.kind==="data-loci"&&v.tag==="interactions"}e.isLoci=d;function f(v,m,h){return Ml.fromPairProvider(m.length,function(g,y,b){var S=v.pairs[m[g]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},h)}e.getBoundingSphere=f;function p(v,m,h){var g=h[0];if(g===void 0)return"";var y=m.pairs[g];return[u(m,g),sE(Ot.Location(v,y.unitA,y.indexA,v,y.unitB,y.indexB))].join("</br>")}e.getLabel=p})(qs||(qs={}));function lB(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,i).forEach(function(c){return e.set(c,u)})},s=0;s<a;s++)o(s)}function jwe(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=Ul.Provider.get(t.model);if(!!n){var a=new Map,i=new Map;lB(a,t,n),lB(i,r,n),a.forEach(function(o,s){var u=i.get(s);u!==void 0&&e.push(_2(t,o,r,u,n,s),_2(r,u,t,o,n,s))})}}}function Wwe(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=Ul.Provider.get(t.model);if(!!r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,i).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<a;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(_2(t,d,t,f,r,c),_2(t,f,t,d,r,c))}})}}}function _2(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function Xwe(e){var t=[];if(!e.models.some(function(s){return Ul.Provider.get(s)}))return new uB(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];Wwe(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&jwe(t,a,o)}}return new uB(t)}function Ywe(e,t,r,n,a){var i=zl.get(t).value;if(!i.count)return Rt.createEmpty(a);var o=n.sizeFactor,s=He.create(t),u={linkCount:i.count,position:function(l,c,d){var f=i.pairs[d],p=f.unitA,v=f.unitB;p.conformation.position(p.elements[f.indexA],l),v.conformation.position(v.elements[f.indexB],c)},radius:function(l){var c=i.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return Pp(e,u,n,a)}var aH=_(_(_({},zg),Tp),{sizeFactor:E.Numeric(.5,{min:0,max:10,step:.1})});function Kwe(e){return _p({defaultProps:E.getDefaultValues(aH),createGeometry:Ywe,createLocationIterator:Qwe,getLoci:Zwe,eachLocation:$we,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Qwe(e){var t=zl.get(e).value,r=t.pairs,n=r.length,a=1,i=qs.Location(t,e),o=function(s){return i.element=s,i};return sn(n,a,1,o,!0)}function Zwe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=zl.get(t).value,o=i.pairs[a];if(o)return qs.Loci(t,i,[a])}return yr}function $we(e,t,r){var n=!1;if(qs.isLoci(e)){if(!Ne.areEquivalent(e.data.structure,t))return!1;var a=zl.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++){var s=o[i];r(Ce.ofSingleton(s))&&(n=!0)}}return n}var Jwe={"cross-link-restraint":function(e,t){return Hs("Cross-link restraint",e,t,Kwe)}},iH=_({},aH);function e_e(e,t){return E.clone(iH)}function t_e(e,t){return Yt.createMulti("CrossLinkRestraint",e,t,va,Jwe)}var cB={name:qs.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:t_e,getParams:e_e,defaultValues:E.getDefaultValues(iH),defaultColorTheme:{name:qs.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return qs.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return zl.attach(e,t,void 0,!0)},detach:function(e){return zl.ref(e,!1)}}},dB=$e(13421772),r_e="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",oH={domain:E.Interval([.5,1.5],{step:.01}),list:E.ColorList("red-grey",{presetKind:"scale"})};function n_e(e){return oH}function sH(e,t){var r,n=void 0,a=e.structure&&zl.get(e.structure).value;if(a){n=Ys.create({domain:t.domain,listOrName:t.list.colors});var i=n.color;r=function(o){if(qs.isLocation(o)){var s=a.pairs[o.element];if(s)return i(qs.distance(s)/s.distanceThreshold)}return dB}}else r=function(){return dB};return{factory:sH,granularity:"group",color:r,props:t,description:r_e,legend:n?n.legend:void 0}}var fB={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:sH,getParams:n_e,defaultValues:E.getDefaultValues(oH),isApplicable:function(e){return!!e.structure&&qs.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?zl.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&zl.ref(e.structure,!1)}}},a_e=Pr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ul.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",i_e),this.ctx.representation.structure.themes.colorThemeRegistry.add(fB),this.ctx.representation.structure.registry.add(cB)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(fB),this.ctx.representation.structure.registry.remove(cB)},t}(Pr.Handler)});function i_e(e){if(!!Xr.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return Ul.fromTable(t,e)}}var o_e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",StructureInfo:Pxe,AccessibleSurfaceArea:Lxe,Interactions:Fwe,SecondaryStructure:Nwe,ValenceModel:Uwe,BestDatabaseSequenceMapping:Hwe,CrossLinkRestraint:a_e}),Yy={State:d2e,Representation:p2e,Camera:m2e,Misc:fxe},io={Representation:xxe,Camera:Txe,CustomProps:o_e};function z1(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?u_e(e,t||Ne.Empty,r):uH(e,t||Ne.Empty,r)}function s_e(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function cA(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=E.getDefaultValues(l.getParams({structure:t||Ne.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,a)}}function pB(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=E.getDefaultValues(l.getParams({structure:t||Ne.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,a)}}function u_e(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return uH(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function uH(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=E.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=E.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=E.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var l_e=function(e){var t=Ve.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:E.Numeric(5,{min:1,max:10,step:1}),targetParams:E.Group(t,{label:"Target",customDefault:z1(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:E.Group(t,{label:"Surroundings",customDefault:z1(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:E.Group(t,{label:"Non-covalent Int.",customDefault:z1(e,void 0,{type:w2,color:lA,size:pa.BuiltIn.uniform})}),components:E.MultiSelect(vB,E.arrayToOptions(vB)),excludeTargetFromSurroundings:E.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:E.Boolean(!1),ignoreLight:E.Boolean(!1),material:di.getParam(),clip:E.Group(fd.Params)}},vB=["target","surroundings","interactions"],Wr;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(Wr||(Wr={}));var c_e=new Set([Wr.TargetSel,Wr.TargetRepr,Wr.SurrSel,Wr.SurrRepr,Wr.SurrNciRepr]),d_e=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings (".concat(this.params.expandRadius," \xC5)")},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return _(_({},r),{type:{name:r.type.name,params:_(_({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=Kt.findUniqueTagsInSubtree(i,r.transform.ref,c_e);s[Wr.TargetSel]||(s[Wr.TargetSel]=o.to(r).apply(Ve.Model.StructureSelectionFromBundle,{bundle:Mr.Empty,label:"[Focus] Target"},{tags:Wr.TargetSel}).ref),s[Wr.SurrSel]||(s[Wr.SurrSel]=o.to(r).apply(Ve.Model.StructureSelectionFromExpression,{expression:ne.struct.generator.empty(),label:this.surrLabel},{tags:Wr.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[Wr.TargetRepr]&&(s[Wr.TargetRepr]=o.to(s[Wr.TargetSel]).apply(Ve.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:Wr.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[Wr.SurrRepr]&&(s[Wr.SurrRepr]=o.to(s[Wr.SurrSel]).apply(Ve.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:Wr.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[Wr.SurrNciRepr]&&r.obj&&w2.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[Wr.SurrNciRepr]=o.to(s[Wr.SurrSel]).apply(Ve.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:Wr.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(Kt.Generators.byRef(r).subtree().withTag(Wr.TargetSel)),i=n.select(Kt.Generators.byRef(r).subtree().withTag(Wr.SurrSel));if(!(a.length===0&&i.length===0)){for(var o=n.build(),s=Mr.Empty,u=0,l=a;u<l.length;u++){var c=l[u];o.to(c).update(Ve.Model.StructureSelectionFromBundle,function(m){return _(_({},m),{bundle:s})})}for(var d=ne.struct.generator.empty(),f=0,p=i;f<p.length;f++){var v=p[f];o.to(v).update(Ve.Model.StructureSelectionFromExpression,function(m){return _(_({},m),{expression:d})})}return ft.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p=this;return ie(this,function(v){switch(v.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,a=xe.remap(r,n.obj.data),i=xe.extendToWholeResidues(a),o=Mr.fromLoci(i),s=Mr.toExpression(o),u=ne.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=ne.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[Wr.TargetSel]).update(Ve.Model.StructureSelectionFromBundle,function(m){return _(_({},m),{bundle:o})}),d.to(f[Wr.SurrSel]).update(Ve.Model.StructureSelectionFromExpression,function(m){return _(_({},m),{expression:u,label:p.surrLabel})}),[4,ft.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(er.RootRef)})},t.prototype.update=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,m,d,f,m,p,v,m;return ie(this,function(h){switch(h.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(a=this.plugin.state.data,i=a.build(),o=Kt.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=a.select(o.withTag(Wr.TargetRepr));l<c.length;l++)m=c[l],u?i.to(m).update(this.getReprParams(this.params.targetParams)):i.delete(m.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=a.select(o.withTag(Wr.SurrRepr));d<f.length;d++)m=f[d],u?i.to(m).update(this.getReprParams(this.params.surroundingsParams)):i.delete(m.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,v=a.select(o.withTag(Wr.SurrNciRepr));p<v.length;p++)m=v[p],u?i.to(m).update(this.getReprParams(this.params.nciParams)):i.delete(m.transform.ref);return[4,ft.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return h.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Pr.WithSubscribers),LE=Pr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:d_e,params:function(e,t){return l_e(t)}});function hi(e){return e}(function(e){e.CommonParams={ignoreHydrogens:E.Optional(E.Boolean(!1)),ignoreLight:E.Optional(E.Boolean(!1)),quality:E.Optional(E.Select("auto",GP)),theme:E.Optional(E.Group({globalName:E.Optional(E.Text("")),carbonColor:E.Optional(E.Select("chain-id",E.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:E.Optional(E.Text("")),focus:E.Optional(E.Group({name:E.Optional(E.Text("")),params:E.Optional(E.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:I9.defaultValues}:i==="operator-name"?{name:i,params:eE.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(i,o,s){var u,l,c,d,f,p,v=i.state.data.build(),m=i.builders.structure.representation,h={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!i.managers.structure.component.state.options.showHydrogens,ignoreLight:i.managers.structure.component.state.options.ignoreLight};o.quality&&o.quality!=="auto"&&(h.quality=o.quality),o.ignoreHydrogens!==void 0&&(h.ignoreHydrogens=!!o.ignoreHydrogens),o.ignoreLight!==void 0&&(h.ignoreLight=!!o.ignoreLight);var g=((u=o.theme)===null||u===void 0?void 0:u.globalName)?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&((f=o.theme)===null||f===void 0?void 0:f.symmetryColor)&&r(s)?(p=o.theme)===null||p===void 0?void 0:p.symmetryColor:g;return{update:v,builder:m,color:g,symmetryColor:b,typeParams:h,ballAndStickColor:y}}e.reprBuilder=n;function a(i,o,s,u){return i.state.updateBehavior(LE,function(l){var c=cA(i,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=a})(hi||(hi={}));var Ep=hi.CommonParams,Hm=hi.reprBuilder,Gm=hi.updateFocusRepr,f_e=hi({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return Ep},apply:function(e,t,r){var n,a,i=(a=(n=Zn.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return{};var o=r.config.get(Lr.Structure.SizeThresholds)||Ne.DefaultSizeThresholds,s=Ne.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case Ne.Size.Gigantic:case Ne.Size.Huge:return cH.apply(e,t,r);case Ne.Size.Large:return dH.apply(e,t,r);case Ne.Size.Medium:if(u>3)return lH.apply(e,t,r);case Ne.Size.Small:return fH.apply(e,_(_({},t),{showCarbohydrateSymbol:!0}),r);default:Zf()}}}),p_e=hi({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return se(this,void 0,void 0,function(){return ie(this,function(n){return[2,{}]})})}}),Vg="Basic",lH=hi({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:Vg,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return Ep},apply:function(e,t,r){var n,a,i,o,s,u,l,c,d,f;return se(this,void 0,void 0,function(){var p,v,m,h,g,y,b,S,C,x,A,P,T,D,I;return ie(this,function(M){switch(M.label){case 0:return p=Zn.resolveAndCheck(r.state.data,e),p?(I={},[4,qi(r,p,"polymer")]):[2,{}];case 1:return I.polymer=M.sent(),[4,qi(r,p,"ligand")];case 2:return I.ligand=M.sent(),[4,qi(r,p,"non-standard")];case 3:return I.nonStandard=M.sent(),[4,qi(r,p,"branched",{label:"Carbohydrate"})];case 4:return I.branched=M.sent(),[4,qi(r,p,"water")];case 5:return I.water=M.sent(),[4,qi(r,p,"ion")];case 6:return I.ion=M.sent(),[4,qi(r,p,"lipid")];case 7:return I.lipid=M.sent(),[4,qi(r,p,"coarse")];case 8:return v=(I.coarse=M.sent(),I),m=p.obj.data,h={sizeFactor:m.isCoarseGrained?.8:.2},g=(((i=(a=(n=v.water)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=v.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Hm(r,t,m),S=b.update,C=b.builder,x=b.typeParams,A=b.color,P=b.symmetryColor,T=b.ballAndStickColor,D={polymer:C.buildRepresentation(S,v.polymer,{type:"cartoon",typeParams:_(_({},x),h),color:P},{tag:"polymer"}),ligand:C.buildRepresentation(S,v.ligand,{type:"ball-and-stick",typeParams:x,color:A,colorParams:T},{tag:"ligand"}),nonStandard:C.buildRepresentation(S,v.nonStandard,{type:"ball-and-stick",typeParams:x,color:A,colorParams:T},{tag:"non-standard"}),branchedBallAndStick:C.buildRepresentation(S,v.branched,{type:"ball-and-stick",typeParams:_(_({},x),{alpha:.3}),color:A,colorParams:T},{tag:"branched-ball-and-stick"}),branchedSnfg3d:C.buildRepresentation(S,v.branched,{type:"carbohydrate",typeParams:x,color:A},{tag:"branched-snfg-3d"}),water:C.buildRepresentation(S,v.water,{type:g,typeParams:_(_({},x),{alpha:.6}),color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:C.buildRepresentation(S,v.ion,{type:"ball-and-stick",typeParams:x,color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:C.buildRepresentation(S,v.lipid,{type:y,typeParams:_(_({},x),{alpha:.6}),color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:C.buildRepresentation(S,v.coarse,{type:"spacefill",typeParams:x,color:A||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return M.sent(),[4,Gm(r,m,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return M.sent(),[2,{components:v,representations:D}]}})})}}),v_e=hi({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:Vg,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return Ep},apply:function(e,t,r){var n,a,i,o;return se(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return s=Zn.resolveAndCheck(r.state.data,e),s?(y={},[4,mB(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,mB(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=Hm(r,t,l),p=f.update,v=f.builder,m=f.typeParams,h=f.symmetryColor,g={protein:v.buildRepresentation(p,u.protein,{type:"cartoon",typeParams:_(_({},m),c),color:h},{tag:"protein"}),nucleic:v.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:_(_({},m),d),color:h},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,Gm(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),cH=hi({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:Vg,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return Ep},apply:function(e,t,r){var n,a,i,o;return se(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return s=Zn.resolveAndCheck(r.state.data,e),s?(y={},[4,qi(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,qi(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=Ne.getSize(l),d=Object.create(null),c===Ne.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===Ne.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Hm(r,t,l),p=f.update,v=f.builder,m=f.typeParams,h=f.symmetryColor,g={polymer:v.buildRepresentation(p,u.polymer,{type:"gaussian-surface",typeParams:_(_({},m),d),color:h},{tag:"polymer"}),lipid:v.buildRepresentation(p,u.lipid,{type:"gaussian-surface",typeParams:_(_({},m),d),color:h},{tag:"lipid"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,Gm(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),dH=hi({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:Vg,description:"Shows polymers as Cartoon."},params:function(){return Ep},apply:function(e,t,r){var n,a,i,o;return se(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,m,h,g;return ie(this,function(y){switch(y.label){case 0:return s=Zn.resolveAndCheck(r.state.data,e),s?(g={},[4,qi(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=Hm(r,t,l),f=d.update,p=d.builder,v=d.typeParams,m=d.symmetryColor,h={polymer:p.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:_(_({},v),c),color:m},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,Gm(r,l,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:h}]}})})}}),fH=hi({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:Vg,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return _(_({},Ep),{showCarbohydrateSymbol:E.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s,u;return se(this,void 0,void 0,function(){var l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U;return ie(this,function(V){switch(V.label){case 0:return l=Zn.resolveAndCheck(r.state.data,e),l?(B={},[4,qi(r,l,"all")]):[2,{}];case 1:return c=(B.all=V.sent(),B.branched=void 0,B),d=l.obj.data,f=d.elementCount>1e5,p=d.atomicResidueCount&&d.elementCount>1e3&&d.atomicResidueCount/d.elementCount<3,v=d.models[0],m=!!Ka.Provider.get(v)||Du.isExhaustive(v),h="ball-and-stick",d.isCoarseGrained?h=d.elementCount>1e6?"point":"spacefill":p&&!m?h="spacefill":f&&(h="line"),g=t.showCarbohydrateSymbol&&!f&&!p,g?(b=(y=Object).assign,S=[c],U={},[4,qi(r,l,"branched",{label:"Carbohydrate"})]):[3,3];case 2:b.apply(y,S.concat([(U.branched=V.sent(),U)])),V.label=3;case 3:return C=Hm(r,t,d),x=C.update,A=C.builder,P=C.typeParams,T=C.color,D=C.ballAndStickColor,I=p&&!m?{carbonColor:{name:"element-symbol",params:{}}}:D,M={all:A.buildRepresentation(x,c.all,{type:h,typeParams:P,color:T,colorParams:I},{tag:"all"})},g&&Object.assign(M,{snfg3d:A.buildRepresentation(x,c.branched,{type:"carbohydrate",typeParams:_(_({},P),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:T},{tag:"snfg-3d"})}),[4,x.commit({revertOnError:!0})];case 4:return V.sent(),[4,Gm(r,d,(i=(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name)!==null&&i!==void 0?i:T,(u=(s=(o=t.theme)===null||o===void 0?void 0:o.focus)===null||s===void 0?void 0:s.params)!==null&&u!==void 0?u:I)];case 5:return V.sent(),[2,{components:c,representations:M}]}})})}}),m_e=hi({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:function(){return _(_({},Ep),{showCarbohydrateSymbol:E.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s;return se(this,void 0,void 0,function(){var u,l,c,d,f,p,v,m,h,g;return ie(this,function(y){switch(y.label){case 0:return u=Zn.resolveAndCheck(r.state.data,e),u?(g={},[4,qi(r,u,"all")]):[2,{}];case 1:return l=(g.all=y.sent(),g.branched=void 0,g),c=u.obj.data,d=Hm(r,t,c),f=d.update,p=d.builder,v=d.typeParams,m=d.color,h={all:p.buildRepresentation(f,l.all,{type:"spacefill",typeParams:_(_({},v),{ignoreLight:!0}),color:"illustrative"},{tag:"all"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,Gm(r,c,(i=(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name)!==null&&i!==void 0?i:m,(s=(o=t.theme)===null||o===void 0?void 0:o.focus)===null||s===void 0?void 0:s.params)];case 3:return y.sent(),[2,{components:l,representations:h}]}})})}});function qi(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function mB(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Hn[r],"selection-".concat(r),n)}var es={empty:p_e,auto:f_e,"atomic-detail":fH,"polymer-cartoon":dH,"polymer-and-ligand":lH,"protein-and-nucleic":v_e,"coarse-surface":cH,illustrative:m_e};function FE(e,t){if(e.ext==="bcif")try{if(w7(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var lc="Trajectory";function cc(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var h_e={label:"mmCIF",description:"mmCIF",category:lc,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?FE(e,t)===-1:!1},parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(Ve.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(Ve.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:cc},g_e={label:"cifCore",description:"CIF Core",category:lc,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?FE(e,t)==="coreCif":!1},parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(Ve.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(Ve.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:cc};function Ip(e,t){var r=this;return function(n,a,i){return se(r,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(a).apply(e,t,{tags:i==null?void 0:i.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var y_e={label:"PDB",description:"PDB",category:lc,stringExtensions:["pdb","ent"],parse:Ip(Ve.Model.TrajectoryFromPDB),visuals:cc},b_e={label:"PDBQT",description:"PDBQT",category:lc,stringExtensions:["pdbqt"],parse:Ip(Ve.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:cc},S_e={label:"XYZ",description:"XYZ",category:lc,stringExtensions:["xyz"],parse:Ip(Ve.Model.TrajectoryFromXYZ),visuals:cc},x_e={label:"GRO",description:"GRO",category:lc,stringExtensions:["gro"],binaryExtensions:[],parse:Ip(Ve.Model.TrajectoryFromGRO),visuals:cc},C_e={label:"MOL",description:"MOL",category:lc,stringExtensions:["mol"],parse:Ip(Ve.Model.TrajectoryFromMOL),visuals:cc},w_e={label:"SDF",description:"SDF",category:lc,stringExtensions:["sdf","sd"],parse:Ip(Ve.Model.TrajectoryFromSDF),visuals:cc},__e={label:"MOL2",description:"MOL2",category:lc,stringExtensions:["mol2"],parse:Ip(Ve.Model.TrajectoryFromMOL2),visuals:cc},pH=[["mmcif",h_e],["cifCore",g_e],["pdb",y_e],["pdbqt",b_e],["gro",x_e],["xyz",S_e],["mol",C_e],["sdf",w_e],["mol2",__e]],A_e=["gz","zip"],T_e=["bcif","ccp4","dcd"];function cx(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var a=t.lastIndexOf("?"),i=a!==-1?t.substring(a):"";t=t.substring(0,a===-1?t.length:a);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(A_e.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var p=s.length-l.length-1;s=s.substr(0,p)}else r=!1;var v=T_e.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:v,protocol:n,query:i,src:e}}var P_e=function(e){var t=e.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id;return E.Group({type:Ff.getParams(void 0,"auto").type,representation:E.Select(t,e.builders.structure.representation.getPresets().map(function(r){return[r.id,r.display.name,r.display.group]}),{description:"Which representation preset to use."}),representationParams:E.Group(hi.CommonParams,{isHidden:!0}),asTrajectory:E.Optional(E.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},vH={rcsb:E.Group({encoding:E.Select("bcif",E.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:E.Group({variant:E.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:E.EmptyGroup({label:"PDBj"})},E_e=Ji.build({from:fe.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=P_e(t),n=t.config.get(Lr.Download.DefaultPdbProvider)||"pdbe";return{source:E.MappedStatic("pdb",{pdb:E.Group({provider:E.Group({id:E.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:E.MappedStatic(n,vH)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":E.Group({provider:E.Group({id:E.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:E.Select("bcif",E.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:E.Group({id:E.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:E.Group({id:E.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:E.Group({id:E.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:E.Group({id:E.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:E.Group({url:E.Url(""),format:E.Select("mmcif",E.arrayToOptions(pH.map(function(a){return a[0]}),function(a){return a})),isBinary:E.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return Fe.create("Download Structure",function(a){return se(void 0,void 0,void 0,function(){var i,o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),i=r.source,s=!1,u="mmcif",l=i.name,l){case"url":return[3,1];case"pdb":return[3,2];case"pdb-dev":return[3,4];case"swissmodel":return[3,6];case"alphafolddb":return[3,8];case"modelarchive":return[3,10];case"pubchem":return[3,12]}return[3,14];case 1:return o=[{url:i.params.url,isBinary:i.params.isBinary}],u=i.params.format,[3,15];case 2:return[4,i.params.provider.server.name==="pdbe"?I_e(i):i.params.provider.server.name==="pdbj"?D_e(i):i.params.provider.server.name==="rcsb"?M_e(i):Zf()];case 3:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 4:return[4,Rs(i.params.provider.id,function(v){var m=v.toUpperCase().startsWith("PDBDEV_")?v:"PDBDEV_".concat(v.padStart(8,"0"));return i.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/".concat(m.toUpperCase(),".bcif"):"https://pdb-dev.wwpdb.org/cif/".concat(m.toUpperCase(),".cif")},function(v){return v.toUpperCase().startsWith("PDBDEV_")?v:"PDBDEV_".concat(v.padStart(8,"0"))},i.params.provider.encoding==="bcif")];case 5:return o=p.sent(),s=!!i.params.options.asTrajectory,[3,15];case 6:return[4,Rs(i.params.id,function(v){return"https://swissmodel.expasy.org/repository/uniprot/".concat(v.toUpperCase(),".pdb")},function(v){return"SWISS-MODEL: ".concat(v)},!1)];case 7:return o=p.sent(),s=!!i.params.options.asTrajectory,u="pdb",[3,15];case 8:return[4,Rs(i.params.id,function(v){return se(void 0,void 0,void 0,function(){var m,h;return ie(this,function(g){switch(g.label){case 0:return m="https://www.alphafold.ebi.ac.uk/api/prediction/".concat(v.toUpperCase()),[4,t.runTask(t.fetch({url:m,type:"json"}))];case 1:if(h=g.sent(),Array.isArray(h)&&h.length>0)return[2,h[0].cifUrl];throw new Error("No AlphaFold DB entry for '".concat(v,"'"))}})})},function(v){return"AlphaFold DB: ".concat(v)},!1)];case 9:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 10:return[4,Rs(i.params.id,function(v){return"https://www.modelarchive.org/doi/10.5452/".concat(v.toLowerCase(),".cif")},function(v){return"Model Archive: ".concat(v)},!1)];case 11:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 12:return[4,Rs(i.params.id,function(v){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/".concat(v.trim(),"/record/SDF/?record_type=3d")},function(v){return"PubChem: ".concat(v)},!1)];case 13:return o=p.sent(),s=!!i.params.options.asTrajectory,u="mol",[3,15];case 14:throw new Error("".concat(i.name," not supported."));case 15:return c=r.source.params.options.representation||t.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,d=c!==es.empty.id,f=i.params.options.type.name==="auto"?void 0:i.params.options.type,[4,n.transaction(function(){return se(void 0,void 0,void 0,function(){var v,S,m,h,g,y,b,S,C;return ie(this,function(x){switch(x.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(A,P){return{id:""+P,url:A.url,isBinary:A.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return v=x.sent(),[4,t.builders.structure.parseTrajectory(v,{formats:o.map(function(A,P){return{id:""+P,format:"cif"}})})];case 2:return S=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(S,"default",{structure:f,showUnitcell:d,representationPreset:c,representationPresetParams:r.source.params.options.representationParams})];case 3:return x.sent(),[3,10];case 4:m=0,h=o,x.label=5;case 5:return m<h.length?(g=h[m],[4,t.builders.data.download(g,{state:{isGhost:!0}})]):[3,10];case 6:if(y=x.sent(),b=u==="auto"?t.dataFormats.auto(cx(Kr.getUrl(g.url)),(C=y.cell)===null||C===void 0?void 0:C.obj):t.dataFormats.get(u),!b)throw new Error("unknown file format");return[4,t.builders.structure.parseTrajectory(y,b)];case 7:return S=x.sent(),[4,t.builders.structure.hierarchy.applyPreset(S,"default",{structure:f,showUnitcell:d,representationPreset:c,representationPresetParams:r.source.params.options.representationParams})];case 8:x.sent(),x.label=9;case 9:return m++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 16:return p.sent(),[2]}})})})});function Rs(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:a=e.split(/[,\s]/).map(function(m){return m.trim()}).filter(function(m){return!!m&&(m.length>=4||/^[1-9][0-9]*$/.test(m))}),i=[],o=0,s=a,v.label=1;case 1:return o<s.length?(u=s[o],c=(l=i).push,p={},f=(d=Kr).Url,[4,t(u)]):[3,4];case 2:c.apply(l,[(p.url=f.apply(d,[v.sent()]),p.isBinary=n,p.label=r(u),p)]),v.label=3;case 3:return o++,[3,1];case 4:return[2,i]}})})}function I_e(e){return se(this,void 0,void 0,function(){return ie(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbe")throw new Error("expected pdbe");return[2,e.params.provider.server.params.variant==="updated"?Rs(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),"_updated.cif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!1):e.params.provider.server.params.variant==="updated-bcif"?Rs(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/entry-files/download/".concat(r.toLowerCase(),".bcif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!0):Rs(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),".cif")},function(r){return"PDBe: ".concat(r," (cif)")},!1)]})})}function D_e(e){return se(this,void 0,void 0,function(){return ie(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbj")throw new Error("expected pdbj");return[2,Rs(e.params.provider.id,function(r){return"https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/".concat(r.toLowerCase().substring(1,3),"/").concat(r.toLowerCase(),".cif")},function(r){return"PDBj: ".concat(r," (cif)")},!1)]})})}function M_e(e){return se(this,void 0,void 0,function(){return ie(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="rcsb")throw new Error("expected rcsb");return[2,e.params.provider.server.params.encoding==="cif"?Rs(e.params.provider.id,function(r){return"https://files.rcsb.org/download/".concat(r.toUpperCase(),".cif")},function(r){return"RCSB PDB: ".concat(r," (cif)")},!1):Rs(e.params.provider.id,function(r){return"https://models.rcsb.org/".concat(r.toUpperCase(),".bcif")},function(r){return"RCSB PDB: ".concat(r," (bcif)")},!0)]})})}var V1=Ji.build({display:{name:"Update Trajectory"},params:{action:E.Select("advance",E.arrayToOptions(["advance","reset"])),by:E.Optional(E.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(Ve.Model.ModelFromTrajectory)}),a=r.build();if(t.action==="reset")for(var i=0,o=n;i<o.length;i++){var s=o[i];a.to(s).update({modelIndex:0})}else for(var u=function(d){var f=Kt.findAncestorOfType(r.tree,r.cells,d.transform.ref,fe.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;a.to(d).update(function(v){var m=(v.modelIndex+t.by)%p.data.frameCount;return m<0&&(m+=p.data.frameCount),{modelIndex:m}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(a)}),R_e=Ji.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:fe.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==Hz}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),O_e=Ji.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:fe.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==Gz}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),B_e=Ji.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:fe.Root,params:function(e,t){var r=t.state.data,n=It(It([],r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Model)}),!0),r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Topology)}),!0),a=n.map(function(s){return[s.transform.ref,s.obj.label]}),i=r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Coordinates)}),o=i.map(function(s){return[s.transform.ref,s.obj.label]});return{model:E.Select(a.length?a[0][0]:"",a),coordinates:E.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return Fe.create("Add Trajectory",function(a){return n.transaction(function(){return se(void 0,void 0,void 0,function(){var i,o,s;return ie(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(zz,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(Ve.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),k_e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",PdbDownloadProvider:vH,DownloadStructure:E_e,UpdateTrajectory:V1,EnableModelCustomProps:R_e,EnableStructureCustomProps:O_e,AddTrajectory:B_e}),L_e=Ji.build({from:fe.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:E.MappedStatic("pdb-xray",{"pdb-xray":E.Group({provider:E.Group({id:E.Text("1tqn",{label:"Id"}),server:E.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:E.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":E.Group({provider:E.Group({id:E.Text("1tqn",{label:"Id"}),server:E.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:E.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":E.Group({provider:E.Group({id:E.Text("emd-8004",{label:"Id"}),server:E.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:E.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:E.Group({url:E.Url(""),isBinary:E.Boolean(!1),format:E.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return Fe.create("Download Density",function(n){return se(void 0,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:switch(a=r.source,a.name){case"url":i=a.params;break;case"pdb-xray":i=a.params.provider.server==="pdbe"?{url:Kr.Url(a.params.type==="2fofc"?"https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),".ccp4"):"https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),"_diff.ccp4")),isBinary:!0,label:"PDBe X-ray map: ".concat(a.params.provider.id)}:{url:Kr.Url(a.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"_2fofc.dsn6"):"https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"_fofc.dsn6")),isBinary:!0,label:"RCSB X-ray map: ".concat(a.params.provider.id)};break;case"pdb-emd-ds":i=a.params.provider.server==="pdbe"?{url:Kr.Url("https://www.ebi.ac.uk/pdbe/densities/emd/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe EMD Density Server: ".concat(a.params.provider.id)}:{url:Kr.Url("https://maps.rcsb.org/em/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB EMD Density Server: ".concat(a.params.provider.id)};break;case"pdb-xray-ds":i=a.params.provider.server==="pdbe"?{url:Kr.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe X-ray Density Server: ".concat(a.params.provider.id)}:{url:Kr.Url("https://maps.rcsb.org/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB X-ray Density Server: ".concat(a.params.provider.id)};break;default:throw new Error("".concat(a.name," not supported."))}return[4,t.builders.data.download(i)];case 1:switch(s=f.sent(),u=void 0,a.name){case"url":i=a.params,o=a.params.format==="auto"?t.dataFormats.auto(cx(Kr.getUrl(i.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=a.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error("".concat(a.name," not supported."))}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),mH=Ji.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(Kt.Generators.root.subtree().ofType(fe.Volume.Data).filter(function(n){var a;return!!n.obj&&!((a=n.obj)===null||a===void 0?void 0:a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:E.Text("",{isHidden:!0,label:"Volume"})}:{ref:E.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(Ve.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()}),F_e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DownloadDensity:L_e,AssignColorVolume:mH}),NE=Ji.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:fe.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,a=r.options;return{files:E.FileList({accept:Array.from(n.values()).map(function(i){return".".concat(i)}).join(",")+",.gz,.zip",multiple:!0}),format:E.MappedStatic("auto",{auto:E.EmptyGroup(),specific:E.Select(a[0][0],a)}),visuals:E.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Fe.create("Open Files",function(a){return se(void 0,void 0,void 0,function(){return ie(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return se(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){switch(S.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=function(C){return se(void 0,void 0,void 0,function(){var x,A,P,T,D,I,M;return ie(this,function(B){switch(B.label){case 0:return x=cx(C.file),A=t.dataFormats.binaryExtensions.has(x.ext),[4,t.builders.data.readFile({file:C,isBinary:A})];case 1:return P=B.sent().data,T=r.format.name==="auto"?t.dataFormats.auto(x,(I=P.cell)===null||I===void 0?void 0:I.obj):t.dataFormats.get(r.format.params),T?[4,T.parse(t,P)]:(t.log.warn("OpenFiles: could not find data provider for '".concat(x.name,".").concat(x.ext,"'")),[2]);case 2:return D=B.sent(),r.visuals?[4,(M=T.visuals)===null||M===void 0?void 0:M.call(T,t,D)]:[3,4];case 3:B.sent(),B.label=4;case 4:return[2]}})})},s=0,u=r.files,S.label=1;case 1:if(!(s<u.length))return[3,14];l=u[s],S.label=2;case 2:return S.trys.push([2,12,,13]),l.file&&l.name.toLowerCase().endsWith(".zip")?(d=oP,f=[a],[4,l.file.arrayBuffer()]):[3,9];case 3:return[4,d.apply(void 0,f.concat([S.sent()]))];case 4:c=S.sent(),p=0,v=Object.entries(c),S.label=5;case 5:return p<v.length?(m=v[p],h=m[0],g=m[1],y=Kr.File(new File([g],h)),[4,o(y)]):[3,8];case 6:S.sent(),S.label=7;case 7:return p++,[3,5];case 8:return[3,11];case 9:return[4,o(l)];case 10:S.sent(),S.label=11;case 11:return[3,13];case 12:return b=S.sent(),console.error(b),t.log.error("Error opening file '".concat(l.name,"'")),[3,13];case 13:return s++,[3,1];case 14:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),N_e=Ji.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:fe.Root,params:function(e,t){var r=t.dataFormats.options;return{url:E.Url(""),format:E.Select(r[0][0],r),isBinary:E.Boolean(!1),visuals:E.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Fe.create("Open Files",function(a){return se(void 0,void 0,void 0,function(){return ie(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return se(void 0,void 0,void 0,function(){var o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '".concat(r.format,"'")),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),console.error(l),t.log.error("Error downloading '".concat(typeof r.url=="string"?r.url:r.url.url,"'")),[3,6];case 6:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),U_e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",OpenFiles:NE,DownloadFile:N_e}),$d={Structure:k_e,Volume:F_e,DataFormat:U_e},z_e=Fl.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:E.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x;return ie(this,function(A){switch(A.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===i&&o++,o=o%n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),p=0,v=l;p<v.length;p++)for(m=v[p],h=0,g=c;h<g.length;h++)y=g[h],y.ref===m.ref&&y.version!==m.version&&(b=er.fromJSON(m),S=er.fromJSON(y),C=d.cells.get(m.ref),!!C&&(x=void 0,b.transformer.definition.interpolate?x=b.transformer.definition.interpolate(b.params,S.params,a,r.plugin):x=a<=.5?b.params:S.params,U0(C,x)||f.to(m.ref).update(x)));return[4,ft.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return A.sent(),[2,{kind:"next",state:{}}]}})})}}),V_e=Fl.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:E.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return ie(this,function(d){for(n=r.state.data,a=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)l=u[s],c=n.select(Kt.Generators.ofTransformer(Ve.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,i.to(l.transform.ref).apply(Ve.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){var n;return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:if(a=r.plugin.state.data,i=a.select(Kt.Generators.ofTransformer(Ve.Representation.SpinStructureRepresentation3D)),i.length===0)return[2,{kind:"finished"}];for(o=a.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=i;l<c.length;l++)d=c[l],o.to(d).update(_(_({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,ft.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),Ky=w(),hB=w(),gB=$r(),H_e=Fl.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:E.Numeric(4e3,{min:100,max:2e4,step:100}),speed:E.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:E.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}},initialState:function(e,t){return{snapshot:t.canvas3d.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return se(this,void 0,void 0,function(){var i,o,s,u;return ie(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):Ha(t.current/r.params.durationInMs,0,1),s=Math.sin(o*r.params.speed*Math.PI*2)*wr(r.params.angle),w.sub(Ky,i.position,i.target),w.normalize(hB,i.up),$r.setAxisAngle(gB,hB,s),w.transformQuat(Ky,Ky,gB),u=w.add(w(),i.target,Ky),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:_(_({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}]))})})}}),Gt;(function(e){function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}}e.Action=t;function r(n,a){return a===void 0&&(a={}),{transformer:n,defaultParams:a}}e.Behavior=r})(Gt||(Gt={}));var G_e=function(){return{actions:[Gt.Action($d.Structure.DownloadStructure),Gt.Action($d.Structure.AddTrajectory),Gt.Action($d.Volume.DownloadDensity),Gt.Action($d.DataFormat.DownloadFile),Gt.Action($d.DataFormat.OpenFiles),Gt.Action($d.Structure.EnableModelCustomProps),Gt.Action($d.Structure.EnableStructureCustomProps),Gt.Action(E4),Gt.Action(A0e),Gt.Action(xE),Gt.Action(Ve.Data.Download),Gt.Action(Ve.Data.ParseCif),Gt.Action(Ve.Data.ParseCcp4),Gt.Action(Ve.Data.ParseDsn6),Gt.Action(Ve.Model.TrajectoryFromMmCif),Gt.Action(Ve.Model.TrajectoryFromCifCore),Gt.Action(Ve.Model.TrajectoryFromPDB),Gt.Action(Ve.Model.TransformStructureConformation),Gt.Action(Ve.Model.StructureFromModel),Gt.Action(Ve.Model.StructureFromTrajectory),Gt.Action(Ve.Model.ModelFromTrajectory),Gt.Action(Ve.Model.StructureSelectionFromScript),Gt.Action(Ve.Representation.StructureRepresentation3D),Gt.Action(Ve.Representation.StructureSelectionsDistance3D),Gt.Action(Ve.Representation.StructureSelectionsAngle3D),Gt.Action(Ve.Representation.StructureSelectionsDihedral3D),Gt.Action(Ve.Representation.StructureSelectionsLabel3D),Gt.Action(Ve.Representation.StructureSelectionsOrientation3D),Gt.Action(Ve.Representation.ModelUnitcell3D),Gt.Action(Ve.Representation.StructureBoundingBox3D),Gt.Action(Ve.Representation.ExplodeStructureRepresentation3D),Gt.Action(Ve.Representation.SpinStructureRepresentation3D),Gt.Action(Ve.Representation.UnwindStructureAssemblyRepresentation3D),Gt.Action(Ve.Representation.OverpaintStructureRepresentation3DFromScript),Gt.Action(Ve.Representation.TransparencyStructureRepresentation3DFromScript),Gt.Action(Ve.Representation.ClippingStructureRepresentation3DFromScript),Gt.Action(Ve.Representation.SubstanceStructureRepresentation3DFromScript),Gt.Action(mH),Gt.Action(Ve.Volume.VolumeFromCcp4),Gt.Action(Ve.Volume.VolumeFromDsn6),Gt.Action(Ve.Volume.VolumeFromCube),Gt.Action(Ve.Volume.VolumeFromDx),Gt.Action(Ve.Representation.VolumeRepresentation3D)],behaviors:[Gt.Behavior(io.Representation.HighlightLoci),Gt.Behavior(io.Representation.SelectLoci),Gt.Behavior(io.Representation.DefaultLociLabelProvider),Gt.Behavior(io.Representation.FocusLoci),Gt.Behavior(io.Camera.FocusLoci),Gt.Behavior(io.Camera.CameraAxisHelper),Gt.Behavior(LE),Gt.Behavior(io.CustomProps.StructureInfo),Gt.Behavior(io.CustomProps.AccessibleSurfaceArea),Gt.Behavior(io.CustomProps.BestDatabaseSequenceMapping),Gt.Behavior(io.CustomProps.Interactions),Gt.Behavior(io.CustomProps.SecondaryStructure),Gt.Behavior(io.CustomProps.ValenceModel),Gt.Behavior(io.CustomProps.CrossLinkRestraint)],animations:[a2e,n2e,H_e,i2e,r2e,V_e,z_e]}},dx={exports:{}},Hg={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q_e=Tt.exports,hH=60103;Hg.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var yB=Symbol.for;hH=yB("react.element"),Hg.Fragment=yB("react.fragment")}var j_e=q_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,W_e=Object.prototype.hasOwnProperty,X_e={key:!0,ref:!0,__self:!0,__source:!0};function gH(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)W_e.call(t,n)&&!X_e.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:hH,type:e,key:i,ref:o,props:a,_owner:j_e.current}}Hg.jsx=gH;Hg.jsxs=gH;dx.exports=Hg;const k=dx.exports.jsx,be=dx.exports.jsxs,At=dx.exports.Fragment;function Fr(e){return e.svg?k("span",_({className:"msp-icon msp-material-icon".concat(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:k(e.svg,{},void 0)}),void 0):null}var fx=k("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),px=k("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),Y_e=be("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[be("defs",{children:[fx,px]},void 0),be("g",{children:[k("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),k("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),k("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function dA(){return Y_e}var K_e=be("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[be("defs",{children:[fx,px,be("mask",_({id:"mask-left"},{children:[k("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),k("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),be("g",{children:[k("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),k("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function fA(){return K_e}var Q_e=be("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[be("defs",{children:[fx,px,k("clipPath",_({id:"clip-left"},{children:k("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),be("g",{children:[k("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),k("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),k("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function pA(){return Q_e}var Z_e=be("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[be("defs",{children:[fx,px]},void 0),be("g",{children:[k("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),k("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function A2(){return Z_e}var $_e=k("svg",_({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:k("g",{children:k("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function J_e(){return $_e}var e4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function vA(){return e4e}k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var t4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function r4e(){return t4e}k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var n4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function a4e(){return n4e}var i4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"},void 0)}),void 0);function o4e(){return i4e}var s4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function yH(){return s4e}var u4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function qm(){return u4e}var l4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function vx(){return l4e}var c4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Vl(){return c4e}var d4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function Hl(){return d4e}var f4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function mx(){return f4e}var p4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function v4e(){return p4e}var m4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function bH(){return m4e}var h4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function pm(){return h4e}var g4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function mA(){return g4e}var y4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function b4e(){return y4e}var S4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function x4e(){return S4e}var C4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function w4e(){return C4e}var _4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function A4e(){return _4e}var T4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function UE(){return T4e}var P4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function SH(){return P4e}var E4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function I4e(){return E4e}var D4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function jm(){return D4e}var M4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function xH(){return M4e}var R4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function ml(){return R4e}var O4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function B4e(){return O4e}var k4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function L4e(){return k4e}var F4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function N4e(){return F4e}var U4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function z4e(){return U4e}var V4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function H4e(){return V4e}var G4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function q4e(){return G4e}var j4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function gs(){return j4e}k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var W4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function bB(){return W4e}k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var X4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function Y4e(){return X4e}var K4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function Q4e(){return K4e}var Z4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function hA(){return Z4e}var $4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function ku(){return $4e}var J4e=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function gA(){return J4e}k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var eAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function tAe(){return eAe}var rAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function np(){return rAe}var nAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function CH(){return nAe}var aAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function wH(){return aAe}var iAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function oAe(){return iAe}var sAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function _H(){return sAe}var uAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function yA(){return uAe}var lAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function bA(){return lAe}var cAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function SA(){return cAe}var dAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:k("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function AH(){return dAe}var fAe=be("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[k("circle",{cx:"7",cy:"14",r:"3"},void 0),k("circle",{cx:"11",cy:"6",r:"3"},void 0),k("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function pAe(){return fAe}var vAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function mAe(){return vAe}var hAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function TH(){return hAe}var gAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function yAe(){return gAe}var bAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function SAe(){return bAe}var xAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function ap(){return xAe}var CAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function Dp(){return CAe}var wAe=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function Mp(){return wAe}var _Ae=k("svg",_({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:k("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function AAe(){return _Ae}var TAe=r4e,PAe=pAe,SB=tAe,EAe=Y4e,hl=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),be("div",_({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[k("div",_({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:be(nr,_({onClick:this.headerClicked},{children:[!this.props.hideExpander&&k(Fr,{svg:this.state.isExpanded?Hl:Vl},void 0),this.props.topRightIcon&&k(Fr,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),k("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&k("div",_({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(Tt.exports.Component);function xB(e){return e}var wl=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=Tt.exports.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var a=n.target.value,i=r.props.isValid&&!r.props.isValid(a)||r.props.numeric&&Number.isNaN(+a);if(i){r.clearTimeout(),r.setState({value:a});return}if(r.props.numeric)r.setState({value:a},function(){return r.triggerChanged(a,+a)});else{var o=(r.props.toValue||xB)(a),s=(r.props.fromValue||xB)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle!="undefined"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var a=r.fromValue?r.fromValue(r.value):r.value;return a===n.originalValue?null:{originalValue:a,value:a}},t.prototype.render=function(){return k("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(Tt.exports.PureComponent),IAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.pivot,i=r.controls;return be(At,{children:[k(ps,_({label:be(At,{children:[n,k("button",_({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:"".concat(this.state.isExpanded?"Less":"More"," options"),style:{background:"transparent",textAlign:"left",padding:"0"}},{children:k(Fr,{svg:this.state.isExpanded?bA:qm,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:a},{children:this.props.colorStripe&&k("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:$e.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:i}),void 0)]},void 0)},t}(Tt.exports.Component);function gl(e){return be("div",_({className:"msp-section-header".concat(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&k(Fr,{svg:e.icon},void 0),e.title," ",k("small",{children:e.desc},void 0)]}),void 0)}function nr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 ".concat(e.flex,"px"),padding:0,maxWidth:"".concat(e.flex,"px")}:typeof e.flex=="string"&&(r={flex:"0 0 ".concat(e.flex),padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),be("button",_({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&k(Fr,{svg:e.icon},void 0),e.children]}),void 0)}function Nt(e){var t="msp-btn msp-btn-icon".concat(e.small?"-small":"").concat(e.className?" "+e.className:"");typeof e.toggleState!="undefined"&&(t+=" msp-btn-link-toggle-".concat(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 ".concat(e.flex,"px"),padding:0,maxWidth:"".concat(e.flex,"px")}:r={flex:"0 0 ".concat(e.flex),padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),be("button",_({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&k(Fr,{svg:e.svg},void 0),e.extraContent]}),void 0)}var ua=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,a=r.isSelected?"".concat(r.className||""," msp-control-current"):r.className;return k(nr,_({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:a},{children:n&&this.props.isSelected?k("b",{children:n},void 0):n}),void 0)},t}(Tt.exports.PureComponent),Qs=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return be(At,{children:[k("div",_({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:be("button",_({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[k(Fr,{svg:this.state.isExpanded?Vl:Hl},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:k("div",_({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(Tt.exports.PureComponent);function ps(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),be("div",_({className:t},{children:[k("span",_({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),k("div",_({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var hx=Tt.exports.createContext(void 0),ir=function(e){Pe(t,e);function t(r,n){var a=e.call(this,r)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs=="undefined"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=hx,t}(Tt.exports.Component),ma=function(e){Pe(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.subs=void 0,a.plugin=n,a.init&&a.init(),a}return t.prototype.subscribe=function(r,n){typeof this.subs=="undefined"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(!!this.subs){for(var r=0,n=this.subs;r<n.length;r++){var a=n[r];a.unsubscribe()}this.subs=void 0}},t.contextType=hx,t}(Tt.exports.PureComponent),Rp=function(e){Pe(t,e);function t(r,n){var a=e.call(this,r,n)||this;a.toggleCollapsed=function(){a.setState({isCollapsed:!a.state.isCollapsed})};var i=a.defaultState();return r.initiallyCollapsed!==void 0&&(i.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(i.header=r.header),a.state=i,a}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return be("div",_({className:n},{children:[k("div",_({className:"msp-transform-header"},{children:be(nr,_({icon:this.state.brand?void 0:this.state.isCollapsed?Hl:Vl,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-".concat(this.state.brand.accent):void 0,title:"Click to ".concat(this.state.isCollapsed?"expand":"collapse")},{children:[k(Fr,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,k("small",_({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(ir),Ht=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=k(DAe,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return be("div",_({className:"msp-action-menu-options".concat(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&k(hl,_({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:ml},{children:n}),void 0),!r.header&&n]}),void 0)},t}(Tt.exports.PureComponent);(function(e){function t(l,c){return c?_({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return _({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,p=d.value,v=d.category,m=d.selected,h=d.icon,g=d.addOn,y=d.description,b=void 0,S=[],C=0;C<l.length;C++){var x=l[C];if(!((c==null?void 0:c.filter)&&!c.filter(x))){var A=v==null?void 0:v(x),P=f?f(x):""+x,T=p?p(x):x,D=y?y(x):typeof x=="string"?x:void 0,I=void 0;A?(b||(b=new Map),I=b.get(A),I||(I=[e.Header(A,{description:A})],b.set(A,I),S.push(I))):I=S;var M=g==null?void 0:g(x);I.push({kind:"item",label:P,value:T,icon:h?h(x):void 0,selected:m?m(x):void 0,addOn:M,description:D})}}return S}e.createItems=n;var a={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function i(l,c){return n(l,c?_(_({},a),c):a)}e.createItemsFromSelectOptions=i;function o(l){if(ul(l))return!1;if(Uv(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=o(f);if(p)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!ul(l)){if(Uv(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var p=f[d],v=s(p,c);if(v)return v}}}e.findItem=s;function u(l){if(!ul(l)){if(Uv(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=u(f);if(p)return p}}}e.getFirstItem=u})(Ht||(Ht={}));var DAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=xA(r.props.items,[]).filter(function(a){return!a.selected});r.props.onSelect(n)},r.selectNone=function(){var n=xA(r.props.items,[]).filter(function(a){return!!a.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var a=F3(r.items)&&ul(r.items[0])?r.items[0]:void 0,i=(a==null?void 0:a.isIndependent)?!1:r.multiselect?Ht.hasSelectedItem(r.items):!!r.current&&!!Ht.findItem(r.items,r.current.value)||Ht.hasSelectedItem(r.items);return{header:a,hasCurrent:i,isExpanded:i||(n!=null?n:!!(a==null?void 0:a.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=F3(this.props.items)&&F3(r.items)&&ul(this.props.items[0])&&ul(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return be("div",_({className:"msp-flex-row msp-control-group-header"},{children:[k(nr,_({icon:this.state.isExpanded?Vl:Hl,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to ".concat(this.state.isExpanded?"collapse":"expand",".").concat((n==null?void 0:n.description)?" ".concat(n==null?void 0:n.description):"")},{children:a?k("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),k(nr,_({icon:jm,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),k(nr,_({icon:ml,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,a=r.hasCurrent;return k("div",_({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:k(nr,_({noOverflow:!0,icon:this.state.isExpanded?Vl:Hl,onClick:this.toggleExpanded,title:"Click to ".concat(this.state.isExpanded?"collapse":"expand",". ").concat((n==null?void 0:n.description)?n==null?void 0:n.description:"")},{children:a?k("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,a=n.items,i=n.onSelect,o=n.current;if(ul(a))return null;if(Uv(a))return k(CB,{item:a,onSelect:i,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return be(At,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),k("div",_({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&a.map(function(u,l){return ul(u)?null:Uv(u)?k(CB,{item:u,onSelect:i,current:o,multiselect:r.props.multiselect},l):k(t,{items:u,onSelect:i,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(Tt.exports.PureComponent),CB=function(e){var t=e.item,r=e.onSelect,n=e.current,a=e.multiselect,i=n===t,o=t.addOn?{position:"relative"}:void 0;return be(nr,_({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(a?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[i||t.selected?k("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function F3(e){return!!e&&Array.isArray(e)}function Uv(e){var t=e;return t&&t.kind==="item"}function ul(e){var t=e;return t&&t.kind==="header"}function xA(e,t){if(ul(e))return t;if(Uv(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var a=n[r];xA(a,t)}return t}var zE=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],MAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var a=$e(+(n.currentTarget.getAttribute("data-color")||"0"));a!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(a))},r.onR=function(n){var a=$e.toRgb(r.props.value),i=a[1],o=a[2],s=$e.fromRgb(n,i,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var a=$e.toRgb(r.props.value),i=a[0],o=a[2],s=$e.fromRgb(i,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var a=$e.toRgb(r.props.value),i=a[0],o=a[1],s=$e.fromRgb(i,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update($e.lighten(r.props.value,.1))},r.onDarken=function(){r.update($e.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return k("div",_({className:"msp-combined-color-swatch"},{children:zE.map(function(n){return k(nr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:$e.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Ya(this.props.name),n=$e.toRgb(this.props.value),a=n[0],i=n[1],o=n[2];return be(At,{children:[k(ps,{title:this.props.param.description,label:r,control:k(nr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:$e.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&be("div",_({className:"msp-control-offset"},{children:[this.swatch(),k(ps,{label:"RGB",className:"msp-control-label-short",control:be("div",_({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[k(wl,{onChange:this.onR,numeric:!0,value:a,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),k(wl,{onChange:this.onG,numeric:!0,value:i,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),k(wl,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),be("div",_({style:{display:"flex",textAlignLast:"center"}},{children:[k(nr,_({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),k(nr,_({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(Tt.exports.PureComponent),Qy=void 0;function RAe(){return Qy||(Qy=k(At,{children:zE.map(function(e){return k("option",_({value:e[1],style:{background:"".concat($e.toStyle(e[1]))}},{children:mo(e[0])}),e[1])})},void 0),Qy)}var OAe=function(){for(var e=new Map,t=0,r=zE;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function BAe(e){return OAe.has(e)?null:k("option",_({value:e,style:{background:"".concat($e.toStyle(e))}},{children:$e.toRgbString(e)}),$e.toHexString(e))}function kAe(e){switch(e.kind){case"scale-legend":return LAe;case"table-legend":return FAe;default:var t=e;console.warn("".concat(t," has no associated UI component"));return}}var LAe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(a){return Array.isArray(a)?"".concat($e.toStyle(a[0])," ").concat(100*a[1],"%"):$e.toStyle(a)}).join(", ");return k("div",_({className:"msp-scale-legend"},{children:be("div",_({style:{background:"linear-gradient(to right, ".concat(n,")")}},{children:[k("span",_({style:{float:"left"}},{children:r.minLabel}),void 0),k("span",_({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(Tt.exports.PureComponent),FAe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return k("div",_({className:"msp-table-legend"},{children:r.table.map(function(n,a){var i=n[0],o=n[1];return be("div",{children:[k("div",{className:"msp-table-legend-color",style:{backgroundColor:$e.toStyle(o)}},void 0),k("div",_({className:"msp-table-legend-text"},{children:i}),void 0)]},a)})}),void 0)},t}(Tt.exports.PureComponent),NAe=function(e){Pe(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=ke.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[k("circle",{r:"10",id:"".concat(this.props.id),cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},"".concat(this.props.id,"circle"))]},t}(Tt.exports.Component),UAe=function(e){Pe(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(ke.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx","".concat(l[0])),n.ghostPoints[0].setAttribute("cy","".concat(l[1])),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=Tt.exports.createRef(),n.state={points:[ke.create(0,0),ke.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var a=0,i=n.props.data;a<i.length;a++){var o=i[a];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[k("div",{children:be("svg",_({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 ".concat(this.width+this.padding," ").concat(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[be("g",_({stroke:"black",fill:"black"},{children:[n,r]}),void 0),k("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),k("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),a,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());a=ke.create(o.x,o.y),(o.x<i||o.x>this.width+i)&&(o.y>this.height+i||o.y<i)?a=ke.create(this.updatedX,this.updatedY):o.x<i?a=ke.create(i,o.y):o.x>this.width+i?a=ke.create(this.width+i,o.y):o.y>this.height+i?a=ke.create(o.x,this.height+i):o.y<i?a=ke.create(o.x,i):a=ke.create(o.x,o.y),this.updatedX=a[0],this.updatedY=a[1];var s=this.unNormalizePoint(a);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx","".concat(a[0])),this.ghostPoints[0].setAttribute("cy","".concat(a[1])),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var a=this.unNormalizePoint(ke.create(this.updatedX,this.updatedY)),i=this.state.points.filter(function(o,s){return s!==n[0]});i.push(a),i.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n=this.myRef.createSVGPoint();n.x=r.clientX,n.y=r.clientY;var a=n.matrixTransform(this.myRef.getScreenCTM().inverse()),i=this.state.points,o=this.padding/2;if(!(a.x<o||a.x>this.width+o||a.y>this.height+o||a.y<this.padding/2)){var s=this.unNormalizePoint(ke.create(a.x,a.y));i.push(s),i.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:i}),this.change(i)}},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=r[0]*(a-n)+n,s=r[1]*(i-n)+n,u=this.height+this.padding-s,l=ke.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,a=this.width+n,i=this.height+n,o=(r[0]-n)/(a-n),s=(this.height+this.padding-r[1]-n)/(i-n);return ke.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,a=0;a<this.state.points.length;a++)a!==0&&a!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[a]),r.push(k(NAe,{id:a,x:n[0],y:n[1],nX:this.state.points[a][0],nY:this.state.points[a][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(a),onclick:this.handleClick(a)},a)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],a,i,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];a=this.padding/2,i=this.width+a,o=this.height+a,s=f[0]*(i-a)+a,u=f[1]*(o-a)+a,l=this.height+this.padding-u,r.push(ke.create(s,l))}for(var p=r,v=p.length,m=0;m<v-1;m++){var h=p[m][0],g=p[m][1],y=p[m+1][0],b=p[m+1][1];n.push(k("line",{x1:h,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf".concat(m)))}return n},t}(Tt.exports.Component),PH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var a,i;r.setState({current:n}),(i=(a=r.props).onChangeImmediate)===null||i===void 0||i.call(a,n)},r.updateManually=function(n){r.setState({isChanging:!0});var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.setState({current:a,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),be("div",_({className:"msp-slider"},{children:[k("div",{children:k(EH,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),k("div",{children:k(wl,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(Tt.exports.Component),zAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.state.current[0]?a=r.state.current[0]:a<r.props.min&&(a=r.props.min),a>r.props.max&&(a=r.props.max),r.props.onChange([r.state.current[0],a])},r.updateMin=function(n){var a=n;r.props.step===1&&(a=Math.round(a)),a<r.props.min&&(a=r.props.min),a>r.state.current[1]?a=r.state.current[1]:a>r.props.max&&(a=r.props.max),r.props.onChange([a,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),be("div",_({className:"msp-slider2"},{children:[k("div",{children:k(wl,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),k("div",{children:k(EH,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),k("div",{children:k(wl,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(Tt.exports.Component);function CA(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var a=arguments[n];if(!!a){var i=typeof a;if(i==="string"||i==="number")t.push(a);else if(Array.isArray(a))t.push(CA.apply(null,a));else if(i==="object")for(var o in a)r.call(a,o)&&a[o]&&t.push(o)}}return t.join(" ")}function wB(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function _B(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function AB(e,t){return e?t.clientY:t.pageX}function TB(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function N3(e){e.stopPropagation(),e.preventDefault()}var VAe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,a=r.tipFormatter,i=r.vertical,o=r.offset,s=r.value,u=r.index,l=i?{bottom:"".concat(o,"%")}:{left:"".concat(o,"%")};return k("div",{className:n,style:l,title:a(s,u)},void 0)},t}(Tt.exports.Component),EH=function(e){Pe(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=Tt.exports.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var p=AB(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=TB(n.props.vertical,f.target);n.dragOffset=p-v,p=v}n.onStart(p),n.addDocumentEvents("mouse"),N3(f)}},n.onTouchMove=function(f){if(wB(f)){n.end("touch");return}var p=_B(n.props.vertical,f);n.onMove(f,p-n.dragOffset)},n.onTouchStart=function(f){if(!wB(f)){var p=_B(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=TB(n.props.vertical,f.target);n.dragOffset=p-v,p=v}n.onStart(p),n.addDocumentEvents("touch"),N3(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var p=n.props,v=p.min,m=p.max,h=(f-v)/(m-v);return h*100};var a=r.range,i=r.min,o=r.max,s=a?Array.apply(null,Array(+a+1)).map(function(){return i}):i,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(a?l:[i,l]).map(function(f){return n.trimAlignValue(f)}),d;return a&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var a=this.state.bounds;if(r.range){var i=this.props.value||a,o=i.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===a[l]}))return;this.setState({bounds:o}),a.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var i=this.props.value!==void 0?this.props.value:a[1],s=this.trimAlignValue(i,this.props);if(s===a[1]&&a[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(a[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,a=!("value"in n);a?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var i=_(_({},this.state),r),o=n.range?i.bounds:i.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=AB(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){N3(r);var a=this.props,i=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(a.max-a.min),u=this.trimAlignValue(this.startValue+s),l=i.bounds[i.handle];if(u!==l){var c=It([],i.bounds,!0);c[i.handle]=u;var d=i.handle;if(a.pushable){var f=i.bounds[d];this.pushSurroundingHandles(c,d,f)}else a.allowCross&&(c.sort(function(p,v){return p-v}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var a=this.calcValueByPos(r);this.startValue=a,this.startPosition=r;var i=this.state,o=i.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)a>o[l]&&(u=l);Math.abs(o[u+1]-a)<Math.abs(o[u]-a)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=i.recent),c&&a!==o[u+1]&&(s=a<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=i.bounds[s];if(a!==d){var f=It([],i.bounds,!0);f[s]=a,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,a=r.step,i=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==a){var u=_({},n);if(a!==null)for(var l=i;l<=o;l+=a)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:a,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),a=0;return n.indexOf(".")>=0&&(a=n.length-n.indexOf(".")-1),a},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,a=n.vertical,i=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=a?(1-s)*(o-i)+i:s*(o-i)+i;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),a=this.trimAlignValue(this.calcValue(n));return a},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,a=this.handleElements;n<a.length;n++){var i=a[n];if(i.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,a,i){for(var o=r[n],s=r[n];a*(s-o)<i;){if(!this.pushHandleOnePoint(r,n,a))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,a){var i=this.getPoints(),o=i.indexOf(r[n]),s=o+a;if(s>=i.length||s<0)return!1;var u=n+a,l=i[s],c=this.props.pushable,d=a*(r[u]-l);return this.pushHandle(r,u,a,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,a){var i=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<i?s=1:o-r[n-1]<i&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+i-l)||(r[n]=a)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var a=this.state||{},i=a.handle,o=a.bounds,s=_(_({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,p=r;p<=c&&(p=c),p>=d&&(p=d),!f&&i!=null&&i>0&&p<=o[i-1]&&(p=o[i-1]),!f&&i!=null&&i<o.length-1&&p>=o[i+1]&&(p=o[i+1]);var v=Object.keys(u).map(parseFloat);if(l!==null){var m=Math.round((p-c)/l)*l+c;v.push(m)}var h=v.map(function(y){return Math.abs(p-y)}),g=v[h.indexOf(Math.min.apply(Math,h))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,a=this.state,i=a.handle,o=a.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,p=s.step,v=s.marks,m=s.tipFormatter,h=this.props.handle,g=o.map(this.calcOffset),y="".concat(l,"-handle"),b=o.map(function(T,D){var I;return CA((I={},I[y]=!0,I["".concat(y,"-").concat(D+1)]=!0,I["".concat(y,"-lower")]=D===0,I["".concat(y,"-upper")]=D===o.length-1,I))}),S=p===null||m===null,C={prefixCls:l,noTip:S,tipFormatter:m,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var x=0;x<o.length;x++)this.handleElements.push(Tt.exports.createRef())}var A=o.map(function(T,D){return Tt.exports.cloneElement(h,_(_({},C),{className:b[D],value:T,offset:g[D],dragging:i===D,index:D,key:D,ref:n.handleElements[D]}))});f||A.shift();var P=CA((r={},r[l]=!0,r["".concat(l,"-with-marks")]=Object.keys(v).length,r["".concat(l,"-disabled")]=c,r["".concat(l,"-vertical")]=this.props.vertical,r[u]=!!u,r));return be("div",_({ref:this.sliderElement,className:P,onTouchStart:c?Oc:this.onTouchStart,onMouseDown:c?Oc:this.onMouseDown},{children:[k("div",{className:"".concat(l,"-rail")},void 0),A]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:k(VAe,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:Oc,onChange:Oc,onAfterChange:Oc,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(Tt.exports.Component),bn=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i,o;if((o=(i=r.props).onChange)===null||o===void 0||o.call(i,n,r.props.values),r.props.onChangeValues){var s=_(_({},r.props.values),(a={},a[n.name]=n.value,a));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=Bl(function(n){return GAe(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var a=this.props.values,i=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];((n=d.hideIf)===null||n===void 0?void 0:n.call(d,a))||(i||(i=[]),o=d.category,i.push(k(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:a[c]},c)))}return i?o?[k(Qs,_({header:o},{children:i}),o)]:i:null},t.prototype.renderPart=function(r){for(var n=null,a=0,i=r;a<i.length;a++){var o=i[a],s=this.renderGroup(o);if(!!s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),a=this.renderPart(r.advanced);return n&&a?be(At,{children:[n,k(Qs,_({header:"Advanced Options"},{children:a}),void 0)]},void 0):n||a},t}(Tt.exports.PureComponent),HAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,a){var i,o=_(_({},a),(i={},i[n.name]=n.value,i)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),a=this.props.mapping.params(this.plugin);return k(bn,{params:a,values:n,onChange:this.setSettings},void 0)},t}(ir);function GAe(e){function t(c,d,f){var p=Gg(d);if(!!p)if(!d.category)f.params[0].push([c,d,p]);else{f.map||(f.map=new Map);var v=f.map.get(d.category);v||(v=[],f.map.set(d.category,v),f.params.push(v)),v.push([c,d,p])}}function r(c,d){var f=c[0],p=d[0];return!f||!f[1].category?-1:!p||!p[1].category?1:f[1].category<p[1].category?-1:1}for(var n=Object.keys(e),a={params:[[]],map:void 0},i={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,a):t(u,l,i))}return a.params.sort(r),i.params.sort(r),{essentials:a.params,advanced:i.params}}function Gg(e){switch(e.type){case"value":return;case"boolean":return VE;case"number":return typeof e.min!="undefined"&&typeof e.max!="undefined"?XAe:WAe;case"converted":return pTe;case"conditioned":return fTe;case"multi-select":return lTe;case"color":return MAe;case"color-list":return e.offsets?nTe:rTe;case"vec3":return aTe;case"mat4":return iTe;case"url":return oTe;case"file":return sTe;case"file-list":return uTe;case"select":return HE;case"value-ref":return KAe;case"data-ref":return;case"text":return YAe;case"interval":return typeof e.min!="undefined"&&typeof e.max!="undefined"?ZAe:QAe;case"group":return DH;case"mapped":return cTe;case"line-graph":return jAe;case"script":return vTe;case"object-list":return qE;default:var t=e;console.warn("".concat(t," has no associated UI component"));return}}var qAe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,a=r.description,i=n&&kAe(n);return k("div",_({className:"msp-help-text"},{children:be("div",{children:[be("div",_({className:"msp-help-description"},{children:[k(Fr,{svg:ku,inline:!0},void 0),a]}),void 0),i&&k("div",_({className:"msp-help-legend"},{children:k(i,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(Tt.exports.PureComponent);function Op(e){var t=e.props,r=e.state,n=e.control,a=e.toggleHelp,i=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Ya(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return be(At,{children:[k(ps,{className:s,title:d,label:be(At,{children:[u,c&&k("button",_({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:a,title:d||"".concat(r.showHelp?"Hide":"Show"," help"),style:{background:"transparent",textAlign:"left",padding:"0"}},{children:k(Fr,{svg:ku},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&k("div",_({className:"msp-control-offset"},{children:k(qAe,{legend:l.legend,description:l.description},void 0)}),void 0),i]},void 0)}var Bp=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Tt.exports.PureComponent),VE=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return be("button",_({onClick:this.onClick,disabled:this.props.isDisabled},{children:[k(Fr,{svg:this.props.value?jm:xH},void 0),this.props.value?"On":"Off"]}),void 0)},t}(Bp),jAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:"".concat(r.props.param.defaultValue.length," points")},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"(".concat(n[0].toFixed(2),", ").concat(n[1].toFixed(2),")")});return}r.setState({message:"".concat(r.props.value.length," points")})},r.onDrag=function(n){r.setState({message:"(".concat(n[0].toFixed(2),", ").concat(n[1].toFixed(2),")")})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Ya(this.props.name);return be(At,{children:[k(ps,{label:r,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"".concat(this.state.message)}),void 0)},void 0),k("div",_({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:k(UAe,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(Tt.exports.PureComponent),WAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var a=kb(r.props.param.step||.01);n=parseFloat(n.toFixed(a)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Ya(this.props.name),n=this.props.param.label||Ya(this.props.name),a=kb(this.props.param.step||.01);return k(ps,{title:this.props.param.description,label:n,control:k(wl,{numeric:!0,value:parseFloat(this.props.value.toFixed(a)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(Tt.exports.PureComponent),XAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value=="undefined"?this.props.param.defaultValue:this.props.value;return k(PH,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Bp),YAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value&&r.update(a)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ya(this.props.name);return k("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Bp),cv=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(a){return a[0]===r.props.value});return be("select",_({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&k("option",_({value:this.props.value},{children:"[Invalid] ".concat(this.props.value)}),this.props.value),this.props.param.options.map(function(a){var i=a[0],o=a[1];return k("option",_({value:i},{children:o}),i)})]}),void 0)},t}(Tt.exports.PureComponent),HE=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,a=n.findIndex(function(o){return o[0]===r.props.value}),i=a===n.length-1?0:a+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[i][0]})},r.items=Bl(function(n){return Ht.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value!==void 0?Ht.findItem(n,this.props.value):void 0,i=a?a.label:typeof this.props.value=="undefined"?"".concat(((r=Ht.getFirstItem(n))===null||r===void 0?void 0:r.label)||""," [Default]"):"[Invalid] ".concat(this.props.value),o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?jm:this.props.value==="off"?xH:void 0:void 0;return k(ua,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=Ht.findItem(r,this.props.value);return k(Ht,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Tt.exports.PureComponent),KAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=Bl(function(n){return Ht.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),a=this.props.value.ref?Ht.findItem(n,this.props.value.ref):void 0,i=a?a.label:"[Ref] ".concat((r=this.props.value.ref)!==null&&r!==void 0?r:"");return k(ua,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=Ht.findItem(r,this.props.value.ref);return k(Ht,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Tt.exports.PureComponent),QAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:E.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:E.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var a=n.name,i=n.value,o=It([],r.props.value,!0);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ya(this.props.name),a=kb(this.props.param.step||.01),i="[".concat(r[0].toFixed(a),", ").concat(r[1].toFixed(a),"]");return be(At,{children:[k(ps,{label:n,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:k(bn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(Tt.exports.PureComponent),ZAe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return k(zAe,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Bp);(function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update($e(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:$e.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return be("div",_({style:{position:"relative"}},{children:[be("select",_({value:this.props.value,onChange:this.onChange},{children:[BAe(this.props.value),RAe()]}),void 0),k("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(Bp);function Yh(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?"".concat($e.toStyle(e[0])," ").concat((100*e[1]).toFixed(2),"%"):$e.toStyle(e[0]):$e.toStyle(e)}var $Ae=TS(function(e){var t=e.map(function(r){return Yh(r,!0)});return"linear-gradient(to right, ".concat(t.join(", "),")")}),JAe=TS(function(e){for(var t=e.length,r=["".concat(Yh(e[0])," ").concat(100*(1/t),"%")],n=1,a=t-1;n<a;++n)r.push("".concat(Yh(e[n])," ").concat(100*(n/t),"%"),"".concat(Yh(e[n])," ").concat(100*((n+1)/t),"%"));return r.push("".concat(Yh(e[t-1])," ").concat(100*((t-1)/t),"%")),"linear-gradient(to right, ".concat(r.join(", "),")")});function GE(e,t){return t===void 0&&(t="0"),{background:eTe(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function eTe(e,t){return t?JAe(e):$Ae(e)}function tTe(){var e=function(t){var r=as(t[0]);return k("div",{style:GE({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:Ht.createItemsFromSelectOptions(JT,{addOn:e}),scale:Ht.createItemsFromSelectOptions(iY,{addOn:e}),set:Ht.createItemsFromSelectOptions(oY,{addOn:e})},ColorsParam:E.ObjectList({color:E.Color(0)},function(t){var r=t.color;return $e.toHexString(r).toUpperCase()}),OffsetColorsParam:E.ObjectList({color:E.Color(0),offset:E.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return"".concat($e.toHexString(r).toUpperCase()," [").concat(n.toFixed(2),"]")}),IsInterpolatedParam:E.Boolean(!1,{label:"Interpolated"})}}var Zy;function IH(){return Zy||(Zy=tTe(),Zy)}var rTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=as(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value;r.update({kind:r.props.value.kind,colors:a.map(function(i){return i.color})})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return be(At,{children:[be("button",_({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":"".concat(r.colors.length," colors"),k("div",{style:GE(r,"33px")},void 0)]}),void 0),k(Nt,{svg:pm,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=IH(),n=r.ColorPresets,a=r.ColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return k(Ht,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return be("div",_({className:"msp-control-offset"},{children:[k(qE,{name:"colors",param:a,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),k(VE,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(Tt.exports.PureComponent),nTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(!!n){r.setState({show:void 0});var a=as(n.value);r.update({kind:a.type!=="qualitative"?"interpolate":"set",colors:a.list})}},r.colorsChanged=function(n){var a=n.value,i=a.map(function(o){return[o.color,o.offset]});i.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:i})},r.isInterpolatedChanged=function(n){var a=n.value;r.update({kind:a?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return be(At,{children:[be("button",_({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":"".concat(r.colors.length," colors"),k("div",{style:GE(r,"33px")},void 0)]}),void 0),k(Nt,{svg:pm,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=IH(),n=r.ColorPresets,a=r.OffsetColorsParam,i=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return k(Ht,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),be("div",_({className:"msp-control-offset"},{children:[k(qE,{name:"colors",param:a,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),k(VE,{name:"isInterpolated",param:i,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(Tt.exports.PureComponent),aTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:E.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var a=n.name,i=n.value,o=w.copy(w.zero(),r.props.value);o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ya(this.props.name),a=kb(this.props.param.step||.01),i="[".concat(r[0].toFixed(a),", ").concat(r[1].toFixed(a),", ").concat(r[2].toFixed(a),"]");return be(At,{children:[k(ps,{label:n,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:k(bn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(Tt.exports.PureComponent),iTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:E.Text(JSON.stringify(oe()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var a=n.name,i=n.value,o=oe.copy(oe(),r.props.value);a==="json"?oe.copy(o,JSON.parse(i)):o[+a]=i,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(a){var i=oe.copy(oe(),n.props.value);i[r]=a,n.change(i)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],a=0;a<4;a++){for(var i=[],o=0;o<4;o++)i.push(k(wl,{numeric:!0,delayMs:50,value:oe.getValue(r,a,o),onChange:this.changeValue(4*o+a),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(k("div",_({className:"msp-flex-row"},{children:i}),a))}return k("div",_({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Ya(this.props.name);return be(At,{children:[k(ps,{label:n,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"4\xD74 Matrix"}),void 0)},void 0),this.state.isExpanded&&be("div",_({className:"msp-control-offset"},{children:[this.grid,k(bn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(Tt.exports.PureComponent),oTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==Kr.getUrl(r.props.value||"")&&r.update(Kr.Url(a))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ya(this.props.name);return k("input",{type:"text",value:Kr.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Bp),sTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Kr.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return be("div",_({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",k("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(Tt.exports.PureComponent),uTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var a=0,i=r.length;a<i;++a)n.push(Kr.File(r[a]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var a=0,i=r;a<i.length;a++){var o=i[a];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:"".concat(n.length," files selected");return be("div",_({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",k("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Op({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(Tt.exports.PureComponent),lTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(a){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(i){return i!==r})),a.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.emptyValue,i=this.props.param.label||Ya(this.props.name);return be(At,{children:[k(ps,{label:i,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&a?a:"".concat(n.length," of ").concat(this.props.param.options.length)}),void 0)},void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return k(nr,_({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:k("span",_({style:{float:l?"left":"right"}},{children:l?"\u2713 ".concat(u):"".concat(u," \u2717")}),void 0)}),s)})}),void 0)]},void 0)},t}(Tt.exports.PureComponent),DH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showPresets:!1,showHelp:!1},r.onChangeParam=function(n){var a;r.change(_(_({},r.props.value),(a={},a[n.name]=n.value,a)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.toggleShowPresets=function(){return r.setState({showPresets:!r.state.showPresets})},r.presetItems=Bl(function(n){var a;return Ht.createItemsFromSelectOptions((a=n.presets)!==null&&a!==void 0?a:[])}),r.onSelectPreset=function(n){r.setState({showPresets:!1}),r.change(n==null?void 0:n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivotedPresets=function(){if(!this.props.param.presets)return null;var r=this.props.param.label||Ya(this.props.name);return be("div",_({className:"msp-control-group-wrapper"},{children:[k("div",_({className:"msp-control-group-header"},{children:be("button",_({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets},{children:[k(Fr,{svg:pm},void 0),r," Presets"]}),void 0)}),void 0),this.state.showPresets&&k(Ht,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset},void 0)]}),void 0)},t.prototype.presets=function(){return this.props.param.presets?be(At,{children:[k("div",_({className:"msp-control-group-presets-wrapper"},{children:k("div",_({className:"msp-control-group-header"},{children:be("button",_({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets},{children:[k(Fr,{svg:pm},void 0),"Presets"]}),void 0)}),void 0)}),void 0),this.state.showPresets&&k(Ht,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset},void 0)]},void 0):null},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,a=n[r],i=Gg(a),o=k(i,{name:r,param:a,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return be("div",_({className:"msp-mapped-parameter-group"},{children:[o,k(Nt,{svg:np,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return be("div",_({className:"msp-mapped-parameter-group"},{children:[o,k(Nt,{svg:np,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),be("div",_({className:"msp-control-offset"},{children:[this.pivotedPresets(),k(bn,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)]}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Ya(this.props.name),a=k(bn,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?k("div",_({className:"msp-control-offset"},{children:a}),void 0):this.props.param.isFlat?a:be("div",_({className:"msp-control-group-wrapper",style:{position:"relative"}},{children:[k("div",_({className:"msp-control-group-header"},{children:be("button",_({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[k(Fr,{svg:this.state.isExpanded?Vl:Hl},void 0),n]}),void 0)}),void 0),this.presets(),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:a}),void 0)]}),void 0)},t}(Tt.exports.PureComponent),cTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];if(!r[i].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,a=this.props.param.map(n.name),i=this.props.param.label||Ya(this.props.name),o=Gg(a),s=this.props.param.help,u=s?_(_({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=k(HE,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:i,value:n.name},void 0);return o?a.type==="group"&&!a.isFlat?this.areParamsEmpty(a.params)?l:be("div",_({className:"msp-mapped-parameter-group"},{children:[l,k(Nt,{svg:np,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"".concat(i," Properties")},void 0),this.state.isExpanded&&k(DH,{inMapped:!0,param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):be(At,{children:[l,k(o,{param:a,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(Tt.exports.PureComponent),MH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var a;r.setState({current:_(_({},r.state.current),(a={},a[n.name]=n.value,a))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return be(At,{children:[k(bn,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),k("button",_({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(Tt.exports.PureComponent),dTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return be(At,{children:[be("div",_({className:"msp-param-object-list-item"},{children:[be("button",_({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[k("span",{children:"".concat(this.props.index+1,": ")},void 0),this.props.param.getLabel(this.props.value)]}),void 0),be("div",{children:[k(Nt,{svg:vx,title:"Move Up",onClick:this.moveUp,small:!0},void 0),k(Nt,{svg:mx,title:"Move Down",onClick:this.moveDown,small:!0},void 0),k(Nt,{svg:gs,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset"},{children:k(MH,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(Tt.exports.PureComponent),qE=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(It(It([],r.props.value,!0),[n],!1))},r.actions={update:function(n,a){var i=r.props.value.slice(0);i[a]=n,r.change(i)},move:function(n,a){var i=r.props.value;if(i.length!==1){var o=(n+a)%i.length;o<0&&(o+=i.length),i=i.slice(0);var s=i[n];i[n]=i[o],i[o]=s,r.change(i)}},remove:function(n){for(var a=r.props.value,i=[],o=0;o<a.length;o++)n!==o&&i.push(a[o]);r.change(i)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,a=this.props.param.label||Ya(this.props.name),i="".concat(n.length," item").concat(n.length!==1?"s":"");return be(At,{children:[k(ps,{label:a,control:k("button",_({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:i}),void 0)},void 0),this.state.isExpanded&&be("div",_({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return k(dTe,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),k(hl,_({header:"New Item"},{children:k(MH,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(Tt.exports.PureComponent),fTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),a=this.props.param.conditionParams[n],i=this.props.param.label||Ya(this.props.name),o=Gg(a),s=k(HE,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:"".concat(i," Kind"),value:n},void 0);return o?be(At,{children:[s,k(o,{param:a,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(Tt.exports.PureComponent),pTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=Gg(this.props.param.converted);return n?k(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(Tt.exports.PureComponent),vTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a=n.target.value;a!==r.props.value.expression&&r.update({language:r.props.value.language,expression:a})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ya(this.props.name);return k("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Bp),mTe={color:E.Color(tr.black,{description:"Display color of the volume."}),wireframe:E.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:E.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},hTe=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),$y=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=Kt.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,a=r.ref;return a?!n.cells.get(a).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,a=r.ref;!a||tp(n,a,!n.cells.get(a).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=Kt.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,a=r.stats,i=r.channels[r.name],o=a.min,s=a.max,u=a.mean,l=a.sigma,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var p=hTe.get(this.props.name);this.props.name==="em"?(d=Math.max(p[0],d),f=Math.min(p[1],f)):(d=p[0],f=p[1])}var v=u+l*d,m=u+l*f,h=W_(n?Math.round((m-v)/l)/100:l/100,2),g=n?d:v,y=n?f:m;return k(IAe,{label:r.label+(r.isRelative?" \u03C3":""),colorStripe:i.color,pivot:be("div",_({className:"msp-volume-channel-inline-controls"},{children:[k(PH,{value:c,min:g,max:y,step:h,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),k(Nt,{svg:this.getVisible()?Mp:Dp,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:k(bn,{onChange:function(b){var S=b.name,C=b.value;return r.changeParams(r.name,S,C)},params:mTe,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(ir),gTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,a,i){var o,s=r.props.params;r.newParams(_(_({},s),{entry:{name:s.entry.name,params:_(_({},s.entry.params),{channels:_(_({},s.entry.params.channels),(o={},o[n]=_(_({},s.entry.params.channels[n]),{isoValue:i?ht.IsoValue.relative(a):ht.IsoValue.absolute(a)}),o))})}}))},r.changeParams=function(n,a,i){var o,s,u=r.props.params;r.newParams(_(_({},u),{entry:{name:u.entry.name,params:_(_({},u.entry.params),{channels:_(_({},u.entry.params.channels),(o={},o[n]=_(_({},u.entry.params.channels[n]),(s={},s[a]=i,s)),o))})}}))},r.changeOption=function(n){var a=n.name,i=n.value,o=r.props.params;if(a==="entry")r.newParams(_(_({},o),{entry:{name:i,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=i.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===i.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(i.name).defaultValue,p=_({},f);i.name==="selection-box"?p.radius=i.params.radius:i.name==="box"?(p.bottomLeft=i.params.bottomLeft,p.topRight=i.params.topRight):i.name==="auto"&&(p.radius=i.params.radius,p.selectionDetailLevel=i.params.selectionDetailLevel),p.isUnbounded=!!i.params.isUnbounded,r.newParams(_(_({},o),{entry:{name:o.entry.name,params:_(_({},o.entry.params),{view:{name:i.name,params:p},detailLevel:i.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return E.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,a){return _(_({},r),{isoValue:a?ht.IsoValue.toRelative(r.isoValue,n):ht.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",a=n?"em":"2fo-fc",i=this.props.params,o=this.props.info.params.entry.map(i.entry.name),s=o.params.detailLevel,u=i.entry.params.channels[a].isoValue.kind==="relative",l=r.info.header.sampling[0],c=E.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!i.entry.params.view.params.isUnbounded,f=E.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),p=i.entry.params.view.name==="off",v={entry:E.Select(i.entry.name,r.data.entries.map(function(h){return[h.dataId,h.dataId]}),{isHidden:p,description:"Which entry with volume data to display."}),view:E.MappedStatic(i.entry.params.view.name,{off:E.Group({isRelative:E.Boolean(u,{isHidden:!0}),isUnbounded:E.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:E.Group({bottomLeft:E.Vec3(w.zero()),topRight:E.Vec3(w.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:E.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:E.Group({radius:E.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:_(_({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:ui.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},m={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return p?k(bn,{onChange:this.changeOption,params:v,values:m,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):be(At,{children:[!n&&k($y,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&k($y,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&k($y,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&k($y,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),k(bn,{onChange:this.changeOption,params:v,values:m,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(ir),yTe=function(){return _(_({},G_e()),{customParamEditors:[[xE,gTe]]})},bTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var a;r.plugin.managers.animation.updateParams((a={},a[n.name]=n.value,a))},r.updateCurrentParams=function(n){var a;r.plugin.managers.animation.updateCurrentParams((a={},a[n.name]=n.value,a))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,a=this.plugin.managers.animation;if(a.isEmpty)return null;var i=a.state.animationState==="playing",o=(n=(r=a.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return be(At,{children:[k(bn,{params:a.getParams(),values:a.state.params,onChange:this.updateParams,isDisabled:i},void 0),k(bn,{params:a.current.params,values:a.current.paramValues,onChange:this.updateCurrentParams,isDisabled:i},void 0),k("div",_({className:"msp-flex-row"},{children:k(nr,_({icon:a.state.animationState!=="playing"?void 0:_H,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:a.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(ir),RH="overpaint-controls";function PB(e,t,r,n,a){return se(this,void 0,void 0,function(){var i=this;return ie(this,function(o){switch(o.label){case 0:return[4,STe(e,t,function(s,u,l){return se(i,void 0,void 0,function(){var c,d,f,p,v,v;return ie(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),Xt.isEmpty(d)||fi(d)?[2]:(f={bundle:Mr.fromLoci(d),color:r===-1?$e(0):r,clear:r===-1},l?(p=It(It([],l.params.values.layers,!0),[f],!1),v=EB(p,c),s.to(l).update(Oa.toBundle(v))):(v=EB([f],c),s.to(u.transform.ref).apply(Ve.Representation.OverpaintStructureRepresentation3DFromBundle,Oa.toBundle(v),{tags:RH})),[2])}})})})];case 1:return o.sent(),[2]}})})}function STe(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(Kt.Generators.ofTransformer(Ve.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(RH)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function EB(e,t){var r=Oa.ofBundle(e,t.root),n=Oa.merge(r);return Oa.filter(n,t)}var OH="clipping-controls";function xTe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i=this;return ie(this,function(o){switch(o.label){case 0:return[4,CTe(e,t,function(s,u,l){return se(i,void 0,void 0,function(){var c,d,f,p,v,v;return ie(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),Xt.isEmpty(d)||fi(d)?[2]:(f={bundle:Mr.fromLoci(d),groups:r},l?(p=It(It([],l.params.values.layers,!0),[f],!1),v=IB(p,c),s.to(l).update(an.toBundle(v))):(v=IB([f],c),s.to(u.transform.ref).apply(Ve.Representation.ClippingStructureRepresentation3DFromBundle,an.toBundle(v),{tags:OH})),[2])}})})})];case 1:return o.sent(),[2]}})})}function CTe(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(Kt.Generators.ofTransformer(Ve.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(OH)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function IB(e,t){var r=an.ofBundle(e,t.root),n=an.merge(r);return an.filter(n,t)}var BH="transparency-controls";function wTe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i=this;return ie(this,function(o){switch(o.label){case 0:return[4,_Te(e,t,function(s,u,l){return se(i,void 0,void 0,function(){var c,d,f,p,v,v;return ie(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),Xt.isEmpty(d)||fi(d)?[2]:(f={bundle:Mr.fromLoci(d),value:r},l?(p=It(It([],l.params.values.layers,!0),[f],!1),v=DB(p,c),s.to(l).update(Ba.toBundle(v))):(v=DB([f],c),s.to(u.transform.ref).apply(Ve.Representation.TransparencyStructureRepresentation3DFromBundle,Ba.toBundle(v),{tags:BH})),[2])}})})})];case 1:return o.sent(),[2]}})})}function _Te(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(Kt.Generators.ofTransformer(Ve.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(BH)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function DB(e,t){var r=Ba.ofBundle(e,t.root),n=Ba.merge(r);return Ba.filter(n,t)}var kH="substance-controls";function MB(e,t,r,n,a){return se(this,void 0,void 0,function(){var i=this;return ie(this,function(o){switch(o.label){case 0:return[4,ATe(e,t,function(s,u,l){return se(i,void 0,void 0,function(){var c,d,f,p,v,v;return ie(this,function(m){switch(m.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=m.sent(),Xt.isEmpty(d)||fi(d)?[2]:(f={bundle:Mr.fromLoci(d),material:r!=null?r:di(),clear:!r},l?(p=It(It([],l.params.values.layers,!0),[f],!1),v=RB(p,c),s.to(l).update(ka.toBundle(v))):(v=RB([f],c),s.to(u.transform.ref).apply(Ve.Representation.SubstanceStructureRepresentation3DFromBundle,ka.toBundle(v),{tags:kH})),[2])}})})})];case 1:return o.sent(),[2]}})})}function ATe(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,f.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(Kt.Generators.ofTransformer(Ve.Representation.SubstanceStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(kH)),[4,r(a,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function RB(e,t){var r=ka.ofBundle(e,t.root),n=ka.merge(r);return ka.filter(n,t)}var Md=function(e){Pe(t,e);function t(r){var n=e.call(this,{options:E.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d=this;return ie(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(void 0),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(s=o[i],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(a,c);return[2,this.plugin.dataTransaction(function(){return se(d,void 0,void 0,function(){return ie(this,function(p){switch(p.label){case 0:return[4,a.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(LE,function(v){v.ignoreHydrogens=!r.showHydrogens,v.ignoreLight=r.ignoreLight,v.material=r.materialStyle,v.clip=r.clipObjects})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.showHydrogens,o=a.visualQuality,s=a.ignoreLight,u=a.materialStyle,l=a.clipObjects,c=!i,d=0,f=n.representations;d<f.length;d++){var p=f[d];if(p.cell.transform.transformer===r2){var v=p.cell.transform.params;(!!v.type.params.ignoreHydrogens!==c||v.type.params.quality!==o||v.type.params.ignoreLight!==s||!U0(v.type.params.material,u)||!E.areEqual(fd.Params,v.type.params.clip,l))&&r.to(p.cell).update(function(m){m.type.params.ignoreHydrogens=c,m.type.params.quality=o,m.type.params.ignoreLight=s,m.type.params.material=u,m.type.params.clip=l})}}},t.prototype.updateInterationProps=function(){var r,n,a;return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f=this;return ie(this,function(p){switch(p.label){case 0:i=0,o=this.currentStructures,p.label=1;case 1:return i<o.length?(s=o[i],u=_n.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[_n.descriptor.name],E.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(v){v.properties[_n.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((a=s.cell.obj)===null||a===void 0?void 0:a.data),d=E.getDefaultValues(c),E.areEqual(u,d.properties[_n.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[_n.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return se(i,void 0,void 0,function(){var o,s,u,l;return ie(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,a)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(ns(n.components,function(y){y&&a.add(y.ref)}),n.representations&&ns(n.representations,function(y){y&&a.add(y.ref)}),a.size===0)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var p=f[d];s(p)}if(c.genericRepresentations)for(var v=0,m=c.genericRepresentations;v<m.length;v++){var p=m[v];s(p)}}if(r.genericRepresentations)for(var h=0,g=r.genericRepresentations;h<g.length;h++){var p=g[h];s(p)}if(i)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Ne.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(Fe.create("Modify Component",function(i){return se(a,void 0,void 0,function(){var o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],!!this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];!d||tp(this.dataState,d.cell.transform.ref,a)}else for(var a=!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];tp(this.dataState,s.cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[i]&&a.push(u.representations[i])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var p=f[d];a.push(p)}return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(r.length===0)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[i];!c||c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,S=b.color==="default"?cA(p.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name):b.color?cA(p.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,C=b.size==="default"?pB(p.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?pB(p.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(S||C)&&u.to(g.cell).update(function(x){S&&(x.colorTheme=S),C&&(x.sizeTheme=C)})},p=this,v=0,m=d.representations;v<m.length;v++){var h=m[v];f(h)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(r.length!==0){var i=this.state.options,o=i.showHydrogens,s=i.visualQuality,u=i.ignoreLight,l=i.materialStyle,c=i.clipObjects,d=!o,f={ignoreHydrogens:d,quality:s,ignoreLight:u,material:l,clip:c};return this.plugin.dataTransaction(function(){return se(a,void 0,void 0,function(){var p,v,m;return ie(this,function(h){switch(h.label){case 0:p=0,v=r,h.label=1;case 1:return p<v.length?(m=v[p],[4,this.plugin.builders.structure.representation.addRepresentation(m.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:f})]):[3,4];case 2:h.sent(),h.label=3;case 3:return p++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(r.components.length!==0)return this.plugin.runTask(Fe.create("Find Component",function(i){return se(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:return o=(v=r.cell.obj)===null||v===void 0?void 0:v.data,o?(l=(u=ot).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=l.apply(u,[h.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],p=(m=f.cell.obj)===null||m===void 0?void 0:m.data,!(!p||!f.cell.parent)&&Kte(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return se(this,void 0,void 0,function(){var a=this;return ie(this,function(i){return[2,this.plugin.dataTransaction(function(){return se(a,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){switch(S.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=s.ignoreLight,d=s.materialStyle,f=s.clipObjects,p=!u,v={ignoreHydrogens:p,quality:l,ignoreLight:c,material:d,clip:f},m=Jr.create22(),h=0,g=o,S.label=1;case 1:return h<g.length?(y=g[h],b=void 0,r.options.checkExisting?[4,this.tryFindComponent(y,r.selection)]:[3,3]):[3,8];case 2:b=S.sent(),S.label=3;case 3:return b?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(y.cell,r.selection,m,{label:r.options.label||(r.selection===Hn.current?"Custom Selection":"")})];case 4:b=S.sent(),S.label=5;case 5:return r.representation==="none"||!b?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(b,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:v})];case 6:S.sent(),S.label=7;case 7:return h++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return se(this,void 0,void 0,function(){var a=this;return ie(this,function(i){return[2,this.plugin.dataTransaction(function(o){return se(a,void 0,void 0,function(){var s,u,l,c,d,f,f,f,f,p=this;return ie(this,function(v){switch(v.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(m){return se(p,void 0,void 0,function(){var h,g;return ie(this,function(y){switch(y.label){case 0:return g=(h=ot).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,m)];case 1:return[2,g.apply(h,[y.sent()])]}})})},l=0,c=s,v.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="color"?[3,3]:(f=r.action.params,[4,PB(this.plugin,d.components,f.color,u,r.representations)])):[3,14];case 2:return v.sent(),[3,13];case 3:return r.action.name!=="resetColor"?[3,5]:[4,PB(this.plugin,d.components,-1,u,r.representations)];case 4:return v.sent(),[3,13];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,wTe(this.plugin,d.components,f.value,u,r.representations)]);case 6:return v.sent(),[3,13];case 7:return r.action.name!=="material"?[3,9]:(f=r.action.params,[4,MB(this.plugin,d.components,f.material,u,r.representations)]);case 8:return v.sent(),[3,13];case 9:return r.action.name!=="resetMaterial"?[3,11]:[4,MB(this.plugin,d.components,void 0,u,r.representations)];case 10:return v.sent(),[3,13];case 11:return r.action.name!=="clipping"?[3,13]:(f=r.action.params,[4,xTe(this.plugin,d.components,an.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 12:v.sent(),v.label=13;case 13:return l++,[3,1];case 14:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(!!l&&!((i==="subtract"||i==="intersect")&&!xS(l,a))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=i==="union"?ng(c,[l,a]):i==="intersect"?h7(l,a):MP(l,a);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=Mr.fromSubStructure(c,d),p={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:(a=r.cell.params)===null||a===void 0?void 0:a.values.type,nullIfEmpty:(i=r.cell.params)===null||i===void 0?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var o=i[a],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(uc);(function(e){e.OptionsParams={showHydrogens:E.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:E.Select("auto",GP,{description:"Control the visual/rendering quality of representations"}),ignoreLight:E.Boolean(!1,{description:"Ignore light for stylized rendering of representtions"}),materialStyle:di.getParam(),clipObjects:E.Group(fd.Params),interactions:E.Group(_n.defaultParams,{label:"Non-covalent Interactions"})};function t(i,o){var s=i.query.structure.registry.options;return o=_({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:E.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:a(i,o==null?void 0:o.pivot,(o==null?void 0:o.allowNone)?[["none","< Create Later >"]]:[]),options:E.Group({label:E.Text(""),checkExisting:E.Boolean(!!(o==null?void 0:o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(i,o){var s=i.query.structure.registry.options;return{selection:E.Select(s[1][0],s,{isHidden:!1}),action:E.MappedStatic("color",{color:E.Group({color:E.Color(tr.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:E.EmptyGroup({label:"Reset Color"}),transparency:E.Group({value:E.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:E.Group({material:di.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:E.EmptyGroup({label:"Reset Material"}),clipping:E.Group({excludeGroups:E.MultiSelect([],E.objectToOptions(an.Groups.Names))},{isFlat:!0})}),representations:E.MultiSelect([],n(i,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,o){var s,u;return((s=o==null?void 0:o.cell.obj)===null||s===void 0?void 0:s.data)?i.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function a(i,o,s,u){var l=It(It([],s,!0),n(i,o),!0);return E.Select(l[0][0],l,{label:u})}})(Md||(Md={}));function TTe(e,t){var r=FTe(e,t||jE());return VTe(e.tree,r),t&&t.refs.forEach(UTe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function jE(){return{trajectories:[],models:[],structures:[],refs:new Map}}function PTe(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function OB(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function ETe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function ITe(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function BB(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function DTe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function MTe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function RTe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function OTe(e){return e.transform.tags?It([],e.transform.tags,!0).sort().join():e.transform.ref}function BTe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:OTe(e),representations:[]}}function kTe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function LTe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function FTe(e,t){return{state:e,oldHierarchy:t,hierarchy:jE(),changed:!1,added:new Set}}function Zp(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Jd(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function kB(e){return function(t){return e.is(t.obj)}}function LB(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function Jy(e){return function(t){return t.transform.transformer===e}}function ef(){}var NTe=[[kB(fe.Molecule.Trajectory),function(e,t){e.currentTrajectory=Zp(e,t,e.hierarchy.trajectories,PTe,t)},function(e){return e.currentTrajectory=void 0}],[LB(fe.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Zp(e,t,e.currentTrajectory.models,OB,t,e.currentTrajectory):e.currentModel=Jd(e,t,OB,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[Jy(Ve.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Jd(e,t,ETe,t,e.currentModel)},ef],[Jy(Ve.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Jd(e,t,ITe,t,e.currentModel)},ef],[LB(fe.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Zp(e,t,e.currentModel.structures,BB,t,e.currentModel):e.currentStructure=Jd(e,t,BB,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[Jy(Ve.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Jd(e,t,DTe,t,e.currentStructure)},ef],[Jy(Ve.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Jd(e,t,MTe,t,e.currentStructure)},ef],[kB(ui),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Jd(e,t,RTe,t,e.currentStructure)),!1},ef],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:fe.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Zp(e,t,e.currentStructure.components,BTe,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&fe.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Zp(e,t,e.currentComponent.representations,kTe,t,e.currentComponent),!1},ef],[function(e){return!e.state.isGhost&&fe.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Zp(e,t,r.genericRepresentations,LTe,t,r))},ef]];function LH(e){if(!e||!(e==null?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===pn.Null||e.status!=="ok"&&e.status!=="error")}function UTe(e){var t=e.cell;LH(t)||(this.changed=!0)}function zTe(e){FH(this,this.tree.transforms.get(e))}function FH(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!LH(n)){for(var a=void 0,i=!1,o=0,s=NTe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(zTe,e),a&&a(r)}}}function VTe(e,t){var r={tree:e,state:t};return FH(r,e.root),r.state}var dg=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:jE(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var a=n[r];this._currentSelectionSet.add(a.cell.transform.ref)}for(var i=0,o=this.selection.models;i<o.length;i++){var a=o[i];this._currentSelectionSet.add(a.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var a=u[s];this._currentSelectionSet.add(a.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],a=0,i=r;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(a.has(l)||n.has(l))&&i.push(u)}return i.length===0?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(_({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=TTe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i=n==="add"?Pn.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):Pn.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=a.trajectories;l<c.length;l++){var d=c[l];i.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=a.models;f<p.length;f++){var v=p[f];i.has(v.cell.transform.ref)&&s.push(v)}for(var m=0,h=a.structures;m<h.length;m++){var g=h[m];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];tp(this.dataState,s.cell.transform.ref,a)}},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return se(i,void 0,void 0,function(){var o,s,u;return ie(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return se(this,void 0,void 0,function(){var a=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return se(a,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return o=Nn.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),ft.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++){var o=i[a];n.delete(o.cell)}return n.commit()},t}(Fg);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(v){return[v]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(!!f){var p=i.get(f);p||(p=[],i.set(f,p),a.push(p)),p.push(d)}}return a}e.getComponentGroups=t;function r(n){var a,i,o,s,u,l,c,d,f,p=n.managers.structure.hierarchy.selection.structures;if(p.length===0)return"";if(p.length===1){var v=p[0],m=(a=v.cell.obj)===null||a===void 0?void 0:a.data;if(!m)return((i=v.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";var h=m.models[0]||m.representativeModel||m.masterModel;if(!h)return((o=v.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=h.entryId;return((u=(s=v.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0?void 0:u.models)&&v.model.trajectory.models.length===1?g:v.model?"".concat((l=v.model.cell.obj)===null||l===void 0?void 0:l.label," | ").concat(g):g}for(var y=p[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,S=!0,C=0,x=p;C<x.length;C++){var v=x[C];if(((d=v==null?void 0:v.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?"".concat((f=b.cell.obj)===null||f===void 0?void 0:f.label," | ").concat(p.length," structures"):"".concat(p.length," structures")}e.getSelectedStructuresDescription=r})(dg||(dg={}));var ip=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var a,i=n.name,o=n.value,s=_(_({},r.props.params),(a={},a[i]=o,a));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return E.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return k(bn,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(ma);(function(e){function t(a){for(var i=Object.keys(a),o=0,s=i;o<s.length;o++){var u=s[o];if(!a[u].isHidden)return!1}return!0}function r(a,i,o,s){var u=i.cells.get(s).obj,l=o.definition.params?o.definition.params(u,a):{},c=E.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(a,i,o){var s=i.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(ip||(ip={}));var NH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new xn,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,a,i){r.clearAutoApply(),r.setState({params:n,isInitial:a,error:i&&i[0]},function(){!a&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return se(r,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return o.sent(),[3,5];case 3:return n=o.sent(),console.error(n),[3,5];case 4:return(i=(a=this.props).onApply)===null||i===void 0||i.call(a),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),a=E.getDefaultValues(n.params);r.setState({params:a,isInitial:E.areEqual(n.params,a,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:be("div",_({className:"msp-transform-apply-wrap"},{children:[k(Nt,{svg:yA,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),k("div",_({className:"msp-transform-apply-wider"},{children:k(nr,_({icon:r?jm:void 0,className:"msp-btn-commit msp-btn-commit-".concat(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),a=this.getHeader(),i=this.getTransformerId(),o=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):ip,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,p=this.renderApply();u=be(At,{children:[k(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),p]},void 0)}var v=be("div",_({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[a!=="none"&&!this.props.wrapInExpander&&k("div",_({className:"msp-transform-header"},{children:be(nr,_({onClick:this.toggleExpanded,title:a.description},{children:[!n&&k(Fr,{svg:this.state.isCollapsed?Hl:Vl},void 0),a.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?v:k(Qs,_({header:this.isUpdate()?"Update ".concat(a==="none"?"":a.name):"Apply ".concat(a==="none"?"":a.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:v}),void 0)},t.prototype.renderSimple=function(){var r,n,a,i=this.getInfo(),o=this.canApply(),s=be("div",_({className:"msp-flex-row"},{children:[k(nr,_({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(a=this.props.simpleApply)===null||a===void 0?void 0:a.header}),void 0),!i.isEmpty&&k(ua,{icon:ap,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):ip,c=this.getSourceAndTarget(),d=c.a,f=c.b,p=c.bCell;return be(At,{children:[s,k(l,{info:i,a:d,b:f,bCell:p,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(ma),Gl=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Bl(function(n){return ip.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var a=r.cells.get(this.props.transform.parent);return a?a.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var a=this.props.state,i=a.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;var o=a.cells.get(i.sourceRef);return n({a:o.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.transform.ref!==a||r.props.state!==i||r.state.params!==r.props.transform.params&&(r._getInfo=Bl(function(o){return ip.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var a=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=a.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(NH);(function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state;r.props.nodeRef!==a||r.plugin.state.data!==i||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,a=r.cells.get(n);if(!a||a.status!=="ok"&&a.status!=="error")return null;var i=a.transform;return k(Gl,{state:r,transform:i,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(ir);var HTe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var a=[],i=0,o=n.structures;i<o.length;i++){var s=o[i],u=s.model;(u==null?void 0:u.unitcell)&&((r=u.unitcell)===null||r===void 0?void 0:r.cell.obj)&&a.push(u.unitcell)}return a.length===0?null:k(FB,{refs:a,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(a,i){var o=a(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(k("div",{children:k(FB,{refs:s,labelMultiple:u},void 0)},i))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return k(At,{children:be("div",_({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(ma),FB=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),!!r.pivot.cell.parent&&ft.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),ft.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var a;n.preventDefault();for(var i=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){i=!1;break}}i&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(a=u.cell.obj)===null||a===void 0?void 0:a.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var a;wd.ObjectEvent.isCell(n,(a=r.pivot)===null||a===void 0?void 0:a.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,a=r.labelMultiple;if(n.length===0)return null;var i=n[0],o,s;if(n.length===1){var u=i.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o="".concat(n.length," ").concat(a||"Objects");return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[be("button",_({className:"msp-form-control msp-control-button-label",title:"".concat(o,". Click to focus."),onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",k("small",{children:s},void 0)]}),void 0),k(Nt,{svg:i.cell.state.isHidden?Dp:Mp,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:"".concat(i.cell.state.isHidden?"Show":"Hide"),small:!0,flex:!0},void 0),n.length===1&&k(Nt,{svg:np,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&i.cell.parent&&k(At,{children:k("div",_({className:"msp-control-offset"},{children:k(Gl,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(ma),GTe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:vA}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:dg.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return be(At,{children:[k(qTe,{},void 0),k(WTe,{},void 0),k(HTe,{},void 0)]},void 0)},t}(Rp),qTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.structures;n.value===null?a.component.clear(i):a.component.applyPreset(i,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return k(Ht,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return Ht.createItems(n,{label:function(a){return a.display.name},category:function(a){return a.display.group},description:function(a){return a.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo ".concat(this.plugin.state.data.latestUndoLabel):"Some mistakes of the past can be undone.";return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[k(ua,{icon:pm,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),k(ua,{icon:qm,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),k(ua,{icon:ap,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),k(Nt,{svg:SA,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&k("div",_({className:"msp-control-offset"},{children:k(UH,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&k("div",_({className:"msp-control-offset"},{children:k(jTe,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(ma),UH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=Md.getAddParams(this.plugin);return{params:r,values:E.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return be(At,{children:[k(bn,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),k(nr,_({icon:qm,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(ma),jTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return k(bn,{params:Md.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(ma),WTe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:k("div",_({style:{marginTop:"6px"}},{children:r.map(function(n){return k(XTe,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(ma),XTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){!n||(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),!!r.props.group[0].cell.parent&&ft.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(a){return a.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),ft.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,a=0,i=r.props.group;a<i.length;a++){var o=i[a];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){wd.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,a,i=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=s_e(this.plugin,(a=this.pivot.cell.obj)===null||a===void 0?void 0:a.data);return Ht.createItemsFromSelectOptions(u,{value:function(l){return function(){return i.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,a=[It([Ht.Header("Add Representation")],Md.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(i){return Ht.Item(i[1],function(){return n.addRepresentation(r.props.group,i[0])})}),!0)];return this.pivot.representations.length>0&&a.push(It([Ht.Header("Set Coloring",{isIndependent:!0})],this.colorByActions,!0)),n.canBeModified(this.props.group[0])&&a.push([Ht.Header("Modify by Selection"),Ht.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:dA}),Ht.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:fA}),Ht.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:pA})]),a.push(Ht.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:A2})),n.canBeModified(this.props.group[0])&&a.push(Ht.Item("Edit Label",this.toggleLabel)),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:"".concat(n.representations.length," reprs")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,a=this.pivot,i=a.cell,o=(n=i.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[be(nr,_({noOverflow:!0,className:"msp-control-button-label",title:"".concat(o,". Click to focus."),onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,k("small",_({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),k(Nt,{svg:i.state.isHidden?Dp:Mp,toggleState:!1,onClick:this.toggleVisible,title:"".concat(i.state.isHidden?"Show":"Hide"," component"),small:!0,className:"msp-form-control",flex:!0},void 0),k(Nt,{svg:gs,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),k(Nt,{svg:np,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&k("div",_({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:k(ps,{label:"Label",control:be("div",_({style:{display:"flex",textAlignLast:"center"}},{children:[k(wl,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),k(Nt,{svg:jm,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&be("div",_({className:"msp-accent-offset"},{children:[k("div",_({style:{marginBottom:"6px"}},{children:k(Ht,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),k("div",_({style:{marginBottom:"6px"}},{children:a.representations.map(function(u){return k(YTe,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(ma),YTe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){wd.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return be("div",_({className:"msp-representation-entry"},{children:[n.parent&&k(Qs,_({header:"".concat(((r=n.obj)===null||r===void 0?void 0:r.label)||""," Representation"),noOffset:!0},{children:k(Gl,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),k(Nt,{svg:gs,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),k(Nt,{svg:this.props.representation.cell.state.isHidden?Dp:Mp,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(ma),U3="measurement-group",e1="measurement-order-label",zH={distanceUnitLabel:E.Text("\u212B",{isEssential:!0}),textColor:zU.textColor},KTe=E.getDefaultValues(zH),QTe=function(e){Pe(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:KTe})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=Kt.findTagInSubtree(r.tree,er.RootRef,U3),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(Ve.Misc.CreateGroup,{label:"Measurements"},{tags:U3})},t.prototype.setOptions=function(r){return se(this,void 0,void 0,function(){var n,a,i,f,o,s,f,u,l,f,c,d,f;return ie(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)f=i[a],n.to(f).update(function(v){v.unitLabel=r.distanceUnitLabel,v.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(v){v.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(v){v.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(v){v.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,ft.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!i||!o?[2]:(s=[i.transform.ref],On(s,o.transform.ref),u=this.getGroup(),u.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:xe.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:xe.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a==null?void 0:a.selectionTags}).apply(Ve.Representation.StructureSelectionsDistance3D,_(_(_({customText:(a==null?void 0:a.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),l=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),!o||!s||!u?[2]:(l=[o.transform.ref],On(l,s.transform.ref),On(l,u.transform.ref),c=this.getGroup(),c.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:xe.toExpression(r)},{key:"b",ref:s.transform.ref,expression:xe.toExpression(n)},{key:"c",ref:u.transform.ref,expression:xe.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:i==null?void 0:i.selectionTags}).apply(Ve.Representation.StructureSelectionsAngle3D,_(_(_({customText:(i==null?void 0:i.customText)||"",textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),d=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return se(this,void 0,void 0,function(){var s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(a.structure),c=this.plugin.helpers.substructureParent.get(i.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],On(d,u.transform.ref),On(d,l.transform.ref),On(d,c.transform.ref),f=this.getGroup(),f.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:xe.toExpression(r)},{key:"b",ref:u.transform.ref,expression:xe.toExpression(n)},{key:"c",ref:l.transform.ref,expression:xe.toExpression(a)},{key:"d",ref:c.transform.ref,expression:xe.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(Ve.Representation.StructureSelectionsDihedral3D,_(_(_({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),p=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:p,tree:f,options:{doNotLogTiming:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return se(this,void 0,void 0,function(){var a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),a?(i=[a.transform.ref],o=this.getGroup(),o.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:xe.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n==null?void 0:n.selectionTags}).apply(Ve.Representation.StructureSelectionsLabel3D,_(_({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)s=r[i],u=this.plugin.helpers.substructureParent.get(s.structure),!!u&&(On(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:xe.toExpression(s)}));return n.length===0?[2]:(l=this.getGroup(),l.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(Ve.Representation.StructureSelectionsOrientation3D),c=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:c,tree:l,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addPlane=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)s=r[i],u=this.plugin.helpers.substructureParent.get(s.structure),!!u&&(On(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:xe.toExpression(s)}));return n.length===0?[2]:(l=this.getGroup(),l.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:a}).apply(Ve.Representation.StructureSelectionsPlane3D),c=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:c,tree:l,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addOrderLabels=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:for(n=this.getGroup(),a=this.plugin.state.data.select(Kt.Generators.ofType(fe.Molecule.Structure.Selections).withTag(e1)),i=0,o=a;i<o.length;i++)s=o[i],n.delete(s);for(u=1,l=0,c=r;l<c.length;l++)d=c[l],f=this.plugin.helpers.substructureParent.get(d.structure),!!f&&(p=[f.transform.ref],n.apply(Ve.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:f.transform.ref,expression:xe.toExpression(d)}],isTransitive:!0,label:"Order"},{dependsOn:p,tags:e1}).apply(Ve.Representation.StructureSelectionsLabel3D,{textColor:$e.fromRgb(255,255,255),borderColor:$e.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:"".concat(u++)},{tags:e1}));return v=this.plugin.state.data,[4,ft.State.Update(this.plugin,{state:v,tree:n,options:{doNotLogTiming:!0}})];case 1:return m.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=Kt.findTagInSubtree(n.tree,er.RootRef,U3),i=a?n.select(Kt.Generators.ofTransformer(r,a)):this._empty;return i.length===0?this._empty:i},t.prototype.sync=function(){for(var r=[],n=0,a=this.getTransforms(Ve.Representation.StructureSelectionsLabel3D);n<a.length;n++){var i=a[n],o=i.obj.tags;(!o||!o.includes(e1))&&r.push(i)}var s=this.updateState({labels:r,distances:this.getTransforms(Ve.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(Ve.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(Ve.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(Ve.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(Ve.Representation.StructureSelectionsPlane3D)});s&&this.stateUpdated()},t}(uc),T2=function(e){Pe(t,e);function t(r,n){n===void 0&&(n={});var a=e.call(this,{props:_(_({},E.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=E.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return Object.defineProperty(t.prototype,"props",{get:function(){return _({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=_(_({},this.state.props),r);uS(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next(void 0))},t}(uc);(function(e){e.Params={granularity:E.Select("residue",Xt.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){o===void 0&&(o={}),this.ctx=i,this.providers=[],this.props=E.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o,s){s===void 0&&(s=!1);var u=i.loci,l=i.repr,c=o?this.props.granularity:void 0;return{loci:Xt.normalize(u,c,s),repr:l}},a.prototype.mark=function(i,o,s){if(s===void 0&&(s=!1),!Xt.isEmpty(i.loci))for(var u=0,l=this.providers;u<l.length;u++){var c=l[u];c(i,o,s)}},a}();e.LociMarkManager=t;var r=function(a){Pe(i,a);function i(){var o=a!==null&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(s){s===void 0&&(s=!1);for(var u=0,l=o.prev;u<l.length;u++){var c=l[u];o.mark(c,wt.RemoveHighlight,s)}o.prev.length=0},o}return i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(Yt.Loci.areEqual(l,o))return!0}return!1},i.prototype.addHighlight=function(o){this.mark(o,wt.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(Xt.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))},i.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(xe.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(Xt.isEmpty(l.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(l)))}},i}(t);e.LociHighlightManager=r;var n=function(a){Pe(i,a);function i(){return a!==null&&a.apply(this,arguments)||this}return i.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!Xt.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);xe.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,wt.Toggle)}},i.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!Xt.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);if(xe.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},i.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);xe.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,wt.Select)},i.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);xe.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,wt.Select)},i.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);xe.is(u.loci)&&(this.deselect({loci:Ne.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,wt.Select)},i.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);xe.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,wt.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:RS},wt.Deselect)},i.prototype.deselectAllOnEmpty=function(o){fi(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;if(!Xt.isEmpty(u))if(xe.is(u)){var l=this.sel.getLoci(u.structure);a.prototype.mark.call(this,{loci:Ne.Loci(u.structure)},wt.Deselect,!Xt.isEmpty(l)),a.prototype.mark.call(this,{loci:l},wt.Select)}else a.prototype.mark.call(this,o,s)},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,wt.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,wt.Select))},i}(t);e.LociSelectManager=n})(T2||(T2={}));function ZTe(e,t){for(var r,n=[],a=t==="auth"?"auth_asym_id":"label_asym_id",i=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp(a),u.asym_id]),"residue-test":ne.core.rel.inRange([ne.ammp(i),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp(a),u.asym_id]),"residue-test":ne.core.logic.and([ne.core.rel.eq([ne.ammp(i),u.seq_id]),ne.core.rel.eq([ne.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=ne.struct.combinator.merge(n);return $f(c)}function $Te(e){for(var t=Vr.create(),r=0,n=e;r<n.length;r++)for(var a=n[r],i=a[0],o=a[1],s=i;s<=o;s++)Vr.add(t,s,s);var u=ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set.apply(ne,t.array),ne.ammp("id")])});return $f(u)}function JTe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function ePe(e){return e?e.split(":"):[]}function tPe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return JTe(t[0],ePe(t[1]),+t[2])}).filter(function(t){return!!t})}function rPe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function nPe(e,t){if(t==="atom-id"){var r=rPe(e);return $Te(r)}else{var r=tPe(e);return ZTe(r,t)}}function aPe(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var wA=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=aPe(this.props.bindings);return k(At,{children:r.map(function(n){var a=n[0],i=n[1];return rr.isEmpty(i)?null:be("div",_({style:{marginBottom:"6px"}},{children:[k("b",{children:i.action},void 0),k("br",{},void 0),k("span",{dangerouslySetInnerHTML:{__html:rr.format(i,a)}},void 0)]}),a)})},void 0)},t.prototype.render=function(){return k(du,{children:this.getBindingComponents()},void 0)},t}(Tt.exports.PureComponent),du=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return k("div",_({className:"msp-help-text"},{children:k("div",{children:this.props.children},void 0)}),void 0)},t}(Tt.exports.PureComponent),vu=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return be("div",_({className:"msp-control-group-wrapper"},{children:[k("div",_({className:"msp-control-group-header"},{children:be(nr,_({onClick:this.toggleExpanded},{children:[k(Fr,{svg:this.state.isExpanded?Vl:Hl},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&k("div",_({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(Tt.exports.PureComponent);function z3(e){return k("div",_({className:"msp-simple-help-section"},{children:e.header}),void 0)}var WE=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var a=n.defaultParams.bindings;a&&Object.assign(r,a)}),be(At,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&k(vu,_({header:"Moving in 3D"},{children:k(wA,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),k(vu,_({header:"Mouse Controls"},{children:k(wA,{bindings:r},void 0)}),"interactions")]},void 0)},t}(ir),iPe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return rr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var a=this.plugin.state.behaviors,i=a.select(Kt.Generators.ofTransformer(r)),o=i.length===1?i[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:rr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(gV,"clickSelectToggle"),n=this.getTriggerFor(ax,"clickFocus");return be("div",{children:[k(z3,{header:"Interface Controls"},void 0),be(vu,_({header:"Inline Help"},{children:[k(du,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),k(du,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),k(vu,_({header:"Selections"},{children:be(du,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",be("ul",_({style:{paddingLeft:"20px"}},{children:[be("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",k("i",{children:"Mouse Controls"},void 0),")"]},void 0),be("li",{children:["using the ",k("i",{children:"Add"},void 0),", ",k("i",{children:"Remove"},void 0)," and ",k("i",{children:"Only"},void 0)," dropdown buttons in the ",k("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),k(vu,_({header:"Coloring"},{children:be(du,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",k("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",k("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",k("i",{children:"Selection"},void 0)," row of the ",k("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),k(vu,_({header:"Representations"},{children:be(du,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",k("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",k("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",k("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",k("i",{children:"Show"},void 0)," and ",k("i",{children:"Hide"},void 0)," dropdown bottons in the ",k("i",{children:"Selection"},void 0)," row of the ",k("i",{children:"Change Representation"},void 0)," panel. The ",k("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),k(vu,_({header:"Surroundings"},{children:be(du,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),k(z3,{header:"How-to Guides"},void 0),k(vu,_({header:"Create an Image"},{children:be(du,{children:[be("p",{children:["Use the ",k(Fr,{svg:A4e},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),be("p",{children:["To adjust the size of the image, use the ",k("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),k(z3,{header:"Mouse Controls"},void 0),k(WE,{},void 0)]},void 0)},t}(ir),P2=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return k(Nt,{svg:TAe,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(ma),oPe={granularity:T2.Params.granularity},$p=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),sPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,a){r.plugin.managers.structure.selection.fromSelectionQuery(n,a,!1)},r.selectQuery=function(n,a){if(!n||!r.state.action){r.setState({action:void 0});return}var i=r.state.action;(a==null?void 0:a.shiftKey)?r.set(i,n.value):r.setState({action:void 0},function(){r.set(i,n.value)})},r.selectHelper=function(n,a){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var a=n.value;r.plugin.managers.interactivity.setProps({granularity:a})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),a=[],i=0,o=n;i<o.length;i++){var s=o[i];a.push.apply(a,s.components)}a.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(a,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.hierarchy.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var a=n.state;r.setState({canUndo:a.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],a=0,i=this.plugin.managers.structure.hierarchy.selection.structures;a<i.length;a++){var o=i[a],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,a=It(It(It(It([],r.list,!0),x1e(n),!0),S1e(n),!0),b1e(n),!0).sort(function(i,o){return o.priority-i.priority});this.queriesItems=Ht.createItems(a,{filter:function(i){return i!==Hn.current&&!i.isHidden},label:function(i){return i.label},category:function(i){return i.category},description:function(i){return i.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=Ht.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,a=this.state.canUndo?"Undo ".concat(this.plugin.state.data.latestUndoLabel):"Some mistakes of the past can be undone.",i=void 0;if(this.state.action&&!this.state.helper)i=be(At,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&be("div",_({className:"msp-selection-viewport-controls-actions"},{children:[k(Ht,{header:$p.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),k(Ht,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&k("div",_({className:"msp-selection-viewport-controls-actions"},{children:k(hl,_({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:ml},{children:k(lPe,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&k("div",_({className:"msp-selection-viewport-controls-actions"},{children:k(hl,_({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:ml},{children:k(UH,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&k("div",_({className:"msp-selection-viewport-controls-actions"},{children:be(hl,_({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:ml,maxHeight:"300px"},{children:[k(vu,_({header:"Selection Operations"},{children:be(du,{children:["Use ",k(Fr,{svg:dA,inline:!0},void 0)," ",k(Fr,{svg:fA,inline:!0},void 0)," ",k(Fr,{svg:pA,inline:!0},void 0)," ",k(Fr,{svg:A2,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),k(vu,_({header:"Representation Operations"},{children:be(du,{children:["Use ",k(Fr,{svg:mA,inline:!0},void 0)," ",k(Fr,{svg:vA,inline:!0},void 0)," ",k(Fr,{svg:bA,inline:!0},void 0)," ",k(Fr,{svg:SA,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),k(WE,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if($p.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};i=k("div",_({className:"msp-selection-viewport-controls-actions"},{children:k(hl,_({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:ml},{children:k(dPe,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return be(At,{children:[be("div",_({className:"msp-flex-row",style:{background:"none"}},{children:[k(cv,{title:"Picking Level for selecting and highlighting",param:oPe.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),k(ua,{icon:dA,title:"".concat($p.get("add"),". Hold shift key to keep menu open."),toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),k(ua,{icon:fA,title:"".concat($p.get("remove"),". Hold shift key to keep menu open."),toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),k(ua,{icon:pA,title:"".concat($p.get("intersect"),". Hold shift key to keep menu open."),toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),k(ua,{icon:A2,title:"".concat($p.get("set"),". Hold shift key to keep menu open."),toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),k(ua,{icon:mA,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),k(ua,{icon:vA,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),k(Nt,{svg:bA,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),k(Nt,{svg:SA,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:a},void 0),k(ua,{icon:ku,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),k(Nt,{svg:UE,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),i]},void 0)},t}(ir),uPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(a){r.plugin.managers.interactivity.lociHighlights.highlight({loci:a.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var a=n.structures.length===0;r.state.isEmpty!==a&&r.setState({isEmpty:a})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":"".concat(jc(r.label)," Selected")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:k(At,{children:be("div",_({className:"msp-flex-row"},{children:[k(nr,_({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&k(Nt,{svg:UE,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(ir),lPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=Bl(function(n){return Md.getThemeParams(r.plugin,n)}),r.state={values:E.getDefaultValues(r.params)},r.apply=function(){var n,a;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(a=(n=r.props).onApply)===null||a===void 0||a.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return be(At,{children:[k(bn,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),k(nr,_({icon:mA,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(ma),VH={idType:E.Select("auth",E.arrayToOptions(["auth","label","atom-id"])),identifiers:E.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},cPe=E.getDefaultValues(VH);function dPe(e){var t=e.modifier,r=e.plugin,n=e.close,a=Tt.exports.useState(cPe),i=a[0],o=a[1],s=function(){if(i.identifiers.trim().length!==0)try{n();var u=nPe(i.identifiers,i.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){console.error(l),r.log.error("Failed to create selection")}};return be(At,{children:[k(bn,{params:VH,values:i,onChangeValues:o,onEnter:s},void 0),be(nr,_({className:"msp-btn-commit msp-btn-commit-on",disabled:i.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[Pm(t)," Selection"]}),void 0)]},void 0)}var fPe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:a4e}}},t.prototype.renderControls=function(){return be(At,{children:[k(vPe,{},void 0),k(pPe,{},void 0)]},void 0)},t}(Rp),pPe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var a=[],i=0,o=r;i<o.length;i++){var s=o[i];s.obj&&a.push(k(hPe,{cell:s},s.obj.id))}return a.length?k(Qs,_({header:n,initiallyExpanded:!0},{children:a}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return be("div",_({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals"),this.renderGroup(r.orientations,"Orientations"),this.renderGroup(r.planes,"Planes")]}),void 0)},t}(ma),vPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.addOrientation=function(){var n=[];r.plugin.managers.structure.selection.entries.forEach(function(a){n.push(a.selection)}),r.plugin.managers.structure.measurement.addOrientation(n)},r.addPlane=function(){var n=[];r.plugin.managers.structure.selection.entries.forEach(function(a){n.push(a.selection)}),r.plugin.managers.structure.measurement.addPlane(n)},r.selectAction=function(n){r.toggleAdd(),!!n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate(),r.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},t.prototype.componentWillUnmount=function(){this.clearOrderLabels(),e.prototype.componentWillUnmount.call(this)},t.prototype.componentDidUpdate=function(r,n){this.state.action!==n.action&&this.updateOrderLabels()},t.prototype.clearOrderLabels=function(){this.plugin.managers.structure.measurement.addOrderLabels([])},t.prototype.updateOrderLabels=function(){if(this.state.action!=="add"){this.clearOrderLabels();return}for(var r=[],n=this.selection.additionsHistory,a=0;a<n.length&&a<4;a++)r.push(n[a].loci);this.plugin.managers.structure.measurement.addOrderLabels(r)},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label ".concat(r.length===0?" (1 selection item required)":" (1st selection item)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance ".concat(r.length<2?" (2 selection items required)":" (top 2 selection items)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle ".concat(r.length<3?" (3 selection items required)":" (top 3 items)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral ".concat(r.length<4?" (4 selection items required)":" (top 4 selection items)"),value:this.measureDihedral,disabled:r.length<4},{kind:"item",label:"Orientation ".concat(r.length===0?" (selection required)":" (current selection)"),value:this.addOrientation,disabled:r.length===0},{kind:"item",label:"Plane ".concat(r.length===0?" (selection required)":" (current selection)"),value:this.addPlane,disabled:r.length===0}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return be("div",_({className:"msp-flex-row",onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:function(){return a.plugin.managers.interactivity.lociHighlights.clearHighlights()}},{children:[be(nr,_({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"}},{children:[n,". ",k("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&k(Nt,{svg:mx,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&k(Nt,{svg:vx,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),k(Nt,{svg:gs,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],a=0,i=Math.min(r.length,4);a<i;a++)n.push(this.historyEntry(r[a],a+1));return be(At,{children:[k(Ht,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&k("div",_({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&k("div",_({className:"msp-control-offset msp-help-text"},{children:be("div",_({className:"msp-help-description"},{children:[k(Fr,{svg:ku,inline:!0},void 0),"Add one or more selections (toggle ",k(P2,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[k(ua,{icon:qm,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),k(ua,{icon:ap,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&k(mPe,{},void 0)]},void 0)},t}(ma),mPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return k("div",_({className:"msp-control-offset"},{children:k(bn,{params:zH,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(ma),hPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){ft.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),ft.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,a=r.selections;if(!!a){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var i=0,o=r.lociArray;i<o.length;i++){var s=o[i];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(!!n){var a=Xt.getBundleBoundingSphere({loci:r.lociArray});a&&r.plugin.managers.camera.focusSphere(a)}},r.selectAction=function(n){!n||(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:r.locis?r.locis:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?Jf(r.infos[0].loci,{condensed:!0}):r.pairs?WS(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?XS(r.triples[0],{condensed:!0}):r.quads?YS(r.quads[0],{condensed:!0}):r.locis?kg(r.locis,{countsOnly:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[Ht.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:A2})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?be(At,{children:[be("div",_({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[k("button",_({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:k("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),k(Nt,{svg:r.state.isHidden?Dp:Mp,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),k(Nt,{svg:gs,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),k(Nt,{svg:np,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&k(At,{children:be("div",_({className:"msp-accent-offset"},{children:[k(Ht,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),k(Qs,_({header:"Options",noOffset:!0},{children:k(Gl,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(ma);function V3(e,t,r,n){for(var a=ze.indexOf(t.unit.elements,t.element),i=xe(t.structure,[{unit:t.unit,indices:Ee.ofSingleton(a)}]),o=n==="residue"?xe.extendToWholeResidues(i):xe.extendToWholeChains(i),s=tt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=xe(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=Jf(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=Jf(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | ".concat(d.elements[0].unit.conformation.operator.name));var p={label:f,category:s,loci:d};e.has(s)?e.get(s).push(p):e.set(s,[p])}}function gPe(e){for(var t=new Map,r=He.create(e),n=0,a=e.unitSymmetryGroups;n<a.length;n++){var i=a[n];if(!!Be.isAtomic(i.units[0])){r.unit=i.units[0],r.element=i.elements[0];var o=Be.Traits.is(r.unit.traits,1),s=tt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!tt.entity.prd_id(r);if(c)V3(t,r,i,"chain");else if(u&&!o)V3(t,r,i,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,p=-1,v=0,m=d.elements.length;v<m;++v){var h=d.elements[v],g=f[h];g!==p&&(r.element=h,V3(t,r,i,"residue"),p=g)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:"".concat(S,": ").concat(b[0].label),loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var yPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=Bl(function(n){for(var a,i=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(a=u.cell.obj)===null||a===void 0?void 0:a.data;if(l){var c=gPe(l);c.length>0&&i.push(It([Ht.Header(l.label,{description:l.label})],Ht.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}}),!0))}}return i}),r.selectAction=function(n,a){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var i=n.value;(a==null?void 0:a.shiftKey)?r.plugin.managers.structure.focus.addFromLoci(i.loci):r.plugin.managers.structure.focus.set(i),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(It([Ht.Header("History",{description:"Previously focused on items."})],Ht.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?"".concat(u.category," | ").concat(u.label):u.label}}),!0));var a=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(a.length===1){var i=a[0],o=i[0];o.initiallyExpanded=!0}var s=[];return a.length>0&&s.push.apply(s,a),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(ax.id);if(!n)return"";var a=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!a||rr.isEmpty(a)?"":rr.formatTriggers(a)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",a="Click to Center Camera";if(!r){a="Select focus using the menu";var i=this.getToggleBindingLabel();i&&(a+=`
or use '`.concat(i,"' on element"))}return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[k(nr,_({noOverflow:!0,onClick:this.focusCamera,title:a,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&k(Nt,{svg:UE,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),k(ua,{icon:I4e,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&k(Ht,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(ir),bPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i,o,s,u,l,c,d,f,p=r.plugin.managers.structure.hierarchy.seletionSet,v;switch(n.kind){case"model":{var m=(a=n.cell.obj)===null||a===void 0?void 0:a.data;m&&zt.TrajectoryInfo.get(m).size>1&&(v="".concat((i=n.cell.obj)===null||i===void 0?void 0:i.data.entryId," | Model ").concat(zt.TrajectoryInfo.get(m).index+1," of ").concat(zt.TrajectoryInfo.get(m).size)),v="".concat((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId," | ").concat((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var m=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(m&&zt.TrajectoryInfo.get(m).size>1){v="".concat(m.entryId," | ").concat((l=n.cell.obj)===null||l===void 0?void 0:l.label," (Model ").concat(zt.TrajectoryInfo.get(m).index+1," of ").concat(zt.TrajectoryInfo.get(m).size,")");break}else if(m){v="".concat(m.entryId," | ").concat((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{v="".concat((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:v=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var h={kind:"item",label:v||n.kind,selected:p.has(n.cell.transform.ref),value:[n]};return h},r.getTrajectoryItems=function(n){var a;return n.models.length===0?r.item(n):It([Ht.Header((a=n.cell.obj)===null||a===void 0?void 0:a.label)],n.models.map(r.getModelItems),!0)},r.getModelItems=function(n){var a,i,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:"".concat((a=n.cell.obj)===null||a===void 0?void 0:a.label," | ").concat((i=u.cell.obj)===null||i===void 0?void 0:i.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return It([Ht.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item),!0)},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var a=[],i=0,o=n;i<o.length;i++)for(var s=o[i],u=0,l=s.value;u<l.length;u++){var c=l[u];a.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(a,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var a=r.plugin.managers.structure,i=a.hierarchy.selection.trajectories;a.hierarchy.applyPreset(i,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var a=r.plugin.managers.structure.hierarchy.selection,i=a.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(i,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:J_e}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,a=[];return n.trajectories.length>1&&a.push(It([Ht.Header("Trajectories")],n.trajectories.map(this.item),!0)),(n.models.length>1||n.trajectories.length>1)&&a.push(It([Ht.Header("Models")],n.models.map(this.item),!0)),n.trajectories.length===1&&n.models.length===1?a.push.apply(a,n.structures.map(this.item)):n.structures.length>0&&a.push(It([Ht.Header("Structures")],n.structures.map(this.item),!0)),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,a=r.models,i=r.trajectories;return i.length===0&&a.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,a,i,o,s,u,l,c,d,f,p,v,m,h=this.plugin.managers.structure.hierarchy.selection,g=h.structures,y=h.models,b=h.trajectories;if(g.length===1){var S=g[0];return((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0?void 0:n.models)&&S.model.trajectory.models.length===1?(a=S.cell.obj)===null||a===void 0?void 0:a.data.label:S.model?"".concat((i=S.model.cell.obj)===null||i===void 0?void 0:i.label," | ").concat((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var C=g[0],x=(u=C==null?void 0:C.model)===null||u===void 0?void 0:u.trajectory,A=!0,P=0,T=g;P<T.length;P++){var S=T[P];if(((l=S==null?void 0:S.model)===null||l===void 0?void 0:l.trajectory)!==x){A=!1;break}}return A&&x?"".concat((c=x.cell.obj)===null||c===void 0?void 0:c.label," | ").concat(g.length," structures"):"".concat(g.length," structures")}if(y.length>0){var x=y[0].trajectory;if(y.length===1){var D=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return D&&zt.TrajectoryInfo.get(D).size>1?"".concat((f=x==null?void 0:x.cell.obj)===null||f===void 0?void 0:f.label," | Model ").concat(zt.TrajectoryInfo.get(D).index+1," of ").concat(zt.TrajectoryInfo.get(D).size):"".concat((p=x==null?void 0:x.cell.obj)===null||p===void 0?void 0:p.label," | Model")}for(var A=!0,I=0,M=y;I<M.length;I++){var B=M[I];if(B.trajectory!==x){A=!1;break}}return A?"".concat((v=x==null?void 0:x.cell.obj)===null||v===void 0?void 0:v.label," | ").concat(y.length," models"):"".concat(y.length," models")}return b.length>0?b.length===1?"".concat((m=b[0].cell.obj)===null||m===void 0?void 0:m.label," trajectory"):"".concat(b.length," trajectories"):b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var a=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var i=new Set(a),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||i.delete(d)}a=a.filter(function(v){return i.has(v)})}for(var f=0,p=a;f<p.length;f++){var d=p[f];r.push(Ht.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return se(this,void 0,void 0,function(){var r,n,a;return ie(this,function(i){switch(i.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,i.label=1;case 1:return i.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,a=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,a.cell.transform.ref,r,"Model Index")];case 2:return i.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return null;var i=a.structures[0].model;if(!i||i.cell.transform.transformer!==Ve.Model.ModelFromTrajectory||!i.cell.obj||zt.TrajectoryInfo.get(i.cell.obj.data).size<=1)return null;var o=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return o?k(bn,{params:o,values:(n=i.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var a=n.structures[0],i=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return!i||!a.cell.parent?null:k(Gl,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var a=Kt.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,Ve.Model.TransformStructureConformation);if(!!a)return k(Qs,_({header:"Conformation Transform"},{children:k(Gl,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,a=this.label;return be(At,{children:[be("div",_({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[k(nr,_({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:a},{children:a}),void 0),n.length>0&&k(Nt,{svg:pm,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&k(Ht,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&k(Ht,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,be("div",_({style:{marginTop:"6px"}},{children:[k(yPe,{},void 0),k(uPe,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(Rp);function SPe(e,t){var r=_Pe(e,t||XE());return IPe(e.tree,r),t&&t.refs.forEach(PPe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function XE(){return{volumes:[],lazyVolumes:[],refs:new Map}}function xPe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function CPe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function wPe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function _Pe(e,t){return{state:e,oldHierarchy:t,hierarchy:XE(),changed:!1,added:new Set}}function H3(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function APe(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function NB(){}var TPe=[[APe(fe.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=H3(e,t,e.hierarchy.volumes,xPe,t)},function(e){return e.currentVolume=void 0}],[function(e){return fe.Volume.Lazy.is(e.obj)},function(e,t){H3(e,t,e.hierarchy.lazyVolumes,CPe,t)},NB],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&fe.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&H3(e,t,e.currentVolume.representations,wPe,t,e.currentVolume),!1},NB]];function HH(e){if(!e||!(e==null?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===pn.Null||e.status!=="ok"&&e.status!=="error")}function PPe(e){var t=e.cell;HH(t)||(this.changed=!0)}function EPe(e){GH(this,this.tree.transforms.get(e))}function GH(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!HH(n)){for(var a=void 0,i=!1,o=0,s=TPe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){i=!0;break}a=d;break}}if(!i){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(EPe,e),a&&a(r)}}}function IPe(e,t){var r={tree:e,state:t};return GH(r,e.root),r.state}function zv(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?DPe(e,t||ht.One,r):qH(e,t||ht.One,r)}function DPe(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return qH(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function qH(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=E.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),l=E.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(l,i.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),f=E.getDefaultValues(d.getParams(a));d.name===i.defaultSizeTheme.name&&Object.assign(f,i.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var E2=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:XE(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=SPe(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection?this.state.selection=a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0]:this.state.selection=a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];tp(this.dataState,s.cell.transform.ref,a)}},t.prototype.addRepresentation=function(r,n){var a,i=this.dataState.build().to(r.cell).apply(Ve.Representation.VolumeRepresentation3D,zv(this.plugin,(a=r.cell.obj)===null||a===void 0?void 0:a.data,{type:n}));return i.commit({canUndo:"Add Representation"})},t}(Fg);(function(e){function t(r,n){var a,i;return((a=n==null?void 0:n.cell.obj)===null||a===void 0?void 0:a.data)?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(E2||(E2={}));var YE=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Bl(function(n,a){return ip.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return ft.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var a=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&a===n.version)return null;var i=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?E.getDefaultValues(r.action.definition.params(i,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:a,params:o,isInitial:!0,error:void 0};return s},t}(NH),MPe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:bH}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:dg.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){er.hasTag(n.cell.transform,ui.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,a=this.plugin.managers.structure.hierarchy.selection;if(a.structures.length!==1)return!1;var i=this.pivot.cell;return i.obj?!!((n=(r=E4.definition).isApplicable)===null||n===void 0?void 0:n.call(r,i.obj,i.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n,a=this.pivot;if(!a.cell.parent)return null;var i=Kt.findTagInSubtree(a.cell.parent.tree,this.pivot.cell.transform.ref,ui.RootTag),o=i&&a.cell.parent.cells.get(i),s=o&&o.status==="error"?{header:!!o.errorText&&((r=o.errorText)===null||r===void 0?void 0:r.includes("404"))?"No Density Data Available":"Error Enabling",icon:bB,title:o.errorText}:o&&((n=o.obj)===null||n===void 0?void 0:n.data.entries.length)===0?{header:"Error Enabling",icon:bB,title:"No Entry for Streaming Found"}:{header:"Enable",icon:jm,title:"Enable"};return k(YE,{state:a.cell.parent,action:E4,initiallyCollapsed:!0,nodeRef:a.cell.transform.ref,simpleApply:s},void 0)},t.prototype.renderParams=function(){var r,n,a,i,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(i=(a=this.plugin.state.behaviors.cells.get(ax.id))===null||a===void 0?void 0:a.params)===null||i===void 0?void 0:i.values)===null||o===void 0?void 0:o.bindings);return be(At,{children:[k(Gl,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&k(Qs,_({header:"Controls Help"},{children:k(wA,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(Rp),RPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var a,i=r.plugin.managers.volume.hierarchy.selection,o=((a=n.cell.obj)===null||a===void 0?void 0:a.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:i===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var a=n.value;a.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(a):r.lazyLoad(a.cell)}},r.selectAdd=function(n){!n||(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:bH}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,a=[],i=0,o=n.volumes;i<o.length;i++){var s=o[i];a.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];a.push(this.item(s))}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,a=It([],E2.getRepresentationTypes(this.plugin,n).map(function(i){return Ht.Item(i[1],function(){return r.addRepresentation(n,i[0])})}),!0);return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,a=r.lazyVolumes;return n.length===0&&a.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading ".concat(this.state.loadingLabel,"...");var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c=this;return ie(this,function(d){switch(d.label){case 0:n=r.obj.data,a=n.url,i=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return se(c,void 0,void 0,function(){var f,p,v,m,h,g,y,b,S,C,x;return ie(this,function(A){switch(A.label){case 0:return[4,l.builders.data.download({url:a,isBinary:i},{state:{isGhost:!0}})];case 1:return f=A.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(p=A.sent(),v=p.volume||p.volumes[0],!(v==null?void 0:v.isOk))throw new Error("Failed to parse any volume.");for(m=l.build(),h=0,g=u;h<g.length;h++)y=g[h],m.to((C=(b=p.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&C!==void 0?C:p.volume).apply(Ve.Representation.VolumeRepresentation3D,zv(this.plugin,v.data,{type:"isosurface",typeParams:{alpha:(x=y.alpha)!==null&&x!==void 0?x:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,m.commit()];case 3:return A.sent(),[4,l.build().delete(r).commit()];case 4:return A.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,a=this.plugin.managers.volume.hierarchy.selection;return be(At,{children:[be("div",_({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[k(nr,_({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&a&&k(Nt,{svg:qm,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&k(Ht,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&k(Ht,{items:this.addActions,onSelect:this.selectAdd},void 0),a&&a.representations.length>0&&k("div",_({style:{marginTop:"6px"}},{children:a.representations.map(function(i){return k(OPe,{representation:i},i.cell.transform.ref)})}),void 0)]},void 0)},t}(Rp),OPe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),!!r.props.representation.cell.parent&&ft.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),ft.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,a=r.props.representation,i=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;a.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(i,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){wd.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,a,i=this.props.representation.cell;return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[be(nr,_({noOverflow:!0,className:"msp-control-button-label",title:"".concat((r=i.obj)===null||r===void 0?void 0:r.label,". Click to focus."),onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=i.obj)===null||n===void 0?void 0:n.label,k("small",_({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(a=i.obj)===null||a===void 0?void 0:a.description}),void 0)]}),void 0),k(Nt,{svg:i.state.isHidden?Dp:Mp,toggleState:!1,onClick:this.toggleVisible,title:"".concat(i.state.isHidden?"Show":"Hide"," component"),small:!0,className:"msp-form-control",flex:!0},void 0),k(Nt,{svg:gs,onClick:this.remove,title:"Remove",small:!0},void 0),k(Nt,{svg:np,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!i.parent&&k("div",_({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:k(Gl,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(ma),I2;(function(e){function t(n){return{size:n,matrix:mr.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){BPe(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(I2||(I2={}));function BPe(e,t,r,n,a){for(var i=0;i<e;i++)a[i]=0;for(var o=e-1,i=0;i<e;i++)n[i]=t[i*e+o];kPe(t,n,a,e),LPe(t,n,a,e);for(var i=0;i<e;i++)r[i]=n[i]}function kPe(e,t,r,n){for(var a=n-1;a>0;a--){for(var i=0,o=0,s=0;s<a;s++)i=i+Math.abs(t[s]);if(i===0){r[a]=t[a-1];for(var u=0;u<a;u++)t[u]=e[u*n+a-1],e[u*n+a]=0,e[a*n+u]=0}else{for(var s=0;s<a;s++)t[s]/=i,o+=t[s]*t[s];var l=t[a-1],c=Math.sqrt(o);l>0&&(c=-c),r[a]=i*c,o=o-l*c,t[a-1]=l-c;for(var u=0;u<a;u++)r[u]=0;for(var u=0;u<a;u++){l=t[u],e[a*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=a-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<a;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<a;u++)r[u]-=d*t[u];for(var u=0;u<a;u++){l=t[u],c=r[u];for(var s=u;s<=a-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+a-1],e[u*n+a]=0}}t[a]=o}for(var a=0;a<n-1;a++){e[a*n+n-1]=e[a*n+a],e[a*n+a]=1;var o=t[a+1];if(o!==0){for(var s=0;s<=a;s++)t[s]=e[(a+1)*n+s]/o;for(var u=0;u<=a;u++){for(var c=0,s=0;s<=a;s++)c+=e[(a+1)*n+s]*e[u*n+s];for(var s=0;s<=a;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=a;s++)e[(a+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function LPe(e,t,r,n){for(var a=1e3,i=1;i<n;i++)r[i-1]=r[i];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],p=(t[l+1]-f)/(2*r[l]),v=UB(p,1);p<0&&(v=-v),t[l]=r[l]/(p+v),t[l+1]=r[l]*(p+v);for(var m=t[l+1],h=f-t[l],i=l+2;i<n;i++)t[i]-=h;o=o+h,p=t[c];for(var g=1,y=g,b=g,S=r[l+1],C=0,x=0,i=c-1;i>=l;i--){b=y,y=g,x=C,f=g*r[i],h=g*p,v=UB(p,r[i]),r[i+1]=C*v,C=r[i]/v,g=p/v,p=g*t[i]-C*f,t[i+1]=h+C*(g*f+C*t[i]);for(var A=0;A<n;A++)h=e[(i+1)*n+A],e[(i+1)*n+A]=C*e[i*n+A]+g*h,e[i*n+A]=g*e[i*n+A]-C*h}if(p=-C*x*b*S*r[l]/m,r[l]=C*p,t[l]=g*p,d>=a)throw new Error("SVD: Not converging.")}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var i=0;i<n-1;i++){for(var A=i,p=t[i],P=i+1;P<n;P++)t[P]<p&&(A=P,p=t[P]);if(A!==i){t[A]=t[i],t[i]=p;for(var P=0;P<n;P++)p=e[i*n+P],e[i*n+P]=e[A*n+P],e[A*n+P]=p}}}function UB(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var ql;(function(e){(function(r){function n(a){return{x:new Float64Array(a),y:new Float64Array(a),z:new Float64Array(a)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n=="undefined"&&(n={bTransform:oe.zero(),rmsd:0}),zPe(new FPe(r,n)),n}e.compute=t})(ql||(ql={}));var FPe=function(){function e(t,r){this.evdCache=I2.createCache(4),this.translateB=oe.identity(),this.rotateB=oe.identity(),this.tempMatrix=oe.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=Ml.fromArrays(t.a,Me()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=Ml.fromArrays(t.b,Me()).center,this.result=r}return e}();function NPe(e){var t=e.evdCache.matrix;mr.makeZero(t);for(var r=e.a.x,n=e.a.y,a=e.a.z,i=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var p=r[d]-u[0],v=n[d]-u[1],m=a[d]-u[2],h=i[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=p*p+v*v+m*m+h*h+g*g+y*y,mr.add(t,0,0,p*h+v*g+m*y),mr.add(t,0,1,-(m*g)+v*y),mr.add(t,0,2,m*h-p*y),mr.add(t,0,3,-(v*h)+p*g),mr.add(t,1,0,-(m*g)+v*y),mr.add(t,1,1,p*h-v*g-m*y),mr.add(t,1,2,v*h+p*g),mr.add(t,1,3,m*h+p*y),mr.add(t,2,0,m*h-p*y),mr.add(t,2,1,v*h+p*g),mr.add(t,2,2,-(p*h)+v*g-m*y),mr.add(t,2,3,m*g+v*y),mr.add(t,3,0,-(v*h)+p*g),mr.add(t,3,1,m*h+p*y),mr.add(t,3,2,m*g+v*y),mr.add(t,3,3,-(p*h)-v*g+m*y)}return c}function UPe(e){var t=e.evdCache.matrix,r=mr.get(t,1,3),n=mr.get(t,2,3),a=mr.get(t,3,3),i=mr.get(t,0,3),o=2*n*n,s=2*a*a,u=2*r*r,l=2*r*n,c=2*i*a,d=2*r*a,f=2*i*n,p=2*n*a,v=2*i*r,m=e.translateB;oe.setValue(m,0,3,-e.centerB[0]),oe.setValue(m,1,3,-e.centerB[1]),oe.setValue(m,2,3,-e.centerB[2]),m=e.rotateB,oe.setValue(m,0,0,1-o-s),oe.setValue(m,0,1,l+c),oe.setValue(m,0,2,d-f),oe.setValue(m,1,0,l-c),oe.setValue(m,1,1,1-u-s),oe.setValue(m,1,2,p+v),oe.setValue(m,2,0,d+f),oe.setValue(m,2,1,p-v),oe.setValue(m,2,2,1-u-o),oe.setValue(m,3,3,1),oe.mul(e.tempMatrix,e.rotateB,e.translateB),m=e.translateB,oe.setValue(m,0,3,e.centerA[0]),oe.setValue(m,1,3,e.centerA[1]),oe.setValue(m,2,3,e.centerA[2]),oe.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function zPe(e){var t=NPe(e);I2.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),UPe(e),e.result.rmsd=r}var VPe="ACDEFGHIKLMNPQRSTVWY",HPe="ARNDCQEGHILKMFPSTWYVBZX",GPe=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],qPe=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function zB(e,t){var r,n=0,a={};return t.forEach(function(i){r=0;var o={};i.forEach(function(s){return o[e[r++]]=s}),a[e[n++]]=o}),a}var jPe=function(){return{blosum62:zB(HPe,qPe),blosum62x:zB(VPe,GPe)}}(),WPe={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function XPe(e,t,r){r===void 0&&(r={});var n=_(_({},WPe),r),a=new YPe(e,t,n);return a.calculate(),a.trace()}var YPe=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:jPe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,a=t.gapPenalty,i=t.S,o=t.V,s=t.H,u=0;u<=r;++u){i[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)i[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)i[u][0]=a,s[u][0]=-1/0;for(var l=0;l<=n;++l)i[0][l]=a,o[0][l]=-1/0;i[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,a=t.substMatrix;return a?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=a[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,p,v,m=1;m<=o;++m){d=i[m-1],c=n[m-1],f=n[m],p=a[m],v=i[m];for(var h=1;h<=s;++h)f[h]=Math.max(d[h]+l,c[h]+u),p[h]=Math.max(v[h-1]+l,p[h-1]+u),v[h]=Math.max(d[h-1]+t(m-1,h-1),f[h],p[h])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,a=r.H,i=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,p,v="",m="";for(i[c][d]>=n[c][d]?(f="S",p=i[c][d]):n[c][d]>=a[c][d]?(f="V",p=n[c][d]):(f="H",p=a[c][d]);c>0&&d>0;)f==="S"?i[c][d]===i[c-1][d-1]+t(c-1,d-1)?(v=o[c-1]+v,m=s[d-1]+m,--c,--d,f="S"):i[c][d]===n[c][d]?f="V":i[c][d]===a[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(v=o[c-1]+v,m="-"+m,--c,f="V"):n[c][d]===i[c-1][d]+l?(v=o[c-1]+v,m="-"+m,--c,f="S"):--c:f==="H"&&(a[c][d]===a[c][d-1]+u?(v="-"+v,m=s[d-1]+m,--d,f="H"):a[c][d]===i[c][d-1]+l?(v="-"+v,m=s[d-1]+m,--d,f="S"):--d);for(;c>0;)v=o[c-1]+v,m="-"+m,--c;for(;d>0;)v="-"+v,m=s[d-1]+m,--d;return{aliA:v,aliB:m,score:p}},e}(),_A;(function(e){function t(n){var a=new Map;if(Be.isAtomic(n.unit))for(var i=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Ee.size(n.indices);s<u;++s){var l=Ee.getAt(n.indices,s),c=n.unit.elements[l],d=i.value(o[c]);a.has(d)?a.get(d).push(l):a.set(d,[l])}else if(Be.isCoarse(n.unit))for(var f=(Be.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Ee.size(n.indices);s<u;++s){var l=Ee.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);a.set(d,[l])}return a}function r(n,a){a===void 0&&(a={});for(var i=VB(n.a.unit),o=VB(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=XPe(i.code.toArray(),o.code.toArray(),a),f=d.aliA,p=d.aliB,v=d.score,m=0,h=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||p[g]==="-"){f[g]!=="-"&&(m+=1),p[g]!=="-"&&(h+=1);continue}var b=i.seqId.value(m),S=o.seqId.value(h);if(s.has(b)&&u.has(S))for(var C=s.get(b),x=u.get(S),A=0,P=Math.min(C.length,x.length);A<P;++A)l.push(C[A]),c.push(x[A]);m+=1,h+=1}var T=Ee.intersect(Ee.ofSortedArray(l),n.a.indices),D=Ee.intersect(Ee.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:T},b:{unit:n.b.unit,indices:D},score:v}}e.compute=r})(_A||(_A={}));function KPe(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function VB(e){return e.model.sequence.byEntityKey[KPe(e)].sequence}function HB(e){var t=[];if(e.length<=0)return t;var r=$Pe(e),n={a:w0(e[0],r),b:w0(e[1],r)};t[0]=ql.compute(n);for(var a=2;a<e.length;a++)n.b=w0(e[a],r),n.centerB=void 0,t.push(ql.compute(n));return t}var QPe=/(polypeptide|cyclic-pseudo-peptide)/i;function ZPe(e){var t=[];if(e.length<=0)return t;for(var r=xe.getFirstLocation(e[0]),n=tt.entity.subtype(r),a=n.match(QPe)?"blosum62":"default",i=1;i<e.length;i++){var o=_A.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:a}),s=o.a,u=o.b,l=o.score,c=xe(e[0].structure,[s]),d=xe(e[i].structure,[u]),f=Ee.size(s.indices);t.push(_(_({},ql.compute({a:w0(c,f),b:w0(d,f)})),{alignmentScore:l}))}return t}function w0(e,t){for(var r=ql.Positions.empty(t),n=0,a=0,i=e.elements;a<i.length;a++){for(var o=i[a],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,p=c.z,v=0,m=Ee.size(u);v<m;v++){var h=l[Ee.getAt(u,v)];if(r.x[n]=d(h),r.y[n]=f(h),r.z[n]=p(h),n++,n>=t)break}if(n>=t)break}return r}function $Pe(e){if(e.length===0)return 0;for(var t=xe.size(e[0]),r=1;r<e.length;r++){var n=xe.size(e[r]);n<t&&(t=n)}return t}function JPe(e){for(var t=new Map,r=0;r<e.length;r++)rEe(e[r],t,r);for(var n=Array.from(t.values()),a=tEe(e.length,n),i=[],o=0,s=a;o<s.length;o++){var u=s[o],l=eEe(n,u.i,u.j,u.count),c=l[0],d=l[1],f=ql.compute({a:c,b:d});console.log(oe.makeTable(f.bTransform),f.rmsd),i.push({transform:f,pivot:u.i,other:u.j})}return i}function eEe(e,t,r,n){for(var a=ql.Positions.empty(n),i=ql.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),p=0;p<f;p++){var v=c[1]+p;a.x[o]=c[0].conformation.x(v),a.y[o]=c[0].conformation.y(v),a.z[o]=c[0].conformation.z(v),v=d[1]+p,i.x[o]=d[0].conformation.x(v),i.y[o]=d[0].conformation.y(v),i.z[o]=d[0].conformation.z(v),o++}}return[a,i]}function tEe(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var a=0;a<e;a++)r[n][a]=0}for(var i=0,o=t;i<o.length;i++)for(var s=o[i].pivots,n=0;n<e;n++)if(!!s[n]){for(var u=s[n][2]-s[n][1],a=n+1;a<e;a++)if(!!s[a]){var l=s[a][2]-s[a][1];r[n][a]=r[n][a]+Math.min(u,l)}}for(var c=[],a=1;a<e;a++)c[a-1]={i:0,j:a,count:r[0][a]};return c}function rEe(e,t,r){for(var n,a=0,i=e.units;a<i.length;a++){var o=i[a];if(o.kind===0){var s=o.elements,u=o.model,l=Gs.Provider.get(u).value;if(!l)return;for(var c=l.dbName,d=l.accession,f=l.num,p=Qt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),v=Qt.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);p.hasNext;){var m=p.move();for(v.setSegment(m);v.hasNext;){var h=v.move(),g=h.index;if(!!c[g]){var y=s[h.start],b=s[h.end-1]+1,S="".concat(c[g],"-").concat(d[g],"-").concat(f[g]);if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,b],n)});else{var C=t.get(S);C.pivots[r]||(C.pivots[r]=[o,y,b])}}}}}}console.log(t)}var nEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:EAe},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return k(At,{children:k(iEe,{},void 0)},void 0)},t}(Rp),jH={alignSequences:E.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},aEe=E.getDefaultValues(jH),GB="SuperpositionTransform",iEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:aEe},r.superposeChains=function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h=this;return ie(this,function(g){switch(g.label){case 0:n=Hn.trace.query,a=this.chainEntries,i=a.map(function(y,b){var S=xe.toStructure(y.loci),C=ot.toLociWithSourceUnits(n(new Co(S)));return xe.remap(C,b===0?h.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:C.structure.root)}),o=this.state.options.alignSequences?ZPe(i):HB(i),s=a[0],u=1,l=i.length,g.label=1;case 1:return u<l?(c=a[u],d=o[u-1],f=d.bTransform,p=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),v=jc(s.label),m=jc(c.label),this.plugin.log.info("Superposed [".concat(v,"] and [").concat(m,"] with RMSD ").concat(p.toFixed(2),".")),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v,m,h=this;return ie(this,function(g){switch(g.label){case 0:n=this.atomEntries,a=n.map(function(y,b){return xe.remap(y.loci,b===0?h.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),i=HB(a),o=n[0],s=1,u=a.length,g.label=1;case 1:return s<u?(l=n[s],c=i[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),p=jc(o.label),v=jc(l.label),m=n[s].atoms.length,this.plugin.log.info("Superposed ".concat(m," ").concat(m===1?"atom":"atoms"," of [").concat(p,"] and [").concat(v,"] with RMSD ").concat(f.toFixed(2),".")),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,a=JPe(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),i=0,o=0,s=a,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),i+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return i/=Math.max(a.length-1,1),this.plugin.log.info("Superposed ".concat(n.length," structures with avg. RMSD ").concat(i.toFixed(2)," \xC5.")),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),ft.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(a){var i;return!!((i=a.cell.obj)===null||i===void 0?void 0:i.data)&&a.cell.obj.data.models.some(function(o){return Gs.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return se(this,void 0,void 0,function(){var a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return a=Zn.resolveAndCheck(this.plugin.state.data,r),a?(i=Kt.findTagInSubtree(this.plugin.state.data.tree,a.transform.ref,GB),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=i?this.plugin.state.data.build().to(i).update(o):this.plugin.state.data.build().to(r).insert(Ve.Model.TransformStructureConformation,o,{tags:GB}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var a=this;return k("div",_({className:"msp-flex-row"},{children:k(nr,_({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:function(){return a.plugin.managers.interactivity.lociHighlights.clearHighlights()}},{children:k("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var a=this,i=this.plugin.managers.structure.selection.additionsHistory;return be("div",_({className:"msp-flex-row"},{children:[be(nr,_({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return a.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return a.highlight(r.loci)},onMouseLeave:function(){return a.plugin.managers.interactivity.lociHighlights.clearHighlights()}},{children:[n,". ",k("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),i.length>1&&k(Nt,{svg:mx,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),i.length>1&&k(Nt,{svg:vx,small:!0,className:"msp-form-control",onClick:function(){return a.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),k(Nt,{svg:gs,small:!0,className:"msp-form-control",onClick:function(){return a.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var a=this;return be("div",{children:[k("div",_({className:"msp-control-group-header"},{children:k("div",_({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),k("div",_({className:"msp-control-offset"},{children:r.atoms.map(function(i,o){return a.historyEntry(i,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=He.create(),a=[];return this.plugin.managers.structure.selection.entries.forEach(function(i,o){var s=i.selection,u=Zn.resolveAndCheck(r.plugin.state.data,o);if(!(!u||xe.isEmpty(s))){var l=xe.getFirstLocation(s,n);if(!(s.elements.length>1||tt.entity.type(l)!=="polymer")){var c=Bs.ofLoci(s),d=sg(c,{countsOnly:!0}),f=As(l,{reverse:!0,granularity:"chain"}).split("|"),p="".concat(d," | ").concat(f[0]," | ").concat(f[f.length-1]);a.push({loci:s,label:p,cell:u})}}}),a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,a=this.plugin.managers.structure.selection.additionsHistory,i=0,o=a.length;i<o;++i){var s=a[i];if(xe.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),p=[],v=0,m=c.length;v<m;++v)p.push(c[v].loci.elements[0]);var h=xe(c[0].loci.structure,p),g=h.structure.label.split(" | ")[0];l.push({loci:h,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return be(At,{children:[n.length>0&&k("div",_({className:"msp-control-offset"},{children:n.map(function(a,i){return r.lociEntry(a,i)})}),void 0),n.length<2&&k("div",_({className:"msp-control-offset msp-help-text"},{children:be("div",_({className:"msp-help-description"},{children:[k(Fr,{svg:ku,inline:!0},void 0),"Add 2 or more selections (toggle ",k(P2,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&k(nr,_({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return be(At,{children:[n.length>0&&k("div",_({className:"msp-control-offset"},{children:n.map(function(a,i){return r.atomsLociEntry(a,i)})}),void 0),n.length<2&&k("div",_({className:"msp-control-offset msp-help-text"},{children:be("div",_({className:"msp-help-description"},{children:[k(Fr,{svg:ku,inline:!0},void 0),"Add 1 or more selections (toggle ",k(P2,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&k(nr,_({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return k(At,{children:k(nr,_({icon:SB,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[k(ua,{icon:SB,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),k(ua,{icon:PAe,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),k(ua,{icon:ap,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&k("div",_({className:"msp-control-offset"},{children:k(bn,{params:jH,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(ma),oEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:o4e}}},t.prototype.renderControls=function(){return k(At,{children:k(sEe,{},void 0)},void 0)},t}(Rp),sEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.default=function(){return se(this,void 0,void 0,function(){var r,n,a,i;return ie(this,function(o){switch(o.label){case 0:return r=this.plugin.managers.structure.hierarchy.selection.structures,n=this.plugin.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,a=this.plugin.builders.structure.representation.resolveProvider(n),[4,this.plugin.managers.structure.component.applyPreset(r,a)];case 1:return o.sent(),this.plugin.managers.structure.component.setOptions(E.getDefaultValues(Md.OptionsParams)),this.plugin.canvas3d&&(i=E.getDefaultValues(AE),this.plugin.canvas3d.setProps({postprocessing:{outline:i.outline,occlusion:i.occlusion}})),[2]}})})},t.prototype.illustrative=function(){return se(this,void 0,void 0,function(){var r;return ie(this,function(n){switch(n.label){case 0:return r=this.plugin.managers.structure.hierarchy.selection.structures,[4,this.plugin.managers.structure.component.applyPreset(r,es.illustrative)];case 1:return n.sent(),this.plugin.canvas3d&&this.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:{scale:1,color:$e(0),threshold:.25}},occlusion:{name:"on",params:{bias:.9,blurKernelSize:15,radius:5,samples:32}}}}),[2]}})})},t.prototype.stylized=function(){return se(this,void 0,void 0,function(){var r;return ie(this,function(n){return this.plugin.managers.structure.component.setOptions(_(_({},this.plugin.managers.structure.component.state.options),{ignoreLight:!0})),this.plugin.canvas3d&&(r=this.plugin.canvas3d.props.postprocessing,this.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:r.outline.name==="on"?r.outline.params:{scale:1,color:$e(0),threshold:.33}},occlusion:{name:"on",params:r.occlusion.name==="on"?r.occlusion.params:{bias:.9,blurKernelSize:15,radius:5,samples:32}}}})),[2]})})},t.prototype.render=function(){var r=this;return be("div",_({className:"msp-flex-row"},{children:[k(nr,_({noOverflow:!0,title:"Applies default representation preset. Set outline and occlusion effects to defaults.",onClick:function(){return r.default()},style:{width:"auto"}},{children:"Default"}),void 0),k(nr,_({noOverflow:!0,title:"Applies no representation preset. Enables outline and occlusion effects. Enables ignore-light representation parameter.",onClick:function(){return r.stylized()},style:{width:"auto"}},{children:"Stylized"}),void 0),k(nr,_({noOverflow:!0,title:"Applies illustrative representation preset. Enables outline and occlusion effects. Enables ignore-light parameter.",onClick:function(){return r.illustrative()},style:{width:"auto"}},{children:"Illustrative"}),void 0)]}),void 0)},t}(ma),uEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,a=n.selectQ(function(p){return p.ofTransformer(Ve.Model.ModelFromTrajectory)});if(a.length===0){r.setState({show:!1});return}for(var i="",o=0,s=new Set,u=0,l=a;u<l.length;u++){var c=l[u];if(!!c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(!!d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!i){var f=c.transform.params.modelIndex;i="Model ".concat(f+1," / ").concat(d.data.frameCount)}}}}o>1&&(i=""),r.setState({show:o>0,label:i})},r.reset=function(){return ft.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:V1.create({action:"reset"})})},r.prev=function(){return ft.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:V1.create({action:"advance",by:-1})})},r.next=function(){return ft.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:V1.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:be("div",_({className:"msp-traj-controls"},{children:[!r&&k(Nt,{svg:mAe,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&k(Nt,{svg:CH,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&k(Nt,{svg:wH,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&k("span",{children:this.state.label},void 0)]}),void 0)},t}(ir),lEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var a=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")a.state.isPlaying&&a.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var i=a.state.entries.get(0);r.update(i.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")a.state.isPlaying&&a.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(a.state.isPlaying&&a.stop(),a.state.entries.size===0)return;var o=a.state.entries.get(a.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,-1);a&&r.update(a)},r.next=function(){var n=r.plugin.managers.snapshot,a=n.getNextId(n.state.current,1);a&&r.update(a)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return se(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,ft.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var a=r.state.current,i=r.state.isPlaying;return be("div",_({className:"msp-state-snapshot-viewport-controls"},{children:[be("select",_({className:"msp-form-control",value:a||"none",onChange:this.change,disabled:this.state.isBusy||i},{children:[!a&&k("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return be("option",_({value:o.snapshot.id},{children:["[".concat(s+1,"/").concat(n,"]")," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),k(Nt,{svg:i?TH:_H,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy},void 0),!i&&be(At,{children:[k(Nt,{svg:CH,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i},void 0),k(Nt,{svg:wH,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i},void 0)]},void 0)]}),void 0)},t}(ir),cEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Lr.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return be("div",_({className:"msp-animation-viewport-controls"},{children:[be("div",{children:[k("div",{className:"msp-semi-transparent-background"},void 0),k(Nt,{svg:n||r?TH:yAe,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&k("div",_({className:"msp-animation-viewport-controls-select"},{children:k(bTe,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(ir),dEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?k("div",_({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:k(sPe,{},void 0)}),void 0):null},t}(ir),fEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:k("div",_({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return k("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(ir),pEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(a,i){n.push(k(a,{initiallyCollapsed:r.props.initiallyCollapsed},i))}),n.length>0?k(At,{children:n},void 0):null},t}(ir),vEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return be(At,{children:[be("div",_({className:"msp-section-header"},{children:[k(Fr,{svg:x4e},void 0),"Structure Tools"]}),void 0),k(bPe,{},void 0),k(fPe,{},void 0),k(nEe,{},void 0),k(oEe,{},void 0),k(GTe,{},void 0),this.plugin.config.get(Lr.VolumeStreaming.Enabled)&&k(MPe,{},void 0),k(RPe,{},void 0),k(pEe,{},void 0)]},void 0)},t}(ir),mEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.state,o=r.current;o.ref!==a||o.state!==i||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,a=n.state,i=n.nodeRef,o=a.cells.get(i),s=a.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return be("div",_({className:"msp-state-actions"},{children:[!this.props.hideHeader&&be("div",_({className:"msp-section-header"},{children:[k(Fr,{svg:L4e},void 0)," ","Actions (".concat(l,")")]}),void 0),s.map(function(c,d){return k(YE,{state:a,action:c,nodeRef:i,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},"".concat(c.id))})]}),void 0)},t}(ir),D2=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=wd.create(new fe.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(Lr.State.HistoryCapacity)}),n.behaviors=wd.create(new Pr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:il(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:il(n.data.events.cell.created,n.behaviors.events.cell.created),removed:il(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:il(n.data.events.object.created,n.behaviors.events.object.created),removed:il(n.data.events.object.removed,n.behaviors.events.object.removed),updated:il(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(_(_({},t.DefaultSnapshotParams),a))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=_(_({},this.snapshotParams.value),r);return{id:Jr.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((n=i==null?void 0:i.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:i==null?void 0:i.durationInMs}},t.prototype.setSnapshot=function(r){var n,a,i;return se(this,void 0,void 0,function(){var o;return ie(this,function(s){switch(s.label){case 0:return[4,this.animation.stop()];case 1:return s.sent(),((n=r.structureComponentManager)===null||n===void 0?void 0:n.options)?[4,this.plugin.managers.structure.component.setOptions((a=r.structureComponentManager)===null||a===void 0?void 0:a.options)]:[3,3];case 2:s.sent(),s.label=3;case 3:return r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,5];case 4:s.sent(),s.label=5;case 5:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,7];case 6:s.sent(),s.label=7;case 7:return((i=r.canvas3d)===null||i===void 0?void 0:i.props)?(o=E.normalizeParams(ol,r.canvas3d.props,"children"),[4,ft.Canvas3D.SetSettings(this.plugin,{settings:o})]):[3,9];case 8:s.sent(),s.label=9;case 9:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&ft.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return ft.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(Pr.getCategoryId(r)).apply(r,Il(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Pr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(Fg);(function(e){e.SnapshotParams={durationInMs:E.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:E.Boolean(!0),behavior:E.Boolean(!1),componentManager:E.Boolean(!0),animation:E.Boolean(!0),startAnimation:E.Boolean(!1),canvas3d:E.Boolean(!0),interactivity:E.Boolean(!0),camera:E.Boolean(!0),cameraTransition:E.MappedStatic("animate",{animate:E.Group({durationInMs:E.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:E.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=E.getDefaultValues(e.SnapshotParams)})(D2||(D2={}));var hEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return be("div",{children:[k(gl,{icon:AH,title:"Plugin State"},void 0),k("div",_({style:{marginBottom:"10px"}},{children:k(Qs,_({header:"Save Options",initiallyExpanded:!1},{children:k(XH,{},void 0)}),void 0)}),void 0),k(gEe,{},void 0),k(yEe,{},void 0),k(gl,{title:"Save as File",accent:"blue"},void 0),k(WH,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&k(YH,{},void 0)]},void 0)},t}(ir),WH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),ft.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,a;(a=(n=r.props).onAction)===null||a===void 0||a.call(n),ft.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var a,i;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(i=(a=r.props).onAction)===null||i===void 0||i.call(a),ft.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return be(At,{children:[be("div",_({className:"msp-flex-row"},{children:[k(nr,_({icon:hA,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),k(nr,_({icon:hA,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),be("div",_({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[k(Fr,{svg:oAe,inline:!0},void 0)," Open ",k("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),be("div",_({className:"msp-help-text",style:{padding:"10px"}},{children:[k(Fr,{svg:AAe},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(ir),XH=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return k(bn,{params:D2.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(ir),gEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:E.getDefaultValues(t.Params)},r.add=function(){ft.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){ft.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!Yv(this.props,r)||!Yv(this.state,n)},t.prototype.render=function(){return be("div",{children:[k(bn,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),be("div",_({className:"msp-flex-row"},{children:[k(Nt,{onClick:this.clear,svg:gs,title:"Remove All"},void 0),k(nr,_({onClick:this.add,icon:qm,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:E.Text(),description:E.Text()},t}(ir),yEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var a=n.currentTarget.getAttribute("data-id");!a||ft.State.Snapshots.Apply(r.plugin,{id:a})},r.remove=function(n){var a=n.currentTarget.getAttribute("data-id");!a||ft.State.Snapshots.Remove(r.plugin,{id:a})},r.moveUp=function(n){var a=n.currentTarget.getAttribute("data-id");!a||ft.State.Snapshots.Move(r.plugin,{id:a,dir:-1})},r.moveDown=function(n){var a=n.currentTarget.getAttribute("data-id");!a||ft.State.Snapshots.Move(r.plugin,{id:a,dir:1})},r.replace=function(n){var a=n.currentTarget.getAttribute("data-id");!a||ft.State.Snapshots.Replace(r.plugin,{id:a})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return k("ul",_({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(a){return be("li",_({className:"msp-flex-row"},{children:[be(nr,_({"data-id":a.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[k("span",_({style:{fontWeight:a.snapshot.id===n?"bold":void 0}},{children:a.name||new Date(a.timestamp).toLocaleString()}),void 0)," ",k("small",{children:"".concat(a.snapshot.durationInMs?I1(a.snapshot.durationInMs,!1)+"".concat(a.description?", ":""):"").concat(a.description?a.description:"")},void 0)]}),void 0),k(Nt,{svg:mx,"data-id":a.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),k(Nt,{svg:vx,"data-id":a.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),k(Nt,{svg:SAe,"data-id":a.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),k(Nt,{svg:gs,"data-id":a.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),a.snapshot.id)})}),void 0)},t}(ir),YH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:E.Text(),options:E.Group({description:E.Text(),playOnLoad:E.Boolean(!1),serverUrl:E.Text(r.plugin.config.get(Lr.State.CurrentServer))})},r.state={params:E.getDefaultValues(r.Params),entries:ci(),isBusy:!1},r.ListOnlyParams={options:E.Group({serverUrl:E.Text(r.plugin.config.get(Lr.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return se(r,void 0,void 0,function(){var n,a,i,o,s,u;return ie(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),a=ci().asMutable(),i=0,o=n;i<o.length;i++)s=o[i],a.set(s.id,_(_({},s),{url:this.serverUrl("get/".concat(s.id)),removeUrl:this.serverUrl("remove/".concat(s.id))}));return this._mounted&&this.setState({entries:a.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),console.error(u),this.plugin.log.error("Error fetching remote snapshots"),this._mounted&&this.setState({entries:ci(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return se(r,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl),[4,ft.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return se(r,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,ft.State.Snapshots.Fetch(this.plugin,{url:i.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return se(r,void 0,void 0,function(){var a,i,o;return ie(this,function(s){switch(s.label){case 0:if(a=n.currentTarget.getAttribute("data-id"),!a)return[2];if(i=this.state.entries.get(a),!i)return[2];this.setState({entries:this.state.entries.remove(a)}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(i.removeUrl)];case 2:return s.sent(),[3,4];case 3:return o=s.sent(),console.error(o),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?mS(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return be(At,{children:[k(gl,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&be(At,{children:[k(bn,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:_(_({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),be("div",_({className:"msp-flex-row"},{children:[k(Nt,{onClick:this.refresh,disabled:this.state.isBusy,svg:yA},void 0),k(nr,_({icon:B4e,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),k(bEe,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&be("div",_({style:{marginTop:"10px"}},{children:[k(bn,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var a;r.setState({params:_(_({},r.state.params),(a={},a[n.name]=n.value,a))})},isDisabled:this.state.isBusy},void 0),k("div",_({className:"msp-flex-row"},{children:k(nr,_({onClick:this.refresh,disabled:this.state.isBusy,icon:yA},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(ir),bEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return se(r,void 0,void 0,function(){var a,i,o,s;return ie(this,function(u){return a=n.currentTarget.getAttribute("data-id"),a?(i=this.props.entries.get(a),i?(n.preventDefault(),o="".concat(window.location),s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open("".concat(o,"?snapshot-url=").concat(encodeURIComponent(i.url)),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return k("ul",_({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return be("li",_({className:"msp-flex-row"},{children:[be(nr,_({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",k("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&k(Nt,{svg:gs,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(ma),KH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===er.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===er.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=r.state.tree.root.ref,i=r.state.tree.children.get(a),o=i.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?be("div",_({style:{margin:"10px",cursor:"default"}},{children:[k("p",{children:"Nothing to see here yet."},void 0),be("p",{children:["Structures and Volumes can be loaded from the ",k(Fr,{svg:gA},void 0)," tab."]},void 0)]}),void 0):k(SEe,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(ir),SEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var a=t.isNull(r.cell),i=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===a&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:a,showLabel:i}},t.hasDecorator=function(r){var n,a=r.parent.tree.children.get(r.transform.ref);return a.size!==1?!1:!!((n=r.parent)===null||n===void 0?void 0:n.tree.transforms.get(a.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===pn.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==er.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,a=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return a.size===0?null:k(At,{children:a.map(function(o){return k(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var i=this.props.depth+1;return be(At,{children:[k(xEe,{cell:n,depth:this.props.depth},void 0),a.size===0?void 0:k("div",_({style:{display:this.state.isCollapsed?"none":"block"}},{children:a.map(function(o){return k(t,{cell:n.parent.cells.get(o),depth:i},o)})}),void 0)]},void 0)},t}(ir),xEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),ft.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),ft.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:er.RootRef})},r.remove=function(n){n==null||n.preventDefault(),ft.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),ft.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),ft.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),ft.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),ft.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){!n||(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(vS(function(n){return r.is(n)}),mN(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var a=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===a?null:{isCurrent:a,isCollapsed:i,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,a=It([],n.parent.actions.fromCell(n,this.plugin),!0);if(a.length!==0)return a.sort(function(i,o){return i.definition.display.name<o.definition.display.name?-1:i.definition.display.name===o.definition.display.name?0:1}),It([Ht.Header("Apply Action")],a.map(function(i){return Ht.Item(i.definition.display.name,function(){return r.setState({action:"apply",currentAction:i})})}),!0)},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,a=K0.getDecoratorChain(n.parent,n.transform.ref),i=[],o=a.length-1;o>=0;o--){var s=a[o];i.push(k(Gl,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},"".concat(s.transform.transformer.id,"-").concat(o)))}return k("div",_({className:"msp-tree-updates-wrapper"},{children:i}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var a=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=be(nr,_({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i},{children:[r.status==="error"&&be("b",{children:["[",r.status,"]"]},void 0)," ",k("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l="".concat(u.label," ").concat(u.description?u.description:"");o=be(nr,_({className:"msp-btn-tree-label msp-type-class-".concat(u.type.typeClass),noOverflow:!0,disabled:i,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[k("span",{children:u.label},void 0)," ",u.description?k("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=k(Nt,{svg:d.isCollapsed?Hl:Vl,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),p=r.state.isLocked?void 0:k(Nt,{svg:gs,onClick:this.remove,disabled:i,small:!0,toggleState:!1},void 0),v=k(Nt,{svg:d.isHidden?Dp:Mp,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible},void 0),m={marginLeft:"".concat(this.props.depth*8,"px")},h=be("div",_({className:"msp-flex-row msp-tree-row".concat(a?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:m},{children:[f,o,p,v]}),void 0);if(!a)return h;if(this.state.action==="apply"&&this.state.currentAction)return be("div",_({style:{marginBottom:"1px"}},{children:[h,k(hl,_({header:"Apply ".concat(this.state.currentAction.definition.display.name),initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:ml,headerLeftMargin:"".concat(this.props.depth*8+21,"px")},{children:k(YE,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates("".concat(this.props.depth*8+21,"px"));return be("div",_({style:{marginBottom:"1px"}},{children:[h,y,g&&k("div",_({style:{marginLeft:"".concat(this.props.depth*8+21,"px"),marginTop:"-1px"}},{children:k(Ht,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return h},t}(ir),CEe=function(e){Pe(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(a){if(n.state.tab===a){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),ft.Layout.Update(n.plugin,{state:{regionState:_(_({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:a},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(a)}),n.plugin.layout.state.regionState.left!=="full"&&ft.Layout.Update(n.plugin,{state:{regionState:_(_({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:k(At,{},void 0),root:be(At,{children:[k(gl,{icon:gA,title:"Home"},void 0),k(mEe,{state:n.plugin.state.data,nodeRef:er.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&k(YH,{listOnly:!0},void 0)]},void 0),data:be(At,{children:[k(gl,{icon:yH,title:be(At,{children:[k(AEe,{},void 0)," State Tree"]},void 0)},void 0),k(KH,{state:n.plugin.state.data},void 0)]},void 0),states:k(hEe,{},void 0),settings:be(At,{children:[k(gl,{icon:ap,title:"Plugin Settings"},void 0),k(_Ee,{},void 0)]},void 0),help:be(At,{children:[k(gl,{icon:ku,title:"Help"},void 0),k(iPe,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&ft.Layout.Update(r.plugin,{state:{regionState:_(_({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var a=n.state;r.state.tab==="data"&&a.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return be("div",_({className:"msp-left-panel-controls"},{children:[be("div",_({className:"msp-left-panel-controls-buttons"},{children:[k(Nt,{svg:gA,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),k(wEe,{set:this.set},void 0),k(Nt,{svg:AH,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),k(Nt,{svg:ku,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),k("div",_({className:"msp-left-panel-controls-buttons-bottom"},{children:k(Nt,{svg:ap,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),k("div",_({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(ir),wEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return k(Nt,{svg:yH,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?k("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(ir),_Ee=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var a;ft.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return be(At,{children:[this.plugin.canvas3d&&be(At,{children:[k(gl,{title:"Viewport"},void 0),k(bn,{params:ol,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),k(gl,{title:"Behavior"},void 0),k(KH,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(ir),AEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),ft.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:er.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===er.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===er.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(er.RootRef).size;return r===0?null:k(Nt,{svg:gs,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(ir),qB=5,TEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=Tt.exports.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new xn,r.lociHighlightProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.lociSelectionProvider=function(n,a){var i=r.props.sequenceWrapper.markResidue(n.loci,a);i&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var a=r.getSeqIdx(n),i=r.getLoci(a),o=_f(n.nativeEvent),s=Sv(n.nativeEvent),u=zy(n.nativeEvent);r.click(i,o,s,u),r.mouseDownLoci=i},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var a=r.getSeqIdx(n),i=r.getLoci(a);if(i&&!xe.areEqual(r.mouseDownLoci,i)){var o=_f(n.nativeEvent),s=Sv(n.nativeEvent),u=zy(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=i.elements[0],d=Math.min(Ee.min(l.indices),Ee.min(c.indices)),f=Math.max(Ee.max(l.indices),Ee.max(c.indices)),p=xe(i.structure,[{unit:l.unit,indices:Ee.ofRange(d,f)}]);r.click(xe.subtract(p,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=He.create(void 0),r.mouseMove=function(n){n.stopPropagation();var a=_f(n.nativeEvent),i=Sv(n.nativeEvent),o=zy(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,_(_({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:a,button:i,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var a=_f(n.nativeEvent),i=Sv(n.nativeEvent),o=zy(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:a,button:i,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(mN(15)(this.highlightQueue),function(n){var a=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(a,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!xe.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,a=r.target;return a&&a.getAttribute&&(n=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,a,i){var o={current:Yt.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!xe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,a,i){var o={current:Yt.Loci.Empty,buttons:n,button:a,modifiers:i};r!==void 0&&!xe.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r=="undefined"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,a){return k("span",_({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(a)},className:this.getResidueClass(r,n)},{children:"\u200B".concat(n,"\u200B")}),r)},t.prototype.getSequenceNumberClass=function(r,n,a){var i=["msp-sequence-number"];return n.startsWith("-")?a.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):a.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",a=this.props.sequenceWrapper.getLoci(r),i=xe.getFirstLocation(a,this.location);if(i)if(Be.isAtomic(i.unit)){var o=tt.residue.auth_seq_id(i),s=tt.residue.pdbx_PDB_ins_code(i);n="".concat(o).concat(s||"")}else Be.isCoarse(i.unit)&&(n="".concat(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<qB?r+new Array(qB-r.length+1).join("\xA0"):r},t.prototype.getSequenceNumberSpan=function(r,n){var a=this.getSequenceNumber(r);return k("span",_({className:this.getSequenceNumberClass(r,a,n)},{children:this.padSeqNum(a)}),"marker-".concat(r))},t.prototype.updateMarker=function(){if(!!this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){a&&s%i===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],a=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);a&&o%i===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),k("div",_({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(ir),gx=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return go(t)?Ks(this.markerArray,Ce.ofLength(this.length),r):this.mark(t,r)},e}(),PEe=function(e){Pe(t,e);function t(r){var n=this,a=He.create(r.structure,r.units[0],r.units[0].elements[0]),i=r.units[0].model.sequence.byEntityKey[tt.entity.key(a)],o=i.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=i.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=Be.isAtomic(r.units[0])?tt.chain.label_asym_id(a):tt.coarse.asym_id(a);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Ee.subtract(Ce.ofBounds(0,o),ze.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?tr.grey:tr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure,s=function(d){return a.sequence.index(d)};if(xe.is(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;r=xe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];!this.unitMap.has(c.unit.id)||(Be.isAtomic(c.unit)?i=IEe(c,n,this.markerArray,s):i=DEe(c,n,this.markerArray,s))}}else if(Ne.isLoci(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;Ks(this.markerArray,this.observed,n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=EEe(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return ot.toLociWithSourceUnits(r4.run(n,this.data.structure))},t}(gx);function EEe(e,t,r){return Hr.generators.atoms({unitTest:function(n){return tt.unit.chainGroupId(n.element)===e&&tt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?tt.residue.label_seq_id(n.element)===r:tt.coarse.seq_id_begin(n.element)<=r&&tt.coarse.seq_id_end(n.element)>=r}})}function IEe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=i.atomicHierarchy.residueAtomSegments.index,u=i.atomicHierarchy.residues.label_seq_id;return Ee.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);b0(r,n(c),t)}),!0}function DEe(e,t,r,n){var a=e.unit,i=a.model,o=a.elements,s=Be.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_begin:i.coarseHierarchy.gaussians.seq_id_begin,u=Be.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_end:i.coarseHierarchy.gaussians.seq_id_end;return Ee.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)b0(r,d,t)}),!0}var MEe=function(e){Pe(t,e);function t(r){for(var n=this,a=[],i=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,p=d.atoms,v=Qt.transientSegments(f,c.elements);v.hasNext;){var m=v.move().index;i.set(m,a.length),o.set(a.length,m),s.set(a.length,c),a.push(p.label_comp_id.value(f.offsets[m]))}var h=a.length,g=new Uint8Array(h);n=e.call(this,r,g,h)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=a,n.sequenceIndices=i,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return tr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=this,i=!1,o=this.data.structure;if(xe.is(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;r=xe.remap(r,o);for(var s=function(f){var p=u.unitMap.get(f.unit.id);if(p){var v=f.unit.model.atomicHierarchy.residueAtomSegments.index;Ee.forEach(f.indices,function(m){var h=a.sequenceIndices.get(v[p.elements[m]]);h!==void 0&&Ks(a.markerArray,Ce.ofSingleton(h),n)&&(i=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if(Ne.isLoci(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;Ks(this.markerArray,Ce.ofBounds(0,this.length),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){var n=[],a=this.residueIndices.get(r);if(a!==void 0){var i=this.seqToUnit.get(r),o=i.model.atomicHierarchy.residueAtomSegments.offsets,s=ze.findPredecessorIndex(i.elements,o[a]),u=ze.findPredecessorIndex(i.elements,o[a+1]);n.push({unit:i,indices:Ce.ofBounds(s,u)})}return xe(this.data.structure,n)},t}(gx),G3=function(e){Pe(t,e);function t(r){for(var n=this,a=0,i=0,o=[],s=He.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];He.set(s,r.structure,f,f.elements[0]);var p=f.model.sequence.byEntityKey[tt.entity.key(s)];p&&(a+=p.sequence.length),i+=f.elements.length;var v=Ce.ofBounds(0,f.elements.length);u.set(f.id,v),l.push({unit:f,indices:v})}a>0&&o.push("".concat(a," residues")),o.push("".concat(i," elements"));var m=1,h=new Uint8Array(m);return n=e.call(this,r,h,m)||this,n.label="Whole Chain (".concat(o.join(", "),")"),n.unitIndices=u,n.loci=xe(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return tr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data.structure;if(xe.is(r)){if(!Ne.areRootsEquivalent(r.structure,i))return!1;r=xe.remap(r,i);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Ee.isSubset(l,u.indices)&&Ks(this.markerArray,Ce.ofSingleton(0),n)&&(a=!0)}}else if(Ne.isLoci(r)){if(!Ne.areRootsEquivalent(r.structure,i))return!1;Ks(this.markerArray,Ce.ofSingleton(0),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){return this.loci},t}(gx),REe=function(e){Pe(t,e);function t(r){for(var n=this,a=0,i=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];a+=u.elements.length;var l=Ce.ofBounds(0,u.elements.length);i.set(u.id,l)}var c=new Uint8Array(a);return n=e.call(this,r,c,a)||this,n.unitIndices=i,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return tr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var a=!1,i=this.data,o=i.structure,s=i.units;if(xe.is(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;r=xe.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Ee.isSubset(d,c.indices)&&Ks(this.markerArray,c.indices,n)&&(a=!0)}}else if(Ne.isLoci(r)){if(!Ne.areRootsEquivalent(r.structure,o))return!1;for(var f=0,p=s.length;f<p;++f){var d=this.unitIndices.get(s[f].id);Ks(this.markerArray,d,n)&&(a=!0)}}return a},t.prototype.getLoci=function(r){for(var n=this.data.units,a=[],i=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<i+u.elements.length){a.push({unit:u,indices:Ce.ofSingleton(r-i)});break}i+=u.elements.length}return xe(this.data.structure,a)},t}(gx),q3=5e3,KE=1e3,OEe=30;function QH(e){var t=tt.unit.pdbx_struct_oper_list_ids(e),r=tt.unit.struct_ncs_oper_id(e),n=tt.unit.hkl(e),a=tt.unit.spgrOp(e);return"".concat(t.sort().join(","),"|").concat(r,"|").concat(n,"|").concat(a)}function QE(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function jB(e,t){for(var r=e.structure,n=e.modelEntityId,a=e.chainGroupId,i=e.operatorKey,o=He.create(r),s=QE(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var p=f[d];He.set(o,r,p,p.elements[0]),r.getModelIndex(p.model)===u&&tt.entity.id(o)===l&&p.chainGroupId===a&&QH(o)===i&&c.push(p)}if(c.length>0){var v={structure:r,units:c},p=c[0],m=void 0;if(p.polymerElements.length){var h=He.create(r,p,p.elements[0]),g=p.model.sequence.byEntityKey[tt.entity.key(h)];if(g&&g.sequence.length<=q3)m=new PEe(v);else{var y=c.reduce(function(C,x){return C+x.polymerElements.length},0);Be.isAtomic(p)||y>q3?m=new G3(v):m=new REe(v)}}else if(Be.isAtomic(p)){var b=c.reduce(function(C,x){return C+x.residueCount},0);b>q3?m=new G3(v):m=new MEe(v)}else console.warn("should not happen, expecting coarse units to be polymeric"),m=new G3(v);return m.markResidue(t.getLoci(r),wt.Select),m}else return"No sequence available"}function t1(e,t){t===void 0&&(t=!1);for(var r=[],n=He.create(e),a=new Set,i=0,o=e.units;i<o.length;i++){var s=o[i];He.set(n,e,s,s.elements[0]);var u=tt.entity.id(n),l=e.getModelIndex(s.model),c="".concat(l,"|").concat(u);if(!a.has(c)&&!(t&&tt.entity.type(n)!=="polymer")){var d=tt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model ".concat(e.models[l].modelNum,")"):d.startsWith("Polymer ")&&(d+=" (".concat(e.models[l].entry,")")));var f="".concat(u,": ").concat(d);if(r.push([c,f]),a.add(c),r.length>KE)return[["","Too many entities"]]}}return r.length===0&&r.push(["","No entities"]),r}function xh(e,t){for(var r=[],n=He.create(e),a=new Set,i=QE(t),o=i[0],s=i[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(He.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&tt.entity.id(n)===s){var d=c.chainGroupId;if(!a.has(d)){var f=As(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});if(r.push([d,f]),a.add(d),r.length>KE)return[[-1,"Too many chains"]]}}}return r.length===0&&r.push([-1,"No chains"]),r}function Jp(e,t,r){for(var n=[],a=He.create(e),i=new Set,o=QE(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(He.set(a,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&tt.entity.id(a)===u&&d.chainGroupId===r){var f=QH(a);if(!i.has(f)){var p=d.conformation.operator.name;if(n.push([f,p]),i.add(f),n.length>KE)return[["","Too many operators"]]}}}return n.length===0&&n.push(["","No operators"]),n}function WB(e){for(var t,r=[],n=[],a=e.select(Kt.Generators.rootsOfType(fe.Molecule.Structure)),i=0,o=a;i<o.length;i++){var s=o[i];!((t=s.obj)===null||t===void 0?void 0:t.data)||(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var XB=E.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),BEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:Ne.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var a=_({},r.state);switch(n.name){case"mode":if(a.mode=n.value,r.state.mode===a.mode)return;if(a.mode==="all"||a.mode==="polymers")break;case"structure":n.name==="structure"&&(a.structureRef=n.value),a.structure=r.getStructure(a.structureRef),a.modelEntityId=t1(a.structure)[0][0],a.chainGroupId=xh(a.structure,a.modelEntityId)[0][0],a.operatorKey=Jp(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"entity":a.modelEntityId=n.value,a.chainGroupId=xh(a.structure,a.modelEntityId)[0][0],a.operatorKey=Jp(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"chain":a.chainGroupId=n.value,a.operatorKey=Jp(a.structure,a.modelEntityId,a.chainGroupId)[0][0];break;case"operator":a.operatorKey=n.value;break}r.setState(a)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var a=n.ref,i=n.obj;a===r.state.structureRef&&i&&i.type===fe.Molecule.Structure.type&&i.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var a=n.obj;a&&a.type===fe.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var a=n.obj;a&&a.type===fe.Molecule.Structure.type&&a.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=WB(this.plugin.state.data);uP(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,a=n.select(r)[0];return!r||!a||!a.obj?Ne.Empty:a.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:jB(this.state,this.plugin.managers.structure.selection),label:"".concat(E.optionLabel(r.chain,this.state.chainGroupId)," | ").concat(E.optionLabel(r.entity,this.state.modelEntityId))}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),a=[],i=0,o=t1(n,this.state.mode==="polymers");i<o.length;i++)for(var s=o[i],u=s[0],l=s[1],c=0,d=xh(n,u);c<d.length;c++)for(var f=d[c],p=f[0],v=f[1],m=0,h=Jp(n,u,p);m<h.length;m++){var g=h[m][0];if(a.push({wrapper:jB({structure:n,modelEntityId:u,chainGroupId:p,operatorKey:g},this.plugin.managers.structure.selection),label:"".concat(v," | ").concat(l)}),a.length>OEe)return[]}return a},t.prototype.getInitialState=function(){var r,n=WB(this.plugin.state.data),a=n.options[0][0],i=this.getStructure(a),o=t1(i)[0][0],s=xh(i,o)[0][0],u=Jp(i,o,s)[0][0];return this.state.structure&&this.state.structure===i&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:i,structureRef:a,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,a=r.structure,i=r.modelEntityId,o=r.chainGroupId,s=t1(a),u=xh(a,i),l=Jp(a,i,o);return{structure:E.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:E.Select(s[0][0],s,{shortLabel:!0}),chain:E.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:E.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:XB}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===Ne.Empty)return k("div",_({className:"msp-sequence"},{children:be("div",_({className:"msp-sequence-select"},{children:[k(Fr,{svg:ku,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),k("span",{children:"Sequence"},void 0),k("span",_({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,a=this.getSequenceWrappers(r);return be("div",_({className:"msp-sequence"},{children:[be("div",_({className:"msp-sequence-select"},{children:[k(Fr,{svg:ku,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),k("span",{children:"Sequence of"},void 0),k(cv,{title:"[Structure] ".concat(E.optionLabel(r.structure,n.structure)),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),k(cv,{title:"[Mode]",param:XB,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&k(cv,{title:"[Entity] ".concat(E.optionLabel(r.entity,n.entity)),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&k(cv,{title:"[Chain] ".concat(E.optionLabel(r.chain,n.chain)),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&k(At,{children:k(cv,{title:"[Instance] ".concat(E.optionLabel(r.operator,n.operator)),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),k(kEe,{children:a.map(function(i,o){var s=typeof i.wrapper=="string"?k("div",_({className:"msp-sequence-wrapper"},{children:i.wrapper}),o):k(TEe,{sequenceWrapper:i.wrapper},o);return n.mode==="single"?s:be(Tt.exports.Fragment,{children:[k("div",_({className:"msp-sequence-chain-label"},{children:i.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(ir);function kEe(e){var t=e.children;return k("div",_({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var LEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ci()},r}return t.prototype.componentDidMount=function(){var r=this,n,a=!!((n=this.plugin.spec.components)===null||n===void 0?void 0:n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(vS(function(i){return i.level==="background"&&(a||!i.useOverlay)})),function(i){r.setState({tracked:r.state.tracked.set(i.id,i)})}),this.subscribe(this.plugin.events.task.finished,function(i){var o=i.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return k("div",_({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return k(ZH,{event:r},r.id)})}),void 0)},t}(ir),ZH=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=$H(this.props.event.progress.root)-1,a=r.progress.isIndeterminate?void 0:be(At,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),i=n>0?be(At,{children:["[",n," subtask(s)]"]},void 0):void 0;return k("div",_({className:"msp-task-state"},{children:be("div",{children:[r.progress.canAbort&&k(Nt,{svg:SH,onClick:this.abort,title:"Abort"},void 0),be("div",{children:[r.progress.message," ",a," ",i]},void 0)]},void 0)}),void 0)},t}(ir);function $H(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var a=n[r];t+=$H(a)}return t}var FEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ci()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(vS(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var a=n.id;r.setState({tracked:r.state.tracked.delete(a)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:k("div",_({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return k(ZH,{event:r},r.id)})}),void 0)},t}(ir),NEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,a=typeof n.message=="string"?k("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):k("div",{children:k(n.message,{},void 0)},void 0);return be("div",_({className:"msp-toast-entry"},{children:[k("div",_({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),k("div",_({className:"msp-toast-message"},{children:a}),void 0),k("div",{className:"msp-toast-clear"},void 0),k("div",_({className:"msp-toast-hide"},{children:k(Nt,{svg:SH,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(ir),UEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(a,i){return n.push(a)}),n.sort(function(a,i){return a.serialNumber-i.serialNumber}),k("div",_({className:"msp-toast-container"},{children:n.map(function(a){return k(NEe,{entry:a},a.serialNumber)})}),void 0)},t}(ir),zEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=Tt.exports.createRef(),r.canvas=Tt.exports.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!((n=r.plugin.canvas3d)===null||n===void 0?void 0:n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return k(r,{},void 0)}return k("div",_({className:"msp-no-webgl"},{children:be("div",{children:[k("p",{children:k("b",{children:"WebGL does not seem to be available."},void 0)},void 0),k("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),be("p",{children:["For a list of supported browsers, refer to ",k("a",_({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return be("div",_({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[k("div",_({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:k("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&k(r,{},void 0)]}),void 0)},t}(ir);function $c(e){var t=Tt.exports.useState({}),r=t[1],n=Tt.exports.useRef();return n.current=e==null?void 0:e.value,Tt.exports.useEffect(function(){if(!!e){var a=e.subscribe(function(i){n.current!==i&&r({})});return function(){return a.unsubscribe()}}},[e]),e==null?void 0:e.value}var VEe=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,a=Tt.exports.useState(null),i=a[0],o=a[1],s=Tt.exports.useRef(null),u=Tt.exports.useRef(e);return Tt.exports.useEffect(function(){u.current=e},Object.values(e)),Tt.exports.useEffect(function(){i!==s.current&&o(s.current)}),Tt.exports.useEffect(function(){var l,c=!1,d=[];function f(g,y){!g||d.push(g.subscribe(y))}function p(){var g=u.current;!g.suspend&&s.current&&YB(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var v=setInterval(function(){c&&(c=!1,p())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var m=void 0;typeof ResizeObserver!="undefined"&&(m=new ResizeObserver(function(){return c=!0}));var h=s.current;return m==null||m.observe(h),p(),function(){clearInterval(v),d.forEach(function(g){return g.unsubscribe()}),m==null||m.unobserve(h)}},[n]),Tt.exports.useLayoutEffect(function(){s.current&&YB(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},It([],Object.values(e),!0)),k(At,{children:be("div",_({style:{position:"relative",width:"100%",height:"100%"}},{children:[k("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),k(GEe,{plugin:t,canvas:i,color:r},void 0)]}),void 0)},void 0)},HEe=Tt.exports.memo(VEe,function(e,t){return uS(e,t)});function YB(e,t,r,n,a){var i=e.getPreview(),o=i.canvas,s=i.width,u=i.height,l=t.getContext("2d");if(!!l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=JH(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var p=13,v=0;v<f.width;v+=p)for(var m=0;m<f.height;m+=p){l.fillStyle=(v+m)%2?"#ffffff":"#bfbfbf";var h=f.x+v,g=f.y+m,y=v+p>f.width?f.width-v:p,b=m+p>f.height?f.height-m:p;l.fillRect(h,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&a){var S=a;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function GEe(e){var t,r=e.plugin,n=e.canvas,a=e.color,i=a===void 0?"rgba(255, 87, 45, 0.75)":a,o=r.helpers.viewportScreenshot,s=$c(o==null?void 0:o.behaviors.values),u=$c(o==null?void 0:o.behaviors.cropParams),l=$c(o==null?void 0:o.behaviors.relativeCrop),c=Tt.exports.useRef({x:0,y:0,width:0,height:0});$c((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=Tt.exports.useState(""),f=d[0],p=d[1],v=Tt.exports.useState([0,0]),m=v[0],h=v[1],g=Tt.exports.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),C=S.width,x=S.height,A=JH(C,x,n.clientWidth,n.clientHeight),P={x:A.x+Math.floor(A.width*l.x),y:A.y+Math.floor(A.height*l.y),width:Math.ceil(A.width*l.width),height:Math.ceil(A.height*l.height)},T=KB(P),D=KB(A);if(f==="move"?(T.l+=y[0]-m[0],T.r+=y[0]-m[0],T.t+=y[1]-m[1],T.b+=y[1]-m[1]):f&&(f.indexOf("left")>=0?T.l+=y[0]-m[0]:f.indexOf("right")>=0&&(T.r+=y[0]-m[0]),f.indexOf("top")>=0?T.t+=y[1]-m[1]:f.indexOf("bottom")>=0&&(T.b+=y[1]-m[1])),T.l>T.r){var I=T.l;T.l=T.r,T.r=I}if(T.t>T.b){var I=T.t;T.t=T.b,T.b=I}var M=40;T.l=Math.min(D.r-M,Math.max(D.l,T.l)),T.r=Math.max(D.l+M,Math.min(D.r,T.r)),T.t=Math.min(D.b-M,Math.max(D.t,T.t)),T.b=Math.max(D.t+M,Math.min(D.b,T.b)),P.x=T.l,P.y=T.t,P.width=T.r-T.l+1,P.height=T.b-T.t+1,c.current=P;var B=function(j){j.preventDefault(),b([j.pageX,j.pageY])},U=function(j){j.preventDefault();var L=j.touches[0];b([L.pageX,L.pageY])},V=function(j){j.preventDefault(),p(j.currentTarget.getAttribute("data-drag"));var L=j.touches[0],H=[L.pageX,L.pageY];h(H),b(H),window.addEventListener("touchend",W),window.addEventListener("touchmove",U)},F=function(j){j.preventDefault(),p(j.currentTarget.getAttribute("data-drag"));var L=[j.pageX,j.pageY];h(L),b(L),window.addEventListener("mouseup",Y),window.addEventListener("mousemove",B)},Y=function(){window.removeEventListener("mouseup",Y),window.removeEventListener("mousemove",B),K()},W=function(){window.removeEventListener("touchend",W),window.removeEventListener("touchmove",U),K()};function K(){var j=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(_(_({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(j.x-A.x)/A.width,y:(j.y-A.y)/A.height,width:j.width/A.width,height:j.height/A.height}),p("");var L=[0,0];h(L),b(L)}var $=function(j){j.preventDefault(),j.stopPropagation()},J=4,Z="3px solid ".concat(i),N="transparent";return be(At,{children:[k("div",{"data-drag":"move",style:{position:"absolute",left:P.x,top:P.y,width:P.width,height:P.height,border:Z,cursor:"move"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"left",style:{position:"absolute",left:P.x-J,top:P.y+J,width:4*J,height:P.height-J,background:N,cursor:"w-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"right",style:{position:"absolute",left:T.r-2*J,top:P.y,width:4*J,height:P.height-J,background:N,cursor:"w-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"top",style:{position:"absolute",left:P.x-J,top:P.y-J,width:P.width+2*J,height:4*J,background:N,cursor:"n-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"bottom",style:{position:"absolute",left:P.x-J,top:T.b-2*J,width:P.width+2*J,height:4*J,background:N,cursor:"n-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"top, left",style:{position:"absolute",left:T.l-J,top:T.t-J,width:4*J,height:4*J,background:N,cursor:"nw-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"bottom, right",style:{position:"absolute",left:T.r-2*J,top:T.b-2*J,width:4*J,height:4*J,background:N,cursor:"nw-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"top, right",style:{position:"absolute",left:T.r-2*J,top:T.t-J,width:4*J,height:4*J,background:N,cursor:"ne-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0),k("div",{"data-drag":"bottom, left",style:{position:"absolute",left:T.l-J,top:T.b-2*J,width:4*J,height:4*J,background:N,cursor:"ne-resize"},onMouseDown:F,onTouchStart:V,draggable:!1,onContextMenu:$},void 0)]},void 0)}function KB(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function JH(e,t,r,n){var a=e/t,i=r/n;if(a<=i){var o=n*a;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/a;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var qEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return se(r,void 0,void 0,function(){var n;return ie(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return a.sent(),ft.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return a.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return se(r,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return[4,(a=this.plugin.helpers.viewportScreenshot)===null||a===void 0?void 0:a.getImageDataUri()];case 1:return n=i.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||ft.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,a=!!((n=navigator.clipboard)===null||n===void 0?void 0:n.write);return be("div",{children:[this.state.showPreview&&be("div",_({className:"msp-image-preview"},{children:[k(HEe,{plugin:this.plugin},void 0),k(WEe,{plugin:this.plugin},void 0)]}),void 0),be("div",_({className:"msp-flex-row"},{children:[!this.state.imageData&&k(nr,_({icon:N4e,onClick:a?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&k(nr,_({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),k(nr,_({icon:hA,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&be("div",_({className:"msp-row msp-copy-image-wrapper"},{children:[k("div",{children:"Right click below + Copy Image"},void 0),k("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),k(jEe,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),be(Qs,_({header:"State"},{children:[k(WH,{onAction:this.props.close},void 0),k(Qs,_({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:k(XH,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(ir);function jEe(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,a=$c(n.behaviors.values);return k(bn,{params:n.params,values:a,onChangeValues:function(i){return n.behaviors.values.next(i)},isDisabled:r},void 0)}function WEe(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=$c(r==null?void 0:r.behaviors.cropParams);return $c(r==null?void 0:r.behaviors.relativeCrop),r?be("div",_({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[k(ua,{icon:q4e,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&k(nr,{icon:z4e,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&k(nr,{icon:H4e,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function XEe(e){return function(t){var r=t.values,n=t.update,a=t.apply;return{params:typeof e.params=="function"?e.params:function(i){return e.params},getTarget:e.target,getValues:r,update:function(i,o){var s=e.target(o);return Il(s,function(u){return n(i,u,o)})},apply:a||function(){}}}}var YEe=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?be(At,{children:[k(HAe,{mapping:QEe},void 0),k(WE,{},void 0)]},void 0):null},t}(ir),H1={sequence:"Sequence",log:"Log",left:"Left Panel"},KEe={animate:ol.trackball.params.animate,camera:ol.camera,background:E.Group({color:E.Color($e(16579577),{label:"Background",description:"Custom background color"}),transparent:E.Boolean(!1)},{pivot:"color"}),lighting:E.Group({occlusion:ol.postprocessing.params.occlusion,outline:ol.postprocessing.params.outline,fog:ol.cameraFog},{isFlat:!0}),clipping:E.Group(_({},ol.cameraClipping.params),{pivot:"radius"}),layout:E.MultiSelect([],E.objectToOptions(H1))},QEe=XEe({params:function(e){var t,r=E.clone(KEe),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var a=[];n.top!=="none"&&a.push(["sequence",H1.sequence]),n.bottom!=="none"&&a.push(["log",H1.log]),n.left!=="none"&&a.push(["left",H1.left]),r.layout.options=a}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,a=e.layout.state.regionState,i=[];return a.top!=="hidden"&&(!n||n.top!=="none")&&i.push("sequence"),a.bottom!=="hidden"&&(!n||n.bottom!=="none")&&i.push("log"),a.left!=="hidden"&&(!n||n.left!=="none")&&i.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:i}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,animate:r.trackball.animate,camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:_({},r.cameraClipping)}},update:function(e,t){var r=t.canvas;r.trackball.animate=e.animate,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},t.layout=e.layout},apply:function(e,t){return se(this,void 0,void 0,function(){var r,n;return ie(this,function(a){switch(a.label){case 0:return[4,ft.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return a.sent(),r=e.layout.indexOf("left")<0,n=Il(t.layout.state,function(i){i.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",i.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",i.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,ft.Layout.Update(t,{state:n})];case 2:return a.sent(),r&&ft.State.SetCurrentObject(t,{state:t.state.data,ref:er.RootRef}),[2]}})})}}),ZEe=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=_({},r.allCollapsedState),r.resetCamera=function(){ft.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){ft.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){ft.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var a;ft.Canvas3D.SetSettings(r.plugin,{settings:(a={},a[n.name]=n.value,a)})},r.setLayout=function(n){var a;ft.Layout.Update(r.plugin,{state:(a={},a[n.name]=n.value,a)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(a){var i;n.setState(_(_({},n.allCollapsedState),(i={},i[r]=!n.state[r],i))),a==null||a.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,a,i){return i===void 0&&(i=!0),k(Nt,{svg:r,toggleState:i,onClick:n,title:a,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return be("div",_({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[be("div",_({className:"msp-viewport-controls-buttons"},{children:[be("div",{children:[k("div",{className:"msp-semi-transparent-background"},void 0),this.icon(v4e,this.resetCamera,"Reset Camera")]},void 0),be("div",{children:[k("div",{className:"msp-semi-transparent-background"},void 0),this.icon(w4e,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),be("div",{children:[k("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(Lr.Viewport.ShowControls)&&this.icon(b4e,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Lr.Viewport.ShowExpand)&&this.icon(Q4e,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Lr.Viewport.ShowSettings)&&this.icon(ap,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(Lr.Viewport.ShowSelectionMode)&&be("div",{children:[k("div",{className:"msp-semi-transparent-background"},void 0),k(P2,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&k("div",_({className:"msp-viewport-controls-panel"},{children:k(hl,_({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:ml,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:k(qEe,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&k("div",_({className:"msp-viewport-controls-panel"},{children:k(hl,_({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:ml,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:k(YEe,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(ir),$Ee=function(){return k("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},JEe=function(){return k(zEe,{logo:$Ee},void 0)},e5e=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return k("div",_({className:"msp-layout-region msp-layout-".concat(r)},{children:k("div",_({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return k(hx.Provider,_({value:this.props.plugin},{children:k(t5e,{},void 0)}),void 0)},t}(Tt.exports.Component);(function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return k(hx.Provider,_({value:this.props.plugin},{children:k("div",_({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(Tt.exports.Component);var t5e=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var a=[];if(n.dataTransfer.items){for(var i=0;i<n.dataTransfer.items.length;i++)if(n.dataTransfer.items[i].kind==="file"){var o=n.dataTransfer.items[i].getAsFile();o&&a.push(o)}}else for(var i=0;i<n.dataTransfer.files.length;i++){var o=n.dataTransfer.files[0];o&&a.push(o)}var s=a.filter(function(u){var l=u.name.toLowerCase();return l.endsWith(".molx")||l.endsWith(".molj")});s.length>0?ft.State.Snapshots.OpenFile(r.plugin,{file:s[0]}):r.plugin.runTask(r.plugin.state.data.applyAction(NE,{files:a.map(function(u){return Kr.File(u)}),format:{name:"auto",params:{}},visuals:!0}))},r.onDragOver=function(n){n.preventDefault()},r.showDragOverlay=new fl(!1),r.onDragEnter=function(){return r.showDragOverlay.next(!0)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return k("div",_({className:"msp-layout-region msp-layout-".concat(r)},{children:k("div",_({className:"msp-layout-static"},{children:n?k(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,a=this.plugin.layout.state,i=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(i.top==="none"||!a.showControls||a.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),i.left==="none"||!a.showControls||a.regionState.left==="hidden"?o.push("msp-layout-hide-left"):a.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(i.right==="none"||!a.showControls||a.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(i.bottom==="none"||!a.showControls||a.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-".concat(r.controlsDisplay)),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,a,i,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((a=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||a===void 0?void 0:a.view)||i5e;return k("div",_({className:"msp-plugin"},{children:be("div",_({className:this.layoutClassName,onDragEnter:this.onDragEnter},{children:[be("div",_({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||BEe),o.showControls&&s.left!=="none"&&this.region("left",s.left||CEe),o.showControls&&s.right!=="none"&&this.region("right",s.right||a5e),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||o5e)]}),void 0),!((i=this.plugin.spec.components)===null||i===void 0?void 0:i.hideTaskOverlay)&&k(FEe,{},void 0),k(n5e,{plugin:this.plugin,showDragOverlay:this.showDragOverlay},void 0)]}),void 0)}),void 0)},t}(ir);function r5e(e,t,r){e.preventDefault(),e.stopPropagation(),r.next(!1);var n=[];if(e.dataTransfer.items){for(var a=0;a<e.dataTransfer.items.length;a++)if(e.dataTransfer.items[a].kind==="file"){var i=e.dataTransfer.items[a].getAsFile();i&&n.push(i)}}else for(var a=0;a<e.dataTransfer.files.length;a++){var i=e.dataTransfer.files[0];i&&n.push(i)}var o=n.filter(function(s){var u=s.name.toLowerCase();return u.endsWith(".molx")||u.endsWith(".molj")});o.length>0?ft.State.Snapshots.OpenFile(t,{file:o[0]}):t.runTask(t.state.data.applyAction(NE,{files:n.map(function(s){return Kr.File(s)}),format:{name:"auto",params:{}},visuals:!0}))}function n5e(e){var t=e.plugin,r=e.showDragOverlay,n=$c(r),a=function(i){i.dataTransfer.dropEffect="copy",i.preventDefault(),i.stopPropagation()};return k("div",_({className:"msp-drag-drop-overlay",style:{display:n?"flex":"none"},onDragEnter:a,onDragOver:a,onDragLeave:function(){return r.next(!1)},onDrop:function(i){return r5e(i,t,r)}},{children:"Load File(s)"}),void 0)}var a5e=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||vEe;return k("div",_({className:"msp-scrollable-container"},{children:k(n,{},void 0)}),void 0)},t}(ir),i5e=function(e){Pe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,a=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||ZEe;return be(At,{children:[k(JEe,{},void 0),be("div",_({className:"msp-viewport-top-left-controls"},{children:[k(cEe,{},void 0),k(uEe,{},void 0),k(lEe,{},void 0)]}),void 0),k(dEe,{},void 0),k(a,{},void 0),k(LEe,{},void 0),be("div",_({className:"msp-highlight-toast-wrapper"},{children:[k(fEe,{},void 0),k(UEe,{},void 0)]}),void 0)]},void 0)},t}(ir),o5e=function(e){Pe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=Tt.exports.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,a=n.size,i=[],o=Math.max(0,a-r),s=0;o<a;o++){var u=n.get(o);i.push(be("li",{children:[k("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),k("div",_({className:"msp-log-timestamp"},{children:XW(u.timestamp)}),void 0),k("div",_({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return k("div",_({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:k("ul",_({className:"msp-list-unstyled"},{children:i}),void 0)}),void 0)},t}(ir);function s5e(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:"".concat(t,"px"),height:"".concat(r,"px")})}function u5e(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),s5e(e,n,a,r)}function l5e(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=a.charCodeAt(l++)|a.charCodeAt(l++)<<8|a.charCodeAt(l++)<<16|a.charCodeAt(l++)<<24;for(var d=i&3;d--;)s[l]=a.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function QB(e,t,r){return se(this,void 0,void 0,function(){return ie(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):l5e(e,o,t,r)})]})})}var M2;(function(e){var t=function(){function r(){this.providers=ci().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;!l.isApplicable(n)||(l.isHidden||(i.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),a[l.descriptor.name]=E.Group(_({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:E.MultiSelect(o,i),properties:E.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){var a=this.providers.get(n);if(!a)throw new Error("Custom property '".concat(n,"' is not registered."));return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(M2||(M2={}));var c5e=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(_z,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(Cz,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(wz,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return se(this,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(Az,t,r).commit({revertOnError:!0})];case 1:return a=o.sent(),i=cx(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:a,fileInfo:i}]}})})},e}(),d5e=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=es.auto,ns(es,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=es[t])!==null&&r!==void 0?r:rP(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return E.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?E.Group(o.params(t,this.plugin)):E.EmptyGroup())}return r.length===0?E.MappedStatic("",{"":E.EmptyGroup()}):E.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),j0(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i,o=this.resolveProvider(r);if(!!o){var s=this.plugin.state.data,u=Zn.resolveAndCheck(s,t);if(!u){Cg||console.warn("Applying structure repr. provider to bad cell.");return}var l=((i=o.params)===null||i===void 0?void 0:i.call(o,u.obj,this.plugin))||{},c=n||(o.params?E.getDefaultValues(l):{}),d=this.plugin.config.get(Lr.Structure.DefaultRepresentationPresetParams);c=E.merge(l,d,c);var f=Fe.create("".concat(o.display.name),function(){return o.apply(u,c,a.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return se(this,void 0,void 0,function(){var a,i;return ie(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),i=this.buildRepresentation(a,t,r,n),i?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(!!r){var s=(o=(i=Zn.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!s){var u=z1(this.plugin,s,n);return(a==null?void 0:a.tag)?t.to(r).applyOrUpdateTagged(a.tag,r2,u,{state:a==null?void 0:a.initialState}).selector:t.to(r).apply(r2,u,{state:a==null?void 0:a.initialState}).selector}}},e}();function Rd(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:E.Optional(E.Group(We.getParamDefinition(Ve.Model.CustomModelProperties,void 0,r))),structureProperties:E.Optional(E.Group(We.getParamDefinition(Ve.Model.CustomStructureProperties,void 0,r))),representationPreset:E.Optional(E.Text("auto"))}}})(Rd||(Rd={}));var yx=Rd.CommonParams,f5e=function(e,t){return _({model:E.Optional(E.Group(We.getParamDefinition(Ve.Model.ModelFromTrajectory,e,t))),showUnitcell:E.Optional(E.Boolean(!1)),structure:E.Optional(Ff.getParams(void 0,"assembly").type),representationPresetParams:E.Optional(E.Group(hi.CommonParams))},yx(e,t))},eG=Rd({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:f5e,apply:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=f.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=f.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=f.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=f.sent(),t.showUnitcell===void 0||!!t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return l=f.sent(),[3,7];case 6:l=void 0,f.label=7;case 7:return u=l,c=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,[4,r.builders.structure.representation.applyPreset(s,c,t.representationPresetParams)];case 8:return d=f.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:d}]}})})}}),p5e=function(e,t){return _({useDefaultIfSingleModel:E.Optional(E.Boolean(!1)),representationPresetParams:E.Optional(E.Group(hi.CommonParams))},yx(e,t))},v5e=Rd({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:p5e,apply:function(e,t,r){var n,a;return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:if(i=(a=(n=Zn.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data,!i)return[2,{}];if(i.frameCount===1&&t.useDefaultIfSingleModel)return[2,eG.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,h.label=1;case 1:return l<i.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=h.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=h.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=h.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=h.sent(),s.push(c),u.push(f),v=f.obj?EU(f.obj.data,{elementCountFactor:i.frameCount}):"medium",m=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,[4,o.representation.applyPreset(p,m,{theme:{globalName:"model-index"},quality:v})];case 6:h.sent(),h.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),tG=function(e,t){return _({model:E.Optional(E.Group(We.getParamDefinition(Ve.Model.ModelFromTrajectory,e,t)))},yx(e,t))};function rG(e,t,r,n){return se(this,void 0,void 0,function(){var a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return a=n.builders.structure,[4,a.createModel(t,r.model)];case 1:return i=f.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=f.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=f.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=f.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=f.sent(),c=r.representationPreset||n.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,[4,n.builders.structure.representation.applyPreset(u,c,{theme:{globalName:e.theme}})];case 6:return d=f.sent(),[2,{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:d}]}})})}var m5e=Rd({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return zt.hasCrystalSymmetry(e.data.representative)},params:tG,apply:function(e,t,r){return se(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,rG({ijkMin:w.create(0,0,0),ijkMax:w.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),h5e=Rd({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return zt.hasCrystalSymmetry(e.data.representative)},params:tG,apply:function(e,t,r){return se(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,rG({ijkMin:w.create(-1,-1,-1),ijkMax:w.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),g5e=function(e,t){return _({model:E.Optional(E.Group(We.getParamDefinition(Ve.Model.ModelFromTrajectory,e,t)))},yx(e,t))},y5e=Rd({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:function(e){return zt.hasCrystalSymmetry(e.data.representative)},params:g5e,apply:function(e,t,r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=d.sent(),l=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||es.auto.id,[4,r.builders.structure.representation.applyPreset(s,l,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:eE.defaultValues}}}}})];case 6:return c=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),j3={default:eG,"all-models":v5e,unitcell:m5e,supercell:h5e,crystalContacts:y5e},b5e=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=j3.default,ns(j3,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=j3[t])!==null&&r!==void 0?r:rP(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return E.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?E.Group(o.params(t,this.plugin)):E.EmptyGroup())}return r.length===0?E.MappedStatic("",{"":E.EmptyGroup()}):E.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),j0(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(!!i){var o=this.plugin.state.data,s=Zn.resolveAndCheck(o,t);if(!s){Cg||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(i.params?E.getDefaultValues(i.params(s.obj,this.plugin)):{}),l=Fe.create("".concat(i.display.name),function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(l)}},e}(),S5e=function(){function e(t){this.plugin=t,this.hierarchy=new b5e(this.plugin),this.representation=new d5e(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return se(this,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'".concat(r,"' is not a supported data format."));return[4,n.parse(this.plugin,t)];case 1:return a=i.sent().trajectory,[2,a]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,a=n.build().to(t).apply(Ve.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(Ve.Model.TrajectoryFromBlob,void 0);return a.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=Zn.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return fe.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(Ve.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return i.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(Ve.Model.CustomModelProperties,r,{state:n});return i.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=(i=(a=Zn.resolveAndCheck(s,t))===null||a===void 0?void 0:a.obj)===null||i===void 0?void 0:i.data;if(!!u){var l=(o=kn.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Ri.isZero(l)){var c=s.build().to(t).apply(Ve.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var a,i=this.dataState;if(!r){var o=Zn.resolveAndCheck(i,t);if(o){var s=kn.Provider.get((a=o.obj)===null||a===void 0?void 0:a.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=i.build().to(t).apply(Ve.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,a=n.build().to(t).apply(Ve.Model.CustomStructureProperties,r);return a.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===Ve.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return se(this,void 0,void 0,function(){var s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-".concat(n),c=u.applyOrUpdateTagged(l,Ve.Model.StructureComponent,r,{tags:a?It(It([],a,!0),[l],!1):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(i=d.cell)===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((a==null?void 0:a.label)||"").trim()},n,a==null?void 0:a.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-".concat(r),n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(Fe.create("Query Component",function(o){return se(i,void 0,void 0,function(){var s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:return s=a||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=Zn.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(m={},h={name:"bundle"},v=(p=Mr).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(m.type=(h.params=v.apply(p,[b.sent()]),h),m.nullIfEmpty=!0,m.label=u||r.label,m),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),AA;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}e.create=t})(AA||(AA={}));var R2;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=AA.create(e.Descriptor)})(R2||(R2={}));var qg="Volume";function jg(e,t){return se(this,void 0,void 0,function(){var r,n=this;return ie(this,function(a){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(Fe.create("Try Set Recommended IsoValue",function(i){return se(n,void 0,void 0,function(){var o,s;return ie(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,H7(e,i,r)];case 1:return o=u.sent(),R2.Provider.set(t,ht.IsoValue.absolute(o)),[3,3];case 2:return s=u.sent(),console.warn(s),[3,3];case 3:return[2]}})})}))]):[2]})})}function nG(e){var t=R2.Provider.get(e);if(!!t)return t.kind==="relative"?t:ht.adjustedIsoValue(e,t.absoluteValue,"absolute")}function ZE(e,t){return se(this,void 0,void 0,function(){var r,n,a;return ie(this,function(i){switch(i.label){case 0:return r={},n=t.volume.data&&nG(t.volume.data),n&&(r.isoValue=n),a=e.build().to(t.volume).apply(Ve.Representation.VolumeRepresentation3D,zv(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,a.commit()];case 1:return[2,[i.sent()]]}})})}var x5e={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:qg,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(Ve.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(Ve.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,jg(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:ZE},C5e={label:"DSN6/BRIX",description:"DSN6/BRIX",category:qg,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(Ve.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(Ve.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,jg(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:ZE},w5e={label:"DX",description:"DX",category:qg,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(Ve.Data.ParseDx,{},{state:{isGhost:!0}}),a=n.apply(Ve.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,a.commit({revertOnError:!0})];case 1:return i.sent(),[4,jg(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:ZE},_5e={label:"Cube",description:"Cube",category:qg,stringExtensions:["cub","cube"],parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(Ve.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(Ve.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),i=n.apply(Ve.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(Ve.Model.ModelFromTrajectory).apply(Ve.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,jg(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return se(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],a=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,a&&ht.isOrbitals(a)?(i=r.to(t.volume).apply(Ve.Representation.VolumeRepresentation3D,zv(e,a,{type:"isosurface",typeParams:{isoValue:ht.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:tr.blue}})),o=r.to(t.volume).apply(Ve.Representation.VolumeRepresentation3D,zv(e,a,{type:"isosurface",typeParams:{isoValue:ht.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:tr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(Ve.Representation.VolumeRepresentation3D,zv(e,a,{type:"isosurface",typeParams:{isoValue:ht.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:tr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],ns(u==null?void 0:u.representations,function(p){p&&l.push(p)}),[2,It(It([],n,!0),l,!0)]}})})}},A5e={label:"DensityServer CIF",description:"DensityServer CIF",category:qg,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return FE(e,t)==="dscif"},parse:function(e,t,r){return se(void 0,void 0,void 0,function(){var n,a,i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return[4,e.build().to(t).apply(Ve.Data.ParseCif).commit()];case 1:if(n=m.sent(),a=e.build().to(n),i=n.obj.data.blocks.slice(1),i.length!==1&&i.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=i;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(a.apply(Ve.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,a.commit()];case 2:m.sent(),f=0,p=o,m.label=3;case 3:return f<p.length?(v=p[f],[4,jg(e,v.data)]):[3,6];case 4:m.sent(),m.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return se(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return ie(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&nG(r[0].data)||ht.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(Ve.Representation.VolumeRepresentation3D,xl.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:tr.teal})).selector),r.length>1&&(o=xl.getDefaultParamsStatic(e,"isosurface",{isoValue:ht.IsoValue.relative(3),alpha:.3},"uniform",{value:tr.green}),s=xl.getDefaultParamsStatic(e,"isosurface",{isoValue:ht.IsoValue.relative(-3),alpha:.3},"uniform",{value:tr.red}),a[a.length]=n.to(r[1]).apply(Ve.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(Ve.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}},T5e=[["ccp4",x5e],["dsn6",C5e],["cube",_5e],["dx",w5e],["dscif",A5e]],P5e="Shape",E5e={label:"PLY",description:"PLY",category:P5e,stringExtensions:["ply"],parse:function(e,t){return se(void 0,void 0,void 0,function(){var r,n;return ie(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(Ve.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(Ve.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(Ve.Representation.ShapeRepresentation3D);return r.commit()}},I5e=[["ply",E5e]],$E="Structure",D5e={label:"PSF",description:"PSF",category:$E,stringExtensions:["psf"],parse:function(e,t){return se(void 0,void 0,void 0,function(){var r,n;return ie(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(Ve.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(Ve.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},M5e={label:"DCD",description:"DCD",category:$E,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(Ve.Model.CoordinatesFromDcd);return r.commit()}},R5e={label:"XTC",description:"XTC",category:$E,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(Ve.Model.CoordinatesFromXtc);return r.commit()}},O5e=[["psf",D5e],["dcd",M5e],["xtc",R5e]],B5e=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=T5e;t<r.length;t++){var n=r[t],a=n[0],i=n[1];this.add(a,i)}for(var o=0,s=O5e;o<s.length;o++){var u=s[o],a=u[0],i=u[1];this.add(a,i)}for(var l=0,c=I5e;l<c.length;l++){var d=c[l],a=d[0],i=d[1];this.add(a,i)}for(var f=0,p=pH;f<p.length;f++){var v=p[f],a=v[0],i=v[1];this.add(a,i)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;(n=i.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(a=i.binaryExtensions)===null||a===void 0||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,a=r.provider;return(n=a.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,a=r.provider;return t.push([n,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,a=this.list.length;n<a;++n){var i=this._list[n].provider,o=!1;if((i.binaryExtensions&&i.binaryExtensions.indexOf(t.ext)>=0||i.stringExtensions&&i.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '".concat(t,"'"))},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),k5e=function(e){Pe(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next(void 0)},t.prototype.triggerApply=function(){this.events.applied.next(void 0)},t.prototype.getParams=function(){return this._params||(this._params={current:E.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:_(_({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:E.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=_(_({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '".concat(r.name,"' is already registered."));return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return se(this,void 0,void 0,function(){return ie(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n,a){return se(this,void 0,void 0,function(){return ie(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n||a?[4,this.applyFrame(a)]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return se(this,void 0,void 0,function(){var r,n,a;return ie(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:a=i.sent(),a&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return se(this,void 0,void 0,function(){var r;return ie(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return se(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(r){return se(this,void 0,void 0,function(){var n,a;return ie(this,function(i){switch(i.label){case 0:return n=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=n),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context})];case 1:return a=i.sent(),a.kind==="finished"?this.stop():a.kind==="next"&&(this._current.state=a.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return se(this,void 0,void 0,function(){var r;return ie(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(uc),L5e={minRadius:5,extraRadius:4,durationMs:250},F5e=function(){function e(t){this.plugin=t,this.boundaryHelper=new To("98")}return e.prototype.transformedLoci=function(t){var r,n;if(xe.is(t)){var a=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;a&&(t=xe.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(!!t){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=Xt.getBoundingSphere(this.transformedLoci(s));u&&a.push(u)}if(a.length===0)return;this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=Xt.getBoundingSphere(this.transformedLoci(t[0]))}else n=Xt.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=r(s);u&&a.push(u)}if(a.length!==0){if(a.length===1)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var l=0,c=a;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=a;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a,i,o,s=_(_({},L5e),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r==null?void 0:r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,p=f.origin,v=f.dirA,m=f.dirC,h=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(p,d,v,m);(a=this.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({durationMs:c,snapshot:h})}else{var h=(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:h})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),N5e=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a,i){r.mark(n,a),i||r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return Yt.Loci.areEqual(t,a)});n===-1&&r===wt.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===wt.RemoveHighlight&&(W0(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!Xt.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var l=a.group?a.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,v=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(p===1?v:"".concat(v," <small>|| \xD7 ").concat(p,"</small>"))}),this.isDirty=!1}return this.labels},e}(),U5e=8,z5e=function(e){Pe(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(!!fe.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next(void 0))}});var a=Me();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,l=i.action;if(!!fe.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=xe.remap(c.loci,d);n.state.current=_(_({},c),{loci:f}),n.behaviors.current.next(n.state.current),Xt.getBoundingSphere(f,a);var p=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,v=p.getTargetDistance(a.radius+4);(w.distance(p.target,a.center)>a.radius||v>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!xe.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(xe.areEqual(s.loci,r.loci)){a=s;break}n++}if(a){W0(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(r),this.state.history.length>U5e&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!xe.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=Xt.normalize(r);if(!xe.is(n)||xe.isEmpty(n)){this.clear();return}this.set({loci:n,label:Jf(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&xe.is(r)&&r.structure===this.state.current.loci.structure?xe.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Mr.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(!r.current){this.clear();return}var i=r.current,o=i.label,s=i.ref,u=i.bundle,l=i.category,c=(a=(n=this.plugin.state.data.select(Kt.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!!c){var d=Mr.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(uc),Ch=new To("98"),V5e=24,H5e=function(e){Pe(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:G5e()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(!!n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new TA(xe(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=Bs.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Ee.size(s[u].indices);Bs.add(a,a,Bs.ofLoci(o.selection))}});var i=sg(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!xe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=xe.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!xe.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!xe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=xe.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!xe.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!xe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=xe.intersect(n.selection,r),this.referenceLoci=r,!xe.areEqual(a,n.selection)},t.prototype.set=function(r){if(!xe.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!xe.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){i===void 0&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":W0(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=a?Math.min(o.length,a):o.length;;)if(u=u%l,u<0&&(u+=l),!i||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.tryAddHistory=function(r){if(!Xt.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(Xt.areEqual(s.loci,r)){a=s;break}n++}if(a){W0(this.additionsHistory,n),this.additionsHistory.unshift(a),this.events.additionsHistoryUpdated.next(void 0);return}var u=Bs.ofLoci(r),l=sg(u,{reverse:!0});this.additionsHistory.unshift({id:Jr.create22(),loci:r,label:l}),this.additionsHistory.length>V5e&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++){var o=i[a];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next(void 0)},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),(n==null?void 0:n.data)&&this.clearHistoryForStructure(n.data),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(!(n===a||(n==null?void 0:n.data)===a.data)){var l=this.plugin.helpers.substructureParent.get(a.data,!0);if(!!l&&r===l.transform.ref&&!!this.entries.has(r)){var c=(o=(i=this.plugin.helpers.substructureParent.get(a.data))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!c)if(!(n==null?void 0:n.data)||Ne.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,q5e(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=xe.remap(this.referenceLoci,c));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var v=p[f];v.loci.structure.root===c.root&&(v.loci=xe.remap(v.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new TA(xe(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next(void 0)}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);xe.isEmpty(i.selection)||n.push(i.selection),i.selection=xe(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:yr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(!!n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=(a=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!xe.isEmpty(o.selection)},t.prototype.has=function(r){if(xe.is(r)){var n=this.getEntry(r.structure);if(n)return xe.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(!!xe.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(!!n){var a=r.elements[0];if(!!a){var i=this.referenceLoci;if(!(!i||!xe.is(i)||i.structure!==r.structure)){for(var o,s=0,u=i.elements;s<u.length;s++){var l=u[s];if(a.unit===l.unit){o=l;break}}if(!!o&&a.unit===o.unit)return j5e(r.structure,o,a)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=xe.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=w.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=w.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);Ch.reset();var a=[];this.entries.forEach(function(c){var d=c.selection;xe.isEmpty(d)||a.push(xe.getBoundary(d))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,l=s.sphere;w.min(r,r,u.min),w.max(n,n,u.max),Ch.includePositionRadius(l.center,l.radius)}Ch.finishedIncludeStep();for(var i=0,o=a.length;i<o;++i){var l=a[i].sphere;Ch.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:Ch.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=cS(this.entries.values());return xe.getPrincipalAxesMany(r.map(function(n){return n.selection}))},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n);break}a&&(this.state.stats=void 0,this.events.changed.next(void 0))},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(a===void 0&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a);break}},t.prototype.fromLoci=function(r,n,a){a===void 0&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){a===void 0&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var s=o[i],u=n(new Co(s));this.triggerInteraction(r,ot.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;a===void 0&&(a=!0),this.plugin.runTask(Fe.create("Structure Selection",function(o){return se(i,void 0,void 0,function(){var s,u,l,c;return ie(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,ot.toLociWithSourceUnits(c),a),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=Zn.resolveAndCheck(this.plugin.state.data,r);if(!(!a||!a.obj)){if(!fe.Molecule.Structure.Selections.is(a.obj)){console.warn("fromSelections applied to wrong object type.",a.obj);return}this.clear();for(var i=0,o=(n=a.obj)===null||n===void 0?void 0:n.data;i<o.length;i++){var s=o[i];this.fromLoci("set",s.loci)}}},t}(uc);function G5e(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var TA=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(Xt.isEmpty(this._selection)?this._structure=void 0:this._structure=xe.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function q5e(e,t){return new TA(xe.remap(e.selection,t))}function j5e(e,t,r){var n=Math.min(Ee.min(t.indices),Ee.min(r.indices)),a=Math.max(Ee.max(t.indices),Ee.max(r.indices));return xe(e,[{unit:t.unit,indices:Ee.ofRange(n,a)}])}var W5e=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],W3=[["full","Full"],["hidden","Hidden"]],X5e={isExpanded:E.Boolean(!1),showControls:E.Boolean(!0),regionState:E.Group({left:E.Select("full",W5e),top:E.Select("full",W3),right:E.Select("full",W3),bottom:E.Select("full",W3)}),controlsDisplay:E.Value("outside",{isHidden:!0})},Y5e=function(e){Pe(t,e);function t(r){var n=e.call(this,_(_({},E.getDefaultValues(X5e)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,ft.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document!="undefined"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:(a[s].name||"").toLowerCase()==="viewport"&&i.push(a[s]);for(var u=0,l=i;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),p=f.scrollLeft,v=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:v,scrollLeft:p,position:d.position,overflow:d.overflow,viewports:i,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var m=this.rootState,h=0,g=m.viewports;h<g.length;h++){var c=g[h];n.appendChild(c)}var d=r.style;d.top=m.top,d.bottom=m.bottom,d.left=m.left,d.right=m.right,d.width=m.width,d.height=m.height,d.maxWidth=m.maxWidth,d.maxHeight=m.maxHeight,d.margin=m.margin,d.marginLeft=m.marginLeft,d.marginRight=m.marginRight,d.marginTop=m.marginTop,d.marginBottom=m.marginBottom,d.position=m.position,d.overflow=m.overflow||"";var f=this.getScrollElement();f.scrollTop=m.scrollTop,f.scrollLeft=m.scrollLeft,this.rootState=void 0,this.root.style.zIndex=m.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(uc),JE={includeTypes:E.MultiSelect(US(vr.Names),E.objectToOptions(vr.Names)),excludeTypes:E.MultiSelect([],E.objectToOptions(vr.Names)),ignoreHydrogens:E.Boolean(!1),aromaticBonds:E.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:E.Select("symmetric",E.arrayToOptions(["off","symmetric","offset"]))};E.getDefaultValues(JE);var e5=_(_(_({},Tp),JE),{adjustCylinderLength:E.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})});E.getDefaultValues(e5);var t5=_(_({},KV),JE);E.getDefaultValues(t5);function bx(e,t,r){return!vr.is(e,r)||vr.is(t,r)}function aG(e,t,r){var n=t.elements,a=t.model.atomicHierarchy.derived.atom.atomicNumber,i=t.bonds,o=i.a,s=i.b,u=i.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,p=vr.fromNames(d),v=vr.fromNames(f),m=vr.isAll(p)&&v===0,h=e.child,g=h==null?void 0:h.unitMap.get(t.id);if(h&&!g)throw new Error("expected childUnit to exist if child exists");if(!(m&&!c&&!h))return function(y){return!!g&&!ze.has(g.elements,n[o[y]])||c&&(x2(a,n[o[y]])||x2(a,n[s[y]]))||!m&&bx(p,v,l[y])}}function iG(e,t){var r=e.interUnitBonds,n=r.edges,a=t.ignoreHydrogens,i=t.includeTypes,o=t.excludeTypes,s=vr.fromNames(i),u=vr.fromNames(o),l=vr.isAll(s)&&u===0,c=e.child;if(!(l&&!a&&!c))return function(d){if(c){var f=n[d],p=c.unitMap.get(f.unitA);if(!p)return!0;var v=e.unitMap.get(f.unitA),m=v.elements[f.indexA];if(!ze.has(p.elements,m))return!0}if(a){var f=n[d],h=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(S2(h,h.elements[f.indexA])||S2(g,g.elements[f.indexB]))return!0}return!!(!l&&bx(s,u,n[d].props.flag))}}var Od;(function(e){function t(n){var a=n.group,i=n.structure,o=a.units[0],s=Be.isAtomic(o)?o.bonds.edgeCount*2:0,u=a.units.length,l=Ot.Location(i,void 0,void 0,i,void 0,void 0),c=function(d,f){var p=a.units[f];return l.aUnit=p,l.bUnit=p,l.aIndex=p.bonds.a[d],l.bIndex=p.bonds.b[d],l};return sn(s,u,1,c)}e.fromGroup=t;function r(n){var a=n.interUnitBonds.edgeCount,i=1,o=Ot.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return sn(a,i,1,s,!0)}e.fromStructure=r})(Od||(Od={}));function r5(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Be.isAtomic(u)){var l=o.target,c=u.bonds.a[i],d=u.bonds.b[i];return Ot.Loci(l,[Ot.Location(l,u,c,l,u,d),Ot.Location(l,u,d,l,u,c)])}}return yr}function n5(e,t,r,n){var a=!1;if(Ot.isLoci(e)){var i=t.structure,o=t.group;if(!Ne.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!Be.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);p!==-1&&r(Ce.ofSingleton(f*u+p))&&(a=!0)}}}}else if(xe.is(e)){var i=t.structure,o=t.group;if(!Ne.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!Be.isAtomic(s))return!1;for(var v=s.bonds.edgeCount*2,m=function(x){var A=o.unitIndexMap.get(x.unit.id);if(A!==void 0){var P=s.bonds,T=P.offset,D=P.b;Ee.forEach(x.indices,function(I){for(var M=T[I],B=T[I+1];M<B;M++)(!n||Ee.has(x.indices,D[M]))&&r(Ce.ofSingleton(A*v+M))&&(a=!0)})}},h=0,g=e.elements;h<g.length;h++){var y=g[h];m(y)}}return a}function a5(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.target,o=t.interUnitBonds.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Ot.Loci(i,[Ot.Location(i,s,o.indexA,i,u,o.indexB),Ot.Location(i,u,o.indexB,i,s,o.indexA)])}return yr}var X3=new Map;function i5(e,t,r,n){var a=!1;if(Ot.isLoci(e)){if(!Ne.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var s=o[i],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Ce.ofSingleton(u))&&(a=!0)}}else if(xe.is(e)){if(!Ne.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=0,c=e.elements;l<c.length;l++){var d=c[l];X3.set(d.unit.id,d.indices)}for(var f=function(m){var h=m.unit;if(!Be.isAtomic(h))return"continue";t.interUnitBonds.getConnectedUnits(h.id).forEach(function(g){var y=X3.get(g.unitB);(!n||y)&&Ee.forEach(m.indices,function(b){!g.connectedIndices.includes(b)||g.getEdges(b).forEach(function(S){if(!n||y&&Ee.has(y,S.indexB)){var C=t.interUnitBonds.getEdgeIndex(b,h.id,S.indexB,g.unitB);r(Ce.ofSingleton(C))&&(a=!0)}})})})},p=0,v=e.elements;p<v.length;p++){var d=v[p];f(d)}X3.clear()}return a}var Y3=vr.is;function oG(e,t,r,n){var a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,l=i.edgeProps,c=i.offset,d=l.order,f=l.flags,p=n.sizeFactor,v=n.sizeAspectRatio,m=n.adjustCylinderLength,h=n.aromaticBonds,g=n.includeTypes,y=n.excludeTypes,b=n.multipleBonds,S=b==="off",C=b==="symmetric",x=vr.fromNames(g),A=vr.fromNames(y),P=bx(x,A,32),T=w(),D=w(),I=e.conformation.invariantPosition,M,B=He.create(t,e),U=Ot.Location(t,e,void 0,t,e,void 0),V=t.child;if(n.includeParent&&V){var F=V.unitMap.get(e.id);if(!F)throw new Error("expected childUnit to exist");M=function(N){var j=a[s[N]],L=a[u[N]];return ze.has(F.elements,j)&&!ze.has(F.elements,L)}}var Y=function(N){return U.aIndex=s[N],U.bIndex=u[N],r.size.size(U)*p},W=function(N){return B.element=a[s[N]],r.size.size(B)*p},K=function(N){return B.element=a[u[N]],r.size.size(B)*p},$=e.rings,J=$.elementRingIndices,Z=$.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(N){var j,L,H=s[N],G=u[N];H>G&&(j=[G,H],H=j[0],G=j[1]),c[H+1]-c[H]===1&&(L=[G,H],H=L[0],G=L[1]);for(var q=Z.get(H)||J.get(H),X=0,Q=c[H],ue=c[H+1];Q<ue;++Q){var le=u[Q];if(le!==G&&le!==H)if(q){var ve=Z.get(le)||J.get(le);if(!ve)continue;var ge=Cb(q,ve);ge>X&&(X=ge,I(a[le],T))}else return I(a[le],T)}return X>0?T:null},position:function(N,j,L){if(I(a[s[L]],N),I(a[u[L]],j),m){var H=W(L),G=K(L),q=Math.min(H,G)*v,X=Math.sqrt(Math.max(0,H*H-q*q))-.05,Q=Math.sqrt(Math.max(0,G*G-q*q))-.05;if(X<=.01&&Q<=.01)return;w.normalize(D,w.sub(D,j,N)),w.scaleAndAdd(N,N,D,X),w.scaleAndAdd(j,j,D,-Q)}},style:function(N){var j=d[N],L=f[N];if(Y3(L,2)||Y3(L,4))return 1;if(j===3)return S?0:C?4:5;if(h){var H=s[N],G=u[N],q=Z.get(H),X=Z.get(G),Q=q&&X?Cb(q,X):0;if(Y3(L,16)||Q&&!P)return Q===2?8:7}return j!==2||S?0:C?2:3},radius:function(N){return Y(N)*v},ignore:aG(t,e,n),stub:M}}function K5e(e,t,r,n,a,i){if(!Be.isAtomic(t)||!t.bonds.edgeCount)return ho.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return ho.createEmpty(i);var u=oG(t,r,n,a),l=QV(e,u,a,i),c=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}function Q5e(e,t,r,n,a,i){if(!Be.isAtomic(t)||!t.bonds.edgeCount)return Rt.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Rt.createEmpty(i);var u=oG(t,r,n,a),l=Pp(e,u,a,i),c=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return l.setBoundingSphere(c),l}var Sx=_(_(_(_({},$a),XV),e5),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:E.Boolean(!0),includeParent:E.Boolean(!1)});function sG(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Z5e(e):$5e(e)}function Z5e(e){return YV({defaultProps:E.getDefaultValues(Sx),createGeometry:K5e,createLocationIterator:Od.fromGroup,getLoci:r5,eachLocation:n5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],l=s.group.units[0];Be.isAtomic(u)&&Be.isAtomic(l)&&(eo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function $5e(e){return Bi({defaultProps:E.getDefaultValues(Sx),createGeometry:Q5e,createLocationIterator:Od.fromGroup,getLoci:r5,eachLocation:n5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],l=s.group.units[0];Be.isAtomic(u)&&Be.isAtomic(l)&&(eo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var K3=new Ot.ElementBondIterator;function ZB(e,t,r,n){for(K3.setElement(t,r,n);K3.hasNext;){var a=K3.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var $B=w();function uG(e,t,r){var n=He.create(e),a=Ot.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=r.multipleBonds,p=f==="off",v=f==="symmetric",m=w(),h,g=e.child;r.includeParent&&g&&(h=function(C){var x=s[C],A=g.unitMap.get(x.unitA),P=g.unitMap.get(x.unitB),T=e.unitMap.get(x.unitA),D=T.elements[x.indexA],I=e.unitMap.get(x.unitB),M=I.elements[x.indexB];return A&&ze.has(A.elements,D)&&(!P||!ze.has(P.elements,M))});var y=function(C){var x=s[C];return a.aUnit=e.unitMap.get(x.unitA),a.aIndex=x.indexA,a.bUnit=e.unitMap.get(x.unitB),a.bIndex=x.indexB,t.size.size(a)*u},b=function(C){var x=s[C];return n.unit=e.unitMap.get(x.unitA),n.element=n.unit.elements[x.indexA],t.size.size(n)*u},S=function(C){var x=s[C];return n.unit=e.unitMap.get(x.unitB),n.element=n.unit.elements[x.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(C){var x=s[C],A,P,T,D;if(x.unitA<x.unitB)A=e.unitMap.get(x.unitA),P=e.unitMap.get(x.unitB),T=x.indexA,D=x.indexB;else if(x.unitA>x.unitB)A=e.unitMap.get(x.unitB),P=e.unitMap.get(x.unitA),T=x.indexB,D=x.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return ZB($B,e,A,T)||ZB($B,e,P,D)},position:function(C,x,A){var P=s[A],T=e.unitMap.get(P.unitA),D=e.unitMap.get(P.unitB);if(T.conformation.position(T.elements[P.indexA],C),D.conformation.position(D.elements[P.indexB],x),c){var I=b(A),M=S(A),B=Math.min(I,M)*l,U=Math.sqrt(Math.max(0,I*I-B*B))-.05,V=Math.sqrt(Math.max(0,M*M-B*B))-.05;if(U<=.01&&V<=.01)return;w.normalize(m,w.sub(m,x,C)),w.scaleAndAdd(C,C,m,U),w.scaleAndAdd(x,x,m,-V)}},style:function(C){var x=s[C].props.order,A=Xa.create(s[C].props.flag);return vr.is(A,2)||vr.is(A,4)?1:x===3?p?0:v?4:5:d&&vr.is(A,16)?7:x!==2||p?0:v?2:3},radius:function(C){return y(C)*l},ignore:iG(e,r),stub:h}}function J5e(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return ho.createEmpty(a);var i=uG(t,r,n),o=QV(e,i,n,a),s=t.child,u=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function eIe(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return Rt.createEmpty(a);var i=uG(t,r,n),o=Pp(e,i,n,a),s=t.child,u=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var xx=_(_(_(_({},zg),iwe),e5),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:E.Boolean(!0),includeParent:E.Boolean(!1)});function lG(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?tIe(e):rIe(e)}function tIe(e){return owe({defaultProps:E.getDefaultValues(xx),createGeometry:J5e,createLocationIterator:Od.fromStructure,getLoci:a5,eachLocation:i5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function rIe(e){return _p({defaultProps:E.getDefaultValues(xx),createGeometry:eIe,createLocationIterator:Od.fromStructure,getLoci:a5,eachLocation:i5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var JB=new Float32Array([-1,1,-1,-1,1,1,1,-1]),ev=new Uint16Array([0,1,2,1,3,2]),Q3=Le.add3,nIe=Le.add2,aIe=Le.add,O2;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var i=Le.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Le.create(Float32Array,2,n,a?a.mappingBuffer.ref.value:r),s=Le.create(Uint32Array,3,n/2,a?a.indexBuffer.ref.value:r/2),u=Le.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var p=i.elementCount,v=0;v<4;++v)Q3(i,l,c,d),nIe(o,JB[v*2],JB[v*2+1]),aIe(u,f);Q3(s,p+ev[0],p+ev[1],p+ev[2]),Q3(s,p+ev[3],p+ev[4],p+ev[5])},getSpheres:function(){var l=Le.compact(i,!0),c=Le.compact(o,!0),d=Le.compact(s,!0),f=Le.compact(u,!0);return Dd.create(l,c,d,f,i.elementCount/4,a)}}}e.create=t})(O2||(O2={}));var cG=w.add;function Cx(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=t.model.atomicHierarchy.derived.atom.atomicNumber,o=Be.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!a))return function(l){return!!u&&!ze.has(u.elements,l)||!o&&n&&x2(i,l)||a&&!BE(t,l)}}function iIe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Rt.createEmpty(i);for(var u=a.detail,l=a.sizeFactor,c=t.elements,d=c.length,f=d*qS(u),p=ct.createState(f,f/2,i),v=w(),m=t.conformation.invariantPosition,h=Cx(r,t,a),g=He.create(r,t),y=n.size.size,b=w(),S=0,C=0,x=0;x<d;x++)if(!(h&&h(c[x]))){g.element=c[x],m(c[x],v),cG(b,b,v),C+=1,p.currentGroup=x;var A=y(g);A>S&&(S=A),la(p,v,A*l,u)}var P;w.scale(b,b,1/C),i&&w.distance(b,i.boundingSphere.center)/i.boundingSphere.radius<1?P=Me.clone(i.boundingSphere):P=Me.expand(Me(),(s!=null?s:t).boundary.sphere,S*l+.05);var T=ct.getMesh(p);return T.setBoundingSphere(P),T}function oIe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Dd.createEmpty(i);for(var u=t.elements,l=u.length,c=O2.create(l,l/2,i),d=w(),f=t.conformation.invariantPosition,p=Cx(r,t,a),v=He.create(r,t),m=n.size.size,h=w(),g=0,y=0,b=0;b<l;b++)if(!(p==null?void 0:p(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),cG(h,h,d),y+=1,v.element=u[b];var S=m(v);S>g&&(g=S)}var C;w.scale(h,h,1/y),i&&w.distance(h,i.boundingSphere.center)/i.boundingSphere.radius<1?C=Me.clone(i.boundingSphere):C=Me.expand(Me(),(s!=null?s:t).boundary.sphere,g*a.sizeFactor+.05);var x=c.getSpheres();return x.setBoundingSphere(C),x}function eu(e,t,r){var n=!1;if(!xe.is(e))return!1;var a=t.structure,i=t.group;if(!Ne.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=i.unitIndexMap,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.get(c.unit.id);if(d!==void 0){var f=d*o;if(Ce.is(c.indices)){var p=f+Ce.start(c.indices),v=f+Ce.end(c.indices);r(Ce.ofBounds(p,v))&&(n=!0)}else for(var m=0,h=c.indices.length;m<h;m++){for(var p=c.indices[m],g=m+1;g<h&&c.indices[g]===p;)g++;m=g-1;var v=c.indices[m];n=r(Ce.ofRange(f+p,f+v))||n}}}return n}function tu(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Ee.ofSingleton(i);return xe(o.target,[{unit:u,indices:l}])}return yr}function wx(e,t,r){var n=!1;if(!xe.is(e)||!Ne.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Ce.is(s.indices)){var l=a[u]+Ce.start(s.indices),c=a[u]+Ce.end(s.indices);r(Ce.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var p=a[u]+s.indices[d];r(Ce.ofSingleton(p))&&(n=!0)}}return n}function _x(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.serialMapping,o=i.unitIndices,s=i.cumulativeUnitElementCount,u=o[a],l=t.units[u],c=a-s[u],d=Ee.ofSingleton(c);return xe(t,[{unit:l,indices:d}])}return yr}var Za;(function(e){function t(n){var a=n.group,i=n.structure,o=a.elements.length,s=a.units.length,u=He.create(i),l=function(c,d){var f=a.units[d];return u.unit=f,u.element=f.elements[c],u};return sn(o,s,1,l)}e.fromGroup=t;function r(n){var a=n.units,i=n.elementCount,o=i,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=He.create(n),f=function(p){return d.unit=a[l[p]],d.element=c[p],d};return sn(o,s,1,f,!0)}e.fromStructure=r})(Za||(Za={}));var Ax=_(_(_({},$a),jV),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),ignoreHydrogens:E.Boolean(!1),traceOnly:E.Boolean(!1),tryUseImpostor:E.Boolean(!0)});function dG(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?sIe(e):uIe(e)}function sIe(e){return WV({defaultProps:E.getDefaultValues(Ax),createGeometry:oIe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function uIe(e){return Bi({defaultProps:E.getDefaultValues(Ax),createGeometry:iIe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var fG={"element-sphere":function(e,t){return yn("Element sphere",e,t,dG)},"intra-bond":function(e,t){return yn("Intra-unit bond cylinder",e,t,sG)},"inter-bond":function(e,t){return Hs("Inter-unit bond cylinder",e,t,lG)}},pG=_(_(_(_(_({},Ax),{traceOnly:E.Boolean(!1,{isHidden:!0})}),Sx),xx),{includeParent:E.Boolean(!1),unitKinds:Ug(["atomic"]),sizeFactor:E.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:E.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:E.MultiSelect(["element-sphere","intra-bond","inter-bond"],E.objectToOptions(fG)),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)});function lIe(e,t){return E.clone(pG)}function cIe(e,t){return Yt.createMulti("Ball & Stick",e,t,va,fG)}var dIe={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:cIe,getParams:lIe,defaultValues:E.getDefaultValues(pG),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function fIe(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,l=He.create(t),c={linkCount:o.length,position:function(d,f,p){var v=o[p];w.copy(d,s[v.carbohydrateIndexA].geometry.center),w.copy(f,s[v.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],p=s[f.carbohydrateIndexA],v=p.unit.rings.all[p.ringIndex];return l.unit=p.unit,l.element=p.unit.elements[v[0]],r.size.size(l)*u}};return Pp(e,c,n,a)}var vG=_(_(_({},$a),Tp),{linkSizeFactor:E.Numeric(.3,{min:0,max:3,step:.01})});function pIe(e){return _p({defaultProps:E.getDefaultValues(vG),createGeometry:fIe,createLocationIterator:vIe,getLoci:mIe,eachLocation:hIe,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function vIe(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,i=1,o=He.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return sn(a,i,1,s,!0)}function mIe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.links,s=i.elements,u=o[a],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return xe.union(cg(t,l.unit,l.residueIndex,l.altId),cg(t,c.unit,c.residueIndex,c.altId))}return yr}var Z3=new Set;function hIe(e,t,r){var n=!1;if(!xe.is(e)||!Ne.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(d,f){if(!Be.isAtomic(d))return"continue";Z3.clear(),Ee.forEach(f,function(p){for(var v=a(d,d.elements[p]),m=0,h=v.length;m<h;++m)Z3.has(v[m])||(Z3.add(v[m]),r(Ce.ofSingleton(v[m]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var gIe=w.create(0,0,-.5),yIe=w.create(0,0,.5),Sc=w(),xc=w(),r1=w(),ek=w();function bIe(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,a=t===4?t*3+4:n*3,i=km(n,a),o=0;o<t;++o){var s=(o+1)%t;w.set(Sc,e[o*3],e[o*3+1],-.5),w.set(xc,e[s*3],e[s*3+1],-.5),i.add(Sc,xc,yIe)}if(t===3)w.set(Sc,e[0],e[1],-.5),w.set(xc,e[3],e[4],-.5),w.set(r1,e[6],e[7],-.5),i.add(r1,xc,Sc);else if(t===4)w.set(Sc,e[0],e[1],-.5),w.set(xc,e[3],e[4],-.5),w.set(r1,e[6],e[7],-.5),w.set(ek,e[9],e[10],-.5),i.addQuad(ek,r1,xc,Sc);else for(var o=0;o<t;++o){var s=(o+1)%t;w.set(Sc,e[o*3],e[o*3+1],-.5),w.set(xc,e[s*3],e[s*3+1],-.5),i.add(gIe,xc,Sc)}return i.getPrimitive()}var $3;function SIe(){return $3||($3=bIe(zu(8,!0))),$3}var J3;function xIe(){if(!J3){for(var e=zu(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];J3=DS(t,n)}return J3}var CIe={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},ew=w.zero(),tw=w.zero(),rw=w.zero(),wh=w.zero(),nw=w.zero();function wIe(e){for(var t=_(_({},CIe),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,o=i*2*2,s=km(o),u=new Float32Array(i*2),l=new Float32Array(i*2),c=0;c<i;++c){var d=c*2,f=c*2+1,p=(d+1)/i*Math.PI,v=(f+1)/i*Math.PI;l[d]=Math.cos(p)*r,l[f]=Math.sin(p)*r,u[d]=Math.cos(v)*n,u[f]=Math.sin(v)*n}w.set(ew,0,0,a/2),w.set(tw,0,0,-a/2);for(var c=0;c<i;++c){var m=(c+1)%i;w.set(rw,l[c*2],l[c*2+1],0),w.set(wh,u[c*2],u[c*2+1],0),w.set(nw,l[m*2],l[m*2+1],0),s.add(ew,rw,wh),s.add(wh,rw,tw),s.add(ew,wh,nw),s.add(nw,wh,tw)}return s.getPrimitive()}var mG=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],_Ie=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],AIe=[0,2,4,0,4,3,1,2,5,1,5,3],aw;function TIe(){return aw||(aw=DS(mG,_Ie)),aw}var iw;function PIe(){return iw||(iw=DS(mG,AIe)),iw}var Mt=oe.identity(),Zu=w(),tk=w(),EIe=2*.806,rk=YP(),nk=Zle(),IIe=SIe(),ak=xIe(),DIe=wIe({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),MIe=TIe(),ik=PIe(),ok=Qpe(),RIe=Zpe(),OIe=$pe(),BIe=Jpe(),kIe=eve();function LIe(e,t,r,n,a){for(var i=ct.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=He.create(t),d=0;d<l;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],v=UJ(f.component.type,p.length);c.unit=f.unit,c.element=f.unit.elements[p[0]];var m=r.size.size(c),h=m*s,g=m*s*EIe,y=f.geometry,b=y.center,S=y.normal,C=y.direction;switch(w.add(tk,b,C),oe.targetTo(Mt,b,tk,S),oe.setTranslation(Mt,b),i.currentGroup=d*2,v){case 0:la(i,b,h,o);break;case 1:oe.scaleUniformly(Mt,Mt,g),ct.addPrimitive(i,Mt,rk);break;case 2:oe.scaleUniformly(Mt,Mt,g),ct.addPrimitive(i,Mt,nk),oe.mul(Mt,Mt,oe.rotZ90X180),i.currentGroup+=1,ct.addPrimitive(i,Mt,nk);break;case 4:oe.scaleUniformly(Mt,Mt,g*1.2),ct.addPrimitive(i,Mt,IIe);break;case 5:oe.scaleUniformly(Mt,Mt,g*1.2),ct.addPrimitive(i,Mt,ak),oe.mul(Mt,Mt,oe.rotZ90),i.currentGroup+=1,ct.addPrimitive(i,Mt,ak);break;case 6:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g,g/2)),ct.addPrimitive(i,Mt,rk);break;case 7:oe.scaleUniformly(Mt,Mt,g),oe.mul(Mt,Mt,oe.rotZY90),ct.addPrimitive(i,Mt,DIe);break;case 8:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g*1.4,g*1.4,g*1.4)),ct.addPrimitive(i,Mt,MIe);break;case 3:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g*1.4,g*1.4,g*1.4)),ct.addPrimitive(i,Mt,ik),oe.mul(Mt,Mt,oe.rotY90),i.currentGroup+=1,ct.addPrimitive(i,Mt,ik);break;case 9:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g/2,g/2)),ct.addPrimitive(i,Mt,ok);break;case 12:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g,g/2)),ct.addPrimitive(i,Mt,ok);break;case 13:case 11:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g,g/2)),ct.addPrimitive(i,Mt,RIe);break;case 14:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g,g/2)),ct.addPrimitive(i,Mt,OIe);break;case 15:oe.mul(Mt,Mt,oe.rotZY90),oe.scale(Mt,Mt,w.set(Zu,g,g,g/2)),ct.addPrimitive(i,Mt,kIe);break;case 10:default:oe.mul(Mt,Mt,oe.rotZYZ90),oe.scale(Mt,Mt,w.set(Zu,g/1.5,g,g/2)),ct.addPrimitive(i,Mt,BIe);break}}return ct.getMesh(i)}var hG=_(_({},zg),{detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),sizeFactor:E.Numeric(1.75,{min:0,max:10,step:.01})});function FIe(e){return _p({defaultProps:E.getDefaultValues(hG),createGeometry:LIe,createLocationIterator:NIe,getLoci:UIe,eachLocation:zIe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function NIe(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,a=He.create(e);function i(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return a.unit=l.unit,a.element=l.unit.elements[c[0]],a}function o(s,u){return s%2===1}return sn(r,n,1,i,!0,o)}function UIe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates.elements[Math.floor(a/2)];return cg(t,i.unit,i.residueIndex,i.altId)}return yr}var ow=new Set;function zIe(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!xe.is(e)||!Ne.areEquivalent(e.structure,t))return!1;for(var i=function(d,f){if(!Be.isAtomic(d))return"continue";ow.clear(),Ee.forEach(f,function(p){for(var v=n(d,d.elements[p]),m=0,h=v.length;m<h;++m)ow.has(v[m])||(ow.add(v[m]),r(Ce.ofSingleton(v[m]*2))&&(a=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return a}function VIe(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,l=He.create(t),c={linkCount:o.length,position:function(d,f,p){var v=o[p];v.fromCarbohydrate?(w.copy(d,s[v.carbohydrateIndex].geometry.center),v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],f)):(v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],d),w.copy(f,s[v.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var p=s[f.carbohydrateIndex],v=p.unit.rings.all[p.ringIndex];l.unit=p.unit,l.element=p.unit.elements[v[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],p=f.elementUnit.elements[f.elementIndex],v=Cu(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(p));return J0.has(v)?1:0}};return Pp(e,c,n,a)}var gG=_(_(_({},$a),Tp),{terminalLinkSizeFactor:E.Numeric(.2,{min:0,max:3,step:.01})});function HIe(e){return _p({defaultProps:E.getDefaultValues(gG),createGeometry:VIe,createLocationIterator:GIe,getLoci:qIe,eachLocation:jIe,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function GIe(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,i=1,o=He.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return sn(a,i,1,s,!0)}function qIe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=o[a],l=s[u.carbohydrateIndex];return xe.union(cg(t,l.unit,l.residueIndex,l.altId),Y3e(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return yr}var sw=new Set;function jIe(e,t,r){var n=!1;if(!xe.is(e)||!Ne.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(d,f){if(!Be.isAtomic(d))return"continue";sw.clear(),Ee.forEach(f,function(p){for(var v=a(d,d.elements[p]),m=0,h=v.length;m<h;++m)sw.has(v[m])||(sw.add(v[m]),r(Ce.ofSingleton(v[m]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;i(l,c)}return n}var yG={"carbohydrate-symbol":function(e,t){return Hs("Carbohydrate symbol mesh",e,t,FIe)},"carbohydrate-link":function(e,t){return Hs("Carbohydrate link cylinder",e,t,pIe)},"carbohydrate-terminal-link":function(e,t){return Hs("Carbohydrate terminal link cylinder",e,t,HIe)}},bG=_(_(_(_({},hG),vG),gG),{visuals:E.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],E.objectToOptions(yG)),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)});function WIe(e,t){return E.clone(bG)}function XIe(e,t){return Yt.createMulti("Carbohydrate",e,t,va,yG)}var YIe={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:XIe,getParams:WIe,defaultValues:E.getDefaultValues(bG),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return zt.hasCarbohydrate(t)})}};function SG(e,t){switch(e.kind){case 0:return KIe(e,t);case 1:case 2:return QIe(e,t)}}function KIe(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Br.transientSegments(Wg(e),e.elements),a=Qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,a.setSegment(n.move());a.hasNext;){if(l){var f=a.move().index;if(++d,!a.hasNext)continue;l=!1,u=f}var p=a.move().index;s=u,u=p,t(i[s],i[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(i[s],i[u],d-1,c,o[s]))}}function QIe(e,t){for(var r=Br.transientSegments(Wg(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(a){if(++l,++i,l>c)continue;a=!1}t(n[l-1],n[l],i-1,i,0),++i}}}function xG(e,t){switch(e.kind){case 0:return ZIe(e,t);case 1:case 2:return $Ie(e,t)}}function ZIe(e,t){for(var r=Br.transientSegments(Wg(e),e.elements),n=Qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(a[o],i),++i}}function $Ie(e,t){for(var r=Br.transientSegments(Wg(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),o=i.start,s=i.end,u=o,l=s;u<l;++u)t(n[u],a),++a}function JIe(e,t){switch(t.kind){case 0:return new eDe(e,t);case 1:case 2:return new tDe(e,t)}}function CG(e,t){return{centerA:He.create(e,t),centerB:He.create(e,t)}}var eDe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Br.transientSegments(AG(r),r.elements),this.value=CG(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),tDe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Br.transientSegments(AG(r),r.elements),this.value=CG(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function rDe(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,o=i.polymerType,s=i.traceElementIndex,u=o.length,l=Ee.ofBounds(0,e.atomicConformation.atomId.rowCount),c=Br.transientSegments(e.atomicRanges.polymerRanges,l),d=Qt.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),p=new Float32Array(u*3),v=0,m=-1,h=-1,g=w(),y=w(),b=w(),S=w(),C=w(),x=w(),A=w(),P=w(),T=w(),D=w(),I=w(),M=w(),B=w(),U=w();c.hasNext;){var V=c.move();for(d.setSegment(V),v=-1,h=-1;d.hasNext;){v+=1;var F=d.move().index;v===0&&(h=F),m=F-2;var Y=m*3;w.copy(g,y),w.copy(y,b),w.copy(b,S);var W=s[F];if(w.set(S,r[W],n[W],a[W]),!(v<3)){w.sub(C,y,g),w.sub(x,b,y),w.sub(A,S,b),w.sub(I,C,x),w.sub(M,x,A),w.cross(B,I,M),w.normalize(B,B),w.toArray(B,p,Y);var K=Math.cos(w.angle(I,M)),$=w.magnitude(I),J=w.magnitude(M),Z=Math.sqrt(J*$)/Math.max(2,2*(1-K));w.scale(P,I,Z/$),w.sub(P,y,P),w.toArray(P,f,Y),w.scale(T,M,Z/J),w.sub(T,b,T),w.toArray(T,f,Y+3),w.copy(U,B)}}var N=h*3;w.fromArray(P,f,N+3),w.fromArray(T,f,N+6),w.normalize(B,w.sub(B,P,T));var j=s[h];w.set(g,r[j],n[j],a[j]),w.copy(D,g),w.projectPointOnVector(D,D,B,P),w.toArray(D,f,N);var L=m+2,H=L*3;w.fromArray(P,f,H-3),w.fromArray(T,f,H-6),w.normalize(B,w.sub(B,P,T));var G=s[L];w.set(g,r[G],n[G],a[G]),w.copy(D,g),w.projectPointOnVector(D,D,B,P),w.toArray(D,f,H)}return{centers:f}}var PA=om.createProvider({label:"Helix Orientation",descriptor:xo({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return se(void 0,void 0,void 0,function(){return ie(this,function(r){return[2,{value:rDe(t)}]})})}});function Cs(e){return Tr.is(e,2)}function nDe(e){return Tr.is(e,4)}function o5(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new aDe(e,t,r);case 1:case 2:return new iDe(e,t)}}var G1=Tr.create(536870912);function wG(e,t){return{center:He.create(e,t),centerPrev:He.create(e,t),centerNext:He.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:G1,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:w(),p1:w(),p2:w(),p3:w(),p4:w(),d12:w(),d23:w()}}var Vt=w(),n1=w(),a1=w(),aDe=function(){function e(t,r,n){n===void 0&&(n={});var a;if(this.unit=t,this.state=0,this.p0=w(),this.p1=w(),this.p2=w(),this.p3=w(),this.p4=w(),this.p5=w(),this.p6=w(),this.d01=w(),this.d12=w(),this.d23=w(),this.d34=w(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Br.transientSegments(this.polymerRanges,t.elements),this.residueIt=Qt.transientSegments(this.residueAtomSegments,t.elements),this.value=wG(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(a=ls.get(r).value)===null||a===void 0?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=PA.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&Cs(n)?w.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,a=r.getIndex,i=n[a(t)];return Cs(i)?2:i}else return G1},e.prototype.setControlPoint=function(t,r,n,a,i){nDe(i)||this.helixOrientationCenters&&Cs(i)?w.scale(t,w.add(t,r,w.add(t,a,w.add(t,n,n))),1/4):w.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&Cs(n)?w.set(t,1,0,0):(this.atomicPos(n1,this.directionFromElementIndex[r]),this.atomicPos(a1,this.directionToElementIndex[r]),w.sub(t,a1,n1))},e.prototype.setDirection=function(t,r,n,a){w.matchDirection(n1,r,n),w.matchDirection(a1,a,n),w.scale(t,w.add(t,n1,w.add(t,a1,w.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?G1:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?G1:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===c,a.final=s===d,a.centerPrev.element=this.traceElementIndex[c],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[d];var v=this.getSecStruc(u),m=this.getSecStruc(l),h=this.getSecStruc(c),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),S=this.getSecStruc(p);this.pos(this.p0,u,v),this.pos(this.p1,l,m),this.pos(this.p2,c,h),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,p,S);var C=Cs(v),x=Cs(m),A=Cs(h),P=Cs(g),T=Cs(y),D=Cs(b),I=Cs(S);this.helixOrientationCenters&&(P!==A?P?(w.copy(this.p0,this.p3),w.copy(this.p1,this.p3),w.copy(this.p2,this.p3)):A&&(w.scale(Vt,w.sub(Vt,this.p2,this.p3),2),w.add(this.p2,this.p3,Vt),w.add(this.p1,this.p2,Vt),w.add(this.p0,this.p1,Vt)):P!==x?P?(w.copy(this.p0,this.p2),w.copy(this.p1,this.p2)):x&&(w.scale(Vt,w.sub(Vt,this.p1,this.p2),2),w.add(this.p1,this.p2,Vt),w.add(this.p0,this.p1,Vt)):P!==C&&(P?w.copy(this.p0,this.p1):C&&(w.scale(Vt,w.sub(Vt,this.p0,this.p1),2),w.add(this.p0,this.p1,Vt))),P!==T?P?(w.copy(this.p4,this.p3),w.copy(this.p5,this.p3),w.copy(this.p6,this.p3)):T&&(w.scale(Vt,w.sub(Vt,this.p4,this.p3),2),w.add(this.p4,this.p3,Vt),w.add(this.p5,this.p4,Vt),w.add(this.p6,this.p5,Vt)):P!==D?P?(w.copy(this.p5,this.p4),w.copy(this.p6,this.p4)):D&&(w.scale(Vt,w.sub(Vt,this.p5,this.p4),2),w.add(this.p5,this.p4,Vt),w.add(this.p6,this.p5,Vt)):P!==I&&(P?w.copy(this.p6,this.p5):I&&(w.scale(Vt,w.sub(Vt,this.p6,this.p5),2),w.add(this.p6,this.p5,Vt)))),this.setFromToVector(this.d01,c,h),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var M=P&&this.helixOrientationCenters,B=1.5;s===c||g!==h&&M?(w.setMagnitude(Vt,w.sub(Vt,this.p3,this.p4),B),w.add(this.p2,this.p3,Vt),w.add(this.p1,this.p2,Vt),w.add(this.p0,this.p1,Vt)):c===l||g!==m&&M?(w.setMagnitude(Vt,w.sub(Vt,this.p2,this.p3),B),w.add(this.p1,this.p2,Vt),w.add(this.p0,this.p1,Vt)):(l===u||g!==v&&M)&&(w.setMagnitude(Vt,w.sub(Vt,this.p1,this.p2),B),w.add(this.p0,this.p1,Vt)),s===d||g!==y&&M?(w.setMagnitude(Vt,w.sub(Vt,this.p3,this.p2),B),w.add(this.p4,this.p3,Vt),w.add(this.p5,this.p4,Vt),w.add(this.p6,this.p5,Vt)):d===f||g!==b&&M?(w.setMagnitude(Vt,w.sub(Vt,this.p4,this.p3),B),w.add(this.p5,this.p4,Vt),w.add(this.p6,this.p5,Vt)):(f===p||g!==S&&M)&&(w.setMagnitude(Vt,w.sub(Vt,this.p5,this.p4),B),w.add(this.p6,this.p5,Vt)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,m),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,h),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,b),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),iDe=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Br.transientSegments(Wg(t),t.elements),this.value=wG(r,t),w.set(this.value.d12,1,0,0),w.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(w.scale(Vt,w.sub(Vt,this.value.p2,this.value.p3),i),w.add(this.value.p1,this.value.p2,Vt),w.add(this.value.p0,this.value.p1,Vt)):r===t&&(w.scale(Vt,w.sub(Vt,this.value.p1,this.value.p2),i),w.add(this.value.p0,this.value.p1,Vt)),this.elementIndex===n?(w.scale(Vt,w.sub(Vt,this.value.p2,this.value.p1),i),w.add(this.value.p3,this.value.p2,Vt),w.add(this.value.p4,this.value.p3,Vt)):n===a&&(w.scale(Vt,w.sub(Vt,this.value.p3,this.value.p2),i),w.add(this.value.p4,this.value.p3,Vt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),tf=w.fromArray,wv=w.toArray,EA=w.normalize,oDe=w.sub,tv=w.spline,sDe=w.slerp,sk=w.copy,uk=w.cross,uw=w.orthogonalize,uDe=w.matchDirection,lDe=w.scale,lk=w.add;function s5(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function u5(e,t,r,n){cDe(e,t,r,n),fDe(e,t)}var lw=w(),cw=w(),dw=w();function cDe(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,p=t.secStrucLast,v=1-n,m=f?.5:r,h=p?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<v){var b=sa(m,r,y);tv(dw,s,u,l,c,y+n,b),tv(lw,s,u,l,c,y+n+.01,m),tv(cw,s,u,l,c,y+n-.01,m)}else{var b=sa(r,h,y);tv(dw,u,l,c,d,y-v,b),tv(lw,u,l,c,d,y-v+.01,b),tv(cw,u,l,c,d,y-v-.01,b)}wv(dw,a,g*3),EA(Vc,oDe(Vc,lw,cw)),wv(Vc,i,g*3)}}var dDe=w(),Vc=w(),ws=w(),rv=w(),_h=w(),ck=w(),dk=w(),fk=w(),fw=w(),i1=w();function fDe(e,t){var r=e.curvePoints,n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;tf(dk,n,0),tf(fk,n,(u-1)*3),uw(fw,dk,o),uw(i1,fk,s),uDe(i1,i1,fw),sk(_h,fw);for(var l=u-1,c=0;c<u;++c){var d=A8(0,l,c)*l,f=c===0?0:1/(u-d);tf(Vc,n,c*3),uw(ws,Vc,sDe(dDe,_h,i1,f)),wv(ws,a,c*3),sk(_h,ws),EA(rv,uk(rv,Vc,ws)),wv(rv,i,c*3)}for(var c=1;c<l;++c)tf(_h,a,(c-1)*3),tf(ws,a,c*3),tf(ck,a,(c+1)*3),lDe(ws,lk(ws,_h,lk(ws,ck,ws)),1/3),wv(ws,a,c*3),tf(Vc,n,c*3),EA(rv,uk(rv,Vc,ws)),wv(rv,i,c*3)}function IA(e,t,r,n,a,i,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var p=f*1/c;p<d?(u[f]=sa(t,r,p+s),l[f]=sa(a,i,p+s)):(u[f]=sa(r,n,p-d),l[f]=sa(i,o,p-d))}}var _G=.5,pDe=.9,Tx=.5,Px=.3,B2=2;function Wg(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function AG(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var jl;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].polymerElements,o=i.length,s=n.units.length,u=He.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return sn(o,s,1,l)}e.fromGroup=t})(jl||(jl={}));var DA;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=He.create(a),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=i[c],u};return sn(o,s,1,l)}e.fromGroup=t})(DA||(DA={}));function kp(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Be.isAtomic(u))return BV(o,u,u.polymerElements[i]);var l=u.elements,c=u.polymerElements[i],d=Ee.indexOf(l,c);if(d!==-1){var f=Ee.ofSingleton(d);return xe(o,[{unit:u,indices:f}])}}return yr}function pk(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++){var l=r[u];if(!(l<0)&&(o=Ee.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=i;u>s;u--){var l=r[u];if(!(l<0)){var d=Ee.indexOf(t,l);if(d>=0){c=d;break}}}return n(Ce.ofRange(e+o,e+c))}function TG(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(a.unit);if(Ce.is(a.indices))if(Ce.start(a.indices)===0&&Ce.end(a.indices)===a.unit.elements.length)i=n(Ce.ofBounds(e,e+t))||i;else{var c=u[o[Ce.min(a.indices)]],d=u[o[Ce.max(a.indices)]];i=pk(e,l,s,n,c,d)||i}else for(var f=a.indices,p=0,v=f.length;p<v;p++){for(var c=u[o[f[p]]],d=c,m=p+1;m<v;){var h=u[o[f[m]]];if(h-d>1)break;d=h,m++}p=m-1,i=pk(e,l,s,n,c,d)||i}return i}function vDe(e){return e.polymerElements}function Lp(e,t,r){var n=!1;if(!xe.is(e))return!1;var a=t.structure,i=t.group;if(!Ne.areEquivalent(e.structure,a))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(!!i.unitIndexMap.has(l.unit.id)){var c=i.unitIndexMap.get(l.unit.id)*o;if(Be.isAtomic(l.unit))n=TG(c,o,vDe,r,l)||n;else if(Ce.is(l.indices)){var d=c+Ce.start(l.indices),f=c+Ce.end(l.indices);n=r(Ce.ofBounds(d,f))||n}else for(var p=0,v=l.indices.length;p<v;p++){for(var d=l.indices[p],m=p+1;m<v&&l.indices[m]===d;)m++;p=m-1;var f=l.indices[p];n=r(Ce.ofRange(c+d,c+f))||n}}}return n}function mDe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],l=Ee.indexOf(u.elements,u.gapElements[i]),c=Ee.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(l!==-1&&c!==-1)return Ot.Loci(o,[Ot.Location(o,u,l,o,u,c),Ot.Location(o,u,c,o,u,l)])}return yr}function hDe(e,t,r){var n=!1;if(Ot.isLoci(e)){var a=t.structure,i=t.group;if(!Ne.areRootsEquivalent(e.structure,a))return!1;e=Ot.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Ee.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Ee.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Ce.ofSingleton(c*o+d))&&(n=!0)}}}else if(xe.is(e)){var a=t.structure,i=t.group;if(!Ne.areRootsEquivalent(e.structure,a))return!1;e=xe.remap(e,a);for(var p=i.units[0].gapElements.length,v=function(S){var C=i.unitIndexMap.get(S.unit.id);C!==void 0&&Ee.forEach(S.indices,function(x){var A=Ee.indexOf(S.unit.gapElements,S.unit.elements[x]);A!==-1&&r(Ce.ofSingleton(C*p+A))&&(n=!0)})},m=0,h=e.elements;m<h.length;m++){var g=h[m];v(g)}}return n}var k2;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0],o=Be.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,l=He.create(a),c=function(d,f){var p=n.units[f];return l.unit=p,l.element=o[d],l};return sn(s,u,1,c)}e.fromGroup=t})(k2||(k2={}));function PG(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Be.isAtomic(u))return BV(o,u,u.nucleotideElements[i])}return yr}function gDe(e){return e.nucleotideElements}function EG(e,t,r){var n=!1;if(!xe.is(e))return!1;var a=t.structure,i=t.group;if(!Ne.areEquivalent(e.structure,a))return!1;var o=i.units[0];if(!Be.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(!!Be.isAtomic(d.unit)&&!!i.unitIndexMap.has(d.unit.id)){var f=i.unitIndexMap.get(d.unit.id)*u;Be.isAtomic(d.unit)&&(n=TG(f,u,gDe,r,d)||n)}}return n}var Ah=w(),o1=w(),vk=w(),mk=w(),hk=w(),gk=w(),s1=w(),pw=w(),vw=w(),yk=w(),Th=oe.identity(),yDe=w(),bk=YP(),IG={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)};E.getDefaultValues(IG);function bDe(e,t,r,n,a,i){if(!Be.isAtomic(t))return Rt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=o*(bk.vertices.length/3+u*2),c=ct.createState(l,l/4,i),d=t.elements,f=t.model,p=f.atomicHierarchy,v=p.chainAtomSegments,m=p.residueAtomSegments,h=p.atoms,g=p.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,C=h.label_comp_id,x=t.conformation.invariantPosition,A=Qt.transientSegments(v,d),P=Qt.transientSegments(m,d),T={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;A.hasNext;)for(P.setSegment(A.move());P.hasNext;){var I=P.move().index;if(Uu(b[I])){var M=C.value(m.offsets[I]),B=-1,U=-1,V=-1,F=-1,Y=-1,W=-1,K=4.5,$=2.5*s,J=4.5,Z=JN(M),N=e7(M);if(!Z&&!N){var j=g.findAtomOnResidue(I,"C4"),L=g.findAtomOnResidue(I,"N9");j!==-1&&L!==-1&&w.distance(x(j,Ah),x(L,o1))<1.6?Z=!0:N=!0}Z?(J=4.5,B=g.findAtomOnResidue(I,"N1"),U=g.findAtomOnResidue(I,"C4"),V=g.findAtomOnResidue(I,"C6"),F=g.findAtomOnResidue(I,"C2"),Y=g.findAtomOnResidue(I,"N9"),W=S[I]):N&&(J=3,B=g.findAtomOnResidue(I,"N3"),U=g.findAtomOnResidue(I,"C6"),V=g.findAtomOnResidue(I,"C4"),F=g.findAtomOnResidue(I,"C2"),Y=g.findAtomOnResidue(I,"N1"),Y===-1&&(Y=g.findAtomOnResidue(I,"C1")),W=S[I]),Y!==-1&&W!==-1&&(x(Y,hk),x(W,gk),c.currentGroup=D,ga(c,hk,gk,1,T),B!==-1&&U!==-1&&V!==-1&&F!==-1&&(x(B,Ah),x(U,o1),x(V,vk),x(F,mk),w.normalize(s1,w.sub(s1,o1,Ah)),w.normalize(pw,w.sub(pw,mk,vk)),w.normalize(vw,w.cross(vw,s1,pw)),oe.targetTo(Th,Ah,o1,vw),w.scaleAndAdd(yk,Ah,s1,J/2-.2),oe.scale(Th,Th,w.set(yDe,K,$,J)),oe.setTranslation(Th,yk),ct.addPrimitive(c,Th,bk))),++D}}var H=ct.getMesh(c),G=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return H.setBoundingSphere(G),H}var DG=_(_({},$a),IG);function SDe(e){return Bi({defaultProps:E.getDefaultValues(DG),createGeometry:bDe,createLocationIterator:k2.fromGroup,getLoci:PG,eachLocation:EG,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var u1=w.zero(),Cc=w.zero(),l1=w.zero(),c1=w.zero(),rf=w.zero(),nv=w.zero(),d1=w.zero(),Sk=w.zero(),xk=w.zero(),Ph=w.zero(),wc=w.zero(),MG={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo)};E.getDefaultValues(MG);var f1=new Float32Array(2*9*3),xDe=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),CDe=new Uint32Array([8,12,14,16,6,4,2,0,10]),wDe=new Uint32Array([9,11,1,3,5,7,17,15,13]),p1=new Float32Array(2*6*3),_De=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),ADe=new Uint32Array([0,10,8,6,4,2]),TDe=new Uint32Array([1,3,5,7,9,11]),Ck=w.zero();function wk(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];w.toArray(w.add(Ck,o,t),e,a*2*3),w.toArray(w.sub(Ck,o,t),e,(a*2+1)*3)}}function PDe(e,t,r,n,a,i){if(!Be.isAtomic(t))return Rt.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=a.detail,c=o*(26+u*2),d=ct.createState(c,c/4,i),f=t.elements,p=t.model,v=p.atomicHierarchy,m=v.chainAtomSegments,h=v.residueAtomSegments,g=v.atoms,y=v.index,b=p.atomicHierarchy.derived.residue,S=b.moleculeType,C=b.traceElementIndex,x=g.label_comp_id,A=t.conformation.invariantPosition,P=Qt.transientSegments(m,f),T=Qt.transientSegments(h,f),D=1*s,I=1.25*s,M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},B=0;P.hasNext;)for(T.setSegment(P.move());T.hasNext;){var U=T.move().index;if(Uu(S[U])){var V=x.value(h.offsets[U]),F=-1,Y=-1,W=-1,K=-1,$=-1,J=-1,Z=-1,N=-1,j=-1,L=-1;d.currentGroup=B;var H=JN(V),G=e7(V);if(!H&&!G){var q=y.findAtomOnResidue(U,"C4"),X=y.findAtomOnResidue(U,"N9");q!==-1&&X!==-1&&w.distance(A(q,rf),A(X,Ph))<1.6?H=!0:G=!0}H?(F=C[U],Y=y.findAtomOnResidue(U,"N1"),W=y.findAtomOnResidue(U,"C2"),K=y.findAtomOnResidue(U,"N3"),$=y.findAtomOnResidue(U,"C4"),J=y.findAtomOnResidue(U,"C5"),J===-1&&(J=y.findAtomOnResidue(U,"N5")),Z=y.findAtomOnResidue(U,"C6"),N=y.findAtomOnResidue(U,"N7"),N===-1&&(N=y.findAtomOnResidue(U,"C7")),j=y.findAtomOnResidue(U,"C8"),L=y.findAtomOnResidue(U,"N9"),L!==-1&&F!==-1&&(A(L,Ph),A(F,u1),d.currentGroup=B,ga(d,Ph,u1,1,M),la(d,Ph,D,l)),Y!==-1&&W!==-1&&K!==-1&&$!==-1&&J!==-1&&Z!==-1&&N!==-1&&j!==-1&&L!==-1&&(A(Y,Cc),A(W,l1),A(K,c1),A($,rf),A(J,nv),A(Z,d1),A(N,Sk),A(j,xk),w.triangleNormal(wc,Cc,rf,nv),w.scale(wc,wc,I),wk(f1,wc,Cc,l1,c1,rf,nv,d1,Sk,xk,Ph),ct.addTriangleStrip(d,f1,xDe),ct.addTriangleFan(d,f1,CDe),ct.addTriangleFan(d,f1,wDe))):G&&(F=C[U],Y=y.findAtomOnResidue(U,"N1"),Y===-1&&(Y=y.findAtomOnResidue(U,"C1")),W=y.findAtomOnResidue(U,"C2"),K=y.findAtomOnResidue(U,"N3"),$=y.findAtomOnResidue(U,"C4"),J=y.findAtomOnResidue(U,"C5"),Z=y.findAtomOnResidue(U,"C6"),Y!==-1&&F!==-1&&(A(Y,Cc),A(F,u1),d.currentGroup=B,ga(d,Cc,u1,1,M),la(d,Cc,D,l)),Y!==-1&&W!==-1&&K!==-1&&$!==-1&&J!==-1&&Z!==-1&&(A(W,l1),A(K,c1),A($,rf),A(J,nv),A(Z,d1),w.triangleNormal(wc,Cc,rf,nv),w.scale(wc,wc,I),wk(p1,wc,Cc,l1,c1,rf,nv,d1),ct.addTriangleStrip(d,p1,_De),ct.addTriangleFan(d,p1,ADe),ct.addTriangleFan(d,p1,TDe))),++B}}var Q=ct.getMesh(d),ue=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return Q.setBoundingSphere(ue),Q}var RG=_(_({},$a),MG);function EDe(e){return Bi({defaultProps:E.getDefaultValues(RG),createGeometry:PDe,createLocationIterator:k2.fromGroup,getLoci:PG,eachLocation:EG,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var nf=w.zero(),av=w.zero(),af=w.zero(),_k=w.zero(),ra=zu(3,!1);function IDe(){for(var e=km(8),t=0;t<3;++t){var r=(t+1)%3;w.set(nf,ra[t*3],ra[t*3+1],-.5),w.set(av,ra[r*3],ra[r*3+1],-.5),w.set(af,ra[r*3],ra[r*3+1],.5),w.set(_k,ra[t*3],ra[t*3+1],.5),e.add(nf,av,af),e.add(af,_k,nf)}return w.set(nf,ra[0],ra[1],-.5),w.set(av,ra[3],ra[4],-.5),w.set(af,ra[6],ra[7],-.5),e.add(af,av,nf),w.set(nf,ra[0],ra[1],.5),w.set(av,ra[3],ra[4],.5),w.set(af,ra[6],ra[7],.5),e.add(nf,av,af),e.getPrimitive()}var mw;function DDe(){return mw||(mw=IDe()),mw}var of=oe.identity(),MDe=w.zero(),Ak=w.zero(),Tk=w.zero(),hw=w.zero(),RDe=4,ODe=4,BDe=6,kDe=DDe(),OG={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01})};E.getDefaultValues(OG);function LDe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=o*24,l=ct.createState(u,u/10,i),c=1,d=s5(c),f=d.normalVectors,p=d.binormalVectors,v=0,m=o5(t,r);m.hasNext;){var h=m.move();l.currentGroup=v;var g=Uu(h.moleculeType),y=Tr.is(h.secStrucType,4),b=g||y?.5:.9,S=g?.3:.5;if(u5(d,h,b,S),y&&!h.secStrucLast||!y){var C=n.size.size(h.center)*s,x=RDe*C,A=ODe*C,P=BDe*C,T=g?p:f;w.fromArray(Ak,T,0),w.fromArray(Tk,T,3),w.normalize(hw,w.add(hw,Ak,Tk)),oe.targetTo(of,h.p3,h.p1,hw),oe.mul(of,of,oe.rotY90Z180),oe.scale(of,of,w.set(MDe,P,A,x)),oe.setTranslation(of,h.p2),ct.addPrimitive(l,of,kDe)}++v}var D=ct.getMesh(l),I=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return D.setBoundingSphere(I),D}var BG=_(_({},$a),OG);function FDe(e){return Bi({defaultProps:E.getDefaultValues(BG),createGeometry:LDe,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var gw=10,kG={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)};E.getDefaultValues(kG);function NDe(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,l=gw*u*2*o*2,c=ct.createState(l,l/10,i),d=t.conformation.invariantPosition,f=w.zero(),p=w.zero(),v={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},m=0,h=JIe(r,t);h.hasNext;){var g=h.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,p),v.radiusTop=v.radiusBottom=n.size.size(y)*s,c.currentGroup=m,x0(c,f,p,.5,gw,v),v.radiusTop=v.radiusBottom=n.size.size(b)*s,c.currentGroup=m+1,x0(c,p,f,.5,gw,v)),m+=2}var S=ct.getMesh(c),C=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return S.setBoundingSphere(C),S}var Ex=_(_({},$a),kG);function l5(e){return Bi({defaultProps:E.getDefaultValues(Ex),createGeometry:NDe,createLocationIterator:DA.fromGroup,getLoci:mDe,eachLocation:hDe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Sr=w(),Or=w(),UDe=w(),uo=w(),cu=w(),v1=w(),m1=w(),Eh=w(),Is=w(),fu=w(),yw=w(),_c=w(),Ac=w(),Tc=w(),Pc=w(),Lo=w.fromArray,Vv=w.scale,No=w.add,ll=w.sub,zDe=w.magnitude,Pk=w.negate,MA=w.copy,LG=w.cross,VDe=w.set,Ur=Le.add3,HDe=Le.add;function h1(e,t,r,n,a,i,o,s,u){var l=t.vertices,c=t.normals,d=t.indices,f=l.elementCount;if(Lo(Sr,n,e),Vv(m1,Sr,o),Vv(v1,Sr,s),Lo(Or,a,e),Vv(uo,Or,i),LG(fu,Or,Sr),Lo(Is,r,e),No(_c,No(_c,Is,uo),v1),ll(Ac,No(Ac,Is,uo),m1),ll(Tc,ll(Tc,Is,uo),m1),No(Pc,ll(Pc,Is,uo),v1),o<s?(Ur(l,Pc[0],Pc[1],Pc[2]),Ur(l,Tc[0],Tc[1],Tc[2]),Ur(l,Ac[0],Ac[1],Ac[2]),Ur(l,_c[0],_c[1],_c[2]),MA(cu,v1)):(Ur(l,_c[0],_c[1],_c[2]),Ur(l,Ac[0],Ac[1],Ac[2]),Ur(l,Tc[0],Tc[1],Tc[2]),Ur(l,Pc[0],Pc[1],Pc[2]),MA(cu,m1)),u){for(var p=0;p<4;++p)Ur(c,-fu[0],-fu[1],-fu[2]);Ur(d,f,f+1,f+2),Ur(d,f+2,f+3,f)}else{for(var p=0;p<4;++p)Ur(c,fu[0],fu[1],fu[2]);Ur(d,f+2,f+1,f),Ur(d,f,f+3,f+2)}}function q1(e,t,r,n,a,i,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,v=e.groups,m=d.elementCount,h=0;s>0?(Lo(Sr,t,0),Lo(Or,t,a*3),h=s/zDe(ll(UDe,Or,Sr))):VDe(Eh,0,0,0);for(var g=0;g<=a;++g){var y=i[g],b=o[g],S=s===0?b:s*(1-g/a),C=g*3;Lo(cu,r,C),Vv(cu,cu,S),Lo(uo,n,C),Vv(uo,uo,y),s>0&&(Lo(Sr,r,C),Lo(Or,n,C),Vv(Eh,LG(Eh,Sr,Or),h)),Lo(Is,t,C),Lo(fu,r,C),Lo(yw,n,C),No(Sr,No(Sr,Is,uo),cu),No(Or,fu,Eh),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),No(Sr,ll(Sr,Is,uo),cu),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),Pk(Or,yw),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),ll(Sr,ll(Sr,Is,uo),cu),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),No(Or,Pk(Or,fu),Eh),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),ll(Sr,No(Sr,Is,uo),cu),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),MA(Or,yw),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2]),No(Sr,No(Sr,Is,uo),cu),Ur(d,Sr[0],Sr[1],Sr[2]),Ur(f,Or[0],Or[1],Or[2])}for(var g=0;g<a;++g){for(var x=0;x<2;x++)Ur(p,m+g*8+2*x,m+(g+1)*8+2*x+1,m+g*8+2*x+1),Ur(p,m+g*8+2*x,m+(g+1)*8+2*x,m+(g+1)*8+2*x+1);for(var x=2;x<4;x++)Ur(p,m+g*8+2*x,m+(g+1)*8+2*x,m+g*8+2*x+1),Ur(p,m+(g+1)*8+2*x,m+(g+1)*8+2*x+1,m+g*8+2*x+1)}if(u){var y=i[0],b=o[0],A=s===0?b:s;h1(0,e,t,r,n,y,A,A,!1)}else if(s>0){var y=i[0],b=o[0];h1(0,e,t,r,n,y,s,-b,!1),h1(0,e,t,r,n,y,-s,b,!1)}if(l&&s===0){var y=i[a],b=o[a];h1(a*3,e,t,r,n,y,b,b,!0)}for(var P=(a+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,T=P;g<T;++g)HDe(v,c)}var Fn=w(),Yn=w(),Ci=w(),Pa=w(),Ja=w();function g1(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function iv(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var $u=w.fromArray,GDe=w.normalize,bw=w.scaleAndAdd,Ek=w.cross,qDe=w.dot,jDe=w.unitX,ei=Le.add3,Sw=new Map;function WDe(e,t){var r=t?1:0,n=Jo(e,r);if(!Sw.has(n)){for(var a=[],i=[],o=0;o<e;++o){var s=(o*2+r)/e*Math.PI;a[o]=Math.cos(s),i[o]=Math.sin(s)}Sw.set(n,{cos:a,sin:i})}return Sw.get(n)}function RA(e,t,r,n,a,i,o,s,u,l,c){for(var d=e.currentGroup,f=e.vertices,p=e.normals,v=e.indices,m=e.groups,h=f.elementCount,g=WDe(i,c==="rounded"),y=g.cos,b=g.sin,S=Math.round(i/4),C=S*3,x=0;x<=a;++x){var A=x*3;$u(Pa,r,A),$u(Ja,n,A),$u(Ci,t,A);for(var P=o[x],T=s[x],D=c==="rounded"&&T>P,I=0;I<i;++I){if(D){iv(Yn,Pa,Ja,Ci,P*y[I],P*b[I]);var M=qDe(Ja,jDe)<0?I<S||I>=C?T-P:-T+P:I>=S&&I<C?-T+P:T-P;bw(Yn,Yn,Pa,M),I===S||I===S-1?g1(Fn,Pa,Ja,0,1):I===C||I===C-1?g1(Fn,Pa,Ja,0,-1):g1(Fn,Pa,Ja,y[I],b[I])}else iv(Yn,Pa,Ja,Ci,T*y[I],P*b[I]),g1(Fn,Pa,Ja,P*y[I],T*b[I]);GDe(Fn,Fn),ei(f,Yn[0],Yn[1],Yn[2]),ei(p,Fn[0],Fn[1],Fn[2])}}for(var B=Math.round(i/2),x=0;x<a;++x){for(var I=0;I<B;++I)ei(v,h+x*i+(I+1)%i,h+(x+1)*i+(I+1)%i,h+x*i+I),ei(v,h+(x+1)*i+(I+1)%i,h+(x+1)*i+I,h+x*i+I);for(var I=B;I<i;++I)ei(v,h+x*i+(I+1)%i,h+(x+1)*i+I,h+x*i+I),ei(v,h+(x+1)*i+(I+1)%i,h+(x+1)*i+I,h+x*i+(I+1)%i)}if(u){var U=0,V=f.elementCount;$u(Pa,r,U),$u(Ja,n,U),$u(Ci,t,U),Ek(Fn,Ja,Pa),ei(f,Ci[0],Ci[1],Ci[2]),ei(p,Fn[0],Fn[1],Fn[2]);var P=o[0],T=s[0],D=c==="rounded"&&T>P;D&&(T-=P),h=f.elementCount;for(var x=0;x<i;++x)D?(iv(Yn,Pa,Ja,Ci,P*y[x],P*b[x]),bw(Yn,Yn,Pa,x<S||x>=C?T:-T)):iv(Yn,Pa,Ja,Ci,T*y[x],P*b[x]),ei(f,Yn[0],Yn[1],Yn[2]),ei(p,Fn[0],Fn[1],Fn[2]),ei(v,h+(x+1)%i,h+x,V)}if(l){var U=a*3,V=f.elementCount;$u(Pa,r,U),$u(Ja,n,U),$u(Ci,t,U),Ek(Fn,Pa,Ja),ei(f,Ci[0],Ci[1],Ci[2]),ei(p,Fn[0],Fn[1],Fn[2]);var P=o[a],T=s[a],D=c==="rounded"&&T>P;D&&(T-=P),h=f.elementCount;for(var x=0;x<i;++x)D?(iv(Yn,Pa,Ja,Ci,P*y[x],P*b[x]),bw(Yn,Yn,Pa,x<S||x>=C?T:-T)):iv(Yn,Pa,Ja,Ci,T*y[x],P*b[x]),ei(f,Yn[0],Yn[1],Yn[2]),ei(p,Fn[0],Fn[1],Fn[2]),ei(v,h+x,h+(x+1)%i,V)}var F=(a+1)*i+(u?i+1:0)+(l?i+1:0);Le.addRepeat(m,F,d)}var Ju=w.fromArray,XDe=w.magnitude,xw=w.sub,Ik=w.add,Cw=w.scale,YDe=w.negate,KDe=w.copy,QDe=w.cross,ko=Le.add3,ZDe=Le.add,na=w(),Ea=w(),$De=w(),ww=w(),sf=w(),Dk=w(),Ih=w(),JDe=w(),_w=w();function j1(e,t,r,n,a,i,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,p=l.elementCount,v=0;s>0&&(Ju(na,t,0),Ju(Ea,t,a*3),v=s/XDe(xw($De,Ea,na)));for(var m=0;m<=a;++m){var h=i[m],g=o[m],y=s===0?g:s*(1-m/a),b=m*3;Ju(sf,r,b),Cw(sf,sf,y),Ju(ww,n,b),Cw(ww,ww,h),s>0&&(Ju(na,r,b),Ju(Ea,n,b),Cw(Dk,QDe(Dk,na,Ea),v)),Ju(Ih,t,b),Ju(JDe,r,b),Ju(_w,n,b),Ik(na,Ih,sf),YDe(Ea,_w),ko(l,na[0],na[1],na[2]),ko(c,Ea[0],Ea[1],Ea[2]),xw(na,Ih,sf),ko(l,na[0],na[1],na[2]),ko(c,Ea[0],Ea[1],Ea[2]),Ik(na,Ih,sf),KDe(Ea,_w),ko(l,na[0],na[1],na[2]),ko(c,Ea[0],Ea[1],Ea[2]),xw(na,Ih,sf),ko(l,na[0],na[1],na[2]),ko(c,Ea[0],Ea[1],Ea[2])}for(var m=0;m<a;++m)ko(d,p+m*4,p+(m+1)*4+1,p+m*4+1),ko(d,p+m*4,p+(m+1)*4,p+(m+1)*4+1),ko(d,p+m*4+2+1,p+(m+1)*4+2+1,p+m*4+2),ko(d,p+m*4+2,p+(m+1)*4+2+1,p+(m+1)*4+2);for(var S=(a+1)*4,m=0,C=S;m<C;++m)ZDe(f,u)}var FG={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:E.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:E.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:E.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:E.Select("elliptical",E.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein and nucleic helix trace profile"}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),linearSegments:E.Numeric(8,{min:1,max:48,step:1},at.CustomQualityParamInfo),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)};E.getDefaultValues(FG);var zi=w();function eMe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,l=a.linearSegments,c=a.radialSegments,d=a.aspectRatio,f=a.arrowFactor,p=a.tubularHelices,v=a.helixProfile,m=l*c*o+(c+1)*o*2,h=ct.createState(m,m/10,i),g=Be.isCoarse(t),y=s5(l),b=y.curvePoints,S=y.normalVectors,C=y.binormalVectors,x=y.widthValues,A=y.heightValues,P=0,T=o5(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});T.hasNext;){var D=T.move();h.currentGroup=P;var I=Uu(D.moleculeType),M=Tr.is(D.secStrucType,4),B=Tr.is(D.secStrucType,2),U=B&&!p?pDe:_G,V=I?Px:Tx;u5(y,D,U,V);var F=n.size.size(D.centerPrev)*s,Y=n.size.size(D.center)*s,W=n.size.size(D.centerNext)*s;g&&(F*=d/2,Y*=d/2,W*=d/2);var K=D.secStrucFirst||D.coarseBackboneFirst||D.first,$=D.secStrucLast||D.coarseBackboneLast||D.last,J=l;if(D.initial){J=Math.max(Math.round(l*V),1);var Z=l-J;b.copyWithin(0,Z*3),C.copyWithin(0,Z*3),S.copyWithin(0,Z*3),w.fromArray(zi,b,3),w.normalize(zi,w.sub(zi,D.p2,zi)),w.scaleAndAdd(zi,D.p2,zi,Y*B2),w.toArray(zi,b,0)}else D.final&&(J=Math.max(Math.round(l*(1-V)),1),w.fromArray(zi,b,J*3-3),w.normalize(zi,w.sub(zi,D.p2,zi)),w.scaleAndAdd(zi,D.p2,zi,Y*B2),w.toArray(zi,b,J*3));if(D.initial===!0&&D.final===!0)la(h,D.p2,Y*2,u);else if(M){var N=F*d,j=Y*d,L=W*d,H=D.secStrucLast?j*f:0;IA(y,F,Y,W,N,j,L,V),c===2?j1(h,b,S,C,J,x,A,H):q1(h,b,S,C,J,x,A,H,K,$)}else{var N=void 0,j=void 0,L=void 0;B&&!D.isCoarseBackbone?p?(F*=d*1.5,Y*=d*1.5,W*=d*1.5,N=F,j=Y,L=W):(N=F*d,j=Y*d,L=W*d):I&&!D.isCoarseBackbone?(N=F*d,j=Y*d,L=W*d):(N=F,j=Y,L=W),IA(y,F,Y,W,N,j,L,V);var G=I&&!D.isCoarseBackbone?[C,S]:[S,C],q=G[0],X=G[1];if(I&&!D.isCoarseBackbone)for(var Q=0,ue=q.length;Q<ue;Q++)q[Q]*=-1;c===2?I&&!D.isCoarseBackbone?j1(h,b,q,X,J,A,x,0):j1(h,b,q,X,J,x,A,0):c===4?q1(h,b,q,X,J,x,A,0,K,$):j===Y?RA(h,b,q,X,J,c,x,A,K,$,"elliptical"):v==="square"?q1(h,b,q,X,J,x,A,0,K,$):RA(h,b,q,X,J,c,x,A,K,$,v)}++P}var le=ct.getMesh(h),ve=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return le.setBoundingSphere(ve),le}var NG=_(_({},$a),FG);function tMe(e){return Bi({defaultProps:E.getDefaultValues(NG),createGeometry:eMe,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile;var u=ls.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=t.info.secondaryStructureHash!==void 0,t.info.secondaryStructureHash=u)}},e)}var UG={"polymer-trace":function(e,t){return yn("Polymer trace mesh",e,t,tMe)},"polymer-gap":function(e,t){return yn("Polymer gap cylinder",e,t,l5)},"nucleotide-block":function(e,t){return yn("Nucleotide block mesh",e,t,SDe)},"nucleotide-ring":function(e,t){return yn("Nucleotide ring mesh",e,t,EDe)},"direction-wedge":function(e,t){return yn("Polymer direction wedge",e,t,FDe)}},zG=_(_(_(_(_(_({},NG),Ex),DG),RG),BG),{sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),visuals:E.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring"],E.objectToOptions(UG)),bumpFrequency:E.Numeric(2,{min:0,max:10,step:.1},at.ShadingCategory)});function rMe(e,t){var r=E.clone(zG),n=!1,a=!1;return t.units.forEach(function(i){!n&&Be.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function nMe(e,t){return Yt.createMulti("Cartoon",e,t,va,UG)}var aMe={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:nMe,getParams:rMe,defaultValues:E.getDefaultValues(zG),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return se(void 0,void 0,void 0,function(){var r,n,a;return ie(this,function(i){switch(i.label){case 0:return[4,ls.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?(a=n[r],[4,PA.attach(e,a,void 0,!0)]):[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){ls.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];PA.ref(n,!1)}}}},VG=_(_({},$a),{sizeFactor:E.Numeric(1,{min:0,max:10,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),ignoreHydrogens:E.Boolean(!1)});function iMe(e){return Bi({defaultProps:E.getDefaultValues(VG),createGeometry:oMe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function oMe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Rt.createEmpty(i);var u=a.detail,l=a.sizeFactor,c=a.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,v=d.length,m=v*qS(u),h=ct.createState(m,m/2,i),g=Mu.Provider.get(f);if(!g)return Rt.createEmpty(i);var y=w(),b=wn(),S=w(),C=w(),x=w(),A=g.elementToAnsiotrop,P=g.data,T=P.U,D=P._schema.U.space,I=t.conformation.invariantPosition,M=He.create(r);M.unit=t;for(var B=0;B<v;B++){var U=d[B],V=A[U];if(V!==-1&&!(!!s&&!ze.has(s.elements,U)||c&&x2(p,U))){M.element=U,I(U,y),h.currentGroup=B,gr.toMat3(b,D,T.value(V)),wn.symmtricFromLower(b,b),wn.symmetricEigenvalues(S,b),wn.eigenvector(C,b,S[1]),wn.eigenvector(x,b,S[2]);for(var F=0;F<3;++F)S[F]=l*1.5958*Math.sqrt(Math.abs(S[F]));tn(S[0],S[1],zr)&&tn(S[1],S[2],zr)?la(h,y,S[0],u):lE(h,y,x,C,S,u)}}var Y=ct.getMesh(h),W=Me.expand(Me(),(s||t).boundary.sphere,1*l);return Y.setBoundingSphere(W),Y}var HG={"ellipsoid-mesh":function(e,t){return yn("Ellipsoid Mesh",e,t,iMe)},"intra-bond":function(e,t){return yn("Intra-unit bond cylinder",e,t,sG)},"inter-bond":function(e,t){return Hs("Inter-unit bond cylinder",e,t,lG)}},GG=_(_(_(_({},VG),Sx),xx),{includeParent:E.Boolean(!1),adjustCylinderLength:E.Boolean(!1,{isHidden:!0}),unitKinds:Ug(["atomic"]),sizeFactor:E.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:E.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:E.Boolean(!0),visuals:E.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],E.objectToOptions(HG)),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)});function sMe(e,t){return E.clone(GG)}function uMe(e,t){return Yt.createMulti("Ellipsoid",e,t,va,HG)}var lMe={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:uMe,getParams:sMe,defaultValues:E.getDefaultValues(GG),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Mu.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},cMe=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,dMe=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`,fMe={drawCount:Rn("number"),instanceCount:Rn("number"),aRadius:Rr("float32",1,0),aPosition:Rr("float32",3,0),aGroup:Rr("float32",1,0),uCurrentSlice:Re("f"),uCurrentX:Re("f"),uCurrentY:Re("f"),uBboxMin:Re("v3","material"),uBboxSize:Re("v3","material"),uGridDim:Re("v3","material"),uGridTexDim:Re("v3","material"),uGridTexScale:Re("v2","material"),uAlpha:Re("f","material"),uResolution:Re("f","material"),uRadiusFactorInv:Re("f","material"),tMinDistanceTex:Wt("texture","rgba","float","nearest"),dGridTexType:qt("string",["2d","3d"]),dCalcType:qt("string",["density","minDistance","groupId"])},gu="gaussian-density";function qG(e){return e.namedFramebuffers[gu]||(e.namedFramebuffers[gu]=e.resources.framebuffer()),e.namedFramebuffers[gu]}function jG(e,t,r,n,a,i){var o="".concat(gu,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function WG(e,t,r,n,a,i){return e.isWebGL2?pMe(e,t,r,n,a,i):c5(e,t,r,n,!1,a,i)}function c5(e,t,r,n,a,i,o){return XG(mMe(e,t,r,n,a,i,o))}function pMe(e,t,r,n,a,i){return XG(hMe(e,t,r,n,a,i))}function XG(e){var t=e.texture,r=e.scale,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:vMe(r,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u}}function vMe(e,t){var r=oe.identity();return oe.fromScaling(r,e),oe.setTranslation(r,t.min),r}function mMe(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,p=c.colorBufferHalfFloat,v=c.textureHalfFloat,m=c.blendMinMax,h=i.smoothness,g=i.resolution,y=YG(t,r,n,i),b=y.drawCount,S=y.positions,C=y.radii,x=y.groups,A=y.scale,P=y.expandedBox,T=y.dim,D=y.maxRadius,I=T[0],M=T[1],B=T[2],U=yMe(T),V=U.texDimX,F=U.texDimY,Y=U.texCols,W=U.powerOfTwoSize,K=w.create(V,F,0),$=ke.create(V/W,F/W),J=D*2,Z=a?W:V,N=a?W:F,j=jG("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");j.define(Z,N);var L=KG(e,b,S,C,x,j,P,T,K,$,h,g,J),H=L.values,G=H.uCurrentSlice,q=H.uCurrentX,X=H.uCurrentY,Q=qG(e);Q.bind(),QG(e),o||(o=p&&v?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(Z,N);function ue(le,ve){l.currentRenderItemId=-1,le.attachFramebuffer(Q,0),ve&&(s.viewport(0,0,Z,N),s.scissor(0,0,Z,N),s.clear(s.COLOR_BUFFER_BIT)),R.update(X,0);for(var ge=0,Se=0,ae=0,re=0;re<B;++re)ge>=Y&&(ge-=Y,Se+=M,ae=0,R.update(X,Se)),R.update(q,ae),R.update(G,re),s.viewport(ae,Se,I,M),s.scissor(ae,Se,I,M),L.render(),++ge,ae+=I;s.flush()}return $G(e,L),ue(o,!0),m&&(ZG(e,L),ue(j,!0),JG(e,L),ue(o,!1)),{texture:o,scale:A,bbox:P,gridDim:T,gridTexDim:K,gridTexScale:$,radiusFactor:J,resolution:g}}function hMe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,v=a.smoothness,m=a.resolution,h=YG(t,r,n,a),g=h.drawCount,y=h.positions,b=h.radii,S=h.groups,C=h.scale,x=h.expandedBox,A=h.dim,P=h.maxRadius,T=A[0],D=A[1],I=A[2],M=jG("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");M.define(T,D,I);var B=ke.create(1,1),U=P*2,V=KG(e,g,y,b,S,M,x,A,A,B,v,m,U),F=V.values.uCurrentSlice,Y=qG(e);Y.bind(),QG(e),o.viewport(0,0,T,D),o.scissor(0,0,T,D),i||(i=f&&p?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(T,D,I);function W(K,$){u.currentRenderItemId=-1;for(var J=0;J<I;++J)R.update(F,J),K.attachFramebuffer(Y,0,J),$&&o.clear(o.COLOR_BUFFER_BIT),V.render();o.flush()}return $G(e,V),W(i,!0),ZG(e,V),W(M,!0),JG(e,V),W(i,!1),{texture:i,scale:C,bbox:x,gridDim:A,gridTexDim:A,gridTexScale:B,radiusFactor:U,resolution:m}}function YG(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Ee.size(s),p=new Float32Array(f*3),v=new Float32Array(f),m=new Float32Array(f),h=0,g=0;g<f;++g){var y=Ee.getAt(s,g);p[g*3]=u[y],p[g*3+1]=l[y],p[g*3+2]=c[y];var b=r(y)+i;h<b&&(h=b),v[g]=b,m[g]=d?d[g]:g}var S=h*2+a*4,C=Ut.expand(Ut(),t,w.create(S,S,S)),x=Ut.scale(Ut(),C,o),A=Ut.size(w(),x);w.ceil(A,A);var P=w.create(a,a,a);return{drawCount:f,positions:p,radii:v,groups:m,scale:P,expandedBox:C,dim:A,maxRadius:h}}function KG(e,t,r,n,a,i,o,s,u,l,c,d,f){if(e.namedComputeRenderables[gu]){var p=w.sub(w(),o.max,o.min),v=e.namedComputeRenderables[gu].values;R.updateIfChanged(v.drawCount,t),R.updateIfChanged(v.instanceCount,1),R.update(v.aRadius,n),R.update(v.aPosition,r),R.update(v.aGroup,a),R.updateIfChanged(v.uCurrentSlice,0),R.updateIfChanged(v.uCurrentX,0),R.updateIfChanged(v.uCurrentY,0),R.update(v.uBboxMin,o.min),R.update(v.uBboxSize,p),R.update(v.uGridDim,s),R.update(v.uGridTexDim,u),R.update(v.uGridTexScale,l),R.updateIfChanged(v.uAlpha,c),R.updateIfChanged(v.uResolution,d),R.updateIfChanged(v.uRadiusFactorInv,1/f),R.update(v.tMinDistanceTex,i),R.updateIfChanged(v.dGridTexType,i.getDepth()>0?"3d":"2d"),R.updateIfChanged(v.dCalcType,"density"),e.namedComputeRenderables[gu].update()}else e.namedComputeRenderables[gu]=gMe(e,t,r,n,a,i,o,s,u,l,c,d,f);return e.namedComputeRenderables[gu]}function gMe(e,t,r,n,a,i,o,s,u,l,c,d,f){var p=w.sub(w(),o.max,o.min),v={drawCount:R.create(t),instanceCount:R.create(1),aRadius:R.create(n),aPosition:R.create(r),aGroup:R.create(a),uCurrentSlice:R.create(0),uCurrentX:R.create(0),uCurrentY:R.create(0),uBboxMin:R.create(o.min),uBboxSize:R.create(p),uGridDim:R.create(s),uGridTexDim:R.create(u),uGridTexScale:R.create(l),uAlpha:R.create(c),uResolution:R.create(d),uRadiusFactorInv:R.create(1/f),tMinDistanceTex:R.create(i),dGridTexType:R.create(i.getDepth()>0?"3d":"2d"),dCalcType:R.create("density")},m=_({},fMe),h=ln(gu,cMe,dMe),g=ea(e,"points",h,m,v);return ta(g,v)}function QG(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function ZG(e,t){var r=e.gl,n=e.state;if(R.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function $G(e,t){var r=e.gl,n=e.state;R.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function JG(e,t){var r=e.gl,n=e.state;R.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function yMe(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}var eq=new ArrayBuffer(4),bMe=new Int32Array(eq),SMe=new Float32Array(eq);function xMe(e){var t=e<-126?-126:e;return bMe[0]=(1<<23)*(t+126.94269504),SMe[0]}function CMe(e){return xMe(1.44269504*e)}function tq(e,t,r,n,a){return se(this,void 0,void 0,function(){function i(q,X){for(var Q=q;Q<X;++Q)for(var ue=Ee.getAt(d,Q),le=f[ue],ve=p[ue],ge=v[ue],Se=g[Q],ae=Se*Se,re=1/ae,O=Se*2,z=O*O,de=Math.ceil(O*c),me=Math.floor(c*(le-A[0])),ye=Math.floor(c*(ve-A[1])),Te=Math.floor(c*(ge-A[2])),Oe=Math.max(0,me-de),Ue=Math.max(0,ye-de),Qe=Math.max(0,Te-de),Ge=Math.min(V,me+de+2),Je=Math.min(F,ye+de+2),Ze=Math.min(Y,Te+de+2),rt=Oe;rt<Ge;++rt)for(var et=J[rt]-le,St=rt*$,De=Ue;De<Je;++De)for(var Ie=Z[De]-ve,je=et*et+Ie*Ie,st=De*W+St,pt=Qe;pt<Ze;++pt){var qe=N[pt]-ge,bt=je+qe*qe;if(bt<=z){var yt=CMe(-L*(bt*re)),Dt=pt+st;I[Dt]+=yt,yt>j[Dt]&&(j[Dt]=yt,B[Dt]=m?m[Q]:Q)}}}function o(){return se(this,void 0,void 0,function(){var q;return ie(this,function(X){switch(X.label){case 0:q=0,X.label=1;case 1:return q<h?(i(q,Math.min(q+H,h)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:q,max:h})]:[3,3]):[3,4];case 2:X.sent(),X.label=3;case 3:return q+=H,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,p,v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y,W,K,$,J,Z,N,j,L,H,G;return ie(this,function(q){switch(q.label){case 0:for(s=a.resolution,u=a.radiusOffset,l=a.smoothness,c=1/s,d=t.indices,f=t.x,p=t.y,v=t.z,m=t.id,h=Ee.size(d),g=new Float32Array(h),y=0,b=0;b<h;++b)S=n(Ee.getAt(d,b))+u,y<S&&(y=S),g[b]=S;return C=y*2+s,x=Ut.expand(Ut(),r,w.create(C,C,C)),A=x.min,P=Ut.scale(Ut(),x,c),T=Ut.size(w(),P),w.ceil(T,T),D=gr.Space(T,[0,1,2],Float32Array),I=D.create(),M=gr.create(D,I),B=D.create(),B.fill(-1),U=gr.create(D,B),V=T[0],F=T[1],Y=T[2],W=Y,K=F,$=W*K,J=kv(T[0],A[0],s),Z=kv(T[1],A[1],s),N=kv(T[2],A[2],s),j=D.create(),L=l,H=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return q.sent(),G=oe.identity(),oe.fromScaling(G,w.create(s,s,s)),oe.setTranslation(G,x.min),[2,{field:M,idField:U,transform:G,radiusFactor:1,resolution:s}]}})})}var Xg=_({resolution:E.Numeric(1,{min:.1,max:20,step:.1},_({description:"Grid resolution/cell spacing."},at.CustomQualityParamInfo)),radiusOffset:E.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:E.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},ix);E.getDefaultValues(Xg);function Ix(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function rq(e,t,r,n){var a=this,i=t.lookup3d.boundary.box,o=wp(i,n),s=ox(e,t,r,o),u=s.position,l=s.radius;return Fe.create("Gaussian Density",function(c){return se(a,void 0,void 0,function(){return ie(this,function(d){switch(d.label){case 0:return[4,tq(c,u,i,l,o)];case 1:return[2,d.sent()]}})})})}function wMe(e,t,r,n,a,i){var o=this,s=t.lookup3d.boundary.box,u=wp(s,n,Ix(a,e)),l=ox(e,t,r,u),c=l.position,d=l.radius;return Fe.create("Gaussian Density",function(f){return se(o,void 0,void 0,function(){return ie(this,function(p){return[2,WG(a,c,s,d,u,i)]})})})}function _Me(e,t,r,n,a,i,o){var s=this,u=t.lookup3d.boundary.box,l=wp(u,a,Ix(i,e)),c=ox(e,t,r,l),d=c.position,f=c.radius;return Fe.create("Gaussian Density",function(p){return se(s,void 0,void 0,function(){return ie(this,function(v){return[2,c5(i,d,u,f,n,l,o)]})})})}function AMe(e,t,r){var n=this,a=e.lookup3d.boundary.box,i=wp(a,r),o=OE(e,t,r.ignoreHydrogens,r.traceOnly),s=o.position,u=o.radius;return Fe.create("Gaussian Density",function(l){return se(n,void 0,void 0,function(){return ie(this,function(c){switch(c.label){case 0:return[4,tq(l,s,a,u,i)];case 1:return[2,c.sent()]}})})})}function TMe(e,t,r,n,a){var i=this,o=e.lookup3d.boundary.box,s=wp(o,r,Ix(n)),u=OE(e,t,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return Fe.create("Gaussian Density",function(d){return se(i,void 0,void 0,function(){return ie(this,function(f){return[2,WG(n,l,o,c,s,a)]})})})}function PMe(e,t,r,n,a,i){var o=this,s=e.lookup3d.boundary.box,u=wp(s,n,Ix(a)),l=OE(e,t,n.ignoreHydrogens,n.traceOnly),c=l.position,d=l.radius;return Fe.create("Gaussian Density",function(f){return se(o,void 0,void 0,function(){return ie(this,function(p){return[2,c5(a,c,s,d,r,u,i)]})})})}var nq=_(_(_({},Xg),c9),{ignoreHydrogens:E.Boolean(!1),tryUseGpu:E.Boolean(!0),includeParent:E.Boolean(!1,{isHidden:!0})}),d5=_(_(_({},$a),Swe),nq),aq=_(_(_({},zg),pwe),nq);function iq(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function Wm(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=FV(e.boundary.box,t.resolution,n*n),i=a.areaCells,o=a.maxAreaCells;return i<o}function EMe(e,t,r,n){return r.tryUseGpu&&n&&iq(n)&&Wm(t,r,n)?kMe(e):MMe(e)}function IMe(e,t,r,n){return r.tryUseGpu&&n&&iq(n)&&Wm(t,r,n)?FMe(e):OMe(e)}function DMe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m;return ie(this,function(h){switch(h.label){case 0:return o=a.smoothness,[4,rq(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=h.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,p={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,JS(p,i).runAsChild(e.runtime)];case 2:return v=h.sent(),v.meta.resolution=f,Rt.transform(v,u),e.webgl&&!e.webgl.isWebGL2&&Rt.uniformTriangleGroup(v),m=Me.expand(Me(),t.boundary.sphere,a.radiusOffset+zm(t)),v.setBoundingSphere(m),[2,v]}})})}function MMe(e){return Bi({defaultProps:E.getDefaultValues(d5),createGeometry:DMe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Wm(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ps(n.smoothColors,a.color.preferSmoothing,s);l&&(iE(t,l.resolution,l.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function RMe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return i=n.smoothness,[4,AMe(t,r.size,n).runInContext(e.runtime)];case 1:return o=m.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-i)/c,scalarField:u,idField:l},[4,JS(f,a).runAsChild(e.runtime)];case 2:return p=m.sent(),p.meta.resolution=d,Rt.transform(p,s),e.webgl&&!e.webgl.isWebGL2&&Rt.uniformTriangleGroup(p),v=Me.expand(Me(),t.boundary.sphere,n.radiusOffset+sx(t)),p.setBoundingSphere(v),[2,p]}})})}function OMe(e){return _p({defaultProps:E.getDefaultValues(aq),createGeometry:RMe,createLocationIterator:Za.fromStructure,getLoci:_x,eachLocation:wx,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&Wm(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ps(n.smoothColors,a.color.preferSmoothing,s);l&&(iE(t,l.resolution,l.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var Hv="gaussian-surface";function BMe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b,S;return ie(this,function(C){switch(C.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,s[Hv]||(s[Hv]=f&&p?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,_Me(r,t,n.size,!0,a,e.webgl,s[Hv]).runInContext(e.runtime)];case 1:return v=C.sent(),m=Math.exp(-a.smoothness)/v.radiusFactor,h=w.create(0,1,2),g=i==null?void 0:i.doubleBuffer.get(),y=pE(e.webgl,v.texture,v.gridDim,v.gridTexDim,v.gridTexScale,v.transform,m,!1,!0,h,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=Me.expand(Me(),t.boundary.sphere,a.radiusOffset+sx(r)),S=ds.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,b,i),S.meta.resolution=v.resolution,[2,S]}})})}function kMe(e){return xwe({defaultProps:E.getDefaultValues(d5),createGeometry:BMe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Wm(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ps(n.smoothColors,a.color.preferSmoothing,s);l&&i&&(kU(t,l.resolution,l.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function LMe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return i=e.webgl,o=i.namedTextures,s=i.resources,u=i.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[Hv]||(o[Hv]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,PMe(t,r.size,!0,n,e.webgl,o[Hv]).runInContext(e.runtime)];case 1:return p=S.sent(),v=Math.exp(-n.smoothness)/p.radiusFactor,m=w.create(0,1,2),h=a==null?void 0:a.doubleBuffer.get(),g=pE(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,v,!1,!0,m,h==null?void 0:h.vertex,h==null?void 0:h.group,h==null?void 0:h.normal),y=Me.expand(Me(),t.boundary.sphere,n.radiusOffset+sx(t)),b=ds.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,a),b.meta.resolution=p.resolution,[2,b]}})})}function FMe(e){return vwe({defaultProps:E.getDefaultValues(aq),createGeometry:LMe,createLocationIterator:Za.fromStructure,getLoci:_x,eachLocation:wx,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!Wm(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ps(n.smoothColors,a.color.preferSmoothing,s);l&&i&&(kU(t,l.resolution,l.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function NMe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return ie(this,function(v){switch(v.label){case 0:return o=a.smoothness,[4,rq(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,fE(d,i).runAsChild(e.runtime)];case 2:return f=v.sent(),on.transform(f,u),p=Me.expand(Me(),t.boundary.sphere,a.radiusOffset+zm(t)),f.setBoundingSphere(p),[2,f]}})})}var oq=_(_(_({},ux),Xg),{sizeFactor:E.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:E.Boolean(!1),ignoreHydrogens:E.Boolean(!1),includeParent:E.Boolean(!1,{isHidden:!0})});function UMe(e){return lx({defaultProps:E.getDefaultValues(oq),createGeometry:NMe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var sq={"gaussian-surface-mesh":function(e,t){return yn("Gaussian surface mesh",e,t,EMe)},"structure-gaussian-surface-mesh":function(e,t){return Hs("Structure-Gaussian surface mesh",e,t,IMe)},"gaussian-surface-wireframe":function(e,t){return yn("Gaussian surface wireframe",e,t,UMe)}},uq=_(_(_({},d5),oq),{visuals:E.MultiSelect(["gaussian-surface-mesh"],E.objectToOptions(sq)),bumpFrequency:E.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)});function zMe(e,t){return E.clone(uq)}function VMe(e,t){return Yt.createMulti("Gaussian Surface",e,t,va,sq)}var HMe={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:VMe,getParams:zMe,defaultValues:E.getDefaultValues(uq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},lq=_(_({},lwe),{background:E.Boolean(!1),backgroundMargin:E.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:E.Color(tr.black),backgroundOpacity:E.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:E.Numeric(.25,{min:0,max:.5,step:.01}),level:E.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),chainScale:E.Numeric(10,{min:0,max:20,step:.1}),residueScale:E.Numeric(1,{min:0,max:20,step:.1}),elementScale:E.Numeric(.5,{min:0,max:20,step:.1})});function GMe(e){return cwe({defaultProps:E.getDefaultValues(lq),createGeometry:qMe,createLocationIterator:Za.fromStructure,getLoci:_x,eachLocation:wx,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function qMe(e,t,r,n,a){switch(n.level){case"chain":return jMe(e,t,r,n,a);case"residue":return WMe(e,t,r,n,a);case"element":return XMe(e,t,r,n,a)}}var Zo=w(),Dh=new To("98");function jMe(e,t,r,n,a){for(var i=He.create(t),o=t.units,s=t.serialMapping,u=tt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,p=n.chainScale,v=Ll.create(n,f,f/2,a),m=0,h=o.length;m<h;++m){var g=o[m];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,S=y.radius;w.transformMat4(Zo,b,g.conformation.operator.matrix);var C=l(i),x=c(i),A=C===x?x:"".concat(x," [").concat(C,"]");v.add(A,Zo[0],Zo[1],Zo[2],S,p,d[m])}return v.getText()}function WMe(e,t,r,n,a){for(var i=He.create(t),o=t.units,s=t.serialMapping,u=tt.atom.label_comp_id,l=tt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,p=Ll.create(n,d,d/2,a),v=0,m=o.length;v<m;++v){var h=o[v],g=h.conformation.position,y=h.elements;i.unit=h,i.element=h.elements[0];for(var b=h.model.atomicHierarchy.residueAtomSegments.index,S=c[v],C=0,x=y.length;C<x;){var A=C,P=b[y[C]];for(C++;C<x&&b[y[C]]===P;)C++;Dh.reset();for(var T=A;T<C;T++)g(y[T],Zo),Dh.includePosition(Zo);Dh.finishedIncludeStep();for(var T=A;T<C;T++)g(y[T],Zo),Dh.radiusPosition(Zo);i.element=y[A];var D=Dh.getSphere(),I=D.center,M=D.radius,B=l(i),U=u(i),V="".concat(U," ").concat(B);p.add(V,I[0],I[1],I[2],M,f,S+A)}}return p.getText()}function XMe(e,t,r,n,a){for(var i=He.create(t),o=t.units,s=t.serialMapping,u=tt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=r.size,p=t.elementCount,v=n.elementScale,m=Ll.create(n,p,p/2,a),h=0,g=o.length;h<g;++h){var y=o[h],b=y.conformation.position,S=y.elements;i.unit=y;for(var C=d[h],x=0,A=S.length;x<A;x++){i.element=S[x],b(i.element,Zo);var P=l(i),T=c(i),D=T?"".concat(P,"%").concat(T):P;m.add(D,Zo[0],Zo[1],Zo[2],f.size(i),v,C+x)}}return m.getText()}var cq={"label-text":function(e,t){return Hs("Label text",e,t,GMe)}},dq=_(_({},lq),{visuals:E.MultiSelect(["label-text"],E.objectToOptions(cq))});function YMe(e,t){return E.clone(dq)}function KMe(e,t){var r=Yt.createMulti("Label",e,t,va,cq);return r.setState({pickable:!1,markerActions:wt.None}),r}var QMe={name:"label",label:"Label",description:"Displays labels.",factory:KMe,getParams:YMe,defaultValues:E.getDefaultValues(dq),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}};function ZMe(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function $Me(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}var f5={probeRadius:E.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:E.Numeric(.5,{min:.01,max:20,step:.01},_({description:"Grid resolution/cell spacing."},at.CustomQualityParamInfo)),probePositions:E.Numeric(36,{min:12,max:90,step:1},_({description:"Number of positions tested for probe target intersection."},at.CustomQualityParamInfo))};E.getDefaultValues(f5);function JMe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){function o(Oe,Ue,Qe,Ge,Je){if(p!==-1){var Ze=p;if(Ze!==Ge&&Ze!==Je&&s(Ze,Oe,Ue,Qe))return Ze;p=-1}for(var rt=0,et=T.count;rt<et;++rt){var Ze=Ee.getAt(D,T.indices[rt]);if(Ze!==Ge&&Ze!==Je&&s(Ze,Oe,Ue,Qe))return p=Ze,Ze}return-1}function s(Oe,Ue,Qe,Ge){var Je=V[Oe],Ze=I[Oe]-Ue,rt=M[Oe]-Qe,et=B[Oe]-Ge,St=Ze*Ze+rt*rt+et*et;return St<Je*Je}function u(Oe,Ue){for(var Qe=Oe;Qe<Ue;++Qe){var Ge=Ee.getAt(D,Qe),Je=I[Ge],Ze=M[Ge],rt=B[Ge],et=V[Ge],St=et*et;P.find(Je,Ze,rt,et);for(var De=Math.ceil(et*C),Ie=Math.floor(C*(Je-$)),je=Math.floor(C*(Ze-J)),st=Math.floor(C*(rt-Z)),pt=Math.max(0,Ie-De),qe=Math.max(0,je-De),bt=Math.max(0,st-De),yt=Math.min(L,Ie+De+2),Dt=Math.min(H,je+De+2),ee=Math.min(G,st+De+2),pe=pt;pe<yt;++pe)for(var we=re[pe]-Je,Xe=pe*Q,dt=qe;dt<Dt;++dt)for(var vt=O[dt]-Ze,Et=we*we+vt*vt,_r=dt*q+Xe,qr=bt;qr<ee;++qr){var Qr=z[qr]-rt,_a=Et+Qr*Qr;if(_a<St){var bi=qr+_r;Se[bi]<0&&(Se[bi]*=-1);var Si=Math.sqrt(_a),ys=et/Si,Dx=we*ys+Je,Mx=vt*ys+Ze,Fp=Qr*ys+rt;if(o(Dx,Mx,Fp,Ge,-1)===-1){var Np=et-Si;Np<Se[bi]&&(Se[bi]=Np,ae[bi]=U[Qe])}}}}}function l(){return se(this,void 0,void 0,function(){var Oe;return ie(this,function(Ue){switch(Ue.label){case 0:Oe=0,Ue.label=1;case 1:return Oe<F?(u(Oe,Math.min(Oe+de,F)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Oe,max:F})]:[3,3]):[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return Oe+=de,[3,1];case 4:return[2]}})})}function c(Oe,Ue){var Qe=V[Oe],Ge=V[Ue],Je=v[0]=I[Ue]-I[Oe],Ze=v[1]=M[Ue]-M[Oe],rt=v[2]=B[Ue]-B[Oe],et=Je*Je+Ze*Ze+rt*rt,St=Math.sqrt(et),De=(Qe*Qe+St*St-Ge*Ge)/(2*Qe*St),Ie=Qe*De;w.normalize(v,v),ZMe(h,v),w.normalize(h,h),w.cross(g,v,h),w.normalize(g,g);var je=Math.sqrt(Qe*Qe-Ie*Ie);w.scale(h,h,je),w.scale(g,g,je),w.scale(v,v,Ie),m[0]=v[0]+I[Oe],m[1]=v[1]+M[Oe],m[2]=v[2]+B[Oe],p=-1;for(var st=0;st<S;++st){var pt=le[st],qe=ve[st],bt=m[0]+pt*h[0]+qe*g[0],yt=m[1]+pt*h[1]+qe*g[1],Dt=m[2]+pt*h[2]+qe*g[2];if(o(bt,yt,Dt,Oe,Ue)===-1)for(var ee=Math.floor(C*(bt-$)),pe=Math.floor(C*(yt-J)),we=Math.floor(C*(Dt-Z)),Xe=Math.max(0,ee-x),dt=Math.max(0,pe-x),vt=Math.max(0,we-x),Et=Math.min(L,ee+x+2),_r=Math.min(H,pe+x+2),qr=Math.min(G,we+x+2),Qr=Xe;Qr<Et;++Qr)for(var _a=bt-re[Qr],bi=Qr*Q,Si=dt;Si<_r;++Si)for(var ys=yt-O[Si],Dx=_a*_a+ys*ys,Mx=Si*q+bi,Fp=vt;Fp<qr;++Fp){var Np=Dt-z[Fp],h5=Dx+Np*Np,Rx=Fp+Mx,Ox=Se[Rx];if(Ox>0&&h5<Ox*Ox){Se[Rx]=Math.sqrt(h5);var Fq=_a*v[0]+ys*v[1]+Np*v[2];ae[Rx]=U[Ee.indexOf(D,Fq<0?Ue:Oe)]}}}}function d(Oe,Ue){for(var Qe=Oe;Qe<Ue;++Qe){var Ge=Ee.getAt(D,Qe);P.find(I[Ge],M[Ge],B[Ge],V[Ge]);for(var Je=0,Ze=T.count;Je<Ze;++Je){var rt=Ee.getAt(D,T.indices[Je]);Ge<rt&&c(Ge,rt)}}}function f(){return se(this,void 0,void 0,function(){var Oe;return ie(this,function(Ue){switch(Ue.label){case 0:Oe=0,Ue.label=1;case 1:return Oe<F?(d(Oe,Math.min(Oe+de,F)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Oe,max:F})]:[3,3]):[3,4];case 2:Ue.sent(),Ue.label=3;case 3:return Oe+=de,[3,1];case 4:return[2]}})})}var p,v,m,h,g,y,b,S,C,x,A,P,T,D,I,M,B,U,V,F,Y,W,K,$,J,Z,N,j,L,H,G,q,X,Q,ue,le,ve,ge,Se,ae,re,O,z,de,me,ye,Te;return ie(this,function(Oe){switch(Oe.label){case 0:return p=-1,v=w(),m=w(),h=w(),g=w(),y=i.resolution,b=i.probeRadius,S=i.probePositions,C=1/y,x=Math.max(5,2+Math.floor(b*C)),A=w.create(n,n,n),w.scale(A,A,2),P=jf(t,r,A),T=P.result,a===null&&(a=P.boundary.box),D=t.indices,I=t.x,M=t.y,B=t.z,U=t.id,V=t.radius,F=Ee.size(D),Y=n+y,W=Ut.expand(Ut(),a,w.create(Y,Y,Y)),K=W.min,$=K[0],J=K[1],Z=K[2],N=Ut.scale(Ut(),W,C),j=Ut.size(w(),N),w.ceil(j,j),L=j[0],H=j[1],G=j[2],q=G,X=H,Q=q*X,ue=$Me(S),le=ue.cosTable,ve=ue.sinTable,ge=gr.Space(j,[0,1,2],Float32Array),Se=ge.create(),ae=ge.create(),Se.fill(-1001),ae.fill(-1),re=kv(L,$,y),O=kv(H,J,y),z=kv(G,Z,y),de=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*C)),[4,l()];case 1:return Oe.sent(),[4,f()];case 2:return Oe.sent(),me=gr.create(ge,Se),ye=gr.create(ge,ae),Te=oe.identity(),oe.fromScaling(Te,w.create(y,y,y)),oe.setTranslation(Te,W.min),[2,{field:me,idField:ye,transform:Te,resolution:y}]}})})}function eRe(e,t,r,n){for(var a=n.probeRadius,i=ox(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,l=o.indices,c=Ee.size(l),d=new Float32Array(Ee.end(l)),f=0,p=0;p<c;++p){var v=Ee.getAt(l,p),m=u(v);f<m&&(f=m),d[v]=m+a}return{position:_(_({},o),{radius:d}),boundary:s,maxRadius:f}}function fq(e,t,r,n){var a=this,i=t.lookup3d.boundary.box,o=wp(i,n),s=eRe(e,t,r,o),u=s.position,l=s.boundary,c=s.maxRadius;return Fe.create("Molecular Surface",function(d){return se(a,void 0,void 0,function(){return ie(this,function(f){switch(f.label){case 0:return[4,tRe(d,u,l,c,i,o)];case 1:return[2,f.sent()]}})})})}function tRe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){return ie(this,function(o){return[2,JMe(e,t,r,n,a,i)]})})}var pq=_(_(_(_({},$a),f5),ix),c9);function rRe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return ie(this,function(m){switch(m.label){case 0:return[4,fq(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=m.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,JS(d,i).runAsChild(e.runtime)];case 2:return f=m.sent(),a.includeParent&&(p=Math.ceil(2/a.resolution),Rt.smoothEdges(f,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})),Rt.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Rt.uniformTriangleGroup(f),v=Me.expand(Me(),t.boundary.sphere,zm(t)),f.setBoundingSphere(v),f.meta.resolution=c,[2,f]}})})}function nRe(e){return Bi({defaultProps:E.getDefaultValues(pq),createGeometry:rRe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Ps(n.smoothColors,a.color.preferSmoothing,s);l&&(iE(t,l.resolution,l.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var vq=_(_(_(_({},ux),f5),ix),{sizeFactor:E.Numeric(1.5,{min:0,max:10,step:.1})});function aRe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return ie(this,function(p){switch(p.label){case 0:return[4,fq(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:a.probeRadius,scalarField:u,idField:l},[4,fE(c,i).runAsChild(e.runtime)];case 2:return d=p.sent(),on.transform(d,s),f=Me.expand(Me(),t.boundary.sphere,a.probeRadius+zm(t)),d.setBoundingSphere(f),[2,d]}})})}function iRe(e){return lx({defaultProps:E.getDefaultValues(vq),createGeometry:aRe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var mq={"molecular-surface-mesh":function(e,t){return yn("Molecular surface mesh",e,t,nRe)},"molecular-surface-wireframe":function(e,t){return yn("Molecular surface wireframe",e,t,iRe)}},hq=_(_(_({},pq),vq),{visuals:E.MultiSelect(["molecular-surface-mesh"],E.objectToOptions(mq)),bumpFrequency:E.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)});function oRe(e,t){return E.clone(hq)}function sRe(e,t){return Yt.createMulti("Molecular Surface",e,t,va,mq)}var uRe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:sRe,getParams:oRe,defaultValues:E.getDefaultValues(hq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},gq=_(_({},$a),{sizeFactor:E.Numeric(1,{min:0,max:2,step:.1}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo)});function lRe(e){return Bi({defaultProps:E.getDefaultValues(gq),createGeometry:dRe,createLocationIterator:fRe,getLoci:pRe,eachLocation:vRe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function cRe(e){if(Be.Traits.is(e.traits,1)||Be.Traits.is(e.traits,2))return!1;if(Be.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function dRe(e,t,r,n,a,i){if(!cRe(t))return Rt.createEmpty(i);var o=a.detail,s=a.sizeFactor,u=256,l=ct.createState(u,u/2,i),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,p=c.dirB,v=si.size(w(),c);w.scale(v,v,s/2);var m=w.create(v[2],v[1],v[0]);l.currentGroup=0,lE(l,d,f,p,m,o+1);var h=ct.getMesh(l),g=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(g),h}function fRe(e){var t=e.group,r=e.structure,n=1,a=t.units.length,i=He.create(r),o=function(s,u){var l=t.units[u];return i.unit=l,i.element=l.elements[s],i};return sn(n,a,1,o)}function pRe(e,t,r){var n=e.objectId,a=e.instanceId;if(r===n){var i=t.structure,o=t.group,s=o.units[a],u=Ee.ofBounds(0,s.elements.length);return xe(i,[{unit:s,indices:u}])}return yr}function vRe(e,t,r){var n=!1;if(!xe.is(e))return!1;var a=t.structure,i=t.group;if(!Ne.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=i.unitIndexMap.get(l.unit.id);c!==void 0&&Ee.size(l.indices)===o&&r(Ce.ofSingleton(c))&&(n=!0)}return n}var yq={"orientation-ellipsoid-mesh":function(e,t){return yn("Orientation ellipsoid mesh",e,t,lRe)}},bq=_(_({},gq),{visuals:E.MultiSelect(["orientation-ellipsoid-mesh"],E.objectToOptions(yq)),bumpFrequency:E.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)});function mRe(e,t){return E.clone(bq)}function hRe(e,t){return Yt.createMulti("Orientation",e,t,va,yq)}var gRe={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:hRe,getParams:mRe,defaultValues:E.getDefaultValues(bq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},yRe=Le.add3,bRe=Le.add,OA;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Le.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Le.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,l,c){yRe(i,s,u,l),bRe(o,c)},getPoints:function(){var s=Le.compact(i,!0),u=Le.compact(o,!0);return Qf.create(s,u,i.elementCount,a)}}}e.create=t})(OA||(OA={}));var p5=_(_({},hwe),{pointSizeAttenuation:E.Boolean(!1),ignoreHydrogens:E.Boolean(!1),traceOnly:E.Boolean(!1)});function SRe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return Qf.createEmpty(i);var s=t.elements,u=s.length,l=OA.create(u,u/10,i),c=w(),d=t.conformation.invariantPosition,f=Cx(r,t,a);if(f)for(var p=0;p<u;++p)f(s[p])||(d(s[p],c),l.add(c[0],c[1],c[2],p));else for(var p=0;p<u;++p)d(s[p],c),l.add(c[0],c[1],c[2],p);var v=l.getPoints(),m=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(m),v}function Sq(e){return gwe({defaultProps:E.getDefaultValues(p5),createGeometry:SRe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var xRe={"element-point":function(e,t){return yn("Points",e,t,Sq)}},xq=_({},p5);function CRe(e,t){return E.clone(xq)}function wRe(e,t){return Yt.createMulti("Point",e,t,va,xRe)}var _Re={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:wRe,getParams:CRe,defaultValues:E.getDefaultValues(xq),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Cq={sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),linearSegments:E.Numeric(8,{min:1,max:48,step:1},at.CustomQualityParamInfo),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)};E.getDefaultValues(Cq);var Vi=w();function ARe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Rt.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,l=a.linearSegments,c=a.radialSegments,d=l*c*o+(c+1)*o*2,f=ct.createState(d,d/10,i),p=s5(l),v=p.curvePoints,m=p.normalVectors,h=p.binormalVectors,g=p.widthValues,y=p.heightValues,b=0,S=o5(t,r,{ignoreSecondaryStructure:!0});S.hasNext;){var C=S.move();f.currentGroup=b;var x=Uu(C.moleculeType),A=x?Px:Tx;u5(p,C,_G,A);var P=C.coarseBackboneFirst||C.first,T=C.coarseBackboneLast||C.last,D=n.size.size(C.centerPrev)*s,I=n.size.size(C.center)*s,M=n.size.size(C.centerNext)*s;IA(p,D,I,M,D,I,M,A);var B=l;if(C.initial){B=Math.max(Math.round(l*A),1);var U=l-B;v.copyWithin(0,U*3),h.copyWithin(0,U*3),m.copyWithin(0,U*3),g.copyWithin(0,U*3),y.copyWithin(0,U*3),w.fromArray(Vi,v,3),w.normalize(Vi,w.sub(Vi,C.p2,Vi)),w.scaleAndAdd(Vi,C.p2,Vi,I*B2),w.toArray(Vi,v,0)}else C.final&&(B=Math.max(Math.round(l*(1-A)),1),w.fromArray(Vi,v,B*3-3),w.normalize(Vi,w.sub(Vi,C.p2,Vi)),w.scaleAndAdd(Vi,C.p2,Vi,I*B2),w.toArray(Vi,v,B*3));C.initial===!0&&C.final===!0?la(f,C.p2,I*2,u):c===2?j1(f,v,m,h,B,g,y,0):c===4?q1(f,v,m,h,B,g,y,0,P,T):RA(f,v,m,h,B,c,g,y,P,T,"elliptical"),++b}var V=ct.getMesh(f),F=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return V.setBoundingSphere(F),V}var wq=_(_({},$a),Cq);function TRe(e){return Bi({defaultProps:E.getDefaultValues(wq),createGeometry:ARe,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var _q={"polymer-tube":function(e,t){return yn("Polymer tube mesh",e,t,TRe)},"polymer-gap":function(e,t){return yn("Polymer gap cylinder",e,t,l5)}},Aq=_(_(_({},wq),Ex),{sizeFactor:E.Numeric(.2,{min:0,max:10,step:.01}),visuals:E.MultiSelect(["polymer-tube","polymer-gap"],E.objectToOptions(_q)),bumpFrequency:E.Numeric(2,{min:0,max:10,step:.1},at.ShadingCategory)});function PRe(e,t){var r=E.clone(Aq),n=!1,a=!1;return t.units.forEach(function(i){!n&&Be.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r}function ERe(e,t){return Yt.createMulti("Putty",e,t,va,_q)}var IRe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:ERe,getParams:PRe,defaultValues:E.getDefaultValues(Aq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},DRe={"element-sphere":function(e,t){return yn("Sphere mesh",e,t,dG)}},Tq=_(_({},Ax),{bumpFrequency:E.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)});function MRe(e,t){var r=E.clone(Tq);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function RRe(e,t){return Yt.createMulti("Spacefill",e,t,va,DRe)}var ORe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:RRe,getParams:MRe,defaultValues:E.getDefaultValues(Tq),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Aw=vr.is;function BRe(e,t,r,n,a,i){if(!Be.isAtomic(t))return on.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return on.createEmpty(i);var u=He.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,p=c.b,v=c.edgeProps,m=c.offset;if(!d)return on.createEmpty(i);var h=v.order,g=v.flags,y=a.sizeFactor,b=a.aromaticBonds,S=a.includeTypes,C=a.excludeTypes,x=a.multipleBonds,A=x==="off",P=x==="symmetric",T=vr.fromNames(S),D=vr.fromNames(C),I=bx(T,D,32),M=w(),B=t.conformation.invariantPosition,U=t.rings,V=U.elementRingIndices,F=U.elementAromaticRingIndices,Y={linkCount:d*2,referencePosition:function($){var J,Z,N=f[$],j=p[$];N>j&&(J=[j,N],N=J[0],j=J[1]),m[N+1]-m[N]===1&&(Z=[j,N],N=Z[0],j=Z[1]);for(var L=F.get(N)||V.get(N),H=0,G=m[N],q=m[N+1];G<q;++G){var X=p[G];if(X!==j&&X!==N)if(L){var Q=F.get(X)||V.get(X);if(!Q)continue;var ue=Cb(L,Q);ue>H&&(H=ue,B(l[X],M))}else return B(l[X],M)}return H>0?M:null},position:function($,J,Z){B(l[f[Z]],$),B(l[p[Z]],J)},style:function($){var J=h[$],Z=g[$];if(Aw(Z,2)||Aw(Z,4))return 1;if(J===3)return A?0:P?4:5;if(b){var N=f[$],j=p[$],L=F.get(N),H=F.get(j),G=L&&H?Cb(L,H):0;if(Aw(Z,16)||G&&!I)return G===2?8:7}return J!==2||A?0:P?2:3},radius:function($){u.element=l[f[$]];var J=n.size.size(u);u.element=l[p[$]];var Z=n.size.size(u);return Math.min(J,Z)*y},ignore:aG(r,t,a)},W=ZV(e,Y,a,i),K=Me.expand(Me(),(s!=null?s:t).boundary.sphere,1*y);return W.setBoundingSphere(K),W}var Pq=_(_(_({},ux),t5),{includeParent:E.Boolean(!1)});function kRe(e){return lx({defaultProps:E.getDefaultValues(Pq),createGeometry:BRe,createLocationIterator:Od.fromGroup,getLoci:r5,eachLocation:n5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],l=s.group.units[0];Be.isAtomic(u)&&Be.isAtomic(l)&&(eo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var Tw=new Ot.ElementBondIterator;function Mk(e,t,r,n){for(Tw.setElement(t,r,n);Tw.hasNext;){var a=Tw.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function LRe(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges;if(!o)return on.createEmpty(a);var u=n.sizeFactor,l=n.aromaticBonds,c=n.multipleBonds,d=c==="off",f=c==="symmetric",p=w(),v=He.create(),m={linkCount:o,referencePosition:function(b){var S=s[b],C,x,A,P;if(S.unitA<S.unitB)C=t.unitMap.get(S.unitA),x=t.unitMap.get(S.unitB),A=S.indexA,P=S.indexB;else if(S.unitA>S.unitB)C=t.unitMap.get(S.unitB),x=t.unitMap.get(S.unitA),A=S.indexB,P=S.indexA;else throw new Error("same units in createInterUnitBondLines");return Mk(p,t,C,A)||Mk(p,t,x,P)},position:function(b,S,C){var x=s[C],A=t.unitMap.get(x.unitA),P=t.unitMap.get(x.unitB);A.conformation.position(A.elements[x.indexA],b),P.conformation.position(P.elements[x.indexB],S)},style:function(b){var S=s[b].props.order,C=Xa.create(s[b].props.flag);return vr.is(C,2)||vr.is(C,4)?1:S===3?d?0:f?4:5:l&&vr.is(C,16)?7:S!==2||d?0:f?2:3},radius:function(b){var S=s[b];v.structure=t,v.unit=t.unitMap.get(S.unitA),v.element=v.unit.elements[S.indexA];var C=r.size.size(v);v.unit=t.unitMap.get(S.unitB),v.element=v.unit.elements[S.indexB];var x=r.size.size(v);return Math.min(C,x)*u},ignore:iG(t,n)},h=ZV(e,m,n,a),g=t.child,y=Me.expand(Me(),(g!=null?g:t).boundary.sphere,1*n.sizeFactor);return h.setBoundingSphere(y),h}var Eq=_(_(_({},swe),t5),{includeParent:E.Boolean(!1)});function FRe(e){return uwe({defaultProps:E.getDefaultValues(Eq),createGeometry:LRe,createLocationIterator:Od.fromStructure,getLoci:a5,eachLocation:i5,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!Di(r.includeTypes,n.includeTypes)||!Di(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var ov=w.scaleAndAdd,Rk=w.unitX,Ok=w.unitY,Bk=w.unitZ,Iq=_(_({},ux),{lineSizeAttenuation:E.Boolean(!1),ignoreHydrogens:E.Boolean(!1),traceOnly:E.Boolean(!1),crosses:E.Select("lone",E.arrayToOptions(["lone","all"])),crossSize:E.Numeric(.35,{min:0,max:2,step:.01})});function NRe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return on.createEmpty(i);for(var s=t.elements,u=s.length,l=to.create(u,u/10,i),c=w(),d=w(),f=w(),p=t.conformation.invariantPosition,v=Cx(r,t,a),m=a.crossSize/2,h=a.crosses==="lone",g=0;g<u;++g)v&&v(s[g])||h&&Be.isAtomic(t)&&Bu(r,t,g)!==0||(p(s[g],c),ov(d,c,Rk,m),ov(f,c,Rk,-m),l.add(d[0],d[1],d[2],f[0],f[1],f[2],g),ov(d,c,Ok,m),ov(f,c,Ok,-m),l.add(d[0],d[1],d[2],f[0],f[1],f[2],g),ov(d,c,Bk,m),ov(f,c,Bk,-m),l.add(d[0],d[1],d[2],f[0],f[1],f[2],g));var y=l.getLines(),b=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function URe(e){return lx({defaultProps:E.getDefaultValues(Iq),createGeometry:NRe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var Dq={"intra-bond":function(e,t){return yn("Intra-unit bond line",e,t,kRe)},"inter-bond":function(e,t){return Hs("Inter-unit bond line",e,t,FRe)},"element-point":function(e,t){return yn("Points",e,t,Sq)},"element-cross":function(e,t){return yn("Crosses",e,t,URe)}},Mq=_(_(_(_(_({},Pq),Eq),p5),Iq),{multipleBonds:E.Select("offset",E.arrayToOptions(["off","symmetric","offset"])),includeParent:E.Boolean(!1),sizeFactor:E.Numeric(3,{min:.01,max:10,step:.01}),unitKinds:Ug(["atomic"]),visuals:E.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],E.objectToOptions(Dq))});function zRe(e,t){var r=E.clone(Mq);return r.pointStyle.defaultValue="circle",r}function VRe(e,t){return Yt.createMulti("Line",e,t,va,Dq)}var HRe={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:VRe,getParams:zRe,defaultValues:E.getDefaultValues(Mq),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function GRe(e,t,r,n,a){return se(this,void 0,void 0,function(){var i,o,s,u,l,c,d,f,p,v,m,h,g,y;return ie(this,function(b){switch(b.label){case 0:if(i=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=a?a.gridTexture.ref.value:void 0,[4,TMe(t,r.size,n,o,s).runInContext(i)];case 1:return u=b.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},v=oe.mul(oe(),l,oe.fromScaling(oe(),f)),m=oe.getScaling(w(),l),h=w.create(0,1,2),g=_o.create(d,f,l,v,m,c,p,!0,h,a),y=Me.expand(Me(),t.boundary.sphere,n.radiusOffset+sx(t)),g.setBoundingSphere(y),[2,g]}})})}var Rq=_(_(_({},dwe),Xg),{ignoreHydrogens:E.Boolean(!1),includeParent:E.Boolean(!1,{isHidden:!0})});function qRe(e){return fwe({defaultProps:E.getDefaultValues(Rq),createGeometry:GRe,createLocationIterator:Za.fromStructure,getLoci:_x,eachLocation:wx,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function jRe(e,t,r,n,a,i){return se(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,m,h,g,y,b;return ie(this,function(S){switch(S.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=i?i.gridTexture.ref.value:void 0,[4,wMe(r,t,n.size,a,s,u).runInContext(o)];case 1:return l=S.sent(),c=l.transform,d=l.texture,f=l.bbox,p=l.gridDim,v={min:0,max:1,mean:.04,sigma:.01},m=oe.mul(oe(),c,oe.fromScaling(oe(),p)),h=oe.getScaling(w(),c),g=w.create(0,1,2),y=_o.create(f,p,c,m,h,d,v,!0,g,i),b=Me.expand(Me(),t.boundary.sphere,a.radiusOffset+zm(t)),y.setBoundingSphere(b),[2,y]}})})}var WRe=_(_(_({},ywe),Xg),{ignoreHydrogens:E.Boolean(!1),includeParent:E.Boolean(!1,{isHidden:!0})});function XRe(e){return bwe({defaultProps:E.getDefaultValues(WRe),createGeometry:jRe,createLocationIterator:Za.fromGroup,getLoci:tu,eachLocation:eu,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var Oq={"gaussian-volume":function(e,t){return Hs("Gaussian volume",e,t,qRe)},"units-gaussian-volume":function(e,t){return yn("Units-Gaussian volume",e,t,XRe)}},Bq=_(_({},Rq),{visuals:E.MultiSelect(["gaussian-volume"],E.objectToOptions(Oq))});function YRe(e,t){var r=E.clone(Bq);return r.jumpLength=E.Numeric(4,{min:0,max:20,step:.1}),r}function KRe(e,t){return Yt.createMulti("Gaussian Volume",e,t,va,Oq)}var QRe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:KRe,getParams:YRe,defaultValues:E.getDefaultValues(Bq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},ZRe=w.scale,$Re=w.add,JRe=w.sub,v5=_(_(_({},$a),XV),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:E.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),tryUseImpostor:E.Boolean(!0)});function e6e(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?r6e(e):a6e(e)}function t6e(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return ho.createEmpty(i);var s=o*2,u=C2.create(s,s/4,i),l=t.conformation.invariantPosition,c=w(),d=w(),f=w(),p=function(h,g,y,b,S){l(h,c),l(g,d);var C=Uu(S),x=C?Px:Tx;$Re(f,c,ZRe(f,JRe(f,d,c),x)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};SG(t,p);var v=u.getCylinders(),m=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(m),v}function r6e(e){return YV({defaultProps:E.getDefaultValues(v5),createGeometry:t6e,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function n6e(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Rt.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,l=s*2*o*2,c=ct.createState(l,l/10,i),d=t.conformation.invariantPosition,f=w(),p=w(),v={radiusTop:1,radiusBottom:1,radialSegments:s},m=He.create(r,t),h=He.create(r,t),g=function(S,C,x,A,P){m.element=S,h.element=C,d(m.element,f),d(h.element,p);var T=Uu(P),D=T?Px:Tx;v.radiusTop=v.radiusBottom=n.size.size(m)*u,c.currentGroup=x,ga(c,f,p,D,v),v.radiusTop=v.radiusBottom=n.size.size(h)*u,c.currentGroup=A,ga(c,p,f,1-D,v)};SG(t,g);var y=ct.getMesh(c),b=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function a6e(e){return Bi({defaultProps:E.getDefaultValues(v5),createGeometry:n6e,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var m5=_(_(_({},$a),jV),{sizeFactor:E.Numeric(.3,{min:0,max:10,step:.01}),detail:E.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),tryUseImpostor:E.Boolean(!0)});function i6e(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?s6e(e):l6e(e)}function o6e(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Dd.createEmpty(i);var s=O2.create(o,o/2,i),u=t.conformation.invariantPosition,l=w(),c=function(p,v){u(p,l),s.add(l[0],l[1],l[2],v)};xG(t,c);var d=s.getSpheres(),f=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return d.setBoundingSphere(f),d}function s6e(e){return WV({defaultProps:E.getDefaultValues(m5),createGeometry:o6e,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function u6e(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Rt.createEmpty(i);var s=a.detail,u=a.sizeFactor,l=o*qS(s),c=ct.createState(l,l/2,i),d=t.conformation.invariantPosition,f=w(),p=He.create(r,t),v=function(g,y){p.element=g,d(p.element,f),c.currentGroup=y,la(c,f,n.size.size(p)*u,s)};xG(t,v);var m=ct.getMesh(c),h=Me.expand(Me(),t.boundary.sphere,1*a.sizeFactor);return m.setBoundingSphere(h),m}function l6e(e){return Bi({defaultProps:E.getDefaultValues(m5),createGeometry:u6e,createLocationIterator:jl.fromGroup,getLoci:kp,eachLocation:Lp,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var kq={"polymer-backbone-cylinder":function(e,t){return yn("Polymer backbone cylinder",e,t,e6e)},"polymer-backbone-sphere":function(e,t){return yn("Polymer backbone sphere",e,t,i6e)},"polymer-gap":function(e,t){return yn("Polymer gap cylinder",e,t,l5)}},Lq=_(_(_(_({},m5),v5),Ex),{sizeAspectRatio:E.Numeric(1,{min:.1,max:3,step:.1}),visuals:E.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],E.objectToOptions(kq)),bumpFrequency:E.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)});function c6e(e,t){var r=E.clone(Lq),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function d6e(e,t){return Yt.createMulti("Backbone",e,t,va,kq)}var f6e={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:d6e,getParams:c6e,defaultValues:E.getDefaultValues(Lq),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},BA=function(e){Pe(t,e);function t(){var r=e.call(this)||this;return ns(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return t}(LU);(function(e){e.BuiltIn={cartoon:aMe,backbone:f6e,"ball-and-stick":dIe,carbohydrate:YIe,ellipsoid:lMe,"gaussian-surface":HMe,"gaussian-volume":QRe,label:QMe,line:HRe,"molecular-surface":uRe,orientation:gRe,point:_Re,putty:IRe,spacefill:ORe}})(BA||(BA={}));var p6e=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(fn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return se(this,void 0,void 0,function(){return ie(this,function(a){switch(a.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous,r==null?void 0:r.animation)];case 1:return a.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=fn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),(t==null?void 0:t.immediate)?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),(t==null?void 0:t.noDraw)&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),v6e=function(){function e(t){var r=this;this.plugin=t,this.ev=El.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(!!n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!fe.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var a=this.root.get(n.data);a.count++}else{var i=t.select(Kt.Generators.byRef(r).rootOfType([fe.Molecule.Structure]))[0];i?this.root.set(n.data,{ref:i.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return fe.Molecule.Structure.is(a)?(this.removeMapping(r),this.addMapping(t,r,a),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),kA=function(){function e(){this.ev=El.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var a=n[r],i=this.tryGetAbortTaskId(a);if(i!==void 0)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);o!==void 0&&a.requestAbort(n.abortRequests.get(o))}var s=fn()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(i=n.options.get(r))===null||i===void 0?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return se(this,void 0,void 0,function(){var n,a,i;return ie(this,function(o){switch(o.label){case 0:n=this.id++,(r==null?void 0:r.createNewContext)||this.currentContext.length===0?a={ctx:VY(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1],a.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r==null?void 0:r.useOverlay)}),this.runningTasks.add(t.id),[4,D8(a.ctx,t)];case 2:return i=o.sent(),[2,i];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,a.refCount===0&&j0(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}function r(n){var a=this;return Fe.create("Test",function(i){return se(a,void 0,void 0,function(){var o;return ie(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(kA||(kA={}));var m6e=function(e){Pe(t,e);function t(r){var n=e.call(this,{entries:ci()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,ft.Toast.Show.subscribe(r,function(a){return n.show(a)}),ft.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,a=this.state.entries,i=void 0,o=++this.serialId,s;r.key&&(i=this.findByKey(r.key))?(i.timeout!==void 0&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next(void 0)},t.prototype.timeout=function(r,n){var a=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){!r||(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))},t}(uc),h6e=function(e){Pe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var a=document.createElement("canvas");return a}(),n.previewCanvas=function(){var a=document.createElement("canvas");return a}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:$e(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:E.MappedStatic("viewport",{viewport:E.Group({}),hd:E.Group({}),"full-hd":E.Group({}),"ultra-hd":E.Group({}),custom:E.Group({width:E.Numeric(1920,{min:128,max:r,step:1}),height:E.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:E.Boolean(!1),axes:nx.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=n.props.postprocessing.occlusion;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:i&&o?4:2},postprocessing:_(_({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:_(_({},s.params),{samples:128})}:s}),marking:_({},n.props.marking)})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:_(_({},r.props.postprocessing),{occlusion:n.name==="on"?{name:"on",params:_(_({},n.params),{samples:128})}:n}),marking:_({},r.props.marking)}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=Pn.toArray(a).join("-");return"".concat(i||"molstar-image").concat(r)},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(_(_({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(_(_({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return tn(r.x,0,1e-5)&&tn(r.y,0,1e-5)&&tn(r.width,1,1e-5)&&tn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=i,c=0,d=o,f=0,p=0;p<o;p++)for(var v=p*i,m=0;m<i;m++){var h=4*(v+m);if(s){if(a[h+3]===0)continue}else{var g=a[h]<<16|a[h+1]<<8|a[h+2]|a[h+3]<<24;if(g===u)continue}m<l&&(l=m),m>c&&(c=m),p<d&&(d=p),p>f&&(f=p)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var C={x:Math.max(0,l/i),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/i),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(C)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing,marking:l.marking});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return se(this,void 0,void 0,function(){var n,a,i,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),a=n.width,i=n.height,o=n.viewport,a<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(a,i,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n==null?void 0:n.write)){this.plugin.log.error("clipboard.write not supported!");return}return Fe.create("Copy Image",function(a){return se(r,void 0,void 0,function(){var i,o;return ie(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,QB(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(Fe.create("Generate Image",function(n){return se(r,void 0,void 0,function(){return ie(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(!!r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return Fe.create("Download Image",function(a){return se(n,void 0,void 0,function(){var i;return ie(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,QB(this.canvas,"png")];case 3:return i=o.sent(),qz(i,r!=null?r:this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(Fg),g6e=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,a){return r.managers.task.run(n,a)},this.resolveTask=function(n){if(!!n)return Fe.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=El.create(),this.config=new ooe(this.spec.config),this.state=new D2(this),this.commands=new voe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Yt.Loci.Empty,modifiers:Vs.None,buttons:0,button:0}),click:this.ev.behavior({current:Yt.Loci.Empty,modifiers:Vs.None,buttons:0,button:0}),drag:this.ev.behavior({current:Yt.Loci.Empty,modifiers:Vs.None,buttons:0,button:0,pageStart:ke(),pageEnd:ke()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(vS(function(n){return!!n}),hQ(1))}},this.layout=new Y5e(this),this.animationLoop=new p6e(this),this.representation={structure:{registry:new BA,themes:{colorThemeRegistry:Ru.createRegistry(),sizeThemeRegistry:pa.createRegistry()}},volume:{registry:new i2,themes:{colorThemeRegistry:Ru.createRegistry(),sizeThemeRegistry:pa.createRegistry()}}},this.query={structure:{registry:new C1e}},this.dataFormats=new B5e,this.builders={data:new c5e(this),structure:void 0},this.helpers={substructureParent:new v6e(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new dg(this),component:new Md(this),measurement:new QTe(this),selection:new H5e(this),focus:new z5e(this)},volume:{hierarchy:new E2(this)},interactivity:void 0,camera:new F5e(this),animation:new k5e(this),snapshot:new l2(this),lociLabels:void 0,toast:new m6e(this),asset:new EK,task:new kA},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new M2.Registry,this.customStructureProperties=new M2.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:Ef(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(xu.error(n))},message:function(n){return r.events.log.next(xu.message(n))},info:function(n){return r.events.log.next(xu.info(n))},warn:function(n){return r.events.log.next(xu.warning(n))}},this.fetch=D_,IQ(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var a=this,i,o,s,u,l,c;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var d=!((i=this.config.get(Lr.General.DisableAntialiasing))!==null&&i!==void 0?i:!1),f=!((o=this.config.get(Lr.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0?o:!1),p=this.config.get(Lr.General.PixelScale)||1,v=this.config.get(Lr.General.PickScale)||.25,m=(s=this.config.get(Lr.General.PickPadding))!==null&&s!==void 0?s:1,h=this.config.get(Lr.General.EnableWboit)||!1,g=this.config.get(Lr.General.PreferWebGl1)||!1;this.canvas3dContext=eA.fromCanvas(t,{antialias:d,preserveDrawingBuffer:f,pixelScale:p,pickScale:v,pickPadding:m,enableWboit:h,preferWebGl1:g})}this.canvas3d=tA.create(this.canvas3dContext),this.canvas3dInit.next(!0);var y=this.spec.canvas3d,b=$e(16579577);return y?(((l=y.renderer)===null||l===void 0?void 0:l.backgroundColor)===void 0&&(y=Il(y,function(S){S.renderer?S.renderer.backgroundColor=b:S.renderer={backgroundColor:b}})),(c=this.canvas3d)===null||c===void 0||c.setProps(y)):(u=this.canvas3d)===null||u===void 0||u.setProps({renderer:{backgroundColor:b}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new h6e(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(S){return a.behaviors.interaction.click.next(S)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(S){return a.behaviors.interaction.drag.next(S)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(S){return a.behaviors.interaction.hover.next(S)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return a.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),!0}catch(S){return this.log.error(""+S),console.error(S),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,a=this.layout.root;if(a&&n){var i=this.config.get(Lr.General.PixelScale)||1;u5e(n,a,i),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(TE)),ft.State.RemoveObject(this,{state:this.state.data,ref:er.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++){var o=i[a];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),ns(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),ns(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(il(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(Lr.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){a!==void 0&&clearTimeout(a),a=void 0};this.subs.push(il(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;Yy.State.registerDefault(this),Yy.Representation.registerDefault(this),Yy.Camera.registerDefault(this),Yy.Misc.registerDefault(this),this.subs.push(il(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return se(this,void 0,void 0,function(){var t,r,n,l,a,i,u,l,o,s,u,l;return ie(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Pr.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Pr.CreateCategory,{label:Pr.Categories[l]},{ref:l,state:{isLocked:!0}});for(a=0,i=this.spec.behaviors;a<i.length;a++)u=i[a],l=Pr.getCategoryId(u.transformer),l==="custom-props"&&t.to(Pr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Pr.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Pr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(!!this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(!!this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(!!this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return se(this,void 0,void 0,function(){var t=this;return ie(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new T2(this),this.managers.lociLabels=new N5e(this),this.builders.structure=new S5e(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin ".concat(j4," [").concat(o2e.toLocaleString(),"]")),Cg||this.log.message("Development mode enabled"),Ar&&this.log.message("Debug mode enabled"),[2]}})})},e}(),y6e=function(e){Pe(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(!!this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var a=n[r],i=a[0],o=a[1];this.customParamEditors.set(i.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(g6e);function x6e(e,t,r){return se(this,void 0,void 0,function(){var n;return ie(this,function(a){switch(a.label){case 0:return n=new y6e(t||yTe()),[4,n.init()];case 1:return a.sent(),(r==null?void 0:r.onBeforeUIRender)?[4,r.onBeforeUIRender(n)]:[3,3];case 2:a.sent(),a.label=3;case 3:return VA.exports.render(Tt.exports.createElement(e5e,{plugin:n}),e),[2,n]}})})}export{tA as C,yTe as D,At as F,Lr as P,S6e as R,Ne as S,be as a,G_e as b,x6e as c,g6e as d,eA as e,Ru as f,pa as g,aMe as h,Ol as i,k as j,b6e as k,Tt as r,s5e as s,T7 as t};
