var U0={exports:{}},Mr={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var b4=Object.getOwnPropertySymbols,QV=Object.prototype.hasOwnProperty,ZV=Object.prototype.propertyIsEnumerable;function $V(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function JV(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(n.join("")!=="0123456789")return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(i){a[i]=i}),Object.keys(Object.assign({},a)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var x4=JV()?Object.assign:function(e,t){for(var r,n=$V(e),a,i=1;i<arguments.length;i++){r=Object(arguments[i]);for(var o in r)QV.call(r,o)&&(n[o]=r[o]);if(b4){a=b4(r);for(var s=0;s<a.length;s++)ZV.call(r,a[s])&&(n[a[s]]=r[a[s]])}}return n};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ax=x4,Wd=60103,S4=60106;Mr.Fragment=60107;Mr.StrictMode=60108;Mr.Profiler=60114;var C4=60109,_4=60110,w4=60112;Mr.Suspense=60113;var A4=60115,T4=60116;if(typeof Symbol=="function"&&Symbol.for){var ns=Symbol.for;Wd=ns("react.element"),S4=ns("react.portal"),Mr.Fragment=ns("react.fragment"),Mr.StrictMode=ns("react.strict_mode"),Mr.Profiler=ns("react.profiler"),C4=ns("react.provider"),_4=ns("react.context"),w4=ns("react.forward_ref"),Mr.Suspense=ns("react.suspense"),A4=ns("react.memo"),T4=ns("react.lazy")}var P4=typeof Symbol=="function"&&Symbol.iterator;function eG(e){return e===null||typeof e!="object"?null:(e=P4&&e[P4]||e["@@iterator"],typeof e=="function"?e:null)}function Xp(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var E4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I4={};function Xd(e,t,r){this.props=e,this.context=t,this.refs=I4,this.updater=r||E4}Xd.prototype.isReactComponent={};Xd.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error(Xp(85));this.updater.enqueueSetState(this,e,t,"setState")};Xd.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function D4(){}D4.prototype=Xd.prototype;function ix(e,t,r){this.props=e,this.context=t,this.refs=I4,this.updater=r||E4}var ox=ix.prototype=new D4;ox.constructor=ix;ax(ox,Xd.prototype);ox.isPureReactComponent=!0;var sx={current:null},M4=Object.prototype.hasOwnProperty,R4={key:!0,ref:!0,__self:!0,__source:!0};function B4(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)M4.call(t,n)&&!R4.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var u=Array(s),c=0;c<s;c++)u[c]=arguments[c+2];a.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Wd,type:e,key:i,ref:o,props:a,_owner:sx.current}}function tG(e,t){return{$$typeof:Wd,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ux(e){return typeof e=="object"&&e!==null&&e.$$typeof===Wd}function rG(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var F4=/\/+/g;function cx(e,t){return typeof e=="object"&&e!==null&&e.key!=null?rG(""+e.key):t.toString(36)}function z0(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Wd:case S4:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+cx(o,0):n,Array.isArray(a)?(r="",e!=null&&(r=e.replace(F4,"$&/")+"/"),z0(a,t,r,"",function(c){return c})):a!=null&&(ux(a)&&(a=tG(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(F4,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",Array.isArray(e))for(var s=0;s<e.length;s++){i=e[s];var u=n+cx(i,s);o+=z0(i,t,r,u,a)}else if(u=eG(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=n+cx(i,s++),o+=z0(i,t,r,u,a);else if(i==="object")throw t=""+e,Error(Xp(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t));return o}function V0(e,t,r){if(e==null)return e;var n=[],a=0;return z0(e,n,"","",function(i){return t.call(r,i,a++)}),n}function nG(e){if(e._status===-1){var t=e._result;t=t(),e._status=0,e._result=t,t.then(function(r){e._status===0&&(r=r.default,e._status=1,e._result=r)},function(r){e._status===0&&(e._status=2,e._result=r)})}if(e._status===1)return e._result;throw e._result}var O4={current:null};function xu(){var e=O4.current;if(e===null)throw Error(Xp(321));return e}var aG={ReactCurrentDispatcher:O4,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:sx,IsSomeRendererActing:{current:!1},assign:ax};Mr.Children={map:V0,forEach:function(e,t,r){V0(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return V0(e,function(){t++}),t},toArray:function(e){return V0(e,function(t){return t})||[]},only:function(e){if(!ux(e))throw Error(Xp(143));return e}};Mr.Component=Xd;Mr.PureComponent=ix;Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aG;Mr.cloneElement=function(e,t,r){if(e==null)throw Error(Xp(267,e));var n=ax({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=sx.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)M4.call(t,u)&&!R4.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var c=0;c<u;c++)s[c]=arguments[c+2];n.children=s}return{$$typeof:Wd,type:e.type,key:a,ref:i,props:n,_owner:o}};Mr.createContext=function(e,t){return t===void 0&&(t=null),e={$$typeof:_4,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider={$$typeof:C4,_context:e},e.Consumer=e};Mr.createElement=B4;Mr.createFactory=function(e){var t=B4.bind(null,e);return t.type=e,t};Mr.createRef=function(){return{current:null}};Mr.forwardRef=function(e){return{$$typeof:w4,render:e}};Mr.isValidElement=ux;Mr.lazy=function(e){return{$$typeof:T4,_payload:{_status:-1,_result:e},_init:nG}};Mr.memo=function(e,t){return{$$typeof:A4,type:e,compare:t===void 0?null:t}};Mr.useCallback=function(e,t){return xu().useCallback(e,t)};Mr.useContext=function(e,t){return xu().useContext(e,t)};Mr.useDebugValue=function(){};Mr.useEffect=function(e,t){return xu().useEffect(e,t)};Mr.useImperativeHandle=function(e,t,r){return xu().useImperativeHandle(e,t,r)};Mr.useLayoutEffect=function(e,t){return xu().useLayoutEffect(e,t)};Mr.useMemo=function(e,t){return xu().useMemo(e,t)};Mr.useReducer=function(e,t,r){return xu().useReducer(e,t,r)};Mr.useRef=function(e){return xu().useRef(e)};Mr.useState=function(e){return xu().useState(e)};Mr.version="17.0.2";U0.exports=Mr;var VPe=U0.exports,k4={exports:{}},po={},L4={exports:{}},N4={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){var t,r,n,a;if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var u=null,c=null,l=function(){if(u!==null)try{var te=e.unstable_now();u(!0,te),u=null}catch(K){throw setTimeout(l,0),K}};t=function(te){u!==null?setTimeout(t,0,te):(u=te,setTimeout(l,0))},r=function(te,K){c=setTimeout(te,K)},n=function(){clearTimeout(c)},e.unstable_shouldYield=function(){return!1},a=e.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,d=window.clearTimeout;if(typeof console!="undefined"){var m=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof m!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var p=!1,v=null,h=-1,g=5,y=0;e.unstable_shouldYield=function(){return e.unstable_now()>=y},a=function(){},e.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):g=0<te?Math.floor(1e3/te):5};var b=new MessageChannel,x=b.port2;b.port1.onmessage=function(){if(v!==null){var te=e.unstable_now();y=te+g;try{v(!0,te)?x.postMessage(null):(p=!1,v=null)}catch(K){throw x.postMessage(null),K}}else p=!1},t=function(te){v=te,p||(p=!0,x.postMessage(null))},r=function(te,K){h=f(function(){te(e.unstable_now())},K)},n=function(){d(h),h=-1}}function C(te,K){var L=te.length;te.push(K);e:for(;;){var W=L-1>>>1,k=te[W];if(k!==void 0&&0<T(k,K))te[W]=K,te[L]=k,L=W;else break e}}function _(te){return te=te[0],te===void 0?null:te}function w(te){var K=te[0];if(K!==void 0){var L=te.pop();if(L!==K){te[0]=L;e:for(var W=0,k=te.length;W<k;){var V=2*(W+1)-1,G=te[V],H=V+1,X=te[H];if(G!==void 0&&0>T(G,L))X!==void 0&&0>T(X,G)?(te[W]=X,te[H]=L,W=H):(te[W]=G,te[V]=L,W=V);else if(X!==void 0&&0>T(X,L))te[W]=X,te[H]=L,W=H;else break e}}return K}return null}function T(te,K){var L=te.sortIndex-K.sortIndex;return L!==0?L:te.id-K.id}var A=[],D=[],E=1,M=null,F=3,O=!1,U=!1,N=!1;function q(te){for(var K=_(D);K!==null;){if(K.callback===null)w(D);else if(K.startTime<=te)w(D),K.sortIndex=K.expirationTime,C(A,K);else break;K=_(D)}}function j(te){if(N=!1,q(te),!U)if(_(A)!==null)U=!0,t(Q);else{var K=_(D);K!==null&&r(j,K.startTime-te)}}function Q(te,K){U=!1,N&&(N=!1,n()),O=!0;var L=F;try{for(q(K),M=_(A);M!==null&&(!(M.expirationTime>K)||te&&!e.unstable_shouldYield());){var W=M.callback;if(typeof W=="function"){M.callback=null,F=M.priorityLevel;var k=W(M.expirationTime<=K);K=e.unstable_now(),typeof k=="function"?M.callback=k:M===_(A)&&w(A),q(K)}else w(A);M=_(A)}if(M!==null)var V=!0;else{var G=_(D);G!==null&&r(j,G.startTime-K),V=!1}return V}finally{M=null,F=L,O=!1}}var J=a;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(te){te.callback=null},e.unstable_continueExecution=function(){U||O||(U=!0,t(Q))},e.unstable_getCurrentPriorityLevel=function(){return F},e.unstable_getFirstCallbackNode=function(){return _(A)},e.unstable_next=function(te){switch(F){case 1:case 2:case 3:var K=3;break;default:K=F}var L=F;F=K;try{return te()}finally{F=L}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=J,e.unstable_runWithPriority=function(te,K){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var L=F;F=te;try{return K()}finally{F=L}},e.unstable_scheduleCallback=function(te,K,L){var W=e.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?W+L:W):L=W,te){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=L+k,te={id:E++,callback:K,priorityLevel:te,startTime:L,expirationTime:k,sortIndex:-1},L>W?(te.sortIndex=L,C(D,te),_(A)===null&&te===_(D)&&(N?n():N=!0,r(j,L-W))):(te.sortIndex=k,C(A,te),U||O||(U=!0,t(Q))),te},e.unstable_wrapCallback=function(te){var K=F;return function(){var L=F;F=K;try{return te.apply(this,arguments)}finally{F=L}}}})(N4);L4.exports=N4;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0=U0.exports,vn=x4,pa=L4.exports;function gt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!G0)throw Error(gt(227));var U4=new Set,Yp={};function sf(e,t){Yd(e,t),Yd(e+"Capture",t)}function Yd(e,t){for(Yp[e]=t,e=0;e<t.length;e++)U4.add(t[e])}var Su=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),iG=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,z4=Object.prototype.hasOwnProperty,V4={},G4={};function oG(e){return z4.call(G4,e)?!0:z4.call(V4,e)?!1:iG.test(e)?G4[e]=!0:(V4[e]=!0,!1)}function sG(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function uG(e,t,r,n){if(t===null||typeof t=="undefined"||sG(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ui(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var Pa={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Pa[e]=new ui(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Pa[t]=new ui(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Pa[e]=new ui(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Pa[e]=new ui(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Pa[e]=new ui(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Pa[e]=new ui(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Pa[e]=new ui(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Pa[e]=new ui(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Pa[e]=new ui(e,5,!1,e.toLowerCase(),null,!1,!1)});var lx=/[\-:]([a-z])/g;function fx(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(lx,fx);Pa[t]=new ui(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(lx,fx);Pa[t]=new ui(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(lx,fx);Pa[t]=new ui(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Pa[e]=new ui(e,1,!1,e.toLowerCase(),null,!1,!1)});Pa.xlinkHref=new ui("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Pa[e]=new ui(e,1,!1,e.toLowerCase(),null,!0,!0)});function dx(e,t,r,n){var a=Pa.hasOwnProperty(t)?Pa[t]:null,i=a!==null?a.type===0:n?!1:!(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N");i||(uG(t,r,a,n)&&(r=null),n||a===null?oG(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var uf=G0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kp=60103,cf=60106,Fc=60107,mx=60108,Qp=60114,px=60109,vx=60110,H0=60112,Zp=60113,q0=60120,j0=60115,hx=60116,gx=60121,yx=60128,H4=60129,bx=60130,xx=60131;if(typeof Symbol=="function"&&Symbol.for){var va=Symbol.for;Kp=va("react.element"),cf=va("react.portal"),Fc=va("react.fragment"),mx=va("react.strict_mode"),Qp=va("react.profiler"),px=va("react.provider"),vx=va("react.context"),H0=va("react.forward_ref"),Zp=va("react.suspense"),q0=va("react.suspense_list"),j0=va("react.memo"),hx=va("react.lazy"),gx=va("react.block"),va("react.scope"),yx=va("react.opaque.id"),H4=va("react.debug_trace_mode"),bx=va("react.offscreen"),xx=va("react.legacy_hidden")}var q4=typeof Symbol=="function"&&Symbol.iterator;function $p(e){return e===null||typeof e!="object"?null:(e=q4&&e[q4]||e["@@iterator"],typeof e=="function"?e:null)}var Sx;function Jp(e){if(Sx===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Sx=t&&t[1]||""}return`
`+Sx+e}var Cx=!1;function W0(e,t){if(!e||Cx)return"";Cx=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s])return`
`+a[o].replace(" at new "," at ");while(1<=o&&0<=s);break}}}finally{Cx=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Jp(e):""}function cG(e){switch(e.tag){case 5:return Jp(e.type);case 16:return Jp("Lazy");case 13:return Jp("Suspense");case 19:return Jp("SuspenseList");case 0:case 2:case 15:return e=W0(e.type,!1),e;case 11:return e=W0(e.type.render,!1),e;case 22:return e=W0(e.type._render,!1),e;case 1:return e=W0(e.type,!0),e;default:return""}}function Kd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Fc:return"Fragment";case cf:return"Portal";case Qp:return"Profiler";case mx:return"StrictMode";case Zp:return"Suspense";case q0:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case vx:return(e.displayName||"Context")+".Consumer";case px:return(e._context.displayName||"Context")+".Provider";case H0:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case j0:return Kd(e.type);case gx:return Kd(e._render);case hx:t=e._payload,e=e._init;try{return Kd(e(t))}catch{}}return null}function Oc(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function j4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function lG(e){var t=j4(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r!="undefined"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function X0(e){e._valueTracker||(e._valueTracker=lG(e))}function W4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=j4(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Y0(e){if(e=e||(typeof document!="undefined"?document:void 0),typeof e=="undefined")return null;try{return e.activeElement||e.body}catch{return e.body}}function _x(e,t){var r=t.checked;return vn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function X4(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Oc(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Y4(e,t){t=t.checked,t!=null&&dx(e,"checked",t,!1)}function wx(e,t){Y4(e,t);var r=Oc(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Ax(e,t.type,r):t.hasOwnProperty("defaultValue")&&Ax(e,t.type,Oc(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function K4(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Ax(e,t,r){(t!=="number"||Y0(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function fG(e){var t="";return G0.Children.forEach(e,function(r){r!=null&&(t+=r)}),t}function Tx(e,t){return e=vn({children:void 0},t),(t=fG(t.children))&&(e.children=t),e}function Qd(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Oc(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Px(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(gt(91));return vn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Q4(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(gt(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(gt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Oc(r)}}function Z4(e,t){var r=Oc(t.value),n=Oc(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function $4(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}var Ex={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function J4(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ix(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?J4(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var K0,eE=function(e){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!==Ex.svg||"innerHTML"in e)e.innerHTML=t;else{for(K0=K0||document.createElement("div"),K0.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=K0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ev(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var tv={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dG=["Webkit","ms","Moz","O"];Object.keys(tv).forEach(function(e){dG.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),tv[t]=tv[e]})});function tE(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||tv.hasOwnProperty(e)&&tv[e]?(""+t).trim():t+"px"}function rE(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=tE(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var mG=vn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Dx(e,t){if(t){if(mG[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(gt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(gt(60));if(!(typeof t.dangerouslySetInnerHTML=="object"&&"__html"in t.dangerouslySetInnerHTML))throw Error(gt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(gt(62))}}function Mx(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Rx(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Bx=null,Zd=null,$d=null;function nE(e){if(e=xv(e)){if(typeof Bx!="function")throw Error(gt(280));var t=e.stateNode;t&&(t=mg(t),Bx(e.stateNode,e.type,t))}}function aE(e){Zd?$d?$d.push(e):$d=[e]:Zd=e}function iE(){if(Zd){var e=Zd,t=$d;if($d=Zd=null,nE(e),t)for(e=0;e<t.length;e++)nE(t[e])}}function Fx(e,t){return e(t)}function oE(e,t,r,n,a){return e(t,r,n,a)}function Ox(){}var sE=Fx,lf=!1,kx=!1;function Lx(){(Zd!==null||$d!==null)&&(Ox(),iE())}function pG(e,t,r){if(kx)return e(t,r);kx=!0;try{return sE(e,t,r)}finally{kx=!1,Lx()}}function rv(e,t){var r=e.stateNode;if(r===null)return null;var n=mg(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(gt(231,t,typeof r));return r}var Nx=!1;if(Su)try{var nv={};Object.defineProperty(nv,"passive",{get:function(){Nx=!0}}),window.addEventListener("test",nv,nv),window.removeEventListener("test",nv,nv)}catch{Nx=!1}function vG(e,t,r,n,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(l){this.onError(l)}}var av=!1,Q0=null,Z0=!1,Ux=null,hG={onError:function(e){av=!0,Q0=e}};function gG(e,t,r,n,a,i,o,s,u){av=!1,Q0=null,vG.apply(hG,arguments)}function yG(e,t,r,n,a,i,o,s,u){if(gG.apply(this,arguments),av){if(av){var c=Q0;av=!1,Q0=null}else throw Error(gt(198));Z0||(Z0=!0,Ux=c)}}function ff(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&1026)!=0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function uE(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function cE(e){if(ff(e)!==e)throw Error(gt(188))}function bG(e){var t=e.alternate;if(!t){if(t=ff(e),t===null)throw Error(gt(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return cE(a),e;if(i===n)return cE(a),t;i=i.sibling}throw Error(gt(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(gt(189))}}if(r.alternate!==n)throw Error(gt(190))}if(r.tag!==3)throw Error(gt(188));return r.stateNode.current===r?e:t}function lE(e){if(e=bG(e),!e)return null;for(var t=e;;){if(t.tag===5||t.tag===6)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function fE(e,t){for(var r=e.alternate;t!==null;){if(t===e||t===r)return!0;t=t.return}return!1}var dE,zx,mE,pE,Vx=!1,ks=[],kc=null,Lc=null,Nc=null,iv=new Map,ov=new Map,sv=[],vE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gx(e,t,r,n,a){return{blockedOn:e,domEventName:t,eventSystemFlags:r|16,nativeEvent:a,targetContainers:[n]}}function hE(e,t){switch(e){case"focusin":case"focusout":kc=null;break;case"dragenter":case"dragleave":Lc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":iv.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ov.delete(t.pointerId)}}function uv(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e=Gx(t,r,n,a,i),t!==null&&(t=xv(t),t!==null&&zx(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function xG(e,t,r,n,a){switch(t){case"focusin":return kc=uv(kc,e,t,r,n,a),!0;case"dragenter":return Lc=uv(Lc,e,t,r,n,a),!0;case"mouseover":return Nc=uv(Nc,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return iv.set(i,uv(iv.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,ov.set(i,uv(ov.get(i)||null,e,t,r,n,a)),!0}return!1}function SG(e){var t=df(e.target);if(t!==null){var r=ff(t);if(r!==null){if(t=r.tag,t===13){if(t=uE(r),t!==null){e.blockedOn=t,pE(e.lanePriority,function(){pa.unstable_runWithPriority(e.priority,function(){mE(r)})});return}}else if(t===3&&r.stateNode.hydrate){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function $0(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Yx(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r!==null)return t=xv(r),t!==null&&zx(t),e.blockedOn=r,!1;t.shift()}return!0}function gE(e,t,r){$0(e)&&r.delete(t)}function CG(){for(Vx=!1;0<ks.length;){var e=ks[0];if(e.blockedOn!==null){e=xv(e.blockedOn),e!==null&&dE(e);break}for(var t=e.targetContainers;0<t.length;){var r=Yx(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r!==null){e.blockedOn=r;break}t.shift()}e.blockedOn===null&&ks.shift()}kc!==null&&$0(kc)&&(kc=null),Lc!==null&&$0(Lc)&&(Lc=null),Nc!==null&&$0(Nc)&&(Nc=null),iv.forEach(gE),ov.forEach(gE)}function cv(e,t){e.blockedOn===t&&(e.blockedOn=null,Vx||(Vx=!0,pa.unstable_scheduleCallback(pa.unstable_NormalPriority,CG)))}function yE(e){function t(a){return cv(a,e)}if(0<ks.length){cv(ks[0],e);for(var r=1;r<ks.length;r++){var n=ks[r];n.blockedOn===e&&(n.blockedOn=null)}}for(kc!==null&&cv(kc,e),Lc!==null&&cv(Lc,e),Nc!==null&&cv(Nc,e),iv.forEach(t),ov.forEach(t),r=0;r<sv.length;r++)n=sv[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<sv.length&&(r=sv[0],r.blockedOn===null);)SG(r),r.blockedOn===null&&sv.shift()}function J0(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Jd={animationend:J0("Animation","AnimationEnd"),animationiteration:J0("Animation","AnimationIteration"),animationstart:J0("Animation","AnimationStart"),transitionend:J0("Transition","TransitionEnd")},Hx={},bE={};Su&&(bE=document.createElement("div").style,"AnimationEvent"in window||(delete Jd.animationend.animation,delete Jd.animationiteration.animation,delete Jd.animationstart.animation),"TransitionEvent"in window||delete Jd.transitionend.transition);function eg(e){if(Hx[e])return Hx[e];if(!Jd[e])return e;var t=Jd[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in bE)return Hx[e]=t[r];return e}var xE=eg("animationend"),SE=eg("animationiteration"),CE=eg("animationstart"),_E=eg("transitionend"),wE=new Map,qx=new Map,_G=["abort","abort",xE,"animationEnd",SE,"animationIteration",CE,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",_E,"transitionEnd","waiting","waiting"];function jx(e,t){for(var r=0;r<e.length;r+=2){var n=e[r],a=e[r+1];a="on"+(a[0].toUpperCase()+a.slice(1)),qx.set(n,t),wE.set(n,a),sf(a,[n])}}var wG=pa.unstable_now;wG();var tn=8;function em(e){if((1&e)!=0)return tn=15,1;if((2&e)!=0)return tn=14,2;if((4&e)!=0)return tn=13,4;var t=24&e;return t!==0?(tn=12,t):(e&32)!=0?(tn=11,32):(t=192&e,t!==0?(tn=10,t):(e&256)!=0?(tn=9,256):(t=3584&e,t!==0?(tn=8,t):(e&4096)!=0?(tn=7,4096):(t=4186112&e,t!==0?(tn=6,t):(t=62914560&e,t!==0?(tn=5,t):e&67108864?(tn=4,67108864):(e&134217728)!=0?(tn=3,134217728):(t=805306368&e,t!==0?(tn=2,t):(1073741824&e)!=0?(tn=1,1073741824):(tn=8,e))))))}function AG(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function TG(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(gt(358,e))}}function lv(e,t){var r=e.pendingLanes;if(r===0)return tn=0;var n=0,a=0,i=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(i!==0)n=i,a=tn=15;else if(i=r&134217727,i!==0){var u=i&~o;u!==0?(n=em(u),a=tn):(s&=i,s!==0&&(n=em(s),a=tn))}else i=r&~o,i!==0?(n=em(i),a=tn):s!==0&&(n=em(s),a=tn);if(n===0)return 0;if(n=31-Uc(n),n=r&((0>n?0:1<<n)<<1)-1,t!==0&&t!==n&&(t&o)==0){if(em(t),a<=tn)return t;tn=a}if(t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Uc(t),a=1<<r,n|=e[r],t&=~a;return n}function AE(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tg(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return e=tm(24&~t),e===0?tg(10,t):e;case 10:return e=tm(192&~t),e===0?tg(8,t):e;case 8:return e=tm(3584&~t),e===0&&(e=tm(4186112&~t),e===0&&(e=512)),e;case 2:return t=tm(805306368&~t),t===0&&(t=268435456),t}throw Error(gt(358,e))}function tm(e){return e&-e}function Wx(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function rg(e,t,r){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,e=e.eventTimes,t=31-Uc(t),e[t]=r}var Uc=Math.clz32?Math.clz32:IG,PG=Math.log,EG=Math.LN2;function IG(e){return e===0?32:31-(PG(e)/EG|0)|0}var DG=pa.unstable_UserBlockingPriority,MG=pa.unstable_runWithPriority,ng=!0;function RG(e,t,r,n){lf||Ox();var a=Xx,i=lf;lf=!0;try{oE(a,e,t,r,n)}finally{(lf=i)||Lx()}}function BG(e,t,r,n){MG(DG,Xx.bind(null,e,t,r,n))}function Xx(e,t,r,n){if(ng){var a;if((a=(t&4)==0)&&0<ks.length&&-1<vE.indexOf(e))e=Gx(null,e,t,r,n),ks.push(e);else{var i=Yx(e,t,r,n);if(i===null)a&&hE(e,n);else{if(a){if(-1<vE.indexOf(e)){e=Gx(i,e,t,r,n),ks.push(e);return}if(xG(i,e,t,r,n))return;hE(e,n)}tI(e,t,n,null,r)}}}}function Yx(e,t,r,n){var a=Rx(n);if(a=df(a),a!==null){var i=ff(a);if(i===null)a=null;else{var o=i.tag;if(o===13){if(a=uE(i),a!==null)return a;a=null}else if(o===3){if(i.stateNode.hydrate)return i.tag===3?i.stateNode.containerInfo:null;a=null}else i!==a&&(a=null)}}return tI(e,t,n,a,r),null}var zc=null,Kx=null,ag=null;function TE(){if(ag)return ag;var e,t=Kx,r=t.length,n,a="value"in zc?zc.value:zc.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return ag=a.slice(e,1<n?1-n:void 0)}function ig(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function og(){return!0}function PE(){return!1}function qi(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?og:PE,this.isPropagationStopped=PE,this}return vn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=og)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=og)},persist:function(){},isPersistent:og}),t}var rm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qx=qi(rm),fv=vn({},rm,{view:0,detail:0}),FG=qi(fv),Zx,$x,dv,sg=vn({},fv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eS,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dv&&(dv&&e.type==="mousemove"?(Zx=e.screenX-dv.screenX,$x=e.screenY-dv.screenY):$x=Zx=0,dv=e),Zx)},movementY:function(e){return"movementY"in e?e.movementY:$x}}),EE=qi(sg),OG=vn({},sg,{dataTransfer:0}),kG=qi(OG),LG=vn({},fv,{relatedTarget:0}),Jx=qi(LG),NG=vn({},rm,{animationName:0,elapsedTime:0,pseudoElement:0}),UG=qi(NG),zG=vn({},rm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),VG=qi(zG),GG=vn({},rm,{data:0}),IE=qi(GG),HG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WG(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=jG[e])?!!t[e]:!1}function eS(){return WG}var XG=vn({},fv,{key:function(e){if(e.key){var t=HG[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ig(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?qG[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eS,charCode:function(e){return e.type==="keypress"?ig(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ig(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),YG=qi(XG),KG=vn({},sg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),DE=qi(KG),QG=vn({},fv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eS}),ZG=qi(QG),$G=vn({},rm,{propertyName:0,elapsedTime:0,pseudoElement:0}),JG=qi($G),eH=vn({},sg,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),tH=qi(eH),rH=[9,13,27,32],tS=Su&&"CompositionEvent"in window,mv=null;Su&&"documentMode"in document&&(mv=document.documentMode);var nH=Su&&"TextEvent"in window&&!mv,ME=Su&&(!tS||mv&&8<mv&&11>=mv),RE=String.fromCharCode(32),BE=!1;function FE(e,t){switch(e){case"keyup":return rH.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OE(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var nm=!1;function aH(e,t){switch(e){case"compositionend":return OE(t);case"keypress":return t.which!==32?null:(BE=!0,RE);case"textInput":return e=t.data,e===RE&&BE?null:e;default:return null}}function iH(e,t){if(nm)return e==="compositionend"||!tS&&FE(e,t)?(e=TE(),ag=Kx=zc=null,nm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ME&&t.locale!=="ko"?null:t.data;default:return null}}var oH={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kE(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!oH[e.type]:t==="textarea"}function LE(e,t,r,n){aE(n),t=cg(t,"onChange"),0<t.length&&(r=new Qx("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var pv=null,vv=null;function sH(e){QE(e,0)}function ug(e){var t=um(e);if(W4(t))return e}function uH(e,t){if(e==="change")return t}var NE=!1;if(Su){var rS;if(Su){var nS="oninput"in document;if(!nS){var UE=document.createElement("div");UE.setAttribute("oninput","return;"),nS=typeof UE.oninput=="function"}rS=nS}else rS=!1;NE=rS&&(!document.documentMode||9<document.documentMode)}function zE(){pv&&(pv.detachEvent("onpropertychange",VE),vv=pv=null)}function VE(e){if(e.propertyName==="value"&&ug(vv)){var t=[];if(LE(t,vv,e,Rx(e)),e=sH,lf)e(t);else{lf=!0;try{Fx(e,t)}finally{lf=!1,Lx()}}}}function cH(e,t,r){e==="focusin"?(zE(),pv=t,vv=r,pv.attachEvent("onpropertychange",VE)):e==="focusout"&&zE()}function lH(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ug(vv)}function fH(e,t){if(e==="click")return ug(t)}function dH(e,t){if(e==="input"||e==="change")return ug(t)}function mH(e,t){return e===t&&(e!==0||1/e==1/t)||e!==e&&t!==t}var vo=typeof Object.is=="function"?Object.is:mH,pH=Object.prototype.hasOwnProperty;function hv(e,t){if(vo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!pH.call(t,r[n])||!vo(e[r[n]],t[r[n]]))return!1;return!0}function GE(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function HE(e,t){var r=GE(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=GE(r)}}function qE(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qE(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function jE(){for(var e=window,t=Y0();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Y0(e.document)}return t}function aS(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var vH=Su&&"documentMode"in document&&11>=document.documentMode,am=null,iS=null,gv=null,oS=!1;function WE(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;oS||am==null||am!==Y0(n)||(n=am,"selectionStart"in n&&aS(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),gv&&hv(gv,n)||(gv=n,n=cg(iS,"onSelect"),0<n.length&&(t=new Qx("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=am)))}jx("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);jx("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);jx(_G,2);for(var XE="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),sS=0;sS<XE.length;sS++)qx.set(XE[sS],0);Yd("onMouseEnter",["mouseout","mouseover"]);Yd("onMouseLeave",["mouseout","mouseover"]);Yd("onPointerEnter",["pointerout","pointerover"]);Yd("onPointerLeave",["pointerout","pointerover"]);sf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sf("onBeforeInput",["compositionend","keypress","textInput","paste"]);sf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YE=new Set("cancel close invalid load scroll toggle".split(" ").concat(yv));function KE(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,yG(n,t,void 0,e),e.currentTarget=null}function QE(e,t){t=(t&4)!=0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;KE(a,s,c),i=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;KE(a,s,c),i=u}}}if(Z0)throw e=Ux,Z0=!1,Ux=null,e}function un(e,t){var r=sI(t),n=e+"__bubble";r.has(n)||(eI(t,e,2,!1),r.add(n))}var ZE="_reactListening"+Math.random().toString(36).slice(2);function $E(e){e[ZE]||(e[ZE]=!0,U4.forEach(function(t){YE.has(t)||JE(t,!1,e,null),JE(t,!0,e,null)}))}function JE(e,t,r,n){var a=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,i=r;if(e==="selectionchange"&&r.nodeType!==9&&(i=r.ownerDocument),n!==null&&!t&&YE.has(e)){if(e!=="scroll")return;a|=2,i=n}var o=sI(i),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(a|=4),eI(i,e,a,t),o.add(s))}function eI(e,t,r,n){var a=qx.get(t);switch(a===void 0?2:a){case 0:a=RG;break;case 1:a=BG;break;default:a=Xx}r=a.bind(null,t,r,e),a=void 0,!Nx||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function tI(e,t,r,n,a){var i=n;if((t&1)==0&&(t&2)==0&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===a||u.nodeType===8&&u.parentNode===a))return;o=o.return}for(;s!==null;){if(o=df(s),o===null)return;if(u=o.tag,u===5||u===6){n=i=o;continue e}s=s.parentNode}}n=n.return}pG(function(){var c=i,l=Rx(r),f=[];e:{var d=wE.get(e);if(d!==void 0){var m=Qx,p=e;switch(e){case"keypress":if(ig(r)===0)break e;case"keydown":case"keyup":m=YG;break;case"focusin":p="focus",m=Jx;break;case"focusout":p="blur",m=Jx;break;case"beforeblur":case"afterblur":m=Jx;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=EE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=kG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=ZG;break;case xE:case SE:case CE:m=UG;break;case _E:m=JG;break;case"scroll":m=FG;break;case"wheel":m=tH;break;case"copy":case"cut":case"paste":m=VG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=DE}var v=(t&4)!=0,h=!v&&e==="scroll",g=v?d!==null?d+"Capture":null:d;v=[];for(var y=c,b;y!==null;){b=y;var x=b.stateNode;if(b.tag===5&&x!==null&&(b=x,g!==null&&(x=rv(y,g),x!=null&&v.push(bv(y,x,b)))),h)break;y=y.return}0<v.length&&(d=new m(d,p,null,r,l),f.push({event:d,listeners:v}))}}if((t&7)==0){e:{if(d=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",d&&(t&16)==0&&(p=r.relatedTarget||r.fromElement)&&(df(p)||p[sm]))break e;if((m||d)&&(d=l.window===l?l:(d=l.ownerDocument)?d.defaultView||d.parentWindow:window,m?(p=r.relatedTarget||r.toElement,m=c,p=p?df(p):null,p!==null&&(h=ff(p),p!==h||p.tag!==5&&p.tag!==6)&&(p=null)):(m=null,p=c),m!==p)){if(v=EE,x="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(v=DE,x="onPointerLeave",g="onPointerEnter",y="pointer"),h=m==null?d:um(m),b=p==null?d:um(p),d=new v(x,y+"leave",m,r,l),d.target=h,d.relatedTarget=b,x=null,df(l)===c&&(v=new v(g,y+"enter",p,r,l),v.target=b,v.relatedTarget=h,x=v),h=x,m&&p)t:{for(v=m,g=p,y=0,b=v;b;b=im(b))y++;for(b=0,x=g;x;x=im(x))b++;for(;0<y-b;)v=im(v),y--;for(;0<b-y;)g=im(g),b--;for(;y--;){if(v===g||g!==null&&v===g.alternate)break t;v=im(v),g=im(g)}v=null}else v=null;m!==null&&rI(f,d,m,v,!1),p!==null&&h!==null&&rI(f,h,p,v,!0)}}e:{if(d=c?um(c):window,m=d.nodeName&&d.nodeName.toLowerCase(),m==="select"||m==="input"&&d.type==="file")var C=uH;else if(kE(d))if(NE)C=dH;else{C=lH;var _=cH}else(m=d.nodeName)&&m.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(C=fH);if(C&&(C=C(e,c))){LE(f,C,r,l);break e}_&&_(e,d,c),e==="focusout"&&(_=d._wrapperState)&&_.controlled&&d.type==="number"&&Ax(d,"number",d.value)}switch(_=c?um(c):window,e){case"focusin":(kE(_)||_.contentEditable==="true")&&(am=_,iS=c,gv=null);break;case"focusout":gv=iS=am=null;break;case"mousedown":oS=!0;break;case"contextmenu":case"mouseup":case"dragend":oS=!1,WE(f,r,l);break;case"selectionchange":if(vH)break;case"keydown":case"keyup":WE(f,r,l)}var w;if(tS)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else nm?FE(e,r)&&(T="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(T="onCompositionStart");T&&(ME&&r.locale!=="ko"&&(nm||T!=="onCompositionStart"?T==="onCompositionEnd"&&nm&&(w=TE()):(zc=l,Kx="value"in zc?zc.value:zc.textContent,nm=!0)),_=cg(c,T),0<_.length&&(T=new IE(T,e,null,r,l),f.push({event:T,listeners:_}),w?T.data=w:(w=OE(r),w!==null&&(T.data=w)))),(w=nH?aH(e,r):iH(e,r))&&(c=cg(c,"onBeforeInput"),0<c.length&&(l=new IE("onBeforeInput","beforeinput",null,r,l),f.push({event:l,listeners:c}),l.data=w))}QE(f,t)})}function bv(e,t,r){return{instance:e,listener:t,currentTarget:r}}function cg(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=rv(e,r),i!=null&&n.unshift(bv(e,i,a)),i=rv(e,t),i!=null&&n.push(bv(e,i,a))),e=e.return}return n}function im(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function rI(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,c=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&c!==null&&(s=c,a?(u=rv(r,i),u!=null&&o.unshift(bv(r,u,s))):a||(u=rv(r,i),u!=null&&o.push(bv(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}function lg(){}var uS=null,cS=null;function nI(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function lS(e,t){return e==="textarea"||e==="option"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var aI=typeof setTimeout=="function"?setTimeout:void 0,hH=typeof clearTimeout=="function"?clearTimeout:void 0;function fS(e){e.nodeType===1?e.textContent="":e.nodeType===9&&(e=e.body,e!=null&&(e.textContent=""))}function om(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break}return e}function iI(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var dS=0;function gH(e){return{$$typeof:yx,toString:e,valueOf:e}}var fg=Math.random().toString(36).slice(2),Vc="__reactFiber$"+fg,dg="__reactProps$"+fg,sm="__reactContainer$"+fg,oI="__reactEvents$"+fg;function df(e){var t=e[Vc];if(t)return t;for(var r=e.parentNode;r;){if(t=r[sm]||r[Vc]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=iI(e);e!==null;){if(r=e[Vc])return r;e=iI(e)}return t}e=r,r=e.parentNode}return null}function xv(e){return e=e[Vc]||e[sm],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function um(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(gt(33))}function mg(e){return e[dg]||null}function sI(e){var t=e[oI];return t===void 0&&(t=e[oI]=new Set),t}var mS=[],cm=-1;function Gc(e){return{current:e}}function cn(e){0>cm||(e.current=mS[cm],mS[cm]=null,cm--)}function Mn(e,t){cm++,mS[cm]=e.current,e.current=t}var Hc={},Va=Gc(Hc),Ci=Gc(!1),mf=Hc;function lm(e,t){var r=e.type.contextTypes;if(!r)return Hc;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function _i(e){return e=e.childContextTypes,e!=null}function pg(){cn(Ci),cn(Va)}function uI(e,t,r){if(Va.current!==Hc)throw Error(gt(168));Mn(Va,t),Mn(Ci,r)}function cI(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in e))throw Error(gt(108,Kd(t)||"Unknown",a));return vn({},r,n)}function vg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Hc,mf=Va.current,Mn(Va,e),Mn(Ci,Ci.current),!0}function lI(e,t,r){var n=e.stateNode;if(!n)throw Error(gt(169));r?(e=cI(e,t,mf),n.__reactInternalMemoizedMergedChildContext=e,cn(Ci),cn(Va),Mn(Va,e)):cn(Ci),Mn(Ci,r)}var pS=null,pf=null,yH=pa.unstable_runWithPriority,vS=pa.unstable_scheduleCallback,hS=pa.unstable_cancelCallback,bH=pa.unstable_shouldYield,fI=pa.unstable_requestPaint,gS=pa.unstable_now,xH=pa.unstable_getCurrentPriorityLevel,hg=pa.unstable_ImmediatePriority,dI=pa.unstable_UserBlockingPriority,mI=pa.unstable_NormalPriority,pI=pa.unstable_LowPriority,vI=pa.unstable_IdlePriority,yS={},SH=fI!==void 0?fI:function(){},Cu=null,gg=null,bS=!1,hI=gS(),Ga=1e4>hI?gS:function(){return gS()-hI};function fm(){switch(xH()){case hg:return 99;case dI:return 98;case mI:return 97;case pI:return 96;case vI:return 95;default:throw Error(gt(332))}}function gI(e){switch(e){case 99:return hg;case 98:return dI;case 97:return mI;case 96:return pI;case 95:return vI;default:throw Error(gt(332))}}function vf(e,t){return e=gI(e),yH(e,t)}function Sv(e,t,r){return e=gI(e),vS(e,t,r)}function Ls(){if(gg!==null){var e=gg;gg=null,hS(e)}yI()}function yI(){if(!bS&&Cu!==null){bS=!0;var e=0;try{var t=Cu;vf(99,function(){for(;e<t.length;e++){var r=t[e];do r=r(!0);while(r!==null)}}),Cu=null}catch(r){throw Cu!==null&&(Cu=Cu.slice(e+1)),vS(hg,Ls),r}finally{bS=!1}}}var CH=uf.ReactCurrentBatchConfig;function as(e,t){if(e&&e.defaultProps){t=vn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var yg=Gc(null),bg=null,dm=null,xg=null;function xS(){xg=dm=bg=null}function SS(e){var t=yg.current;cn(yg),e.type._context._currentValue=t}function bI(e,t){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)===t){if(r===null||(r.childLanes&t)===t)break;r.childLanes|=t}else e.childLanes|=t,r!==null&&(r.childLanes|=t);e=e.return}}function mm(e,t){bg=e,xg=dm=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!=0&&(is=!0),e.firstContext=null)}function ho(e,t){if(xg!==e&&t!==!1&&t!==0)if((typeof t!="number"||t===1073741823)&&(xg=e,t=1073741823),t={context:e,observedBits:t,next:null},dm===null){if(bg===null)throw Error(gt(308));dm=t,bg.dependencies={lanes:0,firstContext:t,responders:null}}else dm=dm.next=t;return e._currentValue}var qc=!1;function CS(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function xI(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Wc(e,t){if(e=e.updateQueue,e!==null){e=e.shared;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function SI(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Cv(e,t,r,n){var a=e.updateQueue;qc=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var u=s,c=u.next;u.next=null,o===null?i=c:o.next=c,o=u;var l=e.alternate;if(l!==null){l=l.updateQueue;var f=l.lastBaseUpdate;f!==o&&(f===null?l.firstBaseUpdate=c:f.next=c,l.lastBaseUpdate=u)}}if(i!==null){f=a.baseState,o=0,l=c=u=null;do{s=i.lane;var d=i.eventTime;if((n&s)===s){l!==null&&(l=l.next={eventTime:d,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var m=e,p=i;switch(s=t,d=r,p.tag){case 1:if(m=p.payload,typeof m=="function"){f=m.call(d,f,s);break e}f=m;break e;case 3:m.flags=m.flags&-4097|64;case 0:if(m=p.payload,s=typeof m=="function"?m.call(d,f,s):m,s==null)break e;f=vn({},f,s);break e;case 2:qc=!0}}i.callback!==null&&(e.flags|=32,s=a.effects,s===null?a.effects=[i]:s.push(i))}else d={eventTime:d,lane:s,tag:i.tag,payload:i.payload,callback:i.callback,next:null},l===null?(c=l=d,u=f):l=l.next=d,o|=s;if(i=i.next,i===null){if(s=a.shared.pending,s===null)break;i=s.next,s.next=null,a.lastBaseUpdate=s,a.shared.pending=null}}while(1);l===null&&(u=f),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,Fv|=o,e.lanes=o,e.memoizedState=f}}function CI(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(gt(191,a));a.call(n)}}}var _I=new G0.Component().refs;function Sg(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:vn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Cg={isMounted:function(e){return(e=e._reactInternals)?ff(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=ji(),a=Kc(e),i=jc(n,a);i.payload=t,r!=null&&(i.callback=r),Wc(e,i),Qc(e,a,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=ji(),a=Kc(e),i=jc(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),Wc(e,i),Qc(e,a,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ji(),n=Kc(e),a=jc(r,n);a.tag=2,t!=null&&(a.callback=t),Wc(e,a),Qc(e,n,r)}};function wI(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!hv(r,n)||!hv(a,i):!0}function AI(e,t,r){var n=!1,a=Hc,i=t.contextType;return typeof i=="object"&&i!==null?i=ho(i):(a=_i(t)?mf:Va.current,n=t.contextTypes,i=(n=n!=null)?lm(e,a):Hc),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Cg,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function TI(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Cg.enqueueReplaceState(t,t.state,null)}function _S(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs=_I,CS(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=ho(i):(i=_i(t)?mf:Va.current,a.context=lm(e,i)),Cv(e,r,a,n),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Sg(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Cg.enqueueReplaceState(a,a.state,null),Cv(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4)}var _g=Array.isArray;function _v(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(gt(309));var n=r.stateNode}if(!n)throw Error(gt(147,e));var a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var o=n.refs;o===_I&&(o=n.refs={}),i===null?delete o[a]:o[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(gt(284));if(!r._owner)throw Error(gt(290,e))}return e}function wg(e,t){if(e.type!=="textarea")throw Error(gt(31,Object.prototype.toString.call(t)==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function PI(e){function t(h,g){if(e){var y=h.lastEffect;y!==null?(y.nextEffect=g,h.lastEffect=g):h.firstEffect=h.lastEffect=g,g.nextEffect=null,g.flags=8}}function r(h,g){if(!e)return null;for(;g!==null;)t(h,g),g=g.sibling;return null}function n(h,g){for(h=new Map;g!==null;)g.key!==null?h.set(g.key,g):h.set(g.index,g),g=g.sibling;return h}function a(h,g){return h=Jc(h,g),h.index=0,h.sibling=null,h}function i(h,g,y){return h.index=y,e?(y=h.alternate,y!==null?(y=y.index,y<g?(h.flags=2,g):y):(h.flags=2,g)):g}function o(h){return e&&h.alternate===null&&(h.flags=2),h}function s(h,g,y,b){return g===null||g.tag!==6?(g=iC(y,h.mode,b),g.return=h,g):(g=a(g,y),g.return=h,g)}function u(h,g,y,b){return g!==null&&g.elementType===y.type?(b=a(g,y.props),b.ref=_v(h,g,y),b.return=h,b):(b=Gg(y.type,y.key,y.props,null,h.mode,b),b.ref=_v(h,g,y),b.return=h,b)}function c(h,g,y,b){return g===null||g.tag!==4||g.stateNode.containerInfo!==y.containerInfo||g.stateNode.implementation!==y.implementation?(g=oC(y,h.mode,b),g.return=h,g):(g=a(g,y.children||[]),g.return=h,g)}function l(h,g,y,b,x){return g===null||g.tag!==7?(g=Sm(y,h.mode,b,x),g.return=h,g):(g=a(g,y),g.return=h,g)}function f(h,g,y){if(typeof g=="string"||typeof g=="number")return g=iC(""+g,h.mode,y),g.return=h,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Kp:return y=Gg(g.type,g.key,g.props,null,h.mode,y),y.ref=_v(h,null,g),y.return=h,y;case cf:return g=oC(g,h.mode,y),g.return=h,g}if(_g(g)||$p(g))return g=Sm(g,h.mode,y,null),g.return=h,g;wg(h,g)}return null}function d(h,g,y,b){var x=g!==null?g.key:null;if(typeof y=="string"||typeof y=="number")return x!==null?null:s(h,g,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Kp:return y.key===x?y.type===Fc?l(h,g,y.props.children,b,x):u(h,g,y,b):null;case cf:return y.key===x?c(h,g,y,b):null}if(_g(y)||$p(y))return x!==null?null:l(h,g,y,b,null);wg(h,y)}return null}function m(h,g,y,b,x){if(typeof b=="string"||typeof b=="number")return h=h.get(y)||null,s(g,h,""+b,x);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Kp:return h=h.get(b.key===null?y:b.key)||null,b.type===Fc?l(g,h,b.props.children,x,b.key):u(g,h,b,x);case cf:return h=h.get(b.key===null?y:b.key)||null,c(g,h,b,x)}if(_g(b)||$p(b))return h=h.get(y)||null,l(g,h,b,x,null);wg(g,b)}return null}function p(h,g,y,b){for(var x=null,C=null,_=g,w=g=0,T=null;_!==null&&w<y.length;w++){_.index>w?(T=_,_=null):T=_.sibling;var A=d(h,_,y[w],b);if(A===null){_===null&&(_=T);break}e&&_&&A.alternate===null&&t(h,_),g=i(A,g,w),C===null?x=A:C.sibling=A,C=A,_=T}if(w===y.length)return r(h,_),x;if(_===null){for(;w<y.length;w++)_=f(h,y[w],b),_!==null&&(g=i(_,g,w),C===null?x=_:C.sibling=_,C=_);return x}for(_=n(h,_);w<y.length;w++)T=m(_,h,w,y[w],b),T!==null&&(e&&T.alternate!==null&&_.delete(T.key===null?w:T.key),g=i(T,g,w),C===null?x=T:C.sibling=T,C=T);return e&&_.forEach(function(D){return t(h,D)}),x}function v(h,g,y,b){var x=$p(y);if(typeof x!="function")throw Error(gt(150));if(y=x.call(y),y==null)throw Error(gt(151));for(var C=x=null,_=g,w=g=0,T=null,A=y.next();_!==null&&!A.done;w++,A=y.next()){_.index>w?(T=_,_=null):T=_.sibling;var D=d(h,_,A.value,b);if(D===null){_===null&&(_=T);break}e&&_&&D.alternate===null&&t(h,_),g=i(D,g,w),C===null?x=D:C.sibling=D,C=D,_=T}if(A.done)return r(h,_),x;if(_===null){for(;!A.done;w++,A=y.next())A=f(h,A.value,b),A!==null&&(g=i(A,g,w),C===null?x=A:C.sibling=A,C=A);return x}for(_=n(h,_);!A.done;w++,A=y.next())A=m(_,h,w,A.value,b),A!==null&&(e&&A.alternate!==null&&_.delete(A.key===null?w:A.key),g=i(A,g,w),C===null?x=A:C.sibling=A,C=A);return e&&_.forEach(function(E){return t(h,E)}),x}return function(h,g,y,b){var x=typeof y=="object"&&y!==null&&y.type===Fc&&y.key===null;x&&(y=y.props.children);var C=typeof y=="object"&&y!==null;if(C)switch(y.$$typeof){case Kp:e:{for(C=y.key,x=g;x!==null;){if(x.key===C){switch(x.tag){case 7:if(y.type===Fc){r(h,x.sibling),g=a(x,y.props.children),g.return=h,h=g;break e}break;default:if(x.elementType===y.type){r(h,x.sibling),g=a(x,y.props),g.ref=_v(h,x,y),g.return=h,h=g;break e}}r(h,x);break}else t(h,x);x=x.sibling}y.type===Fc?(g=Sm(y.props.children,h.mode,b,y.key),g.return=h,h=g):(b=Gg(y.type,y.key,y.props,null,h.mode,b),b.ref=_v(h,g,y),b.return=h,h=b)}return o(h);case cf:e:{for(x=y.key;g!==null;){if(g.key===x)if(g.tag===4&&g.stateNode.containerInfo===y.containerInfo&&g.stateNode.implementation===y.implementation){r(h,g.sibling),g=a(g,y.children||[]),g.return=h,h=g;break e}else{r(h,g);break}else t(h,g);g=g.sibling}g=oC(y,h.mode,b),g.return=h,h=g}return o(h)}if(typeof y=="string"||typeof y=="number")return y=""+y,g!==null&&g.tag===6?(r(h,g.sibling),g=a(g,y),g.return=h,h=g):(r(h,g),g=iC(y,h.mode,b),g.return=h,h=g),o(h);if(_g(y))return p(h,g,y,b);if($p(y))return v(h,g,y,b);if(C&&wg(h,y),typeof y=="undefined"&&!x)switch(h.tag){case 1:case 22:case 0:case 11:case 15:throw Error(gt(152,Kd(h.type)||"Component"))}return r(h,g)}}var Ag=PI(!0),EI=PI(!1),wv={},Ns=Gc(wv),Av=Gc(wv),Tv=Gc(wv);function hf(e){if(e===wv)throw Error(gt(174));return e}function wS(e,t){switch(Mn(Tv,t),Mn(Av,e),Mn(Ns,wv),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ix(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ix(t,e)}cn(Ns),Mn(Ns,t)}function pm(){cn(Ns),cn(Av),cn(Tv)}function II(e){hf(Tv.current);var t=hf(Ns.current),r=Ix(t,e.type);t!==r&&(Mn(Av,e),Mn(Ns,r))}function AS(e){Av.current===e&&(cn(Ns),cn(Av))}var Rn=Gc(0);function Tg(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&64)!=0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var _u=null,Xc=null,Us=!1;function DI(e,t){var r=bo(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.flags=8,e.lastEffect!==null?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function MI(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,!0):!1;case 13:return!1;default:return!1}}function TS(e){if(Us){var t=Xc;if(t){var r=t;if(!MI(e,t)){if(t=om(r.nextSibling),!t||!MI(e,t)){e.flags=e.flags&-1025|2,Us=!1,_u=e;return}DI(_u,r)}_u=e,Xc=om(t.firstChild)}else e.flags=e.flags&-1025|2,Us=!1,_u=e}}function RI(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;_u=e}function Pg(e){if(e!==_u)return!1;if(!Us)return RI(e),Us=!0,!1;var t=e.type;if(e.tag!==5||t!=="head"&&t!=="body"&&!lS(t,e.memoizedProps))for(t=Xc;t;)DI(e,t),t=om(t.nextSibling);if(RI(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(gt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Xc=om(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Xc=null}}else Xc=_u?om(e.stateNode.nextSibling):null;return!0}function PS(){Xc=_u=null,Us=!1}var vm=[];function ES(){for(var e=0;e<vm.length;e++)vm[e]._workInProgressVersionPrimary=null;vm.length=0}var Pv=uf.ReactCurrentDispatcher,go=uf.ReactCurrentBatchConfig,Ev=0,Ln=null,Ha=null,Ea=null,Eg=!1,Iv=!1;function wi(){throw Error(gt(321))}function IS(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!vo(e[r],t[r]))return!1;return!0}function DS(e,t,r,n,a,i){if(Ev=i,Ln=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Pv.current=e===null||e.memoizedState===null?wH:AH,e=r(n,a),Iv){i=0;do{if(Iv=!1,!(25>i))throw Error(gt(301));i+=1,Ea=Ha=null,t.updateQueue=null,Pv.current=TH,e=r(n,a)}while(Iv)}if(Pv.current=Rg,t=Ha!==null&&Ha.next!==null,Ev=0,Ea=Ha=Ln=null,Eg=!1,t)throw Error(gt(300));return e}function gf(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ea===null?Ln.memoizedState=Ea=e:Ea=Ea.next=e,Ea}function yf(){if(Ha===null){var e=Ln.alternate;e=e!==null?e.memoizedState:null}else e=Ha.next;var t=Ea===null?Ln.memoizedState:Ea.next;if(t!==null)Ea=t,Ha=e;else{if(e===null)throw Error(gt(310));Ha=e,e={memoizedState:Ha.memoizedState,baseState:Ha.baseState,baseQueue:Ha.baseQueue,queue:Ha.queue,next:null},Ea===null?Ln.memoizedState=Ea=e:Ea=Ea.next=e}return Ea}function zs(e,t){return typeof t=="function"?t(e):t}function Dv(e){var t=yf(),r=t.queue;if(r===null)throw Error(gt(311));r.lastRenderedReducer=e;var n=Ha,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){a=a.next,n=n.baseState;var s=o=i=null,u=a;do{var c=u.lane;if((Ev&c)===c)s!==null&&(s=s.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),n=u.eagerReducer===e?u.eagerState:e(n,u.action);else{var l={lane:c,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};s===null?(o=s=l,i=n):s=s.next=l,Ln.lanes|=c,Fv|=c}u=u.next}while(u!==null&&u!==a);s===null?i=n:s.next=o,vo(n,t.memoizedState)||(is=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=s,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function Mv(e){var t=yf(),r=t.queue;if(r===null)throw Error(gt(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);vo(i,t.memoizedState)||(is=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function BI(e,t,r){var n=t._getVersion;n=n(t._source);var a=t._workInProgressVersionPrimary;if(a!==null?e=a===n:(e=e.mutableReadLanes,(e=(Ev&e)===e)&&(t._workInProgressVersionPrimary=n,vm.push(t))),e)return r(t._source);throw vm.push(t),Error(gt(350))}function FI(e,t,r,n){var a=ci;if(a===null)throw Error(gt(349));var i=t._getVersion,o=i(t._source),s=Pv.current,u=s.useState(function(){return BI(a,t,r)}),c=u[1],l=u[0];u=Ea;var f=e.memoizedState,d=f.refs,m=d.getSnapshot,p=f.source;f=f.subscribe;var v=Ln;return e.memoizedState={refs:d,source:t,subscribe:n},s.useEffect(function(){d.getSnapshot=r,d.setSnapshot=c;var h=i(t._source);if(!vo(o,h)){h=r(t._source),vo(l,h)||(c(h),h=Kc(v),a.mutableReadLanes|=h&a.pendingLanes),h=a.mutableReadLanes,a.entangledLanes|=h;for(var g=a.entanglements,y=h;0<y;){var b=31-Uc(y),x=1<<b;g[b]|=h,y&=~x}}},[r,t,n]),s.useEffect(function(){return n(t._source,function(){var h=d.getSnapshot,g=d.setSnapshot;try{g(h(t._source));var y=Kc(v);a.mutableReadLanes|=y&a.pendingLanes}catch(b){g(function(){throw b})}})},[t,n]),vo(m,r)&&vo(p,t)&&vo(f,n)||(e={pending:null,dispatch:null,lastRenderedReducer:zs,lastRenderedState:l},e.dispatch=c=FS.bind(null,Ln,e),u.queue=e,u.baseQueue=null,l=BI(a,t,r),u.memoizedState=u.baseState=l),l}function OI(e,t,r){var n=yf();return FI(n,e,t,r)}function Rv(e){var t=gf();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e=t.queue={pending:null,dispatch:null,lastRenderedReducer:zs,lastRenderedState:e},e=e.dispatch=FS.bind(null,Ln,e),[t.memoizedState,e]}function Ig(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ln.updateQueue,t===null?(t={lastEffect:null},Ln.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function kI(e){var t=gf();return e={current:e},t.memoizedState=e}function Dg(){return yf().memoizedState}function MS(e,t,r,n){var a=gf();Ln.flags|=e,a.memoizedState=Ig(1|t,r,void 0,n===void 0?null:n)}function RS(e,t,r,n){var a=yf();n=n===void 0?null:n;var i=void 0;if(Ha!==null){var o=Ha.memoizedState;if(i=o.destroy,n!==null&&IS(n,o.deps)){Ig(t,r,i,n);return}}Ln.flags|=e,a.memoizedState=Ig(1|t,r,i,n)}function LI(e,t){return MS(516,4,e,t)}function Mg(e,t){return RS(516,4,e,t)}function NI(e,t){return RS(4,2,e,t)}function UI(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function zI(e,t,r){return r=r!=null?r.concat([e]):null,RS(4,2,UI.bind(null,t,e),r)}function BS(){}function VI(e,t){var r=yf();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&IS(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function GI(e,t){var r=yf();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&IS(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function _H(e,t){var r=fm();vf(98>r?98:r,function(){e(!0)}),vf(97<r?97:r,function(){var n=go.transition;go.transition=1;try{e(!1),t()}finally{go.transition=n}})}function FS(e,t,r){var n=ji(),a=Kc(e),i={lane:a,action:r,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===Ln||o!==null&&o===Ln)Iv=Eg=!0;else{if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,u=o(s,r);if(i.eagerReducer=o,i.eagerState=u,vo(u,s))return}catch{}finally{}Qc(e,a,n)}}var Rg={readContext:ho,useCallback:wi,useContext:wi,useEffect:wi,useImperativeHandle:wi,useLayoutEffect:wi,useMemo:wi,useReducer:wi,useRef:wi,useState:wi,useDebugValue:wi,useDeferredValue:wi,useTransition:wi,useMutableSource:wi,useOpaqueIdentifier:wi,unstable_isNewReconciler:!1},wH={readContext:ho,useCallback:function(e,t){return gf().memoizedState=[e,t===void 0?null:t],e},useContext:ho,useEffect:LI,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,MS(4,2,UI.bind(null,t,e),r)},useLayoutEffect:function(e,t){return MS(4,2,e,t)},useMemo:function(e,t){var r=gf();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=gf();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=FS.bind(null,Ln,e),[n.memoizedState,e]},useRef:kI,useState:Rv,useDebugValue:BS,useDeferredValue:function(e){var t=Rv(e),r=t[0],n=t[1];return LI(function(){var a=go.transition;go.transition=1;try{n(e)}finally{go.transition=a}},[e]),r},useTransition:function(){var e=Rv(!1),t=e[0];return e=_H.bind(null,e[1]),kI(e),[e,t]},useMutableSource:function(e,t,r){var n=gf();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:r},FI(n,e,t,r)},useOpaqueIdentifier:function(){if(Us){var e=!1,t=gH(function(){throw e||(e=!0,r("r:"+(dS++).toString(36))),Error(gt(355))}),r=Rv(t)[1];return(Ln.mode&2)==0&&(Ln.flags|=516,Ig(5,function(){r("r:"+(dS++).toString(36))},void 0,null)),t}return t="r:"+(dS++).toString(36),Rv(t),t},unstable_isNewReconciler:!1},AH={readContext:ho,useCallback:VI,useContext:ho,useEffect:Mg,useImperativeHandle:zI,useLayoutEffect:NI,useMemo:GI,useReducer:Dv,useRef:Dg,useState:function(){return Dv(zs)},useDebugValue:BS,useDeferredValue:function(e){var t=Dv(zs),r=t[0],n=t[1];return Mg(function(){var a=go.transition;go.transition=1;try{n(e)}finally{go.transition=a}},[e]),r},useTransition:function(){var e=Dv(zs)[0];return[Dg().current,e]},useMutableSource:OI,useOpaqueIdentifier:function(){return Dv(zs)[0]},unstable_isNewReconciler:!1},TH={readContext:ho,useCallback:VI,useContext:ho,useEffect:Mg,useImperativeHandle:zI,useLayoutEffect:NI,useMemo:GI,useReducer:Mv,useRef:Dg,useState:function(){return Mv(zs)},useDebugValue:BS,useDeferredValue:function(e){var t=Mv(zs),r=t[0],n=t[1];return Mg(function(){var a=go.transition;go.transition=1;try{n(e)}finally{go.transition=a}},[e]),r},useTransition:function(){var e=Mv(zs)[0];return[Dg().current,e]},useMutableSource:OI,useOpaqueIdentifier:function(){return Mv(zs)[0]},unstable_isNewReconciler:!1},PH=uf.ReactCurrentOwner,is=!1;function Ai(e,t,r,n){t.child=e===null?EI(t,null,r,n):Ag(t,e.child,r,n)}function HI(e,t,r,n,a){r=r.render;var i=t.ref;return mm(t,a),n=DS(e,t,r,n,i,a),e!==null&&!is?(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,wu(e,t,a)):(t.flags|=1,Ai(e,t,n,a),t.child)}function qI(e,t,r,n,a,i){if(e===null){var o=r.type;return typeof o=="function"&&!nC(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,jI(e,t,o,n,a,i)):(e=Gg(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}return o=e.child,(a&i)==0&&(a=o.memoizedProps,r=r.compare,r=r!==null?r:hv,r(a,n)&&e.ref===t.ref)?wu(e,t,i):(t.flags|=1,e=Jc(o,n),e.ref=t.ref,e.return=t,t.child=e)}function jI(e,t,r,n,a,i){if(e!==null&&hv(e.memoizedProps,n)&&e.ref===t.ref)if(is=!1,(i&a)!=0)(e.flags&16384)!=0&&(is=!0);else return t.lanes=e.lanes,wu(e,t,i);return kS(e,t,r,n,i)}function OS(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden"||n.mode==="unstable-defer-without-hiding")if((t.mode&4)==0)t.memoizedState={baseLanes:0},Vg(t,r);else if((r&1073741824)!=0)t.memoizedState={baseLanes:0},Vg(t,i!==null?i.baseLanes:r);else return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Vg(t,e),null;else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Vg(t,n);return Ai(e,t,a,r),t.child}function WI(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=128)}function kS(e,t,r,n,a){var i=_i(r)?mf:Va.current;return i=lm(t,i),mm(t,a),r=DS(e,t,r,n,i,a),e!==null&&!is?(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,wu(e,t,a)):(t.flags|=1,Ai(e,t,r,a),t.child)}function XI(e,t,r,n,a){if(_i(r)){var i=!0;vg(t)}else i=!1;if(mm(t,a),t.stateNode===null)e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),AI(t,r,n),_S(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=ho(c):(c=_i(r)?mf:Va.current,c=lm(t,c));var l=r.getDerivedStateFromProps,f=typeof l=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==c)&&TI(t,o,n,c),qc=!1;var d=t.memoizedState;o.state=d,Cv(t,n,o,a),u=t.memoizedState,s!==n||d!==u||Ci.current||qc?(typeof l=="function"&&(Sg(t,r,l,n),u=t.memoizedState),(s=qc||wI(t,r,s,n,d,u,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4)):(typeof o.componentDidMount=="function"&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=c,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4),n=!1)}else{o=t.stateNode,xI(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:as(t.type,s),o.props=c,f=t.pendingProps,d=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=ho(u):(u=_i(r)?mf:Va.current,u=lm(t,u));var m=r.getDerivedStateFromProps;(l=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||d!==u)&&TI(t,o,n,u),qc=!1,d=t.memoizedState,o.state=d,Cv(t,n,o,a);var p=t.memoizedState;s!==f||d!==p||Ci.current||qc?(typeof m=="function"&&(Sg(t,r,m,n),p=t.memoizedState),(c=qc||wI(t,r,c,n,d,p,u))?(l||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,p,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,p,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=256)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=p),o.props=n,o.state=p,o.context=u,n=c):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),n=!1)}return LS(e,t,r,n,i,a)}function LS(e,t,r,n,a,i){WI(e,t);var o=(t.flags&64)!=0;if(!n&&!o)return a&&lI(t,r,!1),wu(e,t,i);n=t.stateNode,PH.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Ag(t,e.child,null,i),t.child=Ag(t,null,s,i)):Ai(e,t,s,i),t.memoizedState=n.state,a&&lI(t,r,!0),t.child}function YI(e){var t=e.stateNode;t.pendingContext?uI(e,t.pendingContext,t.pendingContext!==t.context):t.context&&uI(e,t.context,!1),wS(e,t.containerInfo)}var Bg={dehydrated:null,retryLane:0};function KI(e,t,r){var n=t.pendingProps,a=Rn.current,i=!1,o;return(o=(t.flags&64)!=0)||(o=e!==null&&e.memoizedState===null?!1:(a&2)!=0),o?(i=!0,t.flags&=-65):e!==null&&e.memoizedState===null||n.fallback===void 0||n.unstable_avoidThisFallback===!0||(a|=1),Mn(Rn,a&1),e===null?(n.fallback!==void 0&&TS(t),e=n.children,a=n.fallback,i?(e=QI(t,e,a,r),t.child.memoizedState={baseLanes:r},t.memoizedState=Bg,e):typeof n.unstable_expectedLoadTime=="number"?(e=QI(t,e,a,r),t.child.memoizedState={baseLanes:r},t.memoizedState=Bg,t.lanes=33554432,e):(r=aC({mode:"visible",children:e},t.mode,r,null),r.return=t,t.child=r)):e.memoizedState!==null?i?(n=$I(e,t,n.children,n.fallback,r),i=t.child,a=e.child.memoizedState,i.memoizedState=a===null?{baseLanes:r}:{baseLanes:a.baseLanes|r},i.childLanes=e.childLanes&~r,t.memoizedState=Bg,n):(r=ZI(e,t,n.children,r),t.memoizedState=null,r):i?(n=$I(e,t,n.children,n.fallback,r),i=t.child,a=e.child.memoizedState,i.memoizedState=a===null?{baseLanes:r}:{baseLanes:a.baseLanes|r},i.childLanes=e.childLanes&~r,t.memoizedState=Bg,n):(r=ZI(e,t,n.children,r),t.memoizedState=null,r)}function QI(e,t,r,n){var a=e.mode,i=e.child;return t={mode:"hidden",children:t},(a&2)==0&&i!==null?(i.childLanes=0,i.pendingProps=t):i=aC(t,a,0,null),r=Sm(r,a,n,null),i.return=e,r.return=e,i.sibling=r,e.child=i,r}function ZI(e,t,r,n){var a=e.child;return e=a.sibling,r=Jc(a,{mode:"visible",children:r}),(t.mode&2)==0&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=r}function $I(e,t,r,n,a){var i=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:r};return(i&2)==0&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=s,o=r.lastEffect,o!==null?(t.firstEffect=r.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):r=Jc(o,s),e!==null?n=Jc(e,n):(n=Sm(n,i,a,null),n.flags|=2),n.return=t,r.return=t,r.sibling=n,t.child=r,n}function JI(e,t){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),bI(e.return,t)}function NS(e,t,r,n,a,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=a,o.lastEffect=i)}function eD(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(Ai(e,t,n.children,r),n=Rn.current,(n&2)!=0)n=n&1|2,t.flags|=64;else{if(e!==null&&(e.flags&64)!=0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&JI(e,r);else if(e.tag===19)JI(e,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Mn(Rn,n),(t.mode&2)==0)t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&Tg(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),NS(t,!1,a,r,i,t.lastEffect);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Tg(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}NS(t,!0,r,null,i,t.lastEffect);break;case"together":NS(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function wu(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Fv|=t.lanes,(r&t.childLanes)!=0){if(e!==null&&t.child!==e.child)throw Error(gt(153));if(t.child!==null){for(e=t.child,r=Jc(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Jc(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}return null}var tD,US,rD,nD;tD=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};US=function(){};rD=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,hf(Ns.current);var i=null;switch(r){case"input":a=_x(e,a),n=_x(e,n),i=[];break;case"option":a=Tx(e,a),n=Tx(e,n),i=[];break;case"select":a=vn({},a,{value:void 0}),n=vn({},n,{value:void 0}),i=[];break;case"textarea":a=Px(e,a),n=Px(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=lg)}Dx(r,n);var o;r=null;for(c in a)if(!n.hasOwnProperty(c)&&a.hasOwnProperty(c)&&a[c]!=null)if(c==="style"){var s=a[c];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Yp.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var u=n[c];if(s=a!=null?a[c]:void 0,n.hasOwnProperty(c)&&u!==s&&(u!=null||s!=null))if(c==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(i||(i=[]),i.push(c,r)),r=u;else c==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(c,u)):c==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(c,""+u):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Yp.hasOwnProperty(c)?(u!=null&&c==="onScroll"&&un("scroll",e),i||s===u||(i=[])):typeof u=="object"&&u!==null&&u.$$typeof===yx?u.toString():(i=i||[]).push(c,u))}r&&(i=i||[]).push("style",r);var c=i;(t.updateQueue=c)&&(t.flags|=4)}};nD=function(e,t,r,n){r!==n&&(t.flags|=4)};function Bv(e,t){if(!Us)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function EH(e,t,r){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return _i(t.type)&&pg(),null;case 3:return pm(),cn(Ci),cn(Va),ES(),n=t.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Pg(t)?t.flags|=4:n.hydrate||(t.flags|=256)),US(t),null;case 5:AS(t);var a=hf(Tv.current);if(r=t.type,e!==null&&t.stateNode!=null)rD(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(t.stateNode===null)throw Error(gt(166));return null}if(e=hf(Ns.current),Pg(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Vc]=t,n[dg]=i,r){case"dialog":un("cancel",n),un("close",n);break;case"iframe":case"object":case"embed":un("load",n);break;case"video":case"audio":for(e=0;e<yv.length;e++)un(yv[e],n);break;case"source":un("error",n);break;case"img":case"image":case"link":un("error",n),un("load",n);break;case"details":un("toggle",n);break;case"input":X4(n,i),un("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},un("invalid",n);break;case"textarea":Q4(n,i),un("invalid",n)}Dx(r,i),e=null;for(var o in i)i.hasOwnProperty(o)&&(a=i[o],o==="children"?typeof a=="string"?n.textContent!==a&&(e=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(e=["children",""+a]):Yp.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&un("scroll",n));switch(r){case"input":X0(n),K4(n,i,!0);break;case"textarea":X0(n),$4(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=lg)}n=e,t.updateQueue=n,n!==null&&(t.flags|=4)}else{switch(o=a.nodeType===9?a:a.ownerDocument,e===Ex.html&&(e=J4(r)),e===Ex.html?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Vc]=t,e[dg]=n,tD(e,t,!1,!1),t.stateNode=e,o=Mx(r,n),r){case"dialog":un("cancel",e),un("close",e),a=n;break;case"iframe":case"object":case"embed":un("load",e),a=n;break;case"video":case"audio":for(a=0;a<yv.length;a++)un(yv[a],e);a=n;break;case"source":un("error",e),a=n;break;case"img":case"image":case"link":un("error",e),un("load",e),a=n;break;case"details":un("toggle",e),a=n;break;case"input":X4(e,n),a=_x(e,n),un("invalid",e);break;case"option":a=Tx(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=vn({},n,{value:void 0}),un("invalid",e);break;case"textarea":Q4(e,n),a=Px(e,n),un("invalid",e);break;default:a=n}Dx(r,a);var s=a;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?rE(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&eE(e,u)):i==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&ev(e,u):typeof u=="number"&&ev(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Yp.hasOwnProperty(i)?u!=null&&i==="onScroll"&&un("scroll",e):u!=null&&dx(e,i,u,o))}switch(r){case"input":X0(e),K4(e,n,!1);break;case"textarea":X0(e),$4(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Oc(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Qd(e,!!n.multiple,i,!1):n.defaultValue!=null&&Qd(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=lg)}nI(r,n)&&(t.flags|=4)}t.ref!==null&&(t.flags|=128)}return null;case 6:if(e&&t.stateNode!=null)nD(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(gt(166));r=hf(Tv.current),hf(Ns.current),Pg(t)?(n=t.stateNode,r=t.memoizedProps,n[Vc]=t,n.nodeValue!==r&&(t.flags|=4)):(n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Vc]=t,t.stateNode=n)}return null;case 13:return cn(Rn),n=t.memoizedState,(t.flags&64)!=0?(t.lanes=r,t):(n=n!==null,r=!1,e===null?t.memoizedProps.fallback!==void 0&&Pg(t):r=e.memoizedState!==null,n&&!r&&(t.mode&2)!=0&&(e===null&&t.memoizedProps.unstable_avoidThisFallback!==!0||(Rn.current&1)!=0?Ia===0&&(Ia=3):((Ia===0||Ia===3)&&(Ia=4),ci===null||(Fv&134217727)==0&&(gm&134217727)==0||bm(ci,qa))),(n||r)&&(t.flags|=4),null);case 4:return pm(),US(t),e===null&&$E(t.stateNode.containerInfo),null;case 10:return SS(t),null;case 17:return _i(t.type)&&pg(),null;case 19:if(cn(Rn),n=t.memoizedState,n===null)return null;if(i=(t.flags&64)!=0,o=n.rendering,o===null)if(i)Bv(n,!1);else{if(Ia!==0||e!==null&&(e.flags&64)!=0)for(e=t.child;e!==null;){if(o=Tg(e),o!==null){for(t.flags|=64,Bv(n,!1),i=o.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),n.lastEffect===null&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Mn(Rn,Rn.current&1|2),t.child}e=e.sibling}n.tail!==null&&Ga()>QS&&(t.flags|=64,i=!0,Bv(n,!1),t.lanes=33554432)}else{if(!i)if(e=Tg(o),e!==null){if(t.flags|=64,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Bv(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!Us)return t=t.lastEffect=n.lastEffect,t!==null&&(t.nextEffect=null),null}else 2*Ga()-n.renderingStartTime>QS&&r!==1073741824&&(t.flags|=64,i=!0,Bv(n,!1),t.lanes=33554432);n.isBackwards?(o.sibling=t.child,t.child=o):(r=n.last,r!==null?r.sibling=o:t.child=o,n.last=o)}return n.tail!==null?(r=n.tail,n.rendering=r,n.tail=r.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=Ga(),r.sibling=null,t=Rn.current,Mn(Rn,i?t&1|2:t&1),r):null;case 23:case 24:return rC(),e!==null&&e.memoizedState!==null!=(t.memoizedState!==null)&&n.mode!=="unstable-defer-without-hiding"&&(t.flags|=4),null}throw Error(gt(156,t.tag))}function IH(e){switch(e.tag){case 1:_i(e.type)&&pg();var t=e.flags;return t&4096?(e.flags=t&-4097|64,e):null;case 3:if(pm(),cn(Ci),cn(Va),ES(),t=e.flags,(t&64)!=0)throw Error(gt(285));return e.flags=t&-4097|64,e;case 5:return AS(e),null;case 13:return cn(Rn),t=e.flags,t&4096?(e.flags=t&-4097|64,e):null;case 19:return cn(Rn),null;case 4:return pm(),null;case 10:return SS(e),null;case 23:case 24:return rC(),null;default:return null}}function zS(e,t){try{var r="",n=t;do r+=cG(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a}}function VS(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var DH=typeof WeakMap=="function"?WeakMap:Map;function aD(e,t,r){r=jc(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){kg||(kg=!0,ZS=n),VS(e,t)},r}function iD(e,t,r){r=jc(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return VS(e,t),n(a)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){typeof n!="function"&&(Vs===null?Vs=new Set([this]):Vs.add(this),VS(e,t));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}var MH=typeof WeakSet=="function"?WeakSet:Set;function oD(e){var t=e.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){$c(e,r)}else t.current=null}function RH(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(t.flags&256&&e!==null){var r=e.memoizedProps,n=e.memoizedState;e=t.stateNode,t=e.getSnapshotBeforeUpdate(t.elementType===t.type?r:as(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:t.flags&256&&fS(t.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(gt(163))}function BH(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:if(t=r.updateQueue,t=t!==null?t.lastEffect:null,t!==null){e=t=t.next;do{if((e.tag&3)==3){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(t=r.updateQueue,t=t!==null?t.lastEffect:null,t!==null){e=t=t.next;do{var a=e;n=a.next,a=a.tag,(a&4)!=0&&(a&1)!=0&&(SD(r,e),VH(r,e)),e=n}while(e!==t)}return;case 1:e=r.stateNode,r.flags&4&&(t===null?e.componentDidMount():(n=r.elementType===r.type?t.memoizedProps:as(r.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),t=r.updateQueue,t!==null&&CI(r,t,e);return;case 3:if(t=r.updateQueue,t!==null){if(e=null,r.child!==null)switch(r.child.tag){case 5:e=r.child.stateNode;break;case 1:e=r.child.stateNode}CI(r,t,e)}return;case 5:e=r.stateNode,t===null&&r.flags&4&&nI(r.type,r.memoizedProps)&&e.focus();return;case 6:return;case 4:return;case 12:return;case 13:r.memoizedState===null&&(r=r.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&yE(r))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(gt(163))}function sD(e,t){for(var r=e;;){if(r.tag===5){var n=r.stateNode;if(t)n=n.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none";else{n=r.stateNode;var a=r.memoizedProps.style;a=a!=null&&a.hasOwnProperty("display")?a.display:null,n.style.display=tE("display",a)}}else if(r.tag===6)r.stateNode.nodeValue=t?"":r.memoizedProps;else if((r.tag!==23&&r.tag!==24||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function uD(e,t){if(pf&&typeof pf.onCommitFiberUnmount=="function")try{pf.onCommitFiberUnmount(pS,t)}catch{}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(e=t.updateQueue,e!==null&&(e=e.lastEffect,e!==null)){var r=e=e.next;do{var n=r,a=n.destroy;if(n=n.tag,a!==void 0)if((n&4)!=0)SD(t,r);else{n=t;try{a()}catch(i){$c(n,i)}}r=r.next}while(r!==e)}break;case 1:if(oD(t),e=t.stateNode,typeof e.componentWillUnmount=="function")try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(i){$c(t,i)}break;case 5:oD(t);break;case 4:dD(e,t)}}function cD(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function lD(e){return e.tag===5||e.tag===3||e.tag===4}function fD(e){e:{for(var t=e.return;t!==null;){if(lD(t))break e;t=t.return}throw Error(gt(160))}var r=t;switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:t=t.containerInfo,n=!0;break;case 4:t=t.containerInfo,n=!0;break;default:throw Error(gt(161))}r.flags&16&&(ev(t,""),r.flags&=-17);e:t:for(r=e;;){for(;r.sibling===null;){if(r.return===null||lD(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue t;r.child.return=r,r=r.child}if(!(r.flags&2)){r=r.stateNode;break e}}n?GS(e,r,t):HS(e,r,t)}function GS(e,t,r){var n=e.tag,a=n===5||n===6;if(a)e=a?e.stateNode:e.stateNode.instance,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=lg));else if(n!==4&&(e=e.child,e!==null))for(GS(e,t,r),e=e.sibling;e!==null;)GS(e,t,r),e=e.sibling}function HS(e,t,r){var n=e.tag,a=n===5||n===6;if(a)e=a?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(HS(e,t,r),e=e.sibling;e!==null;)HS(e,t,r),e=e.sibling}function dD(e,t){for(var r=t,n=!1,a,i;;){if(!n){n=r.return;e:for(;;){if(n===null)throw Error(gt(160));switch(a=n.stateNode,n.tag){case 5:i=!1;break e;case 3:a=a.containerInfo,i=!0;break e;case 4:a=a.containerInfo,i=!0;break e}n=n.return}n=!0}if(r.tag===5||r.tag===6){e:for(var o=e,s=r,u=s;;)if(uD(o,u),u.child!==null&&u.tag!==4)u.child.return=u,u=u.child;else{if(u===s)break e;for(;u.sibling===null;){if(u.return===null||u.return===s)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}i?(o=a,s=r.stateNode,o.nodeType===8?o.parentNode.removeChild(s):o.removeChild(s)):a.removeChild(r.stateNode)}else if(r.tag===4){if(r.child!==null){a=r.stateNode.containerInfo,i=!0,r.child.return=r,r=r.child;continue}}else if(uD(e,r),r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return,r.tag===4&&(n=!1)}r.sibling.return=r.return,r=r.sibling}}function qS(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do(n.tag&3)==3&&(e=n.destroy,n.destroy=void 0,e!==void 0&&e()),n=n.next;while(n!==r)}return;case 1:return;case 5:if(r=t.stateNode,r!=null){n=t.memoizedProps;var a=e!==null?e.memoizedProps:n;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,i!==null){for(r[dg]=n,e==="input"&&n.type==="radio"&&n.name!=null&&Y4(r,n),Mx(e,a),t=Mx(e,n),a=0;a<i.length;a+=2){var o=i[a],s=i[a+1];o==="style"?rE(r,s):o==="dangerouslySetInnerHTML"?eE(r,s):o==="children"?ev(r,s):dx(r,o,s,t)}switch(e){case"input":wx(r,n);break;case"textarea":Z4(r,n);break;case"select":e=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,i=n.value,i!=null?Qd(r,!!n.multiple,i,!1):e!==!!n.multiple&&(n.defaultValue!=null?Qd(r,!!n.multiple,n.defaultValue,!0):Qd(r,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(t.stateNode===null)throw Error(gt(162));t.stateNode.nodeValue=t.memoizedProps;return;case 3:r=t.stateNode,r.hydrate&&(r.hydrate=!1,yE(r.containerInfo));return;case 12:return;case 13:t.memoizedState!==null&&(KS=Ga(),sD(t.child,!0)),mD(t);return;case 19:mD(t);return;case 17:return;case 23:case 24:sD(t,t.memoizedState!==null);return}throw Error(gt(163))}function mD(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new MH),t.forEach(function(n){var a=qH.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function FH(e,t){return e!==null&&(e=e.memoizedState,e===null||e.dehydrated!==null)?(t=t.memoizedState,t!==null&&t.dehydrated===null):!1}var OH=Math.ceil,Fg=uf.ReactCurrentDispatcher,jS=uf.ReactCurrentOwner,Qt=0,ci=null,aa=null,qa=0,bf=0,WS=Gc(0),Ia=0,Og=null,hm=0,Fv=0,gm=0,XS=0,YS=null,KS=0,QS=1/0;function ym(){QS=Ga()+500}var Rt=null,kg=!1,ZS=null,Vs=null,Yc=!1,Ov=null,kv=90,$S=[],JS=[],Au=null,Lv=0,eC=null,Lg=-1,Tu=0,Ng=0,Nv=null,Ug=!1;function ji(){return(Qt&48)!=0?Ga():Lg!==-1?Lg:Lg=Ga()}function Kc(e){if(e=e.mode,(e&2)==0)return 1;if((e&4)==0)return fm()===99?1:2;if(Tu===0&&(Tu=hm),CH.transition!==0){Ng!==0&&(Ng=YS!==null?YS.pendingLanes:0),e=Tu;var t=4186112&~Ng;return t&=-t,t===0&&(e=4186112&~e,t=e&-e,t===0&&(t=8192)),t}return e=fm(),(Qt&4)!=0&&e===98?e=tg(12,Tu):(e=AG(e),e=tg(e,Tu)),e}function Qc(e,t,r){if(50<Lv)throw Lv=0,eC=null,Error(gt(185));if(e=zg(e,t),e===null)return null;rg(e,t,r),e===ci&&(gm|=t,Ia===4&&bm(e,qa));var n=fm();t===1?(Qt&8)!=0&&(Qt&48)==0?tC(e):(yo(e,r),Qt===0&&(ym(),Ls())):((Qt&4)==0||n!==98&&n!==99||(Au===null?Au=new Set([e]):Au.add(e)),yo(e,r)),YS=e}function zg(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}function yo(e,t){for(var r=e.callbackNode,n=e.suspendedLanes,a=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-Uc(o),u=1<<s,c=i[s];if(c===-1){if((u&n)==0||(u&a)!=0){c=t,em(u);var l=tn;i[s]=10<=l?c+250:6<=l?c+5e3:-1}}else c<=t&&(e.expiredLanes|=u);o&=~u}if(n=lv(e,e===ci?qa:0),t=tn,n===0)r!==null&&(r!==yS&&hS(r),e.callbackNode=null,e.callbackPriority=0);else{if(r!==null){if(e.callbackPriority===t)return;r!==yS&&hS(r)}t===15?(r=tC.bind(null,e),Cu===null?(Cu=[r],gg=vS(hg,yI)):Cu.push(r),r=yS):t===14?r=Sv(99,tC.bind(null,e)):(r=TG(t),r=Sv(r,pD.bind(null,e))),e.callbackPriority=t,e.callbackNode=r}}function pD(e){if(Lg=-1,Ng=Tu=0,(Qt&48)!=0)throw Error(gt(327));var t=e.callbackNode;if(Zc()&&e.callbackNode!==t)return null;var r=lv(e,e===ci?qa:0);if(r===0)return null;var n=r,a=Qt;Qt|=16;var i=yD();(ci!==e||qa!==n)&&(ym(),xm(e,n));do try{NH();break}catch(s){gD(e,s)}while(1);if(xS(),Fg.current=i,Qt=a,aa!==null?n=0:(ci=null,qa=0,n=Ia),(hm&gm)!=0)xm(e,0);else if(n!==0){if(n===2&&(Qt|=64,e.hydrate&&(e.hydrate=!1,fS(e.containerInfo)),r=AE(e),r!==0&&(n=Uv(e,r))),n===1)throw t=Og,xm(e,0),bm(e,r),yo(e,Ga()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=r,n){case 0:case 1:throw Error(gt(345));case 2:xf(e);break;case 3:if(bm(e,r),(r&62914560)===r&&(n=KS+500-Ga(),10<n)){if(lv(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){ji(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=aI(xf.bind(null,e),n);break}xf(e);break;case 4:if(bm(e,r),(r&4186112)===r)break;for(n=e.eventTimes,a=-1;0<r;){var o=31-Uc(r);i=1<<o,o=n[o],o>a&&(a=o),r&=~i}if(r=a,r=Ga()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OH(r/1960))-r,10<r){e.timeoutHandle=aI(xf.bind(null,e),r);break}xf(e);break;case 5:xf(e);break;default:throw Error(gt(329))}}return yo(e,Ga()),e.callbackNode===t?pD.bind(null,e):null}function bm(e,t){for(t&=~XS,t&=~gm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Uc(t),n=1<<r;e[r]=-1,t&=~n}}function tC(e){if((Qt&48)!=0)throw Error(gt(327));if(Zc(),e===ci&&(e.expiredLanes&qa)!=0){var t=qa,r=Uv(e,t);(hm&gm)!=0&&(t=lv(e,t),r=Uv(e,t))}else t=lv(e,0),r=Uv(e,t);if(e.tag!==0&&r===2&&(Qt|=64,e.hydrate&&(e.hydrate=!1,fS(e.containerInfo)),t=AE(e),t!==0&&(r=Uv(e,t))),r===1)throw r=Og,xm(e,0),bm(e,t),yo(e,Ga()),r;return e.finishedWork=e.current.alternate,e.finishedLanes=t,xf(e),yo(e,Ga()),null}function kH(){if(Au!==null){var e=Au;Au=null,e.forEach(function(t){t.expiredLanes|=24&t.pendingLanes,yo(t,Ga())})}Ls()}function vD(e,t){var r=Qt;Qt|=1;try{return e(t)}finally{Qt=r,Qt===0&&(ym(),Ls())}}function hD(e,t){var r=Qt;Qt&=-2,Qt|=8;try{return e(t)}finally{Qt=r,Qt===0&&(ym(),Ls())}}function Vg(e,t){Mn(WS,bf),bf|=t,hm|=t}function rC(){bf=WS.current,cn(WS)}function xm(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,hH(r)),aa!==null)for(r=aa.return;r!==null;){var n=r;switch(n.tag){case 1:n=n.type.childContextTypes,n!=null&&pg();break;case 3:pm(),cn(Ci),cn(Va),ES();break;case 5:AS(n);break;case 4:pm();break;case 13:cn(Rn);break;case 19:cn(Rn);break;case 10:SS(n);break;case 23:case 24:rC()}r=r.return}ci=e,aa=Jc(e.current,null),qa=bf=hm=t,Ia=0,Og=null,XS=gm=Fv=0}function gD(e,t){do{var r=aa;try{if(xS(),Pv.current=Rg,Eg){for(var n=Ln.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Eg=!1}if(Ev=0,Ea=Ha=Ln=null,Iv=!1,jS.current=null,r===null||r.return===null){Ia=1,Og=t,aa=null;break}e:{var i=e,o=r.return,s=r,u=t;if(t=qa,s.flags|=2048,s.firstEffect=s.lastEffect=null,u!==null&&typeof u=="object"&&typeof u.then=="function"){var c=u;if((s.mode&2)==0){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.lanes=l.lanes):(s.updateQueue=null,s.memoizedState=null)}var f=(Rn.current&1)!=0,d=o;do{var m;if(m=d.tag===13){var p=d.memoizedState;if(p!==null)m=p.dehydrated!==null;else{var v=d.memoizedProps;m=v.fallback===void 0?!1:v.unstable_avoidThisFallback!==!0?!0:!f}}if(m){var h=d.updateQueue;if(h===null){var g=new Set;g.add(c),d.updateQueue=g}else h.add(c);if((d.mode&2)==0){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var y=jc(-1,1);y.tag=2,Wc(s,y)}s.lanes|=1;break e}u=void 0,s=t;var b=i.pingCache;if(b===null?(b=i.pingCache=new DH,u=new Set,b.set(c,u)):(u=b.get(c),u===void 0&&(u=new Set,b.set(c,u))),!u.has(s)){u.add(s);var x=HH.bind(null,i,c,s);c.then(x,x)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(d!==null);u=Error((Kd(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Ia!==5&&(Ia=2),u=zS(u,s),d=o;do{switch(d.tag){case 3:i=u,d.flags|=4096,t&=-t,d.lanes|=t;var C=aD(d,i,t);SI(d,C);break e;case 1:i=u;var _=d.type,w=d.stateNode;if((d.flags&64)==0&&(typeof _.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Vs===null||!Vs.has(w)))){d.flags|=4096,t&=-t,d.lanes|=t;var T=iD(d,i,t);SI(d,T);break e}}d=d.return}while(d!==null)}xD(r)}catch(A){t=A,aa===r&&r!==null&&(aa=r=r.return);continue}break}while(1)}function yD(){var e=Fg.current;return Fg.current=Rg,e===null?Rg:e}function Uv(e,t){var r=Qt;Qt|=16;var n=yD();ci===e&&qa===t||xm(e,t);do try{LH();break}catch(a){gD(e,a)}while(1);if(xS(),Qt=r,Fg.current=n,aa!==null)throw Error(gt(261));return ci=null,qa=0,Ia}function LH(){for(;aa!==null;)bD(aa)}function NH(){for(;aa!==null&&!bH();)bD(aa)}function bD(e){var t=_D(e.alternate,e,bf);e.memoizedProps=e.pendingProps,t===null?xD(e):aa=t,jS.current=null}function xD(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&2048)==0){if(r=EH(r,t,bf),r!==null){aa=r;return}if(r=t,r.tag!==24&&r.tag!==23||r.memoizedState===null||(bf&1073741824)!=0||(r.mode&4)==0){for(var n=0,a=r.child;a!==null;)n|=a.lanes|a.childLanes,a=a.sibling;r.childLanes=n}e!==null&&(e.flags&2048)==0&&(e.firstEffect===null&&(e.firstEffect=t.firstEffect),t.lastEffect!==null&&(e.lastEffect!==null&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(e.lastEffect!==null?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(r=IH(t),r!==null){r.flags&=2047,aa=r;return}e!==null&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(t=t.sibling,t!==null){aa=t;return}aa=t=e}while(t!==null);Ia===0&&(Ia=5)}function xf(e){var t=fm();return vf(99,UH.bind(null,e,t)),null}function UH(e,t){do Zc();while(Ov!==null);if((Qt&48)!=0)throw Error(gt(327));var r=e.finishedWork;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(gt(177));e.callbackNode=null;var n=r.lanes|r.childLanes,a=n,i=e.pendingLanes&~a;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=a,e.mutableReadLanes&=a,e.entangledLanes&=a,a=e.entanglements;for(var o=e.eventTimes,s=e.expirationTimes;0<i;){var u=31-Uc(i),c=1<<u;a[u]=0,o[u]=-1,s[u]=-1,i&=~c}if(Au!==null&&(n&24)==0&&Au.has(e)&&Au.delete(e),e===ci&&(aa=ci=null,qa=0),1<r.flags?r.lastEffect!==null?(r.lastEffect.nextEffect=r,n=r.firstEffect):n=r:n=r.firstEffect,n!==null){if(a=Qt,Qt|=32,jS.current=null,uS=ng,o=jE(),aS(o)){if("selectionStart"in o)s={start:o.selectionStart,end:o.selectionEnd};else e:if(s=(s=o.ownerDocument)&&s.defaultView||window,(c=s.getSelection&&s.getSelection())&&c.rangeCount!==0){s=c.anchorNode,i=c.anchorOffset,u=c.focusNode,c=c.focusOffset;try{s.nodeType,u.nodeType}catch{s=null;break e}var l=0,f=-1,d=-1,m=0,p=0,v=o,h=null;t:for(;;){for(var g;v!==s||i!==0&&v.nodeType!==3||(f=l+i),v!==u||c!==0&&v.nodeType!==3||(d=l+c),v.nodeType===3&&(l+=v.nodeValue.length),(g=v.firstChild)!==null;)h=v,v=g;for(;;){if(v===o)break t;if(h===s&&++m===i&&(f=l),h===u&&++p===c&&(d=l),(g=v.nextSibling)!==null)break;v=h,h=v.parentNode}v=g}s=f===-1||d===-1?null:{start:f,end:d}}else s=null;s=s||{start:0,end:0}}else s=null;cS={focusedElem:o,selectionRange:s},ng=!1,Nv=null,Ug=!1,Rt=n;do try{zH()}catch(A){if(Rt===null)throw Error(gt(330));$c(Rt,A),Rt=Rt.nextEffect}while(Rt!==null);Nv=null,Rt=n;do try{for(o=e;Rt!==null;){var y=Rt.flags;if(y&16&&ev(Rt.stateNode,""),y&128){var b=Rt.alternate;if(b!==null){var x=b.ref;x!==null&&(typeof x=="function"?x(null):x.current=null)}}switch(y&1038){case 2:fD(Rt),Rt.flags&=-3;break;case 6:fD(Rt),Rt.flags&=-3,qS(Rt.alternate,Rt);break;case 1024:Rt.flags&=-1025;break;case 1028:Rt.flags&=-1025,qS(Rt.alternate,Rt);break;case 4:qS(Rt.alternate,Rt);break;case 8:s=Rt,dD(o,s);var C=s.alternate;cD(s),C!==null&&cD(C)}Rt=Rt.nextEffect}}catch(A){if(Rt===null)throw Error(gt(330));$c(Rt,A),Rt=Rt.nextEffect}while(Rt!==null);if(x=cS,b=jE(),y=x.focusedElem,o=x.selectionRange,b!==y&&y&&y.ownerDocument&&qE(y.ownerDocument.documentElement,y)){for(o!==null&&aS(y)&&(b=o.start,x=o.end,x===void 0&&(x=b),"selectionStart"in y?(y.selectionStart=b,y.selectionEnd=Math.min(x,y.value.length)):(x=(b=y.ownerDocument||document)&&b.defaultView||window,x.getSelection&&(x=x.getSelection(),s=y.textContent.length,C=Math.min(o.start,s),o=o.end===void 0?C:Math.min(o.end,s),!x.extend&&C>o&&(s=o,o=C,C=s),s=HE(y,C),i=HE(y,o),s&&i&&(x.rangeCount!==1||x.anchorNode!==s.node||x.anchorOffset!==s.offset||x.focusNode!==i.node||x.focusOffset!==i.offset)&&(b=b.createRange(),b.setStart(s.node,s.offset),x.removeAllRanges(),C>o?(x.addRange(b),x.extend(i.node,i.offset)):(b.setEnd(i.node,i.offset),x.addRange(b)))))),b=[],x=y;x=x.parentNode;)x.nodeType===1&&b.push({element:x,left:x.scrollLeft,top:x.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<b.length;y++)x=b[y],x.element.scrollLeft=x.left,x.element.scrollTop=x.top}ng=!!uS,cS=uS=null,e.current=r,Rt=n;do try{for(y=e;Rt!==null;){var _=Rt.flags;if(_&36&&BH(y,Rt.alternate,Rt),_&128){b=void 0;var w=Rt.ref;if(w!==null){var T=Rt.stateNode;switch(Rt.tag){case 5:b=T;break;default:b=T}typeof w=="function"?w(b):w.current=b}}Rt=Rt.nextEffect}}catch(A){if(Rt===null)throw Error(gt(330));$c(Rt,A),Rt=Rt.nextEffect}while(Rt!==null);Rt=null,SH(),Qt=a}else e.current=r;if(Yc)Yc=!1,Ov=e,kv=t;else for(Rt=n;Rt!==null;)t=Rt.nextEffect,Rt.nextEffect=null,Rt.flags&8&&(_=Rt,_.sibling=null,_.stateNode=null),Rt=t;if(n=e.pendingLanes,n===0&&(Vs=null),n===1?e===eC?Lv++:(Lv=0,eC=e):Lv=0,r=r.stateNode,pf&&typeof pf.onCommitFiberRoot=="function")try{pf.onCommitFiberRoot(pS,r,void 0,(r.current.flags&64)==64)}catch{}if(yo(e,Ga()),kg)throw kg=!1,e=ZS,ZS=null,e;return(Qt&8)!=0||Ls(),null}function zH(){for(;Rt!==null;){var e=Rt.alternate;Ug||Nv===null||((Rt.flags&8)!=0?fE(Rt,Nv)&&(Ug=!0):Rt.tag===13&&FH(e,Rt)&&fE(Rt,Nv)&&(Ug=!0));var t=Rt.flags;(t&256)!=0&&RH(e,Rt),(t&512)==0||Yc||(Yc=!0,Sv(97,function(){return Zc(),null})),Rt=Rt.nextEffect}}function Zc(){if(kv!==90){var e=97<kv?97:kv;return kv=90,vf(e,GH)}return!1}function VH(e,t){$S.push(t,e),Yc||(Yc=!0,Sv(97,function(){return Zc(),null}))}function SD(e,t){JS.push(t,e),Yc||(Yc=!0,Sv(97,function(){return Zc(),null}))}function GH(){if(Ov===null)return!1;var e=Ov;if(Ov=null,(Qt&48)!=0)throw Error(gt(331));var t=Qt;Qt|=32;var r=JS;JS=[];for(var n=0;n<r.length;n+=2){var a=r[n],i=r[n+1],o=a.destroy;if(a.destroy=void 0,typeof o=="function")try{o()}catch(u){if(i===null)throw Error(gt(330));$c(i,u)}}for(r=$S,$S=[],n=0;n<r.length;n+=2){a=r[n],i=r[n+1];try{var s=a.create;a.destroy=s()}catch(u){if(i===null)throw Error(gt(330));$c(i,u)}}for(s=e.current.firstEffect;s!==null;)e=s.nextEffect,s.nextEffect=null,s.flags&8&&(s.sibling=null,s.stateNode=null),s=e;return Qt=t,Ls(),!0}function CD(e,t,r){t=zS(r,t),t=aD(e,t,1),Wc(e,t),t=ji(),e=zg(e,1),e!==null&&(rg(e,1,t),yo(e,t))}function $c(e,t){if(e.tag===3)CD(e,e,t);else for(var r=e.return;r!==null;){if(r.tag===3){CD(r,e,t);break}else if(r.tag===1){var n=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Vs===null||!Vs.has(n))){e=zS(t,e);var a=iD(r,e,1);if(Wc(r,a),a=ji(),r=zg(r,1),r!==null)rg(r,1,a),yo(r,a);else if(typeof n.componentDidCatch=="function"&&(Vs===null||!Vs.has(n)))try{n.componentDidCatch(t,e)}catch{}break}}r=r.return}}function HH(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=ji(),e.pingedLanes|=e.suspendedLanes&r,ci===e&&(qa&r)===r&&(Ia===4||Ia===3&&(qa&62914560)===qa&&500>Ga()-KS?xm(e,0):XS|=r),yo(e,t)}function qH(e,t){var r=e.stateNode;r!==null&&r.delete(t),t=0,t===0&&(t=e.mode,(t&2)==0?t=1:(t&4)==0?t=fm()===99?1:2:(Tu===0&&(Tu=hm),t=tm(62914560&~Tu),t===0&&(t=4194304))),r=ji(),e=zg(e,t),e!==null&&(rg(e,t,r),yo(e,r))}var _D;_D=function(e,t,r){var n=t.lanes;if(e!==null)if(e.memoizedProps!==t.pendingProps||Ci.current)is=!0;else if((r&n)!=0)is=(e.flags&16384)!=0;else{switch(is=!1,t.tag){case 3:YI(t),PS();break;case 5:II(t);break;case 1:_i(t.type)&&vg(t);break;case 4:wS(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value;var a=t.type._context;Mn(yg,a._currentValue),a._currentValue=n;break;case 13:if(t.memoizedState!==null)return(r&t.child.childLanes)!=0?KI(e,t,r):(Mn(Rn,Rn.current&1),t=wu(e,t,r),t!==null?t.sibling:null);Mn(Rn,Rn.current&1);break;case 19:if(n=(r&t.childLanes)!=0,(e.flags&64)!=0){if(n)return eD(e,t,r);t.flags|=64}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Mn(Rn,Rn.current),n)break;return null;case 23:case 24:return t.lanes=0,OS(e,t,r)}return wu(e,t,r)}else is=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=lm(t,Va.current),mm(t,r),a=DS(null,t,n,e,a,r),t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,_i(n)){var i=!0;vg(t)}else i=!1;t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,CS(t);var o=n.getDerivedStateFromProps;typeof o=="function"&&Sg(t,n,o,e),a.updater=Cg,t.stateNode=a,a._reactInternals=t,_S(t,n,e,r),t=LS(null,t,n,!0,i,r)}else t.tag=0,Ai(null,t,a,r),t=t.child;return t;case 16:a=t.elementType;e:{switch(e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=a._init,a=i(a._payload),t.type=a,i=t.tag=WH(a),e=as(a,e),i){case 0:t=kS(null,t,a,e,r);break e;case 1:t=XI(null,t,a,e,r);break e;case 11:t=HI(null,t,a,e,r);break e;case 14:t=qI(null,t,a,as(a.type,e),n,r);break e}throw Error(gt(306,a,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:as(n,a),kS(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:as(n,a),XI(e,t,n,a,r);case 3:if(YI(t),n=t.updateQueue,e===null||n===null)throw Error(gt(282));if(n=t.pendingProps,a=t.memoizedState,a=a!==null?a.element:null,xI(e,t),Cv(t,n,null,r),n=t.memoizedState.element,n===a)PS(),t=wu(e,t,r);else{if(a=t.stateNode,(i=a.hydrate)&&(Xc=om(t.stateNode.containerInfo.firstChild),_u=t,i=Us=!0),i){if(e=a.mutableSourceEagerHydrationData,e!=null)for(a=0;a<e.length;a+=2)i=e[a],i._workInProgressVersionPrimary=e[a+1],vm.push(i);for(r=EI(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|1024,r=r.sibling}else Ai(e,t,n,r),PS();t=t.child}return t;case 5:return II(t),e===null&&TS(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,lS(n,a)?o=null:i!==null&&lS(n,i)&&(t.flags|=16),WI(e,t),Ai(e,t,o,r),t.child;case 6:return e===null&&TS(t),null;case 13:return KI(e,t,r);case 4:return wS(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Ag(t,null,n,r):Ai(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:as(n,a),HI(e,t,n,a,r);case 7:return Ai(e,t,t.pendingProps,r),t.child;case 8:return Ai(e,t,t.pendingProps.children,r),t.child;case 12:return Ai(e,t,t.pendingProps.children,r),t.child;case 10:e:{n=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value;var s=t.type._context;if(Mn(yg,s._currentValue),s._currentValue=i,o!==null)if(s=o.value,i=vo(s,i)?0:(typeof n._calculateChangedBits=="function"?n._calculateChangedBits(s,i):1073741823)|0,i===0){if(o.children===a.children&&!Ci.current){t=wu(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var u=s.dependencies;if(u!==null){o=s.child;for(var c=u.firstContext;c!==null;){if(c.context===n&&(c.observedBits&i)!=0){s.tag===1&&(c=jc(-1,r&-r),c.tag=2,Wc(s,c)),s.lanes|=r,c=s.alternate,c!==null&&(c.lanes|=r),bI(s.return,r),u.lanes|=r;break}c=c.next}}else o=s.tag===10&&s.type===t.type?null:s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ai(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,i=t.pendingProps,n=i.children,mm(t,r),a=ho(a,i.unstable_observedBits),n=n(a),t.flags|=1,Ai(e,t,n,r),t.child;case 14:return a=t.type,i=as(a,t.pendingProps),i=as(a.type,i),qI(e,t,a,i,n,r);case 15:return jI(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:as(n,a),e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,_i(n)?(e=!0,vg(t)):e=!1,mm(t,r),AI(t,n,a),_S(t,n,a,r),LS(null,t,n,!0,e,r);case 19:return eD(e,t,r);case 23:return OS(e,t,r);case 24:return OS(e,t,r)}throw Error(gt(156,t.tag))};function jH(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function bo(e,t,r,n){return new jH(e,t,r,n)}function nC(e){return e=e.prototype,!(!e||!e.isReactComponent)}function WH(e){if(typeof e=="function")return nC(e)?1:0;if(e!=null){if(e=e.$$typeof,e===H0)return 11;if(e===j0)return 14}return 2}function Jc(e,t){var r=e.alternate;return r===null?(r=bo(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Gg(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")nC(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Fc:return Sm(r.children,a,i,t);case H4:o=8,a|=16;break;case mx:o=8,a|=1;break;case Qp:return e=bo(12,r,t,a|8),e.elementType=Qp,e.type=Qp,e.lanes=i,e;case Zp:return e=bo(13,r,t,a),e.type=Zp,e.elementType=Zp,e.lanes=i,e;case q0:return e=bo(19,r,t,a),e.elementType=q0,e.lanes=i,e;case bx:return aC(r,a,i,t);case xx:return e=bo(24,r,t,a),e.elementType=xx,e.lanes=i,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case px:o=10;break e;case vx:o=9;break e;case H0:o=11;break e;case j0:o=14;break e;case hx:o=16,n=null;break e;case gx:o=22;break e}throw Error(gt(130,e==null?e:typeof e,""))}return t=bo(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function Sm(e,t,r,n){return e=bo(7,e,n,t),e.lanes=r,e}function aC(e,t,r,n){return e=bo(23,e,n,t),e.elementType=bx,e.lanes=r,e}function iC(e,t,r){return e=bo(6,e,null,t),e.lanes=r,e}function oC(e,t,r){return t=bo(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function XH(e,t,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Wx(0),this.expirationTimes=Wx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wx(0),this.mutableSourceEagerHydrationData=null}function YH(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cf,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function Hg(e,t,r,n){var a=t.current,i=ji(),o=Kc(a);e:if(r){r=r._reactInternals;t:{if(ff(r)!==r||r.tag!==1)throw Error(gt(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(_i(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(s!==null);throw Error(gt(171))}if(r.tag===1){var u=r.type;if(_i(u)){r=cI(r,u,s);break e}}r=s}else r=Hc;return t.context===null?t.context=r:t.pendingContext=r,t=jc(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),Wc(a,t),Qc(a,o,i),o}function sC(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function wD(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function uC(e,t){wD(e,t),(e=e.alternate)&&wD(e,t)}function KH(){return null}function cC(e,t,r){var n=r!=null&&r.hydrationOptions!=null&&r.hydrationOptions.mutableSources||null;if(r=new XH(e,t,r!=null&&r.hydrate===!0),t=bo(3,null,null,t===2?7:t===1?3:0),r.current=t,t.stateNode=r,CS(t),e[sm]=r.current,$E(e.nodeType===8?e.parentNode:e),n)for(e=0;e<n.length;e++){t=n[e];var a=t._getVersion;a=a(t._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[t,a]:r.mutableSourceEagerHydrationData.push(t,a)}this._internalRoot=r}cC.prototype.render=function(e){Hg(e,this._internalRoot,null,null)};cC.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Hg(null,e,null,function(){t[sm]=null})};function zv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function QH(e,t){if(t||(t=e?e.nodeType===9?e.documentElement:e.firstChild:null,t=!(!t||t.nodeType!==1||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new cC(e,0,t?{hydrate:!0}:void 0)}function qg(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i._internalRoot;if(typeof a=="function"){var s=a;a=function(){var c=sC(o);s.call(c)}}Hg(t,o,e,a)}else{if(i=r._reactRootContainer=QH(r,n),o=i._internalRoot,typeof a=="function"){var u=a;a=function(){var c=sC(o);u.call(c)}}hD(function(){Hg(t,o,e,a)})}return sC(o)}dE=function(e){if(e.tag===13){var t=ji();Qc(e,4,t),uC(e,4)}};zx=function(e){if(e.tag===13){var t=ji();Qc(e,67108864,t),uC(e,67108864)}};mE=function(e){if(e.tag===13){var t=ji(),r=Kc(e);Qc(e,r,t),uC(e,r)}};pE=function(e,t){return t()};Bx=function(e,t,r){switch(t){case"input":if(wx(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=mg(n);if(!a)throw Error(gt(90));W4(n),wx(n,a)}}}break;case"textarea":Z4(e,r);break;case"select":t=r.value,t!=null&&Qd(e,!!r.multiple,t,!1)}};Fx=vD;oE=function(e,t,r,n,a){var i=Qt;Qt|=4;try{return vf(98,e.bind(null,t,r,n,a))}finally{Qt=i,Qt===0&&(ym(),Ls())}};Ox=function(){(Qt&49)==0&&(kH(),Zc())};sE=function(e,t){var r=Qt;Qt|=2;try{return e(t)}finally{Qt=r,Qt===0&&(ym(),Ls())}};function AD(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zv(t))throw Error(gt(200));return YH(e,t,null,r)}var ZH={Events:[xv,um,mg,aE,iE,Zc,{current:!1}]},Vv={findFiberByHostInstance:df,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},$H={bundleType:Vv.bundleType,version:Vv.version,rendererPackageName:Vv.rendererPackageName,rendererConfig:Vv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:uf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=lE(e),e===null?null:e.stateNode},findFiberByHostInstance:Vv.findFiberByHostInstance||KH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var jg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jg.isDisabled&&jg.supportsFiber)try{pS=jg.inject($H),pf=jg}catch{}}po.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZH;po.createPortal=AD;po.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(gt(188)):Error(gt(268,Object.keys(e)));return e=lE(t),e=e===null?null:e.stateNode,e};po.flushSync=function(e,t){var r=Qt;if((r&48)!=0)return e(t);Qt|=1;try{if(e)return vf(99,e.bind(null,t))}finally{Qt=r,Ls()}};po.hydrate=function(e,t,r){if(!zv(t))throw Error(gt(200));return qg(null,e,t,!0,r)};po.render=function(e,t,r){if(!zv(t))throw Error(gt(200));return qg(null,e,t,!1,r)};po.unmountComponentAtNode=function(e){if(!zv(e))throw Error(gt(40));return e._reactRootContainer?(hD(function(){qg(null,null,e,!1,function(){e._reactRootContainer=null,e[sm]=null})}),!0):!1};po.unstable_batchedUpdates=vD;po.unstable_createPortal=function(e,t){return AD(e,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};po.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!zv(r))throw Error(gt(200));if(e==null||e._reactInternals===void 0)throw Error(gt(38));return qg(e,t,r,!1,n)};po.version="17.0.2";function TD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(TD)}catch(e){console.error(e)}}TD(),k4.exports=po;var GPe=k4.exports;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var lC=function(e,t){return lC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},lC(e,t)};function _t(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");lC(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var I=function(){return I=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},I.apply(this,arguments)};function ie(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(e,t||[])).next())})}function ae(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,a=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(c[0]===6&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Cm(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wg(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,i=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function Ht(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,i;n<a;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function _m(e){return this instanceof _m?(this.v=e,this):new _m(e)}function JH(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),a,i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(d){n[d]&&(a[d]=function(m){return new Promise(function(p,v){i.push([d,m,p,v])>1||s(d,m)})})}function s(d,m){try{u(n[d](m))}catch(p){f(i[0][3],p)}}function u(d){d.value instanceof _m?Promise.resolve(d.value.v).then(c,l):f(i[0][2],d)}function c(d){s("next",d)}function l(d){s("throw",d)}function f(d,m){d(m),i.shift(),i.length&&s(i[0][0],i[0][1])}}function eq(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Cm=="function"?Cm(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(s,u){o=e[i](o),a(s,u,o.done,o.value)})}}function a(i,o,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},o)}}var Pu;(function(e){function t(n){return n}e.create=t;function r(n,a){var i,o;if(a.customDurationMs)return a.customDurationMs;var s=(o=(i=a.definition).getDuration)===null||o===void 0?void 0:o.call(i,a.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(Pu||(Pu={}));var Da;(function(e){function t(a){return a}e.create=t;function r(a,i){return(a&i)!=0}e.has=r;function n(a,i){return!!i&&(a&i)===i}e.hasAll=n})(Da||(Da={}));var mr;(function(e){function t(x){return x===void 0&&(x=512),{current:[],offset:0,capacity:x,chunks:[]}}e.create=t;function r(x){return x.chunks.length?(x.offset>0&&(x.chunks[x.chunks.length]=x.current.length===x.offset?x.current.join(""):x.current.slice(0,x.offset).join("")),x.chunks.join("")):x.current.length===x.offset?x.current.join(""):x.current.splice(0,x.offset).join("")}e.getString=r;function n(x){for(var C=0,_=0,w=x.chunks;_<w.length;_++){var T=w[_];C+=T.length}for(var A=0;A<x.offset;A++)C+=x.current[A].length;return C}e.getSize=n;function a(x){return x.offset>0&&(x.current.length===x.offset?x.chunks[x.chunks.length]=x.current.join(""):x.chunks[x.chunks.length]=x.current.slice(0,x.offset).join(""),x.offset=0),x.chunks}e.getChunks=a;var i=[];(function(){for(var x="",C=0;C<512;C++)i[C]=x,x=x+" "})();function o(x){l(x,`
`)}e.newline=o;function s(x,C){C>0&&l(x,i[C])}e.whitespace=s;function u(x){l(x," ")}e.whitespace1=u;function c(x,C){!C||(x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=C)}e.write=c;function l(x,C){x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=C}e.writeSafe=l;function f(x,C,_){if(!C){s(x,_);return}var w=_-C.length;s(x,w),l(x,C)}e.writePadLeft=f;function d(x,C,_){if(!C){s(x,_);return}var w=_-C.length;l(x,C),s(x,w)}e.writePadRight=d;function m(x,C){l(x,""+C)}e.writeInteger=m;function p(x,C){l(x,""+C+" ")}e.writeIntegerAndSpace=p;function v(x,C,_){var w=""+C,T=_-w.length;s(x,T),l(x,w)}e.writeIntegerPadLeft=v;function h(x,C,_){var w=""+C,T=_-w.length;l(x,w),s(x,T)}e.writeIntegerPadRight=h;function g(x,C,_){l(x,""+Math.round(_*C)/_)}e.writeFloat=g;function y(x,C,_,w){var T=""+Math.round(_*C)/_,A=w-T.length;s(x,A),l(x,T)}e.writeFloatPadLeft=y;function b(x,C,_,w){var T=""+Math.round(_*C)/_,A=w-T.length;l(x,T),s(x,A)}e.writeFloatPadRight=b})(mr||(mr={}));var en=function(){if(typeof window!="undefined"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process!="undefined"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function fC(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),a=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?"".concat(r,"h").concat(n,"m").concat(a,".").concat(i,"s"):n>0?"".concat(n,"m").concat(a,".").concat(i,"s"):a>0?"".concat(a,".").concat(i,"s"):"".concat(e.toFixed(0),"ms")}var zr;(function(e){var t=typeof btoa!="undefined"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+en(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function a(){var o=+new Date+en(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var c=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?c:c&3|8).toString(16)});return s}e.createv4=a;function i(o){return typeof o=="string"}e.is=i})(zr||(zr={}));function tq(e,t){return e-t}function rq(e){return Array.prototype.sort.call(e,tq),e}var PD;(function(e){var t=function(){function m(){this.size=0}return m.prototype.has=function(p){return!1},m.prototype.forEach=function(p,v){return v},m}(),r=function(){function m(p){this.idx=p,this.size=1}return m.prototype.has=function(p){return p===this.idx},m.prototype.forEach=function(p,v){return p(this.idx,v),v},m}(),n=function(){function m(p,v){this.mask=p,this.size=v,this.length=p.length}return m.prototype.has=function(p){return p<this.length&&!!this.mask[p]},m.prototype._forEach=function(p,v){for(var h=0;h<this.length;h++)this.mask[h]&&p(h,v)},m.prototype.forEach=function(p,v){return this._forEach(p,v),v},m}(),a=function(){function m(p){this.size=p}return m.prototype.has=function(p){return!0},m.prototype._forEach=function(p,v){for(var h=0;h<this.size;h++)p(h,v)},m.prototype.forEach=function(p,v){return this._forEach(p,v),v},m}(),i=function(){function m(p){this.set=p,this._flat=void 0,this.size=p.size}return m.prototype.has=function(p){return this.set.has(p)},m.prototype._forEach=function(p,v){for(var h=0,g=this.flatten();h<g.length;h++){var y=g[h];p(y,v)}},m.prototype.flatten=function(){if(this._flat)return this._flat;var p=new Int32Array(this.size),v=0;return this.set.forEach(function(h){return p[v++]=h}),rq(p),this._flat=p,this._flat},m.prototype.forEach=function(p,v){return this._forEach(p,v),v},m}();function o(m){return new a(m)}e.always=o,e.never=new t;function s(m){return new i(m)}e.ofSet=s;function u(m){return new r(m)}e.singleton=u;function c(m){var p=m.length;if(p===0)return new t;if(p===1)return new r(m[0]);for(var v=0,h=0,g=m;h<g.length;h++){var y=g[h];y>v&&(v=y)}if(p===v)return new a(p);var b=p/v;if(b<1/12){for(var x=new Set,C=0,_=m;C<_.length;C++){var y=_[C];x.add(y)}return new i(x)}for(var w=new Int8Array(v+1),T=0,A=m;T<A.length;T++){var y=A[T];w[y]=1}return new n(w,m.length)}e.ofUniqueIndices=c;function l(m,p){return new n(m,p)}e.ofMask=l;function f(m,p){for(var v=0,h=p;v<h.length;v++){var g=h[v];if(m.has(g))return!0}return!1}e.hasAny=f;function d(m,p){var v=0,h=0;if(p.forEach(function(b){m.has(b)||(v++,b>h&&(h=b))}),v/h<1/12){var g=new Set;return p.forEach(function(b){m.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(h+1);return p.forEach(function(b){m.has(b)||(y[b]=1)}),l(y,v)}}e.complement=d})(PD||(PD={}));function ja(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var Gv;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,a){return n.ref=a,n}e.set=r})(Gv||(Gv={}));var nq=ja(0,2147483647),el;(function(e){function t(n,a){return{id:nq(),version:0,value:n,metadata:a}}e.create=t;function r(n,a){return{id:n.id,version:n.version+1,value:a,metadata:n.metadata}}e.withValue=r})(el||(el={}));var R;(function(e){function t(i,o){return Gv.create(el.create(i,o))}e.create=t;function r(i,o){return Gv.set(i,el.withValue(i.ref,o))}e.update=r;function n(i,o){return Gv.set(i,o)}e.set=n;function a(i,o){return i.ref.value!==o?r(i,o):i}e.updateIfChanged=a})(R||(R={}));var dC=function(){};function li(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var ED=Object.prototype.hasOwnProperty;function Eu(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!Eu(e[a],t[a]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,c=t instanceof RegExp;if(u&&c)return e.toString()===t.toString();if(u!==c)return!1;for(var a=0;a<i.length;a++)if(!ED.call(t,i[a]))return!1;for(var a=0;a<i.length;a++)if(!Eu(e[i[a]],t[i[a]]))return!1;return!0}return!1}function Hv(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?aq(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Xg(e,t):!1}function Xg(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!ED.call(e,i)||e[i]!==t[i])return!1}return!0}function aq(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function jn(e,t){return e!==void 0?e:t}var rn;(function(e){function t(){return function(a){return r(a)}}e.factory=t;function r(a){var i;return i=function(){function o(s,u){this.data=s,this.id=zr.create22(),this.type=a,this.label=u&&u.label||a.name,this.description=u&&u.description}return o.is=function(s){return!!s&&a===s.type},o}(),i.type=a,i}e.create=r;function n(a,i){if(!a.tags)return!1;for(var o=0,s=a.tags;o<s.length;o++){var u=s[o];if(u===i)return!0}return!1}e.hasTag=n,e.Null={id:zr.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(rn||(rn={}));var qv;(function(e){function t(n){var a=n;return!!a&&!!a.transform&&!!a.parent&&!!a.status}e.is=t;function r(n,a){var i=typeof a=="string"?a:e.is(a)?a.transform.ref:a.ref;return n.cells.get(i)}e.resolve=r})(qv||(qv={}));var ID=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===rn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==rn.Null},enumerable:!1,configurable:!0}),e}(),ia;(function(e){function t(a){var i;if(!!a)return typeof a=="string"?a:qv.is(a)?a.transform.ref:(i=a.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(a,i){if(!!i)return qv.is(i)?i:typeof i=="string"?a.cells.get(i):i.cell}e.resolve=r;function n(a,i){var o=r(a,i);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(ia||(ia={}));var Yg="delete",ln=5,xo=1<<ln,fi=xo-1,Er={};function mC(){return{value:!1}}function So(e){e&&(e.value=!0)}function pC(){}function wm(e){return e.size===void 0&&(e.size=e.__iterate(DD)),e.size}function tl(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?wm(e)+t:t}function DD(){return!0}function Kg(e,t,r){return(e===0&&!RD(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function jv(e,t){return MD(e,t,0)}function Qg(e,t){return MD(e,t,t)}function MD(e,t,r){return e===void 0?r:RD(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function RD(e){return e<0||e===0&&1/e==-1/0}var BD="@@__IMMUTABLE_ITERABLE__@@";function Ti(e){return Boolean(e&&e[BD])}var FD="@@__IMMUTABLE_KEYED__@@";function Tn(e){return Boolean(e&&e[FD])}var OD="@@__IMMUTABLE_INDEXED__@@";function Pi(e){return Boolean(e&&e[OD])}function Zg(e){return Tn(e)||Pi(e)}var Nn=function(t){return Ti(t)?t:Wi(t)},os=function(e){function t(r){return Tn(r)?r:rl(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Nn),Sf=function(e){function t(r){return Pi(r)?r:ls(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Nn),Am=function(e){function t(r){return Ti(r)&&!Zg(r)?r:Em(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Nn);Nn.Keyed=os;Nn.Indexed=Sf;Nn.Set=Am;var kD="@@__IMMUTABLE_SEQ__@@";function vC(e){return Boolean(e&&e[kD])}var iq="@@__IMMUTABLE_RECORD__@@";function hC(e){return Boolean(e&&e[iq])}function Iu(e){return Ti(e)||hC(e)}var Tm="@@__IMMUTABLE_ORDERED__@@";function ss(e){return Boolean(e&&e[Tm])}var Wv=0,us=1,cs=2,gC=typeof Symbol=="function"&&Symbol.iterator,LD="@@iterator",yC=gC||LD,Vr=function(t){this.next=t};Vr.prototype.toString=function(){return"[Iterator]"};Vr.KEYS=Wv;Vr.VALUES=us;Vr.ENTRIES=cs;Vr.prototype.inspect=Vr.prototype.toSource=function(){return this.toString()};Vr.prototype[yC]=function(){return this};function hn(e,t,r,n){var a=e===0?t:e===1?r:[t,r];return n?n.value=a:n={value:a,done:!1},n}function Ei(){return{value:void 0,done:!0}}function ND(e){return Array.isArray(e)?!0:!!$g(e)}function UD(e){return e&&typeof e.next=="function"}function bC(e){var t=$g(e);return t&&t.call(e)}function $g(e){var t=e&&(gC&&e[gC]||e[LD]);if(typeof t=="function")return t}function oq(e){var t=$g(e);return t&&t===e.entries}function sq(e){var t=$g(e);return t&&t===e.keys}var Pm=Object.prototype.hasOwnProperty;function zD(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var Wi=function(e){function t(r){return r==null?SC():Iu(r)?r.toSeq():cq(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,a){var i=this._cache;if(i){for(var o=i.length,s=0;s!==o;){var u=i[a?o-++s:s++];if(n(u[1],u[0],this)===!1)break}return s}return this.__iterateUncached(n,a)},t.prototype.__iterator=function(n,a){var i=this._cache;if(i){var o=i.length,s=0;return new Vr(function(){if(s===o)return Ei();var u=i[a?o-++s:s++];return hn(n,u[0],u[1])})}return this.__iteratorUncached(n,a)},t}(Nn),rl=function(e){function t(r){return r==null?SC().toKeyedSeq():Ti(r)?Tn(r)?r.toSeq():r.fromEntrySeq():hC(r)?r.toSeq():GD(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(Wi),ls=function(e){function t(r){return r==null?SC():Ti(r)?Tn(r)?r.entrySeq():r.toIndexedSeq():hC(r)?r.toSeq().entrySeq():HD(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(Wi),Em=function(e){function t(r){return(Ti(r)&&!Zg(r)?r:ls(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(Wi);Wi.isSeq=vC;Wi.Keyed=rl;Wi.Set=Em;Wi.Indexed=ls;Wi.prototype[kD]=!0;var Cf=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return this.has(n)?this._array[tl(this,n)]:a},t.prototype.__iterate=function(n,a){for(var i=this._array,o=i.length,s=0;s!==o;){var u=a?o-++s:s++;if(n(i[u],u,this)===!1)break}return s},t.prototype.__iterator=function(n,a){var i=this._array,o=i.length,s=0;return new Vr(function(){if(s===o)return Ei();var u=a?o-++s:s++;return hn(n,u,i[u])})},t}(ls),xC=function(e){function t(r){var n=Object.keys(r);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return a!==void 0&&!this.has(n)?a:this._object[n]},t.prototype.has=function(n){return Pm.call(this._object,n)},t.prototype.__iterate=function(n,a){for(var i=this._object,o=this._keys,s=o.length,u=0;u!==s;){var c=o[a?s-++u:u++];if(n(i[c],c,this)===!1)break}return u},t.prototype.__iterator=function(n,a){var i=this._object,o=this._keys,s=o.length,u=0;return new Vr(function(){if(u===s)return Ei();var c=o[a?s-++u:u++];return hn(n,c,i[c])})},t}(rl);xC.prototype[Tm]=!0;var uq=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,a){if(a)return this.cacheResult().__iterate(n,a);var i=this._collection,o=bC(i),s=0;if(UD(o))for(var u;!(u=o.next()).done&&n(u.value,s++,this)!==!1;);return s},t.prototype.__iteratorUncached=function(n,a){if(a)return this.cacheResult().__iterator(n,a);var i=this._collection,o=bC(i);if(!UD(o))return new Vr(Ei);var s=0;return new Vr(function(){var u=o.next();return u.done?u:hn(n,s++,u.value)})},t}(ls),VD;function SC(){return VD||(VD=new Cf([]))}function GD(e){var t=CC(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new xC(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function HD(e){var t=CC(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function cq(e){var t=CC(e);if(t)return oq(e)?t.fromEntrySeq():sq(e)?t.toSetSeq():t;if(typeof e=="object")return new xC(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function CC(e){return zD(e)?new Cf(e):ND(e)?new uq(e):void 0}var qD="@@__IMMUTABLE_MAP__@@";function _C(e){return Boolean(e&&e[qD])}function jD(e){return _C(e)&&ss(e)}function WD(e){return Boolean(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function Xi(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(WD(e)&&WD(t)&&e.equals(t))}var Xv=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,a=r&65535;return n*a+((t>>>16)*a+n*(r>>>16)<<16>>>0)|0};function Jg(e){return e>>>1&1073741824|e&3221225471}var lq=Object.prototype.valueOf;function Yi(e){if(e==null)return XD(e);if(typeof e.hashCode=="function")return Jg(e.hashCode(e));var t=hq(e);if(t==null)return XD(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return fq(t);case"string":return t.length>gq?dq(t):wC(t);case"object":case"function":return pq(t);case"symbol":return mq(t);default:if(typeof t.toString=="function")return wC(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function XD(e){return e===null?1108378658:1108378659}function fq(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return Jg(t)}function dq(e){var t=IC[e];return t===void 0&&(t=wC(e),EC===yq&&(EC=0,IC={}),EC++,IC[e]=t),t}function wC(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return Jg(t)}function mq(e){var t=ZD[e];return t!==void 0||(t=QD(),ZD[e]=t),t}function pq(e){var t;if(AC&&(t=TC.get(e),t!==void 0)||(t=e[_f],t!==void 0)||!KD&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[_f],t!==void 0||(t=vq(e),t!==void 0)))return t;if(t=QD(),AC)TC.set(e,t);else{if(YD!==void 0&&YD(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(KD)Object.defineProperty(e,_f,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[_f]=t;else if(e.nodeType!==void 0)e[_f]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var YD=Object.isExtensible,KD=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function vq(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function hq(e){return e.valueOf!==lq&&typeof e.valueOf=="function"?e.valueOf(e):e}function QD(){var e=++PC;return PC&1073741824&&(PC=0),e}var AC=typeof WeakMap=="function",TC;AC&&(TC=new WeakMap);var ZD=Object.create(null),PC=0,_f="__immutablehash__";typeof Symbol=="function"&&(_f=Symbol(_f));var gq=16,yq=255,EC=0,IC={},ey=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,a){return this._iter.get(n,a)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,a=DC(this,!0);return this._useKeys||(a.valueSeq=function(){return n._iter.toSeq().reverse()}),a},t.prototype.map=function(n,a){var i=this,o=r5(this,n,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(n,a)}),o},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o,s){return n(o,s,i)},a)},t.prototype.__iterator=function(n,a){return this._iter.__iterator(n,a)},t}(rl);ey.prototype[Tm]=!0;var $D=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this,o=0;return a&&wm(this),this._iter.__iterate(function(s){return n(s,a?i.size-++o:o++,i)},a)},t.prototype.__iterator=function(n,a){var i=this,o=this._iter.__iterator(us,a),s=0;return a&&wm(this),new Vr(function(){var u=o.next();return u.done?u:hn(n,a?i.size-++s:s++,u.value,u)})},t}(ls),JD=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(us,a);return new Vr(function(){var o=i.next();return o.done?o:hn(n,o.value,o.value,o)})},t}(Em),e5=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,a){var i=this;return this._iter.__iterate(function(o){if(o){s5(o);var s=Ti(o);return n(s?o.get(1):o[1],s?o.get(0):o[0],i)}},a)},t.prototype.__iterator=function(n,a){var i=this._iter.__iterator(us,a);return new Vr(function(){for(;;){var o=i.next();if(o.done)return o;var s=o.value;if(s){s5(s);var u=Ti(s);return hn(n,u?s.get(0):s[0],u?s.get(1):s[1],o)}}})},t}(rl);$D.prototype.cacheResult=ey.prototype.cacheResult=JD.prototype.cacheResult=e5.prototype.cacheResult=RC;function t5(e){var t=Gs(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=RC,t.__iterateUncached=function(r,n){var a=this;return e.__iterate(function(i,o){return r(o,i,a)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===cs){var a=e.__iterator(r,n);return new Vr(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return e.__iterator(r===us?Wv:us,n)},t}function r5(e,t,r){var n=Gs(e);return n.size=e.size,n.has=function(a){return e.has(a)},n.get=function(a,i){var o=e.get(a,Er);return o===Er?i:t.call(r,o,a,e)},n.__iterateUncached=function(a,i){var o=this;return e.__iterate(function(s,u,c){return a(t.call(r,s,u,c),u,o)!==!1},i)},n.__iteratorUncached=function(a,i){var o=e.__iterator(cs,i);return new Vr(function(){var s=o.next();if(s.done)return s;var u=s.value,c=u[0];return hn(a,c,t.call(r,u[1],c,e),s)})},n}function DC(e,t){var r=this,n=Gs(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var a=t5(e);return a.reverse=function(){return e.flip()},a}),n.get=function(a,i){return e.get(t?a:-1-a,i)},n.has=function(a){return e.has(t?a:-1-a)},n.includes=function(a){return e.includes(a)},n.cacheResult=RC,n.__iterate=function(a,i){var o=this,s=0;return i&&wm(e),e.__iterate(function(u,c){return a(u,t?c:i?o.size-++s:s++,o)},!i)},n.__iterator=function(a,i){var o=0;i&&wm(e);var s=e.__iterator(cs,!i);return new Vr(function(){var u=s.next();if(u.done)return u;var c=u.value;return hn(a,t?c[0]:i?r.size-++o:o++,c[1],u)})},n}function n5(e,t,r,n){var a=Gs(e);return n&&(a.has=function(i){var o=e.get(i,Er);return o!==Er&&!!t.call(r,o,i,e)},a.get=function(i,o){var s=e.get(i,Er);return s!==Er&&t.call(r,s,i,e)?s:o}),a.__iterateUncached=function(i,o){var s=this,u=0;return e.__iterate(function(c,l,f){if(t.call(r,c,l,f))return u++,i(c,n?l:u-1,s)},o),u},a.__iteratorUncached=function(i,o){var s=e.__iterator(cs,o),u=0;return new Vr(function(){for(;;){var c=s.next();if(c.done)return c;var l=c.value,f=l[0],d=l[1];if(t.call(r,d,f,e))return hn(i,n?f:u++,d,c)}})},a}function bq(e,t,r){var n=_o().asMutable();return e.__iterate(function(a,i){n.update(t.call(r,a,i,e),0,function(o){return o+1})}),n.asImmutable()}function xq(e,t,r){var n=Tn(e),a=(ss(e)?ds():_o()).asMutable();e.__iterate(function(o,s){a.update(t.call(r,o,s,e),function(u){return u=u||[],u.push(n?[s,o]:o),u})});var i=u5(e);return a.map(function(o){return nn(e,i(o))}).asImmutable()}function MC(e,t,r,n){var a=e.size;if(Kg(t,r,a))return e;var i=jv(t,a),o=Qg(r,a);if(i!==i||o!==o)return MC(e.toSeq().cacheResult(),t,r,n);var s=o-i,u;s===s&&(u=s<0?0:s);var c=Gs(e);return c.size=u===0?u:e.size&&u||void 0,!n&&vC(e)&&u>=0&&(c.get=function(l,f){return l=tl(this,l),l>=0&&l<u?e.get(l+i,f):f}),c.__iterateUncached=function(l,f){var d=this;if(u===0)return 0;if(f)return this.cacheResult().__iterate(l,f);var m=0,p=!0,v=0;return e.__iterate(function(h,g){if(!(p&&(p=m++<i)))return v++,l(h,n?g:v-1,d)!==!1&&v!==u}),v},c.__iteratorUncached=function(l,f){if(u!==0&&f)return this.cacheResult().__iterator(l,f);if(u===0)return new Vr(Ei);var d=e.__iterator(l,f),m=0,p=0;return new Vr(function(){for(;m++<i;)d.next();if(++p>u)return Ei();var v=d.next();return n||l===us||v.done?v:l===Wv?hn(l,p-1,void 0,v):hn(l,p-1,v.value[1],v)})},c}function Sq(e,t,r){var n=Gs(e);return n.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var s=0;return e.__iterate(function(u,c,l){return t.call(r,u,c,l)&&++s&&a(u,c,o)}),s},n.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var s=e.__iterator(cs,i),u=!0;return new Vr(function(){if(!u)return Ei();var c=s.next();if(c.done)return c;var l=c.value,f=l[0],d=l[1];return t.call(r,d,f,o)?a===cs?c:hn(a,f,d,c):(u=!1,Ei())})},n}function a5(e,t,r,n){var a=Gs(e);return a.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var u=!0,c=0;return e.__iterate(function(l,f,d){if(!(u&&(u=t.call(r,l,f,d))))return c++,i(l,n?f:c-1,s)}),c},a.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var u=e.__iterator(cs,o),c=!0,l=0;return new Vr(function(){var f,d,m;do{if(f=u.next(),f.done)return n||i===us?f:i===Wv?hn(i,l++,void 0,f):hn(i,l++,f.value[1],f);var p=f.value;d=p[0],m=p[1],c&&(c=t.call(r,m,d,s))}while(c);return i===cs?f:hn(i,d,m,f)})},a}function Cq(e,t){var r=Tn(e),n=[e].concat(t).map(function(o){return Ti(o)?r&&(o=os(o)):o=r?GD(o):HD(Array.isArray(o)?o:[o]),o}).filter(function(o){return o.size!==0});if(n.length===0)return e;if(n.length===1){var a=n[0];if(a===e||r&&Tn(a)||Pi(e)&&Pi(a))return a}var i=new Cf(n);return r?i=i.toKeyedSeq():Pi(e)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=n.reduce(function(o,s){if(o!==void 0){var u=s.size;if(u!==void 0)return o+u}},0),i}function i5(e,t,r){var n=Gs(e);return n.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,s=!1;function u(c,l){c.__iterate(function(f,d){return(!t||l<t)&&Ti(f)?u(f,l+1):(o++,a(f,r?d:o-1,n)===!1&&(s=!0)),!s},i)}return u(e,0),o},n.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=e.__iterator(a,i),s=[],u=0;return new Vr(function(){for(;o;){var c=o.next();if(c.done!==!1){o=s.pop();continue}var l=c.value;if(a===cs&&(l=l[1]),(!t||s.length<t)&&Ti(l))s.push(o),o=l.__iterator(a,i);else return r?c:hn(a,u++,l,c)}return Ei()})},n}function _q(e,t,r){var n=u5(e);return e.toSeq().map(function(a,i){return n(t.call(r,a,i,e))}).flatten(!0)}function wq(e,t){var r=Gs(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,a){var i=this,o=0;return e.__iterate(function(s){return(!o||n(t,o++,i)!==!1)&&n(s,o++,i)!==!1},a),o},r.__iteratorUncached=function(n,a){var i=e.__iterator(us,a),o=0,s;return new Vr(function(){return(!s||o%2)&&(s=i.next(),s.done)?s:o%2?hn(n,o++,t):hn(n,o++,s.value,s)})},r}function Im(e,t,r){t||(t=c5);var n=Tn(e),a=0,i=e.toSeq().map(function(o,s){return[s,o,a++,r?r(o,s,e):o]}).valueSeq().toArray();return i.sort(function(o,s){return t(o[3],s[3])||o[2]-s[2]}).forEach(n?function(o,s){i[s].length=2}:function(o,s){i[s]=o[1]}),n?rl(i):Pi(e)?ls(i):Em(i)}function ty(e,t,r){if(t||(t=c5),r){var n=e.toSeq().map(function(a,i){return[a,r(a,i,e)]}).reduce(function(a,i){return o5(t,a[1],i[1])?i:a});return n&&n[0]}return e.reduce(function(a,i){return o5(t,a,i)?i:a})}function o5(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function ry(e,t,r,n){var a=Gs(e),i=new Cf(r).map(function(o){return o.size});return a.size=n?i.max():i.min(),a.__iterate=function(o,s){for(var u=this.__iterator(us,s),c,l=0;!(c=u.next()).done&&o(c.value,l++,this)!==!1;);return l},a.__iteratorUncached=function(o,s){var u=r.map(function(f){return f=Nn(f),bC(s?f.reverse():f)}),c=0,l=!1;return new Vr(function(){var f;return l||(f=u.map(function(d){return d.next()}),l=n?f.every(function(d){return d.done}):f.some(function(d){return d.done})),l?Ei():hn(o,c++,t.apply(null,f.map(function(d){return d.value})))})},a}function nn(e,t){return e===t?e:vC(e)?t:e.constructor(t)}function s5(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function u5(e){return Tn(e)?os:Pi(e)?Sf:Am}function Gs(e){return Object.create((Tn(e)?rl:Pi(e)?ls:Em).prototype)}function RC(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Wi.prototype.cacheResult.call(this)}function c5(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function Hs(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),a=0;a<r;a++)n[a]=e[a+t];return n}function l5(e,t){if(!e)throw new Error(t)}function Co(e){l5(e!==1/0,"Cannot perform this action with an infinite size.")}function f5(e){if(zD(e)&&typeof e!="string")return e;if(ss(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}var Aq=Object.prototype.toString;function Tq(e){if(!e||typeof e!="object"||Aq.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function nl(e){return typeof e=="object"&&(Iu(e)||Array.isArray(e)||Tq(e))}function ny(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function Pq(e,t){return Iu(e)?e.has(t):nl(e)&&Pm.call(e,t)}function d5(e,t,r){return Iu(e)?e.get(t,r):Pq(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function ay(e){if(Array.isArray(e))return Hs(e);var t={};for(var r in e)Pm.call(e,r)&&(t[r]=e[r]);return t}function Eq(e,t){if(!nl(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Iu(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!Pm.call(e,t))return e;var r=ay(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function Iq(e,t,r){if(!nl(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Iu(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(Pm.call(e,t)&&r===e[t])return e;var n=ay(e);return n[t]=r,n}function Dm(e,t,r,n){n||(n=r,r=void 0);var a=m5(Iu(e),e,f5(t),0,r,n);return a===Er?r:a}function m5(e,t,r,n,a,i){var o=t===Er;if(n===r.length){var s=o?a:t,u=i(s);return u===s?t:u}if(!o&&!nl(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(ny)+"]: "+t);var c=r[n],l=o?Er:d5(t,c,Er),f=m5(l===Er?e:Iu(l),l,r,n+1,a,i);return f===l?t:f===Er?Eq(t,c):Iq(o?e?fs():{}:t,c,f)}function Dq(e,t,r){return Dm(e,t,Er,function(){return r})}function p5(e,t){return Dq(this,e,t)}function Mq(e,t){return Dm(e,t,function(){return Er})}function v5(e){return Mq(this,e)}function h5(e,t,r,n){return Dm(e,[t],r,n)}function g5(e,t,r){return arguments.length===1?e(this):h5(this,e,t,r)}function y5(e,t,r){return Dm(this,e,t,r)}function Rq(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return b5(this,e)}function Bq(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return b5(this,t,e)}function b5(e,t,r){for(var n=[],a=0;a<t.length;a++){var i=os(t[a]);i.size!==0&&n.push(i)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?e.constructor(n[0]):e.withMutations(function(o){for(var s=r?function(c,l){h5(o,l,Er,function(f){return f===Er?c:r(f,c,l)})}:function(c,l){o.set(l,c)},u=0;u<n.length;u++)n[u].forEach(s)})}function BC(e,t,r){return FC(e,t,Fq(r))}function FC(e,t,r){if(!nl(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Iu(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),a=e,i=n?Sf:os,o=n?function(u){a===e&&(a=ay(a)),a.push(u)}:function(u,c){var l=Pm.call(a,c),f=l&&r?r(a[c],u,c):u;(!l||f!==a[c])&&(a===e&&(a=ay(a)),a[c]=f)},s=0;s<t.length;s++)i(t[s]).forEach(o);return a}function Fq(e){function t(r,n,a){return nl(r)&&nl(n)&&Oq(r,n)?FC(r,[n],t):e?e(r,n,a):n}return t}function Oq(e,t){var r=Wi(e),n=Wi(t);return Pi(r)===Pi(n)&&Tn(r)===Tn(n)}function kq(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return BC(this,e)}function Lq(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return BC(this,t,e)}function x5(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Dm(this,e,fs(),function(n){return FC(n,t)})}function S5(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Dm(this,e,fs(),function(n){return BC(n,t)})}function iy(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function oy(){return this.__ownerID?this:this.__ensureOwner(new pC)}function sy(){return this.__ensureOwner()}function OC(){return this.__altered}var _o=function(e){function t(r){return r==null?fs():_C(r)&&!ss(r)?r:fs().withMutations(function(n){var a=e(r);Co(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return fs().withMutations(function(i){for(var o=0;o<n.length;o+=2){if(o+1>=n.length)throw new Error("Missing value for key: "+n[o]);i.set(n[o],n[o+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,a){return this._root?this._root.get(0,void 0,n,a):a},t.prototype.set=function(n,a){return w5(this,n,a)},t.prototype.remove=function(n){return w5(this,n,Er)},t.prototype.deleteAll=function(n){var a=Nn(n);return a.size===0?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):fs()},t.prototype.sort=function(n){return ds(Im(this,n))},t.prototype.sortBy=function(n,a){return ds(Im(this,a,n))},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){o.forEach(function(s,u){o.set(u,n.call(a,s,u,i))})})},t.prototype.__iterator=function(n,a){return new Nq(this,n,a)},t.prototype.__iterate=function(n,a){var i=this,o=0;return this._root&&this._root.iterate(function(s){return o++,n(s[1],s[0],i)},a),o},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?LC(this.size,this._root,n,this.__hash):this.size===0?fs():(this.__ownerID=n,this.__altered=!1,this)},t}(os);_o.isMap=_C;var fn=_o.prototype;fn[qD]=!0;fn[Yg]=fn.remove;fn.removeAll=fn.deleteAll;fn.setIn=p5;fn.removeIn=fn.deleteIn=v5;fn.update=g5;fn.updateIn=y5;fn.merge=fn.concat=Rq;fn.mergeWith=Bq;fn.mergeDeep=kq;fn.mergeDeepWith=Lq;fn.mergeIn=x5;fn.mergeDeepIn=S5;fn.withMutations=iy;fn.wasAltered=OC;fn.asImmutable=sy;fn["@@transducer/init"]=fn.asMutable=oy;fn["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};fn["@@transducer/result"]=function(e){return e.asImmutable()};var Yv=function(t,r){this.ownerID=t,this.entries=r};Yv.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(Xi(n,i[o][0]))return i[o][1];return a};Yv.prototype.update=function(t,r,n,a,i,o,s){for(var u=i===Er,c=this.entries,l=0,f=c.length;l<f&&!Xi(a,c[l][0]);l++);var d=l<f;if(d?c[l][1]===i:u)return this;if(So(s),(u||!d)&&So(o),!(u&&c.length===1)){if(!d&&!u&&c.length>=qq)return Uq(t,c,a,i);var m=t&&t===this.ownerID,p=m?c:Hs(c);return d?u?l===f-1?p.pop():p[l]=p.pop():p[l]=[a,i]:p.push([a,i]),m?(this.entries=p,this):new Yv(t,p)}};var Mm=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};Mm.prototype.get=function(t,r,n,a){r===void 0&&(r=Yi(n));var i=1<<((t===0?r:r>>>t)&fi),o=this.bitmap;return(o&i)==0?a:this.nodes[T5(o&i-1)].get(t+ln,r,n,a)};Mm.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=Yi(a));var u=(r===0?n:n>>>r)&fi,c=1<<u,l=this.bitmap,f=(l&c)!=0;if(!f&&i===Er)return this;var d=T5(l&c-1),m=this.nodes,p=f?m[d]:void 0,v=NC(p,t,r+ln,n,a,i,o,s);if(v===p)return this;if(!f&&v&&m.length>=jq)return Vq(t,m,l,u,v);if(f&&!v&&m.length===2&&A5(m[d^1]))return m[d^1];if(f&&v&&m.length===1&&A5(v))return v;var h=t&&t===this.ownerID,g=f?v?l:l^c:l|c,y=f?v?P5(m,d,v,h):Hq(m,d,h):Gq(m,d,v,h);return h?(this.bitmap=g,this.nodes=y,this):new Mm(t,g,y)};var Kv=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};Kv.prototype.get=function(t,r,n,a){r===void 0&&(r=Yi(n));var i=(t===0?r:r>>>t)&fi,o=this.nodes[i];return o?o.get(t+ln,r,n,a):a};Kv.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=Yi(a));var u=(r===0?n:n>>>r)&fi,c=i===Er,l=this.nodes,f=l[u];if(c&&!f)return this;var d=NC(f,t,r+ln,n,a,i,o,s);if(d===f)return this;var m=this.count;if(!f)m++;else if(!d&&(m--,m<Wq))return zq(t,l,m,u);var p=t&&t===this.ownerID,v=P5(l,u,d,p);return p?(this.count=m,this.nodes=v,this):new Kv(t,m,v)};var Rm=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};Rm.prototype.get=function(t,r,n,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(Xi(n,i[o][0]))return i[o][1];return a};Rm.prototype.update=function(t,r,n,a,i,o,s){n===void 0&&(n=Yi(a));var u=i===Er;if(n!==this.keyHash)return u?this:(So(s),So(o),UC(this,t,r,n,[a,i]));for(var c=this.entries,l=0,f=c.length;l<f&&!Xi(a,c[l][0]);l++);var d=l<f;if(d?c[l][1]===i:u)return this;if(So(s),(u||!d)&&So(o),u&&f===2)return new Du(t,this.keyHash,c[l^1]);var m=t&&t===this.ownerID,p=m?c:Hs(c);return d?u?l===f-1?p.pop():p[l]=p.pop():p[l]=[a,i]:p.push([a,i]),m?(this.entries=p,this):new Rm(t,this.keyHash,p)};var Du=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};Du.prototype.get=function(t,r,n,a){return Xi(n,this.entry[0])?this.entry[1]:a};Du.prototype.update=function(t,r,n,a,i,o,s){var u=i===Er,c=Xi(a,this.entry[0]);if(c?i===this.entry[1]:u)return this;if(So(s),u){So(o);return}return c?t&&t===this.ownerID?(this.entry[1]=i,this):new Du(t,this.keyHash,[a,i]):(So(o),UC(this,t,r,Yi(a),[a,i]))};Yv.prototype.iterate=Rm.prototype.iterate=function(e,t){for(var r=this.entries,n=0,a=r.length-1;n<=a;n++)if(e(r[t?a-n:n])===!1)return!1};Mm.prototype.iterate=Kv.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,a=r.length-1;n<=a;n++){var i=r[t?a-n:n];if(i&&i.iterate(e,t)===!1)return!1}};Du.prototype.iterate=function(e,t){return e(this.entry)};var Nq=function(e){function t(r,n,a){this._type=n,this._reverse=a,this._stack=r._root&&C5(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,a=this._stack;a;){var i=a.node,o=a.index++,s=void 0;if(i.entry){if(o===0)return kC(n,i.entry)}else if(i.entries){if(s=i.entries.length-1,o<=s)return kC(n,i.entries[this._reverse?s-o:o])}else if(s=i.nodes.length-1,o<=s){var u=i.nodes[this._reverse?s-o:o];if(u){if(u.entry)return kC(n,u.entry);a=this._stack=C5(u,a)}continue}a=this._stack=this._stack.__prev}return Ei()},t}(Vr);function kC(e,t){return hn(e,t[0],t[1])}function C5(e,t){return{node:e,index:0,__prev:t}}function LC(e,t,r,n){var a=Object.create(fn);return a.size=e,a._root=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var _5;function fs(){return _5||(_5=LC(0))}function w5(e,t,r){var n,a;if(e._root){var i=mC(),o=mC();if(n=NC(e._root,e.__ownerID,0,void 0,t,r,i,o),!o.value)return e;a=e.size+(i.value?r===Er?-1:1:0)}else{if(r===Er)return e;a=1,n=new Yv(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=a,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?LC(a,n):fs()}function NC(e,t,r,n,a,i,o,s){return e?e.update(t,r,n,a,i,o,s):i===Er?e:(So(s),So(o),new Du(t,n,[a,i]))}function A5(e){return e.constructor===Du||e.constructor===Rm}function UC(e,t,r,n,a){if(e.keyHash===n)return new Rm(t,n,[e.entry,a]);var i=(r===0?e.keyHash:e.keyHash>>>r)&fi,o=(r===0?n:n>>>r)&fi,s,u=i===o?[UC(e,t,r+ln,n,a)]:(s=new Du(t,n,a),i<o?[e,s]:[s,e]);return new Mm(t,1<<i|1<<o,u)}function Uq(e,t,r,n){e||(e=new pC);for(var a=new Du(e,Yi(r),[r,n]),i=0;i<t.length;i++){var o=t[i];a=a.update(e,0,void 0,o[0],o[1])}return a}function zq(e,t,r,n){for(var a=0,i=0,o=new Array(r),s=0,u=1,c=t.length;s<c;s++,u<<=1){var l=t[s];l!==void 0&&s!==n&&(a|=u,o[i++]=l)}return new Mm(e,a,o)}function Vq(e,t,r,n,a){for(var i=0,o=new Array(xo),s=0;r!==0;s++,r>>>=1)o[s]=r&1?t[i++]:void 0;return o[n]=a,new Kv(e,i+1,o)}function T5(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function P5(e,t,r,n){var a=n?e:Hs(e);return a[t]=r,a}function Gq(e,t,r,n){var a=e.length+1;if(n&&t+1===a)return e[t]=r,e;for(var i=new Array(a),o=0,s=0;s<a;s++)s===t?(i[s]=r,o=-1):i[s]=e[s+o];return i}function Hq(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var a=new Array(n),i=0,o=0;o<n;o++)o===t&&(i=1),a[o]=e[o+i];return a}var qq=xo/4,jq=xo/2,Wq=xo/4,E5="@@__IMMUTABLE_LIST__@@";function I5(e){return Boolean(e&&e[E5])}var wf=function(e){function t(r){var n=uy();if(r==null)return n;if(I5(r))return r;var a=e(r),i=a.size;return i===0?n:(Co(i),i>0&&i<xo?Zv(0,i,ln,null,new al(a.toArray())):n.withMutations(function(o){o.setSize(i),a.forEach(function(s,u){return o.set(u,s)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,a){if(n=tl(this,n),n>=0&&n<this.size){n+=this._origin;var i=R5(this,n);return i&&i.array[n&fi]}return a},t.prototype.set=function(n,a){return Xq(this,n,a)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,a){return this.splice(n,0,a)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=ln,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):uy()},t.prototype.push=function(){var n=arguments,a=this.size;return this.withMutations(function(i){il(i,0,a+n.length);for(var o=0;o<n.length;o++)i.set(a+o,n[o])})},t.prototype.pop=function(){return il(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(a){il(a,-n.length);for(var i=0;i<n.length;i++)a.set(i,n[i])})},t.prototype.shift=function(){return il(this,1)},t.prototype.concat=function(){for(var n=arguments,a=[],i=0;i<arguments.length;i++){var o=n[i],s=e(typeof o!="string"&&ND(o)?o:[o]);s.size!==0&&a.push(s)}return a.length===0?this:this.size===0&&!this.__ownerID&&a.length===1?this.constructor(a[0]):this.withMutations(function(u){a.forEach(function(c){return c.forEach(function(l){return u.push(l)})})})},t.prototype.setSize=function(n){return il(this,0,n)},t.prototype.map=function(n,a){var i=this;return this.withMutations(function(o){for(var s=0;s<i.size;s++)o.set(s,n.call(a,o.get(s),s,i))})},t.prototype.slice=function(n,a){var i=this.size;return Kg(n,a,i)?this:il(this,jv(n,i),Qg(a,i))},t.prototype.__iterator=function(n,a){var i=a?this.size:0,o=D5(this,a);return new Vr(function(){var s=o();return s===Qv?Ei():hn(n,a?--i:i++,s)})},t.prototype.__iterate=function(n,a){for(var i=a?this.size:0,o=D5(this,a),s;(s=o())!==Qv&&n(s,a?--i:i++,this)!==!1;);return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Zv(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?uy():(this.__ownerID=n,this.__altered=!1,this)},t}(Sf);wf.isList=I5;var Wn=wf.prototype;Wn[E5]=!0;Wn[Yg]=Wn.remove;Wn.merge=Wn.concat;Wn.setIn=p5;Wn.deleteIn=Wn.removeIn=v5;Wn.update=g5;Wn.updateIn=y5;Wn.mergeIn=x5;Wn.mergeDeepIn=S5;Wn.withMutations=iy;Wn.wasAltered=OC;Wn.asImmutable=sy;Wn["@@transducer/init"]=Wn.asMutable=oy;Wn["@@transducer/step"]=function(e,t){return e.push(t)};Wn["@@transducer/result"]=function(e){return e.asImmutable()};var al=function(t,r){this.array=t,this.ownerID=r};al.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:this.array.length===0)return this;var a=n>>>r&fi;if(a>=this.array.length)return new al([],t);var i=a===0,o;if(r>0){var s=this.array[a];if(o=s&&s.removeBefore(t,r-ln,n),o===s&&i)return this}if(i&&!o)return this;var u=Bm(this,t);if(!i)for(var c=0;c<a;c++)u.array[c]=void 0;return o&&(u.array[a]=o),u};al.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||this.array.length===0)return this;var a=n-1>>>r&fi;if(a>=this.array.length)return this;var i;if(r>0){var o=this.array[a];if(i=o&&o.removeAfter(t,r-ln,n),i===o&&a===this.array.length-1)return this}var s=Bm(this,t);return s.array.splice(a+1),i&&(s.array[a]=i),s};var Qv={};function D5(e,t){var r=e._origin,n=e._capacity,a=$v(n),i=e._tail;return o(e._root,e._level,0);function o(c,l,f){return l===0?s(c,f):u(c,l,f)}function s(c,l){var f=l===a?i&&i.array:c&&c.array,d=l>r?0:r-l,m=n-l;return m>xo&&(m=xo),function(){if(d===m)return Qv;var p=t?--m:d++;return f&&f[p]}}function u(c,l,f){var d,m=c&&c.array,p=f>r?0:r-f>>l,v=(n-f>>l)+1;return v>xo&&(v=xo),function(){for(;;){if(d){var h=d();if(h!==Qv)return h;d=null}if(p===v)return Qv;var g=t?--v:p++;d=o(m&&m[g],l-ln,f+(g<<l))}}}}function Zv(e,t,r,n,a,i,o){var s=Object.create(Wn);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=a,s.__ownerID=i,s.__hash=o,s.__altered=!1,s}var M5;function uy(){return M5||(M5=Zv(0,0,ln))}function Xq(e,t,r){if(t=tl(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(o){t<0?il(o,t).set(0,r):il(o,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,a=e._root,i=mC();return t>=$v(e._capacity)?n=zC(n,e.__ownerID,0,t,r,i):a=zC(a,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=a,e._tail=n,e.__hash=void 0,e.__altered=!0,e):Zv(e._origin,e._capacity,e._level,a,n):e}function zC(e,t,r,n,a,i){var o=n>>>r&fi,s=e&&o<e.array.length;if(!s&&a===void 0)return e;var u;if(r>0){var c=e&&e.array[o],l=zC(c,t,r-ln,n,a,i);return l===c?e:(u=Bm(e,t),u.array[o]=l,u)}return s&&e.array[o]===a?e:(i&&So(i),u=Bm(e,t),a===void 0&&o===u.array.length-1?u.array.pop():u.array[o]=a,u)}function Bm(e,t){return t&&e&&t===e.ownerID?e:new al(e?e.array.slice():[],t)}function R5(e,t){if(t>=$v(e._capacity))return e._tail;if(t<1<<e._level+ln){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&fi],n-=ln;return r}}function il(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new pC,a=e._origin,i=e._capacity,o=a+t,s=r===void 0?i:r<0?i+r:a+r;if(o===a&&s===i)return e;if(o>=s)return e.clear();for(var u=e._level,c=e._root,l=0;o+l<0;)c=new al(c&&c.array.length?[void 0,c]:[],n),u+=ln,l+=1<<u;l&&(o+=l,a+=l,s+=l,i+=l);for(var f=$v(i),d=$v(s);d>=1<<u+ln;)c=new al(c&&c.array.length?[c]:[],n),u+=ln;var m=e._tail,p=d<f?R5(e,s-1):d>f?new al([],n):m;if(m&&d>f&&o<i&&m.array.length){c=Bm(c,n);for(var v=c,h=u;h>ln;h-=ln){var g=f>>>h&fi;v=v.array[g]=Bm(v.array[g],n)}v.array[f>>>ln&fi]=m}if(s<i&&(p=p&&p.removeAfter(n,0,s)),o>=d)o-=d,s-=d,u=ln,c=null,p=p&&p.removeBefore(n,0,o);else if(o>a||d<f){for(l=0;c;){var y=o>>>u&fi;if(y!==d>>>u&fi)break;y&&(l+=(1<<u)*y),u-=ln,c=c.array[y]}c&&o>a&&(c=c.removeBefore(n,u,o-l)),c&&d<f&&(c=c.removeAfter(n,u,d-l)),l&&(o-=l,s-=l)}return e.__ownerID?(e.size=s-o,e._origin=o,e._capacity=s,e._level=u,e._root=c,e._tail=p,e.__hash=void 0,e.__altered=!0,e):Zv(o,s,u,c,p)}function $v(e){return e<xo?0:e-1>>>ln<<ln}var ds=function(e){function t(r){return r==null?Jv():jD(r)?r:Jv().withMutations(function(n){var a=os(r);Co(a.size),a.forEach(function(i,o){return n.set(o,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,a){var i=this._map.get(n);return i!==void 0?this._list.get(i)[1]:a},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Jv()},t.prototype.set=function(n,a){return F5(this,n,a)},t.prototype.remove=function(n){return F5(this,n,Er)},t.prototype.__iterate=function(n,a){var i=this;return this._list.__iterate(function(o){return o&&n(o[1],o[0],i)},a)},t.prototype.__iterator=function(n,a){return this._list.fromEntrySeq().__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?VC(a,i,n,this.__hash):this.size===0?Jv():(this.__ownerID=n,this.__altered=!1,this._map=a,this._list=i,this)},t}(_o);ds.isOrderedMap=jD;ds.prototype[Tm]=!0;ds.prototype[Yg]=ds.prototype.remove;function VC(e,t,r,n){var a=Object.create(ds.prototype);return a.size=e?e.size:0,a._map=e,a._list=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var B5;function Jv(){return B5||(B5=VC(fs(),uy()))}function F5(e,t,r){var n=e._map,a=e._list,i=n.get(t),o=i!==void 0,s,u;if(r===Er){if(!o)return e;a.size>=xo&&a.size>=n.size*2?(u=a.filter(function(c,l){return c!==void 0&&i!==l}),s=u.toKeyedSeq().map(function(c){return c[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=u.__ownerID=e.__ownerID)):(s=n.remove(t),u=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(r===a.get(i)[1])return e;s=n,u=a.set(i,[t,r])}else s=n.set(t,a.size),u=a.set(a.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=u,e.__hash=void 0,e.__altered=!0,e):VC(s,u)}var O5="@@__IMMUTABLE_STACK__@@";function GC(e){return Boolean(e&&e[O5])}var HC=function(e){function t(r){return r==null?cy():GC(r)?r:cy().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,a){var i=this._head;for(n=tl(this,n);i&&n--;)i=i.next;return i?i.value:a},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:n[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):eh(a,i)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&GC(n))return n;Co(n.size);var a=this.size,i=this._head;return n.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):eh(a,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):cy()},t.prototype.slice=function(n,a){if(Kg(n,a,this.size))return this;var i=jv(n,this.size),o=Qg(a,this.size);if(o!==this.size)return e.prototype.slice.call(this,n,a);for(var s=this.size-i,u=this._head;i--;)u=u.next;return this.__ownerID?(this.size=s,this._head=u,this.__hash=void 0,this.__altered=!0,this):eh(s,u)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?eh(this.size,this._head,n,this.__hash):this.size===0?cy():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,a){var i=this;if(a)return new Cf(this.toArray()).__iterate(function(u,c){return n(u,c,i)},a);for(var o=0,s=this._head;s&&n(s.value,o++,this)!==!1;)s=s.next;return o},t.prototype.__iterator=function(n,a){if(a)return new Cf(this.toArray()).__iterator(n,a);var i=0,o=this._head;return new Vr(function(){if(o){var s=o.value;return o=o.next,hn(n,i++,s)}return Ei()})},t}(Sf);HC.isStack=GC;var di=HC.prototype;di[O5]=!0;di.shift=di.pop;di.unshift=di.push;di.unshiftAll=di.pushAll;di.withMutations=iy;di.wasAltered=OC;di.asImmutable=sy;di["@@transducer/init"]=di.asMutable=oy;di["@@transducer/step"]=function(e,t){return e.unshift(t)};di["@@transducer/result"]=function(e){return e.asImmutable()};function eh(e,t,r,n){var a=Object.create(di);return a.size=e,a._head=t,a.__ownerID=r,a.__hash=n,a.__altered=!1,a}var k5;function cy(){return k5||(k5=eh(0))}var L5="@@__IMMUTABLE_SET__@@";function qC(e){return Boolean(e&&e[L5])}function N5(e){return qC(e)&&ss(e)}function U5(e,t){if(e===t)return!0;if(!Ti(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||Tn(e)!==Tn(t)||Pi(e)!==Pi(t)||ss(e)!==ss(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!Zg(e);if(ss(e)){var n=e.entries();return t.every(function(u,c){var l=n.next().value;return l&&Xi(l[1],u)&&(r||Xi(l[0],c))})&&n.next().done}var a=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{a=!0;var i=e;e=t,t=i}var o=!0,s=t.__iterate(function(u,c){if(r?!e.has(u):a?!Xi(u,e.get(c,Er)):!Xi(e.get(c,Er),u))return o=!1,!1});return o&&e.size===s}function Af(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function jC(e){if(!e||typeof e!="object")return e;if(!Ti(e)){if(!nl(e))return e;e=Wi(e)}if(Tn(e)){var t={};return e.__iterate(function(n,a){t[a]=jC(n)}),t}var r=[];return e.__iterate(function(n){r.push(jC(n))}),r}var ly=function(e){function t(r){return r==null?th():qC(r)&&!ss(r)?r:th().withMutations(function(n){var a=e(r);Co(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(os(n).keySeq())},t.intersect=function(n){return n=Nn(n).toArray(),n.length?Ma.intersect.apply(t(n.pop()),n):th()},t.union=function(n){return n=Nn(n).toArray(),n.length?Ma.union.apply(t(n.pop()),n):th()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return fy(this,this._map.set(n,n))},t.prototype.remove=function(n){return fy(this,this._map.remove(n))},t.prototype.clear=function(){return fy(this,this._map.clear())},t.prototype.map=function(n,a){var i=this,o=!1,s=fy(this,this._map.mapEntries(function(u){var c=u[1],l=n.call(a,c,c,i);return l!==c&&(o=!0),[l,l]},a));return o?s:this},t.prototype.union=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return n=n.filter(function(i){return i.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(i){for(var o=0;o<n.length;o++)e(n[o]).forEach(function(s){return i.add(s)})})},t.prototype.intersect=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(n.length===0)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.every(function(s){return s.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.subtract=function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(n.length===0)return this;n=n.map(function(o){return e(o)});var i=[];return this.forEach(function(o){n.some(function(s){return s.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},t.prototype.sort=function(n){return ms(Im(this,n))},t.prototype.sortBy=function(n,a){return ms(Im(this,a,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,a){var i=this;return this._map.__iterate(function(o){return n(o,o,i)},a)},t.prototype.__iterator=function(n,a){return this._map.__iterator(n,a)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var a=this._map.__ensureOwner(n);return n?this.__make(a,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=a,this)},t}(Am);ly.isSet=qC;var Ma=ly.prototype;Ma[L5]=!0;Ma[Yg]=Ma.remove;Ma.merge=Ma.concat=Ma.union;Ma.withMutations=iy;Ma.asImmutable=sy;Ma["@@transducer/init"]=Ma.asMutable=oy;Ma["@@transducer/step"]=function(e,t){return e.add(t)};Ma["@@transducer/result"]=function(e){return e.asImmutable()};Ma.__empty=th;Ma.__make=z5;function fy(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function z5(e,t){var r=Object.create(Ma);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var V5;function th(){return V5||(V5=z5(fs()))}var Yq=function(e){function t(r,n,a){if(!(this instanceof t))return new t(r,n,a);if(l5(a!==0,"Cannot step a Range by 0"),r=r||0,n===void 0&&(n=1/0),a=a===void 0?1:Math.abs(a),n<r&&(a=-a),this._start=r,this._end=n,this._step=a,this.size=Math.max(0,Math.ceil((n-r)/a-1)+1),this.size===0){if(WC)return WC;WC=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,a){return this.has(n)?this._start+tl(this,n)*this._step:a},t.prototype.includes=function(n){var a=(n-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},t.prototype.slice=function(n,a){return Kg(n,a,this.size)?this:(n=jv(n,this.size),a=Qg(a,this.size),a<=n?new t(0,0):new t(this.get(n,this._end),this.get(a,this._end),this._step))},t.prototype.indexOf=function(n){var a=n-this._start;if(a%this._step==0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,a){for(var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;u!==i&&n(s,a?i-++u:u++,this)!==!1;)s+=a?-o:o;return u},t.prototype.__iterator=function(n,a){var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;return new Vr(function(){if(u===i)return Ei();var c=s;return s+=a?-o:o,hn(n,a?i-++u:u++,c)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:U5(this,n)},t}(ls),WC;function G5(e,t,r){for(var n=f5(t),a=0;a!==n.length;)if(e=d5(e,n[a++],Er),e===Er)return r;return e}function Kq(e,t){return G5(this,e,t)}function Qq(e,t){return G5(e,t,Er)!==Er}function Zq(e){return Qq(this,e)}function H5(){Co(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}Nn.isIterable=Ti;Nn.isKeyed=Tn;Nn.isIndexed=Pi;Nn.isAssociative=Zg;Nn.isOrdered=ss;Nn.Iterator=Vr;Af(Nn,{toArray:function(){Co(this.size);var t=new Array(this.size||0),r=Tn(this),n=0;return this.__iterate(function(a,i){t[n++]=r?[i,a]:a}),t},toIndexedSeq:function(){return new $D(this)},toJS:function(){return jC(this)},toKeyedSeq:function(){return new ey(this,!0)},toMap:function(){return _o(this.toKeyedSeq())},toObject:H5,toOrderedMap:function(){return ds(this.toKeyedSeq())},toOrderedSet:function(){return ms(Tn(this)?this.valueSeq():this)},toSet:function(){return ly(Tn(this)?this.valueSeq():this)},toSetSeq:function(){return new JD(this)},toSeq:function(){return Pi(this)?this.toIndexedSeq():Tn(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return HC(Tn(this)?this.valueSeq():this)},toList:function(){return wf(Tn(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return nn(this,Cq(this,t))},includes:function(t){return this.some(function(r){return Xi(r,t)})},entries:function(){return this.__iterator(cs)},every:function(t,r){Co(this.size);var n=!0;return this.__iterate(function(a,i,o){if(!t.call(r,a,i,o))return n=!1,!1}),n},filter:function(t,r){return nn(this,n5(this,t,r,!0))},find:function(t,r,n){var a=this.findEntry(t,r);return a?a[1]:n},forEach:function(t,r){return Co(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){Co(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(a){n?n=!1:r+=t,r+=a!=null?a.toString():""}),r},keys:function(){return this.__iterator(Wv)},map:function(t,r){return nn(this,r5(this,t,r))},reduce:function(t,r,n){return q5(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return q5(this,t,r,n,arguments.length<2,!0)},reverse:function(){return nn(this,DC(this,!0))},slice:function(t,r){return nn(this,MC(this,t,r,!0))},some:function(t,r){return!this.every(dy(t),r)},sort:function(t){return nn(this,Im(this,t))},values:function(){return this.__iterator(us)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return wm(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return bq(this,t,r)},equals:function(t){return U5(this,t)},entrySeq:function(){var t=this;if(t._cache)return new Cf(t._cache);var r=t.toSeq().map(Jq).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(dy(t),r)},findEntry:function(t,r,n){var a=n;return this.__iterate(function(i,o,s){if(t.call(r,i,o,s))return a=[o,i],!1}),a},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(DD,null,t)},flatMap:function(t,r){return nn(this,_q(this,t,r))},flatten:function(t){return nn(this,i5(this,t,!0))},fromEntrySeq:function(){return new e5(this)},get:function(t,r){return this.find(function(n,a){return Xi(a,t)},void 0,r)},getIn:Kq,groupBy:function(t,r){return xq(this,t,r)},has:function(t){return this.get(t,Er)!==Er},hasIn:Zq,isSubset:function(t){return t=typeof t.includes=="function"?t:Nn(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:Nn(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return Xi(r,t)})},keySeq:function(){return this.toSeq().map($q).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return ty(this,t)},maxBy:function(t,r){return ty(this,r,t)},min:function(t){return ty(this,t?j5(t):X5)},minBy:function(t,r){return ty(this,r?j5(r):X5,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return nn(this,a5(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(dy(t),r)},sortBy:function(t,r){return nn(this,Im(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return nn(this,Sq(this,t,r))},takeUntil:function(t,r){return this.takeWhile(dy(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=ej(this))}});var Ii=Nn.prototype;Ii[BD]=!0;Ii[yC]=Ii.values;Ii.toJSON=Ii.toArray;Ii.__toStringMapper=ny;Ii.inspect=Ii.toSource=function(){return this.toString()};Ii.chain=Ii.flatMap;Ii.contains=Ii.includes;Af(os,{flip:function(){return nn(this,t5(this))},mapEntries:function(t,r){var n=this,a=0;return nn(this,this.toSeq().map(function(i,o){return t.call(r,[o,i],a++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return nn(this,this.toSeq().flip().map(function(a,i){return t.call(r,a,i,n)}).flip())}});var rh=os.prototype;rh[FD]=!0;rh[yC]=Ii.entries;rh.toJSON=H5;rh.__toStringMapper=function(e,t){return ny(t)+": "+ny(e)};Af(Sf,{toKeyedSeq:function(){return new ey(this,!1)},filter:function(t,r){return nn(this,n5(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return nn(this,DC(this,!1))},slice:function(t,r){return nn(this,MC(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=jv(t,t<0?this.count():this.size);var a=this.slice(0,t);return nn(this,n===1?a:a.concat(Hs(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return nn(this,i5(this,t,!1))},get:function(t,r){return t=tl(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,a){return a===t},void 0,r)},has:function(t){return t=tl(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return nn(this,wq(this,t))},interleave:function(){var t=[this].concat(Hs(arguments)),r=ry(this.toSeq(),ls.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),nn(this,n)},keySeq:function(){return Yq(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return nn(this,a5(this,t,r,!1))},zip:function(){var t=[this].concat(Hs(arguments));return nn(this,ry(this,W5,t))},zipAll:function(){var t=[this].concat(Hs(arguments));return nn(this,ry(this,W5,t,!0))},zipWith:function(t){var r=Hs(arguments);return r[0]=this,nn(this,ry(this,t,r))}});var Fm=Sf.prototype;Fm[OD]=!0;Fm[Tm]=!0;Af(Am,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var Om=Am.prototype;Om.has=Ii.includes;Om.contains=Om.includes;Om.keys=Om.values;Af(rl,rh);Af(ls,Fm);Af(Em,Om);function q5(e,t,r,n,a,i){return Co(e.size),e.__iterate(function(o,s,u){a?(a=!1,r=o):r=t.call(n,r,o,s,u)},i),r}function $q(e,t){return t}function Jq(e,t){return[t,e]}function dy(e){return function(){return!e.apply(this,arguments)}}function j5(e){return function(){return-e.apply(this,arguments)}}function W5(){return Hs(arguments)}function X5(e,t){return e<t?1:e>t?-1:0}function ej(e){if(e.size===1/0)return 0;var t=ss(e),r=Tn(e),n=t?1:0,a=e.__iterate(r?t?function(i,o){n=31*n+Y5(Yi(i),Yi(o))|0}:function(i,o){n=n+Y5(Yi(i),Yi(o))|0}:t?function(i){n=31*n+Yi(i)|0}:function(i){n=n+Yi(i)|0});return tj(a,n)}function tj(e,t){return t=Xv(t,3432918353),t=Xv(t<<15|t>>>-15,461845907),t=Xv(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Xv(t^t>>>16,2246822507),t=Xv(t^t>>>13,3266489909),t=Jg(t^t>>>16),t}function Y5(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var ms=function(e){function t(r){return r==null?XC():N5(r)?r:XC().withMutations(function(n){var a=Am(r);Co(a.size),a.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(os(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(ly);ms.isOrderedSet=N5;var Tf=ms.prototype;Tf[Tm]=!0;Tf.zip=Fm.zip;Tf.zipWith=Fm.zipWith;Tf.zipAll=Fm.zipAll;Tf.__empty=XC;Tf.__make=K5;function K5(e,t){var r=Object.create(Tf);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var Q5;function XC(){return Q5||(Q5=K5(Jv()))}var Ir=1e-6;function qr(e,t,r){return Math.abs(e-t)<=r}var nh=Math.PI/2,Z5=Math.PI/180;function pr(e){return e*Z5}function ps(e){return e/Z5}function rj(e){return e!==0&&(e&e-1)==0}function nj(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,a=0,i=e.length;a<i;++a){var o=e[a],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function $5(e,t){return e*t}function aj(e){for(var t,r=0,n=0,a=[0,-1],i=e*2+1,o=i/2,s=[],u=Math.pow(i,2);u>0;--u)-o<r&&r<=o&&-o<n&&n<=o&&s.push([r,n]),(r===n||r<0&&r===-n||r>0&&r===1-n)&&(t=[-a[1],a[0]],a[0]=t[0],a[1]=t[1]),r+=a[0],n+=a[1];return s}function se(){return se.zero()}(function(e){function t(){var B=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return B[0]=0,B}e.zero=t;function r(){var B=t();return B[0]=1,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=1,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=1,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.identity=r;function n(B){return B[0]=1,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=1,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=1,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.setIdentity=n;function a(B){for(var z=0;z<16;z++)B[z]=0;return B}e.setZero=a;function i(B){for(var z=t(),le=0;le<4;le++)for(var pe=B[le],ge=0;ge<4;ge++)z[4*ge+le]=pe[ge];return z}e.ofRows=i;var o=r();function s(B,z){return c(B,o,typeof z=="undefined"?Ir:z)}e.isIdentity=s;function u(B){for(var z=0;z<16;z++)if(isNaN(B[z]))return!0;return!1}e.hasNaN=u;function c(B,z,le){for(var pe=0;pe<16;pe++)if(Math.abs(B[pe]-z[pe])>le)return!1;return!0}e.areEqual=c;function l(B,z,le,pe){B[4*le+z]=pe}e.setValue=l;function f(B,z,le){return B[4*le+z]}e.getValue=f;function d(B,z,le){return z[le+0]=B[0],z[le+1]=B[1],z[le+2]=B[2],z[le+3]=B[3],z[le+4]=B[4],z[le+5]=B[5],z[le+6]=B[6],z[le+7]=B[7],z[le+8]=B[8],z[le+9]=B[9],z[le+10]=B[10],z[le+11]=B[11],z[le+12]=B[12],z[le+13]=B[13],z[le+14]=B[14],z[le+15]=B[15],z}e.toArray=d;function m(B,z,le){return B[0]=z[le+0],B[1]=z[le+1],B[2]=z[le+2],B[3]=z[le+3],B[4]=z[le+4],B[5]=z[le+5],B[6]=z[le+6],B[7]=z[le+7],B[8]=z[le+8],B[9]=z[le+9],B[10]=z[le+10],B[11]=z[le+11],B[12]=z[le+12],B[13]=z[le+13],B[14]=z[le+14],B[15]=z[le+15],B}e.fromArray=m;function p(B,z,le,pe){return a(B),l(B,0,0,z[0]),l(B,1,0,z[1]),l(B,2,0,z[2]),l(B,0,1,le[0]),l(B,1,1,le[1]),l(B,2,1,le[2]),l(B,0,2,pe[0]),l(B,1,2,pe[1]),l(B,2,2,pe[2]),l(B,3,3,1),B}e.fromBasis=p;function v(B,z){return B[0]=z[0],B[1]=z[1],B[2]=z[2],B[3]=z[3],B[4]=z[4],B[5]=z[5],B[6]=z[6],B[7]=z[7],B[8]=z[8],B[9]=z[9],B[10]=z[10],B[11]=z[11],B[12]=z[12],B[13]=z[13],B[14]=z[14],B[15]=z[15],B}e.copy=v;function h(B){return v(t(),B)}e.clone=h;function g(B,z){return B[0]=z[12],B[1]=z[13],B[2]=z[14],B}e.getTranslation=g;function y(B,z){var le=z[0],pe=z[1],ge=z[2],Ce=z[4],Ie=z[5],Oe=z[6],We=z[8],Ne=z[9],Ye=z[10];return B[0]=Math.sqrt(le*le+pe*pe+ge*ge),B[1]=Math.sqrt(Ce*Ce+Ie*Ie+Oe*Oe),B[2]=Math.sqrt(We*We+Ne*Ne+Ye*Ye),B}e.getScaling=y;function b(B,z){var le=z[0]+z[5]+z[10],pe=0;return le>0?(pe=Math.sqrt(le+1)*2,B[3]=.25*pe,B[0]=(z[6]-z[9])/pe,B[1]=(z[8]-z[2])/pe,B[2]=(z[1]-z[4])/pe):z[0]>z[5]&&z[0]>z[10]?(pe=Math.sqrt(1+z[0]-z[5]-z[10])*2,B[3]=(z[6]-z[9])/pe,B[0]=.25*pe,B[1]=(z[1]+z[4])/pe,B[2]=(z[8]+z[2])/pe):z[5]>z[10]?(pe=Math.sqrt(1+z[5]-z[0]-z[10])*2,B[3]=(z[8]-z[2])/pe,B[0]=(z[1]+z[4])/pe,B[1]=.25*pe,B[2]=(z[6]+z[9])/pe):(pe=Math.sqrt(1+z[10]-z[0]-z[5])*2,B[3]=(z[1]-z[4])/pe,B[0]=(z[8]+z[2])/pe,B[1]=(z[6]+z[9])/pe,B[2]=.25*pe),B}e.getRotation=b;function x(B,z){var le=1/Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),pe=1/Math.sqrt(z[4]*z[4]+z[5]*z[5]+z[6]*z[6]),ge=1/Math.sqrt(z[8]*z[8]+z[9]*z[9]+z[10]*z[10]);return B[0]=z[0]*le,B[1]=z[1]*le,B[2]=z[2]*le,B[3]=0,B[4]=z[4]*pe,B[5]=z[5]*pe,B[6]=z[6]*pe,B[7]=0,B[8]=z[8]*ge,B[9]=z[9]*ge,B[10]=z[10]*ge,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.extractRotation=x;function C(B,z){if(B===z){var le=z[1],pe=z[2],ge=z[3],Ce=z[6],Ie=z[7],Oe=z[11];B[1]=z[4],B[2]=z[8],B[3]=z[12],B[4]=le,B[6]=z[9],B[7]=z[13],B[8]=pe,B[9]=Ce,B[11]=z[14],B[12]=ge,B[13]=Ie,B[14]=Oe}else B[0]=z[0],B[1]=z[4],B[2]=z[8],B[3]=z[12],B[4]=z[1],B[5]=z[5],B[6]=z[9],B[7]=z[13],B[8]=z[2],B[9]=z[6],B[10]=z[10],B[11]=z[14],B[12]=z[3],B[13]=z[7],B[14]=z[11],B[15]=z[15];return B}e.transpose=C;function _(B,z){var le=z[0],pe=z[1],ge=z[2],Ce=z[3],Ie=z[4],Oe=z[5],We=z[6],Ne=z[7],Ye=z[8],Xe=z[9],Ze=z[10],Ke=z[11],ht=z[12],Ae=z[13],we=z[14],Ve=z[15],rt=le*Oe-pe*Ie,ut=le*We-ge*Ie,Ue=le*Ne-Ce*Ie,pt=pe*We-ge*Oe,mt=pe*Ne-Ce*Oe,wt=ge*Ne-Ce*We,Z=Ye*Ae-Xe*ht,de=Ye*we-Ze*ht,ye=Ye*Ve-Ke*ht,He=Xe*we-Ze*Ae,ot=Xe*Ve-Ke*Ae,ct=Ze*Ve-Ke*we,Ct=rt*ct-ut*ot+Ue*He+pt*ye-mt*de+wt*Z;return Ct?(Ct=1/Ct,B[0]=(Oe*ct-We*ot+Ne*He)*Ct,B[1]=(ge*ot-pe*ct-Ce*He)*Ct,B[2]=(Ae*wt-we*mt+Ve*pt)*Ct,B[3]=(Ze*mt-Xe*wt-Ke*pt)*Ct,B[4]=(We*ye-Ie*ct-Ne*de)*Ct,B[5]=(le*ct-ge*ye+Ce*de)*Ct,B[6]=(we*Ue-ht*wt-Ve*ut)*Ct,B[7]=(Ye*wt-Ze*Ue+Ke*ut)*Ct,B[8]=(Ie*ot-Oe*ye+Ne*Z)*Ct,B[9]=(pe*ye-le*ot-Ce*Z)*Ct,B[10]=(ht*mt-Ae*Ue+Ve*rt)*Ct,B[11]=(Xe*Ue-Ye*mt-Ke*rt)*Ct,B[12]=(Oe*de-Ie*He-We*Z)*Ct,B[13]=(le*He-pe*de+ge*Z)*Ct,B[14]=(Ae*ut-ht*pt-we*rt)*Ct,B[15]=(Ye*pt-Xe*ut+Ze*rt)*Ct,!0):!1}e.tryInvert=_;function w(B,z){return _(B,z)||console.warn("non-invertible matrix.",z),B}e.invert=w;function T(B,z,le){var pe=z[0],ge=z[1],Ce=z[2],Ie=z[3],Oe=z[4],We=z[5],Ne=z[6],Ye=z[7],Xe=z[8],Ze=z[9],Ke=z[10],ht=z[11],Ae=z[12],we=z[13],Ve=z[14],rt=z[15],ut=le[0],Ue=le[1],pt=le[2],mt=le[3];return B[0]=ut*pe+Ue*Oe+pt*Xe+mt*Ae,B[1]=ut*ge+Ue*We+pt*Ze+mt*we,B[2]=ut*Ce+Ue*Ne+pt*Ke+mt*Ve,B[3]=ut*Ie+Ue*Ye+pt*ht+mt*rt,ut=le[4],Ue=le[5],pt=le[6],mt=le[7],B[4]=ut*pe+Ue*Oe+pt*Xe+mt*Ae,B[5]=ut*ge+Ue*We+pt*Ze+mt*we,B[6]=ut*Ce+Ue*Ne+pt*Ke+mt*Ve,B[7]=ut*Ie+Ue*Ye+pt*ht+mt*rt,ut=le[8],Ue=le[9],pt=le[10],mt=le[11],B[8]=ut*pe+Ue*Oe+pt*Xe+mt*Ae,B[9]=ut*ge+Ue*We+pt*Ze+mt*we,B[10]=ut*Ce+Ue*Ne+pt*Ke+mt*Ve,B[11]=ut*Ie+Ue*Ye+pt*ht+mt*rt,ut=le[12],Ue=le[13],pt=le[14],mt=le[15],B[12]=ut*pe+Ue*Oe+pt*Xe+mt*Ae,B[13]=ut*ge+Ue*We+pt*Ze+mt*we,B[14]=ut*Ce+Ue*Ne+pt*Ke+mt*Ve,B[15]=ut*Ie+Ue*Ye+pt*ht+mt*rt,B}e.mul=T;function A(B,z,le,pe,ge,Ce){var Ie=z[0+ge],Oe=z[1+ge],We=z[2+ge],Ne=z[3+ge],Ye=z[4+ge],Xe=z[5+ge],Ze=z[6+ge],Ke=z[7+ge],ht=z[8+ge],Ae=z[9+ge],we=z[10+ge],Ve=z[11+ge],rt=z[12+ge],ut=z[13+ge],Ue=z[14+ge],pt=z[15+ge],mt=le[0+Ce],wt=le[1+Ce],Z=le[2+Ce],de=le[3+Ce];return B[0+pe]=mt*Ie+wt*Ye+Z*ht+de*rt,B[1+pe]=mt*Oe+wt*Xe+Z*Ae+de*ut,B[2+pe]=mt*We+wt*Ze+Z*we+de*Ue,B[3+pe]=mt*Ne+wt*Ke+Z*Ve+de*pt,mt=le[4+Ce],wt=le[5+Ce],Z=le[6+Ce],de=le[7+Ce],B[4+pe]=mt*Ie+wt*Ye+Z*ht+de*rt,B[5+pe]=mt*Oe+wt*Xe+Z*Ae+de*ut,B[6+pe]=mt*We+wt*Ze+Z*we+de*Ue,B[7+pe]=mt*Ne+wt*Ke+Z*Ve+de*pt,mt=le[8+Ce],wt=le[9+Ce],Z=le[10+Ce],de=le[11+Ce],B[8+pe]=mt*Ie+wt*Ye+Z*ht+de*rt,B[9+pe]=mt*Oe+wt*Xe+Z*Ae+de*ut,B[10+pe]=mt*We+wt*Ze+Z*we+de*Ue,B[11+pe]=mt*Ne+wt*Ke+Z*Ve+de*pt,mt=le[12+Ce],wt=le[13+Ce],Z=le[14+Ce],de=le[15+Ce],B[12+pe]=mt*Ie+wt*Ye+Z*ht+de*rt,B[13+pe]=mt*Oe+wt*Xe+Z*Ae+de*ut,B[14+pe]=mt*We+wt*Ze+Z*we+de*Ue,B[15+pe]=mt*Ne+wt*Ke+Z*Ve+de*pt,B}e.mulOffset=A;function D(B,z,le,pe){return T(B,T(B,z,le),pe)}e.mul3=D;function E(B,z,le){var pe=le[0],ge=le[1],Ce=le[2],Ie,Oe,We,Ne,Ye,Xe,Ze,Ke,ht,Ae,we,Ve;return z===B?(B[12]=z[0]*pe+z[4]*ge+z[8]*Ce+z[12],B[13]=z[1]*pe+z[5]*ge+z[9]*Ce+z[13],B[14]=z[2]*pe+z[6]*ge+z[10]*Ce+z[14],B[15]=z[3]*pe+z[7]*ge+z[11]*Ce+z[15]):(Ie=z[0],Oe=z[1],We=z[2],Ne=z[3],Ye=z[4],Xe=z[5],Ze=z[6],Ke=z[7],ht=z[8],Ae=z[9],we=z[10],Ve=z[11],B[0]=Ie,B[1]=Oe,B[2]=We,B[3]=Ne,B[4]=Ye,B[5]=Xe,B[6]=Ze,B[7]=Ke,B[8]=ht,B[9]=Ae,B[10]=we,B[11]=Ve,B[12]=Ie*pe+Ye*ge+ht*Ce+z[12],B[13]=Oe*pe+Xe*ge+Ae*Ce+z[13],B[14]=We*pe+Ze*ge+we*Ce+z[14],B[15]=Ne*pe+Ke*ge+Ve*Ce+z[15]),B}e.translate=E;function M(B,z){return B[0]=1,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=1,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=1,B[11]=0,B[12]=z[0],B[13]=z[1],B[14]=z[2],B[15]=1,B}e.fromTranslation=M;function F(B,z){return B[12]=z[0],B[13]=z[1],B[14]=z[2],B}e.setTranslation=F;function O(B,z,le,pe){return B[0]=le[0],B[4]=le[1],B[8]=le[2],B[1]=pe[0],B[5]=pe[1],B[9]=pe[2],B[2]=z[0],B[6]=z[1],B[10]=z[2],B}e.setAxes=O;function U(B,z,le,pe){var ge=pe[0],Ce=pe[1],Ie=pe[2],Oe=Math.sqrt(ge*ge+Ce*Ce+Ie*Ie);if(Math.abs(Oe)<Ir)return r();Oe=1/Oe,ge*=Oe,Ce*=Oe,Ie*=Oe;var We=Math.sin(le),Ne=Math.cos(le),Ye=1-Ne,Xe=z[0],Ze=z[1],Ke=z[2],ht=z[3],Ae=z[4],we=z[5],Ve=z[6],rt=z[7],ut=z[8],Ue=z[9],pt=z[10],mt=z[11],wt=ge*ge*Ye+Ne,Z=Ce*ge*Ye+Ie*We,de=Ie*ge*Ye-Ce*We,ye=ge*Ce*Ye-Ie*We,He=Ce*Ce*Ye+Ne,ot=Ie*Ce*Ye+ge*We,ct=ge*Ie*Ye+Ce*We,Ct=Ce*Ie*Ye-ge*We,vr=Ie*Ie*Ye+Ne;return B[0]=Xe*wt+Ae*Z+ut*de,B[1]=Ze*wt+we*Z+Ue*de,B[2]=Ke*wt+Ve*Z+pt*de,B[3]=ht*wt+rt*Z+mt*de,B[4]=Xe*ye+Ae*He+ut*ot,B[5]=Ze*ye+we*He+Ue*ot,B[6]=Ke*ye+Ve*He+pt*ot,B[7]=ht*ye+rt*He+mt*ot,B[8]=Xe*ct+Ae*Ct+ut*vr,B[9]=Ze*ct+we*Ct+Ue*vr,B[10]=Ke*ct+Ve*Ct+pt*vr,B[11]=ht*ct+rt*Ct+mt*vr,z!==B&&(B[12]=z[12],B[13]=z[13],B[14]=z[14],B[15]=z[15]),B}e.rotate=U;function N(B,z,le){var pe=le[0],ge=le[1],Ce=le[2],Ie=Math.sqrt(pe*pe+ge*ge+Ce*Ce);if(Math.abs(Ie)<Ir)return n(B);Ie=1/Ie,pe*=Ie,ge*=Ie,Ce*=Ie;var Oe=Math.sin(z),We=Math.cos(z),Ne=1-We;return B[0]=pe*pe*Ne+We,B[1]=ge*pe*Ne+Ce*Oe,B[2]=Ce*pe*Ne-ge*Oe,B[3]=0,B[4]=pe*ge*Ne-Ce*Oe,B[5]=ge*ge*Ne+We,B[6]=Ce*ge*Ne+pe*Oe,B[7]=0,B[8]=pe*Ce*Ne+ge*Oe,B[9]=ge*Ce*Ne-pe*Oe,B[10]=Ce*Ce*Ne+We,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.fromRotation=N;function q(B,z,le){var pe=le[0],ge=le[1],Ce=le[2];return B[0]=z[0]*pe,B[1]=z[1]*pe,B[2]=z[2]*pe,B[3]=z[3]*pe,B[4]=z[4]*ge,B[5]=z[5]*ge,B[6]=z[6]*ge,B[7]=z[7]*ge,B[8]=z[8]*Ce,B[9]=z[9]*Ce,B[10]=z[10]*Ce,B[11]=z[11]*Ce,B[12]=z[12],B[13]=z[13],B[14]=z[14],B[15]=z[15],B}e.scale=q;function j(B,z,le){return B[0]=z[0]*le,B[1]=z[1]*le,B[2]=z[2]*le,B[3]=z[3]*le,B[4]=z[4]*le,B[5]=z[5]*le,B[6]=z[6]*le,B[7]=z[7]*le,B[8]=z[8]*le,B[9]=z[9]*le,B[10]=z[10]*le,B[11]=z[11]*le,B[12]=z[12],B[13]=z[13],B[14]=z[14],B[15]=z[15],B}e.scaleUniformly=j;function Q(B,z){return B[0]=z[0],B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=z[1],B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=z[2],B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.fromScaling=Q;function J(B,z){return B[0]=z,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=z,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=z,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.fromUniformScaling=J;function te(B,z){return B[0]=z[0],B[1]=z[1],B[2]=z[2],B[4]=z[3],B[5]=z[4],B[6]=z[5],B[8]=z[6],B[9]=z[7],B[10]=z[8],B}e.fromMat3=te;function K(B){for(var z="",le=0;le<4;le++){for(var pe=0;pe<4;pe++)z+=B[4*pe+le].toString(),pe<3&&(z+=" ");le<3&&(z+=`
`)}return z}e.makeTable=K;function L(B){var z=B[0],le=B[1],pe=B[2],ge=B[3],Ce=B[4],Ie=B[5],Oe=B[6],We=B[7],Ne=B[8],Ye=B[9],Xe=B[10],Ze=B[11],Ke=B[12],ht=B[13],Ae=B[14],we=B[15],Ve=z*Ie-le*Ce,rt=z*Oe-pe*Ce,ut=z*We-ge*Ce,Ue=le*Oe-pe*Ie,pt=le*We-ge*Ie,mt=pe*We-ge*Oe,wt=Ne*ht-Ye*Ke,Z=Ne*Ae-Xe*Ke,de=Ne*we-Ze*Ke,ye=Ye*Ae-Xe*ht,He=Ye*we-Ze*ht,ot=Xe*we-Ze*Ae;return Ve*ot-rt*He+ut*ye+Ue*de-pt*Z+mt*wt}e.determinant=L;function W(B,z){return k(B,typeof z!="undefined"?z:Ir)}e.isRotationAndTranslation=W;function k(B,z){var le=B[0],pe=B[1],ge=B[2],Ce=B[3],Ie=B[4],Oe=B[5],We=B[6],Ne=B[7],Ye=B[8],Xe=B[9],Ze=B[10],Ke=B[11],ht=B[15];if(!qr(ht,1,z)||!qr(Ce,0,z)||!qr(Ne,0,z)||!qr(Ke,0,z))return!1;var Ae=Math.abs(le*(Oe*Ze-We*Xe)-pe*(Ie*Ze-We*Ye)+ge*(Ie*Xe-Oe*Ye));return!!qr(Ae,1,z)}function V(B,z){return G(B,typeof z!="undefined"?z:Ir)}e.isTranslationAndUniformScaling=V;function G(B,z){var le=B[0];return qr(B[1],0,z)&&qr(B[2],0,z)&&qr(B[3],0,z)&&qr(B[4],0,z)&&qr(B[5],le,z)&&qr(B[6],0,z)&&qr(B[7],0,z)&&qr(B[8],0,z)&&qr(B[9],0,z)&&qr(B[10],le,z)&&qr(B[11],0,z)&&qr(B[15],1,z)}function H(B,z){var le=z[0],pe=z[1],ge=z[2],Ce=z[3],Ie=le+le,Oe=pe+pe,We=ge+ge,Ne=le*Ie,Ye=pe*Ie,Xe=pe*Oe,Ze=ge*Ie,Ke=ge*Oe,ht=ge*We,Ae=Ce*Ie,we=Ce*Oe,Ve=Ce*We;return B[0]=1-Xe-ht,B[1]=Ye+Ve,B[2]=Ze-we,B[3]=0,B[4]=Ye-Ve,B[5]=1-Ne-ht,B[6]=Ke+Ae,B[7]=0,B[8]=Ze+we,B[9]=Ke-Ae,B[10]=1-Ne-Xe,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,B}e.fromQuat=H;function X(B,z,le,pe,ge,Ce,Ie){var Oe=2*Ce/(le-z),We=2*Ce/(pe-ge),Ne=(le+z)/(le-z),Ye=(pe+ge)/(pe-ge),Xe=-(Ie+Ce)/(Ie-Ce),Ze=-2*Ie*Ce/(Ie-Ce);return B[0]=Oe,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=We,B[6]=0,B[7]=0,B[8]=Ne,B[9]=Ye,B[10]=Xe,B[11]=-1,B[12]=0,B[13]=0,B[14]=Ze,B[15]=0,B}e.perspective=X;function Y(B,z,le,pe,ge,Ce,Ie){var Oe=1/(le-z),We=1/(pe-ge),Ne=1/(Ie-Ce),Ye=(le+z)*Oe,Xe=(pe+ge)*We,Ze=(Ie+Ce)*Ne;return B[0]=2*Oe,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=2*We,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=-2*Ne,B[11]=0,B[12]=-Ye,B[13]=-Xe,B[14]=-Ze,B[15]=1,B}e.ortho=Y;function oe(B,z,le,pe){var ge,Ce,Ie,Oe,We,Ne,Ye,Xe,Ze,Ke,ht=z[0],Ae=z[1],we=z[2],Ve=pe[0],rt=pe[1],ut=pe[2],Ue=le[0],pt=le[1],mt=le[2];return Math.abs(ht-Ue)<Ir&&Math.abs(Ae-pt)<Ir&&Math.abs(we-mt)<Ir?n(B):(Ye=ht-Ue,Xe=Ae-pt,Ze=we-mt,Ke=1/Math.sqrt(Ye*Ye+Xe*Xe+Ze*Ze),Ye*=Ke,Xe*=Ke,Ze*=Ke,ge=rt*Ze-ut*Xe,Ce=ut*Ye-Ve*Ze,Ie=Ve*Xe-rt*Ye,Ke=Math.sqrt(ge*ge+Ce*Ce+Ie*Ie),Ke?(Ke=1/Ke,ge*=Ke,Ce*=Ke,Ie*=Ke):(ge=0,Ce=0,Ie=0),Oe=Xe*Ie-Ze*Ce,We=Ze*ge-Ye*Ie,Ne=Ye*Ce-Xe*ge,Ke=Math.sqrt(Oe*Oe+We*We+Ne*Ne),Ke?(Ke=1/Ke,Oe*=Ke,We*=Ke,Ne*=Ke):(Oe=0,We=0,Ne=0),B[0]=ge,B[1]=Oe,B[2]=Ye,B[3]=0,B[4]=Ce,B[5]=We,B[6]=Xe,B[7]=0,B[8]=Ie,B[9]=Ne,B[10]=Ze,B[11]=0,B[12]=-(ge*ht+Ce*Ae+Ie*we),B[13]=-(Oe*ht+We*Ae+Ne*we),B[14]=-(Ye*ht+Xe*Ae+Ze*we),B[15]=1,B)}e.lookAt=oe;function ue(B,z,le,pe){var ge=z[0],Ce=z[1],Ie=z[2],Oe=pe[0],We=pe[1],Ne=pe[2],Ye=ge-le[0],Xe=Ce-le[1],Ze=Ie-le[2],Ke=Ye*Ye+Xe*Xe+Ze*Ze;Ke>0&&(Ke=1/Math.sqrt(Ke),Ye*=Ke,Xe*=Ke,Ze*=Ke);var ht=We*Ze-Ne*Xe,Ae=Ne*Ye-Oe*Ze,we=Oe*Xe-We*Ye;return Ke=ht*ht+Ae*Ae+we*we,Ke>0&&(Ke=1/Math.sqrt(Ke),ht*=Ke,Ae*=Ke,we*=Ke),B[0]=ht,B[1]=Ae,B[2]=we,B[3]=0,B[4]=Xe*we-Ze*Ae,B[5]=Ze*ht-Ye*we,B[6]=Ye*Ae-Xe*ht,B[7]=0,B[8]=Ye,B[9]=Xe,B[10]=Ze,B[11]=0,B[12]=ge,B[13]=Ce,B[14]=Ie,B[15]=1,B}e.targetTo=ue;function me(B,z){a(B);for(var le=0;le<4;le++){var pe=z[le];l(B,le,pe,1)}return B}e.fromPermutation=me;function he(B){var z=B[0]*B[0]+B[1]*B[1]+B[2]*B[2],le=B[4]*B[4]+B[5]*B[5]+B[6]*B[6],pe=B[8]*B[8]+B[9]*B[9]+B[10]*B[10];return Math.sqrt(Math.max(z,le,pe))}e.getMaxScaleOnAxis=he;var Pe=[1,0,0],re=[0,1,0],ee=[0,0,1];e.rotX90=N(t(),pr(90),Pe),e.rotX180=N(t(),pr(180),Pe),e.rotY90=N(t(),pr(90),re),e.rotY180=N(t(),pr(180),re),e.rotY270=N(t(),pr(270),re),e.rotZ90=N(t(),pr(90),ee),e.rotZ180=N(t(),pr(180),ee),e.rotXY90=T(t(),e.rotX90,e.rotY90),e.rotZY90=T(t(),e.rotZ90,e.rotY90),e.rotZYZ90=T(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=T(t(),e.rotZ90,e.rotX180),e.rotY90Z180=T(t(),e.rotY90,e.rotZ180),e.id=r()})(se||(se={}));function ij(e,t,r){return(e-t)/(r-t)}function Ra(e,t,r){return Math.max(t,Math.min(r,e))}function oj(e){return Ra(e,0,1)}function Xn(e,t,r){return e+(t-e)*r}function my(e,t,r,n,a,i){var o=(r-e)*i,s=(n-t)*i,u=a*a,c=a*u;return(2*t-2*r+o+s)*c+(-3*t+3*r-2*o-s)*u+o*a+t}function YC(e,t,r,n){var a=1-n;return a*a*e+2*a*n*t+n*n*r}function J5(e,t,r){return r=oj(ij(r,e,t)),r*r*(3-2*r)}function S(){return S.zero()}(function(e){function t(){var Z=[.1,0,0];return Z[0]=0,Z}e.zero=t;function r(Z){var de=t();return de[0]=Z[0],de[1]=Z[1],de[2]=Z[2],de}e.clone=r;function n(Z){return isNaN(Z[0])||isNaN(Z[1])||isNaN(Z[2])}e.hasNaN=n;function a(Z){return Z[0]=NaN,Z[1]=NaN,Z[2]=NaN,Z}e.setNaN=a;function i(Z){return c(Z.x,Z.y,Z.z)}e.fromObj=i;function o(Z){return{x:Z[0],y:Z[1],z:Z[2]}}e.toObj=o;function s(Z,de,ye){return Z[0]=de[ye+0],Z[1]=de[ye+1],Z[2]=de[ye+2],Z}e.fromArray=s;function u(Z,de,ye){return de[ye+0]=Z[0],de[ye+1]=Z[1],de[ye+2]=Z[2],de}e.toArray=u;function c(Z,de,ye){var He=t();return He[0]=Z,He[1]=de,He[2]=ye,He}e.create=c;function l(Z){var de=t();return de[0]=Z[0],de[1]=Z[1],de[2]=Z[2],de}e.ofArray=l;function f(Z,de,ye,He){return Z[0]=de,Z[1]=ye,Z[2]=He,Z}e.set=f;function d(Z,de){return Z[0]=de[0],Z[1]=de[1],Z[2]=de[2],Z}e.copy=d;function m(Z,de,ye){return Z[0]=de[0]+ye[0],Z[1]=de[1]+ye[1],Z[2]=de[2]+ye[2],Z}e.add=m;function p(Z,de,ye){return Z[0]=de[0]-ye[0],Z[1]=de[1]-ye[1],Z[2]=de[2]-ye[2],Z}e.sub=p;function v(Z,de,ye){return Z[0]=de[0]*ye[0],Z[1]=de[1]*ye[1],Z[2]=de[2]*ye[2],Z}e.mul=v;function h(Z,de,ye){return Z[0]=de[0]/ye[0],Z[1]=de[1]/ye[1],Z[2]=de[2]/ye[2],Z}e.div=h;function g(Z,de,ye){return Z[0]=de[0]*ye,Z[1]=de[1]*ye,Z[2]=de[2]*ye,Z}e.scale=g;function y(Z,de,ye,He){return Z[0]=de[0]+ye[0]*He,Z[1]=de[1]+ye[1]*He,Z[2]=de[2]+ye[2]*He,Z}e.scaleAndAdd=y;function b(Z,de,ye,He){return Z[0]=de[0]-ye[0]*He,Z[1]=de[1]-ye[1]*He,Z[2]=de[2]-ye[2]*He,Z}e.scaleAndSub=b;function x(Z,de,ye){return Z[0]=de[0]+ye,Z[1]=de[1]+ye,Z[2]=de[2]+ye,Z}e.addScalar=x;function C(Z,de,ye){return Z[0]=de[0]-ye,Z[1]=de[1]-ye,Z[2]=de[2]-ye,Z}e.subScalar=C;function _(Z,de){return Z[0]=Math.round(de[0]),Z[1]=Math.round(de[1]),Z[2]=Math.round(de[2]),Z}e.round=_;function w(Z,de){return Z[0]=Math.ceil(de[0]),Z[1]=Math.ceil(de[1]),Z[2]=Math.ceil(de[2]),Z}e.ceil=w;function T(Z,de){return Z[0]=Math.floor(de[0]),Z[1]=Math.floor(de[1]),Z[2]=Math.floor(de[2]),Z}e.floor=T;function A(Z,de){return Z[0]=Math.trunc(de[0]),Z[1]=Math.trunc(de[1]),Z[2]=Math.trunc(de[2]),Z}e.trunc=A;function D(Z,de){return Z[0]=Math.abs(de[0]),Z[1]=Math.abs(de[1]),Z[2]=Math.abs(de[2]),Z}e.abs=D;function E(Z,de,ye){return Z[0]=Math.min(de[0],ye[0]),Z[1]=Math.min(de[1],ye[1]),Z[2]=Math.min(de[2],ye[2]),Z}e.min=E;function M(Z,de,ye){return Z[0]=Math.max(de[0],ye[0]),Z[1]=Math.max(de[1],ye[1]),Z[2]=Math.max(de[2],ye[2]),Z}e.max=M;function F(Z,de){var ye=de[0]-Z[0],He=de[1]-Z[1],ot=de[2]-Z[2];return Math.sqrt(ye*ye+He*He+ot*ot)}e.distance=F;function O(Z,de){var ye=de[0]-Z[0],He=de[1]-Z[1],ot=de[2]-Z[2];return ye*ye+He*He+ot*ot}e.squaredDistance=O;function U(Z){var de=Z[0],ye=Z[1],He=Z[2];return Math.sqrt(de*de+ye*ye+He*He)}e.magnitude=U;function N(Z){var de=Z[0],ye=Z[1],He=Z[2];return de*de+ye*ye+He*He}e.squaredMagnitude=N;function q(Z,de,ye){return g(Z,J(Z,de),ye)}e.setMagnitude=q;function j(Z,de){return Z[0]=-de[0],Z[1]=-de[1],Z[2]=-de[2],Z}e.negate=j;function Q(Z,de){return Z[0]=1/de[0],Z[1]=1/de[1],Z[2]=1/de[2],Z}e.inverse=Q;function J(Z,de){var ye=de[0],He=de[1],ot=de[2],ct=ye*ye+He*He+ot*ot;return ct>0&&(ct=1/Math.sqrt(ct),Z[0]=de[0]*ct,Z[1]=de[1]*ct,Z[2]=de[2]*ct),Z}e.normalize=J;function te(Z,de){return Z[0]*de[0]+Z[1]*de[1]+Z[2]*de[2]}e.dot=te;function K(Z,de,ye){var He=de[0],ot=de[1],ct=de[2],Ct=ye[0],vr=ye[1],Rr=ye[2];return Z[0]=ot*Rr-ct*vr,Z[1]=ct*Ct-He*Rr,Z[2]=He*vr-ot*Ct,Z}e.cross=K;function L(Z,de,ye,He){var ot=de[0],ct=de[1],Ct=de[2];return Z[0]=ot+He*(ye[0]-ot),Z[1]=ct+He*(ye[1]-ct),Z[2]=Ct+He*(ye[2]-Ct),Z}e.lerp=L;var W=t();function k(Z,de,ye,He){var ot=Ra(te(de,ye),-1,1),ct=Math.acos(ot)*He;return y(W,ye,de,-ot),J(W,W),m(Z,g(Z,de,Math.cos(ct)),g(W,W,Math.sin(ct)))}e.slerp=k;function V(Z,de,ye,He,ot,ct){var Ct=ct*ct,vr=Ct*(2*ct-3)+1,Rr=Ct*(ct-2)+ct,Ur=Ct*(ct-1),ma=Ct*(3-2*ct);return Z[0]=de[0]*vr+ye[0]*Rr+He[0]*Ur+ot[0]*ma,Z[1]=de[1]*vr+ye[1]*Rr+He[1]*Ur+ot[1]*ma,Z[2]=de[2]*vr+ye[2]*Rr+He[2]*Ur+ot[2]*ma,Z}e.hermite=V;function G(Z,de,ye,He,ot,ct){var Ct=1-ct,vr=Ct*Ct,Rr=ct*ct,Ur=vr*Ct,ma=3*ct*vr,oi=3*Rr*Ct,si=Rr*ct;return Z[0]=de[0]*Ur+ye[0]*ma+He[0]*oi+ot[0]*si,Z[1]=de[1]*Ur+ye[1]*ma+He[1]*oi+ot[1]*si,Z[2]=de[2]*Ur+ye[2]*ma+He[2]*oi+ot[2]*si,Z}e.bezier=G;function H(Z,de,ye,He,ot){return Z[0]=YC(de[0],ye[0],He[0],ot),Z[1]=YC(de[1],ye[1],He[1],ot),Z[2]=YC(de[2],ye[2],He[2],ot),Z}e.quadraticBezier=H;function X(Z,de,ye,He,ot,ct,Ct){return Z[0]=my(de[0],ye[0],He[0],ot[0],ct,Ct),Z[1]=my(de[1],ye[1],He[1],ot[1],ct,Ct),Z[2]=my(de[2],ye[2],He[2],ot[2],ct,Ct),Z}e.spline=X;function Y(Z,de){var ye=Math.random()*2*Math.PI,He=Math.random()*2-1,ot=Math.sqrt(1-He*He)*de;return Z[0]=Math.cos(ye)*ot,Z[1]=Math.sin(ye)*ot,Z[2]=He*de,Z}e.random=Y;function oe(Z,de,ye){var He=de[0],ot=de[1],ct=de[2],Ct=1/(ye[3]*He+ye[7]*ot+ye[11]*ct+ye[15]||1);return Z[0]=(ye[0]*He+ye[4]*ot+ye[8]*ct+ye[12])*Ct,Z[1]=(ye[1]*He+ye[5]*ot+ye[9]*ct+ye[13])*Ct,Z[2]=(ye[2]*He+ye[6]*ot+ye[10]*ct+ye[14])*Ct,Z}e.transformMat4=oe;function ue(Z,de,ye,He,ot,ct){var Ct=de[0+ot],vr=de[1+ot],Rr=de[2+ot],Ur=1/(ye[3+ct]*Ct+ye[7+ct]*vr+ye[11+ct]*Rr+ye[15+ct]||1);return Z[0+He]=(ye[0+ct]*Ct+ye[4+ct]*vr+ye[8+ct]*Rr+ye[12+ct])*Ur,Z[1+He]=(ye[1+ct]*Ct+ye[5+ct]*vr+ye[9+ct]*Rr+ye[13+ct])*Ur,Z[2+He]=(ye[2+ct]*Ct+ye[6+ct]*vr+ye[10+ct]*Rr+ye[14+ct])*Ur,Z}e.transformMat4Offset=ue;function me(Z,de,ye){var He=de[0],ot=de[1],ct=de[2];return Z[0]=He*ye[0]+ot*ye[3]+ct*ye[6],Z[1]=He*ye[1]+ot*ye[4]+ct*ye[7],Z[2]=He*ye[2]+ot*ye[5]+ct*ye[8],Z}e.transformMat3=me;function he(Z,de,ye){var He=de[0],ot=de[1],ct=de[2],Ct=ye[0],vr=ye[1],Rr=ye[2],Ur=ye[3],ma=Ur*He+vr*ct-Rr*ot,oi=Ur*ot+Rr*He-Ct*ct,si=Ur*ct+Ct*ot-vr*He,rs=-Ct*He-vr*ot-Rr*ct;return Z[0]=ma*Ur+rs*-Ct+oi*-Rr-si*-vr,Z[1]=oi*Ur+rs*-vr+si*-Ct-ma*-Rr,Z[2]=si*Ur+rs*-Rr+ma*-vr-oi*-Ct,Z}e.transformQuat=he;function Pe(Z,de){var ye=Math.sqrt(N(Z)*N(de));if(ye===0)return Math.PI/2;var He=te(Z,de)/ye;return Math.acos(Ra(He,-1,1))}e.angle=Pe;var re=t(),ee=t(),B=t(),z=t(),le=t(),pe=t(),ge=t();function Ce(Z,de,ye,He){p(re,Z,de),p(ee,ye,de),p(B,de,ye),p(z,He,ye),K(le,re,ee),K(pe,B,z);var ot=Pe(le,pe);return K(ge,le,pe),te(ee,ge)>0?ot:-ot}e.dihedralAngle=Ce;function Ie(Z,de,ye,He){return e.set(Z,He*Math.cos(ye)*Math.sin(de),He*Math.sin(ye)*Math.sin(de),He*Math.cos(de))}e.directionFromSpherical=Ie;function Oe(Z,de){return Z[0]===de[0]&&Z[1]===de[1]&&Z[2]===de[2]}e.exactEquals=Oe;function We(Z,de){var ye=Z[0],He=Z[1],ot=Z[2],ct=de[0],Ct=de[1],vr=de[2];return Math.abs(ye-ct)<=Ir*Math.max(1,Math.abs(ye),Math.abs(ct))&&Math.abs(He-Ct)<=Ir*Math.max(1,Math.abs(He),Math.abs(Ct))&&Math.abs(ot-vr)<=Ir*Math.max(1,Math.abs(ot),Math.abs(vr))}e.equals=We;var Ne=t();function Ye(Z,de,ye){var He=Pe(de,ye);if(Math.abs(He)<1e-4)return se.setIdentity(Z);if(Math.abs(He-Math.PI)<Ir)return se.fromScaling(Z,e.negUnit);var ot=K(Ne,de,ye);return se.fromRotation(Z,He,ot)}e.makeRotation=Ye;function Xe(Z){return Z[0]===0&&Z[1]===0&&Z[2]===0}e.isZero=Xe;function Ze(Z,de,ye,He){p(Z,de,He);var ot=te(ye,Z)/N(ye);return m(Z,g(Z,ye,ot),He)}e.projectPointOnVector=Ze;var Ke=t();function ht(Z,de,ye,He){return J(Ke,ye),p(Z,de,He),p(Z,de,g(Ke,Ke,te(Z,Ke)))}e.projectPointOnPlane=ht;function Ae(Z,de,ye){var He=te(ye,de)/N(ye);return g(Z,ye,He)}e.projectOnVector=Ae;var we=t();function Ve(Z,de,ye){return Ae(we,de,ye),p(Z,de,we)}e.projectOnPlane=Ve;function rt(Z,de,ye){return J(Z,K(Z,K(Z,de,ye),de))}e.orthogonalize=rt;function ut(Z,de,ye){return te(de,ye)>0?d(Z,de):j(Z,d(Z,de)),Z}e.matchDirection=ut;var Ue=t(),pt=t();function mt(Z,de,ye,He){return p(Ue,ye,de),p(pt,He,de),J(Z,K(Z,Ue,pt))}e.triangleNormal=mt;function wt(Z,de){return"[".concat(Z[0].toPrecision(de)," ").concat(Z[1].toPrecision(de)," ").concat(Z[2].toPrecision(de),"]")}e.toString=wt,e.origin=c(0,0,0),e.unit=c(1,1,1),e.negUnit=c(-1,-1,-1),e.unitX=c(1,0,0),e.unitY=c(0,1,0),e.unitZ=c(0,0,1),e.negUnitX=c(-1,0,0),e.negUnitY=c(0,-1,0),e.negUnitZ=c(0,0,-1)})(S||(S={}));function dn(){return dn.zero()}(function(e){function t(){var L=[.1,0,0,0,0,0,0,0,0];return L[0]=0,L}e.zero=t;function r(){var L=t();return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=1,L[5]=0,L[6]=0,L[7]=0,L[8]=1,L}e.identity=r;function n(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=1,L[5]=0,L[6]=0,L[7]=0,L[8]=1,L}e.setIdentity=n;function a(L,W,k){return W[k+0]=L[0],W[k+1]=L[1],W[k+2]=L[2],W[k+3]=L[3],W[k+4]=L[4],W[k+5]=L[5],W[k+6]=L[6],W[k+7]=L[7],W[k+8]=L[8],W}e.toArray=a;function i(L,W,k){return L[0]=W[k+0],L[1]=W[k+1],L[2]=W[k+2],L[3]=W[k+3],L[4]=W[k+4],L[5]=W[k+5],L[6]=W[k+6],L[7]=W[k+7],L[8]=W[k+8],L}e.fromArray=i;function o(L,W){return L[0]=W[0],L[1]=W[1],L[2]=W[2],L[3]=W[4],L[4]=W[5],L[5]=W[6],L[6]=W[8],L[7]=W[9],L[8]=W[10],L}e.fromMat4=o;function s(L,W,k,V,G,H,X,Y,oe){var ue=t();return ue[0]=L,ue[1]=W,ue[2]=k,ue[3]=V,ue[4]=G,ue[5]=H,ue[6]=X,ue[7]=Y,ue[8]=oe,ue}e.create=s;var u=r();function c(L,W){return d(L,u,typeof W=="undefined"?Ir:W)}e.isIdentity=c;function l(L){for(var W=0;W<9;W++)if(isNaN(L[W]))return!0;return!1}e.hasNaN=l;function f(L){return v(t(),L)}e.clone=f;function d(L,W,k){for(var V=0;V<9;V++)if(Math.abs(L[V]-W[V])>k)return!1;return!0}e.areEqual=d;function m(L,W,k,V){L[3*k+W]=V}e.setValue=m;function p(L,W,k){return L[3*k+W]}e.getValue=p;function v(L,W){return L[0]=W[0],L[1]=W[1],L[2]=W[2],L[3]=W[3],L[4]=W[4],L[5]=W[5],L[6]=W[6],L[7]=W[7],L[8]=W[8],L}e.copy=v;function h(L,W){if(L===W){var k=W[1],V=W[2],G=W[5];L[1]=W[3],L[2]=W[6],L[3]=k,L[5]=W[7],L[6]=V,L[7]=G}else L[0]=W[0],L[1]=W[3],L[2]=W[6],L[3]=W[1],L[4]=W[4],L[5]=W[7],L[6]=W[2],L[7]=W[5],L[8]=W[8];return L}e.transpose=h;function g(L,W){var k=W[0],V=W[1],G=W[2],H=W[3],X=W[4],Y=W[5],oe=W[6],ue=W[7],me=W[8],he=me*X-Y*ue,Pe=-me*H+Y*oe,re=ue*H-X*oe,ee=k*he+V*Pe+G*re;return ee?(ee=1/ee,L[0]=he*ee,L[1]=(-me*V+G*ue)*ee,L[2]=(Y*V-G*X)*ee,L[3]=Pe*ee,L[4]=(me*k-G*oe)*ee,L[5]=(-Y*k+G*H)*ee,L[6]=re*ee,L[7]=(-ue*k+V*oe)*ee,L[8]=(X*k-V*H)*ee,L):(console.warn("non-invertible matrix.",W),L)}e.invert=g;function y(L,W){return L===W?(L[3]=W[1],L[6]=W[2],L[7]=W[5]):(L[0]=W[0],L[1]=W[1],L[2]=W[2],L[3]=W[1],L[4]=W[4],L[5]=W[5],L[6]=W[2],L[7]=W[5],L[8]=W[8]),L}e.symmtricFromUpper=y;function b(L,W){return L===W?(L[1]=W[3],L[2]=W[6],L[5]=W[7]):(L[0]=W[0],L[1]=W[3],L[2]=W[6],L[3]=W[3],L[4]=W[4],L[5]=W[7],L[6]=W[6],L[7]=W[7],L[8]=W[8]),L}e.symmtricFromLower=b;function x(L){var W=L[0],k=L[1],V=L[2],G=L[3],H=L[4],X=L[5],Y=L[6],oe=L[7],ue=L[8],me=ue*H-X*oe,he=-ue*G+X*Y,Pe=oe*G-H*Y;return W*me+k*he+V*Pe}e.determinant=x;function C(L){return L[0]+L[4]+L[8]}e.trace=C;function _(L,W,k){return L[0]=W[0]-k[0],L[1]=W[1]-k[1],L[2]=W[2]-k[2],L[3]=W[3]-k[3],L[4]=W[4]-k[4],L[5]=W[5]-k[5],L[6]=W[6]-k[6],L[7]=W[7]-k[7],L[8]=W[8]-k[8],L}e.sub=_;function w(L,W,k){return L[0]=W[0]+k[0],L[1]=W[1]+k[1],L[2]=W[2]+k[2],L[3]=W[3]+k[3],L[4]=W[4]+k[4],L[5]=W[5]+k[5],L[6]=W[6]+k[6],L[7]=W[7]+k[7],L[8]=W[8]+k[8],L}e.add=w;function T(L,W,k){var V=W[0],G=W[1],H=W[2],X=W[3],Y=W[4],oe=W[5],ue=W[6],me=W[7],he=W[8],Pe=k[0],re=k[1],ee=k[2],B=k[3],z=k[4],le=k[5],pe=k[6],ge=k[7],Ce=k[8];return L[0]=Pe*V+re*X+ee*ue,L[1]=Pe*G+re*Y+ee*me,L[2]=Pe*H+re*oe+ee*he,L[3]=B*V+z*X+le*ue,L[4]=B*G+z*Y+le*me,L[5]=B*H+z*oe+le*he,L[6]=pe*V+ge*X+Ce*ue,L[7]=pe*G+ge*Y+Ce*me,L[8]=pe*H+ge*oe+Ce*he,L}e.mul=T;function A(L,W,k){return L[0]=W[0]-k,L[1]=W[1]-k,L[2]=W[2]-k,L[3]=W[3]-k,L[4]=W[4]-k,L[5]=W[5]-k,L[6]=W[6]-k,L[7]=W[7]-k,L[8]=W[8]-k,L}e.subScalar=A;function D(L,W,k){return L[0]=W[0]+k,L[1]=W[1]+k,L[2]=W[2]+k,L[3]=W[3]+k,L[4]=W[4]+k,L[5]=W[5]+k,L[6]=W[6]+k,L[7]=W[7]+k,L[8]=W[8]+k,L}e.addScalar=D;function E(L,W,k){return L[0]=W[0]*k,L[1]=W[1]*k,L[2]=W[2]*k,L[3]=W[3]*k,L[4]=W[4]*k,L[5]=W[5]*k,L[6]=W[6]*k,L[7]=W[7]*k,L[8]=W[8]*k,L}e.mulScalar=E;var M=Math.PI/3,F=t();function O(L,W){var k=W[1]*W[1]+W[2]*W[2]+W[5]*W[5];if(k===0)L[0]=W[0],L[1]=W[4],L[2]=W[8];else{var V=C(W)/3,G=W[0]-V,H=W[4]-V,X=W[8]-V,Y=G*G+H*H+X*X+2*k,oe=Math.sqrt(Y/6);E(F,e.Identity,V),_(F,W,F),E(F,F,1/oe);var ue=x(F)/2,me=ue<=-1?M:ue>=1?0:Math.acos(ue)/3;L[0]=V+2*oe*Math.cos(me),L[2]=V+2*oe*Math.cos(me+2*M),L[1]=3*V-L[0]-L[2]}return L}e.symmetricEigenvalues=O;var U=[.1,0,0],N=[.1,0,0],q=[.1,0,0],j=[.1,0,0],Q=[.1,0,0],J=[.1,0,0];function te(L,W,k){S.set(U,W[0]-k,W[1],W[2]),S.set(N,W[1],W[4]-k,W[5]),S.set(q,W[2],W[5],W[8]-k),S.cross(j,U,N),S.cross(Q,U,q),S.cross(J,N,q);var V=S.dot(j,j),G=S.dot(Q,Q),H=S.dot(J,J),X=V,Y=0;return G>X&&(X=G,Y=1),H>X&&(Y=2),Y===0?S.scale(L,j,1/Math.sqrt(V)):Y===1?S.scale(L,Q,1/Math.sqrt(G)):S.scale(L,J,1/Math.sqrt(H)),L}e.eigenvector=te;function K(L,W){return o(L,W),g(L,L),h(L,L),L}e.directionTransform=K,e.Identity=r()})(dn||(dn={}));function Fe(){return Fe.zero()}(function(e){function t(){var T=[.1,0];return T[0]=0,T}e.zero=t;function r(T){var A=t();return A[0]=T[0],A[1]=T[1],A}e.clone=r;function n(T,A){var D=t();return D[0]=T,D[1]=A,D}e.create=n;function a(T){return isNaN(T[0])||isNaN(T[1])}e.hasNaN=a;function i(T,A,D){return A[D+0]=T[0],A[D+1]=T[1],A}e.toArray=i;function o(T,A,D){return T[0]=A[D+0],T[1]=A[D+1],T}e.fromArray=o;function s(T,A){return T[0]=A[0],T[1]=A[1],T}e.copy=s;function u(T,A,D){return T[0]=A,T[1]=D,T}e.set=u;function c(T,A,D){return T[0]=A[0]+D[0],T[1]=A[1]+D[1],T}e.add=c;function l(T,A,D){return T[0]=A[0]-D[0],T[1]=A[1]-D[1],T}e.sub=l;function f(T,A,D){return T[0]=A[0]*D[0],T[1]=A[1]*D[1],T}e.mul=f;function d(T,A,D){return T[0]=A[0]/D[0],T[1]=A[1]/D[1],T}e.div=d;function m(T,A,D){return T[0]=A[0]*D,T[1]=A[1]*D,T}e.scale=m;function p(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T}e.round=p;function v(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T}e.ceil=v;function h(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T}e.floor=h;function g(T,A){var D=A[0]-T[0],E=A[1]-T[1];return Math.sqrt(D*D+E*E)}e.distance=g;function y(T,A){var D=A[0]-T[0],E=A[1]-T[1];return D*D+E*E}e.squaredDistance=y;function b(T){var A=T[0],D=T[1];return Math.sqrt(A*A+D*D)}e.magnitude=b;function x(T){var A=T[0],D=T[1];return A*A+D*D}e.squaredMagnitude=x;function C(T,A){return T[0]=1/A[0],T[1]=1/A[1],T}e.inverse=C;function _(T,A){return T[0]===A[0]&&T[1]===A[1]}e.areEqual=_;function w(T,A){return"[".concat(T[0].toPrecision(A)," ").concat(T[1].toPrecision(A),"}]")}e.toString=w})(Fe||(Fe={}));function Wt(){return Wt.zero()}(function(e){function t(){var M=[.1,0,0,0];return M[0]=0,M}e.zero=t;function r(M){var F=t();return F[0]=M[0],F[1]=M[1],F[2]=M[2],F[3]=M[3],F}e.clone=r;function n(M,F,O,U){var N=t();return N[0]=M,N[1]=F,N[2]=O,N[3]=U,N}e.create=n;function a(M,F){return M[0]=F.center[0],M[1]=F.center[1],M[2]=F.center[2],M[3]=F.radius,M}e.fromSphere=a;function i(M){return a(t(),M)}e.ofSphere=i;function o(M){return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])}e.hasNaN=o;function s(M,F,O){return F[O+0]=M[0],F[O+1]=M[1],F[O+2]=M[2],F[O+3]=M[3],F}e.toArray=s;function u(M,F,O){return M[0]=F[O+0],M[1]=F[O+1],M[2]=F[O+2],M[3]=F[O+3],M}e.fromArray=u;function c(M,F,O){F[O+0]=M[0],F[O+1]=M[1],F[O+2]=M[2]}e.toVec3Array=c;function l(M,F,O){return M[0]=F[O+0],M[1]=F[O+1],M[2]=F[O+2],M[3]=0,M}e.fromVec3Array=l;function f(M,F){return M[0]=F[0],M[1]=F[1],M[2]=F[2],M[3]=F[3],M}e.copy=f;function d(M,F,O,U,N){return M[0]=F,M[1]=O,M[2]=U,M[3]=N,M}e.set=d;function m(M,F,O){return M[0]=F[0]+O[0],M[1]=F[1]+O[1],M[2]=F[2]+O[2],M[3]=F[3]+O[3],M}e.add=m;function p(M,F){var O=F[0]-M[0],U=F[1]-M[1],N=F[2]-M[2],q=F[3]-M[3];return Math.sqrt(O*O+U*U+N*N+q*q)}e.distance=p;function v(M,F,O){return M[0]=F[0]*O,M[1]=F[1]*O,M[2]=F[2]*O,M[4]=F[4]*O,M}e.scale=v;function h(M,F){return M[0]=Math.round(F[0]),M[1]=Math.round(F[1]),M[2]=Math.round(F[2]),M[3]=Math.round(F[3]),M}e.round=h;function g(M,F){return M[0]=Math.ceil(F[0]),M[1]=Math.ceil(F[1]),M[2]=Math.ceil(F[2]),M[3]=Math.ceil(F[3]),M}e.ceil=g;function y(M,F){return M[0]=Math.floor(F[0]),M[1]=Math.floor(F[1]),M[2]=Math.floor(F[2]),M[3]=Math.floor(F[3]),M}e.floor=y;function b(M,F){var O=F[0]-M[0],U=F[1]-M[1],N=F[2]-M[2],q=F[3]-M[3];return O*O+U*U+N*N+q*q}e.squaredDistance=b;function x(M){var F=M[0],O=M[1],U=M[2],N=M[3];return Math.sqrt(F*F+O*O+U*U+N*N)}e.norm=x;function C(M){var F=M[0],O=M[1],U=M[2],N=M[3];return F*F+O*O+U*U+N*N}e.squaredNorm=C;function _(M,F,O){var U=F[0],N=F[1],q=F[2],j=F[3];return M[0]=O[0]*U+O[4]*N+O[8]*q+O[12]*j,M[1]=O[1]*U+O[5]*N+O[9]*q+O[13]*j,M[2]=O[2]*U+O[6]*N+O[10]*q+O[14]*j,M[3]=O[3]*U+O[7]*N+O[11]*q+O[15]*j,M}e.transformMat4=_;function w(M,F){return M[0]*F[0]+M[1]*F[1]+M[2]*F[2]+M[3]*F[3]}e.dot=w;function T(M,F){return M[0]=1/F[0],M[1]=1/F[1],M[2]=1/F[2],M[3]=1/F[3],M}e.inverse=T;function A(M,F){return M[0]===F[0]&&M[1]===F[1]&&M[2]===F[2]&&M[3]===F[3]}e.exactEquals=A;function D(M,F){var O=M[0],U=M[1],N=M[2],q=M[3],j=F[0],Q=F[1],J=F[2],te=F[3];return Math.abs(O-j)<=Ir*Math.max(1,Math.abs(O),Math.abs(j))&&Math.abs(U-Q)<=Ir*Math.max(1,Math.abs(U),Math.abs(Q))&&Math.abs(N-J)<=Ir*Math.max(1,Math.abs(N),Math.abs(J))&&Math.abs(q-te)<=Ir*Math.max(1,Math.abs(q),Math.abs(te))}e.equals=D;function E(M,F){return"[".concat(M[0].toPrecision(F)," ").concat(M[1].toPrecision(F)," ").concat(M[2].toPrecision(F),"  ").concat(M[3].toPrecision(F),"]")}e.toString=E})(Wt||(Wt={}));function Gr(){return Gr.zero()}(function(e){function t(){var K=[.1,0,0,0];return K[0]=0,K}e.zero=t;function r(){var K=t();return K[3]=1,K}e.identity=r;function n(K){K[0]=0,K[1]=0,K[2]=0,K[3]=1}e.setIdentity=n;function a(K){return isNaN(K[0])||isNaN(K[1])||isNaN(K[2])||isNaN(K[3])}e.hasNaN=a;function i(K,L,W,k){var V=r();return V[0]=K,V[1]=L,V[2]=W,V[3]=k,V}e.create=i;function o(K,L,W){W=W*.5;var k=Math.sin(W);return K[0]=k*L[0],K[1]=k*L[1],K[2]=k*L[2],K[3]=Math.cos(W),K}e.setAxisAngle=o;function s(K,L){var W=Math.acos(L[3])*2,k=Math.sin(W/2);return k!==0?(K[0]=L[0]/k,K[1]=L[1]/k,K[2]=L[2]/k):(K[0]=1,K[1]=0,K[2]=0),W}e.getAxisAngle=s;function u(K,L,W){var k=L[0],V=L[1],G=L[2],H=L[3],X=W[0],Y=W[1],oe=W[2],ue=W[3];return K[0]=k*ue+H*X+V*oe-G*Y,K[1]=V*ue+H*Y+G*X-k*oe,K[2]=G*ue+H*oe+k*Y-V*X,K[3]=H*ue-k*X-V*Y-G*oe,K}e.multiply=u;function c(K,L,W){W*=.5;var k=L[0],V=L[1],G=L[2],H=L[3],X=Math.sin(W),Y=Math.cos(W);return K[0]=k*Y+H*X,K[1]=V*Y+G*X,K[2]=G*Y-V*X,K[3]=H*Y-k*X,K}e.rotateX=c;function l(K,L,W){W*=.5;var k=L[0],V=L[1],G=L[2],H=L[3],X=Math.sin(W),Y=Math.cos(W);return K[0]=k*Y-G*X,K[1]=V*Y+H*X,K[2]=G*Y+k*X,K[3]=H*Y-V*X,K}e.rotateY=l;function f(K,L,W){W*=.5;var k=L[0],V=L[1],G=L[2],H=L[3],X=Math.sin(W),Y=Math.cos(W);return K[0]=k*Y+V*X,K[1]=V*Y-k*X,K[2]=G*Y+H*X,K[3]=H*Y-G*X,K}e.rotateZ=f;function d(K,L){var W=L[0],k=L[1],V=L[2];return K[0]=W,K[1]=k,K[2]=V,K[3]=Math.sqrt(Math.abs(1-W*W-k*k-V*V)),K}e.calculateW=d;function m(K,L,W,k){var V=L[0],G=L[1],H=L[2],X=L[3],Y=W[0],oe=W[1],ue=W[2],me=W[3],he,Pe,re,ee,B;return Pe=V*Y+G*oe+H*ue+X*me,Pe<0&&(Pe=-Pe,Y=-Y,oe=-oe,ue=-ue,me=-me),1-Pe>1e-6?(he=Math.acos(Pe),re=Math.sin(he),ee=Math.sin((1-k)*he)/re,B=Math.sin(k*he)/re):(ee=1-k,B=k),K[0]=ee*V+B*Y,K[1]=ee*G+B*oe,K[2]=ee*H+B*ue,K[3]=ee*X+B*me,K}e.slerp=m;function p(K,L){var W=L[0],k=L[1],V=L[2],G=L[3],H=W*W+k*k+V*V+G*G,X=H?1/H:0;return K[0]=-W*X,K[1]=-k*X,K[2]=-V*X,K[3]=G*X,K}e.invert=p;function v(K,L){return K[0]=-L[0],K[1]=-L[1],K[2]=-L[2],K[3]=L[3],K}e.conjugate=v;function h(K,L){var W=L[0]+L[4]+L[8],k;if(W>0)k=Math.sqrt(W+1),K[3]=.5*k,k=.5/k,K[0]=(L[5]-L[7])*k,K[1]=(L[6]-L[2])*k,K[2]=(L[1]-L[3])*k;else{var V=0;L[4]>L[0]&&(V=1),L[8]>L[V*3+V]&&(V=2);var G=(V+1)%3,H=(V+2)%3;k=Math.sqrt(L[V*3+V]-L[G*3+G]-L[H*3+H]+1),K[V]=.5*k,k=.5/k,K[3]=(L[G*3+H]-L[H*3+G])*k,K[G]=(L[G*3+V]+L[V*3+G])*k,K[H]=(L[H*3+V]+L[V*3+H])*k}return K}e.fromMat3=h;var g=[0,0,0];function y(K,L,W){var k=S.dot(L,W)+1;return k<Ir?(k=0,Math.abs(L[0])>Math.abs(L[2])?S.set(g,-L[1],L[0],0):S.set(g,0,-L[2],L[1])):S.cross(g,L,W),K[0]=g[0],K[1]=g[1],K[2]=g[2],K[3]=k,E(K,K),K}e.fromUnitVec3=y;function b(K){var L=t();return L[0]=K[0],L[1]=K[1],L[2]=K[2],L[3]=K[3],L}e.clone=b;function x(K,L,W){return L[W+0]=K[0],L[W+1]=K[1],L[W+2]=K[2],L[W+3]=K[3],L}e.toArray=x;function C(K,L,W){return K[0]=L[W+0],K[1]=L[W+1],K[2]=L[W+2],K[3]=L[W+3],K}e.fromArray=C;function _(K,L){return K[0]=L[0],K[1]=L[1],K[2]=L[2],K[3]=L[3],K}e.copy=_;function w(K,L,W,k,V){return K[0]=L,K[1]=W,K[2]=k,K[3]=V,K}e.set=w;function T(K,L){return K[0]===L[0]&&K[1]===L[1]&&K[2]===L[2]&&K[3]===L[3]}e.exactEquals=T;function A(K,L){var W=K[0],k=K[1],V=K[2],G=K[3],H=L[0],X=L[1],Y=L[2],oe=L[3];return Math.abs(W-H)<=Ir*Math.max(1,Math.abs(W),Math.abs(H))&&Math.abs(k-X)<=Ir*Math.max(1,Math.abs(k),Math.abs(X))&&Math.abs(V-Y)<=Ir*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(G-oe)<=Ir*Math.max(1,Math.abs(G),Math.abs(oe))}e.equals=A;function D(K,L,W){return K[0]=L[0]+W[0],K[1]=L[1]+W[1],K[2]=L[2]+W[2],K[3]=L[3]+W[3],K}e.add=D;function E(K,L){var W=L[0],k=L[1],V=L[2],G=L[3],H=W*W+k*k+V*V+G*G;return H>0&&(H=1/Math.sqrt(H),K[0]=W*H,K[1]=k*H,K[2]=V*H,K[3]=G*H),K}e.normalize=E;var M=[0,0,0],F=[1,0,0],O=[0,1,0];function U(K,L,W){var k=S.dot(L,W);return k<-.999999?(S.cross(M,F,L),S.magnitude(M)<1e-6&&S.cross(M,O,L),S.normalize(M,M),o(K,M,Math.PI),K):k>.999999?(K[0]=0,K[1]=0,K[2]=0,K[3]=1,K):(S.cross(M,L,W),K[0]=M[0],K[1]=M[1],K[2]=M[2],K[3]=1+k,E(K,K))}e.rotationTo=U;var N=t(),q=t();function j(K,L,W,k,V,G){return m(N,L,V,G),m(q,W,k,G),m(K,N,q,2*G*(1-G)),K}e.sqlerp=j;var Q=[0,0,0,0,0,0,0,0,0];function J(K,L,W,k){return Q[0]=W[0],Q[3]=W[1],Q[6]=W[2],Q[1]=k[0],Q[4]=k[1],Q[7]=k[2],Q[2]=-L[0],Q[5]=-L[1],Q[8]=-L[2],E(K,h(K,Q))}e.setAxes=J;function te(K,L){return"[".concat(K[0].toPrecision(L)," ").concat(K[1].toPrecision(L)," ").concat(K[2].toPrecision(L),"  ").concat(K[3].toPrecision(L),"]")}e.toString=te,e.Identity=r()})(Gr||(Gr={}));var sr;(function(e){function t(C,_,w){for(var T=[],A=0;A<_.length;A++)T[A]=_[_.length-A-1];for(var D=[1],A=1;A<C.length;A++)D[A]=C[T[A-1]];return{dimensions:C,axisOrderFastToSlow:T,axisOrderSlowToFast:_,accessDimensions:D,defaultCtor:w||Float64Array}}function r(C,_){return{space:C,data:_}}e.create=r;function n(C,_,w){var T=t(C,_,w),A=m(T),D=A.get,E=A.set,M=A.add,F=A.dataOffset,O=A.getCoords;return{rank:C.length,dimensions:C,axisOrderSlowToFast:_,create:p(T),get:D,set:E,add:M,dataOffset:F,getCoords:O}}e.Space=n;function a(C){return C}e.Data1=a;function i(C,_){return n([C],[0],_)}e.Vector=i;function o(C,_,w){return n([C,_],[1,0],w)}e.ColumnMajorMatrix=o;function s(C,_,w){return n([C,_],[0,1],w)}e.RowMajorMatrix=s;function u(C,_,w){if(_.rank!==2)throw new Error("Invalid tensor rank");for(var T=Math.min(4,_.dimensions[0]),A=Math.min(4,_.dimensions[1]),D=0;D<T;D++)for(var E=0;E<A;E++)se.setValue(C,D,E,_.get(w,D,E));return C}e.toMat4=u;function c(C,_,w){if(_.rank!==2)throw new Error("Invalid tensor rank");for(var T=Math.min(3,_.dimensions[0]),A=Math.min(3,_.dimensions[1]),D=0;D<T;D++)for(var E=0;E<A;E++)dn.setValue(C,D,E,_.get(w,D,E));return C}e.toMat3=c;function l(C,_,w){if(_.rank!==1)throw new Error("Invalid tensor rank");for(var T=Math.min(3,_.dimensions[0]),A=0;A<T;A++)C[A]=w[A];return C}e.toVec3=l;function f(C,_,w){if(_.rank!==1)throw new Error("Invalid tensor rank");for(var T=Math.min(4,_.dimensions[0]),A=0;A<T;A++)C[A]=w[A];return C}e.toVec4=f;function d(C,_){var w=C.length;if(w!==_.length)return!1;for(var T=0;T<w;T++)if(C[T]!==_[T])return!1;return!0}e.areEqualExact=d;function m(C){var _=C.dimensions,w=C.axisOrderFastToSlow;switch(_.length){case 1:return{get:function(H,X){return H[X]},set:function(H,X,Y){return H[X]=Y},add:function(H,X,Y){return H[X]+=Y},dataOffset:function(H){return H},getCoords:function(H,X){return X[0]=H,X}};case 2:{if(w[0]===0&&w[1]===1){var T=_[0];return{get:function(H,X,Y){return H[Y*T+X]},set:function(H,X,Y,oe){return H[Y*T+X]=oe},add:function(H,X,Y,oe){return H[Y*T+X]+=oe},dataOffset:function(H,X){return X*T+H},getCoords:function(H,X){return X[0]=H%T,X[1]=Math.floor(H/T),X}}}if(w[0]===1&&w[1]===0){var A=_[1];return{get:function(H,X,Y){return H[X*A+Y]},set:function(H,X,Y,oe){return H[X*A+Y]=oe},add:function(H,X,Y,oe){return H[X*A+Y]+=oe},dataOffset:function(H,X){return H*A+X},getCoords:function(H,X){return X[0]=Math.floor(H/A),X[1]=H%A,X}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var D=_[0],E=_[1],M=D*E;return{get:function(H,X,Y,oe){return H[X+Y*D+oe*M]},set:function(H,X,Y,oe,ue){return H[X+Y*D+oe*M]=ue},add:function(H,X,Y,oe,ue){return H[X+Y*D+oe*M]+=ue},dataOffset:function(H,X,Y){return H+X*D+Y*M},getCoords:function(H,X){var Y=Math.floor(H/D);return X[0]=H%D,X[1]=Y%E,X[2]=Math.floor(Y/E),X}}}if(w[0]===0&&w[1]===2&&w[2]===1){var F=_[0],O=_[2],U=F*O;return{get:function(H,X,Y,oe){return H[X+oe*F+Y*U]},set:function(H,X,Y,oe,ue){return H[X+oe*F+Y*U]=ue},add:function(H,X,Y,oe,ue){return H[X+oe*F+Y*U]+=ue},dataOffset:function(H,X,Y){return H+Y*F+X*U},getCoords:function(H,X){var Y=Math.floor(H/F);return X[0]=H%F,X[1]=Math.floor(Y/O),X[2]=Y%O,X}}}if(w[0]===1&&w[1]===0&&w[2]===2){var N=_[1],q=_[0],j=N*q;return{get:function(H,X,Y,oe){return H[Y+X*N+oe*j]},set:function(H,X,Y,oe,ue){return H[Y+X*N+oe*j]=ue},add:function(H,X,Y,oe,ue){return H[Y+X*N+oe*j]+=ue},dataOffset:function(H,X,Y){return X+H*N+Y*j},getCoords:function(H,X){var Y=Math.floor(H/N);return X[0]=Y%q,X[1]=H%N,X[2]=Math.floor(Y/q),X}}}if(w[0]===1&&w[1]===2&&w[2]===0){var Q=_[1],J=_[2],te=Q*J;return{get:function(H,X,Y,oe){return H[Y+oe*Q+X*te]},set:function(H,X,Y,oe,ue){return H[Y+oe*Q+X*te]=ue},add:function(H,X,Y,oe,ue){return H[Y+oe*Q+X*te]+=ue},dataOffset:function(H,X,Y){return X+Y*Q+H*te},getCoords:function(H,X){var Y=Math.floor(H/Q);return X[0]=Math.floor(Y/J),X[1]=H%Q,X[2]=Y%J,X}}}if(w[0]===2&&w[1]===0&&w[2]===1){var K=_[2],L=_[0],W=K*L;return{get:function(H,X,Y,oe){return H[oe+X*K+Y*W]},set:function(H,X,Y,oe,ue){return H[oe+X*K+Y*W]=ue},add:function(H,X,Y,oe,ue){return H[oe+X*K+Y*W]+=ue},dataOffset:function(H,X,Y){return Y+H*K+X*W},getCoords:function(H,X){var Y=Math.floor(H/K);return X[0]=Y%L,X[1]=Math.floor(Y/L),X[2]=H%K,X}}}if(w[0]===2&&w[1]===1&&w[2]===0){var k=_[2],V=_[1],G=k*V;return{get:function(H,X,Y,oe){return H[oe+Y*k+X*G]},set:function(H,X,Y,oe,ue){return H[oe+Y*k+X*G]=ue},add:function(H,X,Y,oe,ue){return H[oe+Y*k+X*G]+=ue},dataOffset:function(H,X,Y){return Y+X*k+H*G},getCoords:function(H,X){var Y=Math.floor(H/k);return X[0]=Math.floor(Y/V),X[1]=Y%V,X[2]=H%k,X}}}throw new Error("bad axis order")}default:return{get:function(H){for(var X=[],Y=1;Y<arguments.length;Y++)X[Y-1]=arguments[Y];return H[v(C,X)]},set:function(H){for(var X=[],Y=1;Y<arguments.length;Y++)X[Y-1]=arguments[Y];return H[v(C,X)]=X[X.length-1]},add:function(H){for(var X=[],Y=1;Y<arguments.length;Y++)X[Y-1]=arguments[Y];return H[v(C,X)]+=X[X.length-1]},dataOffset:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return v(C,H)},getCoords:function(H,X){return h(C,H,X)}}}}function p(C){for(var _=C.dimensions,w=1,T=0,A=_.length;T<A;T++)w*=_[T];return function(D){return new(D||C.defaultCtor)(w)}}function v(C,_){for(var w=C.accessDimensions,T=C.axisOrderFastToSlow,A=w.length-1,D=w[A]*_[T[A]],E=A-1;E>=0;E--)D=(D+_[T[E]])*w[E];return D}function h(C,_,w){for(var T=C.dimensions,A=C.axisOrderFastToSlow,D=T.length,E=_,M=0;M<D;M++){var F=T[A[M]];w[A[M]]=E%F,E=Math.floor(E/F)}return w[A[D+1]]=E,w}function g(C){for(var _=[],w=0;w<C.length;w++)_[w]=C[C.length-w-1];return _}e.invertAxisOrder=g;function y(C,_){for(var w=[],T=0;T<C.length;T++)w[T]=C[_[T]];return w}function b(C){for(var _=new Int32Array(C.length),w=0;w<C.length;w++)_[C[w]]=w;return function(T){return y(T,_)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function x(C){for(var _=new Int32Array(C.length),w=0;w<C.length;w++)_[C[C.length-w-1]]=w;return function(T){return y(T,_)}}e.convertToCanonicalAxisIndicesSlowToFast=x})(sr||(sr={}));var py=Object.prototype.hasOwnProperty;function sj(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];!py.call(t,a)||typeof e[a]=="undefined"&&(e[a]=t[a])}return e}function uj(e,t){for(var r=!1,n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];if(!!py.call(t,i)&&t[i]!==e[i]){r=!0;break}}return r?Object.assign({},e,t):e}function KC(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,a=r;n<a.length;n++){var i=a[n];if(!py.call(e,i)||e[i]!==t[i])return!1}return!0}function cj(e,t){for(var r=e,n=0;n<t.length;n++)if(!!t[n]&&(r=uj(e,t[n]),r!==e)){for(var a=n+1;a<t.length;a++)r=Object.assign(r,t[a]);break}return r}function ol(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=ol(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var a in e)py.call(e,a)&&(t[a]=ol(e[a]));return t}throw new Error(`Can't clone, type "`.concat(typeof e,'" unsupported'))}function wo(e,t){if(!!e)for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t(e[a],a)}}function lj(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1".concat(t,"$2"))}var fj=function(e){return e.toUpperCase()};function dj(e){return e?typeof e=="string"?e.toUpperCase():"".concat(e).toUpperCase():""}function vy(e){return e.toLowerCase().replace(/^\w|\s\w/g,fj)}function mj(e){return e.replace(/_/g," ")}function pj(e){return e.replace(/-/g," ")}function Ao(e){return vy(lj(mj(pj(e))))}function Bn(e,t,r,n){var a=n.length;if(a>r-t)return!1;for(var i=0;i<a;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function vj(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Ht(Ht([void 0],r,!1),["return `".concat(e,"`;")],!1)))().apply(void 0,n)}function QC(e){return e.replace(/<\/?[^>]+>/g,"")}function ha(){return ha.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,E,M){var F=t();return F[0]=D,F[1]=E,F[2]=M,F}e.create=r;function n(D,E){var M=st.toRgb(E),F=M[0],O=M[1],U=M[2],N=A(F,O,U),q=N[0],j=N[1],Q=N[2],J=116*j-16;return D[0]=J<0?0:J,D[1]=500*(q-j),D[2]=200*(j-Q),D}e.fromColor=n;function a(D,E){return qs.toLab(D,E)}e.fromHcl=a;function i(D){var E=(D[0]+16)/116,M=isNaN(D[1])?E:E+D[1]/500,F=isNaN(D[2])?E:E-D[2]/200;E=v*_(E),M=p*_(M),F=h*_(F);var O=C(3.2404542*M-1.5371385*E-.4985314*F),U=C(-.969266*M+1.8760108*E+.041556*F),N=C(.0556434*M-.2040259*E+1.0572252*F);return st.fromRgb(Math.round(Ra(O,0,255)),Math.round(Ra(U,0,255)),Math.round(Ra(N,0,255)))}e.toColor=i;function o(D,E){var M=E[0],F=E[1],O=E[2],U=Math.sqrt(F*F+O*O),N=(ps(Math.atan2(O,F))+360)%360;return Math.round(U*1e4)===0&&(N=Number.NaN),D[0]=N,D[1]=U,D[2]=M,D}e.toHcl=o;function s(D,E){return D[0]=E[0],D[1]=E[1],D[2]=E[2],D}e.copy=s;function u(D,E,M){return D[0]=E[0]-m*M,D[1]=E[1],D[2]=E[2],D}e.darken=u;function c(D,E,M){return u(D,E,-M)}e.lighten=c;var l=[0,0,0];function f(D,E,M){return o(l,E),qs.toLab(D,qs.saturate(l,l,M))}e.saturate=f;function d(D,E,M){return f(D,E,-M)}e.desaturate=d;var m=18,p=.95047,v=1,h=1.08883,g=.137931034,y=.206896552,b=.12841855,x=.008856452;function C(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function _(D){return D>y?D*D*D:b*(D-g)}function w(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function T(D){return D>x?Math.pow(D,1/3):D/b+g}function A(D,E,M){D=w(D),E=w(E),M=w(M);var F=T((.4124564*D+.3575761*E+.1804375*M)/p),O=T((.2126729*D+.7151522*E+.072175*M)/v),U=T((.0193339*D+.119192*E+.9503041*M)/h);return[F,O,U]}})(ha||(ha={}));function qs(){return qs.zero()}(function(e){function t(){var h=[.1,0,0];return h[0]=0,h}e.zero=t;function r(h,g,y){var b=t();return b[0]=h,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function a(h,g){return ha.toHcl(h,ha.fromColor(n,g))}e.fromColor=a;function i(h,g){return ha.toHcl(h,g)}e.fromLab=i;var o=[0,0,0];function s(h){return ha.toColor(u(o,h))}e.toColor=s;function u(h,g){var y=g[0],b=g[1],x=g[2];return isNaN(y)&&(y=0),y=pr(y),h[0]=x,h[1]=Math.cos(y)*b,h[2]=Math.sin(y)*b,h}e.toLab=u;function c(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h}e.copy=c;function l(h,g,y){return h[0]=g[0],h[1]=Math.max(0,g[1]+v*y),h[2]=g[2],h}e.saturate=l;function f(h,g,y){return l(h,g,-y)}e.desaturate=f;var d=[0,0,0];function m(h,g,y){return u(d,g),ha.toHcl(h,ha.darken(d,d,y))}e.darken=m;function p(h,g,y){return m(h,g,-y)}e.lighten=p;var v=18})(qs||(qs={}));function st(e){return e}(function(e){function t(A){return"rgb(".concat(A>>16&255,", ").concat(A>>8&255,", ").concat(A&255,")")}e.toStyle=t;function r(A){return"0x"+("000000"+A.toString(16)).slice(-6)}e.toHexString=r;function n(A){return"RGB: ".concat(e.toRgb(A).join(", "))}e.toRgbString=n;function a(A){return[A>>16&255,A>>8&255,A&255]}e.toRgb=a;function i(A){return[(A>>16&255)/255,(A>>8&255)/255,(A&255)/255]}e.toRgbNormalized=i;function o(A,D,E){return A<<16|D<<8|E}e.fromRgb=o;function s(A,D,E){return A*255<<16|D*255<<8|E*255}e.fromNormalizedRgb=s;function u(A,D){return o(A[D],A[D+1],A[D+2])}e.fromArray=u;function c(A,D){return s(A[D],A[D+1],A[D+2])}e.fromNormalizedArray=c;function l(A,D,E){return D[E]=A>>16&255,D[E+1]=A>>8&255,D[E+2]=A&255,D}e.toArray=l;function f(A,D,E){return D[E]=(A>>16&255)/255,D[E+1]=(A>>8&255)/255,D[E+2]=(A&255)/255,D}e.toArrayNormalized=f;function d(A,D){return A[0]=D>>16&255,A[1]=D>>8&255,A[2]=D&255,A}e.toVec3=d;function m(A,D){return A[0]=(D>>16&255)/255,A[1]=(D>>8&255)/255,A[2]=(D&255)/255,A}e.toVec3Normalized=m;function p(A,D,E){var M=A>>16&255,F=A>>8&255,O=A&255,U=D>>16&255,N=D>>8&255,q=D&255,j=M+(U-M)*E,Q=F+(N-F)*E,J=O+(q-O)*E;return j<<16|Q<<8|J}e.interpolate=p;var v=[0,0,0];function h(A,D){return qs.fromColor(v,A),qs.toColor(qs.saturate(v,v,D))}e.saturate=h;function g(A,D){return h(A,-D)}e.desaturate=g;var y=[0,0,0];function b(A,D){return ha.fromColor(y,A),ha.toColor(ha.darken(y,y,D))}e.darken=b;function x(A,D){return b(A,-D)}e.lighten=x;function C(A){return A<.04045?A*.0773993808:Math.pow(A*.9478672986+.0521327014,2.4)}function _(A){return s(C((A>>16&255)/255),C((A>>8&255)/255),C((A&255)/255))}e.sRGBToLinear=_;function w(A){return A<.0031308?A*12.92:1.055*Math.pow(A,.41666)-.055}function T(A){return s(w((A>>16&255)/255),w((A>>8&255)/255),w((A&255)/255))}e.linearToSRGB=T})(st||(st={}));function er(e,t,r,n){return{label:e,description:r,list:n,type:t}}function Pf(e){return e}function hy(e,t,r){var n={};for(var a in e){var i=e[a];i=st.saturate(i,t),i=st.darken(i,-r),n[a]=i}return n}var Di={"orange-red":er("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":er("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":er("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:er("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":er("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":er("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":er("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:er("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":er("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:er("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":er("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:er("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":er("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:er("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":er("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":er("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:er("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":er("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:er("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":er("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":er("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":er("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":er("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":er("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":er("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":er("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":er("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":er("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:er("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":er("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":er("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":er("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:er("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":er("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":er("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":er("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:er("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:er("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:er("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:er("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:er("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:er("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:er("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:er("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":er("Red-White-Blue","diverging","",[12526114,16777215,3367393])},hj=Object.keys(Di),eM=hj.map(function(e){return[e,Di[e].label,vy(Di[e].type)]});eM.filter(function(e){return Di[e[0]].type==="diverging"||Di[e[0]].type==="sequential"});eM.filter(function(e){return Di[e[0]].type==="qualitative"});function Mu(e){return e in Di?Di[e]:(console.warn("unknown color list named '".concat(e,"'")),Di["red-yellow-blue"])}var Me;(function(e){function t(d){return d.creator&&d.chunkSize}e.is=t;function r(d){var m=d.growBy*d.elementSize;d.currentSize=m,d.currentIndex=0,d.currentChunk=new d.ctor(m),d.allocatedSize+=m,d.chunks[d.chunks.length]=d.currentChunk}function n(d,m,p,v,h){d.currentIndex>=d.currentSize&&r(d);var g=d.currentChunk,y=d.currentIndex;return g[y]=m,g[y+1]=p,g[y+2]=v,g[y+3]=h,d.currentIndex+=4,d.elementCount++}e.add4=n;function a(d,m,p,v){d.currentIndex>=d.currentSize&&r(d);var h=d.currentChunk,g=d.currentIndex;return h[g]=m,h[g+1]=p,h[g+2]=v,d.currentIndex+=3,d.elementCount++}e.add3=a;function i(d,m,p){d.currentIndex>=d.currentSize&&r(d);var v=d.currentChunk,h=d.currentIndex;return v[h]=m,v[h+1]=p,d.currentIndex+=2,d.elementCount++}e.add2=i;function o(d,m){return d.currentIndex>=d.currentSize&&r(d),d.currentChunk[d.currentIndex]=m,d.currentIndex+=1,d.elementCount++}e.add=o;function s(d,m,p){for(var v=0;v<m;v++)d.currentIndex>=d.currentSize&&r(d),d.currentChunk[d.currentIndex++]=p,d.elementCount++;return d.elementCount}e.addRepeat=s;function u(d,m){for(var p=d.elementSize,v=0,h=m.length;v<h;v+=p){d.currentIndex>=d.currentSize&&r(d);for(var g=d.currentChunk,y=0;y<p;y++)g[d.currentIndex++]=m[v+y];d.elementCount++}return d.elementCount}e.addMany=u;function c(d,m){return m===void 0&&(m=!1),l(d,m)}e.compact=c;function l(d,m){var p=d.ctor,v=d.chunks,h=d.currentIndex;if(!v.length)return new p(0);if(v.length===1&&(m||h===d.allocatedSize))return v[0];for(var g=0,y=0,b=v.length-1;y<b;y++)g+=v[y].length;g+=d.currentIndex;var x=new p(g),C=0;if(x.buffer)for(var y=0,b=v.length-1;y<b;y++)x.set(v[y],C),C+=v[y].length;else for(var y=0,b=v.length-1;y<b;y++){for(var _=v[y],w=0,T=_.length;w<T;w++)x[C+w]=_[w];C+=_.length}var A=v[v.length-1];if(x.buffer&&h>=d.currentSize)x.set(A,C);else for(var w=0,T=A.length;w<T;w++)x[C+w]=A[w];return x}e._compact=l;function f(d,m,p,v){var h={ctor:d,elementSize:m,growBy:Math.max(1,Math.ceil(p)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof v=="undefined")return h;if(typeof v=="number")return h.currentChunk=new d(v*m),h.allocatedSize=v*m,h.currentSize=h.currentChunk.length,h.chunks[0]=h.currentChunk,h;var g=v;if(g.length%m!=0)throw new Error("initialChunk length must be a multiple of the element size.");return h.currentChunk=g,h.allocatedSize=g.length,h.currentSize=g.length,h.chunks[0]=g,h}e.create=f})(Me||(Me={}));function gy(e,t,r){return e[t]-e[r]}function Ef(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function tM(e,t,r,n){var a=r+n>>1;return t(e,r,n)>0?t(e,r,a)>0?t(e,a,n)>0?a:n:r:t(e,n,a)>0?t(e,a,r)>0?a:r:n}function gj(e,t,r){var n=e.cmp,a=e.swap,i=e.data,o=e.parts,s=t+1,u=r;for(a(i,t,tM(i,n,t,r));n(i,u,t)>0;)--u;for(var c=t+1;c<=u;c++){var l=n(i,c,t);if(l>0){for(a(i,c,u),--u;n(i,u,t)>0;)--u;c--}else l===0&&(a(i,c,s),s++)}for(var c=t;c<s;c++)a(i,c,t+u-c);o[0]=u-s+t+1,o[1]=u}function yj(e,t,r){for(var n=e.data,a=e.cmp,i=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&a(n,s,s+1)>0;)i(n,s,s+1),s=s-1}function yy(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){yj(e,t,r);return}gj(e,t,r);var a=n[0],i=n[1];a-t<r-i?(yy(e,t,a-1),t=i+1):(yy(e,i+1,r),r=a-1)}}function bj(e,t,r,n){var a=r+1,i=n;Ef(e,r,tM(e,gy,r,n));for(var o=e[r];e[i]>o;)--i;for(var s=r+1;s<=i;s++){var u=e[s];if(u>o){for(Ef(e,s,i),--i;e[i]>o;)--i;s--}else u===o&&(Ef(e,s,a),++a)}for(var s=r;s<a;s++)Ef(e,s,r+i-s);t[0]=i-a+r+1,t[1]=i}function xj(e,t,r){for(var n=t+1;n<=r;n++){for(var a=e[n],i=n-1;i>=t&&e[i]>a;)e[i+1]=e[i],i=i-1;e[i+1]=a}}function ZC(e,t,r,n){for(;r<n;){if(n-r<16){xj(e,r,n);return}bj(e,t,r,n);var a=t[0],i=t[1];a-r<n-i?(ZC(e,t,r,a-1),r=i+1):(ZC(e,t,i+1,n),n=a-1)}}function vs(e,t){return t===void 0&&(t=gy),Sj(e,0,e.length,t)}function Sj(e,t,r,n){return n===void 0&&(n=gy),n===gy?ZC(e,[0,0],t,r-1):yy({data:e,cmp:n,swap:Ef,parts:[0,0]},t,r-1),e}function rM(e,t,r,n,a){var i={data:e,cmp:n,swap:a,parts:[0,0]};return yy(i,t,r-1),e}function Cj(e,t,r){return e[t].key<e[r].key?-1:1}function _j(e,t,r,n,a){for(var i=new Map,o=[],s=t(e[0]),u=!0,c=n;c<a;c++){var l=t(e[c]);if(i.has(l))i.get(l).count++,s!==l&&(u=!1);else{var f={key:l,count:1,offset:c};i.set(l,f),o[o.length]=f}s=l}var d=new Int32Array(o.length+1);d[o.length]=a;var m=!0;if(r){for(var c=1,p=o.length;c<p;c++)if(o[c-1].key>o[c].key){m=!1;break}}if(u&&m){for(var c=0;c<o.length;c++)d[c]=o[c].offset;return d}r&&!m&&rM(o,0,o.length,Cj,Ef);for(var v=0,c=0;c<o.length;c++){var h=o[c];h.offset=v,v+=h.count}for(var g=new Int32Array(a-n),c=n;c<a;c++){var l=t(e[c]),f=i.get(l);g[f.offset++]=e[c]}for(var c=0,p=g.length;c<p;c++)e[c+n]=g[c];d[0]=n;for(var c=1;c<o.length;c++)d[c]=o[c-1].offset+n;return d}function $C(e,t,r){var n=r&&r.start||0,a=r&&r.end||e.length;if(a-n<=0)throw new Error("Can only bucket non-empty collections.");return _j(e,t,!!(r&&r.sort),n,a)}var wj=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,a=[t];return this.groups[n]=a,{id:n,keys:a,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var a=this.byHash.get(n),i=0,o=a.length;i<o;i++){var s=a[i];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return a[a.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function Aj(e,t){return new wj(e,t)}function nM(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function If(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function Tj(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function Pj(e,t,r,n){var a=23;return a=31*a+e|0,a=31*a+t|0,a=31*a+r|0,a=31*a+n|0,a=a^a>>4,a=(a^3735928559)+(a<<5),a=a^a>>11,a}function JC(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function To(e,t){return(e+t)*(e+t+1)/2+t}function aM(e,t){return e<t?To(e,t):To(t,e)}function Ej(e,t){var r=Math.floor((Math.sqrt(8*t+1)-1)/2),n=(r*r+r)/2,a=t-n;return e[0]=r-a,e[1]=a,e}function Wa(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function by(e,t){var r=t&&typeof t.start!="undefined"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end!="undefined"?Math.min(t.end,e):e;return{start:r,end:n}}function ah(e,t){var r=t&&typeof t.array!="undefined"?t.array:Array,n=by(e,t),a=n.start,i=n.end;return{array:new r(i-a),start:a,end:i}}function Ij(e,t,r){for(var n=0,a=t.length;n<a;n++)t[n]=e(r+n);return t}function ga(e,t,r){var n=ah(e,r),a=n.array,i=n.start;return Ij(t,a,i)}function e3(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function xy(e,t){var r=e.constructor,n=e.buffer,a=e.length,i=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=by(a,t),u=s.start,c=s.end;return u===0&&c===a?e:new r(n,i+o*u,Math.min(a,c-u))}function Df(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return sl(e,t,r)}function sl(e,t,r){var n=t,a=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return i*a|0;a=10*a+o|0}return i*a}function iM(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,sl(t,r,n))}function Dj(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Ru(e,t,r)}function Ru(e,t,r){var n=t,a=1,i=0,o=0,s=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)i=i*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?iM(a*(i+o/s),e,n+1,r):a*(i+o/s);return a*(i+o/s)}else{if(u===53||u===21)return iM(a*i,e,n+1,r);break}}return a*i}var ce;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function E(Q){return Q===void 0&&(Q=""),{"@type":"str",T:Q,valueType:"str"}}D.Str=E;function M(Q){return Q===void 0&&(Q=0),{"@type":"int",T:Q,valueType:"int"}}D.Int=M;function F(Q){return Q===void 0&&(Q=0),{"@type":"float",T:Q,valueType:"float"}}D.Float=F;function O(Q,J){return J===void 0&&(J=D.float),{"@type":"tensor",T:Q.create(),space:Q,valueType:"tensor",baseType:J}}D.Tensor=O;function U(Q,J){return J===void 0&&(J=D.float),O(sr.Vector(Q,J["@type"]==="int"?Int32Array:Float64Array),J)}D.Vector=U;function N(Q,J,te){return te===void 0&&(te=D.float),O(sr.ColumnMajorMatrix(Q,J,te["@type"]==="int"?Int32Array:Float64Array),te)}D.Matrix=N;function q(Q,J){return typeof J!="undefined"?I(I({},Q),{T:J}):Q}D.Aliased=q;function j(Q,J,te){return te===void 0&&(te=[]),{"@type":"list",T:te,separator:Q,itemParse:J,valueType:"list"}}D.List=j})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,E){return oM(E.T,D,E,1)}e.Undefined=n;function a(D,E,M){return oM(D,E,M,0)}e.ofConst=a;function i(D){return Sy(D)}e.ofLambda=i;function o(D,E){return i({value:function(M){return M+D},rowCount:Math.max(E-D+1,0),schema:t.int})}e.range=o;function s(D){return Bu(D)}e.ofArray=s;function u(D){return Bu({array:D,schema:t.int})}e.ofIntArray=u;function c(D){return Bu({array:D,schema:t.float})}e.ofFloatArray=c;function l(D){return Bu({array:D,schema:t.str})}e.ofStringArray=l;function f(D){return Bu({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=f;function d(D,E){return E===void 0&&(E=","),Bu({array:D,schema:t.List(E,function(M){return M})})}e.ofStringListArray=d;function m(D){var E=D.count,M=D.data,F=D.indices;return Sy({value:function(O){return sl(M,F[2*O],F[2*O+1])||0},rowCount:E,schema:t.int})}e.ofIntTokens=m;function p(D){var E=D.count,M=D.data,F=D.indices;return Sy({value:function(O){return Ru(M,F[2*O],F[2*O+1])||0},rowCount:E,schema:t.float})}e.ofFloatTokens=p;function v(D){var E=D.count,M=D.data,F=D.indices;return Sy({value:function(O){var U=M.substring(F[2*O],F[2*O+1]);return U==="."||U==="?"?"":U},rowCount:E,schema:t.str})}e.ofStringTokens=v;function h(D,E,M){return Bj(D,E,M)}e.window=h;function g(D,E,M){return M===void 0&&(M=!0),Lj(D,E,M)}e.view=g;function y(D){return Mj(D)}e.createFirstIndexMap=y;function b(D){return Rj(D)}e.createIndexer=b;function x(D,E,M){return zj(D,E,M||Array)}e.mapToArray=x;function C(D,E){return Vj(D,E)}e.areEqual=C;function _(D,E){return qj(D,E)}e.indicesOf=_;function w(D,E){return D.__array?D:D.isDefined?Bu({array:D.toArray({array:E}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=w;function T(D,E,M){if(M===void 0&&(M=0),!!D.isDefined){var F=D.__array;if(F)for(var O=0,U=F.length;O<U;O++)E[M+O]=F[O];else for(var O=0,U=D.rowCount;O<U;O++)E[M+O]=D.value(O)}}e.copyToArray=T;function A(D){for(var E=0,M=D.rowCount;E<M;E++)if(E!==D.value(E))return!1;return!0}e.isIdentity=A})(ce||(ce={}));function Mj(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return t}function Rj(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var a=e.value(r);t.has(a)||t.set(e.value(r),r)}return function(i){return t.has(i)?t.get(i):-1}}function oM(e,t,r,n){var a=function(i){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:a,valueKind:function(i){return n},toArray:function(i){for(var o=ah(t,i).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(i,o){return!0}}}function Sy(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,a=e.rowCount,i=e.schema;return{schema:i,__array:void 0,isDefined:!0,rowCount:a,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=ah(a,o),u=s.array,c=s.start,l=0,f=u.length;l<f;l++)u[l]=t(l+c);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function Bu(e){var t=e.array,r=e.schema,n=e.valueKind,a=t.length,i=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=e3(t);return{schema:r,__array:t,isDefined:!0,rowCount:a,value:i,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=by(a,s),c=u.start,l=u.end,f=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(l-c),d=0,m=l-c;d<m;d++){var p=t[c+d];f[d]=typeof p=="string"?p:""+p}return f}:o?function(s){return xy(t,s)}:function(s){var u=by(a,s),c=u.start,l=u.end;if(c===0&&l===t.length)return t;for(var f=new(s&&typeof s.array!="undefined"?s.array:t.constructor)(l-c),d=0,m=l-c;d<m;d++)f[d]=t[c+d];return f},areValuesEqual:function(s,u){return t[s]===t[u]}}}function Bj(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:!!e.__array&&e3(e.__array)?Fj(e,t,r):Oj(e,t,r):ce.Undefined(r-t,e.schema)}function Fj(e,t,r){var n=xy(e.__array,{start:t,end:r}),a=e.valueKind;return Bu({array:n,schema:e.schema,valueKind:function(i){return a(t+i)}})}function Oj(e,t,r){var n=e.value,a=e.valueKind,i=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?a:function(u){return a(u+t)},toArray:function(u){for(var c=ah(s,u).array,l=0,f=c.length;l<f;l++)c[l]=n(l+t);return c},areValuesEqual:t===0?i:function(u,c){return i(u+t,c+t)}}}function kj(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function Lj(e,t,r){return e.rowCount===0||r&&kj(t,e.rowCount)?e:!!e.__array&&typeof e.value(0)==typeof e.__array[0]?Nj(e,t):Uj(e,t)}function Nj(e,t){for(var r=e.__array,n=new r.constructor(t.length),a=0,i=t.length;a<i;a++)n[a]=r[t[a]];var o=e.valueKind;return Bu({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function Uj(e,t){var r=e.value,n=e.valueKind,a=e.areValuesEqual,i=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:i,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=ah(o,s).array,c=0,l=u.length;c<l;c++)u[c]=r(t[c]);return u},areValuesEqual:function(s,u){return a(t[s],t[u])}}}function zj(e,t,r){for(var n=new r(e.rowCount),a=0,i=e.rowCount;a<i;a++)n[a]=t(e.value(a));return n}function Vj(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:!!e.__array&&!!t.__array?Gj(e,t):Hj(e,t)}function Gj(e,t){for(var r=e.__array,n=t.__array,a=0,i=e.rowCount;a<i;a++)if(r[a]!==n[a])return!1;return!0}function Hj(e,t){for(var r=e.value,n=t.value,a=0,i=e.rowCount;a<i;a++)if(r(a)!==n(a))return!1;return!0}function qj(e,t){for(var r=[],n=e.value,a=0,i=e.rowCount;a<i;a++)t(n(a))&&(r[r.length]=a);return r}var Ar;(function(e){function t(x){return x&&typeof x._rowCount=="number"&&!!x._columns&&!!x._schema}e.is=t;function r(x,C,_){_===void 0&&(_={});var w=Object.create(null),T=Object.keys(x);w._rowCount=C._rowCount,w._columns=T,w._schema=x;for(var A=0,D=T;A<D.length;A++){var E=D[A];if(C[E])w[E]=C[E];else if(_[E])w[E]=_[E];else throw Error("Cannot find column '".concat(E,"'."))}return w}e.pickColumns=r;function n(x,C){var _=Object.keys(C),w=C[_[0]].rowCount;return I({_rowCount:w,_columns:_,_schema:x},C)}e.ofColumns=n;function a(x,C,_){var w=Object.create(null),T=Object.keys(x);w._rowCount=_,w._columns=T,w._schema=x;for(var A=0,D=T;A<D.length;A++){var E=D[A];E in C?w[E]=C[E]:w[E]=ce.Undefined(_,x[E])}return w}e.ofPartialColumns=a;function i(x,C){var _=Object.create(null),w=Object.keys(x);_._rowCount=C,_._columns=w,_._schema=x;for(var T=0,A=w;T<A.length;T++){var D=A[T];_[D]=ce.Undefined(C,x[D])}return _}e.ofUndefinedColumns=i;function o(x,C){var _=Object.create(null),w=C.length,T=Object.keys(x);_._rowCount=w,_._columns=T,_._schema=x;for(var A=function(F){_[F]=ce.ofLambda({rowCount:w,schema:x[F],value:function(O){return C[O][F]},valueKind:function(O){return typeof C[O][F]=="undefined"?1:0}})},D=0,E=T;D<E.length;D++){var M=E[D];A(M)}return _}e.ofRows=o;function s(x,C){var _,w=Object.create(null),T=Object.keys(x);w._rowCount=0,w._columns=T,w._schema=x;for(var A=0,D=T;A<D.length;A++){var E=D[A];typeof C[E]!="undefined"?(w[E]=ce.ofArray({array:C[E],schema:x[E]}),w._rowCount=(_=C[E])===null||_===void 0?void 0:_.length):w[E]=ce.Undefined(w._rowCount,x[E])}return w}e.ofArrays=s;function u(x,C,_){var w=Object.create(null),T=Object.keys(C);w._rowCount=_.length,w._columns=T,w._schema=C;for(var A=0,D=T;A<D.length;A++){var E=D[A];w[E]=ce.view(x[E],_)}return w}e.view=u;function c(x,C,_){for(var w=[],T=0,A=x._rowCount;T<A;++T)_(T)&&w.push(T);return u(x,C,w)}e.pick=c;function l(x,C,_,w){if(_===0&&w===x._rowCount)return x;var T=Object.create(null),A=Object.keys(C);T._rowCount=w-_,T._columns=A,T._schema=C;for(var D=0,E=A;D<E.length;D++){var M=E[D];T[M]=ce.window(x[M],_,w)}return T}e.window=l;function f(x,C){var _=Object.create(null),w=Object.keys(C);_._rowCount=0;for(var T=0,A=x;T<A.length;T++){var D=A[T];_._rowCount+=D._rowCount}for(var E={},M=0,F=w;M<F.length;M++){var O=F[M];E[O]=new Array(_._rowCount)}_._columns=w,_._schema=C;for(var U=0,N=0,q=x;N<q.length;N++){for(var D=q[N],j=0,Q=w;j<Q.length;j++){var J=Q[j];ce.copyToArray(D[J],E[J],U)}U+=D._rowCount}for(var te=0,K=w;te<K.length;te++){var J=K[te];_[J]=ce.ofArray({array:E[J],schema:C[J]})}return _}e.concat=f;function d(x,C,_){x[C]=ce.asArrayColumn(x[C],_)}e.columnToArray=d;function m(x,C){for(var _=new Int32Array(x._rowCount),w=0,T=_.length;w<T;w++)_[w]=w;vs(_,function(O,U,N){return C(U,N)});for(var A=!0,w=0,T=_.length;w<T;w++)if(_[w]!==w){A=!1;break}if(A)return x;var D=Object.create(null);D._rowCount=x._rowCount,D._columns=x._columns,D._schema=x._schema;for(var E=0,M=x._columns;E<M.length;E++){var F=M[E];D[F]=ce.view(x[F],_,!1)}return D}e.sort=m;function p(x,C){if(x._rowCount!==C._rowCount||x._columns.length!==C._columns.length)return!1;for(var _=0,w=x._columns;_<w.length;_++){var T=w[_];if(!C[T])return!1}for(var A=0,D=x._columns;A<D.length;A++){var T=D[A];if(!ce.areEqual(x[T],C[T]))return!1}return!0}e.areEqual=p;function v(x,C){for(var _=Object.create(null),w=x._columns,T=0;T<w.length;T++){var A=w[T];_[A]=x[A].value(C)}return _}e.getRow=v;function h(x,C){for(var _=0,w=x._rowCount;_<w;++_)if(C(_))return v(x,_)}e.pickRow=h;function g(x){for(var C=[],_=x._rowCount,w=0;w<_;w++)C[w]=v(x,w);return C}e.getRows=g;function y(x){for(var C={},_=x._columns,w=0;w<_.length;w++){var T=_[w];C[T]=x[T].toArray()}return C}e.toArrays=y;function b(x){var C=mr.create(),_=x._columns,w=x._rowCount,T=1;mr.write(C,"|");for(var A=0;A<_.length;A++)mr.write(C,_[A]),mr.write(C,"|"),T+=_[A].length+1;mr.newline(C),mr.write(C,new Array(T+1).join("-")),mr.newline(C);for(var D=0;D<w;D++){mr.write(C,"|");for(var A=0;A<_.length;A++){var E=x[_[A]];E.valueKind(D)===0?(mr.write(C,E.value(D)),mr.write(C,"|")):mr.write(C,".|")}mr.newline(C)}return mr.getString(C)}e.formatToString=b})(Ar||(Ar={}));var t3;(function(e){function t(n,a,i){var o=Object.keys(i),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=a;for(var c=0,l=o;c<l.length;c++){var f=l[c];!Ar.is(i[f])||(s[f]=i[f],u[u.length]=f)}return s}e.ofTables=t;function r(n){for(var a={},i=0,o=n._tableNames;i<o.length;i++){var s=o[i];a[s]=Ar.getRows(n[s])}return a}e.getTablesAsRows=r})(t3||(t3={}));function r3(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function Cy(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,a=r.value;if(n)break;t[t.length]=a}return t}function n3(e,t,r){for(var n=t-e+1,a=r?new r(n):new Int32Array(n),i=0;i<n;i++)a[i]=i+e;return a}function jj(e,t){for(var r=new(Wj(e))(t.length),n=0,a=t.length;n<a;n++)r[n]=e[t[n]];return r}function Wj(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}function Xj(){var e=function(){var v=typeof window!="undefined"&&window,h=typeof self!="undefined"&&typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&self,g=typeof e!="undefined"&&e;return v||g||h}(),t={},r=typeof document!="undefined"?document:void 0,n=1,a;function i(v){for(var h=[],g=1;g<arguments.length;g++)h[g-1]=arguments[g];typeof v!="function"&&(v=new Function(""+v));var y={callback:v,args:h};return t[n]=y,a(n),n++}function o(v){delete t[v]}function s(v){var h=v.callback,g=v.args;switch(g.length){case 0:h();break;case 1:h(g[0]);break;case 2:h(g[0],g[1]);break;case 3:h(g[0],g[1],g[2]);break;default:h.apply(void 0,g);break}}function u(v){var h=t[v];o(v),s(h)}function c(){a=function(v){process.nextTick(function(){u(v)})}}function l(){if(e&&e.postMessage&&!e.importScripts){var v=!0,h=e.onmessage;return e.onmessage=function(){v=!1},e.postMessage("","*"),e.onmessage=h,v}}function f(){var v="setImmediate$"+Math.random()+"$",h=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(v)===0&&u(+g.data.slice(v.length))};window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent("onmessage",h),a=function(g){window.postMessage(v+g,"*")}}function d(){var v=new MessageChannel;v.port1.onmessage=function(h){var g=h.data;u(g)},a=function(h){v.port2.postMessage(h)}}function m(){var v=r.documentElement;a=function(h){var g=r.createElement("script");g.onreadystatechange=function(){u(h),g.onreadystatechange=null,v.removeChild(g),g=null},v.appendChild(g)}}function p(){a=function(v){setTimeout(u,0,v)}}return typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?c():l()?f():typeof MessageChannel!="undefined"?d():r&&"onreadystatechange"in r.createElement("script")?m():p(),{setImmediate:i,clearImmediate:o}}var a3=function(){return typeof setImmediate!="undefined"?typeof window!="undefined"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Ht([e],r,!1))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:Xj()}();function Yj(e){a3.setImmediate(e)}var i3={setImmediate:a3.setImmediate,clearImmediate:a3.clearImmediate,immediatePromise:function(){return new Promise(Yj)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},ih=function(){try{return!0}catch{return!1}}(),hr=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),Kj=typeof performance!="undefined"&&performance.mark&&performance.measure,o3=Kj&&!ih,oh;(function(e){function t(o){return"startTask".concat(o.id)}function r(o){return"endTask".concat(o.id)}function n(o){o3&&performance.mark(t(o))}e.markStart=n;function a(o){o3&&performance.mark(r(o))}e.markEnd=a;function i(o){o3&&performance.measure("\u2733\uFE0F ".concat(o.name),t(o),r(o))}e.measure=i})(oh||(oh={}));function Qj(e,t,r){r===void 0&&(r=250);var n=cM(e,t,r),a=new vM(n,n.root);return s3(e,a)}function Zj(e,t,r){r===void 0&&(r=250);var n=cM(e,t,r);return new vM(n,n.root)}function sM(e,t){return s3(t,e)}function $j(e,t,r){return e.runChild(t,r)}function uM(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function cM(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:en(),observer:t,abortToken:n,taskId:e.id,root:{progress:uM(e),children:[]},tryAbort:Jj(n)}}function Jj(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function lM(e){return{progress:I({},e.progress),children:e.children.map(lM)}}function fM(e){return e.progress.canAbort&&e.children.every(fM)}function eW(e){return{root:lM(e.root),canAbort:fM(e.root),requestAbort:e.tryAbort}}function s3(e,t){return ie(this,void 0,void 0,function(){var r,n;return ae(this,function(a){switch(a.label){case 0:oh.markStart(e),t.node.progress.startedTime=en(),a.label=1;case 1:return a.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=a.sent(),oh.markEnd(e),oh.measure(e),t.info.abortToken.abortRequested&&dM(t.info),[2,r];case 3:return n=a.sent(),Be.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(i){t.onChildrenFinished=i})]:[3,5]):[3,6];case 4:a.sent(),a.label=5;case 5:e.onAbort&&e.onAbort(),a.label=6;case 6:throw n;case 7:return[2]}})})}function dM(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,mM(e.root),pM(e,en())),Be.Aborted(e.abortToken.reason)}function mM(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var a=n[r];mM(a)}}function pM(e,t){e.lastNotified=t;var r=eW(e);e.observer(r)}var vM=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,dM(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),en()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort!="undefined"&&(r.canAbort=t.canAbort),typeof t.message!="undefined"&&(r.message=t.message),typeof t.current!="undefined"&&(r.current=t.current),typeof t.max!="undefined"&&(r.max=t.max),r.isIndeterminate=typeof r.current=="undefined"||typeof r.max=="undefined",typeof t.isIndeterminate!="undefined"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=en(),this.updateProgress(t),!r)return pM(this.info,this.lastUpdatedTime),this.checkAborted(),i3.immediatePromise()},e.prototype.runChild=function(t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:this.updateProgress(r),n={progress:uM(t),children:[]},a=this.node.children,a.push(n),i=new e(this.info,n),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,s3(t,i)];case 2:return[2,l.sent()];case 3:if(o=l.sent(),Be.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=a.indexOf(n),s>=0){for(u=s,c=a.length-1;u<c;u++)a[u]=a[u+1];a.pop()}return a.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),tW=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),_y=new tW,Be;(function(e){var t=function(){function f(d,m,p){this.name=d,this.f=m,this.onAbort=p,this.id=l()}return f.prototype.run=function(d,m){return m===void 0&&(m=250),d?Qj(this,d,m):this.f(_y)},f.prototype.runAsChild=function(d,m){return d.isSynchronous?this.f(_y):$j(d,this,m)},f.prototype.runInContext=function(d){return d.isSynchronous?this.f(_y):sM(d,this)},f}();function r(f){var d=f;return!!f&&typeof d.id=="number"&&typeof d.name=="string"&&!!d.run}e.is=r;function n(f){return!!f&&!!f.isAborted}e.isAbort=n;function a(f){return{isAborted:!0,reason:f,toString:function(){return"Aborted".concat(f?": "+f:"")}}}e.Aborted=a;function i(f,d,m){return new t(f,d,m)}e.create=i;function o(f,d){var m=this;return i(f,function(p){return ie(m,void 0,void 0,function(){return ae(this,function(v){return[2,d]})})})}e.constant=o;function s(){var f=this;return i("",function(d){return ie(f,void 0,void 0,function(){return ae(this,function(m){return[2]})})})}e.empty=s;function u(f,d){var m=this;return i(f,function(p){return ie(m,void 0,void 0,function(){return ae(this,function(v){throw new Error(d)})})})}e.fail=u;function c(f,d){return r(f)?d?f.runInContext(d):f.run():f}e.resolveInContext=c;var l=ja(0,1073741823)})(Be||(Be={}));var hM;(function(e){e.Synchronous=_y})(hM||(hM={}));var gM;(function(e){function t(n,a){a===void 0&&(a="");var i=n.progress;if(!n.children.length)return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message);var o=a+"  |_ ",s=n.children.map(function(u){return t(u,o)});return i.isIndeterminate?"".concat(a).concat(i.taskName,": ").concat(i.message,`
`).concat(s.join(`
`)):"".concat(a).concat(i.taskName,": [").concat(i.current,"/").concat(i.max,"] ").concat(i.message,`
`).concat(s.join(`
`))}function r(n){return t(n.root)}e.format=r})(gM||(gM={}));function Fu(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:if(i=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=en(),c=0,l=0,d.label=1;case 1:return(c=n(i,r))>0?(o+=c,f=en()-u,l+=f,s+=f,e.shouldUpdate?[4,a(e,r,o)]:[3,3]):[3,4];case 2:d.sent(),i=Math.round(l*o/s)+1,u=en(),l=0,d.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,a(e,r,o)]:[3,6];case 5:d.sent(),d.label=6;case 6:return[2,r]}})})}function rW(e){return e>>0}function ul(e,t){return e[t]|e[t+1]<<8}function Mf(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function Rf(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Ou(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function nW(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n}function aW(e){return e.length<2?"0"+e:e}function iW(e,t,r){for(var n="",a,i=0;i<r;i++)n+="%"+aW(e[t+i].toString(16));try{a=decodeURIComponent(n)}catch{return nW(e,t,r)}return a}function oW(e,t,r){for(var n=r.length,a=0,i=0;i<n;i++){var o=r.charCodeAt(i);if((o&4294967295-(1<<7)+1)==0)e[t+a]=o,a++;else if((o&4294967295-(1<<11)+1)==0)e[t+a]=192|o>>6,e[t+a+1]=128|o>>0&63,a+=2;else if((o&4294967295-(1<<16)+1)==0)e[t+a]=224|o>>12,e[t+a+1]=128|o>>6&63,e[t+a+2]=128|o>>0&63,a+=3;else if((o&4294967295-(1<<21)+1)==0)e[t+a]=240|o>>18,e[t+a+1]=128|o>>12&63,e[t+a+2]=128|o>>6&63,e[t+a+3]=128|o>>0&63,a+=4;else throw new Error("e")}return a}function yM(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e.charCodeAt(n);if((a&4294967295-(1<<7)+1)==0)r++;else if((a&4294967295-(1<<11)+1)==0)r+=2;else if((a&4294967295-(1<<16)+1)==0)r+=3;else if((a&4294967295-(1<<21)+1)==0)r+=4;else throw new Error("e")}return r}var sW=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function uW(e,t,r,n){for(var a=0;a<n;a++)e=sW[(e^t[r+a])&255]^e>>>8;return e}function bM(e,t,r){return uW(4294967295,e,t,r)^4294967295}var nt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=1<<15,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,nt.rev15[t]=(r>>>16|r<<16)>>>17}function n(a,i,o){for(;i--!=0;)a.push(0,o)}for(var t=0;t<32;t++)nt.ldef[t]=nt.of0[t]<<3|nt.exb[t],nt.ddef[t]=nt.df0[t]<<4|nt.dxb[t];n(nt.fltree,144,8),n(nt.fltree,255-143,9),n(nt.fltree,279-255,7),n(nt.fltree,287-279,8),cl(nt.fltree,9),sh(nt.fltree,9,nt.flmap),uh(nt.fltree,9),n(nt.fdtree,32,5),cl(nt.fdtree,5),sh(nt.fdtree,5,nt.fdmap),uh(nt.fdtree,5),n(nt.itree,19,0),n(nt.ltree,286,0),n(nt.dtree,30,0),n(nt.ttree,320,0)})();function sh(e,t,r){for(var n=e.length,a=nt.rev15,i=0;i<n;i+=2)if(e[i+1]!==0)for(var o=i>>1,s=e[i+1],u=o<<4|s,c=t-s,l=e[i]<<c,f=l+(1<<c);l!==f;){var d=a[l]>>>15-t;r[d]=u,l++}}function cl(e,t){for(var r=e.length,n=nt.bl_count,a=0;a<=t;a++)n[a]=0;for(var a=1;a<r;a+=2)n[e[a]]++;var i=nt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,i[s]=o;for(var u=0;u<r;u+=2){var c=e[u+1];c!==0&&(e[u]=i[c],i[c]++)}}function uh(e,t){for(var r=nt.rev15,n=15-t,a=0;a<e.length;a+=2){var i=e[a]<<t-e[a+1];e[a]=r[i]>>>n}}function cW(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function lW(e,t){for(var r=e.data,n=e.noBuf,a=e.buf,i=e.BFINAL,o=e.off,s=e.pos,u=0;i===0&&u<t;){var c=void 0,l=void 0,f=0,d=0;i=c3(r,s,1),u+=1;var m=c3(r,s+1,2);if(s+=3,m===0){(s&7)!=0&&(s+=8-(s&7));var p=(s>>>3)+4,v=r[p-4]|r[p-3]<<8;n&&(a=u3(a,o+v)),a.set(new Uint8Array(r.buffer,r.byteOffset+p,v),o),s=p+v<<3,o+=v;continue}if(n&&(a=u3(a,o+(1<<17))),m===1)c=nt.flmap,l=nt.fdmap,f=(1<<9)-1,d=(1<<5)-1;else if(m===2){var h=ll(r,s,5)+257,g=ll(r,s+5,5)+1,y=ll(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)nt.itree[b]=0,nt.itree[b+1]=0;for(var x=1,b=0;b<y;b++){var C=ll(r,s+b*3,3);nt.itree[(nt.ordr[b]<<1)+1]=C,C>x&&(x=C)}s+=3*y,cl(nt.itree,x),sh(nt.itree,x,nt.imap),c=nt.lmap,l=nt.dmap,s=dW(nt.imap,(1<<x)-1,h+g,r,s,nt.ttree);var _=xM(nt.ttree,0,h,nt.ltree);f=(1<<_)-1;var w=xM(nt.ttree,h,g,nt.dtree);d=(1<<w)-1,cl(nt.ltree,_),sh(nt.ltree,_,c),cl(nt.dtree,w),sh(nt.dtree,w,l)}else throw new Error("unknown BTYPE ".concat(m));for(;;){var T=c[l3(r,s)&f];s+=T&15;var A=T>>>4;if(A>>>8==0)a[o++]=A;else{if(A===256)break;var D=o+A-254;if(A>264){var E=nt.ldef[A-257];D=o+(E>>>3)+ll(r,s,E&7),s+=E&7}var M=l[l3(r,s)&d];s+=M&15;var F=M>>>4,O=nt.ddef[F],U=(O>>>4)+c3(r,s,O&15);for(s+=O&15,n&&(a=u3(a,o+(1<<17)));o<D;)a[o]=a[o++-U],a[o]=a[o++-U],a[o]=a[o++-U],a[o]=a[o++-U];o=D}}}e.buf=a,e.BFINAL=i,e.off=o,e.pos=s}function fW(e,t,r){return ie(this,void 0,void 0,function(){var n;return ae(this,function(a){switch(a.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=cW(t,r),a.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:a.sent(),a.label=3;case 3:return lW(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function u3(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function dW(e,t,r,n,a,i){for(var o=0;o<r;){var s=e[l3(n,a)&t];a+=s&15;var u=s>>>4;if(u<=15)i[o]=u,o++;else{var c=0,l=0;u===16?(l=3+ll(n,a,2),a+=2,c=i[o-1]):u===17?(l=3+ll(n,a,3),a+=3):u===18&&(l=11+ll(n,a,7),a+=7);for(var f=o+l;o<f;)i[o]=c,o++}}return a}function xM(e,t,r,n){for(var a=0,i=0,o=n.length>>>1;i<r;){var s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>a&&(a=s),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return a}function ll(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function c3(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function l3(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function f3(e,t,r){for(var n=[],a=e.length,i=t.length,o=0;o<i;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<a;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var c=n[0].lit,l=c===0?1:0;return t[(c<<1)+1]=1,t[(l<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var f=n[0],d=n[1],m=0,p=1,v=2;for(n[0]={lit:-1,f:f.f+d.f,l:f,r:d,d:0};p!==s-1;)m!==p&&(v===s||n[m].f<n[v].f)?f=n[m++]:f=n[v++],m!==p&&(v===s||n[m].f<n[v].f)?d=n[m++]:d=n[v++],n[p++]={lit:-1,f:f.f+d.f,l:f,r:d,d:void 0};var h=d3(n[p-1],0);h>r&&(mW(u,r,h),h=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return h}function d3(e,t){return e.lit!==-1?(e.d=t,t):Math.max(d3(e.l,t+1),d3(e.r,t+1))}function mW(e,t,r){var n=0,a=0,i=1<<r-t;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a=a>>>r-t;a>0;){var o=e[n].d;o<t?(e[n].d++,a-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);a!==0&&console.log("debt left")}function pW(e,t,r,n){var a=nt.lits,i=nt.strt,o=nt.prev;return{data:e,out:t,opt:hW[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:a,strt:i,prev:o}}function vW(e,t){for(var r=e.data,n=e.dlen,a=e.out,i=e.opt,o=e.i,s=e.pos,u=e.cvrd,c=e.li,l=e.lc,f=e.bs,d=e.ebits,m=e.c,p=e.nc,v=nt.lits,h=nt.strt,g=nt.prev,y=Math.min(o+t,n);o<y;o++){if(m=p,o+1<n-2){p=m3(r,o+1);var b=o+1&32767;g[b]=h[p],h[p]=b}if(u<=o){(c>14e3||l>26697)&&n-o>100&&(u<o&&(v[c]=o-u,c+=2,u=o),s=SM(o===n-1||u===n?1:0,v,c,d,r,f,o-f,a,s),c=l=d=0,f=o);var x=0;if(o<n-2&&(x=yW(r,o,g,m,Math.min(i[2],n-o),i[3])),x!==0){var C=x>>>16,_=x&65535,w=AM(C,nt.of0);nt.lhst[257+w]++;var T=AM(_,nt.df0);nt.dhst[T]++,d+=nt.exb[w]+nt.dxb[T],v[c]=C<<23|o-u,v[c+1]=_<<16|w<<8|T,c+=2,u=o+C}else nt.lhst[r[o]]++;l++}}e.i=o,e.pos=s,e.cvrd=u,e.li=c,e.lc=l,e.bs=f,e.ebits=d,e.c=m,e.nc=p}var hW=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function gW(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,h;return ae(this,function(g){switch(g.label){case 0:if(i=pW(t,r,n,a),o=i.dlen,a===0){for(s=i.i,u=i.pos;s<o;)c=Math.min(65535,o-s),Bf(r,u,s+c===o?1:0),u=CM(t,s,c,r,u+8),s+=c;return[2,u>>>3]}o>2&&(i.nc=m3(t,0),i.strt[i.nc]=0),g.label=1;case 1:return i.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:i.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return vW(i,1024*1024),[3,1];case 4:for(l=i.li,f=i.cvrd,d=i.pos,m=i.i,p=i.lits,v=i.bs,h=i.ebits,(v!==m||t.length===0)&&(f<m&&(p[l]=m-f,l+=2,f=m),d=SM(1,p,l,h,t,v,m-v,r,d));(d&7)!=0;)d++;return[2,d>>>3]}})})}function yW(e,t,r,n,a,i){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==m3(e,t-u))return 0;for(var c=0,l=0,f=Math.min(32767,t);u<=f&&--i!=0&&s!==o;){if(c===0||e[t+c]===e[t+c-u]){var d=bW(e,t,u);if(d>c){if(c=d,l=u,c>=a)break;u+2<d&&(d=u+2);for(var m=0,p=0;p<d-2;p++){var v=t-u+p+(1<<15)&32767,h=r[v],g=v-h+(1<<15)&32767;g>m&&(m=g,s=v)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return c<<16|l}function bW(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,a=Math.min(e.length,t+258);for(t+=3;t<a&&e[t]===e[t-r];)t++;return t-n}function m3(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function SM(e,t,r,n,a,i,o,s,u){nt.lhst[256]++;var c=xW(),l=c[0],f=c[1],d=c[2],m=c[3],p=c[4],v=c[5],h=c[6],g=c[7],y=((u+3&7)==0?0:8-(u+3&7))+32+(o<<3),b=n+ch(nt.fltree,nt.lhst)+ch(nt.fdtree,nt.dhst),x=n+ch(nt.ltree,nt.lhst)+ch(nt.dtree,nt.dhst);x+=14+3*v+ch(nt.itree,nt.ihst)+(nt.ihst[16]*2+nt.ihst[17]*3+nt.ihst[18]*7);for(var C=0;C<286;C++)nt.lhst[C]=0;for(var C=0;C<30;C++)nt.dhst[C]=0;for(var C=0;C<19;C++)nt.ihst[C]=0;var _=y<b&&y<x?0:b<x?1:2;if(wy(s,u,e),wy(s,u+1,_),u+=3,_===0){for(;(u&7)!=0;)u++;u=CM(a,i,o,s,u)}else{var w=void 0,T=void 0;if(_===1)w=nt.fltree,T=nt.fdtree;else if(_===2){cl(nt.ltree,l),uh(nt.ltree,l),cl(nt.dtree,f),uh(nt.dtree,f),cl(nt.itree,d),uh(nt.itree,d),w=nt.ltree,T=nt.dtree,Bf(s,u,m-257),u+=5,Bf(s,u,p-1),u+=5,Bf(s,u,v-4),u+=4;for(var A=0;A<v;A++)Bf(s,u+A*3,nt.itree[(nt.ordr[A]<<1)+1]);u+=3*v,u=_M(h,nt.itree,s,u),u=_M(g,nt.itree,s,u)}else throw new Error("unknown BTYPE ".concat(_));for(var D=i,E=0;E<r;E+=2){for(var M=t[E],F=M>>>23,O=D+(M&(1<<23)-1);D<O;)u=lh(a[D++],w,s,u);if(F!==0){var U=t[E+1],N=U>>16,q=U>>8&255,j=U&255;u=lh(257+q,w,s,u),Bf(s,u,F-nt.of0[q]),u+=nt.exb[q],u=lh(j,T,s,u),wy(s,u,N-nt.df0[j]),u+=nt.dxb[j],D+=F}}u=lh(256,w,s,u)}return u}function CM(e,t,r,n,a){var i=a>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),a+(r+4<<3)}function xW(){for(var e=f3(nt.lhst,nt.ltree,15),t=f3(nt.dhst,nt.dtree,15),r=[],n=wM(nt.ltree,r),a=[],i=wM(nt.dtree,a),o=0;o<r.length;o+=2)nt.ihst[r[o]]++;for(var o=0;o<a.length;o+=2)nt.ihst[a[o]]++;for(var s=f3(nt.ihst,nt.itree,7),u=19;u>4&&nt.itree[(nt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,i,u,r,a]}function ch(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function _M(e,t,r,n){for(var a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];n=lh(i,t,r,n);var s=i===16?2:i===17?3:7;i>15&&(Bf(r,n,o),n+=s)}return n}function wM(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var a=e[n+1],i=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(a===0&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var c=Math.min(u+1-n>>>1,138);c<11?t.push(17,c-3):t.push(18,c-11),n+=c*2-2}else if(a===s&&i===a&&o===a){for(var u=n+5;u+2<r&&e[u+2]===a;)u+=2;var c=Math.min(u+1-n>>>1,6);t.push(16,c-3),n+=c*2-2}else t.push(a,0)}return r>>>1}function AM(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function lh(e,t,r,n){return wy(r,n,t[e<<1]),n+t[(e<<1)+1]}function Bf(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function wy(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function p3(e,t,r){return r===void 0&&(r=!1),ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:for(n=Object.create(null),a=new Uint8Array(t),i=a.length-4;Rf(a,i)!==101010256;)i--;o=i,o+=4,o+=4,s=ul(a,o),o+=2,o+=2,o+=4,u=Rf(a,o),o+=4,o=u,c=0,h.label=1;case 1:return c<s?(o+=4,o+=4,o+=4,o+=4,o+=4,l=Rf(a,o),o+=4,f=Rf(a,o),o+=4,d=ul(a,o),m=ul(a,o+2),p=ul(a,o+4),o+=6,o+=8,v=Rf(a,o),o+=4,o+=d+m+p,[4,SW(e,a,v,n,l,f,r)]):[3,4];case 2:h.sent(),h.label=3;case 3:return c++,[3,1];case 4:return[2,n]}})})}function SW(e,t,r,n,a,i,o){return ie(this,void 0,void 0,function(){var s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:return r+=4,r+=2,r+=2,s=ul(t,r),r+=2,r+=4,r+=4,r+=8,u=ul(t,r),r+=2,c=ul(t,r),r+=2,l=iW(t,r,u),r+=u,r+=c,o?(n[l]={size:i,csize:a},[2]):(f=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[l]=new Uint8Array(f.buffer.slice(r,r+a)),[3,4]));case 1:return s!==8?[3,3]:(d=new Uint8Array(i),[4,TM(e,f,d)]);case 2:return m.sent(),n[l]=d,[3,4];case 3:throw new Error("unknown compression method: ".concat(s));case 4:return[2]}})})}function TM(e,t,r){return ie(this,void 0,void 0,function(){return ae(this,function(n){return[2,fW(e,t,r)]})})}function CW(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:if(n=t[3],a=10,n&4&&(i=ul(t,a),a+=i),n&8){for(o=a;t[o]!==0;)++o;a=o+1}if(n&16){for(o=a;t[o]!==0;)++o;a=o+1}return n&1&&(a+=2),s=rW(Rf(t,t.length-8)),u=Rf(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),c=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),[4,TM(e,c,r)];case 1:return l=d.sent(),f=bM(l,0,l.length),s!==f&&console.error("ungzip: checksums don't match"),[2,l]}})})}function _W(e,t,r){return ie(this,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,gW(e,t,n,0,r.level)];case 1:return a=i.sent(),[2,new Uint8Array(n.buffer,0,a)]}})})}function wW(e,t){return t===void 0&&(t=!1),Be.create("Zip",function(r){return AW(r,e,t)})}function AW(e,t,r){return r===void 0&&(r=!1),ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,u,v,h,g,u,y,b,x,u,y,C,_;return ae(this,function(w){switch(w.label){case 0:n=0,a={},i=[];for(o in t)i.push(o);s=0,w.label=1;case 1:return s<i.length?(u=i[s],c=!TW(u)&&!r,l=t[u],f=bM(l,0,l.length),d=a,m=u,_={cpr:c,usize:l.length,crc:f},c?[4,_W(e,l)]:[3,3]):[3,6];case 2:return p=w.sent(),[3,4];case 3:p=l,w.label=4;case 4:d[m]=(_.file=p,_),w.label=5;case 5:return s++,[3,1];case 6:for(u in a)n+=a[u].file.length+30+46+2*yM(u);n+=22,v=new Uint8Array(n),h=0,g=[];for(u in a)y=a[u],g.push(h),h=PM(v,h,u,y,0);b=0,x=h;for(u in a)y=a[u],g.push(h),h=PM(v,h,u,y,1,g[b++]);return C=h-x,Ou(v,h,101010256),h+=4,h+=4,Mf(v,h,b),h+=2,Mf(v,h,b),h+=2,Ou(v,h,C),h+=4,Ou(v,h,x),h+=4,h+=2,[2,v.buffer]}})})}function TW(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function PM(e,t,r,n,a,i){i===void 0&&(i=0);var o=n.file;Ou(e,t,a===0?67324752:33639248),t+=4,a===1&&(t+=2),Mf(e,t,20),t+=2,Mf(e,t,0),t+=2,Mf(e,t,n.cpr?8:0),t+=2,Ou(e,t,0),t+=4,Ou(e,t,n.crc),t+=4,Ou(e,t,o.length),t+=4,Ou(e,t,n.usize),t+=4,Mf(e,t,yM(r)),t+=2,Mf(e,t,0),t+=2,a===1&&(t+=2,t+=2,t+=6,Ou(e,t,i),t+=4);var s=oW(e,t,r);return t+=s,a===0&&(e.set(o,t),t+=o.length),t}function km(e,t,r){for(var n=0,a=r.length;n<a;n++){var i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var PW=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function EM(e){throw new Error(e)}function EW(e,t,r){for(var n=PW,a=void 0,i=0,o=[],s=512,u=t,c=t+r;u<c;u++){var l=e[u];(l&128)==0?o[i++]=n[l]:(l&224)==192?o[i++]=n[(l&15)<<6|e[++u]&63]:(l&240)==224?o[i++]=String.fromCharCode((l&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(l&248)==240?o[i++]=String.fromCharCode((l&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):EM("Invalid byte "+l.toString(16)),i===s&&(a=a||[],a[a.length]=o.join(""),i=0)}return a?(i>0&&(a[a.length]=o.slice(0,i).join("")),a.join("")):o.slice(0,i).join("")}var IM=typeof TextDecoder!="undefined"?new TextDecoder:void 0;function v3(e,t,r){if(IM){var n=t||r!==e.length?e.subarray(t,t+r):e;return IM.decode(n)}else return EW(e,t,r)}function Ay(e){for(var t=0,r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);if(a<128){t+=1;continue}if(a<2048){t+=2;continue}if(a<65536){t+=3;continue}if(a<1114112){t+=4;continue}EM("bad codepoint "+a)}return t}var IW=typeof document=="undefined"?require("xhr2"):XMLHttpRequest,hs;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(hs||(hs={}));function fl(e,t){return FW(e,t)}function h3(e){return typeof e=="string"?RM(e,e,"string"):RM(e.title,e.url,e.type||"string",e.body,e.headers)}function DW(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function DM(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function MM(e,t,r){return new Promise(function(n,a){if(DW(r)){var i=r.error;i!=null?a(i!=null?i:DM(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;a(u!=null?u:DM(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:"".concat(t," ").concat((s.loaded/1024/1024).toFixed(2)," MB"),isIndeterminate:!0})}catch(u){o=!0,a(u)}},r.onload=function(s){n(r)}})}function MW(e){return/\.gz$/i.test(e)?hs.Gzip:/\.zip$/i.test(e)?hs.Zip:hs.None}function RW(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i;return ae(this,function(o){switch(o.label){case 0:switch(n=r,n){case hs.None:return[3,1];case hs.Gzip:return[3,2];case hs.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,CW(e,t)];case 3:return[4,p3(e,t.buffer)];case 4:if(a=o.sent(),i=Object.keys(a),i.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,a[i[0]]];case 5:return[2]}})})}function BW(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s;return ae(this,function(u){switch(u.label){case 0:if(a=t.result,i=a instanceof ArrayBuffer?new Uint8Array(a):a,i===null)throw new Error("no data given");if(n===hs.None)return[3,4];if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,RW(e,i,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),i=v3(o,0,o.length),[3,4];case 3:i=o,u.label=4;case 4:return r==="binary"&&i instanceof Uint8Array?[2,i]:[3,5];case 5:return r==="zip"&&i instanceof Uint8Array?[4,p3(e,i.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof i=="string")return[2,i];if(r==="xml"&&typeof i=="string")return s=new DOMParser,[2,s.parseFromString(i,"application/xml")];if(r==="json"&&typeof i=="string")return[2,JSON.parse(i)];u.label=8;case 8:throw new Error("could not get requested response data '".concat(r,"'"))}})})}function FW(e,t){var r=this,n=void 0;return Be.create("Read File",function(a){return ie(r,void 0,void 0,function(){var i,o;return ae(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,i=t==="zip"?hs.None:MW(e.name),t==="binary"||t==="zip"||i!==hs.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,a.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,MM(a,"Reading...",n)];case 2:return o=s.sent(),[4,a.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,BW(a,o,t,i)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var g3=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new IW},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function OW(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(g3.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '".concat(t,"'"))}else throw g3.deposit(e),new Error("Download failed with status code ".concat(e.status))}function kW(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function RM(e,t,r,n,a){var i=this,o=void 0;return Be.create(e||"Download",function(s){return ie(i,void 0,void 0,function(){var u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:if(o=g3.get(),o.open(n?"post":"get",t,!0),a)for(u=0,c=a;u<c.length;u++)l=c[u],f=l[0],d=l[1],o.setRequestHeader(f,d);return o.responseType=kW(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return v.sent(),[4,MM(s,"Downloading...",o)];case 2:return m=v.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return v.sent(),p=OW(m,r),[2,p]}})})},function(){o&&(o.abort(),o=void 0)})}function LW(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,l,v;return ae(this,function(h){switch(h.label){case 0:return a=r.length,i=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:a})];case 1:for(h.sent(),o=[],s=[],u=0,c=Math.min(a,n);u<c;u++)l=r[u],o.push(FM(u,l.id,t.resolve(mn.getUrlAsset(t,l.url),l.isBinary?"binary":"string").runAsChild(e))),s.push(u);f=0,h.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=h.sent(),m=r[d.index],p=s.indexOf(d.index),f++,d.kind==="error"&&!m.canFail)throw new Error("".concat(m.url,": ").concat(d.error));return e.shouldUpdate?[4,e.update({message:"Downloading...",current:f,max:a})]:[3,5];case 4:h.sent(),h.label=5;case 5:return i[d.index]=d,o=o.filter(BM,p),s=s.filter(BM,p),u<a&&(l=r[u],v=t.resolve(mn.getUrlAsset(t,l.url),l.isBinary?"binary":"string").runAsChild(e),o.push(FM(u,l.id,v)),s.push(u),u++),[3,2];case 6:return[2,i]}})})}function BM(e,t){return this!==t}function FM(e,t,r){return ie(this,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,r];case 1:return n=i.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return a=i.sent(),[2,{kind:"error",error:a,index:e,id:t}];case 3:return[2]}})})}var mn;(function(e){function t(u,c){return I({kind:"url",id:zr.create22(),url:u},c)}e.Url=t;function r(u){return{kind:"file",id:zr.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function a(u){return(u==null?void 0:u.kind)==="file"}e.isFile=a;function i(u,c,l){return{data:u,dispose:function(){l.release(c)}}}e.Wrapper=i;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,c,l){if(typeof c=="string"){var f=u.tryFindUrl(c,l);return f||t(c,{body:l})}return c}e.getUrlAsset=s})(mn||(mn={}));var NW=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return Cy(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var a=n.next();if(a.done)return;var i=a.value.asset;if(mn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var a=this;return n===void 0&&(n=!0),mn.isUrl(t)?Be.create("Download ".concat(t.title||t.url),function(i){return ie(a,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=mn).Wrapper,[4,fl(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[v.sent(),t,this])];case 2:return n?[3,4]:(l=(c=mn).Wrapper,[4,h3(I(I({},t),{type:r})).runInContext(i)]);case 3:return[2,l.apply(c,[v.sent(),t,this])];case 4:return[4,h3(I(I({},t),{type:"binary"})).runInContext(i)];case 5:return f=v.sent(),d=new File([f],"raw-data"),this._assets.set(t.id,{asset:t,file:d,refCount:1}),p=(m=mn).Wrapper,[4,fl(d,r).runInContext(i)];case 6:return[2,p.apply(m,[v.sent(),t,this])]}})})}):Be.create("Read ".concat(t.name),function(i){return ie(a,void 0,void 0,function(){var o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=mn).Wrapper,[4,fl(o.file,r).runInContext(i)]):[3,2];case 1:return[2,u.apply(s,[f.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '".concat(t.name,"' (").concat(t.id,")"));return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),l=(c=mn).Wrapper,[4,fl(t.file,r).runInContext(i)];case 3:return[2,l.apply(c,[f.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);!r||(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),P;(function(e){e.Essential={isEssential:!0};function t(re,ee){return ee&&(ee.label&&(re.label=ee.label),ee.description&&(re.description=ee.description),ee.legend&&(re.legend=ee.legend),ee.fieldLabels&&(re.fieldLabels=ee.fieldLabels),ee.isHidden&&(re.isHidden=ee.isHidden),ee.shortLabel&&(re.shortLabel=ee.shortLabel),ee.twoColumns&&(re.twoColumns=ee.twoColumns),ee.isEssential&&(re.isEssential=ee.isEssential),ee.category&&(re.category=ee.category),ee.hideIf&&(re.hideIf=ee.hideIf),ee.help&&(re.help=ee.help)),re}function r(re){var ee=I({},re);return ee.isOptional=!0,ee}e.Optional=r;function n(re,ee){return t({type:"value",defaultValue:re},ee)}e.Value=n;function a(re,ee,B){return t({type:"select",defaultValue:Pe(re,ee),options:ee,cycle:B==null?void 0:B.cycle},B)}e.Select=a;function i(re,ee,B){var z=t({type:"multi-select",defaultValue:re,options:ee},B);return(B==null?void 0:B.emptyValue)&&(z.emptyValue=B.emptyValue),z}e.MultiSelect=i;function o(re,ee){return t({type:"boolean",defaultValue:re},ee)}e.Boolean=o;function s(re,ee){return re===void 0&&(re=""),t({type:"text",defaultValue:re},ee)}e.Text=s;function u(re,ee){var B=t({type:"color",defaultValue:re},ee);return(ee==null?void 0:ee.isExpanded)&&(B.isExpanded=ee.isExpanded),B}e.Color=u;function c(re,ee){var B;if(typeof re=="string"){var z=Mu(re);B={kind:z.type!=="qualitative"?"interpolate":"set",colors:z.list}}else B=re;return t({type:"color-list",presetKind:(ee==null?void 0:ee.presetKind)||"all",defaultValue:B,offsets:!!(ee==null?void 0:ee.offsets)},ee)}e.ColorList=c;function l(re,ee,B){return t(v({type:"vec3",defaultValue:re},ee),B)}e.Vec3=l;function f(re,ee){return t({type:"mat4",defaultValue:re},ee)}e.Mat4=f;function d(re,ee){var B=typeof re=="string"?mn.Url(re):mn.Url(re.url,{body:re.body}),z=t({type:"url",defaultValue:B},ee);return z}e.Url=d;function m(re){var ee=t({type:"file",defaultValue:null},re);return(re==null?void 0:re.accept)&&(ee.accept=re.accept),ee}e.File=m;function p(re){var ee=t({type:"file-list",defaultValue:null},re);return(re==null?void 0:re.accept)&&(ee.accept=re.accept),ee}e.FileList=p;function v(re,ee){return ee&&(typeof ee.min!="undefined"&&(re.min=ee.min),typeof ee.max!="undefined"&&(re.max=ee.max),typeof ee.step!="undefined"&&(re.step=ee.step)),re}function h(re,ee,B){var z=t(v({type:"number",defaultValue:re},ee),B);return(B==null?void 0:B.immediateUpdate)&&(z.immediateUpdate=!0),z}e.Numeric=h;function g(re,ee,B){return t(v({type:"interval",defaultValue:re},ee),B)}e.Interval=g;function y(re,ee){return t({type:"line-graph",defaultValue:re},ee)}e.LineGraph=y;function b(re,ee){var B=t({type:"group",defaultValue:(ee==null?void 0:ee.customDefault)||N(re),params:re},ee);return(ee==null?void 0:ee.presets)&&(B.presets=ee.presets),(ee==null?void 0:ee.isExpanded)&&(B.isExpanded=ee.isExpanded),(ee==null?void 0:ee.isFlat)&&(B.isFlat=ee.isFlat),(ee==null?void 0:ee.pivot)&&(B.pivot=ee.pivot),B}e.Group=b;function x(re){return b({},re)}e.EmptyGroup=x;function C(re,ee,B,z){var le=Pe(re,ee);return t({type:"mapped",defaultValue:{name:le,params:B(le).defaultValue},select:a(le,ee,z),map:B},z)}e.Mapped=C;function _(re,ee,B){var z=(B==null?void 0:B.options)?B.options:Object.keys(ee).map(function(pe){return[pe,ee[pe].label||Ao(pe)]}),le=Pe(re,z);return t({type:"mapped",defaultValue:{name:le,params:ee[le].defaultValue},select:a(le,z,B),map:function(pe){return ee[pe]}},B)}e.MappedStatic=_;function w(re,ee,B){return t({type:"object-list",element:re,getLabel:ee,ctor:T,defaultValue:(B==null?void 0:B.defaultValue)||[]},B)}e.ObjectList=w;function T(){return N(this.element)}function A(){throw new Error("getValue not set. Fix runtime.")}function D(re,ee,B){var z;return t({type:"value-ref",defaultValue:{ref:(z=B==null?void 0:B.defaultRef)!==null&&z!==void 0?z:"",getValue:A},getOptions:re,resolveRef:ee},B)}e.ValueRef=D;function E(re){var ee;return t({type:"data-ref",defaultValue:{ref:(ee=re==null?void 0:re.defaultRef)!==null&&ee!==void 0?ee:"",getValue:A}},re)}e.DataRef=E;function M(re,ee,B){return{type:"converted",defaultValue:ee(B.defaultValue),converted:B,fromValue:re,toValue:ee}}e.Converted=M;function F(re,ee,B,z,le){var pe=Object.keys(ee).map(function(ge){return[ge,ge]});return t({type:"conditioned",select:a(B(re),pe,le),defaultValue:re,conditionParams:ee,conditionForValue:B,conditionedValue:z},le)}e.Conditioned=F;function O(re,ee){return t({type:"script",defaultValue:re},ee)}e.Script=O;function U(re){return 0}e.For=U;function N(re){for(var ee={},B=0,z=Object.keys(re);B<z.length;B++){var le=z[B];re[le].isOptional||(ee[le]=re[le].defaultValue)}return ee}e.getDefaultValues=N;function q(re,ee){return function(){return re(ee)}}function j(re,ee,B){if(!!ee){if(re.type==="value-ref"){var z=ee;z.ref?z.getValue=q(re.resolveRef,z.ref):z.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(re.type==="data-ref"){var z=ee;z.ref?z.getValue=q(B,z.ref):z.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(re.type==="group")te(re.params,ee,B);else if(re.type==="mapped"){var z=ee,le=re.map(z.name);j(le,z.params,B)}else if(re.type==="object-list"){if(!J(re.element))return;for(var pe=0,ge=ee;pe<ge.length;pe++){var Ce=ge[pe];te(re.element,Ce,B)}}}}function Q(re){if(re.type==="value-ref"||re.type==="data-ref")return!0;if(re.type==="group"){if(J(re.params))return!0}else if(re.type==="mapped")for(var ee=0,B=re.select.options;ee<B.length;ee++){var z=B[ee][0];if(Q(re.map(z)))return!0}else if(re.type==="object-list")return J(re.element);return!1}function J(re){for(var ee=0,B=Object.keys(re);ee<B.length;ee++){var z=B[ee];if(Q(re[z]))return!0}return!1}function te(re,ee,B){for(var z=0,le=Object.keys(re);z<le.length;z++){var pe=le[z];j(re[pe],ee==null?void 0:ee[pe],B)}}e.resolveRefs=te;function K(re,ee){for(var B=0,z=Object.keys(re);B<z.length;B++){var le=z[B];re[le].isOptional||(re[le].defaultValue=ee[le])}}e.setDefaultValues=K;function L(re){return ol(re)}e.clone=L;function W(re,ee){}e.validate=W;function k(re,ee,B){if(ee===B)return!0;if(typeof ee!="object"||typeof B!="object")return!1;for(var z=0,le=Object.keys(re);z<le.length;z++){var pe=le[z];if(!V(re[pe],ee[pe],B[pe]))return!1}return!0}e.areEqual=k;function V(re,ee,B){if(ee===B)return!0;if(re.type==="group")return k(re.params,ee,B);if(re.type==="mapped"){var z=ee,le=B;if(z.name!==le.name)return!1;var pe=re.map(z.name);return V(pe,z.params,le.params)}else if(re.type==="multi-select"){var z=ee,le=B;if(z.length!==le.length)return!1;if(z.length<10){for(var ge=0,Ce=z.length;ge<Ce;ge++)if(z[ge]!==le[ge]&&le.indexOf(z[ge])<0)return!1}else for(var Ie=new Set(le),ge=0,Ce=z.length;ge<Ce;ge++)if(z[ge]!==le[ge]&&!Ie.has(z[ge]))return!1;return!0}else{if(re.type==="interval")return ee[0]===B[0]&&ee[1]===B[1];if(re.type==="line-graph"){var z=ee,le=B;if(z.length!==le.length)return!1;for(var ge=0,Ce=z.length;ge<Ce;ge++)if(!Fe.areEqual(z[ge],le[ge]))return!1;return!0}else{if(re.type==="vec3")return S.equals(ee,B);if(re.type==="mat4")return se.areEqual(ee,B,Ir);if(re.type==="script"){var z=ee,le=B;return z.language===le.language&&z.expression===le.expression}else if(re.type==="object-list"){var z=ee,le=B,Oe=z.length;if(Oe!==le.length)return!1;for(var ge=0;ge<Oe;ge++)if(!k(re.element,z[ge],le[ge]))return!1;return!0}else if(typeof ee=="object"&&typeof B=="object")return Xg(ee,B)}}return!1}e.isParamEqual=V;function G(re,ee,B){if(ee===void 0)return I({},B);if(B===void 0)return I({},ee);for(var z=Object.create(null),le=0,pe=Object.keys(re);le<pe.length;le++){var ge=pe[le];z[ge]=H(re[ge],ee[ge],B[ge])}return z}e.merge=G;function H(re,ee,B){if(ee===void 0)return typeof B=="object"&&!Array.isArray(B)?I({},B):B;if(B===void 0)return typeof ee=="object"&&!Array.isArray(ee)?I({},ee):ee;if(re.type==="group")return G(re.params,ee,B);if(re.type==="mapped"){var z=ee,le=B;if(z.name!==le.name)return I({},le);var pe=re.map(le.name);return{name:le.name,params:H(pe,z.params,le.params)}}else return re.type==="value"?B:typeof ee=="object"&&typeof B=="object"?Array.isArray(B)?B:I(I({},ee),B):B}e.mergeParam=H;function X(re,ee){for(var B=0,z=re.options;B<z.length;B++){var le=z[B];if(le[0]===ee)return!0}return!1}function Y(re,ee,B){if(ee==null)return B?re.defaultValue:void 0;if(re.type==="value")return ee;if(re.type==="group"){for(var z=Object.create(null),le=0,pe=Object.keys(re.params);le<pe.length;le++){var ge=pe[le],Ce=re.params[ge];ee[ge]===void 0?B&&(z[ge]=Ce.defaultValue):z[ge]=Y(Ce,ee[ge],B)}return z}else if(re.type==="mapped"){var Ie=ee;if(typeof Ie.name!="string")return re.defaultValue;if(typeof Ie.params=="undefined")return B?re.defaultValue:void 0;if(!X(re.select,Ie.name))return re.defaultValue;var Ce=re.map(Ie.name);return{name:Ie.name,params:Y(Ce,Ie.params,B)}}else{if(re.type==="select")return X(re,ee)?ee:re.defaultValue;if(re.type==="multi-select"){if(!Array.isArray(ee))return re.defaultValue;var z=ee.filter(function(We){return X(this,We)},re);return ee.length>0&&z.length===0?re.defaultValue:z}else if(re.type==="object-list")return Array.isArray(ee)?ee.map(function(Oe){return oe(re.element,Oe,B?"all":"skip")}):re.defaultValue}return ee}function oe(re,ee,B){if(typeof ee!="object"||ee===null)return B?N(re):ee;for(var z=Object.create(null),le=0,pe=Object.keys(re);le<pe.length;le++){var ge=pe[le],Ce=re[ge];ee[ge]===void 0?B==="all"&&(z[ge]=Ce.defaultValue):z[ge]=Y(Ce,ee[ge],B!=="skip")}return z}e.normalizeParams=oe;function ue(re,ee){for(var B=[],z=0,le=Object.keys(re);z<le.length;z++){var pe=le[z];if(!ee)typeof re[pe]=="string"?B.push([pe,re[pe]]):B.push([pe,ee===null?pe:Ao(pe)]);else{var ge=ee(pe,re[pe]);B.push(typeof ge=="string"?[pe,ge]:[pe,ge[0],ge[1]])}}return B}e.objectToOptions=ue;function me(re,ee){for(var B=[],z=0,le=re;z<le.length;z++){var pe=le[z];ee?B.push([pe,ee(pe)]):B.push([pe,ee===null?pe:Ao(pe)])}return B}e.arrayToOptions=me;function he(re,ee){for(var B=0,z=re.options;B<z.length;B++){var le=z[B];if(le[0]===ee)return le[1]}return""}e.optionLabel=he;function Pe(re,ee){for(var B=0,z=ee;B<z.length;B++){var le=z[B];if(le[0]===re)return re}return ee.length>0?ee[0][0]:void 0}})(P||(P={}));var Mi;(function(e){function t(a){var i={create:function(o){return{action:i,params:o}},id:zr.create22(),definition:a,createDefaultParams:function(o,s){return a.params?P.getDefaultValues(a.params(o,s)):{}}};return i}e.create=t;function r(a){var i=a.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:a.definition.isApplicable?function(o,s,u){return a.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,c=o.params,l=u.build().to(s.transform.ref).apply(a,c);return u.updateTree(l)}})}e.fromTransformer=r;var n;(function(a){function i(o){return function(s){return t(I({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}a.build=function(o){return i(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Mi||(Mi={}));var Ge;(function(e){function t(v,h,g){return v.definition.params?v.definition.params(h,g):{}}e.getParamDefinition=t;function r(v){return!!v&&typeof v.toAction=="function"&&typeof v.apply=="function"}e.is=r;var n;(function(v){v[v.Unchanged=0]="Unchanged",v[v.Updated=1]="Updated",v[v.Recreate=2]="Recreate",v[v.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var a=new Map,i=new Map;function o(v){for(var h=0,g=v.definition.from;h<g.length;h++){var y=g[h];i.has(y.type)?i.get(y.type).push(v):i.set(y.type,[v])}}function s(){return Array.from(a.values())}e.getAll=s;function u(v){var h=a.get(v);if(!h)throw new Error("A transformer with signature '".concat(v,"' is not registered."));return h}e.get=u;function c(v){return i.get(v)||[]}e.fromType=c;function l(v,h){var g=h.name,y="".concat(v,".").concat(g);if(a.has(y))throw new Error("A transform with id '".concat(g,"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed."));var b={apply:function(x,C,_){return gr.create(x,b,C,_)},toAction:function(){return Mi.fromTransformer(b)},namespace:v,id:y,definition:h,createDefaultParams:function(x,C){return h.params?P.getDefaultValues(h.params(x,C)):{}}};return a.set(y,b),o(b),b}e.create=l;function f(v){return function(h){return l(v,h)}}e.factory=f;function d(v){return m.build(v)}e.builderFactory=d;var m;(function(v){function h(y,b){return function(x){return l(y,I({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:vy(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},x))}}function g(y){return function(b){return h(y,b)}}v.build=g})(m=e.Builder||(e.Builder={}));function p(v){return m.build(v)}e.build=p,e.ROOT=l("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(Ge||(Ge={}));var gr;(function(e){e.RootRef="-=root=-";function t(h,g){return!!h.isHidden!=!!g.isHidden||!!h.isCollapsed!=!!g.isCollapsed||!!h.isGhost!=!!g.isGhost||!!h.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(h,g){return g?typeof g.isCollapsed!="undefined"&&h.isCollapsed!==g.isCollapsed||typeof g.isHidden!="undefined"&&h.isHidden!==g.isHidden||typeof g.isGhost!="undefined"&&h.isGhost!==g.isGhost||typeof g.isLocked!="undefined"&&h.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(h,g){if(!g)return!1;for(var y=!1,b=0,x=Object.keys(g);b<x.length;b++){var C=x[b],_=g[C],w=h[C];!!_!=!!w&&(y=!0,h[C]=_)}return y}e.assignState=n;function a(h,g){if(!g)return!1;for(var y=!1,b=0,x=Object.keys(g);b<x.length;b++){var C=x[b],_=g[C],w=h[C];!!_!=!!w&&(y=!0,_!==void 0?h[C]=_:delete h[C])}for(var T=0,A=Object.keys(h);T<A.length;T++){var C=A[T],_=g[C],w=h[C];!!_!=!!w&&(y=!0,_!==void 0?h[C]=_:delete h[C])}return y}e.syncState=a;function i(h,g,y,b){var x=b&&b.ref?b.ref:zr.create22(),C=void 0;return b&&b.tags&&(C=typeof b.tags=="string"?[b.tags]:b.tags,C.length===0?C=void 0:C.sort()),{parent:h,transformer:g,state:(b==null?void 0:b.state)||{},tags:C,ref:x,dependsOn:b&&b.dependsOn,params:y,version:zr.create22()}}e.create=i;function o(h,g){return I(I({},h),{params:g,version:zr.create22()})}e.withParams=o;function s(h,g){return g?I(I({},h),{state:I(I({},h.state),g)}):h}e.withState=s;function u(h,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),I(I({},h),{tags:y,version:zr.create22()})}e.withTags=u;function c(h,g){return I(I({},h),{parent:g,version:zr.create22()})}e.withParent=c;function l(h){return i(e.RootRef,Ge.ROOT,{},{ref:e.RootRef,state:h})}e.createRoot=l;function f(h,g){return h.tags?h.tags.indexOf(g)>=0:!1}e.hasTag=f;function d(h,g){if(!h.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return f(h,g);for(var y=0,b=g;y<b.length;y++){var x=b[y];if(h.tags.indexOf(x)<0)return!1}return!0}e.hasTags=d;function m(h){return h}function p(h){for(var g=h.transformer.definition.customSerialization?h.transformer.definition.customSerialization.toJSON:m,y=void 0,b=0,x=Object.keys(h.state);b<x.length;b++){var C=x[b],_=h.state[C];!_||(y||(y={}),y[C]=!0)}return{parent:h.parent,transformer:h.transformer.id,params:h.params?g(h.params):void 0,state:y,tags:h.tags,ref:h.ref,dependsOn:h.dependsOn,version:h.version}}e.toJSON=p;function v(h){var g=Ge.get(h.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:m;return{parent:h.parent,transformer:g,params:h.params?y(h.params):void 0,state:h.state||{},tags:h.tags,ref:h.ref,dependsOn:h.dependsOn,version:h.version}}e.fromJSON=v})(gr||(gr={}));function js(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function Ty(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Ki(e){for(var t=1/0,r=-1/0,n=0,a=e.length;n<a;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function fh(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,a=0,i=r;i<n;i+=t)a+=e[i];return a}function Py(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),fh(e,t,r)/(e.length/t)}function Ey(e){for(var t=e.length,r=0,n=0;n<t;++n){var a=e[n];r+=a*a}return Math.sqrt(r/t)}function Po(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function dh(e,t){for(var r=0,n=!1,a=e.length;r<a;r++)if(e[r]===t){n=!0;break}return n?(mh(e,r),!0):!1}function mh(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function gn(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function Ff(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,a=e.length-1;n<a;n++)e[n]=e[n+1];return e.pop(),!0}function Iy(e,t){for(var r=0,n=0,a=e.length;n<a;++n)t.includes(e[n])&&(r+=1);return r}function OM(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function UW(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function zW(e,t,r){for(var n=0,a=e.length;n<a;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var VW=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(gr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=gr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=ms();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var a=this.dependencyMutations.get(t);if(!a){var i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),a=i?i.asMutable():ms().asMutable(),this.dependencyMutations.set(t,a),this.dependencies.set(t,a)}n==="add"?a.add(r):a.remove(r)},e.prototype.changeParent=function(t,r){Dy(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,gr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&qW(t.ref)}var a=this.children.get(t.parent);if(a||jW(t.parent),a.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,ms())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var i=0,o=t.dependsOn;i<o.length;i++){var s=o[i];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){Dy(this.transforms,t);var n=this.transforms.get(t);return KC(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,gr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){Dy(this.transforms,t);var n=this.transforms.get(t),a=gr.withParams(n,r);return OM(n.tags,a.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a),!0)},e.prototype.assignState=function(t,r){Dy(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return gr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var a=gr.withState(n,r);return this.transforms.set(t,a),a},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=Pn.subtreePostOrder(this,r);if(t===gr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var a=0,i=n;a<i.length;a++){var o=i[a];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,c=n;u<c.length;u++){var o=c[u];if(o.dependsOn)for(var l=0,f=o.dependsOn;l<f.length;l++){var d=f[l];!this.transforms.has(d)||this.mutateDependency(d,o.ref,"remove")}if(this.dependencies.has(o.ref)){var m=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var p=0,v=m;p<v.length;p++){var h=v[p];if(!!this.transforms.has(h))for(var g=0,y=this.remove(h);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var x=0,C=s;x<C.length;x++){var h=C[x];n[n.length]=h}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(GW,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(HW,this.dependencies),Pn.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function GW(e,t){this.set(t,e.asImmutable())}function HW(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function qW(e){throw new Error("Transform '".concat(e,"' is already present in the tree."))}function jW(e){throw new Error("Parent '".concat(e,"' must be present in the tree."))}function Dy(e,t){if(!e.has(t))throw new Error("Node '".concat(t,"' is not present in the tree."))}var Pn;(function(e){var t=function(){function b(x,C,_){this.transforms=x,this.children=C,this.dependencies=_}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(gr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new VW(this)},b}();function r(b){var x=b||gr.createRoot();return n(_o([[x.ref,x]]),_o([[x.ref,ms()]]),_o())}e.createEmpty=r;function n(b,x,C){return new t(b,x,C)}e.create=n;function a(b){i(this,this.tree.transforms.get(b))}function i(b,x){var C=b.tree.children.get(x.ref);C&&C.size&&C.forEach(a,b),b.f(x,b.tree,b.state)}function o(b,x,C,_){var w={tree:b,state:C,f:_};return i(w,x),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,x){var C=b.f(x,b.tree,b.state);if(!(typeof C=="boolean"&&!C)){var _=b.tree.children.get(x.ref);_&&_.size&&_.forEach(s,b)}}function c(b,x,C,_){var w={tree:b,state:C,f:_};return u(w,x),w.state}e.doPreOrder=c;function l(b,x,C){C.push(b)}function f(b,x){return o(b,x,[],l)}e.subtreePostOrder=f;function d(b,x,C){C.push(gr.toJSON(b))}function m(b){var x=[];return c(b,b.root,x,d),{transforms:x}}e.toJSON=m;function p(b){for(var x=_o().asMutable(),C=_o().asMutable(),_=_o().asMutable(),w=0,T=b.transforms;w<T.length;w++){var A=T[w],D=gr.fromJSON(A);x.set(D.ref,D),C.has(D.ref)||C.set(D.ref,ms().asMutable()),D.ref!==D.parent&&C.get(D.parent).add(D.ref)}for(var E=new Set,M=0,F=b.transforms;M<F.length;M++){var A=F[M],O=A.ref;if(C.set(O,C.get(O).asImmutable()),!!A.dependsOn)for(var U=0,N=A.dependsOn;U<N.length;U++){var q=N[U];E.add(q),_.has(q)?_.get(q).add(O):_.set(q,ms([O]).asMutable())}}return E.forEach(function(j){_.set(j,_.get(j).asImmutable())}),n(x.asImmutable(),C.asImmutable(),_.asImmutable())}e.fromJSON=p;function v(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(x){return x.ref}),ch:b.children.keySeq().toArray()})}e.dump=v;function h(b,x,C){if(x===C)return!0;for(var _=b.children.get(x),w=_.values();;){var T=w.next();if(T.done)return!1;if(h(b,T.value,C))return!0}}function g(b,x,C){return!b.transforms.has(x)||!b.transforms.has(C)?!1:h(b,x,C)}e.subtreeHasRef=g;function y(b,x){var C=b.children.get(x);if(C.size!==1)return x;var _=b.transforms.get(C.first());return _.transformer.definition.isDecorator?y(b,_.ref):x}e.getDecoratorRoot=y})(Pn||(Pn={}));var Yt;(function(e){function t(k,V){return r(k)(V)}e.select=t;function r(k){var V=k||c.root,G;return a(V)?G=V.compile():n(V)?G=c.byValue(V).compile():i(V)?G=V:G=c.byRef(V).compile(),G}e.compile=r;function n(k){return k.transform!==void 0&&k.status!==void 0}function a(k){return k.compile!==void 0}function i(k){return typeof k=="function"}var o={select:function(k){return t(this,k||this.state)}};function s(k,V){o[k]=function(){for(var G=[],H=0;H<arguments.length;H++)G[H]=arguments[H];return V.call.apply(V,Ht([void 0,this],G,!1))}}function u(k){return Object.create(o,{compile:{writable:!1,configurable:!1,value:k}})}var c;(function(k){k.root=u(function(){return function(re){return[re.cells.get(re.tree.root.ref)]}});function V(){for(var re=[],ee=0;ee<arguments.length;ee++)re[ee]=arguments[ee];return u(function(){return function(B){for(var z=[],le=0,pe=re;le<pe.length;le++){var ge=pe[le],Ce=B.cells.get(ge);!Ce||z.push(Ce)}return z}})}k.byRef=V;function G(){for(var re=[],ee=0;ee<arguments.length;ee++)re[ee]=arguments[ee];return u(function(){return function(B){return re}})}k.byValue=G;function H(re,ee){return ee===void 0&&(ee=gr.RootRef),u(function(){return function(B){var z={roots:[],cells:B.cells,type:re.type};return Pn.doPreOrder(B.tree,B.tree.transforms.get(ee),z,ue),z.roots}})}k.rootsOfType=H;function X(re,ee){return ee===void 0&&(ee=gr.RootRef),u(function(){return function(B){var z={ret:[],cells:B.cells,type:re.type};return Pn.doPreOrder(B.tree,B.tree.transforms.get(ee),z,me),z.ret}})}k.ofType=X;function Y(re,ee){return ee===void 0&&(ee=gr.RootRef),u(function(){return function(B){var z={ret:[],cells:B.cells,t:re};return Pn.doPreOrder(B.tree,B.tree.transforms.get(ee),z,he),z.ret}})}k.ofTransformer=Y;function oe(re,ee){return ee===void 0&&(ee=gr.RootRef),u(function(){return function(B){var z={ret:[],cells:B.cells,t:re};return Pn.doPreOrder(B.tree,B.tree.transforms.get(ee),z,Pe),z.ret}})}k.ofTransformerWithError=oe;function ue(re,ee,B){var z=B.cells.get(re.ref);return z&&z.obj&&z.obj.type===B.type?(B.roots.push(z),!1):!0}function me(re,ee,B){var z=B.cells.get(re.ref);return z&&z.obj&&z.obj.type===B.type&&B.ret.push(z),!0}function he(re,ee,B){var z=B.cells.get(re.ref);return z&&z.obj&&z.transform.transformer===B.t&&B.ret.push(z),!0}function Pe(re,ee,B){var z=B.cells.get(re.ref);return z&&z.status==="error"&&z.transform.transformer===B.t&&B.ret.push(z),!0}})(c=e.Generators||(e.Generators={})),s("flatMap",l);function l(k,V){var G=r(k);return u(function(){return function(H){for(var X=[],Y=0,oe=G(H);Y<oe.length;Y++)for(var ue=oe[Y],me=0,he=V(ue,H);me<he.length;me++){var Pe=he[me];X.push(Pe)}return X}})}e.flatMap=l,s("mapObject",f);function f(k,V){var G=r(k);return u(function(){return function(H){for(var X=[],Y=0,oe=G(H);Y<oe.length;Y++){var ue=oe[Y],me=V(ue,H);me&&X.push(me)}return X}})}e.mapObject=f,s("unique",d);function d(k){var V=r(k);return u(function(){return function(G){for(var H=new Set,X=[],Y=0,oe=V(G);Y<oe.length;Y++){var ue=oe[Y];!ue||H.has(ue.transform.ref)||(H.add(ue.transform.ref),X.push(ue))}return X}})}e.unique=d,s("first",m);function m(k){var V=r(k);return u(function(){return function(G){var H=V(G);return H.length?[H[0]]:[]}})}e.first=m,s("filter",p);function p(k,V){return l(k,function(G){return V(G)?[G]:[]})}e.filter=p,s("withStatus",v);function v(k,V){return p(k,function(G){return G.status===V})}e.withStatus=v,s("withTag",h);function h(k,V){return p(k,function(G){return!!G.transform.tags&&G.transform.tags.indexOf(V)>=0})}e.withTag=h,s("subtree",g);function g(k){return l(k,function(V,G){var H=[];return Pn.doPreOrder(G.tree,G.tree.transforms.get(V.transform.ref),H,function(X,Y,oe){oe.push(X.ref)}),H.map(function(X){return G.cells.get(X)})})}e.subtree=g,s("children",y);function y(k){return l(k,function(V,G){var H=[];return G.tree.children.get(V.transform.ref).forEach(function(X){return H.push(G.cells.get(X))}),H})}e.children=y,s("ofType",b);function b(k,V){return p(k,function(G){return G.obj?G.obj.type===V.type:!1})}e.ofType=b,s("ancestor",x);function x(k,V){return d(f(k,function(G,H){return M(H.tree,H.cells,G.transform.ref,V)}))}e.ancestor=x,s("ancestorOfType",C);function C(k,V){return d(f(k,function(G,H){return U(H.tree,H.cells,G.transform.ref,V)}))}e.ancestorOfType=C,s("ancestorWithTransformer",_);function _(k,V){return d(f(k,function(G,H){return O(H.tree,H.cells,G.transform.ref,V)}))}e.ancestorWithTransformer=_,s("withTransformer",w);function w(k,V){return p(k,function(G){return G.transform.transformer===V})}e.withTransformer=w,s("root",T);function T(k,V){return d(f(k,function(G,H){return F(H.tree,H.cells,G.transform.ref,V)}))}e.root=T,s("rootOfType",A);function A(k,V){return d(f(k,function(G,H){return N(H.tree,H.cells,G.transform.ref,V)}))}e.rootOfType=A,s("parent",D);function D(k){return d(f(k,function(V,G){return G.cells.get(G.tree.transforms.get(V.transform.ref).parent)}))}e.parent=D;function E(k,V,G,H,X){for(var Y=k.transforms.get(G),oe=void 0;;){Y=k.transforms.get(Y.parent);var ue=V.get(Y.ref);if(ue.obj&&H(ue)&&(oe=ue,X)||Y.ref===gr.RootRef)return oe}}function M(k,V,G,H){return E(k,V,G,H,!0)}e.findAncestor=M;function F(k,V,G,H){return E(k,V,G,H,!1)}e.findRoot=F;function O(k,V,G,H){return M(k,V,G,Array.isArray(H)?function(X){return H.indexOf(X.transform.transformer)>=0}:function(X){return X.transform.transformer===H})}e.findAncestorWithTransformer=O;function U(k,V,G,H){return M(k,V,G,q(H))}e.findAncestorOfType=U;function N(k,V,G,H){return F(k,V,G,q(H))}e.findRootOfType=N;function q(k){return Array.isArray(k)?function(V){for(var G=0,H=k;G<H.length;G++){var X=H[G];if(X.type===V.obj.type)return!0}}:function(V){return V.obj.type===k.type}}function j(k,V,G){return Pn.doPreOrder(k,k.transforms.get(V),{refs:{},tags:G},Q).refs}e.findUniqueTagsInSubtree=j;function Q(k,V,G){if(k.tags)for(var H=0,X=k.tags;H<X.length;H++){var Y=X[H];if(!!G.tags.has(Y)){G.refs[Y]=k.ref;break}}return!0}function J(k,V,G){return Pn.doPreOrder(k,k.transforms.get(V),{ref:void 0,tag:G},te).ref}e.findTagInSubtree=J;function te(k,V,G){return k.tags&&k.tags.indexOf(G.tag)>=0?(G.ref=k.ref,!1):!0}function K(k,V,G){return Pn.doPreOrder(k,k.transforms.get(V),{refs:[],tags:G},L).refs}e.findWithAllTags=K;function L(k,V,G){if(k.tags)for(var H=G.tags.size,X=0,Y=0,oe=k.tags;Y<oe.length;Y++){var ue=oe[Y];if(!!G.tags.has(ue)&&(X++,X===H)){G.refs.push(k);break}}else G.tags.size===0&&G.refs.push(k)}function W(k,V,G){var H=k.transforms.get(V);if(H.transformer===G)return k.cells.get(V);var X=k.tree.children.get(V);if(X.size===1){var Y=X.first();if(k.transforms.get(Y).transformer.definition.isDecorator)return W(k,Y,G)}}e.tryFindDecorator=W})(Yt||(Yt={}));function oa(e){return typeof e=="function"}function kM(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var y3=kM(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,a){return a+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function b3(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var My=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var t,r,n,a,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Cm(o),u=s.next();!u.done;u=s.next()){var c=u.value;c.remove(this)}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else o.remove(this);var l=this.initialTeardown;if(oa(l))try{l()}catch(v){i=v instanceof y3?v.errors:[v]}var f=this._teardowns;if(f){this._teardowns=null;try{for(var d=Cm(f),m=d.next();!m.done;m=d.next()){var p=m.value;try{UM(p)}catch(v){i=i!=null?i:[],v instanceof y3?i=Ht(Ht([],Wg(i)),Wg(v.errors)):i.push(v)}}}catch(v){n={error:v}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}}if(i)throw new y3(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)UM(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=(r=this._teardowns)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&b3(r,t)},e.prototype.remove=function(t){var r=this._teardowns;r&&b3(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),LM=My.EMPTY;function NM(e){return e instanceof My||e&&"closed"in e&&oa(e.remove)&&oa(e.add)&&oa(e.unsubscribe)}function UM(e){oa(e)?e():e.unsubscribe()}var Ry={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},x3={setTimeout:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=x3.delegate;return((r==null?void 0:r.setTimeout)||setTimeout).apply(void 0,Ht([],Wg(e)))},clearTimeout:function(e){var t=x3.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function zM(e){x3.setTimeout(function(){var t=Ry.onUnhandledError;if(t)t(e);else throw e})}function By(){}var Fy=null;function Oy(e){if(Ry.useDeprecatedSynchronousErrorHandling){var t=!Fy;if(t&&(Fy={errorThrown:!1,error:null}),e(),t){var r=Fy,n=r.errorThrown,a=r.error;if(Fy=null,n)throw a}}else e()}var S3=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,NM(r)&&r.add(n)):n.destination=WW,n}return t.create=function(r,n,a){return new C3(r,n,a)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(My),C3=function(e){_t(t,e);function t(r,n,a){var i=e.call(this)||this,o;if(oa(r))o=r;else if(r){o=r.next,n=r.error,a=r.complete;var s;i&&Ry.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return i.unsubscribe()}):s=r,o=o==null?void 0:o.bind(s),n=n==null?void 0:n.bind(s),a=a==null?void 0:a.bind(s)}return i.destination={next:o?_3(o):By,error:_3(n!=null?n:VM),complete:a?_3(a):By},i}return t}(S3);function _3(e,t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{e.apply(void 0,Ht([],Wg(r)))}catch(a){zM(a)}}}function VM(e){throw e}var WW={closed:!0,next:By,error:VM,complete:By},w3=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function GM(e){return e}function XW(e){return e.length===0?GM:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var Eo=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this,i=KW(t)?t:new C3(t,r,n);return Oy(function(){var o=a,s=o.operator,u=o.source;i.add(s?s.call(i,u):u?a._subscribe(i):a._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=HM(r),new r(function(a,i){var o=new C3({next:function(s){try{t(s)}catch(u){i(u),o.unsubscribe()}},error:i,complete:a});n.subscribe(o)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[w3]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return XW(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=HM(t),new t(function(n,a){var i;r.subscribe(function(o){return i=o},function(o){return a(o)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function HM(e){var t;return(t=e!=null?e:Ry.Promise)!==null&&t!==void 0?t:Promise}function YW(e){return e&&oa(e.next)&&oa(e.error)&&oa(e.complete)}function KW(e){return e&&e instanceof S3||YW(e)&&NM(e)}function QW(e){return oa(e==null?void 0:e.lift)}function Lm(e){return function(t){if(QW(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Nm=function(e){_t(t,e);function t(r,n,a,i,o){var s=e.call(this,r)||this;return s.onFinalize=o,s._next=n?function(u){try{n(u)}catch(c){r.error(c)}}:e.prototype._next,s._error=i?function(u){try{i(u)}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=a?function(){try{a()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,s}return t.prototype.unsubscribe=function(){var r,n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))},t}(S3),ZW=kM(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),En=function(e){_t(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new qM(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new ZW},t.prototype.next=function(r){var n=this;Oy(function(){var a,i;if(n._throwIfClosed(),!n.isStopped){var o=n.observers.slice();try{for(var s=Cm(o),u=s.next();!u.done;u=s.next()){var c=u.value;c.next(r)}}catch(l){a={error:l}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}}})},t.prototype.error=function(r){var n=this;Oy(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var a=n.observers;a.length;)a.shift().error(r)}})},t.prototype.complete=function(){var r=this;Oy(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,a=n.hasError,i=n.isStopped,o=n.observers;return a||i?LM:(o.push(r),new My(function(){return b3(o,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,a=n.hasError,i=n.thrownError,o=n.isStopped;a?r.error(i):o&&r.complete()},t.prototype.asObservable=function(){var r=new Eo;return r.source=this,r},t.create=function(r,n){return new qM(r,n)},t}(Eo),qM=function(e){_t(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.next)===null||a===void 0||a.call(n,r)},t.prototype.error=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.error)===null||a===void 0||a.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,a;return(a=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&a!==void 0?a:LM},t}(En),dl=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,a=r.thrownError,i=r._value;if(n)throw a;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(En),jM=new Eo(function(e){return e.complete()});function $W(e){return e&&oa(e.schedule)}function WM(e){return e[e.length-1]}function JW(e){return $W(WM(e))?e.pop():void 0}function eX(e,t){return typeof WM(e)=="number"?e.pop():t}var XM=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function YM(e){return oa(e==null?void 0:e.then)}function KM(e){return oa(e[w3])}function QM(e){return Symbol.asyncIterator&&oa(e==null?void 0:e[Symbol.asyncIterator])}function ZM(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function tX(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var $M=tX();function JM(e){return oa(e==null?void 0:e[$M])}function eR(e){return JH(this,arguments,function(){var r,n,a,i;return ae(this,function(o){switch(o.label){case 0:r=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,_m(r.read())];case 3:return n=o.sent(),a=n.value,i=n.done,i?[4,_m(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,_m(a)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function tR(e){return oa(e==null?void 0:e.getReader)}function Um(e){if(e instanceof Eo)return e;if(e!=null){if(KM(e))return rX(e);if(XM(e))return nX(e);if(YM(e))return aX(e);if(QM(e))return rR(e);if(JM(e))return iX(e);if(tR(e))return oX(e)}throw ZM(e)}function rX(e){return new Eo(function(t){var r=e[w3]();if(oa(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function nX(e){return new Eo(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function aX(e){return new Eo(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,zM)})}function iX(e){return new Eo(function(t){var r,n;try{for(var a=Cm(e),i=a.next();!i.done;i=a.next()){var o=i.value;if(t.next(o),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}t.complete()})}function rR(e){return new Eo(function(t){sX(e,t).catch(function(r){return t.error(r)})})}function oX(e){return rR(eR(e))}function sX(e,t){var r,n,a,i;return ie(this,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=eq(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),a={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function ml(e,t,r,n,a){n===void 0&&(n=0),a===void 0&&(a=!1);var i=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!a)return i}function nR(e,t){return t===void 0&&(t=0),Lm(function(r,n){r.subscribe(new Nm(n,function(a){return ml(n,e,function(){return n.next(a)},t)},function(){return ml(n,e,function(){return n.complete()},t)},function(a){return ml(n,e,function(){return n.error(a)},t)}))})}function aR(e,t){return t===void 0&&(t=0),Lm(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function uX(e,t){return Um(e).pipe(aR(t),nR(t))}function cX(e,t){return Um(e).pipe(aR(t),nR(t))}function lX(e,t){return new Eo(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function fX(e,t){return new Eo(function(r){var n;return ml(r,t,function(){n=e[$M](),ml(r,t,function(){var a,i,o;try{a=n.next(),i=a.value,o=a.done}catch(s){r.error(s);return}o?r.complete():r.next(i)},0,!0)}),function(){return oa(n==null?void 0:n.return)&&n.return()}})}function iR(e,t){if(!e)throw new Error("Iterable cannot be null");return new Eo(function(r){ml(r,t,function(){var n=e[Symbol.asyncIterator]();ml(r,t,function(){n.next().then(function(a){a.done?r.complete():r.next(a.value)})},0,!0)})})}function dX(e,t){return iR(eR(e),t)}function mX(e,t){if(e!=null){if(KM(e))return uX(e,t);if(XM(e))return lX(e,t);if(YM(e))return cX(e,t);if(QM(e))return iR(e,t);if(JM(e))return fX(e,t);if(tR(e))return dX(e,t)}throw ZM(e)}function pX(e,t){return t?mX(e,t):Um(e)}function vX(e,t){return Lm(function(r,n){var a=0;r.subscribe(new Nm(n,function(i){n.next(e.call(t,i,a++))}))})}function hX(e,t,r,n,a,i,o,s){var u=[],c=0,l=0,f=!1,d=function(){f&&!u.length&&!c&&t.complete()},m=function(v){return c<n?p(v):u.push(v)},p=function(v){i&&t.next(v),c++;var h=!1;Um(r(v,l++)).subscribe(new Nm(t,function(g){a==null||a(g),i?m(g):t.next(g)},function(){h=!0},void 0,function(){if(h)try{c--;for(var g=function(){var y=u.shift();o?ml(t,o,function(){return p(y)}):p(y)};u.length&&c<n;)g();d()}catch(y){t.error(y)}}))};return e.subscribe(new Nm(t,m,function(){f=!0,d()})),function(){s==null||s()}}function oR(e,t,r){return r===void 0&&(r=1/0),oa(t)?oR(function(n,a){return vX(function(i,o){return t(n,i,a,o)})(Um(e(n,a)))},r):(typeof t=="number"&&(r=t),Lm(function(n,a){return hX(n,a,e,r)}))}function gX(e){return e===void 0&&(e=1/0),oR(GM,e)}function ku(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=JW(e),n=eX(e,1/0),a=e;return a.length?a.length===1?Um(a[0]):gX(n)(pX(a,r)):jM}function yX(e,t){return Lm(function(r,n){var a=0;r.subscribe(new Nm(n,function(i){return e.call(t,i,a++)&&n.next(i)}))})}function bX(e){return e<=0?function(){return jM}:Lm(function(t,r){var n=0;t.subscribe(new Nm(r,function(a){++n<=e&&(r.next(a),e<=n&&r.complete())}))})}var Lu;(function(e){function t(){var r=new xX,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(a){return r.behavior(a)},n}e.create=t})(Lu||(Lu={}));var xX=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new En;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new dl(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function gs(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function zm(e){return!!e&&!!e[Qi]}function Of(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===EX}(e)||Array.isArray(e)||!!e[hR]||!!e.constructor[hR]||T3(e)||P3(e))}function ph(e,t,r){r===void 0&&(r=!1),Vm(e)===0?(r?Object.keys:U3)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,a){return t(a,n,e)})}function Vm(e){var t=e[Qi];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:T3(e)?2:P3(e)?3:0}function A3(e,t){return Vm(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function SX(e,t){return Vm(e)===2?e.get(t):e[t]}function sR(e,t,r){var n=Vm(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function CX(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function T3(e){return TX&&e instanceof Map}function P3(e){return PX&&e instanceof Set}function kf(e){return e.o||e.t}function E3(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=IX(e);delete t[Qi];for(var r=U3(t),n=0;n<r.length;n++){var a=r[n],i=t[a];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function I3(e,t){return t===void 0&&(t=!1),D3(e)||zm(e)||!Of(e)||(Vm(e)>1&&(e.set=e.add=e.clear=e.delete=_X),Object.freeze(e),t&&ph(e,function(r,n){return I3(n,!0)},!0)),e}function _X(){gs(2)}function D3(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Ws(e){var t=DX[e];return t||gs(18,e),t}function uR(){return vh}function M3(e,t){t&&(Ws("Patches"),e.u=[],e.s=[],e.v=t)}function ky(e){R3(e),e.p.forEach(wX),e.p=null}function R3(e){e===vh&&(vh=e.l)}function cR(e){return vh={p:[],l:vh,h:e,m:!0,_:0}}function wX(e){var t=e[Qi];t.i===0||t.i===1?t.j():t.O=!0}function B3(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||Ws("ES5").S(t,e,n),n?(r[Qi].P&&(ky(t),gs(4)),Of(e)&&(e=Ly(t,e),t.l||Ny(t,e)),t.u&&Ws("Patches").M(r[Qi].t,e,t.u,t.s)):e=Ly(t,r,[]),ky(t),t.u&&t.v(t.u,t.s),e!==vR?e:void 0}function Ly(e,t,r){if(D3(t))return t;var n=t[Qi];if(!n)return ph(t,function(i,o){return lR(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return Ny(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var a=n.i===4||n.i===5?n.o=E3(n.k):n.o;ph(n.i===3?new Set(a):a,function(i,o){return lR(e,n,a,i,o,r)}),Ny(e,a,!1),r&&e.u&&Ws("Patches").R(n,r,e.u,e.s)}return n.o}function lR(e,t,r,n,a,i){if(zm(a)){var o=Ly(e,a,i&&t&&t.i!==3&&!A3(t.D,n)?i.concat(n):void 0);if(sR(r,n,o),!zm(o))return;e.m=!1}if(Of(a)&&!D3(a)){if(!e.h.F&&e._<1)return;Ly(e,a),t&&t.A.l||Ny(e,a)}}function Ny(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&I3(t,r)}function F3(e,t){var r=e[Qi];return(r?kf(r):e)[t]}function fR(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function O3(e){e.P||(e.P=!0,e.l&&O3(e.l))}function k3(e){e.o||(e.o=E3(e.t))}function L3(e,t,r){var n=T3(t)?Ws("MapSet").N(t,r):P3(t)?Ws("MapSet").T(t,r):e.g?function(a,i){var o=Array.isArray(a),s={i:o?1:0,A:i?i.A:uR(),P:!1,I:!1,D:{},l:i,t:a,k:null,o:null,j:null,C:!1},u=s,c=z3;o&&(u=[s],c=hh);var l=Proxy.revocable(u,c),f=l.revoke,d=l.proxy;return s.k=d,s.j=f,d}(t,r):Ws("ES5").J(t,r);return(r?r.A:uR()).p.push(n),n}function AX(e){return zm(e)||gs(22,e),function t(r){if(!Of(r))return r;var n,a=r[Qi],i=Vm(r);if(a){if(!a.P&&(a.i<4||!Ws("ES5").K(a)))return a.t;a.I=!0,n=dR(r,i),a.I=!1}else n=dR(r,i);return ph(n,function(o,s){a&&SX(a.t,o)===s||sR(n,o,t(s))}),i===3?new Set(n):n}(e)}function dR(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return E3(e)}var mR,vh,N3=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",TX=typeof Map!="undefined",PX=typeof Set!="undefined",pR=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",vR=N3?Symbol.for("immer-nothing"):((mR={})["immer-nothing"]=!0,mR),hR=N3?Symbol.for("immer-draftable"):"__$immer_draftable",Qi=N3?Symbol.for("immer-state"):"__$immer_state",EX=""+Object.prototype.constructor,U3=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,IX=Object.getOwnPropertyDescriptors||function(e){var t={};return U3(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},DX={},z3={get:function(e,t){if(t===Qi)return e;var r=kf(e);if(!A3(r,t))return function(a,i,o){var s,u=fR(i,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(a.k):void 0}(e,r,t);var n=r[t];return e.I||!Of(n)?n:n===F3(e.t,t)?(k3(e),e.o[t]=L3(e.A.h,n,e)):n},has:function(e,t){return t in kf(e)},ownKeys:function(e){return Reflect.ownKeys(kf(e))},set:function(e,t,r){var n=fR(kf(e),t);if(n==null?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var a=F3(kf(e),t),i=a==null?void 0:a[Qi];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(CX(r,a)&&(r!==void 0||A3(e.t,t)))return!0;k3(e),O3(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return F3(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,k3(e),O3(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=kf(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){gs(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){gs(12)}},hh={};ph(z3,function(e,t){hh[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),hh.deleteProperty=function(e,t){return hh.set.call(this,e,t,void 0)},hh.set=function(e,t,r){return z3.set.call(this,e[0],t,r,e[0])};var MX=function(){function e(r){var n=this;this.g=pR,this.F=!0,this.produce=function(a,i,o){if(typeof a=="function"&&typeof i!="function"){var s=i;i=a;var u=n;return function(v){var h=this;v===void 0&&(v=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(v,function(x){var C;return(C=i).call.apply(C,[h,x].concat(y))})}}var c;if(typeof i!="function"&&gs(6),o!==void 0&&typeof o!="function"&&gs(7),Of(a)){var l=cR(n),f=L3(n,a,void 0),d=!0;try{c=i(f),d=!1}finally{d?ky(l):R3(l)}return typeof Promise!="undefined"&&c instanceof Promise?c.then(function(v){return M3(l,o),B3(v,l)},function(v){throw ky(l),v}):(M3(l,o),B3(c,l))}if(!a||typeof a!="object"){if((c=i(a))===void 0&&(c=a),c===vR&&(c=void 0),n.F&&I3(c,!0),o){var m=[],p=[];Ws("Patches").M(a,c,m,p),o(m,p)}return c}gs(21,a)},this.produceWithPatches=function(a,i){if(typeof a=="function")return function(c){for(var l=arguments.length,f=Array(l>1?l-1:0),d=1;d<l;d++)f[d-1]=arguments[d];return n.produceWithPatches(c,function(m){return a.apply(void 0,[m].concat(f))})};var o,s,u=n.produce(a,i,function(c,l){o=c,s=l});return typeof Promise!="undefined"&&u instanceof Promise?u.then(function(c){return[c,o,s]}):[u,o,s]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Of(r)||gs(8),zm(r)&&(r=AX(r));var n=cR(this),a=L3(this,r,void 0);return a[Qi].C=!0,R3(n),a},t.finishDraft=function(r,n){var a=r&&r[Qi],i=a.A;return M3(i,n),B3(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!pR&&gs(20),this.g=r},t.applyPatches=function(r,n){var a;for(a=n.length-1;a>=0;a--){var i=n[a];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}a>-1&&(n=n.slice(a+1));var o=Ws("Patches").$;return zm(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),Zi=new MX,Lf=Zi.produce;Zi.produceWithPatches.bind(Zi);var RX=Zi.setAutoFreeze.bind(Zi);Zi.setUseProxies.bind(Zi);Zi.applyPatches.bind(Zi);Zi.createDraft.bind(Zi);Zi.finishDraft.bind(Zi);var Nf;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,c=o.actions;u<c.length;u++){var l=c[u];switch(l.kind){case"add":s.add(l.transform);break;case"update":s.setParams(l.ref,l.params);break;case"delete":s.remove(l.ref);break;case"insert":{var f=s.children.get(l.ref).toArray();s.add(l.transform);for(var d=0,m=f;d<m.length;d++){var p=m[d];s.changeParent(p,l.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var a=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:qv.is(s)?s.transform.ref:s.ref;return new i(this.state,u,this)},o.prototype.toRoot=function(){return new i(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=ia.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=a;var i=function(){function o(s,u,c){if(this.state=s,this.root=c,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '".concat(u,"'."))}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new ID(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return Pn.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,c){if(s.definition.isDecorator)return this.insert(s,u,c);var l=this.getApplyRoot(),f=s.apply(l,u,c);return this.state.tree.add(f),this.editInfo.count++,this.editInfo.lastUpdate=f.ref,this.state.actions.push({kind:"add",transform:f}),new o(this.state,f.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,c,l){if(this.state.tree.transforms.has(s)){var f=this.to(s);return c&&f.update(c),f}else return this.apply(u,c,I(I({},l),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,c,l){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var f=this.getApplyRoot(),d=this.state.tree.children.get(f).values();;){var m=d.next();if(m.done)break;var p=this.state.tree.transforms.get(m.value);if(p&&gr.hasTags(p,s)){var v=this.to(m.value);return v.updateTagged(c,gR(p.tags,s,l&&l.tags)),v}}var h=u.apply(f,c,I(I({},l),{tags:gR(s,l&&l.tags)}));return this.state.tree.add(h),this.editInfo.count++,this.editInfo.lastUpdate=h.ref,this.state.actions.push({kind:"add",transform:h}),new o(this.state,h.ref,this.root)},o.prototype.group=function(s,u,c){return this.apply(s,u,c)},o.prototype.insert=function(s,u,c){var l=this.state.tree.children.get(this.ref).toArray(),f=s.apply(this.ref,u,c);this.state.tree.add(f);for(var d=0,m=l;d<m.length;d++){var p=m[d];this.state.tree.changeParent(p,f.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=f.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:f}),new o(this.state,f.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var c;if(u){var l=this.state.tree.transforms.get(this.ref);c=Lf(l.params,u)}else c=typeof s=="function"?Lf(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=i})(Nf||(Nf={}));function gR(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],a=0,i=e;a<i.length;a++){var o=i[a];if(!!o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var c=u[s];r.has(c)||(r.add(c),n.push(c))}}return n}var BX=function(){function e(){this.ev=Lu.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=Ge.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,a=r.definition.from;n<a.length;n++){var i=a[n];this.fromTypeIndex.has(i.type)?this.fromTypeIndex.get(i.type).push(r):this.fromTypeIndex.set(i.type,[r])}return this.events.added.next(void 0),this},e.prototype.remove=function(t){var r=Ge.is(t)?t.toAction().id:zr.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var a=0,i=n.definition.from;a<i.length;a++){var o=i[a],s=this.fromTypeIndex.get(o.type);!s||(Ff(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var a=this.fromTypeIndex.get(n.type);if(!a)return[];for(var i=!1,o=0,s=a;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){i=!0;break}}if(!i)return a;for(var c=[],l=0,f=a;l<f.length;l++){var u=f[l];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&c.push(u):c.push(u)}return c},e.prototype.dispose=function(){this.ev.dispose()},e}(),Xs;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function a(i){return{type:"info",timestamp:new Date,message:i}}e.info=a})(Xs||(Xs={}));var Uy;(function(e){var t=function(){function a(i){this.cells=i,this._current=void 0}return Object.defineProperty(a.prototype,"current",{get:function(){return this._current},set:function(i){this._current=i},enumerable:!1,configurable:!0}),a.prototype.getAncestorOfType=function(i){if(!!this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===i.type)return o.obj;if(o.transform.ref===gr.RootRef)return}},a.prototype.getRootOfType=function(i){if(!!this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===i.type&&(s=o),o.transform.ref===gr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},a}();e.Impl=t;function r(a,i){for(var o=a.cells,s=o.get(i),u=[s];s==null?void 0:s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(a,i,o){var s=void 0,u=a.cells.get(o);if(!!u)for(;;){if(!u.obj)return;if(u.obj.type===i.type&&(s=u),u.transform.ref===gr.RootRef)return s?s.obj:void 0;u=a.cells.get(u.transform.parent)}}e.getRootOfType=n})(Uy||(Uy={}));var FX=function(){function e(){this.queue=[],this.signal=new En}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){dh(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=dh(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var a=r.signal.subscribe(function(i){var o=i.v,s=i.stillPresent;o===t&&(a.unsubscribe(),n(s))})})},e}(),OX=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),a=0,i=n.length;a<i;a++)if(this.areEqual(t,n[a]))return!0;return!1},e}();function V3(e,t){return new OX(e,t)}function G3(){return new kX}function yR(e){return{previous:null,next:null,inList:!0,value:e}}var kX=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=yR(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=yR(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){!t.inList||(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),Br;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(a,i,o){var s=a.keys,u=a.array;return s.has(i)?!1:(s.add(i),u[u.length]=o,!0)}e.add=r;function n(a,i){var o=a.keys;return o.has(i)}e.has=n})(Br||(Br={}));var zy=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=Lu.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:gr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new BX,this.cells=new Map,this.spine=new Uy.Impl(this.cells),this.tryGetCellData=function(o){var s,u,c=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '".concat(o,"' data undefined."));return c},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new FX,this._tree=Pn.createEmpty(gr.createRoot(r&&r.rootState)).asTransient();var a=this._tree,i=a.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:I({},i.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new Nf.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return Be.create("Undo",function(r){return ie(t,void 0,void 0,function(){var n;return ae(this,function(a){switch(a.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return a.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:Pn.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=Pn.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(!!n){var a=typeof r=="function"?r(n.state):r;gr.assignState(n.state,a)&&(n.transform=this._tree.assignState(n.transform.ref,a),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return Yt.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?Yt.select(t,this):Yt.select(t(Yt.Generators),this)},e.prototype.applyAction=function(t,r,n){var a=this;return n===void 0&&(n=gr.RootRef),Be.create("Apply Action",function(i){var o=a.cells.get(n);if(!o)throw new Error("'".concat(n,"' does not exist."));if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '".concat(o.status,"'"));return W3(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:a},a.globalContext),i)})},e.prototype.transaction=function(t,r){var n=this;return Be.create("State Transaction",function(a){return ie(n,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){switch(c.label){case 0:i=this.inTransaction,o=this._tree.asImmutable(),s=!1,c.label=1;case 1:return c.trys.push([1,5,8,9]),i||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(a)];case 2:return c.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(a)]):[3,4];case 3:c.sent(),c.label=4;case 4:return[3,9];case 5:return u=c.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(a)]);case 6:c.sent(),this.events.log.next(Xs.error("Error during state transaction, reverting")),c.label=7;case 7:if(i)throw this.inTransactionError=!0,u;if(r==null?void 0:r.rethrowErrors)throw u;return console.error(u),[3,9];case 8:return i||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||((r==null?void 0:r.canUndo)?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,a={tree:t,options:r};return Be.create("Update Tree",function(i){return ie(n,void 0,void 0,function(){var o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return[4,this.updateQueue.enqueue(a)];case 1:if(o=f.sent(),!o)return[2];this._inUpdate=!0,s=(r==null?void 0:r.canUndo)?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),f.label=2;case 2:if(f.trys.push([2,,7,8]),Nf.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(i,a,r)]:[3,4];case 3:return l=f.sent(),[3,6];case 4:return[4,this._updateTree(i,a)];case 5:l=f.sent(),f.label=6;case 6:return c=l,u=this.reverted,c.ctx.hadError&&(this.inTransactionError=!0),c.cell?[2,new ID(c.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(a),this.inTransaction||(this.behaviors.isUpdating.next(!1),(r==null?void 0:r.canUndo)?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(a)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ie(this,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return a=this.tree,[4,this._updateTree(t,r)];case 1:return i=s.sent(),o=(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:a,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,i]}})})},e.prototype._updateTree=function(t,r){return ie(this,void 0,void 0,function(){var n,a,i;return ae(this,function(o){switch(o.label){case 0:n=!1,a=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,NX(a)];case 2:return n=o.sent(),Nf.isTo(r.tree)?(i=this.select(r.tree.ref)[0],[2,{ctx:a,cell:i}]):[2,{ctx:a}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var a=(Nf.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=a;var o=this.cells,s={parent:this,editInfo:Nf.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:a,cells:this.cells,spine:this.spine,results:[],options:I(I({},LX),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var c;return(c=o.get(u).obj)===null||c===void 0?void 0:c.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(a,i){return!!i&&a.ref===i.transform.ref&&a.state===i.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(zy||(zy={}));var LX={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function NX(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,f,d,m,p,c,d,v,h,g,y,d,f,c,b,x,C,d,_,w,T,A,D,E,M,F,i,O;return ae(this,function(U){switch(U.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],a=[e.editInfo.lastUpdate];else{for(r=GX(e),i=e.parent.current,o=!1,s=0,u=r;s<u.length;s++)if(c=u[s],c===i){o=!0;break}for(o&&(l=bR(e.oldTree,i,r,e.cells),e.parent.setCurrent(l)),f=r.length-1;f>=0;f--)d=e.cells.get(r[f]),d&&q3(d.transform,d.obj,d==null?void 0:d.transform.params,d.cache,e.parent.globalContext);for(m=0,p=r;m<p.length;m++)c=p[m],d=e.cells.get(c),d&&(d.parent=void 0,XX(d)),v=d&&d.obj,e.cells.delete(c),n.push(v);a=UX(e.cells,e.tree)}for(h=QX(e,a),g=0,y=h.added;g<y.length;g++)d=y[g],e.parent.events.cell.created.next({state:e.parent,ref:d.transform.ref,cell:d});for(f=0;f<r.length;f++)c=r[f],b=e.oldTree.transforms.get(c).parent,e.parent.events.object.removed.next({state:e.parent,ref:c,obj:n[f]}),e.parent.events.cell.removed.next({state:e.parent,ref:c,parent:b});if(n.length&&(n=[]),h.dependent)for(x=0,C=h.dependent;x<C.length;x++)d=C[x],a.push(d.transform.ref);WX(e,a),_=0,w=a,U.label=1;case 1:return _<w.length?(T=w[_],[4,SR(e,T)]):[3,4];case 2:U.sent(),U.label=3;case 3:return _++,[3,1];case 4:for(e.editInfo||qX(e),A=e.newCurrent,D=0,E=e.results;D<E.length;D++)M=E[D],M.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:M.ref,obj:M.obj}),e.newCurrent||(F=e.tree.transforms.get(M.ref),!F.state.isGhost&&M.obj!==rn.Null&&(A=M.ref))):M.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:M.ref,action:"in-place",obj:M.obj,oldData:M.oldData}):M.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:M.ref,action:"recreate",obj:M.obj,oldObj:M.oldObj});return A?e.options.doNotUpdateCurrent||e.parent.setCurrent(A):(i=e.parent.current,O=e.cells.get(i),O&&(O.obj===rn.Null||O.status==="error"&&O.errorText===ZX)&&(A=bR(e.oldTree,i,[],e.cells),e.parent.setCurrent(A))),[2,r.length>0||a.length>0||e.changed]}})})}function UX(e,t){var r={roots:[],cells:e};return Pn.doPreOrder(t,t.root,r,zX),r.roots}function zX(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===rn.Null)}function VX(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function GX(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return Pn.doPostOrder(e.oldTree,e.oldTree.root,t,VX),t.deletes}function HX(e,t,r){var n=r.cells.get(e.ref);!n||!gr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function qX(e){Pn.doPreOrder(e.tree,e.tree.root,e,HX)}function Vy(e,t,r,n){var a=e.cells.get(t),i=a.status!==r;a.status=r,a.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:a})}function jX(e,t,r){r.cells.get(e.ref).transform=e,Vy(r,e.ref,"pending")}function WX(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];Pn.doPreOrder(e.tree,e.tree.transforms.get(a),e,jX)}}function XX(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];Ff(n.dependencies.dependentBy,e)}}function YX(e,t,r){var n=r.ctx,a=r.added,i=r.visited;if(i.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:I({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),a.push(o)}}function KX(e,t){if(!!e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var a=n[r],i=t.tree.transforms.get(a);if(!i)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(a);gn(e.dependencies.dependsOn,o),gn(o.dependencies.dependentBy,e)}}function QX(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,a=t;n<a.length;n++){var i=a[n];Pn.doPreOrder(e.tree,e.tree.transforms.get(i),r,YX)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];KX(u,e)}var c;return r.visited.forEach(function(l){for(var f=e.cells.get(l),d=0,m=f.dependencies.dependentBy;d<m.length;d++){var p=m[d];r.visited.has(p.transform.ref)||(c||(c=Br.create()),Br.add(c,p.transform.ref,p))}}),{added:r.added,dependent:c?c.array:void 0}}function bR(e,t,r,n){var a=new Set(r);return xR(e,t,a,n)}function xR(e,t,r,n){if(t===gr.RootRef)return t;for(var a=e.transforms.get(t),i=e.children.get(a.parent).values(),o=void 0,s=!1;;){var u=i.next();if(u.done)break;if(!r.has(u.value)){var c=n.get(u.value);if(!(!c||c.status==="error"||c.obj===rn.Null)){var l=e.transforms.get(u.value);if(!l.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return l.ref;o=l.ref}}}}return o||xR(e,a.parent,r,n)}function H3(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var a=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Be.isAbort(r);var i=""+r;Vy(e,t,"error",i),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else a.params=void 0;if(a.obj){var o=a.obj;a.obj=void 0,a.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;H3(e,u.value,void 0,n)}}var ZX="Parent is null";function SR(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u;return ae(this,function(c){switch(c.label){case 0:Vy(e,t,"processing"),r=!1,c.label=1;case 1:return c.trys.push([1,3,,4]),n=en(),[4,JX(e,t)];case 2:return a=c.sent(),i=en()-n,a.action!=="none"&&(e.changed=!0),Vy(e,t,"ok"),e.results.push(a),a.action==="created"?(r=a.obj===rn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Xs.info("Created ".concat(a.obj.label," in ").concat(fC(i),".")))):(a.action==="updated"||a.action==="replaced")&&(r=a.obj===rn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Xs.info("Updated ".concat(a.obj.label," in ").concat(fC(i),".")))),[3,4];case 3:return o=c.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),H3(e,t,o,!1),console.error(o),[2];case 4:s=e.tree.children.get(t).values(),c.label=5;case 5:return u=s.next(),u.done?[2]:r?(H3(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,SR(e,u.value)];case 7:c.sent(),c.label=8;case 8:return[3,5];case 9:return[2]}})})}function $X(e,t,r,n){var a=t.transformer.definition.params,i=a?a(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=P.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=P.getDefaultValues(i);t.params=t.params?sj(t.params,o):o}return P.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}function JX(e,t){var r;return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b;return ae(this,function(x){switch(x.label){case 0:if(n=e.oldTree,a=e.tree,i=e.cells.get(t),o=i.transform,i.transform.ref===gr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(i.transform.parent):Yt.findAncestorOfType(a,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '".concat(t,"'"));return e.spine.current=i,u=s.obj,i.sourceRef=s.transform.ref,c=$X(e,o,u,i),!n.transforms.has(t)||!i.params?(i.params=c,[4,_R(e,i,o.transformer,u,c.values)]):[3,2];case 1:return l=x.sent(),j3(l,o),i.obj=l,[2,{ref:t,action:"created",obj:l}];case 2:return f=i.params.values,d=i.cache,m=(r=i.obj)===null||r===void 0?void 0:r.data,p=c.values,i.params=c,!!i.obj&&i.obj!==rn.Null?[4,eY(e,i,o.transformer,u,i.obj,f,p)]:[3,4];case 3:return h=x.sent(),[3,5];case 4:h=Ge.UpdateResult.Recreate,x.label=5;case 5:switch(v=h,g=v,g){case Ge.UpdateResult.Recreate:return[3,6];case Ge.UpdateResult.Updated:return[3,8];case Ge.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=i.obj,q3(o,y,f,d,e.parent.globalContext),[4,_R(e,i,o.transformer,u,p)];case 7:return b=x.sent(),j3(b,o),i.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return j3(i.obj,o),[2,{ref:t,action:"updated",oldData:m,obj:i.obj}];case 9:return q3(o,i.obj,f,d,e.parent.globalContext),i.obj=rn.Null,[2,{ref:t,action:"updated",obj:i.obj}];case 10:return[2,{action:"none"}]}})})}function q3(e,t,r,n,a){var i,o;(o=(i=e.transformer.definition).dispose)===null||o===void 0||o.call(i,{b:t!==rn.Null?t:void 0,params:r,cache:n},a)}function j3(e,t){!e||e===rn.Null||(e.tags=t.tags)}function W3(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function CR(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var a=n[r];if(!a.obj)throw new Error("Unresolved dependency.");t[a.transform.ref]=a.obj}return t}}function _R(e,t,r,n,a){return t.cache||(t.cache=Object.create(null)),W3(r.definition.apply({a:n,params:a,cache:t.cache,spine:e.spine,dependencies:CR(t)},e.parent.globalContext),e.taskCtx)}function eY(e,t,r,n,a,i,o){return ie(this,void 0,void 0,function(){return ae(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,W3(r.definition.update({a:n,oldParams:i,b:a,newParams:o,cache:t.cache,spine:e.spine,dependencies:CR(t)},e.parent.globalContext),e.taskCtx)]):[2,Ge.UpdateResult.Recreate]})})}var fe;(function(e){e.Create=rn.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(I(I({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function a(s){return e.Create(I(I({},s),{typeClass:"Behavior"}))}e.CreateBehavior=a;var i=function(s){_t(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=i;var o=function(s){_t(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var c=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=c;var l=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=l}(e.Data||(e.Data={})),function(s){var u=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var c=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=c;var l=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=l;var f=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=f;var d=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=d;var m=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=m;var p=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=p;var v=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=v;var h=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=h}(e.Format||(e.Format={})),function(s){var u=function(m){_t(p,m);function p(){return m!==null&&m.apply(this,arguments)||this}return p}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var c=function(m){_t(p,m);function p(){return m!==null&&m.apply(this,arguments)||this}return p}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=c;var l=function(m){_t(p,m);function p(){return m!==null&&m.apply(this,arguments)||this}return p}(e.Create({name:"Model",typeClass:"Object"}));s.Model=l;var f=function(m){_t(p,m);function p(){return m!==null&&m.apply(this,arguments)||this}return p}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=f;var d=function(m){_t(p,m);function p(){return m!==null&&m.apply(this,arguments)||this}return p}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=d,function(m){var p=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));m.Representation3D=p;var v=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));m.Representation3DState=v;var h=function(g){_t(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));m.Selections=h}(d=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var c=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=c;var l=function(f){_t(d,f);function d(){return f!==null&&f.apply(this,arguments)||this}return d}(n({name:"Volume 3D"}));s.Representation3D=l}(e.Volume||(e.Volume={})),function(s){var u=function(l){_t(f,l);function f(){return l!==null&&l.apply(this,arguments)||this}return f}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var c=function(l){_t(f,l);function f(){return l!==null&&l.apply(this,arguments)||this}return f}(n({name:"Shape 3D"}));s.Representation3D=c}(e.Shape||(e.Shape={}))})(fe||(fe={}));var bt;(function(e){e.CreateBuiltIn=Ge.factory("ms-plugin"),e.BuiltIn=Ge.builderFactory("ms-plugin")})(bt||(bt={}));var $r;(function(e){function t(i,o){return o===void 0&&(o=-1),new n(i,o)}e.error=t;function r(i,o){return o===void 0&&(o=[]),new a(i,o)}e.success=r;var n=function(){function i(o,s){this.message=o,this.line=s,this.isError=!0}return i.prototype.toString=function(){return this.line>=0?"[Line ".concat(this.line,"] ").concat(this.message):this.message},i}();e.Error=n;var a=function(){function i(o,s){this.result=o,this.warnings=s,this.isError=!1}return i}();e.Success=a})($r||($r={}));var ys;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(c){return u.getInt8(c)},readUInt8:function(c){return u.getUint8(c)},writeInt8:function(c,l){return u.setInt8(l,c)},writeUInt8:function(c,l){return u.setUint8(l,c)},readInt16LE:function(c){return u.getInt16(c,!0)},readInt32LE:function(c){return u.getInt32(c,!0)},readUInt16LE:function(c){return u.getUint16(c,!0)},readUInt32LE:function(c){return u.getUint32(c,!0)},readFloatLE:function(c){return u.getFloat32(c,!0)},readDoubleLE:function(c){return u.getFloat64(c,!0)},writeInt16LE:function(c,l){return u.setInt16(l,c,!0)},writeInt32LE:function(c,l){return u.setInt32(l,c,!0)},writeUInt16LE:function(c,l){return u.setUint16(l,c,!0)},writeUInt32LE:function(c,l){return u.setUint32(l,c,!0)},writeFloatLE:function(c,l){return u.setFloat32(l,c,!0)},writeDoubleLE:function(c,l){return u.setFloat64(l,c,!0)},readInt16BE:function(c){return u.getInt16(c,!1)},readInt32BE:function(c){return u.getInt32(c,!1)},readUInt16BE:function(c){return u.getUint16(c,!1)},readUInt32BE:function(c){return u.getUint32(c,!1)},readFloatBE:function(c){return u.getFloat32(c,!1)},readDoubleBE:function(c){return u.getFloat64(c,!1)},writeInt16BE:function(c,l){return u.setInt16(l,c,!1)},writeInt32BE:function(c,l){return u.setInt32(l,c,!1)},writeUInt16BE:function(c,l){return u.setUint16(l,c,!1)},writeUInt32BE:function(c,l){return u.setUint32(l,c,!1)},writeFloatBE:function(c,l){return u.setFloat32(l,c,!1)},writeDoubleBE:function(c,l){return u.setFloat64(l,c,!1)},copy:function(c,l,f,d){return l=jn(l,0),f=jn(f,0),d=jn(d,s.length),c.set(s.subarray(f,d),l),d-f}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function a(s,u,c,l,f){for(var d=0,m=c;d<m;d+=l)for(var p=0;p<l;p++)u[f+d+l-p-1]=s[f+d+p]}e.flipByteOrder=a;function i(s,u,c){u===void 0&&(u=0);for(var l=new Int16Array(s,u,c),f=0,d=l.length;f<d;++f){var m=l[f];l[f]=(m&255)<<8|m>>8&255}}e.flipByteOrderInPlace2=i;function o(s,u,c,l,f){e.IsNativeEndianLittle||!c||l<=1||a(s,u,c,l,f)}e.ensureLittleEndian=o})(ys||(ys={}));var Gy;(function(e){function t(r,n){return{name:n,readBuffer:function(a,i,o,s){var u,c;if(typeof i=="number"){o=jn(o,i);var l=a,f=Math.min(r.length,l+o);u=f-l,c=ys.fromUint8Array(new Uint8Array(r.buffer,l,f-l))}else{o=jn(o,i.length);var l=a,f=Math.min(r.length,l+o);i.set(r.subarray(l,f),s),u=f-l,c=i}return o!==u&&console.warn("byteCount ".concat(o," and bytesRead ").concat(u," differ")),Promise.resolve({bytesRead:u,buffer:c})},writeBuffer:function(a,i,o){return o=jn(o,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(a,i,o){return o=jn(o,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:dC}}e.fromBuffer=t})(Gy||(Gy={}));var Ba;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(Ba||(Ba={}));function wR(e){return e===Ba.Float32?4:e===Ba.Int16||e===Ba.Uint16?2:1}function tY(e,t,r,n){return r===void 0&&(r=0),e===Ba.Float32?new Float32Array(t,r,n):e===Ba.Int16?new Int16Array(t,r,n):e===Ba.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function rY(e,t){var r=wR(t),n=new ArrayBuffer(r*e),a=ys.fromArrayBuffer(n),i=ys.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:a,valuesBuffer:new Uint8Array(i),values:tY(t,i)}}function nY(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){return ae(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,a)];case 1:return o.sent(),e.elementByteSize>1&&(i!==void 0&&i!==ys.IsNativeEndianLittle||!ys.IsNativeEndianLittle)&&ys.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,a),[2,e.values]}})})}function aY(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=l.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return a=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1,a[0]===68&&a[1]===65?i=!0:a[0]===17&&a[1]===17?i=!1:(o=r.readInt32LE(3*4),o<=16&&(i=!0)),s=i?function(f){return r.readInt32LE(f*4)}:function(f){return r.readInt32BE(f*4)},u=i?function(f){return r.readFloatLE(f*4)}:function(f){return r.readFloatBE(f*4)},c={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:a,ARMS:u(54)},[2,{header:c,littleEndian:i}]}})})}function iY(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return TR(e)?(o=3*a,[4,r.readBuffer(n,t.readBuffer,a,o)]):[3,2];case 1:for(d.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,c=.5*(e.AMIN+e.AMAX+u),l=0,f=a;l<f;++l)t.values[l]=u*s[l]+c;return[3,4];case 2:return[4,nY(t,r,n,a,0,i)];case 3:d.sent(),d.label=4;case 4:return[2]}})})}function AR(e){switch(e){case 0:return Ba.Int8;case 1:return Ba.Int16;case 2:return Ba.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:Ba.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '".concat(e,"'"))}function TR(e){return e.userFlag1===-128&&e.userFlag2===127}function PR(e){return TR(e)?Ba.Float32:AR(e.MODE)}function oY(e){return 256*4+e.NSYMBT}function sY(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return p.sent(),[4,aY(e)];case 2:return n=p.sent(),a=n.header,i=n.littleEndian,o=oY(a),s=AR(a.MODE),u=PR(a),c=a.NC*a.NR*a.NS,l=wR(s),f=c*l,d=rY(c,u),iY(a,d,e,o,f,i),m={header:a,values:d.values,name:e.name},[2,m]}})})}function uY(e,t){var r=this;return Be.create("Parse CCP4/MRC/MAP",function(n){return ie(r,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=$r).success,[4,sY(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,$r.error(o)];case 3:return[2]}})})})}function cY(e,t){return uY(Gy.fromBuffer(ys.fromUint8Array(e),t),e.length)}function Zt(e){return function(t){return X3(e,t)}}function X3(e,t){var r=e.data,n=e.indices,a=e.count,i=t.valueType,o=i==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:i==="int"?function(s){return sl(r,n[2*s],n[2*s+1])||0}:function(s){return Ru(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:o,valueKind:function(s){return 0},toArray:function(s){return ga(a,o,s)},areValuesEqual:ER(e)}}function ER(e){var t=e.data,r=e.indices;return function(n,a){var i=r[2*n],o=r[2*a],s=r[2*n+1]-i;if(s!==r[2*a+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+o))return!1;return!0}}function lY(e){for(var t=e.count,r=e.indices,n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function IR(e,t){return{name:t,blocks:e}}function Y3(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(a){var i=a.split("."),o=i[0],s=i[1];return t[o].getField(s||"")}}}function fY(e,t,r){return{categoryNames:e,header:r,categories:t}}function Fa(e,t,r,n){return{rowCount:t,name:e,fieldNames:Ht([],r,!0),getField:function(a){return n[a]}}}(function(e){function t(a){return{rowCount:0,name:a,fieldNames:[],getField:function(i){}}}e.empty=t;function r(a,i){var o=Object.keys(i);return{rowCount:o.length>0?i[o[0]].rowCount:0,name:a,fieldNames:o,getField:function(s){return i[s]}}}e.ofFields=r;function n(a,i){for(var o={},s=0,u=i._columns;s<u.length;s++){var c=u[s];o[c]=at.ofColumn(i[c])}return r(a,o)}e.ofTable=n})(Fa||(Fa={}));var at;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,c=function(m){var p=s[m];return!p||p==="."||p==="?"?"":p},l=function(m){var p=s[m];return sl(p,0,p.length)||0},f=function(m){var p=s[m];return Ru(p,0,p.length)||0},d=function(m){var p=s[m],v=p.length;if(v>1)return 0;if(v===0)return 1;var h=p.charCodeAt(0);return h===46?1:h===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:f,valueKind:d,areValuesEqual:function(m,p){return s[m]===s[p]},toStringArray:function(m){return m?ga(u,c,m):s},toIntArray:function(m){return ga(u,l,m)},toFloatArray:function(m){return ga(u,f,m)}}}e.ofStrings=r;function n(s){var u=s.length,c=function(m){return""+s[m]},l=function(m){return s[m]},f=function(m){return 0},d=function(m){return!m||m.array&&s instanceof m.array?s:ga(u,l,m)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:c,int:l,float:l,valueKind:f,areValuesEqual:function(m,p){return s[m]===s[p]},toStringArray:function(m){return ga(u,c,m)},toIntArray:d,toFloatArray:d}}e.ofNumbers=n;function a(s){var u=s.data,c=s.indices,l=s.count,f=function(v){var h=u.substring(c[2*v],c[2*v+1]);return h==="."||h==="?"?"":h},d=function(v){return sl(u,c[2*v],c[2*v+1])||0},m=function(v){return Ru(u,c[2*v],c[2*v+1])||0},p=function(v){var h=c[2*v],g=c[2*v+1]-h;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(h);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:f,int:d,float:m,valueKind:p,areValuesEqual:ER(s),toStringArray:function(v){return ga(l,f,v)},toIntArray:function(v){return ga(l,d,v)},toFloatArray:function(v){return ga(l,m,v)}}}e.ofTokens=a;function i(s){var u=s.rowCount,c=s.valueKind,l=s.areValuesEqual,f=s.isDefined,d,m,p;switch(s.schema.valueType){case"float":case"int":d=function(h){return""+s.value(h)},m=s.value,p=s.value;break;case"str":d=s.value,m=function(h){var g=s.value(h);return sl(g,0,g.length)||0},p=function(h){var g=s.value(h);return Ru(g,0,g.length)||0};break;case"list":var v=s.schema.separator;d=function(h){return s.value(h).join(v)},m=function(h){return NaN},p=function(h){return NaN};break;default:throw new Error("unsupported valueType '".concat(s.schema.valueType,"'"))}return{__array:void 0,binaryEncoding:void 0,isDefined:f,rowCount:u,str:d,int:m,float:p,valueKind:c,areValuesEqual:l,toStringArray:function(h){return ga(u,d,h)},toIntArray:function(h){return ga(u,m,h)},toFloatArray:function(h){return ga(u,p,h)}}}e.ofColumn=i;function o(s,u){return i(ce.Undefined(s,u))}e.ofUndefined=o})(at||(at={}));function dY(e,t,r,n){var a=r?0:1;switch(t){case 1:return n==="brackets"?function(i){return"".concat(e,"[").concat(i+a,"]")}:function(i){return"".concat(e,"_").concat(i+a)};case 2:return n==="brackets"?function(i,o){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"]")}:function(i,o){return"".concat(e,"_").concat(i+a).concat(o+a)};case 3:return n==="brackets"?function(i,o,s){return"".concat(e,"[").concat(i+a,"][").concat(o+a,"][").concat(s+a,"]")}:function(i,o,s){return"".concat(e,"_").concat(i+a).concat(o+a).concat(s+a)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function mY(e,t,r,n){var a=t.create();if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s=e.getField(n(o));t.set(a,o,s?s.float(r):0)}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var c=0;c<u;c++){var s=e.getField(n(o,c));t.set(a,o,c,s?s.float(r):0)}else if(t.rank===3)for(var l=t.dimensions[0],f=t.dimensions[1],d=t.dimensions[2],o=0;o<l;o++)for(var c=0;c<f;c++)for(var m=0;m<d;m++){var s=e.getField(n(o,c,m));t.set(a,o,c,m,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return a}function et(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function a(y){y.tokenStart=y.position}e.markStart=a;function i(y){return y.tokenStart=y.position,n(y)}e.markLine=i;function o(y){return i(y),t(y)}e.readLine=o;function s(y){i(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,x){for(var C=0,_=0;_<b;_++){if(!i(y))return C;qe.addUnchecked(x,y.tokenStart,y.tokenEnd),C++}return C}function c(y,b){var x=qe.create(y.data,b*2);return u(y,b,x),x}e.markLines=c;function l(y,b){for(var x=[],C=0;C<b;C++)x.push(e.readLine(y));return x}e.readLines=l;function f(y,b,x,C){return C===void 0&&(C=1e5),ie(this,void 0,void 0,function(){var _,w,T;return ae(this,function(A){switch(A.label){case 0:return _=y.length,w=qe.create(y.data,b*2),T=0,[4,Fu(x,C,y,function(D,E){var M=Math.min(b-T,D);return u(E,M,w),T+=M,M},function(D,E){return D.update({message:"Parsing...",current:E.position,max:_})})];case 1:return A.sent(),[2,w]}})})}e.readLinesAsync=f;function d(y){for(var b=e(y),x=qe.create(b.data,Math.max(y.length/80,2));i(b);)qe.add(x,b.tokenStart,b.tokenEnd);return x}e.readAllLines=d;function m(y,b,x){for(var C=0,_=0;_<b;_++){if(!i(y))return C;qe.add(x,y.tokenStart,y.tokenEnd),C++}return C}function p(y,b,x){return x===void 0&&(x=1e5),ie(this,void 0,void 0,function(){var C,_;return ae(this,function(w){switch(w.label){case 0:return C=e(y),_=qe.create(C.data,Math.max(y.length/80,2)),[4,Fu(b,x,C,function(T,A){return m(A,T,_),A.position<A.length?T:0},function(T,A){return T.update({message:"Parsing...",current:A.position,max:length})})];case 1:return w.sent(),[2,_]}})})}e.readAllLinesAsync=p;function v(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=v;function h(y){for(var b=-1;y.position<y.length;){var x=y.data.charCodeAt(y.position);switch(x){case 9:case 32:b=x,++y.position;break;case 10:b!==13&&++y.lineNumber,b=x,++y.position;break;case 13:b=x,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=h;function g(y,b,x){for(var C=y.data,_=b,w=x-1,T=C.charCodeAt(_);(T===9||T===32)&&_<=w;)T=C.charCodeAt(++_);for(T=C.charCodeAt(w);(T===9||T===32)&&w>=_;)T=C.charCodeAt(--w);return y.tokenStart=_,y.tokenEnd=w+1,y.position=x,y}e.trim=g})(et||(et={}));function pY(e,t,r){for(var n=t,a=r-1,i=e.charCodeAt(n);(i===9||i===32)&&n<=a;)i=e.charCodeAt(++n);for(i=e.charCodeAt(a);(i===9||i===32)&&a>=n;)i=e.charCodeAt(--a);return e.substring(n,a+1)}var qe;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var c=o;c.offset>c.indicesLenMinus2&&t(c),c.indices[c.offset++]=s,c.indices[c.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function a(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=a;function i(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=i})(qe||(qe={}));function DR(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function vY(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function hY(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&MR(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function gY(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function yY(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function bY(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function xY(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function MR(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function SY(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function CY(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function _Y(e){if(e.tokenEnd-e.tokenStart!=5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function wY(e){return!(e.tokenEnd-e.tokenStart!=11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function AY(e,t,r){var n,a=r-t,i=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<a)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return a===o||e.data.charCodeAt(n+i)===46}function RR(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function BR(e,t){return e.data.substring(e.tokenStart,t)}function TY(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function K3(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function FR(e){var t=xY(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:bY(e),e.tokenType=5;break;case 39:if(MR(e)){hY(e),e.tokenType=3;break}case 34:vY(e,r),e.tokenType=3;break;case 59:t===10||t===13?gY(e):DR(e),e.tokenType=3;break;default:e.isImportGet?yY(e):DR(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&wY(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?SY(e)?e.tokenType=0:CY(e)?e.tokenType=1:_Y(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function pl(e){for(FR(e);e.tokenType===5;)FR(e)}function PY(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function Hy(){return{categoryNames:[],categoryData:Object.create(null)}}function Q3(e,t){for(var r=Object.create(null),n=0,a=e;n<a.length;n++){var i=a[n],o=t[i];r[i]=Fa(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function OR(e,t,r){return Y3(e.categoryNames,Q3(e.categoryNames,e.categoryData),t,r)}function EY(e,t){return Y3(e.categoryNames,Q3(e.categoryNames,e.categoryData),t)}function Z3(e,t,r,n,a){var i;if(t in e.categoryData){var o=e.categoryData[t];(i=o.fieldNames).push.apply(i,n),Object.assign(o.fields,a)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:a},e.categoryNames.push(t)}function IY(e,t){for(var r=e.tokenStart,n=RR(e),a=BR(e,n),i=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!AY(e,r,n)){s=!1;break}var u=K3(e).substring(a.length+1);if(pl(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[u]=at.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,pl(e)}return Z3(t,a.substr(1),1,o,i),{hasError:!1,errorLine:0,errorMessage:""}}function DY(e,t){for(var r=t.tokenizer,n=t.tokens,a=t.fieldCount,i=t.tokenCount,o=0;r.tokenType===3&&o<e;)qe.add(n[i++%a],r.tokenStart,r.tokenEnd),pl(r),o++;return t.tokenCount=i,o}function MY(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function RY(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,c,d,d,c;return ae(this,function(m){switch(m.label){case 0:for(r=e.lineNumber,pl(e),n=BR(e,RR(e)),a=TY(e),i=[];e.tokenType===4;)i[i.length]=a?K3(e):K3(e).substring(n.length+1),pl(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=i.length,c=0;c<u;c++)s[c]=qe.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,Fu(e.runtimeCtx,1e6,l,DY,MY)];case 1:if(m.sent(),l.tokenCount%u!=0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line ".concat(r," is not a multiple of the number of columns.")}];if(f=l.tokenCount/u|0,a)for(c=0;c<u;c++)d={"":at.ofTokens(s[c])},Z3(t,i[c].substr(1),f,[""],d);else{for(d=Object.create(null),c=0;c<u;c++)d[i[c]]=at.ofTokens(s[c]);Z3(t,n.substr(1),f,i,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function Gm(e,t){return $r.error(t,e)}function BY(e){return $r.success(e)}function FY(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,f;return ae(this,function(d){switch(d.label){case 0:r=[],n=PY(e,t),a="",i=Hy(),o=[],s=Hy(),u=fY(s.categoryNames,Q3(s.categoryNames,s.categoryData),""),c="",t.update({message:"Parsing...",current:0,max:e.length}),pl(n),d.label=1;case 1:return n.tokenType===6?[3,7]:(l=n.tokenType,l!==0?[3,2]:n.inSaveFrame?[2,Gm(n.lineNumber,"Unexpected data block inside a save frame.")]:(i.categoryNames.length>0&&r.push(OR(i,a,o)),a=e.substring(n.tokenStart+5,n.tokenEnd),i=Hy(),o=[],pl(n),[3,6]));case 2:if(l!==1)return[3,3];if(n.tokenEnd-n.tokenStart==5)s.categoryNames.length>0&&(o[o.length]=EY(s,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,Gm(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,c=e.substring(n.tokenStart+5,n.tokenEnd),s=Hy()}return pl(n),[3,6];case 3:return l!==2?[3,5]:[4,RY(n,n.inSaveFrame?s:i)];case 4:return f=d.sent(),f.hasError?[2,Gm(f.errorLine,f.errorMessage)]:[3,6];case 5:if(l===4){if(f=IY(n,n.inSaveFrame?s:i),f.hasError)return[2,Gm(f.errorLine,f.errorMessage)]}else return console.log(n.tokenType,et.getTokenString(n)),[2,Gm(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];d.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,Gm(n.lineNumber,"Unfinished save frame (".concat(u.header,")."))]:((i.categoryNames.length>0||o.length>0)&&r.push(OR(i,a,o)),[2,BY(IR(r))])}})})}function kR(e){var t=this;return Be.create("Parse CIF",function(r){return ie(t,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,FY(e,r)];case 1:return[2,n.sent()]}})})})}var OY=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function kY(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),a=0,i=e.length;a<i;a+=t)for(var o=0;o<t;o++)n[a+t-o-1]=e[a+o];return r}var $3=28672;function LY(e){if(e.length>$3){for(var t=[],r=0;r<e.length;r+=$3)t.push(String.fromCharCode.apply(null,e.subarray(r,r+$3)));return t.join("")}else return String.fromCharCode.apply(null,e)}function qy(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=NY(t,e.encoding[r]);return t}function NY(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return UY(e);case 2:return zY(e);case 5:return VY(e);case 3:return GY(e);case 6:return HY(e);case 32:return qY(e);case 33:return jY(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return WY(e,t);case"IntervalQuantization":return XY(e,t);case"RunLength":return YY(e,t);case"Delta":return KY(e,t);case"IntegerPacking":return $Y(e,t);case"StringArray":return JY(e,t)}}function LR(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function NR(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function UY(e){return new Int8Array(e.buffer,e.byteOffset)}function Hm(e,t,r){return OY?new r(e.buffer):new r(kY(e,t))}function zY(e){return Hm(e,2,Int16Array)}function VY(e){return Hm(e,2,Uint16Array)}function GY(e){return Hm(e,4,Int32Array)}function HY(e){return Hm(e,4,Uint32Array)}function qY(e){return Hm(e,4,Float32Array)}function jY(e){return Hm(e,8,Float64Array)}function WY(e,t){for(var r=e.length,n=NR(t.srcType,r),a=1/t.factor,i=0;i<r;i++)n[i]=a*e[i];return n}function XY(e,t){for(var r=e.length,n=NR(t.srcType,r),a=(t.max-t.min)/(t.numSteps-1),i=t.min,o=0;o<r;o++)n[o]=i+a*e[o];return n}function YY(e,t){for(var r=LR(t.srcType,t.srcSize),n=0,a=0,i=e.length;a<i;a+=2)for(var o=e[a],s=e[a+1],u=0;u<s;++u)r[n++]=o;return r}function KY(e,t){var r=e.length,n=LR(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var a=1;a<r;++a)n[a]=e[a]+n[a-1];return n}function QY(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,a=e.length,i=new Int32Array(t.srcSize),o=0,s=0;o<a;){for(var u=0,c=e[o];c===r||c===n;)u+=c,o++,c=e[o];u+=c,i[s]=u,o++,s++}return i}function ZY(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,a=new Int32Array(t.srcSize),i=0,o=0;i<n;){for(var s=0,u=e[i];u===r;)s+=u,i++,u=e[i];s+=u,a[o]=s,i++,o++}return a}function $Y(e,t){return e.length===t.srcSize?e:t.isUnsigned?ZY(e,t):QY(e,t)}function JY(e,t){var r=qy({encoding:t.offsetEncoding,data:t.offsets}),n=qy({encoding:t.dataEncoding,data:e}),a=t.stringData,i=new Array(r.length);i[0]="";for(var o=1,s=r.length;o<s;o++)i[o]=a.substring(r[o-1],r[o]);for(var u=0,c=new Array(n.length),o=0,s=n.length;o<s;o++)c[u++]=i[n[o]+1];return c}var eK="0.3.0",vl;(function(e){function t(n){var a;return n instanceof Int8Array?a=1:n instanceof Int16Array?a=2:n instanceof Int32Array?a=3:n instanceof Uint8Array?a=4:n instanceof Uint16Array?a=5:n instanceof Uint32Array?a=6:n instanceof Float32Array?a=32:n instanceof Float64Array?a=33:a=3,a}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var a=0,i=n.length;a<i;a++)if(a<0)return!1;return!0}e.isSignedIntegerDataType=r})(vl||(vl={}));function tK(e,t,r){var n=1,a;for(a=0;a<t;a++){var i=n*e;if(Math.abs(Math.round(i)-i)<=r)return a;n*=10}return-1}function rK(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function nK(e,t,r){for(var n=1,a=0,i=0,o=e.length;i<o;i++){if(n>=0){var s=tK(e[i],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[i]);if(u>r){var c=Math.floor(Math.log10(Math.abs(u)))+1;c>a&&(a=c)}}return{mantissaDigits:n,integerDigits:a}}function aK(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function UR(e,t){return parseFloat(e.toPrecision(t))}function J3(e){return gh.classify(e)}function iK(e){return e_.classify(e)}var gh;(function(e){function t(m,p){return m>=0?Math.ceil((m+1)/p):Math.ceil((m+1)/(-p-1))}function r(m){for(var p=!1,v=0,h=m.length;v<h;v++)if(m[v]<0){p=!0;break}return p?{signed:p,limit8:127,limit16:32767}:{signed:p,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function a(m,p,v){var h=m.limit8,g=m.limit16;p.pack8+=t(v,h),p.pack16+=t(v,g),p.count+=1}function i(m,p){m.pack8+=t(p,127),m.pack16+=t(p,32767),m.count+=1}function o(m){return m.count*4<m.pack16*2?{length:m.count*4,elem:4}:m.pack16*2<m.pack8?{length:m.pack16*2,elem:2}:{length:m.pack8,elem:1}}function s(m,p){for(var v=n(),h=0,g=m.length;h<g;h++)a(p,v,m[h]);return I(I({},o(v)),{kind:"pack"})}function u(m,p){for(var v=n(),h=m[0],g=1,y=m.length;g<y;g++)i(v,m[g]-h),h=m[g];return I(I({},o(v)),{kind:"delta"})}function c(m,p){for(var v=n(),h=1,g=1,y=m.length;g<y;g++)m[g-1]!==m[g]?(a(p,v,m[g-1]),a(p,v,h),h=1):h++;return a(p,v,m[m.length-1]),a(p,v,h),I(I({},o(v)),{kind:"rle"})}function l(m,p){for(var v=n(),h=1,g=0,y=0,b=1,x=m.length;b<x;b++){var C=m[b]-g;y!==C?(i(v,y),i(v,h),h=1):h++,y=C,g=m[b]}return i(v,y),i(v,h),I(I({},o(v)),{kind:"delta-rle"})}function f(m){var p=r(m),v=[s(m,p),c(m,p),u(m),l(m)];return v.sort(function(h,g){return h.length-g.length}),v}e.getSize=f;function d(m){if(m.length<2)return $t.by($t.byteArray);var p=f(m),v=p[0];switch(v.kind){case"pack":return $t.by($t.integerPacking);case"rle":return $t.by($t.runLength).and($t.integerPacking);case"delta":return $t.by($t.delta).and($t.integerPacking);case"delta-rle":return $t.by($t.delta).and($t.runLength).and($t.integerPacking)}throw new Error("should not happen :)")}e.classify=d})(gh||(gh={}));var e_;(function(e){var t=1e-6;function r(a){var i=4,o=nK(a,i,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return $t.by($t.byteArray);if(s===0)return gh.classify(a);for(var c=n(s),l=new Int32Array(a.length),f=0,d=a.length;f<d;f++)l[f]=Math.round(c*a[f]);var m=gh.getSize(l),p=m[0],v=$t.by($t.fixedPoint(c));switch(p.kind){case"pack":return v.and($t.integerPacking);case"rle":return v.and($t.runLength).and($t.integerPacking);case"delta":return v.and($t.delta).and($t.integerPacking);case"delta-rle":return v.and($t.delta).and($t.runLength).and($t.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(a){for(var i=1,o=0;o<a;o++)i*=10;return i}})(e_||(e_={}));var zR=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,a=this.providers;n<a.length;n++){var i=a[n],o=i(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var c=u[s];r.push(c)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),hl;(function(e){function t(a){return new zR([a])}e.by=t;function r(a){for(var i=t(n(a[0])),o=1;o<a.length;o++)i=i.and(n(a[o]));return i}e.fromEncoding=r;function n(a){switch(a.kind){case"ByteArray":return $t.byteArray;case"FixedPoint":return $t.fixedPoint(a.factor);case"IntervalQuantization":return $t.intervalQuantizaiton(a.min,a.max,a.numSteps);case"RunLength":return $t.runLength;case"Delta":return $t.delta;case"IntegerPacking":return $t.integerPacking;case"StringArray":return $t.stringArray}}})(hl||(hl={}));var $t;(function(e){var t,r;function n(C){return new zR([C])}e.by=n;function a(C){return{encodings:[{kind:"ByteArray",type:4}],data:C}}function i(C){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(C.buffer,C.byteOffset)}}var o=(t={},t[2]=function(C,_,w){C.setInt16(2*_,w,!0)},t[5]=function(C,_,w){C.setUint16(2*_,w,!0)},t[3]=function(C,_,w){C.setInt32(4*_,w,!0)},t[6]=function(C,_,w){C.setUint32(4*_,w,!0)},t[32]=function(C,_,w){C.setFloat32(4*_,w,!0)},t[33]=function(C,_,w){C.setFloat64(8*_,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(C){var _=vl.getDataType(C);if(_===1)return i(C);if(_===4)return a(C);for(var w=new Uint8Array(C.length*s[_]),T=o[_],A=new DataView(w.buffer),D=0,E=C.length;D<E;D++)T(A,D,C[D]);return{encodings:[{kind:"ByteArray",type:_}],data:w}}e.byteArray=u;function c(C,_){for(var w=vl.getDataType(C),T=new Int32Array(C.length),A=0,D=C.length;A<D;A++)T[A]=Math.round(C[A]*_);return{encodings:[{kind:"FixedPoint",factor:_,srcType:w}],data:T}}function l(C){return function(_){return c(_,C)}}e.fixedPoint=l;function f(C,_,w,T,A){var D=vl.getDataType(C);if(!C.length)return{encodings:[{kind:"IntervalQuantization",min:_,max:w,numSteps:T,srcType:D}],data:new Int32Array(0)};if(w<_){var E=_;_=w,w=E}for(var M=(w-_)/(T-1),F=new A(C.length),O=0,U=C.length;O<U;O++){var N=C[O];N<=_?F[O]=0:N>=w?F[O]=T-1:F[O]=Math.round((N-_)/M)|0}return{encodings:[{kind:"IntervalQuantization",min:_,max:w,numSteps:T,srcType:D}],data:F}}function d(C,_,w,T){return T===void 0&&(T=Int32Array),function(A){return f(A,C,_,w,T)}}e.intervalQuantizaiton=d;function m(C){var _=vl.getDataType(C);if(_===void 0&&(C=new Int32Array(C),_=3),!C.length)return{encodings:[{kind:"RunLength",srcType:_,srcSize:0}],data:new Int32Array(0)};for(var w=2,T=1,A=C.length;T<A;T++)C[T-1]!==C[T]&&(w+=2);for(var D=new Int32Array(w),E=0,M=1,T=1,A=C.length;T<A;T++)C[T-1]!==C[T]?(D[E]=C[T-1],D[E+1]=M,M=1,E+=2):++M;return D[E]=C[C.length-1],D[E+1]=M,{encodings:[{kind:"RunLength",srcType:_,srcSize:C.length}],data:D}}e.runLength=m;function p(C){if(!vl.isSignedIntegerDataType(C))throw new Error("Only signed integer types can be encoded using delta encoding.");var _=vl.getDataType(C);if(_===void 0&&(C=new Int32Array(C),_=3),!C.length)return{encodings:[{kind:"Delta",origin:0,srcType:_}],data:new C.constructor(0)};var w=new C.constructor(C.length),T=C[0];w[0]=C[0];for(var A=1,D=C.length;A<D;A++)w[A]=C[A]-C[A-1];return w[0]=0,{encodings:[{kind:"Delta",origin:T,srcType:_}],data:w}}e.delta=p;function v(C){for(var _=0,w=C.length;_<w;_++)if(C[_]<0)return!0;return!1}function h(C,_){for(var w=-_-1,T=0,A=0,D=C.length;A<D;A++){var E=C[A];E===0?T+=1:E>0?(T+=Math.ceil(E/_),E%_==0&&(T+=1)):(T+=Math.ceil(E/w),E%w==0&&(T+=1))}return T}function g(C){var _=v(C),w=_?h(C,127):h(C,255),T=_?h(C,32767):h(C,65535);return C.length*4<T*2?{isSigned:_,size:C.length,bytesPerElement:4}:T*2<w?{isSigned:_,size:T,bytesPerElement:2}:{isSigned:_,size:w,bytesPerElement:1}}function y(C,_){for(var w=_.isSigned?_.bytesPerElement===1?127:32767:_.bytesPerElement===1?255:65535,T=-w-1,A=C.length,D=_.isSigned?_.bytesPerElement===1?new Int8Array(_.size):new Int16Array(_.size):_.bytesPerElement===1?new Uint8Array(_.size):new Uint16Array(_.size),E=0,M=0;M<A;M++){var F=C[M];if(F>=0)for(;F>=w;)D[E]=w,++E,F-=w;else for(;F<=T;)D[E]=T,++E,F-=T;D[E]=F,++E}var O=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:_.bytesPerElement,isUnsigned:!_.isSigned,srcSize:A},O.encodings[0]],data:O.data}}function b(C){var _=g(C);return _.bytesPerElement===4?u(C):y(C,_)}e.integerPacking=b;function x(C){var _=Object.create(null),w=[],T=new Int32Array(C.length),A=Me.create(Int32Array,1,Math.min(1024,C.length<32?C.length+1:Math.round(C.length/8)+1));Me.add(A,0);for(var D=0,E=0,M=0,F=C;M<F.length;M++){var O=F[M];if(O==null){T[E++]=-1;continue}var U=_[O];U===void 0&&(D+=O.length,U=w.length,w[U]=O,_[O]=U,Me.add(A,D)),T[E++]=U}var N=Me.compact(A),q=J3(N),j=q.encode(N),Q=J3(T),J=Q.encode(T);return{encodings:[{kind:"StringArray",dataEncoding:J.encoding,stringData:w.join(""),offsetEncoding:j.encoding,offsets:j.data}],data:J.data}}e.stringArray=x})($t||($t={}));function oK(e){var t=e.mask?qy(e.mask):void 0,r=qy(e.data),n=e3(r),a=n?t?function(c){return t[c]===0?""+r[c]:""}:function(c){return""+r[c]}:t?function(c){return t[c]===0?r[c]:""}:function(c){return r[c]},i=n?function(c){return r[c]}:function(c){var l=r[c];return sl(l,0,l.length)},o=n?function(c){return r[c]}:function(c){var l=r[c];return Ru(l,0,l.length)},s=t?function(c){return t[c]}:function(c){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:a,int:i,float:o,valueKind:s,areValuesEqual:function(c,l){return r[c]===r[l]},toStringArray:function(c){return ga(u,a,c)},toIntArray:n?function(c){return xy(r,c)}:function(c){return ga(u,i,c)},toFloatArray:n?function(c){return xy(r,c)}:function(c){return ga(u,o,c)}}}function VR(e){return Wy({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function t_(e,t){for(var r={},n=0;n<t;n++){var a=Wy(e);r[a]=Wy(e)}return r}function r_(e,t){for(var r=new Uint8Array(t),n=e.offset,a=0;a<t;a++)r[a]=e.buffer[a+n];return e.offset+=t,r}function jy(e,t){var r=v3(e.buffer,e.offset,t);return e.offset+=t,r}function n_(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=Wy(e);return r}function Wy(e){var t=e.buffer[e.offset],r,n;if((t&128)==0)return e.offset++,t;if((t&240)==128)return n=t&15,e.offset++,t_(e,n);if((t&240)==144)return n=t&15,e.offset++,n_(e,n);if((t&224)==160)return n=t&31,e.offset++,jy(e,n);if((t&224)==224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,r_(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,r_(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,r_(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,jy(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,jy(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,jy(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n_(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n_(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,t_(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,t_(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function sK(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function uK(e){for(var t=Object.create(null),r=Object.create(null),n=0,a=e.columns;n<a.length;n++){var i=a[n];t[i.name]=i}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(!!s)return r[o]||(r[o]=oK(s)),r[o]}}}function GR(e){var t=this;return Be.create("Parse BinaryCIF",function(r){return ie(t,void 0,void 0,function(){var n,a,i;return ae(this,function(o){n=[0,3];try{return a=VR(e),sK(n,a.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(i=IR(a.dataBlocks.map(function(s){for(var u=Object.create(null),c=0,l=s.categories;c<l.length;c++){var f=l[c];u[f.name.substr(1)]=uK(f)}return Y3(s.categories.map(function(d){return d.name.substr(1)}),u,s.header)})),[2,$r.success(i)]):[2,$r.error("Unsupported format version. Current ".concat(a.version,", required ").concat(n.join("."),"."))]}catch(s){return[2,$r.error(""+s)]}return[2]})})})}var qm;(function(e){function t(a){return a.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(a,i){return t(a)===t(i)}e.equal=r;function n(a,i,o){o===void 0&&(o=!1);var s="".concat(a).concat(i?".".concat(i):"");return o?t(s):s}e.create=n})(qm||(qm={}));function cK(e,t,r){for(var n={},a=0,i=t.blocks;a<i.length;a++){var o=i[a];n[o.header]=Nu(e,o,r)}return n}function Nu(e,t,r){return pK(e,t,r)}function lK(e,t){return new HR(t,e,!0)}function fK(e){switch(e.valueType){case"str":return function(t,r,n){return a_(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return a_(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return a_(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function a_(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function dK(e,t,r){var n=e.separator,a=e.itemParse,i=t.getField(r),o=i?function(u){return i.str(u).split(n).map(function(c){return a(c.trim())}).filter(function(c){return!!c})}:function(u){return[]},s=function(u){return ga(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:o,valueKind:i?i.valueKind:function(){return 1},areValuesEqual:function(u,c){return li(o(u),o(c))},toArray:s}}function mK(e,t,r){var n=e.space,a=t.fieldNames.includes("".concat(r,"[0]"))||t.fieldNames.includes("".concat(r,"[0][0]"))||t.fieldNames.includes("".concat(r,"[0][0][0]")),i=a?0:1,o=t.fieldNames.includes("".concat(r,"_1"))||t.fieldNames.includes("".concat(r,"_11"))||t.fieldNames.includes("".concat(r,"_111"))?"underscore":"brackets",s=dY(r,n.rank,a,o),u=t.getField(s(i,i,i))||ce.Undefined(t.rowCount,e),c=function(f){return mY(t,n,f,s)},l=function(f){return ga(t.rowCount,c,f)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:c,valueKind:u.valueKind,areValuesEqual:function(f,d){return sr.areEqualExact(c(f),c(d))},toArray:l}}var HR=function(){function e(t,r,n){this._isDefined=n;var a=Object.keys(r);this._rowCount=t.rowCount,this._columns=a,this._schema=r;for(var i=Object.create(null),o=function(f){Object.defineProperty(s,f,{get:function(){if(i[f])return i[f];var d=r[f];if(d.valueType==="list")i[f]=dK(d,t,f);else if(d.valueType==="tensor")i[f]=mK(d,t,f);else{var m=fK(d),p=t.getField(f);i[f]=p?m(p,t,f):ce.Undefined(t.rowCount,d)}return i[f]},enumerable:!0,configurable:!1})},s=this,u=0,c=a;u<c.length;u++){var l=c[u];o(l)}}return e}();function pK(e,t,r){for(var n=Object.create(null),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=gK(o,e[o],t,r)}return t3.ofTables(t.header,e,n)}function vK(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var a=n[r],i=0,o=e.categories[a].fieldNames;i<o.length;i++){var s=o[i],u=qm.create(a,s,!0);t[u]=e.categories[a].getField(s)}return t}function hK(e,t,r,n){var a=qm.create(t,e),i=qm.canonical(a);if(i in r)return r[i];if(n&&a in n)for(var o=0,s=n[a];o<s.length;o++){var u=s[o],c=qm.canonical(u);if(c in r)return r[c]}}function gK(e,t,r,n){var a=r.categories[e];if(n){for(var i=vK(r),o=Object.create(null),s=[],u=0,c=0,l=Object.keys(t);c<l.length;c++){var f=l[c],d=hK(f,e,i,n);d&&(o[f]=d,s.push(f),u=d.rowCount)}a={rowCount:u,name:e,fieldNames:Ht([],s,!0),getField:function(m){return o[m]}}}return new HR(a||Fa.empty(e),t,!!a)}var gl=ce.Schema,$=gl.str,xe=gl.int,Gt=gl.float,i_=gl.coord,dt=gl.Aliased,yl=gl.Matrix,Xy=gl.Vector,Uf=gl.List,Jt={atom_site:{auth_asym_id:$,auth_atom_id:$,auth_comp_id:$,auth_seq_id:xe,B_iso_or_equiv:Gt,Cartn_x:i_,Cartn_y:i_,Cartn_z:i_,group_PDB:dt($),id:xe,label_alt_id:$,label_asym_id:$,label_atom_id:$,label_comp_id:$,label_entity_id:$,label_seq_id:xe,occupancy:Gt,type_symbol:$,pdbx_PDB_ins_code:$,pdbx_PDB_model_num:xe,pdbx_formal_charge:xe,ihm_model_id:xe},atom_site_anisotrop:{id:xe,type_symbol:$,U:yl(3,3),U_esd:yl(3,3),pdbx_auth_seq_id:$,pdbx_auth_asym_id:$,pdbx_auth_atom_id:$,pdbx_auth_comp_id:$,pdbx_label_seq_id:xe,pdbx_label_alt_id:$,pdbx_label_asym_id:$,pdbx_label_atom_id:$,pdbx_label_comp_id:$,pdbx_PDB_ins_code:$},atom_sites:{entry_id:$,fract_transf_matrix:yl(3,3),fract_transf_vector:Xy(3)},audit_author:{name:$,pdbx_ordinal:xe,identifier_ORCID:$},audit_conform:{dict_location:$,dict_name:$,dict_version:$},cell:{angle_alpha:Gt,angle_beta:Gt,angle_gamma:Gt,entry_id:$,length_a:Gt,length_b:Gt,length_c:Gt,Z_PDB:xe,pdbx_unique_axis:$},chem_comp:{formula:$,formula_weight:Gt,id:$,mon_nstd_flag:dt($),name:$,type:dt($),pdbx_synonyms:Uf(";",function(e){return e})},chem_comp_bond:{atom_id_1:$,atom_id_2:$,comp_id:$,value_order:dt($),pdbx_ordinal:xe,pdbx_stereo_config:dt($),pdbx_aromatic_flag:dt($)},citation:{book_publisher:$,country:$,id:$,journal_abbrev:$,journal_id_ASTM:$,journal_id_CSD:$,journal_id_ISSN:$,journal_volume:$,page_first:$,page_last:$,title:$,year:xe,pdbx_database_id_DOI:$,pdbx_database_id_PubMed:xe},citation_author:{citation_id:$,name:$,ordinal:xe},database_2:{database_id:dt($),database_code:$},entity:{details:$,formula_weight:Gt,id:$,src_method:dt($),type:dt($),pdbx_description:Uf(",",function(e){return e}),pdbx_number_of_molecules:xe,pdbx_mutation:$,pdbx_fragment:$,pdbx_ec:Uf(",",function(e){return e})},entity_poly:{entity_id:$,nstd_linkage:dt($),nstd_monomer:dt($),type:dt($),pdbx_strand_id:Uf(",",function(e){return e}),pdbx_seq_one_letter_code:$,pdbx_seq_one_letter_code_can:$,pdbx_target_identifier:$},entity_poly_seq:{entity_id:$,hetero:dt($),mon_id:$,num:xe},entry:{id:$},exptl:{entry_id:$,method:dt($)},software:{classification:$,date:$,description:$,name:$,type:dt($),version:$,pdbx_ordinal:xe},struct:{entry_id:$,title:$,pdbx_descriptor:$},struct_asym:{details:$,entity_id:$,id:$,pdbx_modified:$,pdbx_blank_PDB_chainid_flag:dt($)},struct_conf:{beg_label_asym_id:$,beg_label_comp_id:$,beg_label_seq_id:xe,beg_auth_asym_id:$,beg_auth_comp_id:$,beg_auth_seq_id:xe,conf_type_id:dt($),details:$,end_label_asym_id:$,end_label_comp_id:$,end_label_seq_id:xe,end_auth_asym_id:$,end_auth_comp_id:$,end_auth_seq_id:xe,id:$,pdbx_beg_PDB_ins_code:$,pdbx_end_PDB_ins_code:$,pdbx_PDB_helix_class:$,pdbx_PDB_helix_length:xe,pdbx_PDB_helix_id:$},struct_conn:{conn_type_id:dt($),details:$,id:$,ptnr1_label_asym_id:$,ptnr1_label_atom_id:$,ptnr1_label_comp_id:$,ptnr1_label_seq_id:xe,ptnr1_auth_asym_id:$,ptnr1_auth_comp_id:$,ptnr1_auth_seq_id:xe,ptnr1_symmetry:$,ptnr2_label_asym_id:$,ptnr2_label_atom_id:$,ptnr2_label_comp_id:$,ptnr2_label_seq_id:xe,ptnr2_auth_asym_id:$,ptnr2_auth_comp_id:$,ptnr2_auth_seq_id:xe,ptnr2_symmetry:$,pdbx_ptnr1_PDB_ins_code:$,pdbx_ptnr1_label_alt_id:$,pdbx_ptnr1_standard_comp_id:$,pdbx_ptnr2_PDB_ins_code:$,pdbx_ptnr2_label_alt_id:$,pdbx_ptnr3_PDB_ins_code:$,pdbx_ptnr3_label_alt_id:$,pdbx_ptnr3_label_asym_id:$,pdbx_ptnr3_label_atom_id:$,pdbx_ptnr3_label_comp_id:$,pdbx_ptnr3_label_seq_id:xe,pdbx_PDB_id:$,pdbx_dist_value:Gt,pdbx_value_order:dt($)},struct_conn_type:{criteria:$,id:dt($),reference:$},struct_keywords:{entry_id:$,text:Uf(",",function(e){return e}),pdbx_keywords:$},struct_ncs_oper:{code:dt($),details:$,id:xe,matrix:yl(3,3),vector:Xy(3)},struct_sheet_range:{beg_label_asym_id:$,beg_label_comp_id:$,beg_label_seq_id:xe,end_label_asym_id:$,end_label_comp_id:$,end_label_seq_id:xe,beg_auth_asym_id:$,beg_auth_comp_id:$,beg_auth_seq_id:xe,end_auth_asym_id:$,end_auth_comp_id:$,end_auth_seq_id:xe,id:$,sheet_id:$,pdbx_beg_PDB_ins_code:$,pdbx_end_PDB_ins_code:$},struct_site:{details:$,id:$,pdbx_num_residues:xe,pdbx_evidence_code:$,pdbx_auth_asym_id:$,pdbx_auth_comp_id:$,pdbx_auth_seq_id:$,pdbx_auth_ins_code:$},struct_site_gen:{details:$,id:$,label_alt_id:$,label_asym_id:$,label_atom_id:$,label_comp_id:$,label_seq_id:xe,auth_asym_id:$,auth_comp_id:$,auth_seq_id:$,site_id:$,symmetry:$,pdbx_auth_ins_code:$,pdbx_num_res:xe},symmetry:{entry_id:$,cell_setting:dt($),Int_Tables_number:xe,space_group_name_Hall:$,"space_group_name_H-M":$},pdbx_database_status:{status_code:dt($),status_code_sf:dt($),status_code_mr:dt($),entry_id:$,recvd_initial_deposition_date:$,SG_entry:dt($),deposit_site:dt($),process_site:dt($),status_code_cs:dt($),methods_development_category:dt($),pdb_format_compatible:dt($)},pdbx_nonpoly_scheme:{asym_id:$,entity_id:$,mon_id:$,pdb_strand_id:$,ndb_seq_num:$,pdb_seq_num:$,auth_seq_num:$,pdb_mon_id:$,auth_mon_id:$,pdb_ins_code:$},pdbx_database_related:{db_name:$,details:$,db_id:$,content_type:dt($)},pdbx_entity_nonpoly:{entity_id:$,comp_id:$,name:$},pdbx_chem_comp_synonyms:{name:$,comp_id:$,provenance:dt($)},pdbx_chem_comp_identifier:{comp_id:$,identifier:$,type:dt($),program:$,program_version:$},pdbx_unobs_or_zero_occ_residues:{id:xe,polymer_flag:dt($),occupancy_flag:dt(xe),PDB_model_num:xe,auth_asym_id:$,auth_comp_id:$,auth_seq_id:$,PDB_ins_code:$,label_asym_id:$,label_comp_id:$,label_seq_id:xe},pdbx_struct_mod_residue:{id:xe,auth_asym_id:$,auth_comp_id:$,auth_seq_id:xe,PDB_ins_code:$,label_asym_id:$,label_comp_id:$,label_seq_id:xe,parent_comp_id:$,details:$},pdbx_struct_oper_list:{id:$,type:dt($),name:$,symmetry_operation:$,matrix:yl(3,3),vector:Xy(3)},pdbx_struct_assembly:{method_details:$,oligomeric_details:$,oligomeric_count:xe,details:$,id:$},pdbx_struct_assembly_gen:{asym_id_list:Uf(",",function(e){return e}),assembly_id:$,oper_expression:$},pdbx_reference_entity_list:{prd_id:$,ref_entity_id:$,type:dt($),details:$,component_id:xe},pdbx_reference_entity_link:{link_id:xe,prd_id:$,details:$,ref_entity_id_1:$,ref_entity_id_2:$,entity_seq_num_1:xe,entity_seq_num_2:xe,comp_id_1:$,comp_id_2:$,atom_id_1:$,atom_id_2:$,value_order:dt($),component_1:xe,component_2:xe,link_class:dt($)},pdbx_reference_entity_poly_link:{link_id:xe,prd_id:$,ref_entity_id:$,component_id:xe,entity_seq_num_1:xe,entity_seq_num_2:xe,comp_id_1:$,comp_id_2:$,atom_id_1:$,atom_id_2:$,value_order:dt($)},pdbx_molecule:{prd_id:$,instance_id:xe,asym_id:$},pdbx_molecule_features:{prd_id:$,class:dt($),type:dt($),name:$,details:$},entity_src_nat:{entity_id:$,pdbx_organism_scientific:$,pdbx_plasmid_name:$,pdbx_src_id:xe,pdbx_beg_seq_num:xe,pdbx_end_seq_num:xe},entity_src_gen:{entity_id:$,pdbx_gene_src_gene:Uf(",",function(e){return e}),pdbx_gene_src_scientific_name:$,plasmid_name:$,pdbx_src_id:xe,pdbx_beg_seq_num:xe,pdbx_end_seq_num:xe},pdbx_entity_src_syn:{organism_scientific:$,entity_id:$,pdbx_src_id:xe,pdbx_beg_seq_num:xe,pdbx_end_seq_num:xe},pdbx_entity_branch_descriptor:{entity_id:$,descriptor:$,type:dt($),program:$,program_version:$,ordinal:xe},pdbx_entity_instance_feature:{details:$,feature_type:dt($),auth_asym_id:$,asym_id:$,auth_seq_num:$,seq_num:xe,comp_id:$,auth_comp_id:$,ordinal:xe},pdbx_entity_branch_list:{entity_id:$,hetero:dt($),comp_id:$,num:xe},pdbx_entity_branch_link:{link_id:xe,details:$,entity_id:$,entity_branch_list_num_1:xe,entity_branch_list_num_2:xe,comp_id_1:$,comp_id_2:$,atom_id_1:$,leaving_atom_id_1:$,atom_stereo_config_1:dt($),atom_id_2:$,leaving_atom_id_2:$,atom_stereo_config_2:dt($),value_order:dt($)},pdbx_entity_branch:{entity_id:$,type:dt($)},pdbx_branch_scheme:{entity_id:$,hetero:dt($),asym_id:$,mon_id:$,num:xe,pdb_asym_id:$,pdb_seq_num:$,pdb_mon_id:$,auth_asym_id:$,auth_seq_num:$,auth_mon_id:$},pdbx_chem_comp_related:{comp_id:$,related_comp_id:$,relationship_type:dt($),details:$},ihm_starting_model_details:{starting_model_id:$,entity_id:$,entity_description:$,asym_id:$,entity_poly_segment_id:xe,starting_model_source:dt($),starting_model_auth_asym_id:$,starting_model_sequence_offset:xe,dataset_list_id:xe},ihm_starting_comparative_models:{id:xe,starting_model_id:$,starting_model_auth_asym_id:$,starting_model_seq_id_begin:xe,starting_model_seq_id_end:xe,template_auth_asym_id:$,template_seq_id_begin:xe,template_seq_id_end:xe,template_sequence_identity:Gt,template_sequence_identity_denominator:dt(xe),template_dataset_list_id:xe,alignment_file_id:xe},ihm_starting_model_seq_dif:{id:xe,entity_id:$,asym_id:$,seq_id:xe,comp_id:$,starting_model_id:$,db_asym_id:$,db_seq_id:xe,db_comp_id:$,details:$},ihm_model_representation:{id:xe,name:$,details:$},ihm_model_representation_details:{id:xe,representation_id:xe,entity_poly_segment_id:xe,entity_id:$,entity_description:$,entity_asym_id:$,model_object_primitive:dt($),starting_model_id:$,model_mode:dt($),model_granularity:dt($),model_object_count:xe},ihm_struct_assembly_details:{id:xe,assembly_id:xe,parent_assembly_id:xe,entity_description:$,entity_id:$,asym_id:$,entity_poly_segment_id:xe},ihm_struct_assembly:{id:xe,name:$,description:$},ihm_modeling_protocol:{id:xe,num_steps:xe,protocol_name:$},ihm_modeling_protocol_details:{id:xe,protocol_id:xe,step_id:xe,struct_assembly_id:xe,dataset_group_id:xe,struct_assembly_description:$,step_name:$,step_method:$,num_models_begin:xe,num_models_end:xe,multi_scale_flag:dt($),multi_state_flag:dt($),ordered_flag:dt($),script_file_id:xe,software_id:xe},ihm_multi_state_modeling:{state_id:xe,state_group_id:xe,population_fraction:Gt,population_fraction_sd:Gt,state_type:$,state_name:$,experiment_type:dt($),details:$},ihm_modeling_post_process:{id:xe,protocol_id:xe,analysis_id:xe,step_id:xe,type:dt($),feature:dt($),num_models_begin:xe,num_models_end:xe},ihm_ensemble_info:{ensemble_id:xe,ensemble_name:$,post_process_id:xe,model_group_id:xe,ensemble_clustering_method:dt($),ensemble_clustering_feature:dt($),num_ensemble_models:xe,num_ensemble_models_deposited:xe,ensemble_precision_value:Gt,ensemble_file_id:xe},ihm_model_list:{model_id:xe,model_name:$,assembly_id:xe,protocol_id:xe,representation_id:xe},ihm_model_group:{id:xe,name:$,details:$},ihm_model_group_link:{model_id:xe,group_id:xe},ihm_model_representative:{id:xe,model_group_id:xe,model_id:xe,selection_criteria:dt($)},ihm_dataset_list:{id:xe,data_type:dt($),database_hosted:dt($)},ihm_dataset_group:{id:xe,name:$,application:dt($),details:$},ihm_dataset_group_link:{dataset_list_id:xe,group_id:xe},ihm_related_datasets:{dataset_list_id_derived:xe,dataset_list_id_primary:xe},ihm_dataset_related_db_reference:{id:xe,dataset_list_id:xe,db_name:dt($),accession_code:$,version:$,details:$},ihm_external_reference_info:{reference_id:xe,reference_provider:$,reference_type:dt($),reference:$,refers_to:dt($),associated_url:$},ihm_external_files:{id:xe,reference_id:xe,file_path:$,content_type:dt($),file_size_bytes:Gt,details:$},ihm_dataset_external_reference:{id:xe,dataset_list_id:xe,file_id:xe},ihm_localization_density_files:{id:xe,file_id:xe,ensemble_id:xe,entity_id:$,entity_poly_segment_id:xe,asym_id:$},ihm_predicted_contact_restraint:{id:xe,group_id:xe,entity_id_1:$,entity_id_2:$,asym_id_1:$,asym_id_2:$,comp_id_1:$,comp_id_2:$,seq_id_1:xe,seq_id_2:xe,rep_atom_1:dt($),rep_atom_2:dt($),distance_lower_limit:Gt,distance_upper_limit:Gt,probability:Gt,restraint_type:dt($),model_granularity:dt($),dataset_list_id:xe,software_id:xe},ihm_cross_link_list:{id:xe,group_id:xe,entity_description_1:$,entity_description_2:$,entity_id_1:$,entity_id_2:$,comp_id_1:$,comp_id_2:$,seq_id_1:xe,seq_id_2:xe,linker_type:dt($),dataset_list_id:xe},ihm_cross_link_restraint:{id:xe,group_id:xe,entity_id_1:$,entity_id_2:$,asym_id_1:$,asym_id_2:$,comp_id_1:$,comp_id_2:$,seq_id_1:xe,seq_id_2:xe,atom_id_1:$,atom_id_2:$,restraint_type:dt($),conditional_crosslink_flag:dt($),model_granularity:dt($),distance_threshold:Gt,psi:Gt,sigma_1:Gt,sigma_2:Gt},ihm_cross_link_result_parameters:{id:xe,restraint_id:xe,model_id:xe,psi:Gt,sigma_1:Gt,sigma_2:Gt},ihm_2dem_class_average_restraint:{id:xe,dataset_list_id:xe,number_raw_micrographs:xe,pixel_size_width:Gt,pixel_size_height:Gt,image_resolution:Gt,image_segment_flag:dt($),number_of_projections:xe,struct_assembly_id:xe,details:$},ihm_2dem_class_average_fitting:{id:xe,restraint_id:xe,model_id:xe,cross_correlation_coefficient:Gt,rot_matrix:yl(3,3),tr_vector:Xy(3)},ihm_3dem_restraint:{id:xe,dataset_list_id:xe,model_id:xe,struct_assembly_id:xe,fitting_method:$,number_of_gaussians:xe,cross_correlation_coefficient:Gt},ihm_sas_restraint:{id:xe,dataset_list_id:xe,model_id:xe,struct_assembly_id:xe,profile_segment_flag:dt($),fitting_atom_type:$,fitting_method:$,fitting_state:dt($),radius_of_gyration:Gt,chi_value:Gt,details:$},ihm_starting_model_coord:{ordinal_id:xe,starting_model_id:$,group_PDB:dt($),id:xe,type_symbol:$,entity_id:$,atom_id:$,comp_id:$,seq_id:xe,asym_id:$,Cartn_x:Gt,Cartn_y:Gt,Cartn_z:Gt,B_iso_or_equiv:Gt},ihm_sphere_obj_site:{id:xe,entity_id:$,seq_id_begin:xe,seq_id_end:xe,asym_id:$,Cartn_x:Gt,Cartn_y:Gt,Cartn_z:Gt,object_radius:Gt,rmsf:Gt,model_id:xe},ihm_gaussian_obj_site:{id:xe,entity_id:$,seq_id_begin:xe,seq_id_end:xe,asym_id:$,mean_Cartn_x:Gt,mean_Cartn_y:Gt,mean_Cartn_z:Gt,weight:Gt,covariance_matrix:yl(3,3),model_id:xe},ihm_gaussian_obj_ensemble:{id:xe,entity_id:$,seq_id_begin:xe,seq_id_end:xe,asym_id:$,mean_Cartn_x:Gt,mean_Cartn_y:Gt,mean_Cartn_z:Gt,weight:Gt,covariance_matrix:yl(3,3),ensemble_id:xe},ihm_feature_list:{feature_id:xe,feature_type:dt($),entity_type:dt($)},ihm_poly_residue_feature:{ordinal_id:xe,feature_id:xe,entity_id:$,asym_id:$,comp_id_begin:$,comp_id_end:$,seq_id_begin:xe,seq_id_end:xe},ihm_derived_distance_restraint:{id:xe,group_id:xe,feature_id_1:xe,feature_id_2:xe,group_conditionality:dt($),random_exclusion_fraction:Gt,distance_upper_limit:Gt,restraint_type:dt($),dataset_list_id:xe},ma_model_list:{ordinal_id:xe,model_id:xe,model_group_id:xe,model_name:$,model_group_name:$,model_type:dt($),data_id:xe},ma_target_entity:{entity_id:$,data_id:xe,origin:dt($)},ma_target_entity_instance:{asym_id:$,entity_id:$,details:$},ma_target_ref_db_details:{target_entity_id:$,db_name:dt($),db_code:$,db_accession:$,seq_db_isoform:$,seq_db_align_begin:$,seq_db_align_end:$,ncbi_taxonomy_id:$,organism_scientific:$},ma_data:{id:xe,content_type:dt($),content_type_other_details:$,name:$},ma_software_group:{ordinal_id:xe,group_id:xe,software_id:xe},ma_qa_metric:{id:xe,name:$,type:dt($),mode:dt($),software_group_id:xe},ma_qa_metric_global:{ordinal_id:xe,model_id:xe,metric_id:xe,metric_value:Gt},ma_qa_metric_local:{ordinal_id:xe,model_id:xe,label_asym_id:$,label_seq_id:xe,label_comp_id:$,metric_id:xe,metric_value:Gt}},jm=ce.Schema,lr=jm.str,yK=jm.float,qR=jm.List,$i=jm.Aliased,yh=jm.int,Wm=jm.coord,bK={chem_comp:{formula:lr,formula_weight:yK,id:lr,mon_nstd_parent_comp_id:qR(",",function(e){return e}),name:lr,one_letter_code:lr,three_letter_code:lr,type:$i(lr),pdbx_synonyms:qR(";",function(e){return e}),pdbx_type:lr,pdbx_ambiguous_flag:lr,pdbx_replaced_by:lr,pdbx_replaces:lr,pdbx_formal_charge:yh,pdbx_model_coordinates_details:lr,pdbx_model_coordinates_db_code:lr,pdbx_ideal_coordinates_details:lr,pdbx_ideal_coordinates_missing_flag:$i(lr),pdbx_model_coordinates_missing_flag:$i(lr),pdbx_initial_date:lr,pdbx_modified_date:lr,pdbx_release_status:$i(lr),pdbx_processing_site:$i(lr)},chem_comp_atom:{alt_atom_id:lr,atom_id:lr,charge:yh,model_Cartn_x:Wm,model_Cartn_y:Wm,model_Cartn_z:Wm,comp_id:lr,type_symbol:lr,pdbx_align:yh,pdbx_ordinal:yh,pdbx_model_Cartn_x_ideal:Wm,pdbx_model_Cartn_y_ideal:Wm,pdbx_model_Cartn_z_ideal:Wm,pdbx_stereo_config:$i(lr),pdbx_aromatic_flag:$i(lr),pdbx_leaving_atom_flag:$i(lr)},chem_comp_bond:{atom_id_1:lr,atom_id_2:lr,comp_id:lr,value_order:$i(lr),pdbx_ordinal:yh,pdbx_stereo_config:$i(lr),pdbx_aromatic_flag:$i(lr)},pdbx_chem_comp_descriptor:{comp_id:lr,descriptor:lr,type:$i(lr),program:lr,program_version:lr},pdbx_chem_comp_identifier:{comp_id:lr,identifier:lr,type:$i(lr),program:lr,program_version:lr}},Yy=ce.Schema,Mt=Yy.str,xK=Yy.float,mi=Yy.Aliased,Io=Yy.int,SK={pdbx_reference_molecule:{prd_id:Mt,formula_weight:xK,formula:Mt,type:mi(Mt),type_evidence_code:Mt,class:mi(Mt),class_evidence_code:Mt,name:Mt,represent_as:mi(Mt),chem_comp_id:Mt,compound_details:Mt,description:Mt,representative_PDB_id_code:Mt,release_status:mi(Mt),replaces:Mt,replaced_by:Mt},pdbx_reference_entity_list:{prd_id:Mt,ref_entity_id:Mt,type:mi(Mt),details:Mt,component_id:Io},pdbx_reference_entity_nonpoly:{prd_id:Mt,ref_entity_id:Mt,name:Mt,chem_comp_id:Mt},pdbx_reference_entity_link:{link_id:Io,prd_id:Mt,details:Mt,ref_entity_id_1:Mt,ref_entity_id_2:Mt,entity_seq_num_1:Io,entity_seq_num_2:Io,comp_id_1:Mt,comp_id_2:Mt,atom_id_1:Mt,atom_id_2:Mt,value_order:mi(Mt),component_1:Io,component_2:Io,link_class:mi(Mt)},pdbx_reference_entity_poly_link:{link_id:Io,prd_id:Mt,ref_entity_id:Mt,component_id:Io,entity_seq_num_1:Io,entity_seq_num_2:Io,comp_id_1:Mt,comp_id_2:Mt,atom_id_1:Mt,atom_id_2:Mt,value_order:mi(Mt)},pdbx_reference_entity_poly:{prd_id:Mt,ref_entity_id:Mt,type:mi(Mt),db_code:Mt,db_name:Mt},pdbx_reference_entity_poly_seq:{prd_id:Mt,ref_entity_id:Mt,mon_id:Mt,parent_mon_id:Mt,num:Io,observed:mi(Mt),hetero:mi(Mt)},pdbx_reference_entity_sequence:{prd_id:Mt,ref_entity_id:Mt,type:mi(Mt),NRP_flag:mi(Mt),one_letter_codes:Mt},pdbx_reference_entity_src_nat:{prd_id:Mt,ref_entity_id:Mt,ordinal:Io,organism_scientific:Mt,taxid:Mt,db_code:Mt,db_name:Mt},pdbx_prd_audit:{prd_id:Mt,date:Mt,processing_site:mi(Mt),action_type:mi(Mt)}},jR=ce.Schema,Fn=jR.str,CK=jR.float,_K={id:Fn,description:Fn},wK={title:Fn,datablock_id:Fn,version:Fn},AK={version:Fn,update:Fn,revision:Fn},TK={id:Fn,description:Fn},PK={id:Fn,parent_id:Fn,description:Fn},EK={code:Fn,primitive_code:Fn,construct:Fn,detail:Fn},IK={code:Fn,detail:Fn},DK={from_code:Fn,to_code:Fn,operator:Fn,factor:CK},MK={datablock:_K,dictionary:wK,dictionary_history:AK,sub_category:TK,category_group_list:PK,item_type_list:EK,item_units_list:IK,item_units_conversion:DK},bh=ce.Schema,Ys=bh.str,Ky=bh.int,Uu=bh.float,Qy=bh.Aliased,bl=bh.Vector;Qy(Ys),Qy(Ys),Qy(Ys),Qy(Ys),bl(3),bl(3);var RK={volume_data_3d_info:{name:Ys,axis_order:bl(3,Ky),origin:bl(3),dimensions:bl(3),sample_rate:Ky,sample_count:bl(3,Ky),spacegroup_number:Ky,spacegroup_cell_size:bl(3),spacegroup_cell_angles:bl(3),mean_source:Uu,mean_sampled:Uu,sigma_source:Uu,sigma_sampled:Uu,min_source:Uu,min_sampled:Uu,max_source:Uu,max_sampled:Uu},volume_data_3d:{values:Uu}},Zy=ce.Schema,yn=Zy.float,o_=Zy.int,Hr=Zy.str,BK=Zy.Matrix,FK={cell:{angle_alpha:yn,angle_beta:yn,angle_gamma:yn,formula_units_z:o_,length_a:yn,length_b:yn,length_c:yn,volume:yn},chemical:{melting_point:yn,name_common:Hr,name_systematic:Hr},chemical_formula:{moiety:Hr,sum:Hr,weight:yn},space_group:{crystal_system:Hr,it_number:o_,"name_h-m_full":Hr},space_group_symop:{operation_xyz:Hr},geom_bond:{atom_site_label_1:Hr,atom_site_label_2:Hr,distance:yn,publ_flag:Hr,site_symmetry_1:Hr,site_symmetry_2:Hr,valence:yn},audit:{block_doi:Hr},database_code:{cod:Hr,csd:Hr,depnum_ccdc_archive:Hr,depnum_ccdc_fiz:Hr,icsd:Hr,mdf:Hr,nbs:Hr},atom_site:{adp_type:Hr,calc_flag:Hr,disorder_assembly:Hr,disorder_group:Hr,fract_x:yn,fract_y:yn,fract_z:yn,label:Hr,occupancy:yn,refinement_flags:Hr,site_symmetry_multiplicity:o_,type_symbol:Hr,u_iso_or_equiv:yn},atom_site_aniso:{label:Hr,u_11:yn,u:BK(3,3),u_12:yn,u_13:yn,u_22:yn,u_23:yn,u_33:yn},atom_type:{description:Hr,symbol:Hr},atom_type_scat:{dispersion_imag:yn,dispersion_real:yn,source:Hr}},OK={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},zu={parse:function(e){return typeof e=="string"?kR(e):GR(e)},parseText:kR,parseBinary:GR,toDatabaseCollection:cK,toDatabase:Nu,schema:{mmCIF:function(e){return Nu(Jt,e)},CCD:function(e){return Nu(bK,e)},BIRD:function(e){return Nu(SK,e)},dic:function(e){return Nu(MK,e)},cifCore:function(e){return Nu(FK,e,OK)},densityServer:function(e){return Nu(RK,e)}}},s_=512;function kK(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function LK(e,t){var r=t?function(a){return e.readInt16LE(a*2)}:function(a){return e.readInt16BE(a*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function WR(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=Math.ceil(t/8),i=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:a,yBlocks:i,zBlocks:o}}function NK(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i;return ae(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,s_)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),a=n||t.readInt16LE(18*2)===100,i=n?kK(r):LK(t,a),[2,{header:i,littleEndian:a}]}})})}function UK(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w;return ae(this,function(T){for(n||ys.flipByteOrderInPlace2(t.buffer),a=e.divisor,i=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,c=WR(e),l=c.xBlocks,f=c.yBlocks,d=c.zBlocks,m=0,p=0;p<d;++p)for(v=0;v<f;++v)for(h=0;h<l;++h)for(g=0;g<8;++g)for(y=8*p+g,b=0;b<8;++b)for(x=8*v+b,C=0;C<8;++C)if(_=8*h+C,_<o&&x<s&&y<u)w=(_*s+x)*u+y,r[w]=(t[m]-i)/a,++m;else{m+=8-C;break}return[2]})})}function zK(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,a=WR(e),i=a.xBlocks,o=a.yBlocks,s=a.zBlocks,u=t*r*n,c=i*8*o*8*s*8,l=1,f=c*l;return{count:c,byteCount:f,valueCount:u}}function VK(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return l.sent(),[4,NK(e)];case 2:return n=l.sent(),a=n.header,i=n.littleEndian,[4,e.readBuffer(s_,t-s_)];case 3:return o=l.sent().buffer,s=zK(a).valueCount,u=new Float32Array(s),[4,UK(a,o,u,i)];case 4:return l.sent(),c={header:a,values:u,name:e.name},[2,c]}})})}function GK(e,t){var r=this;return Be.create("Parse DSN6/BRIX",function(n){return ie(r,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=(a=$r).success,[4,VK(e,t,n)];case 1:return[2,i.apply(a,[s.sent()])];case 2:return o=s.sent(),[2,$r.error(o)];case 3:return[2]}})})})}function HK(e,t){return GK(Gy.fromBuffer(ys.fromUint8Array(e),t),e.length)}var qK={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},jK=new Set(Object.keys(qK));function u_(e){if(!jK.has(e))throw new Error("unknown ply type '".concat(e,"'"));return e}function WK(e,t,r){for(var n=new Map,a=0,i=t.length;a<i;++a)n.set(t[a],e[a]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function XK(e,t){var r=et(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function YK(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,et.eatLine(e)}function KK(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;YK(t);var a=et.getTokenString(t).split(/\r?\n/);if(a[0]!=="ply")throw new Error("data not starting with 'ply'");if(a[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var i,o,s;function u(){if(i!==void 0&&o!==void 0&&s!==void 0){for(var m=!1,p=0,v=s.length;p<v;++p){var h=s[p];if(h.kind==="list"){m=!0;break}}m&&s.length!==1,m?n.push({kind:"list",name:i,count:o,property:s[0]}):n.push({kind:"table",name:i,count:o,properties:s})}}for(var c=2,l=a.length;c<l;++c){var f=a[c],d=f.split(" ");if(f.startsWith("comment"))r.push(f.substr(8));else if(f.startsWith("element"))u(),s=[],i=d[1],o=parseInt(d[2]);else if(f.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");d[1]==="list"?s.push({kind:"list",countType:u_(d[2]),dataType:u_(d[3]),name:d[4]}):s.push({kind:"column",type:u_(d[1]),name:d[2]})}else f.startsWith("end_header")?u():console.warn("unknown header line")}}function QK(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var a=t[r];a.kind==="table"?ZK(e,a):a.kind==="list"&&$K(e,a)}}function XR(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ce.Schema.int;case"float":case"double":case"float32":case"float64":return ce.Schema.float}}function ZK(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.properties,o=i.length,s=[],u=[],c=[],l=new Map,f=0,d=o;f<d;++f){var m=qe.create(n.data,a*2);c.push(m)}for(var f=0,d=a;f<d;++f)for(var p=0,v=o;p<v;++p)et.skipWhitespace(n),et.markStart(n),et.eatValue(n),qe.addUnchecked(c[p],n.tokenStart,n.tokenEnd);for(var f=0,d=o;f<d;++f){var h=i[f],g=h.type,y=h.name,b=X3(c[f],XR(g));s.push(y),u.push(g),l.set(y,b)}r.push({kind:"table",rowCount:a,propertyNames:s,propertyTypes:u,getProperty:function(x){return l.get(x)}})}function $K(e,t){for(var r=e.elements,n=e.tokenizer,a=t.count,i=t.property,o=qe.create(n.data,a*2*3),s=new Uint32Array(a+1),u=0,c=0,l=a;c<l;++c){for(et.skipWhitespace(n),et.markStart(n);et.skipWhitespace(n)!==10;)++u,et.markStart(n),et.eatValue(n),qe.addToken(o,n);s[c+1]=u}var f={entries:[],count:0},d=X3(o,XR(i.dataType));r.push({kind:"list",rowCount:a,name:i.name,type:i.dataType,value:function(m){for(var p=s[m]+1,v=d.value(p-1),h=p,g=p+v;h<g;++h)f.entries[h-p]=d.value(h);return f.count=v,f}})}function JK(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s;return ae(this,function(u){return r=XK(e,t),t.update({message:"Parsing...",current:0,max:e.length}),KK(r),QK(r),n=r.elements,a=r.elementSpecs,i=r.comments,o=a.map(function(c){return c.name}),s=WK(n,o,i),[2,$r.success(s)]})})}function eQ(e){var t=this;return Be.create("Parse PLY",function(r){return ie(t,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,JK(e,r)];case 1:return[2,n.sent()]}})})})}var $y=et.readLine,YR=et.skipWhitespace,KR=et.eatValue,tQ=et.eatLine,c_=et.markStart,Jy=/\s+/,rQ=/(^\*|REMARK)*/;function nQ(e,t){return{tokenizer:e,runtimeCtx:t}}function aQ(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,d,m,p,v,h;return ae(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=qe.create(r.data,t*2),a=qe.create(r.data,t*2),i=qe.create(r.data,t*2),o=qe.create(r.data,t*2),s=qe.create(r.data,t*2),u=qe.create(r.data,t*2),c=qe.create(r.data,t*2),l=qe.create(r.data,t*2),f=r.position,d=$y(r).trim(),r.position=f,m=d.split(Jy).length===7,p=m?6:8,v=r.length,h=0,[4,Fu(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-h,y),x=0;x<b;++x){for(var C=0;C<p;++C)if(YR(r),c_(r),KR(r),m)switch(C){case 0:qe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:qe.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:qe.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:qe.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:qe.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 5:qe.addUnchecked(l,r.tokenStart,r.tokenEnd);break}else switch(C){case 0:qe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:qe.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:qe.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:qe.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:qe.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:qe.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:qe.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 7:qe.addUnchecked(l,r.tokenStart,r.tokenEnd);break}tQ(r),c_(r)}return h+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:v})})];case 1:return g.sent(),[2,{count:t,atomId:Zt(n)(ce.Schema.int),segmentName:m?Zt(i)(ce.Schema.str):Zt(a)(ce.Schema.str),residueId:Zt(i)(ce.Schema.int),residueName:m?Zt(i)(ce.Schema.str):Zt(o)(ce.Schema.str),atomName:Zt(s)(ce.Schema.str),atomType:Zt(u)(ce.Schema.str),charge:Zt(c)(ce.Schema.float),mass:Zt(l)(ce.Schema.float)}]}})})}function iQ(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o;return ae(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=qe.create(r.data,t*2),a=qe.create(r.data,t*2),i=r.length,o=0,[4,Fu(e.runtimeCtx,10,void 0,function(u){for(var c=Math.min(t-o,u),l=0;l<c;++l)for(var f=0;f<2;++f)switch(YR(r),c_(r),KR(r),f){case 0:qe.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:qe.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return o+=c,c},function(u){return u.update({message:"Parsing...",current:r.position,max:i})})];case 1:return s.sent(),[2,{count:t,atomIdA:Zt(n)(ce.Schema.int),atomIdB:Zt(a)(ce.Schema.int)}]}})})}function oQ(e,t){for(var r=[],n=0;n<t;++n){var a=$y(e.tokenizer);r.push(a.replace(rQ,"").trim())}return r}function sQ(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:r=et(e),n=nQ(r,t),a=void 0,i=void 0,o=void 0,s=$y(n.tokenizer).trim(),m.label=1;case 1:return r.tokenEnd<r.length?(u=$y(n.tokenizer).trim(),u.includes("!NTITLE")?(c=parseInt(u.split(Jy)[0]),a=oQ(n,c),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(l=parseInt(u.split(Jy)[0]),[4,aQ(n,l)]):[3,4];case 3:return i=m.sent(),[3,7];case 4:return u.includes("!NBOND")?(f=parseInt(u.split(Jy)[0]),[4,iQ(n,f)]):[3,6];case 5:return o=m.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),m.label=7;case 7:return[3,1];case 8:return a===void 0&&(a=[]),i===void 0?[2,$r.error("no atoms data")]:o===void 0?[2,$r.error("no bonds data")]:(d={id:s,title:a,atoms:i,bonds:o},[2,$r.success(d)])}})})}function uQ(e){var t=this;return Be.create("Parse PSF",function(r){return ie(t,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,sQ(e,r)];case 1:return[2,n.sent()]}})})})}var QR=.529177210859;function cQ(e){var t=et.readLines(e,6),r=function(D,E){var M=+t[D].trim().split(/\s+/g)[E];return Number.isNaN(M)?0:M},n=function(D){var E=r(D+2,0),M=QR;return[Math.abs(E),S.create(r(D+2,1)*M,r(D+2,2)*M,r(D+2,3)*M),E]},a=t[0].trim(),i=t[1].trim(),o=n(0),s=o[0],u=o[1],c=o[2],l=n(1),f=l[0],d=l[1],m=n(2),p=m[0],v=m[1],h=n(3),g=h[0],y=h[1],b=lQ(e,s,QR),x=[];if(c>=0){var C=r(2,4);C===0&&(C=1);for(var _=0;_<C;_++)x.push(_)}else for(var w=et.readLine(e).trim().split(/\s+/g),_=0,T=+w[0];_<T;_++)x.push(+w[_+1]);var A={orbitals:c<0,comment1:a,comment2:i,atomCount:s,origin:u,dim:S.create(f,p,g),basisX:d,basisY:v,basisZ:y,dataSetIds:x};return{header:A,atoms:b}}function lQ(e,t,r){for(var n=new Int32Array(t),a=new Float64Array(t),i=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var c=et.readLine(e).trim().split(/\s+/g);n[u]=+c[0],a[u]=+c[1],i[u]=+c[2]*r,o[u]=+c[3]*r,s[u]=+c[4]*r}return{count:t,number:ce.ofArray({array:n,schema:ce.Schema.int}),nuclearCharge:ce.ofArray({array:a,schema:ce.Schema.float}),x:ce.ofArray({array:i,schema:ce.Schema.float}),y:ce.ofArray({array:o,schema:ce.Schema.float}),z:ce.ofArray({array:s,schema:ce.Schema.float})}}function fQ(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,a=100*100*100,i=new Float64Array(n),o=0;return Fu(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)et.skipWhitespace(t),t.tokenStart=t.position,et.eatValue(t),u[l]=Ru(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function dQ(e,t){var r=this;return Be.create("Parse Cube",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u;return ae(this,function(c){switch(c.label){case 0:return[4,n.update("Reading header...")];case 1:return c.sent(),a=et(e),i=cQ(a),o=i.header,s=i.atoms,[4,fQ(n,a,o)];case 2:return u=c.sent(),[2,$r.success({header:o,atoms:s,values:u,name:t})]}})})})}function ZR(e){for(var t={h:S()},r=0,n=0,a=/\s+/g;;){var i=et.readLine(e),o=void 0;if(i.startsWith("object 1"))o=i.split(a),t.dim=S.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(i.startsWith("origin"))o=i.split(a),t.min=S.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(i.startsWith("delta"))o=i.split(a),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function mQ(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],a=100*100*100,i=new Float64Array(n),o=0;return Fu(e,a,i,function(s,u){for(var c=Math.min(n,o+s),l=o;l<c;l++)et.skipWhitespace(t),t.tokenStart=t.position,et.eatValue(t),u[l]=Ru(t.data,t.tokenStart,t.tokenEnd);return o=c,c===n?0:a},function(s,u,c){return s.update({current:Math.min(c,n),max:n})})}function pQ(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i;return ae(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=et(t),a=ZR(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,mQ(e,n,a)];case 3:return i=o.sent(),[2,$r.success({header:a,values:i,name:r})]}})})}function vQ(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return[4,e.update("Reading header...")];case 1:return d.sent(),n=v3(t,0,1e3),a=et(n),i=ZR(a),o=i.header,s=i.headerByteCount,[4,e.update("Reading values...")];case 2:for(d.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],c=new DataView(t.buffer,t.byteOffset+s),l=new Float64Array(u),f=0;f<u;f++)l[f]=c.getFloat64(f*8,!0);return[2,$r.success({header:o,values:l,name:r})]}})})}function hQ(e,t){return Be.create("Parse Cube",function(r){return typeof e=="string"?pQ(r,e,t):vQ(r,e,t)})}var tr=Pf({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});(function(){var e=new Map;return Object.keys(tr).forEach(function(t){e.set(tr[t],t)}),e})();var $R=bt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{url:P.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:P.Optional(P.Text("")),isBinary:P.Optional(P.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Be.create("Download",function(i){return ie(r,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return o=mn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(i)];case 1:return s=u.sent(),a.asset=s,[2,n.isBinary?new fe.Data.Binary(s.data,{label:n.label?n.label:o.url}):new fe.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?Ge.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged}}),JR=bt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:fe.Root,to:fe.Data.Blob,params:{sources:P.ObjectList({id:P.Text("",{label:"Unique ID"}),url:P.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:P.Optional(P.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:P.Optional(P.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return"".concat(e.id,": ").concat(e.url)}),maxConcurrency:P.Optional(P.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Be.create("Download Blob",function(i){return ie(r,void 0,void 0,function(){var o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return o=[],[4,LW(i,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=d.sent(),u=[],c=0;c<s.length;c++)l=s[c],f=n.sources[c],l.kind==="error"?t.log.warn("Download ".concat(l.id," (").concat(f.url,") failed: ").concat(l.error)):(u.push(l.result),o.push(f.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}));return a.assets=u,[2,new fe.Data.Blob(o,{label:"Data Blob",description:"".concat(o.length," ").concat(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,a=(r=n)===null||r===void 0?void 0:r.assets;if(!!a)for(var i=0,o=a;i<o.length;i++){var s=o[i];s.dispose()}}}),eB=bt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{data:P.Value("",{isHidden:!0}),label:P.Optional(P.Text(""))}})({apply:function(e){var t=this,r=e.params;return Be.create("Raw Data",function(){return ie(t,void 0,void 0,function(){return ae(this,function(n){if(typeof r.data=="string")return[2,new fe.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new fe.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new fe.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new fe.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?Ge.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,a=e.data.length;n<a;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),tB=bt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:fe.Root,to:[fe.Data.String,fe.Data.Binary],params:{file:P.File(),label:P.Optional(P.Text("")),isBinary:P.Optional(P.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,a=e.cache;return Be.create("Open File",function(i){return ie(r,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,rn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(i)];case 1:return o=u.sent(),a.asset=o,s=n.isBinary?new fe.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new fe.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,a=e.b;return r.label!==n.label?(a.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),gQ=bt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:fe.Data.Blob,to:fe.Format.Blob,params:{formats:P.ObjectList({id:P.Text("",{label:"Unique ID"}),format:P.Select("cif",[["cif","cif"]])},function(e){return"".concat(e.id,": ").concat(e.format)})}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Parse Blob",function(i){return ie(r,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:for(o=new Map,s=0,u=a.formats;s<u.length;s++)c=u[s],o.set(c.id,c.format);l=[],f=0,d=n.data,v.label=1;case 1:return f<d.length?(m=d[f],o.has(m.id)?[4,(m.kind==="string"?zu.parse(m.data):zu.parseBinary(m.data)).runInContext(i)]:[3,3]):[3,4];case 2:if(p=v.sent(),p.isError)throw new Error("".concat(m.id,": ").concat(p.message));l.push({id:m.id,kind:"cif",data:p.result}),v.label=3;case 3:return f++,[3,1];case 4:return[2,new fe.Format.Blob(l,{label:"Format Blob",description:"".concat(l.length," ").concat(l.length===1?"entry":"entries")})]}})})})}}),yQ=bt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[fe.Data.String,fe.Data.Binary],to:fe.Format.Cif})({apply:function(e){var t=this,r=e.a;return Be.create("Parse CIF",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,(fe.Data.String.is(r)?zu.parse(r.data):zu.parseBinary(r.data)).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Cif(a.result)]}})})})}}),bQ=bt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:fe.Data.String,to:fe.Format.Cube})({apply:function(e){var t=this,r=e.a;return Be.create("Parse Cube",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,dQ(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Cube(a.result)]}})})})}}),xQ=bt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[fe.Data.String],to:fe.Format.Psf})({apply:function(e){var t=this,r=e.a;return Be.create("Parse PSF",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,uQ(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Psf(a.result)]}})})})}}),SQ=bt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[fe.Data.String],to:fe.Format.Ply})({apply:function(e){var t=this,r=e.a;return Be.create("Parse PLY",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,eQ(r.data).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Ply(a.result,{label:a.result.comments[0]||"PLY Data"})]}})})})}}),CQ=bt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[fe.Data.Binary],to:fe.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return Be.create("Parse CCP4/MRC/MAP",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,cY(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Ccp4(a.result)]}})})})}}),_Q=bt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[fe.Data.Binary],to:fe.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return Be.create("Parse DSN6/BRIX",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,HK(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Dsn6(a.result)]}})})})}}),wQ=bt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[fe.Data.Binary,fe.Data.String],to:fe.Format.Dx})({apply:function(e){var t=this,r=e.a;return Be.create("Parse DX",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,hQ(r.data,r.label).runInContext(n)];case 1:if(a=i.sent(),a.isError)throw new Error(a.message);return[2,new fe.Format.Dx(a.result)]}})})})}}),AQ=bt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:fe.Root,to:fe.Data.String,params:{data:P.Value(""),label:P.Optional(P.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new fe.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?Ge.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),TQ=bt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:fe.Root,to:fe.Format.Json,params:{data:P.Value({}),label:P.Optional(P.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new fe.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?Ge.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),PQ=bt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[fe.Data.String],to:fe.Format.Json})({apply:function(e){var t=this,r=e.a;return Be.create("Parse JSON",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,new Response(r.data).json()];case 1:return a=i.sent(),[2,new fe.Format.Json(a)]}})})})}}),EQ=bt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:fe.Root,to:fe.Volume.Lazy,params:{url:P.Url(""),isBinary:P.Boolean(!1),format:P.Text("ccp4"),entryId:P.Value("",{isHidden:!0}),isovalues:P.ObjectList({type:P.Text("relative"),value:P.Numeric(0),color:P.Color(tr.black),alpha:P.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:P.Numeric(0)},function(e){return"".concat(e.type," ").concat(e.value)})}})({apply:function(e){var t=this;e.a;var r=e.params;return Be.create("Lazy Volume",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){return a=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new fe.Volume.Lazy(r,{label:"".concat(a||r.url),description:"Lazy Volume"})]})})})}}),IQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Download:$R,DownloadBlob:JR,RawData:eB,ReadFile:tB,ParseBlob:gQ,ParseCif:yQ,ParseCube:bQ,ParsePsf:xQ,ParsePly:SQ,ParseCcp4:CQ,ParseDsn6:_Q,ParseDx:wQ,ImportString:AQ,ImportJson:TQ,ParseJson:PQ,LazyVolume:EQ}),DQ=bt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:fe.Group,params:{label:P.Text("Group"),description:P.Optional(P.Text(""))}})({apply:function(e){var t=e.params;return new fe.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return Xg(t,r)?Ge.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,Ge.UpdateResult.Updated)}}),MQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",CreateGroup:DQ});function RQ(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],a=0,i=new Int32Array(e.buffer,0,23),o=i[0]!==t.getInt32(0);if(i[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(i[0]!==84)throw new Error("dcd bad format, header block start");var c=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(c!=="CORD")throw new Error("dcd bad format, format string");var l=!1,f=!1,d=!1;if(i[22]!==0&&(l=!0,i[12]!==0&&(f=!0),i[13]===1&&(d=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],l?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),i[22]!==84)throw new Error("dcd bad format, header block end");a=a+21*4+8;var m=t.getInt32(a,o),p=a+1;if((m-4)%80!=0)throw new Error("dcd bad format, title block start");if(r.TITLE=LY(e.subarray(p,m)),t.getInt32(p+m+4-1,o)!==m)throw new Error("dcd bad format, title block end");if(a=a+m+8,t.getInt32(a,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(a+4,o),t.getInt32(a+8,o)!==4)throw new Error("dcd bad format, natom block end");if(a=a+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var v=r.NATOM,h=v*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=v,f&&(a+=4,g.cell=[t.getFloat64(a,o),t.getFloat64(a+1,o),t.getFloat64(a+2*8,o),t.getFloat64(a+3*8,o),t.getFloat64(a+4*8,o),t.getFloat64(a+5*8,o)],a+=48,a+=4);for(var y=0;y<3;++y){if(t.getInt32(a,o)!==h)throw new Error("dcd bad format, coord block start: ".concat(u,", ").concat(y));a+=4;var b=new Float32Array(e.buffer,a,v);if(y===0?g.x=b:y===1?g.y=b:g.z=b,a+=h,t.getInt32(a,o)!==h)throw new Error("dcd bad format, coord block end: ".concat(u,", ").concat(y));a+=4}if(d){var x=t.getInt32(a,o);a+=4+x+4}n.push(g)}return{header:r,frames:n}}function BQ(e){var t=this;return Be.create("Parse DCD",function(r){return ie(t,void 0,void 0,function(){var n;return ae(this,function(a){try{return n=RQ(e),[2,$r.success(n)]}catch(i){return[2,$r.error(i)]}return[2]})})})}function FQ(e){return function(t,r,n){return OQ(e,t,r,n)}}function OQ(e,t,r,n){var a=e.data,i=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(c){var l=i[2*c]+t,f=i[2*c+1];if(l>=f)return"";var d=l+r;return d>f&&(d=f),pY(a,l,d)}:s==="int"?function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:Df(a,l,l+r)}:function(c){var l=i[2*c]+t;return l>i[2*c+1]?0:Dj(a,l,l+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(c){return 0},toArray:function(c){return ga(o,u,c)},areValuesEqual:function(c,l){return u(c)===u(l)}}}function kQ(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function LQ(e,t){return{tokenizer:e,header:kQ(),numberOfAtoms:0,runtimeCtx:t}}function NQ(e){var t=e.tokenizer,r=e.header,n=et.readLine(t);n.trim().length===0&&(n=et.readLine(t));var a=n.lastIndexOf("t=");a>=0?(r.timeInPs=parseFloat(n.substring(a+2)),r.title=n.substring(0,a).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function UQ(e){var t=e.tokenizer;et.markLine(t);var r=et.getTokenString(t);e.numberOfAtoms=parseInt(r)}function zQ(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,et.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=p.sent(),a=t.data.substring(n.indices[0],n.indices[1]).substring(20),i=a.match(/\.\d+/g),o=i.length===6,e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0,s=20,u=e.header.precision.position+5,c=s+3*u,l=e.header.precision.velocity+4,f=FQ(n),d=ce.Undefined(e.numberOfAtoms,ce.Schema.float),m={count:e.numberOfAtoms,residueNumber:f(0,5,ce.Schema.int),residueName:f(5,5,ce.Schema.str),atomName:f(10,5,ce.Schema.str),atomNumber:f(15,5,ce.Schema.int),x:f(s,u,ce.Schema.float),y:f(s+u,u,ce.Schema.float),z:f(s+2*u,u,ce.Schema.float),vx:o?f(c,l,ce.Schema.float):d,vy:o?f(c+l,l,ce.Schema.float):d,vz:o?f(c+2*l,l,ce.Schema.float):d},[2,m]}})})}function VQ(e){var t=e.tokenizer,r=et.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function GQ(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o;return ae(this,function(s){switch(s.label){case 0:return r=et(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(a=LQ(r,t),NQ(a),UQ(a),[4,zQ(a)]):[3,4];case 3:return i=s.sent(),VQ(a),n.push({header:a.header,atoms:i}),[3,2];case 4:return o={structures:n},[2,$r.success(o)]}})})}function HQ(e){var t=this;return Be.create("Parse GRO",function(r){return ie(t,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,GQ(e,r)];case 1:return[2,n.sent()]}})})})}function qQ(e,t,r){var n=this;return r===void 0&&(r=!1),Be.create("Parse PDB",function(a){return ie(n,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return o=(i=$r).success,s={},[4,et.readAllLinesAsync(e,a)];case 1:return[2,o.apply(i,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function xl(e){return{kind:"table-legend",table:e}}function jQ(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var On;(function(e){e.Zero=0;var t=function(){var h=new ArrayBuffer(8),g=new ArrayBuffer(8);return{_int32:new Int32Array(h),_float64:new Float64Array(h),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}}(),r=t._int32,n=t._float64,a=t._int32_1,i=t._float64_1;function o(h){return typeof h=="number"}e.is=o;function s(h,g){return r[0]=h,r[1]=g,n[0]}e.create=s;function u(h){return n[0]=h,r[1]-r[0]}e.diff=u;function c(h){return n[0]=h,r[0]}e.fst=c;function l(h){return n[0]=h,r[1]}e.snd=l;function f(h,g){return n[0]=h,i[0]=g,r[0]===a[0]&&r[1]===a[1]}e.areEqual=f;function d(h,g){n[0]=h,i[0]=g;var y=r[0]-a[0];return y!==0?y:r[1]-a[1]}e.compare=d;function m(h,g,y){n[0]=h[g],i[0]=h[y];var b=r[0]-a[0];return b!==0?b:r[1]-a[1]}e.compareInArray=m;function p(h){return n[0]=h,If(r[0],r[1])}e.hashCode=p;function v(h){return n[0]=h,"(".concat(r[0],", ").concat(r[1],")")}e.toString=v})(On||(On={}));var rB=On.Zero;function nB(e,t){return t<e?On.create(e,e):On.create(e,t+1)}function l_(e,t){return t<=e?On.create(e,e):On.create(e,t)}function WQ(e){return e<0?On.create(0,0):On.create(0,e)}var XQ=On.is,Vu=On.fst,Sl=On.snd,e1=On.fst;function t1(e){return On.snd(e)-1}var zf=On.diff,YQ=On.hashCode,KQ=On.toString;function QQ(e,t){return On.fst(e)<=t&&t<On.snd(e)}function ZQ(e,t){var r=Vu(e);return t>=r&&t<Sl(e)?t-r:-1}function $Q(e,t){return On.fst(e)+t}var JQ=On.areEqual;function aB(e,t){var r=zf(e),n=zf(t);return r===0&&n===0?!0:r>0&&n>0&&t1(e)>=e1(t)&&e1(e)<=t1(t)}function eZ(e,t){return zf(e)?zf(t)?Vu(e)<=Vu(t)&&Sl(e)>=Sl(t):!0:zf(t)===0}function f_(e,t){var r=Vu(e);if(t<=r)return 0;var n=Sl(e);return t>=n?n-r:t-r}function tZ(e,t,r){var n=Vu(r),a=Vu(e);if(t<=n+a)return n;var i=Sl(r);return t>=i+a?i:t-a}function iB(e,t,r){return l_(f_(e,t),f_(e,r+1))}function rZ(e,t){return aB(e,t)?l_(Math.max(Vu(e),Vu(t)),Math.min(Sl(e),Sl(t))):rB}function nZ(e,t){return zf(iB(e,e1(t),t1(t)))}var Se;(function(e){e.Empty=rB,e.ofSingleton=function(t){return nB(t,t)},e.ofRange=nB,e.ofBounds=l_,e.ofLength=WQ,e.is=XQ,e.has=QQ,e.indexOf=ZQ,e.getAt=$Q,e.start=Vu,e.end=Sl,e.min=e1,e.max=t1,e.size=zf,e.hashCode=YQ,e.toString=KQ,e.areEqual=JQ,e.areIntersecting=aB,e.isSubInterval=eZ,e.findPredecessorIndex=f_,e.findPredecessorIndexInInterval=tZ,e.findRange=iB,e.intersectionSize=nZ,e.intersect=rZ})(Se||(Se={}));var xh=[];function aZ(e){return[e]}function Vf(e){return e}function iZ(e){return vs(e),e}function oB(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function oZ(e){return e&&(Array.isArray(e)||!!e.buffer)}function sB(e){return e[e.length-1]-e[0]+1===e.length}function d_(e){return e[0]}function m_(e){return e[e.length-1]+1}function sZ(e){return e[0]}function uZ(e){return e[e.length-1]}function uB(e){return e.length}function cZ(e){var t=e.length;return t?t>2?Pj(t,e[0],e[t-1],e[t>>1]):Tj(t,e[0],e[t-1]):0}function lZ(e){var t=e.length;return t>5?"[".concat(e[0],", ").concat(e[1],", ..., ").concat(e[t-1],"], length ").concat(t):"[".concat(e.join(", "),"]")}function cB(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?dB(e,t,0,r):-1}function fZ(e,t,r){return lB(e,t,Se.start(r),Se.end(r))}function lB(e,t,r,n){var a=e.length;return a===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?dB(e,t,r,n):-1}function dZ(e,t){return cB(e,t)>=0}function fB(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(sB(e))return!0;r--;for(var n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Gf(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:mB(e,t,0,r)}function mZ(e,t,r){var n=Se.start(r),a=Se.end(r),i=e[n];return t<=i?n:a>n&&t>e[a-1]?a:t-i<=11?vZ(e,t,n+1,a):mB(e,t,n,a)}function pZ(e,t,r){return Se.ofBounds(Gf(e,t),Gf(e,r+1))}function dB(e,t,r,n){for(var a=r,i=n-1;a<=i;){if(a+11>i){for(var o=a;o<=i;o++)if(t===e[o])return o;return-1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return-1}function mB(e,t,r,n){for(var a=r,i=n-1;a<i;){if(a+11>i){for(var o=a;o<=i;o++)if(t<=e[o])return o;return i+1}var s=a+i>>1,u=e[s];if(t<u)i=s-1;else if(t>u)a=s+1;else return s}return a>i?i+1:e[a]>=t?a:a+1}function vZ(e,t,r,n){for(var a=r;a<n;a++)if(t<=e[a])return a;return n}function hZ(e,t){if(e===t)return!0;for(var r=Hf(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;n<i&&a<o;){var s=e[n],u=t[a];if(s<u)n++;else if(s>u)a++;else return!0}return!1}function gZ(e,t){if(e===t)return!0;var r=t.length,n=Hf(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ;if(s-i<r||o-a<r)return!1;for(var u=0;a<o&&i<s;){var c=e[a],l=t[i];c<l?a++:c>l?i++:(a++,i++,u++)}return u===r}function pB(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return pB(t,e);var a=Hf(e,t),i=a.startI,o=a.startJ,s=a.endI,u=a.endJ,c=p_(e,t,i,o,s,u);if(c===r&&c===n||c===n)return e;if(c===r)return t;var l=new Int32Array(r+n-c),f=0,d=0,m=0;for(f=0;f<i;f++)l[m++]=e[f];for(;d<u&&e[i]>t[d];)l[m++]=t[d++];for(;f<s&&d<u;){var p=e[f],v=t[d];p<v?(l[m++]=p,f++):p>v?(l[m++]=v,d++):(l[m++]=p,f++,d++)}for(;f<s;f++)l[m++]=e[f];for(;d<u;d++)l[m++]=t[d];for(;f<r;f++)l[m++]=e[f];for(;d<n;d++)l[m++]=t[d];return Vf(l)}function yZ(e,t){if(e===t)return uB(e);var r=Hf(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ;return p_(e,t,n,a,i,o)}function p_(e,t,r,n,a,i){for(var o=r,s=n,u=0;o<a&&s<i;){var c=e[o],l=t[s];c<l?o++:c>l?s++:(o++,s++,u++)}return u}function bZ(e,t){if(e===t)return e;var r=Hf(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=p_(e,t,n,a,i,o),u=e.length,c=t.length;if(!s)return xh;if(s===u&&s===c||s===c)return t;if(s===u)return e;for(var l=new Int32Array(s),f=0,d=n,m=a;d<i&&m<o;){var p=e[d],v=t[m];p<v?d++:(p>v||(l[f++]=p,d++),m++)}return Vf(l)}function xZ(e,t){if(e===t)return xh;for(var r=e.length,n=Hf(e,t),a=n.startI,i=n.startJ,o=n.endI,s=n.endJ,u=a,c=i,l=0;u<o&&c<s;){var f=e[u],d=t[c];f<d?u++:f>d?c++:(u++,c++,l++)}if(!l)return e;if(l>=r)return xh;for(var m=new Int32Array(r-l),p=0,v=0;v<a;v++)m[p++]=e[v];for(u=a,c=i;u<o&&c<s;){var f=e[u],d=t[c];f<d?(m[p++]=f,u++):(f>d||u++,c++)}for(;u<r;u++)m[p++]=e[u];return Vf(m)}function SZ(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var a=new Int32Array(t),i=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(a[i++]=e[r]);return a[i]=e[e.length-1],a}function CZ(e,t){if(fB(e,t))return Vf(n3(0,e.length-1));for(var r=Hf(e,t),n=r.startI,a=r.startJ,i=r.endI,o=r.endJ,s=n,u=a,c=0;s<i&&u<o;){var l=e[s],f=t[u];l<f?s++:l>f?u++:(s++,u++,c++)}var d=e.length;if(!c)return xh;if(c===d)return Vf(n3(0,e.length-1));var m=new Int32Array(c),p=0;for(s=n,u=a;s<i&&u<o;){var l=e[s],f=t[u];l<f?s++:(l>f||(m[p++]=s,s++),u++)}return Vf(m)}var Gu={startI:0,startJ:0,endI:0,endJ:0};function Hf(e,t){var r=e.length,n=t.length,a=r/n;return r>=128||n>=128||a<=.34||a>=2.99?(Gu.startI=Gf(e,d_(t)),Gu.startJ=Gf(t,d_(e)),Gu.endI=Gf(e,m_(t)),Gu.endJ=Gf(t,m_(e))):(Gu.startI=0,Gu.startJ=0,Gu.endI=r,Gu.endJ=n),Gu}var Le;(function(e){e.Empty=xh,e.ofUnsortedArray=iZ,e.ofSingleton=aZ,e.ofSortedArray=Vf,e.ofRange=oB,e.ofBounds=function(t,r){return oB(t,r-1)},e.is=oZ,e.isRange=sB,e.has=dZ,e.indexOf=cB,e.indexOfInInterval=fZ,e.indexOfInRange=lB,e.start=d_,e.end=m_,e.min=sZ,e.max=uZ,e.size=uB,e.hashCode=cZ,e.toString=lZ,e.areEqual=fB,e.areIntersecting=hZ,e.isSubset=gZ,e.union=pB,e.intersect=bZ,e.subtract=xZ,e.findPredecessorIndex=Gf,e.findPredecessorIndexInInterval=mZ,e.findRange=pZ,e.intersectionSize=yZ,e.deduplicate=SZ,e.indicesOf=CZ})(Le||(Le={}));var Ks=Se.Empty,_Z=Se.ofSingleton,wZ=Se.ofRange,AZ=Se.ofBounds;function bs(e){return e.length?Le.isRange(e)?Se.ofRange(e[0],e[e.length-1]):e:Ks}function qf(e){return Se.is(e)?Se.size(e):Le.size(e)}function TZ(e,t){return Se.is(e)?Se.has(e,t):Le.has(e,t)}function PZ(e,t){return Se.is(e)?Se.indexOf(e,t):Le.indexOf(e,t)}function v_(e,t){return Se.is(e)?Se.getAt(e,t):e[t]}function Xm(e){return Se.is(e)?Se.min(e):Le.min(e)}function Ym(e){return Se.is(e)?Se.max(e):Le.max(e)}function EZ(e){return Se.is(e)?Se.start(e):Le.start(e)}function IZ(e){return Se.is(e)?Se.end(e):Le.end(e)}function DZ(e){return Se.is(e)?Se.hashCode(e):Le.hashCode(e)}function MZ(e){return Se.is(e)?Se.toString(e):Le.toString(e)}function RZ(e,t){return Se.is(e)?Se.is(t)?Se.areEqual(e,t):vB(e,t):Se.is(t)?vB(t,e):Le.areEqual(e,t)}function BZ(e,t){return Se.is(e)?Se.is(t)?Se.areIntersecting(e,t):hB(t,e):Se.is(t)?hB(e,t):Le.areIntersecting(e,t)}function FZ(e,t){return Se.is(e)?Se.is(t)?Se.isSubInterval(e,t):HZ(e,t):Se.is(t)?GZ(e,t):Le.isSubset(e,t)}function OZ(e,t){return Se.is(e)?Se.findPredecessorIndex(e,t):Le.findPredecessorIndex(e,t)}function kZ(e,t,r){return Se.is(e)?Se.findPredecessorIndexInInterval(e,t,r):Le.findPredecessorIndexInInterval(e,t,r)}function LZ(e,t,r){return Se.is(e)?Se.findRange(e,t,r):Le.findRange(e,t,r)}function NZ(e,t){return Se.is(e)?Se.is(t)?Se.intersectionSize(e,t):yB(t,e):Se.is(t)?yB(e,t):Le.intersectionSize(e,t)}function UZ(e,t){return Se.is(e)?Se.is(t)?WZ(e,t):gB(t,e):Se.is(t)?gB(e,t):bs(Le.union(e,t))}function zZ(e,t){return Se.is(e)?Se.is(t)?Se.intersect(e,t):bB(t,e):Se.is(t)?bB(e,t):bs(Le.intersect(e,t))}function VZ(e,t){return Se.is(e)?Se.is(t)?XZ(e,t):KZ(e,t):Se.is(t)?YZ(e,t):bs(Le.subtract(e,t))}function vB(e,t){return Se.size(e)===Le.size(t)&&Se.start(e)===Le.start(t)&&Se.end(e)===Le.end(t)}function hB(e,t){return e.length!==0&&Se.size(Le.findRange(e,Se.min(t),Se.max(t)))!==0}function GZ(e,t){var r=Se.min(t),n=Se.max(t);if(n-r+1==0)return!0;var a=Le.min(e),i=Le.max(e);if(r<a||n>i)return!1;var o=Le.findRange(e,r,n);return Se.size(o)===Se.size(t)}function HZ(e,t){var r=Se.min(e),n=Se.max(e);if(n-r+1==0)return!1;var a=Le.min(t),i=Le.max(t);return a>=r&&i<=n}function qZ(e,t){var r=qf(e),n=qf(t);return r===0&&n===0?!0:r>0&&n>0&&Ym(e)>=Xm(t)&&Xm(e)<=Ym(t)}function jZ(e,t){return qf(e)?qf(t)?Xm(e)<=Xm(t)&&Ym(e)>=Ym(t):!0:qf(t)===0}function WZ(e,t){if(Se.areEqual(e,t))return e;var r=Se.size(e),n=Se.size(t);if(!n)return e;if(!r)return t;var a=Se.min(e),i=Se.min(t);if(qZ(e,t))return Se.ofRange(Math.min(a,i),Math.max(Se.max(e),Se.max(t)));var o,s,u,c;a<i?(o=r,s=a,u=n,c=i):(o=n,s=i,u=r,c=a);for(var l=new Int32Array(r+n),f=0;f<o;f++)l[f]=f+s;for(var f=0;f<u;f++)l[f+o]=f+c;return bs(l)}function gB(e,t){var r=Se.size(t);if(!r)return e;if(jZ(t,e))return t;for(var n=Se.min(t),a=Se.max(t),i=Le.findRange(e,n,a),o=Se.start(i),s=Se.end(i),u=new Int32Array(o+(e.length-s)+r),c=0,l=0;l<o;l++)u[c++]=e[l];for(var l=n;l<=a;l++)u[c++]=l;for(var l=s,f=e.length;l<f;l++)u[c++]=e[l];return bs(u)}function yB(e,t){if(!Se.size(t))return 0;var r=Le.findRange(e,Se.min(t),Se.max(t));return Se.end(r)-Se.start(r)}function bB(e,t){if(!Se.size(t))return Ks;var r=Le.findRange(e,Se.min(t),Se.max(t)),n=Se.start(r),a=Se.end(r),i=a-n;if(!i)return Ks;if(i===e.length)return e;for(var o=new Int32Array(i),s=0,u=n;u<a;u++)o[s++]=e[u];return bs(o)}function XZ(e,t){if(Se.areEqual(e,t))return Ks;if(!Se.areIntersecting(e,t))return e;var r=Se.min(e),n=Se.max(e),a=Se.min(t),i=Se.max(t);if(n<r||i<a)return e;if(Se.isSubInterval(t,e))return Ks;if(Se.isSubInterval(e,t)){var o=a-r,s=n-i;if(o<=0)return Se.ofRange(i+1,i+s);if(s<=0)return Se.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),c=0,l=0;l<o;l++)u[c++]=r+l;for(var l=1;l<=s;l++)u[c++]=i+l;return bs(u)}return r<a?Se.ofRange(r,a-1):Se.ofRange(i+1,n)}function YZ(e,t){var r=Se.min(t),n=Se.max(t);if(n<r)return e;var a=Le.findRange(e,r,n),i=Se.start(a),o=Se.end(a),s=e.length-(o-i);if(s<=0)return Ks;if(s===e.length)return e;for(var u=new Int32Array(s),c=0,l=0;l<i;l++)u[c++]=e[l];for(var l=o,f=e.length;l<f;l++)u[c++]=e[l];return bs(u)}function KZ(e,t){var r=Se.min(e),n=Se.max(e);if(n<r)return e;var a=n-r+1,i=Le.findRange(t,r,n),o=Se.start(i),s=Se.end(i),u=s-o;if(u===0)return e;var c=a-u;if(c<=0)return Ks;for(var l=new Int32Array(c),f=t.length-1,d=t[Math.min(o,f)],m=t[Math.min(s,f)],p=0,v=r;v<d;v++)l[p++]=v;for(var v=d;v<=m;v++)Le.indexOfInInterval(t,v,i)<0&&(l[p++]=v);for(var v=m+1;v<=n;v++)l[p++]=v;return bs(l)}function QZ(e,t,r){if(Se.is(e))for(var n=Se.min(e),a=n,i=Se.max(e);a<=i;a++)t(a,a-n,r);else for(var a=0,i=e.length;a<i;a++)t(e[a],a,r);return r}function ZZ(e,t,r,n){if(Se.is(e))for(var a=0,i=Se.min(e),o=Se.max(e);i<=o;i++){for(var s=t(i),u=i+1;u<o&&t(u)===s;)u++;i=u-1,r(s,a,n),a++}else for(var a=0,i=0,o=e.length;i<o;i++){for(var s=t(e[i]),u=i+1;u<o&&t(e[u])===s;)u++;i=u-1,r(s,a,n),a++}return n}function $Z(e,t,r){if(t===r)return e;var n=qf(e),a=t.length,i=r.length;if(n===0||a===0||i===0)return Ks;for(var o=Le.findPredecessorIndex(r,t[Xm(e)]),s=Le.findPredecessorIndex(r,t[Ym(e)]+1),u=0,c=0,l=0,f=o;l<n&&f<s;){var d=t[v_(e,l)],m=r[f];d<m?l++:(d>m||(u++,l++),f++)}if(u===0)return Ks;if(u===a&&u===i)return e;var p=new Int32Array(u);for(c=0,l=0,f=o;l<n&&f<s;){var d=t[v_(e,l)],m=r[f];d<m?l++:(d>m||(p[c++]=f,l++),f++)}return bs(p)}var De;(function(e){e.Empty=Ks,e.ofSingleton=_Z,e.ofRange=wZ,e.ofBounds=AZ,e.ofSortedArray=bs,e.has=TZ,e.indexOf=PZ,e.getAt=v_,e.min=Xm,e.max=Ym,e.start=EZ,e.end=IZ,e.size=qf,e.hashCode=DZ,e.areEqual=RZ,e.areIntersecting=BZ,e.isSubset=FZ,e.union=UZ,e.intersect=zZ,e.indexedIntersect=$Z,e.subtract=VZ,e.findPredecessorIndex=OZ,e.findPredecessorIndexInInterval=kZ,e.findRange=LZ,e.intersectionSize=NZ;function t(s,u,c){return QZ(s,u,c)}e.forEach=t;function r(s,u,c,l){return ZZ(s,u,c,l)}e.forEachSegment=r;function n(s){return Se.is(s)}e.isInterval=n;function a(s){return!Se.is(s)}e.isSortedArray=a;function i(s){var u=[];return e.forEach(s,function(c){return u.push(c)}),u}e.toArray=i;function o(s){return MZ(s)}e.toString=o})(De||(De={}));function xB(e){for(var t=Le.ofSortedArray(e),r=Le.max(t),n=new Int32Array(r),a=0,i=e.length-1;a<i;a++)for(var o=e[a],s=e[a+1];o<s;o++)n[o]=a;return{offsets:t,index:n,count:e.length-1}}function JZ(e,t){for(var r=Se.start(t),n=new Int32Array(e.length+1),a=0,i=e.length;a<i;a++)n[a]=e[a]-r;return n[e.length]=Se.end(t)-r,xB(n)}function e$(e){var t=e.count;return t}function t$(e,t){var r=e.index;return r[t]}function r$(e,t,r){var n=e.offsets,a=De.max(n),i=r>=a?-1:De.findPredecessorIndex(n,r-1);return De.findRange(t,De.getAt(n,i),De.getAt(n,i+1)-1)}var n$=function(){function e(t,r,n,a){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Se.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=a,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Se.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=De.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Se.start(this.setRange),this.value.end=r,this.setRange=Se.ofBounds(r,Se.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Se.min(this.setRange),r=Se.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[De.getAt(this.set,t)],this.segmentMax=this.segmentMap[De.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Se.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function a$(e,t,r){var n=typeof r!="undefined"?Se.ofBounds(r.start,r.end):Se.ofBounds(0,De.size(t));return new n$(e.offsets,e.index,t,n)}var qt;(function(e){e.create=xB,e.ofOffsets=JZ,e.count=e$,e.getSegment=t$,e.projectValue=r$,e.transientSegments=a$})(qt||(qt={}));function i$(e){return new o$(e)}var o$=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,a=r.next,i=n[t],o=a[t];i>=0&&(a[i]=o,n[t]=-1),o>=0&&(n[o]=i,a[t]=-1),t===this.head&&(i<0?this.head=o:this.head=i)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Do;(function(e){e.Empty=new Map;function t(o){return Cy(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function a(o){for(var s=r(),u=o.keys();;){var c=u.next(),l=c.done,f=c.value;if(l)break;s.set(f,o.get(f))}return s}e.copy=a;function i(o,s){for(var u=s.keys();;){var c=u.next(),l=c.done,f=c.value;if(l)break;o.set(f,s.get(f))}return o}e.addFrom=i})(Do||(Do={}));var s$=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),SB=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),u$=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),c$=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),l$=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),r1;(function(e){e.Empty=new SB(0,-1);function t(s){return new s$(s)}e.Array=t;function r(s){return new u$(s)}e.Value=r;function n(s,u){return new SB(s,u)}e.Range=n;function a(s,u){return new c$(s,u)}e.map=a;function i(s,u){return new l$(s,u)}e.filter=i;function o(s,u,c){for(;s.hasNext;){var l=u(s.move(),c);if(l)return c}return c}e.forEach=o})(r1||(r1={}));var f$={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},xs;(function(e){function t(r){var n=I(I({},f$),r),a=n.domain,i=n.reverse,o=n.listOrName,s=typeof o=="string"?Mu(o).list:o,u=i?s.slice().reverse():s,c=u.length-1,l=0,f=0,d=0;function m(_,w){f=_,d=w,l=d-f||1}m(a[0],a[1]);var p=jn(r.minLabel,f.toString()),v=jn(r.maxLabel,d.toString()),h,g=u.every(function(_){return Array.isArray(_)});if(g){var y=Ht([],u,!0);y.sort(function(_,w){return _[1]-w[1]});var b=y.map(function(_){return _[0]}),x=Le.ofSortedArray(y.map(function(_){return _[1]})),C=b.length-1;h=function(_){var w=Ra((_-f)/l,0,1),T=Le.findPredecessorIndex(x,w);if(T===0)return b[f];if(T>C)return b[C];var A=x[T-1],D=x[T],E=Ra((w-A)/(D-A),0,1);return st.interpolate(b[T-1],b[T],E)}}else h=function(_){var w=Math.min(u.length-1,Math.max(0,(_-f)/l*c)),T=Math.floor(w),A=u[T],D=u[Math.ceil(w)];return st.interpolate(A,D,w-T)};return{color:h,colorToArray:function(_,w,T){st.toArray(h(_),w,T)},normalizedColorToArray:function(_,w,T){st.toArrayNormalized(h(_),w,T)},setDomain:m,get legend(){return jQ(p,v,u)}}}e.create=t})(xs||(xs={}));function Km(e,t,r){for(var n=new Float32Array(e),a=0;a<n.length;a++)n[a]=t+r*a;return n}var jr;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,se.identity()),e.RotationTranslationEpsilon=.005;function t(v,h,g){var y=g||{},b=y.assembly,x=y.ncsId,C=y.hkl,_=y.spgrOp,w=C?S.clone(C):S();_=jn(_,-1),x=x||-1;var T=se.isIdentity(h),A=n(g,T);return T?{name:v,assembly:b,matrix:h,inverse:se.identity(),isIdentity:!0,hkl:w,spgrOp:_,ncsId:x,suffix:A}:(se.isRotationAndTranslation(h,e.RotationTranslationEpsilon)||console.warn("Symmetry operator (".concat(v,") should be a composition of rotation and translation.")),{name:v,assembly:b,matrix:h,inverse:se.invert(se(),h),isIdentity:!1,hkl:w,spgrOp:_,ncsId:x,suffix:A})}e.create=t;function r(v){return!!v&&!!v.matrix&&!!v.inverse&&typeof v.name=="string"}function n(v,h){if(!v)return"";if(v.assembly)return r(v)?v.suffix:h?"":"_".concat(v.assembly.operId);if(typeof v.spgrOp!="undefined"&&typeof v.hkl!="undefined"&&v.spgrOp!==-1){var g=v.hkl,y=g[0],b=g[1],x=g[2];return"-".concat(v.spgrOp+1,"_").concat(5+y).concat(5+b).concat(5+x)}return v.ncsId!==-1?"_".concat(v.ncsId):""}function a(v,h){for(var g=se.identity(),y=0;y<3;y++)for(var b=0;b<3;b++)se.setValue(g,y,b,dn.getValue(v,y,b));return se.setTranslation(g,h),se.isRotationAndTranslation(g,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=a;function i(v,h,g,y){for(var b=se.identity(),x=0;x<3;x++)for(var C=0;C<3;C++)se.setValue(b,x,C,dn.getValue(h,x,C));return se.setTranslation(b,g),t(v,b,{ncsId:y})}e.ofRotationAndOffset=i;var o=Gr.identity(),s=Gr(),u=Gr(),c=S();function l(v,h,g){var y=h.inverse;if(h.isIdentity)return se.copy(v,y);var b=1-g;se.getRotation(s,y),Gr.slerp(s,o,s,b);var x=Gr.getAxisAngle(c,s);return se.fromRotation(v,x,c),se.setValue(v,0,3,b*se.getValue(y,0,3)),se.setValue(v,1,3,b*se.getValue(y,1,3)),se.setValue(v,2,3,b*se.getValue(y,2,3)),v}e.lerpFromIdentity=l;function f(v,h,g,y){if(Math.abs(y)<=1e-5)return se.copy(v,h);if(Math.abs(y-1)<=1e-5)return se.copy(v,g);se.getRotation(s,h),se.getRotation(u,g),Gr.slerp(u,s,u,y);var b=Gr.getAxisAngle(c,u);return se.fromRotation(v,b,c),se.setValue(v,0,3,Xn(se.getValue(h,0,3),se.getValue(g,0,3),y)),se.setValue(v,1,3,Xn(se.getValue(h,1,3),se.getValue(g,1,3),y)),se.setValue(v,2,3,Xn(se.getValue(h,2,3),se.getValue(g,2,3),y)),v}e.slerp=f;function d(v,h){var g=se.mul(se(),h.matrix,v.matrix);return t(h.name,g,h)}e.compose=d;function m(v,h,g){var y=e.createCoordinateMapper(e.Default,h),b=v.isIdentity?y:e.createCoordinateMapper(v,h),x=m$(v,h),C=x.x,_=x.y,w=x.z;return{operator:v,coordinates:h,invariantPosition:y,position:b,x:C,y:_,z:w,r:g||d$}}e.createMapping=m;function p(v,h){return v.isIdentity?g$(h):y$(v,h)}e.createCoordinateMapper=p})(jr||(jr={}));function d$(e){return 0}function m$(e,t){return e.isIdentity?{x:h_(t.x),y:h_(t.y),z:h_(t.z)}:{x:p$(e,t),y:v$(e,t),z:h$(e,t)}}function h_(e){return function(r){return e[r]}}function n1(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function p$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[0],s=r[4],u=r[8],c=r[12];return n1(r)?function(f){return o*n[f]+s*a[f]+u*i[f]+c}:function(f){var d=n[f],m=a[f],p=i[f],v=r[3]*d+r[7]*m+r[11]*p+r[15]||1;return(o*d+s*m+u*p+c)/v}}function v$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[1],s=r[5],u=r[9],c=r[13];return n1(r)?function(f){return o*n[f]+s*a[f]+u*i[f]+c}:function(f){var d=n[f],m=a[f],p=i[f],v=r[3]*d+r[7]*m+r[11]*p+r[15]||1;return(o*d+s*m+u*p+c)/v}}function h$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z,o=r[2],s=r[6],u=r[10],c=r[14];return n1(r)?function(f){return o*n[f]+s*a[f]+u*i[f]+c}:function(f){var d=n[f],m=a[f],p=i[f],v=r[3]*d+r[7]*m+r[11]*p+r[15]||1;return(o*d+s*m+u*p+c)/v}}function g$(e){var t=e.x,r=e.y,n=e.z;return function(i,o){return o[0]=t[i],o[1]=r[i],o[2]=n[i],o}}function y$(e,t){var r=e.matrix,n=t.x,a=t.y,i=t.z;return n1(r)?function(s,u){var c=n[s],l=a[s],f=i[s];return u[0]=r[0]*c+r[4]*l+r[8]*f+r[12],u[1]=r[1]*c+r[5]*l+r[9]*f+r[13],u[2]=r[2]*c+r[6]*l+r[10]*f+r[14],u}:function(s,u){return u[0]=n[s],u[1]=a[s],u[2]=i[s],S.transformMat4(u,u,r),u}}var g_=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],b$=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],x$=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],Sh={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function S$(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function C$(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '".concat(e,"'"))}var CB=function(){for(var e=Object.create(null),t=0,r=Object.keys(Sh);t<r.length;t++){var n=r[t];e[Sh[n]]=n}return e}(),_$=function(){for(var e=Object.create(null),t=0,r=Object.keys(Sh);t<r.length;t++){var n=r[t],a=Sh[n];e[a]=C$(a)}return e}();function w$(e){var t=typeof e=="number"?S$(e):Sh[e];return typeof t=="undefined"||typeof CB[t]=="undefined"?-1:t}var pi;(function(e){e.Zero=r("P 1",S.create(1,1,1),S.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,a,i){var o=w$(n);if(o<0)return console.warn("Unknown spacegroup '".concat(n,"', returning a 'P 1' with cellsize [1, 1, 1]")),e.Zero;var s=a[0]*a[1]*a[2],u=i[0],c=i[1],l=i[2],f=a[0],d=a[1],m=a[2],p=Math.cos(c),v=(Math.cos(u)-Math.cos(c)*Math.cos(l))/Math.sin(l),h=Math.sqrt(1-p*p-v*v),g=[f,0,0],y=[Math.cos(l)*d,Math.sin(l)*d,0],b=[p*m,v*m,h*m],x=se.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),C=se.invert(se.zero(),x);return{index:o,size:a,volume:s,anglesInRadians:i,toFractional:C,fromFractional:x}}e.create=r})(pi||(pi={}));var Mo;(function(e){e.ZeroP1=t(pi.Zero);function t(h){var g=x$[h.index].map(function(x){return f(b$[x])}),y=CB[h.index],b=_$[h.index];return{name:y,num:b,cell:h,operators:g}}e.create=t;var r=S(),n=se();function a(h,g,y,b,x,C){return S.set(r,y,b,x),se.fromTranslation(n,r),se.mul(C,se.mul(C,se.mul(C,h.cell.fromFractional,n),h.operators[g]),h.cell.toFractional)}e.setOperatorMatrix=a;function i(h,g,y,b,x){var C=a(h,g,y,b,x,se.zero());return jr.create("".concat(g+1,"_").concat(5+y).concat(5+b).concat(5+x),C,{hkl:S.create(y,b,x),spgrOp:g})}e.getSymmetryOperator=i;var o=S(),s=S(),u=S(),c=S();function l(h,g,y,b,x,C){var _=se.zero();S.set(r,y,b,x),S.floor(o,C),se.copy(_,h.operators[g]),S.floor(s,S.transformMat4(s,C,_)),se.getTranslation(c,_),S.sub(c,c,s),S.add(c,c,o),S.add(c,c,r),se.setTranslation(_,c),se.mul(_,h.cell.fromFractional,_),se.mul(_,_,h.cell.toFractional),S.sub(u,s,o);var w=y-u[0],T=b-u[1],A=x-u[2];return jr.create("".concat(g+1,"_").concat(5+w).concat(5+T).concat(5+A),_,{hkl:S.create(w,T,A),spgrOp:g})}e.getSymmetryOperatorRef=l;function f(h){var g=g_[h[0]],y=g_[h[1]],b=g_[h[2]];return se.ofRows([g,y,b,[0,0,0,1]])}function d(h){return[v(m(h[0],h[4],h[8]),p(h[12])),v(m(h[1],h[5],h[9]),p(h[13])),v(m(h[2],h[6],h[10]),p(h[14]))].join(",")}e.getOperatorXyz=d;function m(h,g,y){var b=[];if(h>0?b.push("+X"):h<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var x=b[0].charAt(0),C=b[1].charAt(0);if(x==="+")return"".concat(b[0].substr(1)).concat(b[1]);if(C==="+")return"".concat(b[1].substr(1)).concat(b[0])}throw new Error("unknown rotation '".concat(b,"', ").concat(h," ").concat(g," ").concat(y))}function p(h){switch(h){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function v(h,g){return g===""?h:h.length>2?"".concat(h,"+").concat(g):h.charAt(0)==="-"?"".concat(g).concat(h):"".concat(g,"+").concat(h)}})(Mo||(Mo={}));var Cl;(function(e){function t(i,o,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=o}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function a(i,o){for(var s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}e.copy=a})(Cl||(Cl={}));function Xa(){return Xa.empty()}(function(e){function t(d,m,p,v){return{origin:d,dirA:m,dirB:p,dirC:v}}e.create=t;function r(){return{origin:S(),dirA:S(),dirB:S(),dirC:S()}}e.empty=r;function n(d,m){return S.copy(d.origin,m.origin),S.copy(d.dirA,m.dirA),S.copy(d.dirB,m.dirB),S.copy(d.dirC,m.dirC),d}e.copy=n;function a(d){return n(r(),d)}e.clone=a;function i(d,m){return S.set(d,S.magnitude(m.dirA)*2,S.magnitude(m.dirB)*2,S.magnitude(m.dirC)*2)}e.size=i;var o=S();function s(d){return i(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,m){return S.copy(d.origin,m.origin),S.normalize(d.dirA,m.dirA),S.normalize(d.dirB,m.dirB),S.normalize(d.dirC,m.dirC),d}e.normalize=u;var c=dn();function l(d,m,p){S.transformMat4(d.origin,m.origin,p);var v=dn.directionTransform(c,p);return S.transformMat3(d.dirA,m.dirA,v),S.transformMat3(d.dirB,m.dirB,v),S.transformMat3(d.dirC,m.dirC,v),d}e.transform=l;function f(d,m,p){return S.scale(d.dirA,m.dirA,p),S.scale(d.dirB,m.dirB,p),S.scale(d.dirC,m.dirC,p),d}e.scale=f})(Xa||(Xa={}));var Un;(function(e){function t(d,m,p){p===void 0&&(p=Float32Array);var v=d*m;return{data:new p(v),size:v,cols:d,rows:m}}e.create=t;function r(d,m,p){return d.data[d.rows*p+m]}e.get=r;function n(d,m,p,v){return d.data[d.rows*p+m]=v,d}e.set=n;function a(d,m,p,v){return d.data[d.rows*p+m]+=v,d}e.add=a;function i(d){return d.data.fill(0),d}e.makeZero=i;function o(d){return{data:d.data.slice(),size:d.size,cols:d.cols,rows:d.rows}}e.clone=o;function s(d,m,p){return{data:d,size:m*p,cols:m,rows:p}}e.fromArray=s;function u(d,m){if(d.cols!==m.rows||d.rows!==m.cols)throw new Error("transpose: matrix dimensions incompatible");if(d.data===m.data)throw new Error("transpose: matrices share memory");for(var p=m.rows,v=m.cols,h=m.data,g=d.data,y=0,b=0,x=0;y<p;x+=1,b+=v,++y)for(var C=x,_=0;_<v;C+=p,_++)g[C]=h[b+_];return d}e.transpose=u;function c(d,m,p){for(var v=m.cols,h=m.rows,g=p.rows,y=m.data,b=p.data,x=d.data,C=0,_=0,w=0;C<h;_+=v,C++)for(var T=0,A=0;A<g;w++,A++){for(var D=0,E=_,M=0;M<v;E++,T++,M++)D+=y[E]*b[T];x[w]=D}return d}e.multiplyABt=c;function l(d){for(var m=d.rows,p=d.cols,v=d.data,h=new Array(p),g=0;g<p;++g)h[g]=0;for(var y=0,b=0;y<m;++y)for(var g=0;g<p;++g,++b)h[g]+=v[b];for(var g=0;g<p;++g)h[g]/=m;return h}e.meanRows=l;function f(d,m){for(var p=d.rows,v=d.cols,h=d.data,g=0,y=0;g<p;++g)for(var b=0;b<v;++b,++y)h[y]-=m[b];return d}e.subRows=f})(Un||(Un={}));function y_(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function A$(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var T$=1192092896e-16,P$=1e-37;function E$(e,t,r,n,a,i,o,s){for(var u=T$*2,c=P$,l=0,f=0,d=0,m=0,p=Math.max(i,30),v=0,h=0,g=0,y=0,b=0,x=0,C=0,_=0,w=0,T=0,A=0,D=0,E=0,M=0,F=0,O=0,U=0,N=4660,q=0,j=0,Q=0,J=new Float64Array(o<<3);l<o;l++){for(d=0,A=0;d<i;d++)_=e[l*t+d],A+=_*_;if(J[l]=A,n){for(d=0;d<o;d++)n[l*a+d]=0;n[l*a+l]=1}}for(;m<p;m++){for(b=0,l=0;l<o-1;l++)for(f=l+1;f<o;f++){for(v=l*t|0,h=f*t|0,F=J[l],O=0,U=J[f],d=2,O+=e[v]*e[h],O+=e[v+1]*e[h+1];d<i;d++)O+=e[v+d]*e[h+d];if(!(Math.abs(O)<=u*Math.sqrt(F*U))){for(O*=2,D=F-U,E=A$(O,D),D<0?(M=(E-D)*.5,C=Math.sqrt(M/E),x=O/(E*C*2)):(x=Math.sqrt((E+D)/(E*2)),C=O/(E*x*2)),F=0,U=0,d=2,w=x*e[v]+C*e[h],T=-C*e[v]+x*e[h],e[v]=w,e[h]=T,F+=w*w,U+=T*T,w=x*e[v+1]+C*e[h+1],T=-C*e[v+1]+x*e[h+1],e[v+1]=w,e[h+1]=T,F+=w*w,U+=T*T;d<i;d++)w=x*e[v+d]+C*e[h+d],T=-C*e[v+d]+x*e[h+d],e[v+d]=w,e[h+d]=T,F+=w*w,U+=T*T;if(J[l]=F,J[f]=U,b=1,n)for(g=l*a|0,y=f*a|0,d=2,w=x*n[g]+C*n[y],T=-C*n[g]+x*n[y],n[g]=w,n[y]=T,w=x*n[g+1]+C*n[y+1],T=-C*n[g+1]+x*n[y+1],n[g+1]=w,n[y+1]=T;d<o;d++)w=x*n[g+d]+C*n[y+d],T=-C*n[g+d]+x*n[y+d],n[g+d]=w,n[y+d]=T}}if(b===0)break}for(l=0;l<o;l++){for(d=0,A=0;d<i;d++)_=e[l*t+d],A+=_*_;J[l]=Math.sqrt(A)}for(l=0;l<o-1;l++){for(f=l,d=l+1;d<o;d++)J[f]<J[d]&&(f=d);if(l!==f&&(y_(J,l,f,A),n)){for(d=0;d<i;d++)y_(e,l*t+d,f*t+d,_);for(d=0;d<o;d++)y_(n,l*a+d,f*a+d,_)}}for(l=0;l<o;l++)r[l]=J[l];if(!!n)for(l=0;l<s;l++){for(A=l<o?J[l]:0;A<=c;){for(j=1/i,d=0;d<i;d++)N=N*214013+2531011,q=(N>>16&32767&256)!=0?j:-j,e[l*t+d]=q;for(m=0;m<2;m++)for(f=0;f<l;f++){for(A=0,d=0;d<i;d++)A+=e[l*t+d]*e[f*t+d];for(Q=0,d=0;d<i;d++)_=e[l*t+d]-A*e[f*t+d],e[l*t+d]=_,Q+=Math.abs(_);for(Q=Q?1/Q:0,d=0;d<i;d++)e[l*t+d]*=Q}for(A=0,d=0;d<i;d++)_=e[l*t+d],A+=_*_;A=Math.sqrt(A)}for(C=1/A,d=0;d<i;d++)e[l*t+d]*=C}}function I$(e,t,r,n){var a=0,i=0,o=e.rows,s=e.cols,u=o,c=s;u<c&&(a=1,i=u,u=c,c=i);var l=Un.create(u,u),f=Un.create(1,c),d=Un.create(c,c);if(a===0)Un.transpose(l,e);else{for(i=0;i<s*o;i++)l.data[i]=e.data[i];for(;i<c*u;i++)l.data[i]=0}if(E$(l.data,u,f.data,d.data,c,u,c,u),t){for(i=0;i<c;i++)t.data[i]=f.data[i];for(;i<s;i++)t.data[i]=0}a===0?(r&&Un.transpose(r,l),n&&Un.transpose(n,d)):(r&&Un.transpose(r,d),n&&Un.transpose(n,l))}var _l;(function(e){function t(u){var c=r(u),l=s(u,c);return{momentsAxes:c,boxAxes:l}}e.ofPositions=t;function r(u){if(u.length===3)return Xa.create(S.fromArray(S(),u,0),S.create(1,0,0),S.create(0,1,0),S.create(0,1,0));var c=Un.fromArray(u,3,u.length/3),l=c.rows,f=l/3,d=Un.create(3,3),m=Un.create(1,3),p=Un.create(3,3),v=Un.create(3,3),h=Un.meanRows(c),g=Un.subRows(Un.clone(c),h),y=Un.transpose(Un.create(l,3),g);Un.multiplyABt(d,y,y),I$(d,m,p,v);var b=S.create(h[0],h[1],h[2]),x=S.create(p.data[0],p.data[3],p.data[6]),C=S.create(p.data[1],p.data[4],p.data[7]),_=S.create(p.data[2],p.data[5],p.data[8]);return S.scale(x,x,Math.sqrt(m.data[0]/f)),S.scale(C,C,Math.sqrt(m.data[1]/f)),S.scale(_,_,Math.sqrt(m.data[2]/f)),Xa.create(b,x,C,_)}e.calculateMomentsAxes=r;var n=S(),a=S(),i=S(),o=S();function s(u,c){if(u.length===3)return Xa.clone(c);for(var l=-1/0,f=-1/0,d=-1/0,m=-1/0,p=-1/0,v=-1/0,h=S(),g=S(),y=c.origin,b=S.normalize(a,c.dirA),x=S.normalize(i,c.dirB),C=S.normalize(o,c.dirC),_=0,w=u.length;_<w;_+=3){S.projectPointOnVector(h,S.fromArray(h,u,_),b,y);var T=S.dot(b,S.normalize(g,S.sub(g,h,y))),A=S.distance(h,y);T>0?A>l&&(l=A):A>f&&(f=A),S.projectPointOnVector(h,S.fromArray(h,u,_),x,y);var D=S.dot(x,S.normalize(g,S.sub(g,h,y))),E=S.distance(h,y);D>0?E>d&&(d=E):E>m&&(m=E),S.projectPointOnVector(h,S.fromArray(h,u,_),C,y);var M=S.dot(C,S.normalize(g,S.sub(g,h,y))),F=S.distance(h,y);M>0?F>p&&(p=F):F>v&&(v=F)}var O=S.setMagnitude(S(),b,(l+f)/2),U=S.setMagnitude(S(),x,(d+m)/2),N=S.setMagnitude(S(),C,(p+v)/2),q=S(),j=function(Q,J,te){S.copy(n,y),S.scaleAndAdd(n,n,b,Q),S.scaleAndAdd(n,n,x,J),S.scaleAndAdd(n,n,C,te),S.add(q,q,n)};return j(l,d,p),j(l,d,-v),j(l,-m,-v),j(l,-m,p),j(-f,-m,-v),j(-f,-m,p),j(-f,d,p),j(-f,d,-v),S.scale(q,q,1/8),Xa.create(q,O,U,N)}e.calculateBoxAxes=s})(_l||(_l={}));function Te(){return Te.zero()}(function(e){function t(E){return E.extrema!==void 0}e.hasExtrema=t;function r(E,M){return{center:E,radius:M}}e.create=r;function n(){return{center:S(),radius:0}}e.zero=n;function a(E){var M=r(S.clone(E.center),E.radius);return t(E)&&(M.extrema=E.extrema.map(function(F){return S.clone(F)})),M}e.clone=a;function i(E,M,F){return S.copy(E.center,M),E.radius=F,E}e.set=i;function o(E,M){return S.copy(E.center,M.center),E.radius=M.radius,t(M)&&s(E,M.extrema.map(function(F){return S.clone(F)})),E}e.copy=o;function s(E,M){var F;return E.extrema!==void 0?(E.extrema.length=0,(F=E.extrema).push.apply(F,M)):E.extrema=M,E}e.setExtrema=s;function u(E){for(var M=E.x,F=E.y,O=E.z,U=E.indices,N=0,q=0,j=0,Q=0,J=De.size(U),te=0;te<J;te++){var K=De.getAt(U,te);N+=M[K],q+=F[K],j+=O[K]}J>0&&(N/=J,q/=J,j/=J);for(var te=0;te<J;te++){var K=De.getAt(U,te),L=M[K]-N,W=F[K]-q,k=O[K]-j,V=L*L+W*W+k*k;V>Q&&(Q=V)}return{center:S.create(N,q,j),radius:Math.sqrt(Q)}}e.computeBounding=u;function c(E,M,F){return S.transformMat4(E.center,M.center,F),E.radius=M.radius*se.getMaxScaleOnAxis(F),t(M)&&s(E,M.extrema.map(function(O){return S.transformMat4(S(),O,F)})),E}e.transform=c;function l(E,M,F){return S.add(E.center,M.center,F),t(M)&&s(E,M.extrema.map(function(O){return S.add(S(),O,F)})),E}e.translate=l;function f(E,M,F){S.toArray(E.center,M,F),M[F+3]=E.radius}e.toArray=f;function d(E,M,F){return S.fromArray(E.center,M,F),E.radius=M[F+3],E}e.fromArray=d;function m(E,M){return S.scale(E.center,S.add(E.center,M.max,M.min),.5),E.radius=S.distance(E.center,M.max),e.setExtrema(E,[S.create(M.min[0],M.min[1],M.min[2]),S.create(M.max[0],M.max[1],M.max[2]),S.create(M.max[0],M.min[1],M.min[2]),S.create(M.min[0],M.max[1],M.max[2]),S.create(M.min[0],M.min[1],M.max[2]),S.create(M.max[0],M.min[1],M.max[2]),S.create(M.max[0],M.max[1],M.min[2]),S.create(M.min[0],M.max[1],M.min[2])]),E}e.fromBox3D=m;function p(E,M){return S.copy(E.center,M.origin),E.radius=Math.max(S.magnitude(M.dirA),S.magnitude(M.dirB),S.magnitude(M.dirC)),E}e.fromAxes3D=p;var v=S();function h(E,M,F){var O=M[0],U=M[1],N=M[2],q=S.create(0,0,0);S.transformMat4(q,q,F);var j=S.create(O,U,N);S.transformMat4(j,j,F);var Q=S.create(O,0,0);S.transformMat4(Q,Q,F);var J=S.create(0,U,N);S.transformMat4(J,J,F);var te=S.create(0,0,N);S.transformMat4(te,te,F);var K=S.create(O,0,N);S.transformMat4(K,K,F);var L=S.create(O,U,0);S.transformMat4(L,L,F);var W=S.create(0,U,0);S.transformMat4(W,W,F),S.add(v,q,j),S.scale(v,v,.5);var k=Math.max(S.distance(q,j),S.distance(Q,J));return e.set(E,v,k/2),e.setExtrema(E,[q,j,Q,J,te,K,L,W]),E}e.fromDimensionsAndTransform=h;var g=S();function y(E,M,F){var O=S.distance(M.center,F);return O<M.radius?e.copy(E,M):(S.sub(g,M.center,F),S.sub(g,M.center,g),S.setMagnitude(g,g,M.radius),S.scale(E.center,S.add(g,g,F),.5),E.radius=S.distance(E.center,F),E)}e.addVec3=y;function b(E,M,F){return S.copy(E.center,M.center),E.radius=Math.max(M.radius,S.distance(M.center,F.center)+F.radius),t(M)&&t(F)&&s(E,Ht(Ht([],M.extrema.map(function(O){return S.clone(O)}),!0),F.extrema.map(function(O){return S.clone(O)}),!0)),E}e.expandBySphere=b;var x=S();function C(E,M,F){var O,U;if(S.copy(E.center,M.center),E.radius=M.radius+F,M.radius<1e-12||((U=(O=M.extrema)===null||O===void 0?void 0:O.length)!==null&&U!==void 0?U:0)<=1)return E.extrema=void 0,E;if(t(M)){for(var N=new Float32Array(M.extrema.length*3),q=0;q<M.extrema.length;q++)S.toArray(M.extrema[q],N,q*3);var j=_l.calculateMomentsAxes(N);Xa.scale(j,Xa.normalize(j,j),F),s(E,M.extrema.map(function(Q){S.sub(x,Q,M.center);var J=S.clone(Q),te=S.dot(x,j.dirA)<0?-1:1;S.scaleAndAdd(J,J,j.dirA,te);var K=S.dot(x,j.dirB)<0?-1:1;S.scaleAndAdd(J,J,j.dirB,K);var L=S.dot(x,j.dirC)<0?-1:1;return S.scaleAndAdd(J,J,j.dirC,L),J}))}return E}e.expand=C;function _(E,M){return E.radius===M.radius&&S.exactEquals(E.center,M.center)}e.exactEquals=_;function w(E,M){var F=E.radius,O=M.radius;return Math.abs(F-O)<=Ir*Math.max(1,Math.abs(F),Math.abs(O))&&S.equals(E.center,M.center)}e.equals=w;function T(E,M){if(t(M)){for(var F=0,O=M.extrema;F<O.length;F++){var U=O[F];if(S.distance(E.center,U)>E.radius)return!1}return!0}else return S.distance(E.center,M.center)+M.radius<=E.radius}e.includes=T;function A(E,M){return S.distance(E.center,M.center)<=E.radius+M.radius}e.overlaps=A;function D(E,M){return S.distance(E.center,M.center)-E.radius+M.radius}e.distance=D})(Te||(Te={}));function Bt(){return Bt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:S(),max:S()}}e.zero=r;function n(y,b){return S.copy(y.min,b.min),S.copy(y.max,b.max),y}e.copy=n;function a(y){return n(r(),y)}e.clone=a;function i(y,b){if(Te.hasExtrema(b))return o(y,b.extrema);var x=S.create(b.radius,b.radius,b.radius);return S.sub(y.min,b.center,x),S.add(y.max,b.center,x),y}e.fromSphere3D=i;function o(y,b){e.setEmpty(y);for(var x=0,C=b.length;x<C;x++)e.add(y,b[x]);return y}e.fromVec3Array=o;function s(y){for(var b=S.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=S.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),C=y.x,_=y.y,w=y.z,T=y.indices,A=0,D=De.size(T);A<D;A++){var E=De.getAt(T,A);b[0]=Math.min(C[E],b[0]),b[1]=Math.min(_[E],b[1]),b[2]=Math.min(w[E],b[2]),x[0]=Math.max(C[E],x[0]),x[1]=Math.max(_[E],x[1]),x[2]=Math.max(w[E],x[2])}return{min:b,max:x}}e.computeBounding=s;function u(y,b){return S.sub(y,b.max,b.min)}e.size=u;var c=S();function l(y){return u(c,y),c[0]*c[1]*c[2]}e.volume=l;function f(y){return S.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=f;function d(y,b){return S.min(y.min,y.min,b),S.max(y.max,y.max,b),y}e.add=d;function m(y,b,x){return S.sub(y.min,b.min,x),S.add(y.max,b.max,x),y}e.expand=m;function p(y,b,x){return S.scale(y.min,b.min,x),S.scale(y.max,b.max,x),y}e.scale=p;var v=S();function h(y,b,x){var C=b.min,_=C[0],w=C[1],T=C[2],A=b.max,D=A[0],E=A[1],M=A[2];return f(y),d(y,S.transformMat4(v,S.set(v,_,w,T),x)),d(y,S.transformMat4(v,S.set(v,_,w,M),x)),d(y,S.transformMat4(v,S.set(v,_,E,T),x)),d(y,S.transformMat4(v,S.set(v,_,E,M),x)),d(y,S.transformMat4(v,S.set(v,D,w,T),x)),d(y,S.transformMat4(v,S.set(v,D,w,M),x)),d(y,S.transformMat4(v,S.set(v,D,E,T),x)),d(y,S.transformMat4(v,S.set(v,D,E,M),x)),y}e.transform=h;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Bt||(Bt={}));function jf(e,t,r){return new D$(e,t,r)}var D$=function(){function e(t,r,n){var a=R$(t,r,n);this.ctx=B$(a),this.boundary={box:a.boundingBox,sphere:a.boundingSphere},this.buckets={offset:a.bucketOffset,count:a.bucketCounts,array:a.bucketArray},this.result=Cl.create()}return e.prototype.find=function(t,r,n,a,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!1;var o=i!=null?i:this.result;return _B(this.ctx,o),o},e.prototype.check=function(t,r,n,a){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=a,this.ctx.isCheck=!0,_B(this.ctx,this.result)},e}();function M$(e){for(var t=e.expandedBox,r=e.size,n=r[0],a=r[1],i=r[2],o=e.data,s=o.x,u=o.y,c=o.z,l=o.radius,f=o.indices,d=e.elementCount,m=e.delta,p=n*a*i,v=t.min,h=v[0],g=v[1],y=v[2],b=0,x=0,C=new Uint32Array(p),_=new Int32Array(d),w=0;w<d;w++){var T=De.getAt(f,w),A=Math.floor((s[T]-h)/m[0]),D=Math.floor((u[T]-g)/m[1]),E=Math.floor((c[T]-y)/m[2]),M=(A*a+D)*i+E;(C[M]+=1)===1&&(x+=1),_[w]=M}if(l)for(var w=0;w<d;w++){var T=De.getAt(f,w);l[T]>b&&(b=l[T])}for(var F=new Int32Array(x),T=0,O=0;T<p;T++){var U=C[T];U>0&&(C[T]=O+1,F[O]=U,O+=1)}for(var N=new Uint32Array(x),T=1;T<x;++T)N[T]+=N[T-1]+F[T-1];for(var q=new Int32Array(x),j=new Int32Array(d),T=0;T<d;T++){var Q=C[_[T]];if(Q>0){var J=Q-1;j[N[J]+q[J]]=T,q[J]+=1}}return{size:e.size,bucketArray:j,bucketCounts:F,bucketOffset:N,grid:C,delta:m,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function R$(e,t,r){var n=Bt.expand(Bt(),t.box,S.create(.5,.5,.5)),a=e.indices,i=Bt.size(S.zero(),n),o,s,u=De.size(a),c=typeof r=="number"?r:32,l=Array.isArray(r)&&r;if(l)s=[Math.ceil(i[0]/l[0]),Math.ceil(i[1]/l[1]),Math.ceil(i[2]/l[2])],o=l;else if(u>0){var f=Math.ceil(u/c),d=Math.pow(f/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*d),Math.ceil(i[1]*d),Math.ceil(i[2]*d)],o=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else o=i,s=[1,1,1];var m={x:e.x,y:e.y,z:e.z,indices:a,radius:e.radius},p={size:s,data:m,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return M$(p)}function B$(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function _B(e,t){var r=e.grid,n=r.min,a=r.size,i=a[0],o=a[1],s=a[2],u=r.bucketOffset,c=r.bucketCounts,l=r.bucketArray,f=r.grid,d=r.data,m=d.x,p=d.y,v=d.z,h=d.indices,g=d.radius,y=r.delta,b=r.maxRadius,x=e.radius,C=e.isCheck,_=e.x,w=e.y,T=e.z,A=x+b,D=A*A;Cl.reset(t);var E=Math.max(0,Math.floor((_-A-n[0])/y[0])),M=Math.max(0,Math.floor((w-A-n[1])/y[1])),F=Math.max(0,Math.floor((T-A-n[2])/y[2])),O=Math.min(i-1,Math.floor((_+A-n[0])/y[0])),U=Math.min(o-1,Math.floor((w+A-n[1])/y[1])),N=Math.min(s-1,Math.floor((T+A-n[2])/y[2]));if(E>O||M>U||F>N)return!1;for(var q=E;q<=O;q++)for(var j=M;j<=U;j++)for(var Q=F;Q<=N;Q++){var J=f[(q*o+j)*s+Q];if(J!==0)for(var te=J-1,K=u[te],L=c[te],W=K+L,k=K;k<W;k++){var V=De.getAt(h,l[k]),G=m[V]-_,H=p[V]-w,X=v[V]-T,Y=G*G+H*H+X*X;if(Y<=D){if(b>0&&Math.sqrt(Y)-g[V]>x)continue;if(C)return!0;Cl.add(t,l[k],Y)}}}return t.count>0}function F$(e,t){for(var r=0,n=t*3;r<n;r+=3){var a=e[r],i=e[r+1],o=e[r+2],s=1/Math.sqrt(a*a+i*i+o*o);e[r]=a*s,e[r+1]=i*s,e[r+2]=o*s}return e}var Ri=S();function Wf(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)S.fromArray(Ri,t,r+a),S.transformMat4(Ri,Ri,e),S.toArray(Ri,t,r+a)}function O$(e,t,r,n){for(var a=0,i=n*3;a<i;a+=3)S.fromArray(Ri,t,r+a),S.transformMat3(Ri,Ri,e),S.toArray(Ri,t,r+a)}function k$(e,t){for(var r=0,n=e.length;r<n;r+=3)S.fromArray(Ri,e,r),S.normalize(Ri,Ri),S.scale(Ri,Ri,t),S.toArray(Ri,e,r)}var wB=S(),b_=S(),AB=S(),Ro=S(),TB=S();function PB(e,t,r,n,a){for(var i=0,o=a*3;i<o;i+=3){var s=t[i]*3,u=t[i+1]*3,c=t[i+2]*3;S.fromArray(wB,e,s),S.fromArray(b_,e,u),S.fromArray(AB,e,c),S.sub(Ro,AB,b_),S.sub(TB,wB,b_),S.cross(Ro,Ro,TB),r[s]+=Ro[0],r[s+1]+=Ro[1],r[s+2]+=Ro[2],r[u]+=Ro[0],r[u+1]+=Ro[1],r[u+2]+=Ro[2],r[c]+=Ro[0],r[c+1]+=Ro[1],r[c+2]+=Ro[2]}return F$(r,n)}function Qm(e,t,r){r===void 0&&(r=1);for(var n=js(e),a=new Int32Array(n+2),i=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var c=0,s=0;s<t;s++)a[s]=c,c+=o[s];a[t]=c;for(var l=new Int32Array(c),s=0,u=t*r;s<u;s+=r){var f=e[s],d=a[f]+i[f];l[d]=s,++i[f]}return{indices:l,offsets:a}}var Xf=function(){function e(){this.count=0,this.center=S(),this.radiusSq=0}return e.prototype.reset=function(){S.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){S.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&S.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=S.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=S.distance(t,this.center)+r,a=n*n;a>this.radiusSq&&(this.radiusSq=a)},e.prototype.getSphere=function(t){return t||(t=Te()),S.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=S(),n=S();function a(s,u){var c=s.x,l=s.y,f=s.z;t.reset();for(var d=c.length,m=0;m<d;m++)S.set(r,c[m],l[m],f[m]),t.includeStep(r);t.finishedIncludeStep();for(var m=0;m<d;m++)S.set(r,c[m],l[m],f[m]),t.radiusStep(r);return S.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=a;function i(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r),t.includeStep(r);t.finishedIncludeStep();for(var l=0;l<s;l++)u(l,r),t.radiusStep(r);return S.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}e.fromProvider=i;function o(s,u,c){t.reset();for(var l=0;l<s;l++)u(l,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var l=0;l<s;l++)u(l,r,n),t.radiusStep(r),t.radiusStep(n);return S.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}e.fromPairProvider=o})(Xf||(Xf={}));var Ji=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Xf,this.dir=L$(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=S.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,S.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,S.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var a=S.dot(this.dir[t],r);a-n<this.minDist[t]&&(this.minDist[t]=a-n,S.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),a+n>this.maxDist[t]&&(this.maxDist[t]=a+n,S.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Te.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.includePosition(a)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,a=this.dir.length;n<a;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Te.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var a=n[r];this.radiusPosition(a)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Te.setExtrema(this.centroidHelper.getSphere(t),Ht([],this.extrema,!0))},e.prototype.getBox=function(t){return Bt.fromVec3Array(t||Bt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=S(),this.extrema[t*2+1]=S();this.centroidHelper.reset()},e}();function L$(e){var t;switch(e){case"6":t=Ht([],a1,!0);break;case"14":t=Ht(Ht([],a1,!0),x_,!0);break;case"26":t=Ht(Ht(Ht([],a1,!0),x_,!0),EB,!0);break;case"98":t=Ht(Ht(Ht(Ht(Ht(Ht([],a1,!0),x_,!0),EB,!0),N$,!0),U$,!0),z$,!0);break}return t.map(function(r){var n=S.create(r[0],r[1],r[2]);return S.normalize(n,n)})}var a1=[[1,0,0],[0,1,0],[0,0,1]],x_=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],EB=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],N$=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],U$=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],z$=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];function V$(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var a=n>0?Math.ceil(e/n):0;return{width:n,height:a,length:n*a*t}}function Yn(e,t,r,n){var a=V$(e,t),i=a.length,o=a.width,s=a.height;return n=n&&n.length>=i?n:new r(i),{array:n,width:o,height:s}}var Bo=S(),G$=new Ji("14"),H$=new Ji("98");function IB(e){return e>1e5?G$:H$}function wl(e,t,r){var n=r*3,a=IB(t);a.reset();for(var i=0,o=t*3;i<o;i+=n)S.fromArray(Bo,e,i),a.includePosition(Bo);a.finishedIncludeStep();for(var i=0,o=t*3;i<o;i+=n)S.fromArray(Bo,e,i),a.radiusPosition(Bo);var s=a.getSphere();if(t<=98){for(var u=[],i=0,o=t*3;i<o;i+=n)u.push(S.fromArray(S(),e,i));Te.setExtrema(s,u)}return s}var S_=se();function sa(e,t,r){if(r===1){se.fromArray(S_,t,0);var n=Te.clone(e);return se.isIdentity(S_)?n:Te.transform(n,n,S_)}var a=IB(r);a.reset();var i=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,c=r;u<c;++u)for(var l=0,f=s;l<f.length;l++){var d=f[l];S.transformMat4Offset(Bo,d,t,0,0,u*16),a.includePosition(Bo)}a.finishedIncludeStep();for(var u=0,c=r;u<c;++u)for(var m=0,p=s;m<p.length;m++){var d=p[m];S.transformMat4Offset(Bo,d,t,0,0,u*16),a.radiusPosition(Bo)}}else{for(var u=0,c=r;u<c;++u)S.transformMat4Offset(Bo,i,t,0,0,u*16),a.includePositionRadius(Bo,o);a.finishedIncludeStep();for(var u=0,c=r;u<c;++u)S.transformMat4Offset(Bo,i,t,0,0,u*16),a.radiusPositionRadius(Bo,o)}return a.getSphere()}var Oa=new Uint8Array(771+1);Oa[1]=1;Oa[2]=1;Oa[3]=1;Oa[256]=1;Oa[512]=1;Oa[768]=1;Oa[257]=2;Oa[513]=2;Oa[769]=2;Oa[258]=2;Oa[514]=2;Oa[770]=2;Oa[259]=2;Oa[515]=2;Oa[771]=2;function DB(e,t){if(t===0)return 0;var r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,a=4*n,i=0;if(n<0)for(var o=0;o<t;++o)i+=e[o]&&1;else{for(var o=0;o<n;++o){var s=r[o];i+=Oa[s&65535]+Oa[s>>16]}for(var o=a;o<t;++o)i+=e[o]&&1}return i/t}function Fo(e,t){var r=Yn(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array),n=DB(r.array,e),a=n===0?0:-1;return t?(R.updateIfChanged(t.uMarker,0),R.update(t.tMarker,r),R.update(t.uMarkerTexDim,Fe.create(r.width,r.height)),R.updateIfChanged(t.markerAverage,n),R.updateIfChanged(t.markerStatus,a),t):{uMarker:R.create(0),tMarker:R.create(r),uMarkerTexDim:R.create(Fe.create(r.width,r.height)),markerAverage:R.create(n),markerStatus:R.create(a)}}var eo={kind:"null-location"};function MB(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Wr(e,t,r,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=function(){return!1}),e%r!=0)throw new Error("incompatible groupCount and stride");var o={location:eo,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,c=0,l=0,f=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:a,move:function(){return s&&(o.groupIndex=c,o.instanceIndex=l,o.index=l*e+c,o.location=n(c,f?-1:l),o.isSecondary=i(c,f?-1:l),c+=r,c===e?(++l,u=!0,l<t&&(c=0)):u=!1,s=c<e),o},reset:function(){o.location=eo,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,c=0,l=0,f=!1},skipInstance:function(){s&&o.instanceIndex===l&&(++l,c=0,s=l<t)},voidInstances:function(){f=!0}}}function Yf(e){return{kind:"position-location",position:e?S.clone(e):S()}}function Ch(e,t,r){return e=Ra(Math.round(e),0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function C_(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var i1=255/256,__=S.create(256*256*256,256*256,256),q$=Wt.create(i1/__[0],i1/__[1],i1/__[2],i1/1),RB=Wt();function j$(e,t,r,n){return Wt.set(RB,e/255,t/255,r/255,n/255),Wt.dot(RB,q$)}function Hu(e,t,r){switch(ya.getGranularity(e,t.granularity)){case"uniform":return K$(e,t.size,r);case"group":return Z$(e,t.size,r);case"groupInstance":return $$(e,t.size,r);case"instance":return Q$(e,t.size,r)}}var o1=100;function _h(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,a=0,i=n.length;a<i;a+=3){var o=C_(n[a],n[a+1],n[a+2]);r<o&&(r=o)}return r/o1}}var W$={array:new Uint8Array(3),width:1,height:1};function X$(){return{tSize:R.create(W$),uSizeTexDim:R.create(Fe.create(1,1))}}function Y$(e,t){return t?(R.update(t.uSize,e),R.updateIfChanged(t.dSizeType,"uniform"),t):I(I({uSize:R.create(e)},X$()),{dSizeType:R.create("uniform")})}function K$(e,t,r){return Y$(t(eo),r)}function w_(e,t,r){return r?(R.update(r.tSize,e),R.update(r.uSizeTexDim,Fe.create(e.width,e.height)),R.updateIfChanged(r.dSizeType,t),r):{uSize:R.create(0),tSize:R.create(e),uSizeTexDim:R.create(Fe.create(e.width,e.height)),dSizeType:R.create(t)}}function Q$(e,t,r){var n=e.instanceCount,a=Yn(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Ch(t(i.location)*o1,a.array,i.instanceIndex*3),e.skipInstance()}return w_(a,"instance",r)}function Z$(e,t,r){var n=e.groupCount,a=Yn(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move();Ch(t(i.location)*o1,a.array,i.groupIndex*3)}return w_(a,"group",r)}function $$(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Yn(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();Ch(t(s.location)*o1,o.array,s.index*3)}return w_(o,"groupInstance",r)}var BB=dn(),J$=se();function eJ(e,t){for(var r=0;r<t;r++)if(dn.fromMat4(BB,se.fromArray(J$,e,r*16)),dn.determinant(BB)<0)return!0;return!1}function A_(e,t,r){var n=eJ(e,t);if(r){R.update(r.matrix,r.matrix.ref.value);var a=r.transform.ref.value.length>=t*16?r.transform.ref.value:new Float32Array(t*16);a.set(e),R.update(r.transform,a),R.updateIfChanged(r.uInstanceCount,t),R.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);R.update(r.aTransform,i);var o=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);R.update(r.extraTransform,s1(o,t));var s=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);R.update(r.aInstance,Po(s,t)),R.update(r.hasReflection,n)}else r={aTransform:R.create(new Float32Array(t*16)),matrix:R.create(se.identity()),transform:R.create(new Float32Array(e)),extraTransform:R.create(s1(new Float32Array(t*16),t)),uInstanceCount:R.create(t),instanceCount:R.create(t),aInstance:R.create(Po(new Float32Array(t))),hasReflection:R.create(n)};return FB(r),r}var T_=new Float32Array(16);se.toArray(se.identity(),T_,0);function P_(e){return A_(new Float32Array(T_),1,e)}function s1(e,t){for(var r=0;r<t;r++)e.set(T_,r*16);return e}function FB(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,a=e.transform.ref.value,i=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;se.mulOffset(t,i,a,s,s,s),se.mulOffset(t,n,t,s,0,s)}R.update(e.aTransform,t)}var OB=st(13421772),tJ="Gives everything the same, uniform color.",E_={value:P.Color(OB)};function rJ(e){return E_}function u1(e,t){var r=jn(t.value,OB);return{factory:u1,granularity:"uniform",color:function(){return r},props:t,description:tJ,legend:xl([["uniform",r]])}}var nJ={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:u1,getParams:rJ,defaultValues:P.getDefaultValues(E_),isApplicable:function(e){return!0}},aJ="Gives everything the same, uniform size.",kB={value:P.Numeric(1,{min:0,max:20,step:.1})};function iJ(e){return kB}function I_(e,t){var r=t.value;return{factory:I_,granularity:"uniform",size:function(){return r},props:t,description:aJ}}var oJ={name:"uniform",label:"Uniform",category:"",factory:I_,getParams:iJ,defaultValues:P.getDefaultValues(kB),isApplicable:function(e){return!0}};function Ya(e){return I(I({},Ya.Zero),e)}(function(e){e.Zero={metalness:0,roughness:0,bumpiness:0};function t(a,i,o){return i[o]=a.metalness*255,i[o+1]=a.roughness*255,i[o+2]=a.bumpiness*255,i}e.toArray=t;function r(a){var i=a.metalness,o=a.roughness,s=a.bumpiness;return"M ".concat(i.toFixed(2)," | R ").concat(o.toFixed(2)," | B ").concat(s.toFixed(2))}e.toString=r;function n(a){return P.Group({metalness:P.Numeric(0,{min:0,max:1,step:.01}),roughness:P.Numeric(1,{min:0,max:1,step:.01}),bumpiness:P.Numeric(0,{min:0,max:1,step:.01})},I(I({},a),{presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]}))}e.getParam=n})(Ya||(Ya={}));function Al(){}(function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:P.Select("pixel",P.arrayToOptions(["instance","pixel"])),objects:P.ObjectList({type:P.Select("plane",P.objectToOptions(e.Type,function(u){return Ao(u)})),invert:P.Boolean(!1),position:P.Vec3(S()),rotation:P.Group({axis:P.Vec3(S.create(1,0,0)),angle:P.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:P.Vec3(S.create(1,1,1))},function(u){return Ao(u.type)})};function t(){return{count:0,type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(5*3).fill(0),rotation:new Array(5*4).fill(0),scale:new Array(5*3).fill(1)}}var r=Gr(),n=Gr(),a=S(),i=S();function o(u,c){for(var l=(c==null?void 0:c.objects)||t(),f=l.type,d=l.invert,m=l.position,p=l.rotation,v=l.scale,h=0,g=u.objects.length;h<g;++h){var y=u.objects[h];f[h]=e.Type[y.type],d[h]=y.invert,S.toArray(y.position,m,h*3),Gr.toArray(Gr.setAxisAngle(r,y.rotation.axis,pr(y.rotation.angle)),p,h*4),S.toArray(y.scale,v,h*3)}return{variant:u.variant,objects:{count:u.objects.length,type:f,invert:d,position:m,rotation:p,scale:v}}}e.getClip=o;function s(u,c){if(u.variant!==c.variant||u.objects.count!==c.objects.count)return!1;for(var l=u.objects,f=c.objects,d=0,m=l.count;d<m;++d)if(l.invert[d]!==f.invert[d]||l.type[d]!==f.type[d]||(S.fromArray(a,l.position,d*3),S.fromArray(i,f.position,d*3),!S.equals(a,i))||(S.fromArray(a,l.scale,d*3),S.fromArray(i,f.scale,d*3),!S.equals(a,i))||(Gr.fromArray(r,l.rotation,d*4),Gr.fromArray(n,f.rotation,d*4),!Gr.equals(r,n)))return!1;return!0}e.areEqual=s})(Al||(Al={}));var sJ={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},uJ=Object.keys(sJ),D_=P.arrayToOptions(uJ),LB={smoothColors:P.MappedStatic("auto",{auto:P.Group({}),on:P.Group({resolutionFactor:P.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:P.Numeric(3,{min:1,max:12,step:1})}),off:P.Group({})})};function qu(e){return!!e.smoothColors}function Ss(e,t,r){if((e.name==="on"||e.name==="auto"&&t)&&r&&r<3){var n=3;return e.name==="on"?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-J5(0,1.1,r),r=Math.max(.5,r),r>1.2&&(n=2)),{resolution:r,stride:n}}}var Je;(function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality!="undefined"&&o.quality!=="custom"}},e.Params={alpha:P.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:P.Select("auto",D_,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:Ya.getParam(),clip:P.Group(Al.Params)};function t(o,s,u){o===void 0&&(o=tr.grey),s===void 0&&(s=1),u||(u=P_());var c=Wr(1,u.instanceCount.ref.value,1,function(){return eo},!1,function(){return!1}),l={color:u1({},{value:o}),size:I_({},{value:s})};return{transform:u,locationIterator:c,theme:l}}e.createSimple=t;function r(o,s){var u=Al.getClip(o.clip);return{alpha:R.create(o.alpha),uAlpha:R.create(o.alpha),uVertexCount:R.create(s.vertexCount),uGroupCount:R.create(s.groupCount),drawCount:R.create(s.drawCount),uMetalness:R.create(o.material.metalness),uRoughness:R.create(o.material.roughness),uBumpiness:R.create(o.material.bumpiness),dLightCount:R.create(1),dClipObjectCount:R.create(u.objects.count),dClipVariant:R.create(u.variant),uClipObjectType:R.create(u.objects.type),uClipObjectInvert:R.create(u.objects.invert),uClipObjectPosition:R.create(u.objects.position),uClipObjectRotation:R.create(u.objects.rotation),uClipObjectScale:R.create(u.objects.scale)}}e.createValues=r;function n(o,s){R.updateIfChanged(o.alpha,s.alpha),R.updateIfChanged(o.uMetalness,s.material.metalness),R.updateIfChanged(o.uRoughness,s.material.roughness),R.updateIfChanged(o.uBumpiness,s.material.bumpiness);var u=Al.getClip(s.clip);R.update(o.dClipObjectCount,u.objects.count),R.update(o.dClipVariant,u.variant),R.update(o.uClipObjectType,u.objects.type),R.update(o.uClipObjectInvert,u.objects.invert),R.update(o.uClipObjectPosition,u.objects.position),R.update(o.uClipObjectRotation,u.objects.rotation),R.update(o.uClipObjectScale,u.objects.scale)}e.updateValues=n;function a(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s}}e.createRenderableState=a;function i(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=i})(Je||(Je={}));var NB=ja();function cJ(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(rr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function M_(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=cJ(e,t);throw new Error("Framebuffer status: ".concat(r))}}function UB(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function lJ(e){var t=UB(e),r=!1;return{id:NB(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=UB(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function fJ(){return{id:NB(),bind:function(){},reset:function(){},destroy:function(){}}}function zB(e){var t=Ste(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=_te(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=Cte(e);if(n===null)throw new Error('Could not find support for "standard_derivatives"');var a=Ate(e);hr&&a===null&&console.log('Could not find support for "texture_float"');var i=Tte(e);hr&&i===null&&console.log('Could not find support for "texture_float_linear"');var o=Pte(e);hr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=Ete(e);hr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=Ote(e);hr&&u===null&&console.log('Could not find support for "depth_texture"');var c=Ite(e);hr&&c===null&&console.log('Could not find support for "blend_minmax"');var l=wte(e);hr&&l===null&&console.log('Could not find support for "vertex_array_object"');var f=Dte(e);hr&&f===null&&console.log('Could not find support for "frag_depth"');var d=Mte(e);hr&&d===null&&console.log('Could not find support for "color_buffer_float"');var m=Rte(e);hr&&m===null&&console.log('Could not find support for "color_buffer_half_float"');var p=Bte(e);hr&&p===null&&console.log('Could not find support for "draw_buffers"');var v=Fte(e);hr&&v===null&&console.log('Could not find support for "shader_texture_lod"');var h=kte(e);return hr&&h===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:a,textureFloatLinear:i,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:c,vertexArrayObject:l,fragDepth:f,colorBufferFloat:d,colorBufferHalfFloat:m,drawBuffers:p,shaderTextureLod:v,sRGB:h}}function dJ(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),c=e.getParameter(e.BLEND_SRC_ALPHA),l=e.getParameter(e.BLEND_DST_ALPHA),f=e.getParameter(e.BLEND_EQUATION_RGB),d=e.getParameter(e.BLEND_EQUATION_ALPHA),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=[],v=function(){for(var h=0;h<m;++h)p[h]=0};return v(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(h){t[h]!==!0&&(e.enable(h),t[h]=!0)},disable:function(h){t[h]!==!1&&(e.disable(h),t[h]=!1)},frontFace:function(h){h!==r&&(e.frontFace(h),r=h)},cullFace:function(h){h!==n&&(e.cullFace(h),n=h)},depthMask:function(h){h!==a&&(e.depthMask(h),a=h)},colorMask:function(h,g,y,b){(h!==i[0]||g!==i[1]||y!==i[2]||b!==i[3])&&(e.colorMask(h,g,y,b),i[0]=h,i[1]=g,i[2]=y,i[3]=b)},clearColor:function(h,g,y,b){(h!==o[0]||g!==o[1]||y!==o[2]||b!==o[3])&&(e.clearColor(h,g,y,b),o[0]=h,o[1]=g,o[2]=y,o[3]=b)},blendFunc:function(h,g){(h!==s||g!==u||h!==c||g!==l)&&(e.blendFunc(h,g),s=h,u=g,c=h,l=g)},blendFuncSeparate:function(h,g,y,b){(h!==s||g!==u||y!==c||b!==l)&&(e.blendFuncSeparate(h,g,y,b),s=h,u=g,c=y,l=b)},blendEquation:function(h){(h!==f||h!==d)&&(e.blendEquation(h),f=h,d=h)},blendEquationSeparate:function(h,g){(h!==f||g!==d)&&(e.blendEquationSeparate(h,g),f=h,d=g)},enableVertexAttrib:function(h){e.enableVertexAttribArray(h),p[h]=1},clearVertexAttribsState:v,disableUnusedVertexAttribs:function(){for(var h=0;h<m;++h)p[h]===0&&e.disableVertexAttribArray(h)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),i=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),c=e.getParameter(e.BLEND_SRC_ALPHA),l=e.getParameter(e.BLEND_DST_ALPHA),f=e.getParameter(e.BLEND_EQUATION_RGB),d=e.getParameter(e.BLEND_EQUATION_ALPHA),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),p.length=0;for(var h=0;h<m;++h)p[h]=0}}}var Kf;(function(e){function t(a,i,o){return{array:a,width:i,height:o}}e.create=t;function r(a){for(var i=a.array,o=a.width,s=a.height,u=o*4,c=0,l=s/2;c<l;++c)for(var f=0,d=u;f<d;++f){var m=c*u+f,p=(s-c-1)*u+f,v=i[m];i[m]=i[p],i[p]=v}return a}e.flipY=r;function n(a){for(var i=a.array,o=i instanceof Uint8Array?255:1,s=0,u=i.length;s<u;s+=4){var c=i[s+3]/o;i[s]/=c,i[s+1]/=c,i[s+2]/=c}return a}e.divideByAlpha=n})(Kf||(Kf={}));var mJ=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,pJ=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,vJ=`
#ifdef bumpEnabled
    if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0) {
        vec3 bumpNormal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
        #ifdef enabledFragDepth
            if (!isNaN(bumpNormal.x) && !isNaN(bumpNormal.y) && !isNaN(bumpNormal.z)) {
                normal = bumpNormal;
            }
        #else
            normal = bumpNormal;
        #endif
    }
#endif

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
#ifdef enabledFragDepth
    physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
#else
    vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
    float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
    physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
#endif
physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
physicalMaterial.specularF90 = 1.0;

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
#pragma unroll_loop_start
for (int i = 0; i < dLightCount; ++i) {
    directLight.direction = uLightDirection[i];
    directLight.color = uLightColor[i] * PI; // * PI for punctual light
    RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
}
#pragma unroll_loop_end

vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

// indirect specular only metals
vec3 radiance = uAmbientColor * metalness;
vec3 iblIrradiance = uAmbientColor * metalness;
vec3 clearcoatRadiance = vec3(0.0);
RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
#endif
`,hJ=`
if (marker > 0.0) {
    if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
        gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
        gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
    }
}
`,gJ=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,yJ=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
    #endif
#elif defined(dRenderVariant_pick)
    if (uPickType == 1) {
        vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
    } else if (uPickType == 2) {
        vColor = vec4(packIntToRGB(aInstance), 1.0);
    } else {
        vColor = vec4(packIntToRGB(group), 1.0);
    }
#endif

#ifdef dTransparency
    vGroup = group;

    #if defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
#endif
`,bJ=`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,xJ=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
#endif
`,SJ=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        metalness = mix(metalness, vSubstance.r, vSubstance.a);
        roughness = mix(roughness, vSubstance.g, vSubstance.a);
        bumpiness = mix(bumpiness, vSubstance.b, vSubstance.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepth(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;
    #if defined(dRenderVariant_colorWboit)
        if (vTransparency < 0.2) ta = 1.0; // hard cutoff looks better with wboit
    #endif

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,CJ=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,_J=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,wJ=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,AJ=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,TJ=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,PJ=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif
`,EJ=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    #if defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
#endif
`,IJ=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`,DJ=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform float uHighlightStrength;
uniform float uSelectStrength;
uniform int uMarkerPriority;

#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    uniform float uMarker;
    #if __VERSION__ == 100
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;

uniform bool uRenderWboit;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepth(const in vec2 coords) {
    // always packed due to merged depth from primitives and volumes
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}
`,MJ=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_marking)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,RJ=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`,BJ=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,FJ=`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`,OJ=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,kJ=`
varying vec3 vNormal;
`,LJ=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,NJ=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,UJ=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,zJ=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,VJ=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,GJ=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,HJ=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,qJ=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,jJ=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #if defined(dPointStyle_fuzzy)
            gl_FragColor.a *= fuzzyAlpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,WJ=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,XJ=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    if (!uDoubleSided) {
        if (interior) discard;
    }

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    vec3 vModelPosition = (uInvView * vec4(vViewPosition, 1.0)).xyz;

    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,YJ=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,KJ=`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    if (uDoubleSided) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    }

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    vec3 vModelPosition = (uInvView * vec4(vViewPosition, 1.0)).xyz;

    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,QJ=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform vec4 uViewport;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,ZJ=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,$J=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,JJ=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,eee=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`,tee=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    vec3 fdx = dFdx(vViewPosition);
    vec3 fdy = dFdy(vViewPosition);
    vec3 faceNormal = normalize(cross(fdx,fdy));
    bool frontFacing = dot(vNormal, faceNormal) > 0.0;

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,ree=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,nee=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform float uHighlightStrength;
uniform float uSelectStrength;
uniform int uMarkerPriority;

uniform float uMarker;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uMetalness;
uniform float uRoughness;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;

uniform bool uRenderWboit;
uniform bool uDoubleSided;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, isoPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        #ifdef dIgnoreLight
            gl_FragColor.rgb = material.rgb;
        #else
            if (material.a >= 0.01) {
                #ifdef dPackedGroup
                    // compute gradient by central differences
                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                #else
                    gradient = cell.xyz * 2.0 - 1.0;
                #endif
                vec3 normal = -normalize(normalMatrix * normalize(gradient));
                #include apply_light_color
            } else {
                gl_FragColor.rgb = material.rgb;
            }
        #endif

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        float marker = uMarker;
        if (uMarker == -1.0) {
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
    float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
    bool interior = false;
    #include wboit_write
}
`,aee=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,iee=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;
        if (uPickType == 1) {
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
        } else {
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        }
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;
        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_marking)
        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
        if (uMarkingType == 1) {
            if (marker > 0.0 || imageData.a < 0.05)
                discard;
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
        } else {
            if (marker == 0.0 || imageData.a < 0.05)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepth(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);
        }
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;
        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,VB=ja(),oee={apply_fog:mJ,apply_interior_color:pJ,apply_light_color:vJ,apply_marker_color:hJ,assign_clipping_varying:gJ,assign_color_varying:yJ,assign_group:bJ,assign_marker_varying:xJ,assign_material_color:SJ,assign_position:CJ,assign_size:_J,check_picking_alpha:wJ,clip_instance:AJ,clip_pixel:TJ,color_frag_params:PJ,color_vert_params:EJ,common_clip:IJ,common_frag_params:DJ,common_vert_params:MJ,common:RJ,float_to_rgba:BJ,light_frag_params:FJ,matrix_scale:OJ,normal_frag_params:kJ,read_from_texture:LJ,rgba_to_float:NJ,size_vert_params:UJ,texture3d_from_1d_trilinear:zJ,texture3d_from_2d_linear:VJ,texture3d_from_2d_nearest:GJ,wboit_write:HJ},see=/^(?!\/\/)\s*#include\s+(\S+)/gm,uee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,cee=/[ \t]*\/\/.*\n/g,lee=/[ \t]*\/\*[\s\S]*?\*\//g,fee=/\n{2,}/g;function GB(e){return e.replace(see,function(t,r){var n=oee[r];if(!n)throw new Error("empty chunk, '".concat(r,"'"));return n}).trim().replace(cee,`
`).replace(lee,`
`).replace(fee,`
`)}function dee(e){return e.replace(uee,mee)}function mee(e,t,r,n){for(var a="",i=parseInt(t);i<parseInt(r);++i)a+=n.replace(/\[\s*i\s*\]/g,"[".concat(i,"]")).replace(/UNROLLED_LOOP_INDEX/g,"".concat(i));return a}function pee(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,"".concat(t.dLightCount.ref.value))),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,"".concat(t.dClipObjectCount.ref.value))),e}function HB(e,t){return dee(pee(e,t))}function Qr(e,t,r,n,a,i){return n===void 0&&(n={}),a===void 0&&(a={}),{id:VB(),name:e,vert:GB(t),frag:GB(r),extensions:n,outTypes:a,ignoreDefine:i}}function wh(e,t,r){var n;if(t.startsWith("color")){if(e==="dLightCount")return!!((n=r.dIgnoreLight)===null||n===void 0?void 0:n.ref.value)}else return["dColorType","dUsePalette","dLightCount","dOverpaintType","dOverpaint","dSubstanceType","dSubstance"].includes(e);return!1}function c1(e,t,r){return e==="dLightCount"?!0:wh(e,t,r)}var vee=Qr("points",qJ,jJ,{drawBuffers:"optional"},{},c1),hee=Qr("spheres",WJ,XJ,{fragDepth:"required",drawBuffers:"optional"},{},wh),gee=Qr("cylinders",YJ,KJ,{fragDepth:"required",drawBuffers:"optional"},{},wh),yee=Qr("text",QJ,ZJ,{drawBuffers:"optional"},{},c1),bee=Qr("lines",$J,JJ,{drawBuffers:"optional"},{},c1),qB=Qr("mesh",eee,tee,{drawBuffers:"optional"},{},wh),xee=Qr("direct-volume",ree,nee,{fragDepth:"optional",drawBuffers:"optional"},{},wh),See=Qr("image",aee,iee,{drawBuffers:"optional"},{},c1);function jB(e,t){var r;if(e===void 0)return"";var n=((r=e.dRenderVariant)===null||r===void 0?void 0:r.ref.value)||"",a=[];for(var i in e)if(!(t==null?void 0:t(i,n,e))){var o=e[i],s=o.ref.value;if(s!==void 0)if(typeof s=="string")a.push("#define ".concat(i,"_").concat(s));else if(typeof s=="number")a.push("#define ".concat(i," ").concat(s));else if(typeof s=="boolean")s&&a.push("#define ".concat(i));else throw new Error("unknown define type")}return a.join(`
`)+`
`}function Cee(e,t){var r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var _ee=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,wee=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function Aee(e,t,r,n){var a=["#version 300 es","layout(location = 0) out highp ".concat(n[0]||"vec4"," out_FragData0;")];if(r.fragDepth&&a.push("#define enabledFragDepth"),r.drawBuffers){a.push("#define requiredDrawBuffers");for(var i=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=i;o<s;++o)a.push("layout(location = ".concat(o,") out highp ").concat(n[o]||"vec4"," out_FragData").concat(o,";"))}return r.shaderTextureLod&&a.push("#define enabledShaderTextureLod"),a.push(wee),a.join(`
`)+`
`}function Tee(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function Pee(e,t,r,n){var a=jB(r,n.ignoreDefine),i=jB(r,n.ignoreDefine),o=rr(e)?_ee:"",s=rr(e)?Aee(e,t,n.extensions,n.outTypes):Cee(t,n.extensions),u=rr(e)?Tee(n.frag):n.frag;return{id:VB(),name:n.name,vert:"".concat(o).concat(a).concat(HB(n.vert,r)),frag:"".concat(s).concat(i).concat(HB(u,r)),extensions:n.extensions,outTypes:n.outTypes}}function Eee(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '".concat(t,"'"))}}function Iee(e,t,r){e.uniform1f(t,r)}function Dee(e,t,r){e.uniform1fv(t,r)}function Mee(e,t,r){e.uniform1i(t,r)}function Ree(e,t,r){e.uniform1iv(t,r)}function Bee(e,t,r){e.uniform2fv(t,r)}function Fee(e,t,r){e.uniform3fv(t,r)}function Oee(e,t,r){e.uniform4fv(t,r)}function kee(e,t,r){e.uniformMatrix3fv(t,!1,r)}function Lee(e,t,r){e.uniformMatrix4fv(t,!1,r)}function WB(e){switch(e){case"f":return Iee;case"f[]":return Dee;case"i":case"t":case"b":return Mee;case"i[]":case"t[]":case"b[]":return Ree;case"v2":case"v2[]":return Bee;case"v3":case"v3[]":return Fee;case"v4":case"v4[]":return Oee;case"m3":case"m3[]":return kee;case"m4":case"m4[]":return Lee}}function Nee(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=WB(n.kind):n.type==="texture"&&(t[r]=WB("t"))}),t}function Uee(e){var t={};return Object.keys(e).forEach(function(r){t[r]=R.create(ol(e[r].ref.value))}),t}var zee=ja();function Vee(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function Gee(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function Hee(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function XB(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function YB(e,t,r,n){var a=XB(e),i=Vee(e,r),o=Hee(e,n),s=Gee(e,t),u=t.BYTES_PER_ELEMENT,c=t.length;function l(d){e.bindBuffer(o,a),e.bufferData(o,d,i)}l(t);var f=!1;return{id:zee(),_usageHint:i,_bufferType:o,_dataType:s,_bpe:u,length:c,getBuffer:function(){return a},updateData:l,updateSubData:function(d,m,p){e.bindBuffer(o,a),p-m===d.length?e.bufferSubData(o,0,d):e.bufferSubData(o,m*u,d.subarray(m,m+p))},reset:function(){a=XB(e),l(t)},destroy:function(){f||(e.deleteBuffer(a),f=!0)}}}function qee(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '".concat(t,"' and itemSize '").concat(r,"'"))}function jee(e,t,r,n,a,i,o){o===void 0&&(o="dynamic");var s=r.instancedArrays,u=YB(e,n,o,"attribute"),c=u._bufferType,l=u._dataType,f=u._bpe;return I(I({},u),{bind:function(d){if(e.bindBuffer(c,u.getBuffer()),a===16)for(var m=0;m<4;++m)t.enableVertexAttrib(d+m),e.vertexAttribPointer(d+m,4,l,!1,4*4*f,m*4*f),s.vertexAttribDivisor(d+m,i);else t.enableVertexAttrib(d),e.vertexAttribPointer(d,a,l,!1,0,0),s.vertexAttribDivisor(d,i)}})}function Wee(e,t,r){var n=[];return Object.keys(t).forEach(function(a){var i=t[a];i.type==="attribute"&&(n[n.length]=[a,e.resources.attribute(r[a].ref.value,i.itemSize,i.divisor)])}),n}function Xee(e,t,r){r===void 0&&(r="static");var n=YB(e,t,r,"elements");return I(I({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var Yee=ja();function Kee(e,t,r){var n={};return Object.keys(r).forEach(function(a){var i=r[a];if(i.type==="attribute"){var o=e.getAttribLocation(t,a);n[a]=o}else if(i.type==="uniform"||i.type==="texture"){var o=e.getUniformLocation(t,a);n[a]=o}}),n}function Qee(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var i=e.getActiveAttrib(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if(u.type!=="attribute")throw new Error("'".concat(o,"' must be of type 'attribute' but is '").concat(u.type,"'"));var c=qee(e,u.kind,u.itemSize);if(c!==s)throw new Error("unexpected attribute type for ".concat(o))}}}function Zee(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var i=e.getActiveUniform(t,a);if(i){var o=i.name,s=i.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),c=r[u];if(c===void 0)throw new Error("missing 'uniform' or 'texture' with name '".concat(o,"' in schema"));if(c.type==="uniform"){var l=Eee(e,c.kind);if(l!==s)throw new Error("unexpected uniform type for ".concat(o))}else if(c.type==="texture"){if(c.kind==="image-float32"||c.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else if((c.kind==="volume-float32"||c.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '".concat(o,"'"))}else throw new Error("'".concat(o,"' must be of type 'uniform' or 'texture' but is '").concat(c.type,"'"))}}}function $ee(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`.concat(e.getProgramInfoLog(t)))}function R_(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function Jee(e,t,r,n,a){var i=a.defineValues,o=a.shaderCode,s=a.schema,u=R_(e),c=Yee(),l=Pee(e,r,i,o),f=n("vert",l.vert),d=n("frag",l.frag),m,p;function v(){f.attach(u),d.attach(u),e.linkProgram(u),hr&&$ee(e,u),m=Kee(e,u,s),p=Nee(s),hr&&(Qee(e,u,s),Zee(e,u,s))}v();var h=!1;return{id:c,use:function(){t.currentProgramId=c,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var x=g[y],C=x[0],_=x[1];if(_){var w=m[C];w!==null&&p[C](e,w,_.ref.value)}}},bindAttributes:function(g){t.clearVertexAttribsState();for(var y=0,b=g.length;y<b;++y){var x=g[y],C=x[0],_=x[1],w=m[C];w!==-1&&_.bind(w)}t.disableUnusedVertexAttribs()},bindTextures:function(g,y){for(var b=0,x=g.length;b<x;++b){var C=g[b],_=C[0],w=C[1],T=m[_];T!=null&&(w.bind(b+y),p[_](e,T,b+y))}},reset:function(){u=R_(e),v()},destroy:function(){h||(f.destroy(),d.destroy(),e.deleteProgram(u),h=!0)}}}var ete=ja();function tte(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function l1(e,t){var r=t.type,n=t.source,a=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(a===null)throw new Error("Error creating ".concat(r," shader"));if(e.shaderSource(a,n),e.compileShader(a),hr&&e.getShaderParameter(a,e.COMPILE_STATUS)===!1)throw console.warn("'".concat(r,"' shader info log '").concat(e.getShaderInfoLog(a),`'
`).concat(tte(n))),new Error("Error compiling ".concat(r," shader"));return a}function rte(e,t){var r=l1(e,t);return{id:ete(),attach:function(n){e.attachShader(n,r)},reset:function(){r=l1(e,t)},destroy:function(){e.deleteShader(r)}}}function nte(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function ate(e){return{free:function(){e.usageCount-=1},value:e.value}}function KB(e,t,r){var n=new Map;return{get:function(a){var i=e(a),o=n.get(i);return o||(o=nte(t(a)),n.set(i,o)),o.usageCount+=1,ate(o)},clear:function(){n.forEach(function(a,i){a.usageCount<=0&&(a.usageCount<0&&console.warn("Reference usageCount below zero."),r(a.value),n.delete(i))})},get count(){return n.size},dispose:function(){n.forEach(function(a){return r(a.value)}),n.clear()}}}var ite=ja();function ote(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(rr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function ste(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function QB(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function ute(e,t,r,n,a){var i=QB(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,i)},s=ote(e,t),u=ste(e,r);function c(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,a)}c();var l=!1;return{id:ite(),bind:o,attachFramebuffer:function(f){f.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,i),hr&&M_(e)},setSize:function(f,d){n=f,a=d,c()},reset:function(){i=QB(e),c()},destroy:function(){l||(e.deleteRenderbuffer(i),l=!0)}}}var cte=ja();function ZB(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function $B(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function lte(e,t,r,n,a){var i=cte(),o=ZB(t),s=$B(t);function u(){s.bindVertexArray(o),a&&a.bind(),r.bindAttributes(n),s.bindVertexArray(null)}u();var c=!1;return{id:i,bind:function(){s.bindVertexArray(o)},update:u,reset:function(){o=ZB(t),s=$B(t),u()},destroy:function(){c||(a&&(s.bindVertexArray(o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(o),c=!0)}}}function fte(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:JC(e)}function JB(e){var t=I(I({},e.value),{destroy:function(){e.free()}});return t}function dte(e,t,r,n){var a={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function i(c,l){return a[c].add(l),r.resourceCounts[c]+=1,I(I({},l),{destroy:function(){l.destroy(),a[c].delete(l),r.resourceCounts[c]-=1}})}var o=KB(function(c){return JSON.stringify(c)},function(c){return i("shader",rte(e,c))},function(c){c.destroy()});function s(c,l){return JB(o.get({type:c,source:l}))}var u=KB(function(c){var l,f=[c.shaderCode.id],d=((l=c.defineValues.dRenderVariant)===null||l===void 0?void 0:l.ref.value)||"";return Object.keys(c.defineValues).forEach(function(m){var p,v;((v=(p=c.shaderCode).ignoreDefine)===null||v===void 0?void 0:v.call(p,m,d,c.defineValues))||f.push(JC(m),fte(c.defineValues[m].ref.value))}),Wa(f).toString()},function(c){return i("program",Jee(e,t,n,s,c))},function(c){c.destroy()});return{attribute:function(c,l,f,d){return i("attribute",jee(e,t,n,c,l,f,d))},elements:function(c,l){return i("elements",Xee(e,c,l))},framebuffer:function(){return i("framebuffer",lJ(e))},program:function(c,l,f){return JB(u.get({defineValues:c,shaderCode:l,schema:f}))},renderbuffer:function(c,l,f,d){return i("renderbuffer",ute(e,c,l,f,d))},shader:s,texture:function(c,l,f,d){return i("texture",F_(e,n,c,l,f,d))},vertexArray:function(c,l,f){return i("vertexArray",lte(e,n,c,l,f))},getByteCounts:function(){var c=0;a.texture.forEach(function(d){c+=d.getByteCount()});var l=0;a.attribute.forEach(function(d){l+=d.length*4});var f=0;return a.elements.forEach(function(d){f+=d.length*4}),{texture:c,attribute:l,elements:f}},reset:function(){a.attribute.forEach(function(c){return c.reset()}),a.elements.forEach(function(c){return c.reset()}),a.framebuffer.forEach(function(c){return c.reset()}),a.renderbuffer.forEach(function(c){return c.reset()}),a.shader.forEach(function(c){return c.reset()}),a.program.forEach(function(c){return c.reset()}),a.vertexArray.forEach(function(c){return c.reset()}),a.texture.forEach(function(c){return c.reset()})},destroy:function(){a.attribute.forEach(function(c){return c.destroy()}),a.elements.forEach(function(c){return c.destroy()}),a.framebuffer.forEach(function(c){return c.destroy()}),a.renderbuffer.forEach(function(c){return c.destroy()}),a.shader.forEach(function(c){return c.destroy()}),a.program.forEach(function(c){return c.destroy()}),a.vertexArray.forEach(function(c){return c.destroy()}),a.texture.forEach(function(c){return c.destroy()}),o.clear(),u.clear()}}}var eF=ja();function mte(e,t,r,n,a,i,o){a===void 0&&(a=!0),i===void 0&&(i="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=i==="fp16"?t.texture("image-float16","rgba","fp16",o):i==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),c=a?rr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function l(){u.define(r,n),u.attachFramebuffer(s,"color0"),c&&c.attachFramebuffer(s)}l();var f=!1;return{id:eF(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(d,m){r===d&&n===m||(r=d,n=m,u.define(r,n),c&&c.setSize(r,n))},reset:function(){l()},destroy:function(){f||(u.destroy(),s.destroy(),c&&c.destroy(),f=!0)}}}function pte(e){return{id:eF(),texture:vi(e),framebuffer:fJ(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function vte(e,t){function r(a){try{return e.getContext(a,t)}catch{return null}}var n=((t==null?void 0:t.preferWebGl1)?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return hr&&console.log("isWebgl2: ".concat(rr(n))),n}function tF(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function rF(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '".concat(tF(e,t),"'"))}function hte(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),rr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<a;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),f1(e)}function f1(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var nF=new Uint8Array(1*4);function aF(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):i3.setImmediate(aF,e,t,r)}function iF(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?i3.setImmediate(aF,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,nF),t())}var oF=!1;function gte(e){return new Promise(function(t){rr(e)?iF(e,t):(oF||(console.info("Sync object not supported in WebGL"),oF=!0),sF(e),t())})}function sF(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,nF)}function B_(e,t,r,n,a,i){if(hr&&M_(e),i instanceof Uint8Array)e.readPixels(t,r,n,a,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,a,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&rr(e))e.readPixels(t,r,n,a,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");hr&&rF(e)}function yte(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return f1(e),e.viewport(0,0,t,r),B_(e,0,0,t,r,n),Kf.flipY(Kf.create(n,t,r))}function bte(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function xte(e,t){var r=this;t===void 0&&(t={});var n=zB(e),a=dJ(e),i=bte(),o=dte(e,a,i,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:rr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,c=new dl(0),l;if(rr(e)){var f=e.createBuffer(),d=void 0,m=void 0,p=!1,v=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,f),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,d),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),p=!1,m(),m=void 0,d=void 0};l=function(g,y,b,x,C){return new Promise(function(_,w){if(p){w("Can not call multiple readPixelsAsync at the same time");return}p=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,f),e.bufferData(e.PIXEL_PACK_BUFFER,b*x*4,e.STREAM_READ),e.readPixels(g,y,b,x,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),m=_,d=C,iF(e,v)})}}else l=function(g,y,b,x,C){return ie(r,void 0,void 0,function(){return ae(this,function(_){return B_(e,g,y,b,x,C),[2]})})};var h=new Set;return{gl:e,isWebGL2:rr(e),get pixelRatio(){var g=typeof window!="undefined"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:a,stats:i,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:c,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,zB(e)),a.reset(),a.currentMaterialId=-1,a.currentProgramId=-1,a.currentRenderItemId=-1,o.reset(),h.forEach(function(y){return y.reset()}),g==null||g(),u=!1,c.next(en())},createRenderTarget:function(g,y,b,x,C){var _=mte(e,o,g,y,b,x,C);return h.add(_),I(I({},_),{destroy:function(){_.destroy(),h.delete(_)}})},unbindFramebuffer:function(){return f1(e)},readPixels:function(g,y,b,x,C){B_(e,g,y,b,x,C)},readPixelsAsync:l,waitForGpuCommandsComplete:function(){return gte(e)},waitForGpuCommandsCompleteSync:function(){return sF(e)},getDrawingBufferPixelData:function(){return yte(e)},clear:function(g,y,b,x){f1(e),a.enable(e.SCISSOR_TEST),a.depthMask(!0),a.colorMask(!0,!0,!0,!0),a.clearColor(g,y,b,x),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y,b;o.destroy(),hte(e),(g==null?void 0:g.doNotForceWebGLContextLoss)||((y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext(),(b=e.getExtension("STACKGL_destroy_context"))===null||b===void 0||b.destroy())}}}function rr(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext}function Ste(e){if(rr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function Cte(e){if(rr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function _te(e){return rr(e)?{}:e.getExtension("OES_element_index_uint")}function wte(e){if(rr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function Ate(e){return rr(e)?{}:e.getExtension("OES_texture_float")}function Tte(e){return e.getExtension("OES_texture_float_linear")}function Pte(e){if(rr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function Ete(e){return e.getExtension("OES_texture_half_float_linear")}function Ite(e){if(rr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function Dte(e){return rr(e)?{}:e.getExtension("EXT_frag_depth")}function Mte(e){if(rr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),uF(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function Rte(e){if(rr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),uF(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function Bte(e){if(rr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function Fte(e){return rr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function Ote(e){if(rr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function kte(e){if(rr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var Lte=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,Nte=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,Ute=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function uF(e,t){var r=l1(e,{type:"vert",source:Lte}),n=l1(e,{type:"frag",source:Nte});if(!r||!n)return!1;var a=R_(e);e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var i=e.getAttribLocation(a,"aPosition"),o=e.getUniformLocation(a,"uColor");if(!o)return hr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,Ute,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.createTexture(),c=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,c);var l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var f=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,f),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l,0);var d=e.checkFramebufferStatus(e.FRAMEBUFFER);if(d!==e.FRAMEBUFFER_COMPLETE)return hr&&console.log("error creating framebuffer for '".concat(t,"'")),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,l),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var m=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,m),m[0]!==0||m[1]<248||m[2]<248||m[3]<254)return hr&&console.log("not able to actually render to '".concat(t,"' texture")),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,f);var p=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,p);var v=e.getError();if(v)return hr&&console.log("error reading float pixels: '".concat(tF(e,v),"'")),!1}return!0}var cF=ja();function zte(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(rr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '".concat(t,"'"))}function lF(e,t,r){switch(t){case"alpha":return rr(e)&&r==="float"?e.RED:rr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return rr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return rr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function Vte(e,t,r){if(rr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return lF(e,t,r)}function Gte(e,t,r,n,a){var i=Hte(e)*qte(t);return i*r*n*(a||1)}function Hte(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function qte(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function jte(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(rr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function fF(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function d1(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function Wte(e){return typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement}function Xte(e,t,r){return t===r.TEXTURE_2D}function Yte(e,t,r){return t===r.TEXTURE_3D}function dF(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function F_(e,t,r,n,a,i){var o=cF(),s=dF(e);if(r.endsWith("float32")&&a!=="float"||r.endsWith("float16")&&a!=="fp16"||r.endsWith("uint8")&&a!=="ubyte"||r.endsWith("int32")&&a!=="int"||r.endsWith("depth")&&a!=="ushort"&&a!=="float")throw new Error("texture kind '".concat(r,"' and type '").concat(a,"' are incompatible"));var u=zte(e,r),c=fF(e,i),l=lF(e,n,a),f=Vte(e,n,a),d=jte(e,t,a);function m(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,c),e.texParameteri(u,e.TEXTURE_MIN_FILTER,c),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}m();var p=0,v=0,h=0,g,y=!1;function b(_,w,T){if(!(p===_&&v===w&&h===(T||0)))if(p=_,v=w,h=T||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,f,p,v,0,l,d,null);else if(rr(e)&&u===e.TEXTURE_3D&&h!==void 0)e.texImage3D(u,0,f,p,v,h,0,l,d,null);else throw new Error("unknown texture target")}function x(_,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Wte(_))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,f,l,d,_);else if(Xte(_,u,e)){var T=_.filter?fF(e,_.filter):c;e.texParameteri(u,e.TEXTURE_MAG_FILTER,T),e.texParameteri(u,e.TEXTURE_MIN_FILTER,T),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!_.flipY),w?e.texSubImage2D(u,0,0,0,_.width,_.height,l,d,_.array):(p=_.width,v=_.height,e.texImage2D(u,0,f,p,v,0,l,d,_.array))}else if(rr(e)&&Yte(_,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,_.width,_.height,_.depth,l,d,_.array):(p=_.width,v=_.height,h=_.depth,e.texImage3D(u,0,f,p,v,h,0,l,d,_.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=_}function C(_,w,T){if(_.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,d1(e,t,w),e.TEXTURE_2D,s,0);else if(rr(e)&&u===e.TEXTURE_3D){if(T===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,d1(e,t,w),s,0,T)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:l,internalFormat:f,type:d,filter:c,getWidth:function(){return p},getHeight:function(){return v},getDepth:function(){return h},getByteCount:function(){return Gte(n,a,p,v,h)},define:b,load:x,bind:function(_){e.activeTexture(e.TEXTURE0+_),e.bindTexture(u,s)},unbind:function(_){e.activeTexture(e.TEXTURE0+_),e.bindTexture(u,null)},attachFramebuffer:C,detachFramebuffer:function(_,w){if(_.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,d1(e,t,w),e.TEXTURE_2D,null,0);else if(rr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,d1(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=dF(e),m();var _=[p,v,h],w=_[0],T=_[1],A=_[2];p=0,v=0,h=0,b(w,T,A),g&&x(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function Kte(e,t,r){var n=e.resources,a=[];return Object.keys(t).forEach(function(i){var o=t[i];if(o.type==="texture"){var s=r[i];if(s)if(o.kind==="texture")a[a.length]=[i,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),a[a.length]=[i,u]}}}),a}function mF(e,t,r){var n=new Image;n.onload=function(){r.load(n),R.update(t,r)},n.src=e}function vi(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:cF(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function Qte(e,t,r,n){for(var a=t;a<r;++a)st.toArray(n,e,a*4),e[a*4+3]=255;return!0}function pF(e,t,r){return e.fill(0,t*4,r*4),!0}function Zte(e,t){var r=Yn(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(R.update(t.tOverpaint,r),R.update(t.uOverpaintTexDim,Fe.create(r.width,r.height)),R.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:R.create(r),uOverpaintTexDim:R.create(Fe.create(r.width,r.height)),dOverpaint:R.create(e>0),tOverpaintGrid:R.create(vi()),uOverpaintGridDim:R.create(S.create(1,1,1)),uOverpaintGridTransform:R.create(Wt.create(0,0,0,1)),dOverpaintType:R.create("groupInstance")}}var vF={array:new Uint8Array(4),width:1,height:1};function ju(e){return e?(R.update(e.tOverpaint,vF),R.update(e.uOverpaintTexDim,Fe.create(1,1)),e):{tOverpaint:R.create(vF),uOverpaintTexDim:R.create(Fe.create(1,1)),dOverpaint:R.create(!1),tOverpaintGrid:R.create(vi()),uOverpaintGridDim:R.create(S.create(1,1,1)),uOverpaintGridTransform:R.create(Wt.create(0,0,0,1)),dOverpaintType:R.create("groupInstance")}}function $te(e,t,r,n){for(var a=t;a<r;++a)e[a]=n*255;return!0}function hF(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function Jte(e,t,r){e.fill(0,t,r)}function ere(e,t){var r=Yn(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(R.update(t.tTransparency,r),R.update(t.uTransparencyTexDim,Fe.create(r.width,r.height)),R.updateIfChanged(t.dTransparency,e>0),R.updateIfChanged(t.transparencyAverage,hF(r.array,e)),t):{tTransparency:R.create(r),uTransparencyTexDim:R.create(Fe.create(r.width,r.height)),dTransparency:R.create(e>0),transparencyAverage:R.create(0),tTransparencyGrid:R.create(vi()),uTransparencyGridDim:R.create(S.create(1,1,1)),uTransparencyGridTransform:R.create(Wt.create(0,0,0,1)),dTransparencyType:R.create("groupInstance")}}var gF={array:new Uint8Array(1),width:1,height:1};function Wu(e){return e?(R.update(e.tTransparency,gF),R.update(e.uTransparencyTexDim,Fe.create(1,1)),e):{tTransparency:R.create(gF),uTransparencyTexDim:R.create(Fe.create(1,1)),dTransparency:R.create(!1),transparencyAverage:R.create(0),tTransparencyGrid:R.create(vi()),uTransparencyGridDim:R.create(S.create(1,1,1)),uTransparencyGridTransform:R.create(Wt.create(0,0,0,1)),dTransparencyType:R.create("groupInstance")}}function tre(e,t,r,n){return e.fill(n,t,r),!0}function rre(e,t,r){e.fill(0,t,r)}function nre(e,t){var r=Yn(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(R.update(t.tClipping,r),R.update(t.uClippingTexDim,Fe.create(r.width,r.height)),R.updateIfChanged(t.dClipping,e>0),t):{tClipping:R.create(r),uClippingTexDim:R.create(Fe.create(r.width,r.height)),dClipping:R.create(e>0)}}var yF={array:new Uint8Array(1),width:1,height:1};function Xu(e){return e?(R.update(e.tClipping,yF),R.update(e.uClippingTexDim,Fe.create(1,1)),R.updateIfChanged(e.dClipping,!1),e):{tClipping:R.create(yF),uClippingTexDim:R.create(Fe.create(1,1)),dClipping:R.create(!1)}}function are(e,t,r,n){for(var a=t;a<r;++a)Ya.toArray(n,e,a*4),e[a*4+3]=255;return!0}function bF(e,t,r){return e.fill(0,t*4,r*4),!0}function ire(e,t){var r=Yn(Math.max(1,e),4,Uint8Array,t&&t.tSubstance.ref.value.array);return t?(R.update(t.tSubstance,r),R.update(t.uSubstanceTexDim,Fe.create(r.width,r.height)),R.updateIfChanged(t.dSubstance,e>0),t):{tSubstance:R.create(r),uSubstanceTexDim:R.create(Fe.create(r.width,r.height)),dSubstance:R.create(e>0),tSubstanceGrid:R.create(vi()),uSubstanceGridDim:R.create(S.create(1,1,1)),uSubstanceGridTransform:R.create(Wt.create(0,0,0,1)),dSubstanceType:R.create("groupInstance")}}var xF={array:new Uint8Array(4),width:1,height:1};function Yu(e){return e?(R.update(e.tSubstance,xF),R.update(e.uSubstanceTexDim,Fe.create(1,1)),e):{tSubstance:R.create(xF),uSubstanceTexDim:R.create(Fe.create(1,1)),dSubstance:R.create(!1),tSubstanceGrid:R.create(vi()),uSubstanceGridDim:R.create(S.create(1,1,1)),uSubstanceGridTransform:R.create(Wt.create(0,0,0,1)),dSubstanceType:R.create("groupInstance")}}var Qf;(function(e){function t(p,v,h,g){return g?i(p,v,h,g):a(p,v,h)}e.create=t;function r(p){var v=p?p.centerBuffer.ref.value:new Float32Array(0),h=p?p.groupBuffer.ref.value:new Float32Array(0);return t(v,h,0,p)}e.createEmpty=r;function n(p){return Wa([p.pointCount,p.centerBuffer.ref.version,p.groupBuffer.ref.version])}function a(p,v,h){var g=Te(),y,b=-1,x=-1,C={kind:"points",pointCount:h,centerBuffer:R.create(p),groupBuffer:R.create(v),get boundingSphere(){var _=n(C);if(_!==b){var w=wl(C.centerBuffer.ref.value,C.pointCount,1);Te.copy(g,w),b=_}return g},get groupMapping(){return C.groupBuffer.ref.version!==x&&(y=Qm(C.groupBuffer.ref.value,C.pointCount),x=C.groupBuffer.ref.version),y},setBoundingSphere:function(_){Te.copy(g,_),b=n(C)}};return C}function i(p,v,h,g){return g.pointCount=h,R.update(g.centerBuffer,p),R.update(g.groupBuffer,v),g}function o(p,v){var h=p.centerBuffer.ref.value;Wf(v,h,0,p.pointCount),R.update(p.centerBuffer,h)}e.transform=o,e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params=I(I({},Je.Params),{sizeFactor:P.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:P.Boolean(!1),pointStyle:P.Select("square",P.objectToOptions(e.StyleTypes))}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:c,updateValues:l,updateBoundingSphere:f,createRenderableState:d,updateRenderableState:m,createPositionIterator:s};function s(p,v){var h=p.pointCount,g=v.instanceCount.ref.value,y=Yf(),b=y.position,x=p.centerBuffer.ref.value,C=v.aTransform.ref.value,_=function(w,T){return T<0?S.fromArray(b,x,w*3):S.transformMat4Offset(b,x,C,0,w*3,T*16),y};return Wr(h,g,1,_)}function u(p,v,h,g,y){var b=h.instanceCount,x=h.groupCount,C=s(p,v),_=ao(h,C,g.color),w=Hu(h,g.size),T=Fo(b*x),A=ju(),D=Wu(),E=Yu(),M=Xu(),F={drawCount:p.pointCount,vertexCount:p.pointCount,groupCount:x,instanceCount:b},O=Te.clone(p.boundingSphere),U=sa(O,v.aTransform.ref.value,b);return I(I(I(I(I(I(I(I(I(I({dGeometryType:R.create("points"),aPosition:p.centerBuffer,aGroup:p.groupBuffer,boundingSphere:R.create(U),invariantBoundingSphere:R.create(O),uInvariantBoundingSphere:R.create(Wt.ofSphere(O))},_),w),T),A),D),E),M),v),Je.createValues(y,F)),{uSizeFactor:R.create(y.sizeFactor),dPointSizeAttenuation:R.create(y.pointSizeAttenuation),dPointStyle:R.create(y.pointStyle)})}function c(p,v,h,g,y){var b=Je.createSimple(h,g,y),x=I(I({},P.getDefaultValues(e.Params)),v);return u(p,b.transform,b.locationIterator,b.theme,x)}function l(p,v){Je.updateValues(p,v),R.updateIfChanged(p.uSizeFactor,v.sizeFactor),R.updateIfChanged(p.dPointSizeAttenuation,v.pointSizeAttenuation),R.updateIfChanged(p.dPointStyle,v.pointStyle)}function f(p,v){var h=Te.clone(v.boundingSphere),g=sa(h,p.aTransform.ref.value,p.instanceCount.ref.value);Te.equals(g,p.boundingSphere.ref.value)||R.update(p.boundingSphere,g),Te.equals(h,p.invariantBoundingSphere.ref.value)||(R.update(p.invariantBoundingSphere,h),R.update(p.uInvariantBoundingSphere,Wt.fromSphere(p.uInvariantBoundingSphere.ref.value,h)))}function d(p){var v=Je.createRenderableState(p);return m(v,p),v}function m(p,v){Je.updateRenderableState(p,v),p.opaque=p.opaque&&v.pointStyle!=="fuzzy",p.writeDepth=p.opaque}})(Qf||(Qf={}));function SF(e,t,r,n,a,i,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];CF(n,a,i,o,r);for(var u=0;u<r;u++)e[u*t+s]=a[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];CF(n,a,i,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(a[s])}}function CF(e,t,r,n,a){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var i=1,o=0;i<a;i++){for(var s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);s<=n[o];)o--,s=(e[i]+i*i-(e[r[o]]+r[o]*r[o]))/(2*i-2*r[o]);o++,r[o]=i,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var i=0,o=0;i<a;i++){for(;n[o+1]<i;)o++;t[i]=(i-r[o])*(i-r[o])+e[r[o]]}}var O_={};function ore(e){var t=JSON.stringify(e);return O_[t]===void 0&&(O_[t]=new sre(e)),O_[t]}var _F={fontFamily:P.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:P.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:P.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:P.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:P.Select("normal",[["normal","Normal"],["bold","Bold"]])},sre=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=I(I({},P.getDefaultValues(_F)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=Yn(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font="".concat(r.fontStyle," ").concat(r.fontVariant," ").concat(r.fontWeight," ").concat(n,"px ").concat(r.fontFamily),this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,a=r.width,i=r.height,o=this.scratchData;if(this.currentX+this.scratchW>a&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[a*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,a=this.scratchData,i=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),c=0;c<s;c++){var l=u.data[c*4+3]/255;this.gridOuter[c]=l===1?0:l===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-l),2),this.gridInner[c]=l===1?Number.MAX_SAFE_INTEGER:l===0?0:Math.pow(Math.max(0,l-.5),2)}SF(this.gridOuter,o,r,this.f,this.d,this.v,this.z),SF(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var c=0;c<s;c++){var f=this.gridOuter[c]-this.gridInner[c];a[c]=Math.max(0,Math.min(255,Math.round(255-255*(f/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),Oo;(function(e){function t(m,p,v,h,g,y,b,x,C){return C?i(m,p,v,h,g,y,b,x,C):a(m,p,v,h,g,y,b,x)}e.create=t;function r(m){var p=m?m.fontTexture.ref.value:Yn(0,1,Uint8Array),v=m?m.centerBuffer.ref.value:new Float32Array(0),h=m?m.mappingBuffer.ref.value:new Float32Array(0),g=m?m.depthBuffer.ref.value:new Float32Array(0),y=m?m.indexBuffer.ref.value:new Uint32Array(0),b=m?m.groupBuffer.ref.value:new Float32Array(0),x=m?m.tcoordBuffer.ref.value:new Float32Array(0);return t(p,v,h,g,y,b,x,0,m)}e.createEmpty=r;function n(m){return Wa([m.charCount,m.fontTexture.ref.version,m.centerBuffer.ref.version,m.mappingBuffer.ref.version,m.depthBuffer.ref.version,m.indexBuffer.ref.version,m.groupBuffer.ref.version,m.tcoordBuffer.ref.version])}function a(m,p,v,h,g,y,b,x){var C=Te(),_,w=-1,T=-1,A={kind:"text",charCount:x,fontTexture:R.create(m),centerBuffer:R.create(p),mappingBuffer:R.create(v),depthBuffer:R.create(h),indexBuffer:R.create(g),groupBuffer:R.create(y),tcoordBuffer:R.create(b),get boundingSphere(){var D=n(A);if(D!==w){var E=wl(A.centerBuffer.ref.value,A.charCount*4,4);Te.copy(C,E),w=D}return C},get groupMapping(){return A.groupBuffer.ref.version!==T&&(_=Qm(A.groupBuffer.ref.value,A.charCount,4),T=A.groupBuffer.ref.version),_},setBoundingSphere:function(D){Te.copy(C,D),w=n(A)}};return A}function i(m,p,v,h,g,y,b,x,C){return C.charCount=x,R.update(C.fontTexture,m),R.update(C.centerBuffer,p),R.update(C.mappingBuffer,v),R.update(C.depthBuffer,h),R.update(C.indexBuffer,g),R.update(C.groupBuffer,y),R.update(C.tcoordBuffer,b),C}e.Params=I(I(I({},Je.Params),_F),{sizeFactor:P.Numeric(1,{min:0,max:10,step:.1}),borderWidth:P.Numeric(0,{min:0,max:.5,step:.01}),borderColor:P.Color(tr.grey),offsetX:P.Numeric(0,{min:0,max:10,step:.1}),offsetY:P.Numeric(0,{min:0,max:10,step:.1}),offsetZ:P.Numeric(0,{min:0,max:10,step:.1}),background:P.Boolean(!1),backgroundMargin:P.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:P.Color(tr.grey),backgroundOpacity:P.Numeric(1,{min:0,max:1,step:.01}),tether:P.Boolean(!1),tetherLength:P.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:P.Numeric(.3,{min:0,max:1,step:.01}),attachment:P.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:c,updateBoundingSphere:l,createRenderableState:f,updateRenderableState:d,createPositionIterator:o};function o(m,p){var v=m.charCount*4,h=p.instanceCount.ref.value,g=Yf(),y=g.position,b=m.centerBuffer.ref.value,x=p.aTransform.ref.value,C=function(_,w){return w<0?S.fromArray(y,b,_*3):S.transformMat4Offset(y,b,x,0,_*3,w*16),g};return Wr(v,h,4,C)}function s(m,p,v,h,g){var y=v.instanceCount,b=v.groupCount,x=o(m,p),C=ao(v,x,h.color),_=Hu(v,h.size),w=Fo(y*b),T=ju(),A=Wu(),D=Yu(),E=Xu(),M={drawCount:m.charCount*2*3,vertexCount:m.charCount*4,groupCount:b,instanceCount:y},F=wF(m.mappingBuffer.ref.value,m.depthBuffer.ref.value,m.charCount,_h(_)),O=Te.expand(Te(),m.boundingSphere,F),U=sa(O,p.aTransform.ref.value,y);return I(I(I(I(I(I(I(I(I(I(I({dGeometryType:R.create("text"),aPosition:m.centerBuffer,aMapping:m.mappingBuffer,aDepth:m.depthBuffer,aGroup:m.groupBuffer,elements:m.indexBuffer,boundingSphere:R.create(U),invariantBoundingSphere:R.create(O),uInvariantBoundingSphere:R.create(Wt.ofSphere(O))},C),_),w),T),A),D),E),p),{aTexCoord:m.tcoordBuffer,tFont:m.fontTexture,padding:R.create(F)}),Je.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),uBorderWidth:R.create(Ra(g.borderWidth,0,.5)),uBorderColor:R.create(st.toArrayNormalized(g.borderColor,S.zero(),0)),uOffsetX:R.create(g.offsetX),uOffsetY:R.create(g.offsetY),uOffsetZ:R.create(g.offsetZ),uBackgroundColor:R.create(st.toArrayNormalized(g.backgroundColor,S.zero(),0)),uBackgroundOpacity:R.create(g.backgroundOpacity)})}function u(m,p,v,h,g){var y=Je.createSimple(v,h,g),b=I(I({},P.getDefaultValues(e.Params)),p);return s(m,y.transform,y.locationIterator,y.theme,b)}function c(m,p){Je.updateValues(m,p),R.updateIfChanged(m.uSizeFactor,p.sizeFactor),R.updateIfChanged(m.uBorderWidth,p.borderWidth),st.fromNormalizedArray(m.uBorderColor.ref.value,0)!==p.borderColor&&(st.toArrayNormalized(p.borderColor,m.uBorderColor.ref.value,0),R.update(m.uBorderColor,m.uBorderColor.ref.value)),R.updateIfChanged(m.uOffsetX,p.offsetX),R.updateIfChanged(m.uOffsetY,p.offsetY),R.updateIfChanged(m.uOffsetZ,p.offsetZ),st.fromNormalizedArray(m.uBackgroundColor.ref.value,0)!==p.backgroundColor&&(st.toArrayNormalized(p.backgroundColor,m.uBackgroundColor.ref.value,0),R.update(m.uBackgroundColor,m.uBackgroundColor.ref.value)),R.updateIfChanged(m.uBackgroundOpacity,p.backgroundOpacity)}function l(m,p){var v=wF(m.aMapping.ref.value,m.aDepth.ref.value,p.charCount,_h(m)),h=Te.expand(Te(),p.boundingSphere,v),g=sa(h,m.aTransform.ref.value,m.instanceCount.ref.value);Te.equals(g,m.boundingSphere.ref.value)||R.update(m.boundingSphere,g),Te.equals(h,m.invariantBoundingSphere.ref.value)||(R.update(m.invariantBoundingSphere,h),R.update(m.uInvariantBoundingSphere,Wt.fromSphere(m.uInvariantBoundingSphere.ref.value,h))),R.update(m.padding,v)}function f(m){var p=Je.createRenderableState(m);return d(p,m),p}function d(m,p){Je.updateRenderableState(m,p),m.pickable=!1,m.opaque=!1,m.writeDepth=!0}})(Oo||(Oo={}));function wF(e,t,r,n){for(var a=0,i=0,o=0,s=r*4;o<s;++o){var u=2*o,c=Math.abs(e[u]);c>a&&(a=c);var l=Math.abs(e[u+1]);l>a&&(a=l);var f=Math.abs(t[o]);f>i&&(i=f)}return Math.max(i,n+n*a)}var Qs=S(),Zs=S(),Zf=S(),AF=Me.add,m1=Me.add3,Bi;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Me.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Me.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Me.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=function(f,d,m,p,v,h,g){for(var y=0;y<4;++y)m1(o,f,d,m),m1(s,p,v,h),AF(i,g)},c=function(f,d,m){for(var p=0;p<4;++p)m1(o,f[0],f[1],f[2]),m1(s,d[0],d[1],d[2]),AF(i,m)},l=function(f,d,m,p){var v=S.distance(f,d),h=Math.floor(m/2),g=1/m;S.sub(Zf,d,f);for(var y=0;y<h;++y){var b=g*(y*2+1);S.setMagnitude(Zf,Zf,v*b),S.add(Qs,f,Zf),S.setMagnitude(Zf,Zf,v*g*((y+1)*2)),S.add(Zs,f,Zf),u(Qs[0],Qs[1],Qs[2],Zs[0],Zs[1],Zs[2],p)}};return{add:u,addVec:c,addFixedCountDashes:l,addFixedLengthDashes:function(f,d,m,p){var v=S.distance(f,d);l(f,d,v/m,p)},addCage:function(f,d,m){for(var p=d.vertices,v=d.edges,h=0,g=v.length;h<g;h+=2)S.fromArray(Qs,p,v[h]*3),S.fromArray(Zs,p,v[h+1]*3),S.transformMat4(Qs,Qs,f),S.transformMat4(Zs,Zs,f),u(Qs[0],Qs[1],Qs[2],Zs[0],Zs[1],Zs[2],m)},getLines:function(){var f=i.elementCount/4,d=Me.compact(i,!0),m=Me.compact(o,!0),p=Me.compact(s,!0),v=a&&f<=a.lineCount?a.mappingBuffer.ref.value:new Float32Array(f*8),h=a&&f<=a.lineCount?a.indexBuffer.ref.value:new Uint32Array(f*6);return(!a||f>a.lineCount)&&ure(f,v,h),Xr.create(v,h,d,m,p,f,a)}}}e.create=t})(Bi||(Bi={}));function ure(e,t,r){for(var n=0;n<e;++n){var a=n*8;t[a]=-1,t[a+1]=-1,t[a+2]=1,t[a+3]=-1,t[a+4]=-1,t[a+5]=1,t[a+6]=1,t[a+7]=1}for(var n=0;n<e;++n){var i=n*4,o=n*6;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+3,r[o+5]=i+2}}var Xr;(function(e){function t(m,p,v,h,g,y,b){return b?o(m,p,v,h,g,y,b):i(m,p,v,h,g,y)}e.create=t;function r(m){var p=m?m.mappingBuffer.ref.value:new Float32Array(0),v=m?m.indexBuffer.ref.value:new Uint32Array(0),h=m?m.groupBuffer.ref.value:new Float32Array(0),g=m?m.startBuffer.ref.value:new Float32Array(0),y=m?m.endBuffer.ref.value:new Float32Array(0);return t(p,v,h,g,y,0,m)}e.createEmpty=r;function n(m,p){for(var v=m.vertexBuffer.ref.value,h=m.indexBuffer.ref.value,g=m.groupBuffer.ref.value,y=Bi.create(m.triangleCount*3,m.triangleCount/10,p),b=0,x=m.triangleCount*3;b<x;b+=3){var C=h[b],_=h[b+1],w=h[b+2],T=v[C*3],A=v[C*3+1],D=v[C*3+2],E=v[_*3],M=v[_*3+1],F=v[_*3+2],O=v[w*3],U=v[w*3+1],N=v[w*3+2];y.add(T,A,D,E,M,F,g[C]),y.add(T,A,D,O,U,N,g[C]),y.add(E,M,F,O,U,N,g[_])}return y.getLines()}e.fromMesh=n;function a(m){return Wa([m.lineCount,m.mappingBuffer.ref.version,m.indexBuffer.ref.version,m.groupBuffer.ref.version,m.startBuffer.ref.version,m.endBuffer.ref.version])}function i(m,p,v,h,g,y){var b=Te(),x,C=-1,_=-1,w={kind:"lines",lineCount:y,mappingBuffer:R.create(m),indexBuffer:R.create(p),groupBuffer:R.create(v),startBuffer:R.create(h),endBuffer:R.create(g),get boundingSphere(){var T=a(w);if(T!==C){var A=wl(w.startBuffer.ref.value,w.lineCount*4,4),D=wl(w.endBuffer.ref.value,w.lineCount*4,4);Te.expandBySphere(b,A,D),C=T}return b},get groupMapping(){return w.groupBuffer.ref.version!==_&&(x=Qm(w.groupBuffer.ref.value,w.lineCount,4),_=w.groupBuffer.ref.version),x},setBoundingSphere:function(T){Te.copy(b,T),C=a(w)}};return w}function o(m,p,v,h,g,y,b){return y>b.lineCount&&(R.update(b.mappingBuffer,m),R.update(b.indexBuffer,p)),b.lineCount=y,R.update(b.groupBuffer,v),R.update(b.startBuffer,h),R.update(b.endBuffer,g),b}function s(m,p){var v=m.startBuffer.ref.value;Wf(p,v,0,m.lineCount*4),R.update(m.startBuffer,v);var h=m.endBuffer.ref.value;Wf(p,h,0,m.lineCount*4),R.update(m.endBuffer,h)}e.transform=s,e.Params=I(I({},Je.Params),{sizeFactor:P.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:P.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:c,createValuesSimple:l,updateValues:f,updateBoundingSphere:d,createRenderableState:Je.createRenderableState,updateRenderableState:Je.updateRenderableState,createPositionIterator:u};function u(m,p){var v=m.lineCount*4,h=p.instanceCount.ref.value,g=Yf(),y=g.position,b=m.startBuffer.ref.value,x=m.endBuffer.ref.value,C=p.aTransform.ref.value,_=function(w,T){var A=w%4==0?b:x;return T<0?S.fromArray(y,A,w*3):S.transformMat4Offset(y,A,C,0,w*3,T*16),g};return Wr(v,h,2,_)}function c(m,p,v,h,g){var y=v.instanceCount,b=v.groupCount,x=u(m,p),C=ao(v,x,h.color),_=Hu(v,h.size),w=Fo(y*b),T=ju(),A=Wu(),D=Yu(),E=Xu(),M={drawCount:m.lineCount*2*3,vertexCount:m.lineCount*4,groupCount:b,instanceCount:y},F=Te.clone(m.boundingSphere),O=sa(F,p.aTransform.ref.value,y);return I(I(I(I(I(I(I(I(I(I({dGeometryType:R.create("lines"),aMapping:m.mappingBuffer,aGroup:m.groupBuffer,aStart:m.startBuffer,aEnd:m.endBuffer,elements:m.indexBuffer,boundingSphere:R.create(O),invariantBoundingSphere:R.create(F),uInvariantBoundingSphere:R.create(Wt.ofSphere(F))},C),_),w),T),A),D),E),p),Je.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),dLineSizeAttenuation:R.create(g.lineSizeAttenuation),uDoubleSided:R.create(!0),dFlipSided:R.create(!1)})}function l(m,p,v,h,g){var y=Je.createSimple(v,h,g),b=I(I({},P.getDefaultValues(e.Params)),p);return c(m,y.transform,y.locationIterator,y.theme,b)}function f(m,p){Je.updateValues(m,p),R.updateIfChanged(m.uSizeFactor,p.sizeFactor),R.updateIfChanged(m.dLineSizeAttenuation,p.lineSizeAttenuation)}function d(m,p){var v=Te.clone(p.boundingSphere),h=sa(v,m.aTransform.ref.value,m.instanceCount.ref.value);Te.equals(h,m.boundingSphere.ref.value)||R.update(m.boundingSphere,h),Te.equals(v,m.invariantBoundingSphere.ref.value)||(R.update(m.invariantBoundingSphere,v),R.update(m.uInvariantBoundingSphere,Wt.fromSphere(m.uInvariantBoundingSphere.ref.value,v)))}})(Xr||(Xr={}));var TF=S(),PF=S(),EF=S();function p1(e,t){for(var r=t.length,n=Zm(r/3),a=0;a<r;a+=3)S.fromArray(TF,e,t[a]*3),S.fromArray(PF,e,t[a+1]*3),S.fromArray(EF,e,t[a+2]*3),n.add(TF,PF,EF);return n.getPrimitive()}var v1=S();function Zm(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),a=new Uint32Array(e*3),i=0,o=0;return{add:function(s,u,c){S.toArray(s,r,i),S.toArray(u,r,i+3),S.toArray(c,r,i+6),S.triangleNormal(v1,s,u,c);for(var l=0;l<3;++l)S.toArray(v1,n,i+3*l),a[o+l]=i/3+l;i+=9,o+=3},addQuad:function(s,u,c,l){S.toArray(s,r,i),S.toArray(u,r,i+3),S.toArray(c,r,i+6),S.toArray(l,r,i+9),S.triangleNormal(v1,s,u,c);for(var f=0;f<4;++f)S.toArray(v1,n,i+3*f);var d=i/3;a[o]=d,a[o+1]=d+1,a[o+2]=d+2,a[o+3]=d+2,a[o+4]=d+3,a[o+5]=d,i+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:a}}}}var $m=S(),cre=dn();function k_(e,t){for(var r=e.vertices,n=e.normals,a=dn.directionTransform(cre,t),i=0,o=r.length;i<o;i+=3)S.transformMat4($m,S.fromArray($m,r,i),t),S.toArray($m,r,i),S.transformMat3($m,S.fromArray($m,n,i),a),S.toArray($m,n,i);return e}function $s(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),a=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+i)/e*Math.PI;n[o*3]=Math.cos(u)*a,n[o*3+1]=Math.sin(u)*a,n[o*3+2]=0}return n}function L_(e,t){return{vertices:e,edges:t}}function IF(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var N_=S.zero();function DF(e,t){for(var r=e.vertices,n=0,a=r.length;n<a;n+=3)S.transformMat4(N_,S.fromArray(N_,r,n),t),S.toArray(N_,r,n);return e}var Ku=S(),Qu=S(),Zu=S(),Jm=S(),bn=$s(4,!0);function MF(e){for(var t=12,r=e?12*3:6*4,n=Zm(t,r),a=0;a<4;++a){var i=(a+1)%4;S.set(Ku,bn[a*3],bn[a*3+1],-.5),S.set(Qu,bn[i*3],bn[i*3+1],-.5),S.set(Zu,bn[i*3],bn[i*3+1],.5),S.set(Jm,bn[a*3],bn[a*3+1],.5),e?n.add(Ku,Qu,Zu):n.addQuad(Ku,Qu,Zu,Jm)}return S.set(Ku,bn[0],bn[1],-.5),S.set(Qu,bn[3],bn[4],-.5),S.set(Zu,bn[6],bn[7],-.5),S.set(Jm,bn[9],bn[10],-.5),e?n.add(Zu,Qu,Ku):n.addQuad(Jm,Zu,Qu,Ku),S.set(Ku,bn[0],bn[1],.5),S.set(Qu,bn[3],bn[4],.5),S.set(Zu,bn[6],bn[7],.5),S.set(Jm,bn[9],bn[10],.5),e?n.add(Ku,Qu,Zu):n.addQuad(Ku,Qu,Zu,Jm),n.getPrimitive()}var U_;function z_(){return U_||(U_=MF(!1)),U_}var V_;function lre(){return V_||(V_=MF(!0)),V_}var G_;function RF(){return G_||(G_=L_([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),G_}function BF(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function FF(e,t){for(var r=Ht(Ht([{x:0,alpha:0},{x:0,alpha:0}],e,!0),[{x:1,alpha:0},{x:1,alpha:0}],!1),n=256,a=t?t.ref.value.array:new Uint8Array(n),i=0,o,s,u,c,l,f,d=e.length+1,m=0;m<d;++m){o=r[m+1].x,s=r[m+2].x,u=r[m].alpha,c=r[m+1].alpha,l=r[m+2].alpha,f=r[m+3].alpha;for(var p=Math.round((s-o)*n),v=0;v<p;++v){var h=v/p;a[i]=Math.max(0,my(u,c,l,f,h,.5)*255),++i}}var g={array:a,width:256,height:1};return t?(R.update(t,g),t):R.create(g)}function fre(e,t,r){if(r)return OF(e,t,r.min,r.max);var n=Ki(e),a=n[0],i=n[1];return OF(e,t,a,i)}function OF(e,t,r,n){var a=(n-r)/t;a===0&&(a=1);for(var i=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/a);u>=t?u=t-1:u<0&&(u=0),i[u]++}return{min:r,max:n,binWidth:a,counts:i}}var ka;(function(e){e.One={transform:{kind:"matrix",matrix:se.identity()},cells:sr.create(sr.Space([1,1,1],[0,1,2]),sr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=se.zero(),r=se.zero();function n(u){if(u.transform.kind==="matrix")return se.copy(se(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var c=u.cells.space,l=se.fromScaling(t,S.div(S.zero(),Bt.size(S.zero(),u.transform.fractionalBox),S.ofArray(c.dimensions))),f=se.fromTranslation(r,u.transform.fractionalBox.min);return se.mul3(se.zero(),u.transform.cell.fromFractional,f,l)}return se.identity()}e.getGridToCartesianTransform=n;function a(u,c){return u===c}e.areEquivalent=a;function i(u){return u.cells.data.length===0}e.isEmpty=i;function o(u,c){c||(c=Te());var l=u.cells.space.dimensions,f=e.getGridToCartesianTransform(u);return Te.fromDimensionsAndTransform(c,l,f)}e.getBoundingSphere=o;function s(u,c){var l=u._historams;return l||(l=u._historams={}),l[c]||(l[c]=fre(u.cells.data,c,{min:u.stats.min,max:u.stats.max})),l[c]}e.getHistogram=s})(ka||(ka={}));function to(e){return e}(function(e){function t(r){return r.__key||(r.__key=zr.create22()),r.__key}e.getUUID=t})(to||(to={}));var Js=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var a=0,i=n;a<i.length;a++){var o=i[a];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var a=n[r];a.dispose()}})},e}();function dre(e,t){var r=this;return Be.create("Create Volume",function(){return ie(r,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b;return ae(this,function(x){if(n=e.header,a=e.values,i=sr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=a;else for(s=n.dim,u=s[0],c=s[1],l=s[2],f=((t==null?void 0:t.dataIndex)||0)+1,d=0,m=0,o=new Float64Array(u*c*l),p=0;p<u;p++)for(v=0;v<c;v++)for(h=0;h<l;h++)o[d++]=a[m],m+=f;return g=sr.create(i,sr.Data1(o)),y=se.fromTranslation(se(),n.origin),b=se.fromBasis(se(),n.basisX,n.basisY,n.basisZ),se.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:Ty(o),max:js(o),mean:Py(o),sigma:Ey(o)}},sourceData:h1.create(e),customProperties:new Js,_propertyData:Object.create(null)}]})})})}var h1;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(h1||(h1={}));function kF(e,t){var r=this;return Be.create("Create Volume",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){return a=e.volume_data_3d_info,i=e.volume_data_3d,o=pi.create(a.spacegroup_number.value(0),S.ofArray(a.spacegroup_cell_size.value(0)),S.scale(S.zero(),S.ofArray(a.spacegroup_cell_angles.value(0)),Math.PI/180)),s=a.axis_order.value(0),u=sr.convertToCanonicalAxisIndicesFastToSlow(s),c=u(a.sample_count.value(0)),l=sr.Space(c,sr.invertAxisOrder(s),Float32Array),f=sr.create(l,sr.Data1(i.values.toArray({array:Float32Array}))),d=S.ofArray(u(a.origin.value(0))),m=S.ofArray(u(a.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Bt.create(d,S.add(S.zero(),d,m))},cells:f,stats:{min:a.min_sampled.value(0),max:a.max_sampled.value(0),mean:a.mean_sampled.value(0),sigma:a.sigma_sampled.value(0)}},sourceData:g1.create(e),customProperties:new Js,_propertyData:Object.create(null)}]})})})}var g1;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(g1||(g1={}));var vt;(function(e){function t(p){var v,h,g,y;return((y=(g=(h=(v=p==null?void 0:p.grid)===null||v===void 0?void 0:v.cells)===null||h===void 0?void 0:h.space)===null||g===void 0?void 0:g.dimensions)===null||y===void 0?void 0:y.length)&&(p==null?void 0:p.sourceData)&&(p==null?void 0:p.customProperties)&&(p==null?void 0:p._propertyData)}e.is=t;var r;(function(p){function v(w,T,A){return qr(x(w,A).absoluteValue,x(T,A).absoluteValue,A.sigma/100)}p.areSame=v;function h(w){return{kind:"absolute",absoluteValue:w}}p.absolute=h;function g(w){return{kind:"relative",relativeValue:w}}p.relative=g;function y(w,T){return T*w.sigma+w.mean}p.calcAbsolute=y;function b(w,T){return w.sigma===0?0:(T-w.mean)/w.sigma}p.calcRelative=b;function x(w,T){return w.kind==="absolute"?w:{kind:"absolute",absoluteValue:p.calcAbsolute(T,w.relativeValue)}}p.toAbsolute=x;function C(w,T){return w.kind==="relative"?w:{kind:"relative",relativeValue:p.calcRelative(T,w.absoluteValue)}}p.toRelative=C;function _(w){return w.kind==="relative"?"".concat(w.relativeValue.toFixed(2)," \u03C3"):"".concat(w.absoluteValue.toPrecision(4))}p.toString=_})(r=e.IsoValue||(e.IsoValue={}));function n(p,v,h){if(h==="relative")return r.relative(v);var g=r.absolute(v);if(g1.is(p.sourceData)){var y={min:p.sourceData.data.volume_data_3d_info.min_source.value(0),max:p.sourceData.data.volume_data_3d_info.max_source.value(0),mean:p.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:p.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(g,y)}return g}e.adjustedIsoValue=n;var a={min:-1,max:1,mean:0,sigma:.1};function i(p,v){var h=v||a,g=h.min,y=h.max,b=h.mean,x=h.sigma,C=(g-b)/x,_=(y-b)/x,w=p;return p.kind==="absolute"?p.absoluteValue<g?w=e.IsoValue.absolute(g):p.absoluteValue>y&&(w=e.IsoValue.absolute(y)):p.relativeValue<C?w=e.IsoValue.relative(C):p.relativeValue>_&&(w=e.IsoValue.relative(_)),P.Conditioned(w,{absolute:P.Converted(function(T){return e.IsoValue.toAbsolute(T,ka.One.stats).absoluteValue},function(T){return e.IsoValue.absolute(T)},P.Numeric(b,{min:g,max:y,step:UR(x/100,2)})),relative:P.Converted(function(T){return e.IsoValue.toRelative(T,ka.One.stats).relativeValue},function(T){return e.IsoValue.relative(T)},P.Numeric(Math.min(1,_),{min:C,max:_,step:UR(Math.round((y-g)/x)/100,2)}))},function(T){return T.kind==="absolute"?"absolute":"relative"},function(T,A){return A==="absolute"?e.IsoValue.toAbsolute(T,h):e.IsoValue.toRelative(T,h)},{isEssential:!0})}e.createIsoValueParam=i,e.IsoValueParam=i(e.IsoValue.relative(2)),e.One={label:"",grid:ka.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Js,_propertyData:Object.create(null)};function o(p,v){return ka.areEquivalent(p.grid,v.grid)}e.areEquivalent=o;function s(p){return ka.isEmpty(p.grid)}e.isEmpty=s;function u(p){return h1.is(p.sourceData)?p.sourceData.data.header.orbitals:!1}e.isOrbitals=u;function c(p){return{kind:"volume-loci",volume:p}}e.Loci=c;function l(p){return!!p&&p.kind==="volume-loci"}e.isLoci=l;function f(p,v){return p.volume===v.volume}e.areLociEqual=f;function d(p){return ka.isEmpty(p.volume.grid)}e.isLociEmpty=d;function m(p,v){return ka.getBoundingSphere(p.grid,v)}e.getBoundingSphere=m,function(p){function v(x,C){return{kind:"isosurface-loci",volume:x,isoValue:C}}p.Loci=v;function h(x){return!!x&&x.kind==="isosurface-loci"}p.isLoci=h;function g(x,C){return x.volume===C.volume&&e.IsoValue.areSame(x.isoValue,C.isoValue,x.volume.grid.stats)}p.areLociEqual=g;function y(x){return x.volume.grid.cells.data.length===0}p.isLociEmpty=y;function b(x,C,_){return e.getBoundingSphere(x,_)}p.getBoundingSphere=b}(e.Isosurface||(e.Isosurface={})),function(p){function v(_,w){return{kind:"cell-loci",volume:_,indices:w}}p.Loci=v;function h(_){return!!_&&_.kind==="cell-loci"}p.isLoci=h;function g(_,w){return _.volume===w.volume&&De.areEqual(_.indices,w.indices)}p.areLociEqual=g;function y(_){return De.size(_.indices)===0}p.isLociEmpty=y;var b=new Ji("98"),x=S();function C(_,w,T){b.reset();for(var A=ka.getGridToCartesianTransform(_.grid),D=_.grid.cells.space.getCoords,E=0,M=De.size(w);E<M;E++){var F=De.getAt(w,E);D(F,x),S.transformMat4(x,x,A),b.includePosition(x)}b.finishedIncludeStep();for(var E=0,M=De.size(w);E<M;E++){var F=De.getAt(w,E);D(F,x),S.transformMat4(x,x,A),b.radiusPosition(x)}var O=b.getSphere(T);return Te.expand(O,O,se.getMaxScaleOnAxis(A)*10)}p.getBoundingSphere=C}(e.Cell||(e.Cell={}))})(vt||(vt={}));var H_=z_(),ro;(function(e){function t(h,g,y,b,x,C,_,w,T,A){return A?a(h,g,y,b,x,C,_,w,T,A):n(h,g,y,b,x,C,_,w,T)}e.create=t;function r(h){return Wa([h.bboxSize.ref.version,h.gridDimension.ref.version,h.gridTexture.ref.version,h.transform.ref.version,h.gridStats.ref.version])}function n(h,g,y,b,x,C,_,w,T){var A=Te(),D=-1,E=C.getWidth(),M=C.getHeight(),F=C.getDepth(),O={kind:"direct-volume",gridDimension:R.create(g),gridTexture:R.create(C),gridTextureDim:R.create(S.create(E,M,F)),gridStats:R.create(Wt.create(_.min,_.max,_.mean,_.sigma)),bboxMin:R.create(h.min),bboxMax:R.create(h.max),bboxSize:R.create(S.sub(S(),h.max,h.min)),transform:R.create(y),cellDim:R.create(x),unitToCartn:R.create(b),cartnToUnit:R.create(se.invert(se(),b)),get boundingSphere(){var U=r(O);if(U!==D){var N=mre(O.gridDimension.ref.value,O.transform.ref.value);Te.copy(A,N),D=U}return A},packedGroup:R.create(w),axisOrder:R.create(T),setBoundingSphere:function(U){Te.copy(A,U),D=r(O)}};return O}function a(h,g,y,b,x,C,_,w,T,A){var D=C.getWidth(),E=C.getHeight(),M=C.getDepth();return R.update(A.gridDimension,g),R.update(A.gridTexture,C),R.update(A.gridTextureDim,S.set(A.gridTextureDim.ref.value,D,E,M)),R.update(A.gridStats,Wt.set(A.gridStats.ref.value,_.min,_.max,_.mean,_.sigma)),R.update(A.bboxMin,h.min),R.update(A.bboxMax,h.max),R.update(A.bboxSize,S.sub(A.bboxSize.ref.value,h.max,h.min)),R.update(A.transform,y),R.update(A.cellDim,x),R.update(A.unitToCartn,b),R.update(A.cartnToUnit,se.invert(se(),b)),R.updateIfChanged(A.packedGroup,w),R.updateIfChanged(A.axisOrder,S.fromArray(A.axisOrder.ref.value,T,0)),A}function i(h){var g=Bt(),y=S(),b=se.identity(),x=se.identity(),C=S(),_=vi(),w=ka.One.stats,T=!1,A=S.create(0,1,2);return t(g,y,b,x,C,_,w,T,A,h)}e.createEmpty=i,e.Params=I(I({},Je.Params),{ignoreLight:P.Boolean(!1,Je.ShadingCategory),xrayShaded:P.Boolean(!1,Je.ShadingCategory),controlPoints:P.LineGraph([Fe.create(.19,0),Fe.create(.2,.05),Fe.create(.25,.05),Fe.create(.26,0),Fe.create(.79,0),Fe.create(.8,.05),Fe.create(.85,.05),Fe.create(.86,0)],{isEssential:!0}),stepsPerCell:P.Numeric(3,{min:1,max:10,step:1}),jumpLength:P.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:i,createValues:l,createValuesSimple:f,updateValues:d,updateBoundingSphere:m,createRenderableState:p,updateRenderableState:v,createPositionIterator:o};function o(h,g){var y=h.transform.ref.value,b=h.gridDimension.ref.value,x=b[0],C=b[1],_=b[2],w=x*C*_,T=g.instanceCount.ref.value,A=Yf(),D=A.position,E=g.aTransform.ref.value,M=function(F,O){var U=Math.floor(F/_);return D[0]=Math.floor(U/C),D[1]=U%C,D[2]=F%_,S.transformMat4(D,D,y),O>=0&&S.transformMat4Offset(D,D,E,0,0,O*16),A};return Wr(w,T,1,M)}function s(h,g){return Math.ceil(S.magnitude(h)*g)}function u(h,g){return Math.min.apply(Math,h)*(1/g)}function c(h){return 1/h}function l(h,g,y,b,x){var C=h.gridTexture,_=h.gridTextureDim,w=h.gridStats,T=h.bboxSize,A=h.bboxMin,D=h.bboxMax,E=h.gridDimension,M=h.transform,F=y.instanceCount,O=y.groupCount,U=e.Utils.createPositionIterator(h,g),N=ao(y,U,b.color),q=Fo(F*O),j=ju(),Q=Wu(),J=Yu(),te=Xu(),K=E.ref.value,L=K[0],W=K[1],k=K[2],V={drawCount:H_.indices.length,vertexCount:L*W*k,groupCount:O,instanceCount:F},G=Te.clone(h.boundingSphere),H=sa(G,g.aTransform.ref.value,F),X=BF(x.controlPoints),Y=FF(X);return I(I(I(I(I(I(I(I(I({dGeometryType:R.create("directVolume")},N),q),j),Q),J),te),g),Je.createValues(x,V)),{aPosition:R.create(H_.vertices),elements:R.create(H_.indices),boundingSphere:R.create(H),invariantBoundingSphere:R.create(G),uInvariantBoundingSphere:R.create(Wt.ofSphere(G)),uBboxMin:A,uBboxMax:D,uBboxSize:T,uMaxSteps:R.create(s(E.ref.value,x.stepsPerCell)),uStepScale:R.create(u(h.cellDim.ref.value,x.stepsPerCell)),uJumpLength:R.create(x.jumpLength),uTransform:M,uGridDim:E,tTransferTex:Y,uTransferScale:R.create(c(x.stepsPerCell)),dGridTexType:R.create(C.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:_,tGridTex:C,uGridStats:w,uCellDim:h.cellDim,uCartnToUnit:h.cartnToUnit,uUnitToCartn:h.unitToCartn,dPackedGroup:h.packedGroup,dAxisOrder:R.create(h.axisOrder.ref.value.join("")),dIgnoreLight:R.create(x.ignoreLight),dXrayShaded:R.create(x.xrayShaded)})}function f(h,g,y,b,x){var C=Je.createSimple(y,b,x),_=I(I({},P.getDefaultValues(e.Params)),g);return l(h,C.transform,C.locationIterator,C.theme,_)}function d(h,g){Je.updateValues(h,g),R.updateIfChanged(h.dIgnoreLight,g.ignoreLight),R.updateIfChanged(h.dXrayShaded,g.xrayShaded);var y=BF(g.controlPoints);FF(y,h.tTransferTex),R.updateIfChanged(h.uMaxSteps,s(h.uGridDim.ref.value,g.stepsPerCell)),R.updateIfChanged(h.uStepScale,u(h.uCellDim.ref.value,g.stepsPerCell)),R.updateIfChanged(h.uTransferScale,c(g.stepsPerCell)),R.updateIfChanged(h.uJumpLength,g.jumpLength)}function m(h,g){var y=Te.clone(g.boundingSphere),b=sa(y,h.aTransform.ref.value,h.instanceCount.ref.value);Te.equals(b,h.boundingSphere.ref.value)||R.update(h.boundingSphere,b),Te.equals(y,h.invariantBoundingSphere.ref.value)||(R.update(h.invariantBoundingSphere,y),R.update(h.uInvariantBoundingSphere,Wt.fromSphere(h.uInvariantBoundingSphere.ref.value,y)))}function p(h){var g=Je.createRenderableState(h);return g.opaque=!1,g.writeDepth=!1,g}function v(h,g){Je.updateRenderableState(h,g),h.opaque=!1,h.writeDepth=!1}})(ro||(ro={}));function mre(e,t){return Te.fromDimensionsAndTransform(Te(),e,t)}var Tl;(function(e){function t(m,p,v,h,g,y){return y?i(m,p,v,h,g,y):a(m,p,v,h,g)}e.create=t;function r(m){var p=m?m.centerBuffer.ref.value:new Float32Array(0),v=m?m.mappingBuffer.ref.value:new Float32Array(0),h=m?m.indexBuffer.ref.value:new Uint32Array(0),g=m?m.groupBuffer.ref.value:new Float32Array(0);return t(p,v,h,g,0,m)}e.createEmpty=r;function n(m){return Wa([m.sphereCount,m.centerBuffer.ref.version,m.mappingBuffer.ref.version,m.indexBuffer.ref.version,m.groupBuffer.ref.version])}function a(m,p,v,h,g){var y=Te(),b,x=-1,C=-1,_={kind:"spheres",sphereCount:g,centerBuffer:R.create(m),mappingBuffer:R.create(p),indexBuffer:R.create(v),groupBuffer:R.create(h),get boundingSphere(){var w=n(_);if(w!==x){var T=wl(_.centerBuffer.ref.value,_.sphereCount*4,4);Te.copy(y,T),x=w}return y},get groupMapping(){return _.groupBuffer.ref.version!==C&&(b=Qm(_.groupBuffer.ref.value,_.sphereCount,4),C=_.groupBuffer.ref.version),b},setBoundingSphere:function(w){Te.copy(y,w),x=n(_)}};return _}function i(m,p,v,h,g,y){return g>y.sphereCount&&(R.update(y.mappingBuffer,p),R.update(y.indexBuffer,v)),y.sphereCount=g,R.update(y.centerBuffer,m),R.update(y.groupBuffer,h),y}e.Params=I(I({},Je.Params),{sizeFactor:P.Numeric(1,{min:0,max:10,step:.1}),doubleSided:P.Boolean(!1,Je.CustomQualityParamInfo),ignoreLight:P.Boolean(!1,Je.ShadingCategory),xrayShaded:P.Boolean(!1,Je.ShadingCategory),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory),bumpAmplitude:P.Numeric(1,{min:0,max:5,step:.1},Je.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:c,updateBoundingSphere:l,createRenderableState:f,updateRenderableState:d,createPositionIterator:o};function o(m,p){var v=m.sphereCount*4,h=p.instanceCount.ref.value,g=Yf(),y=g.position,b=m.centerBuffer.ref.value,x=p.aTransform.ref.value,C=function(_,w){return w<0?S.fromArray(y,b,_*3):S.transformMat4Offset(y,b,x,0,_*3,w*16),g};return Wr(v,h,4,C)}function s(m,p,v,h,g){var y=v.instanceCount,b=v.groupCount,x=o(m,p),C=ao(v,x,h.color),_=Hu(v,h.size),w=Fo(y*b),T=ju(),A=Wu(),D=Yu(),E=Xu(),M={drawCount:m.sphereCount*2*3,vertexCount:m.sphereCount*4,groupCount:b,instanceCount:y},F=m.boundingSphere.radius?_h(_)*g.sizeFactor:0,O=Te.expand(Te(),m.boundingSphere,F),U=sa(O,p.aTransform.ref.value,y);return I(I(I(I(I(I(I(I(I(I(I({dGeometryType:R.create("spheres"),aPosition:m.centerBuffer,aMapping:m.mappingBuffer,aGroup:m.groupBuffer,elements:m.indexBuffer,boundingSphere:R.create(U),invariantBoundingSphere:R.create(O),uInvariantBoundingSphere:R.create(Wt.ofSphere(O))},C),_),w),T),A),D),E),p),{padding:R.create(F)}),Je.createValues(g,M)),{uSizeFactor:R.create(g.sizeFactor),uDoubleSided:R.create(g.doubleSided),dIgnoreLight:R.create(g.ignoreLight),dXrayShaded:R.create(g.xrayShaded),uBumpFrequency:R.create(g.bumpFrequency),uBumpAmplitude:R.create(g.bumpAmplitude)})}function u(m,p,v,h,g){var y=Je.createSimple(v,h,g),b=I(I({},P.getDefaultValues(e.Params)),p);return s(m,y.transform,y.locationIterator,y.theme,b)}function c(m,p){Je.updateValues(m,p),R.updateIfChanged(m.uSizeFactor,p.sizeFactor),R.updateIfChanged(m.uDoubleSided,p.doubleSided),R.updateIfChanged(m.dIgnoreLight,p.ignoreLight),R.updateIfChanged(m.dXrayShaded,p.xrayShaded),R.updateIfChanged(m.uBumpFrequency,p.bumpFrequency),R.updateIfChanged(m.uBumpAmplitude,p.bumpAmplitude)}function l(m,p){var v=p.boundingSphere.radius?_h(m)*m.uSizeFactor.ref.value:0,h=Te.expand(Te(),p.boundingSphere,v),g=sa(h,m.aTransform.ref.value,m.instanceCount.ref.value);Te.equals(g,m.boundingSphere.ref.value)||R.update(m.boundingSphere,g),Te.equals(h,m.invariantBoundingSphere.ref.value)||(R.update(m.invariantBoundingSphere,h),R.update(m.uInvariantBoundingSphere,Wt.fromSphere(m.uInvariantBoundingSphere.ref.value,h))),R.update(m.padding,v)}function f(m){var p=Je.createRenderableState(m);return d(p,m),p}function d(m,p){Je.updateRenderableState(m,p),m.opaque=m.opaque&&!p.xrayShaded,m.writeDepth=m.opaque}})(Tl||(Tl={}));var ko;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(c,l,f){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:c,group:l,normal:f}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var c=0,l=this.textures;c<l.length;c++){var f=l[c];f.vertex.destroy(),f.group.destroy(),f.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,c,l,f,d,m,p){var v=l.getWidth(),h=l.getHeight();return p?(p.vertexCount=u,p.groupCount=c,R.update(p.geoTextureDim,Fe.set(p.geoTextureDim.ref.value,v,h)),R.update(p.vertexTexture,l),R.update(p.groupTexture,f),R.update(p.normalTexture,d),p.doubleBuffer.set(l,f,d),Te.copy(p.boundingSphere,m),p):{kind:"texture-mesh",vertexCount:u,groupCount:c,geoTextureDim:R.create(Fe.create(v,h)),vertexTexture:R.create(l),groupTexture:R.create(f),normalTexture:R.create(d),doubleBuffer:new t,boundingSphere:Te.clone(m),meta:{}}}e.create=r;function n(u){var c=u?u.vertexTexture.ref.value:vi(),l=u?u.groupTexture.ref.value:vi(),f=u?u.normalTexture.ref.value:vi(),d=u?u.boundingSphere:Te();return r(0,0,c,l,f,d,u)}e.createEmpty=n,e.Params=I(I({},Je.Params),{doubleSided:P.Boolean(!1,Je.CustomQualityParamInfo),flipSided:P.Boolean(!1,Je.ShadingCategory),flatShaded:P.Boolean(!1,Je.ShadingCategory),ignoreLight:P.Boolean(!1,Je.ShadingCategory),xrayShaded:P.Boolean(!1,Je.ShadingCategory),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory),bumpAmplitude:P.Numeric(1,{min:0,max:5,step:.1},Je.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:i,updateValues:o,updateBoundingSphere:s,createRenderableState:Je.createRenderableState,updateRenderableState:Je.updateRenderableState,createPositionIterator:function(){return Wr(1,1,1,function(){return eo})}};function a(u,c,l,f,d){var m=l.instanceCount,p=l.groupCount,v=e.Utils.createPositionIterator(u,c),h=ao(l,v,f.color),g=Fo(m*p),y=ju(),b=Wu(),x=Yu(),C=Xu(),_={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:p,instanceCount:m},w=Te.clone(u.boundingSphere),T=sa(w,c.aTransform.ref.value,m);return I(I(I(I(I(I(I(I(I({dGeometryType:R.create("textureMesh"),uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:R.create(T),invariantBoundingSphere:R.create(w),uInvariantBoundingSphere:R.create(Wt.ofSphere(w))},h),g),y),b),x),C),c),Je.createValues(d,_)),{uDoubleSided:R.create(d.doubleSided),dFlatShaded:R.create(d.flatShaded),dFlipSided:R.create(d.flipSided),dIgnoreLight:R.create(d.ignoreLight),dXrayShaded:R.create(d.xrayShaded),uBumpFrequency:R.create(d.bumpFrequency),uBumpAmplitude:R.create(d.bumpAmplitude),meta:R.create(u.meta)})}function i(u,c,l,f,d){var m=Je.createSimple(l,f,d),p=I(I({},P.getDefaultValues(e.Params)),c);return a(u,m.transform,m.locationIterator,m.theme,p)}function o(u,c){Je.updateValues(u,c),R.updateIfChanged(u.uDoubleSided,c.doubleSided),R.updateIfChanged(u.dFlatShaded,c.flatShaded),R.updateIfChanged(u.dFlipSided,c.flipSided),R.updateIfChanged(u.dIgnoreLight,c.ignoreLight),R.updateIfChanged(u.dXrayShaded,c.xrayShaded),R.updateIfChanged(u.uBumpFrequency,c.bumpFrequency),R.updateIfChanged(u.uBumpAmplitude,c.bumpAmplitude)}function s(u,c){var l=Te.clone(c.boundingSphere),f=sa(l,u.aTransform.ref.value,u.instanceCount.ref.value);Te.equals(f,u.boundingSphere.ref.value)||R.update(u.boundingSphere,f),Te.equals(l,u.invariantBoundingSphere.ref.value)||(R.update(u.invariantBoundingSphere,l),R.update(u.uInvariantBoundingSphere,Wt.fromSphere(u.uInvariantBoundingSphere.ref.value,l)))}})(ko||(ko={}));function pre(e,t){var r={},n={},a={},i={},o={},s={};return Object.keys(e).forEach(function(u){var c=e[u];c.type==="attribute"&&(r[u]=t[u]),c.type==="define"&&(n[u]=t[u]),c.type==="texture"&&t[u]!==void 0&&(a[u]=t[u]),c.type==="uniform"&&t[u]!==void 0&&(c.variant==="material"?o[u]=t[u]:c.variant==="buffered"?s[u]=t[u]:i[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:a,uniformValues:i,materialUniformValues:o,bufferedUniformValues:s}}function vre(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function wr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ee(e,t){return{type:"uniform",kind:e,variant:t}}function Lt(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function $f(e){return{type:"elements",kind:e}}function Ot(e,t){return{type:"define",kind:e,options:t}}function xn(e){return{type:"value",kind:e}}var $u={uModel:Ee("m4"),uView:Ee("m4"),uInvView:Ee("m4"),uModelView:Ee("m4"),uInvModelView:Ee("m4"),uProjection:Ee("m4"),uInvProjection:Ee("m4"),uModelViewProjection:Ee("m4"),uInvModelViewProjection:Ee("m4"),uIsOrtho:Ee("f"),uPixelRatio:Ee("f"),uViewport:Ee("v4"),uViewOffset:Ee("v2"),uDrawingBufferSize:Ee("v2"),uCameraPosition:Ee("v3"),uCameraDir:Ee("v3"),uNear:Ee("f"),uFar:Ee("f"),uFogNear:Ee("f"),uFogFar:Ee("f"),uFogColor:Ee("v3"),uTransparentBackground:Ee("b"),uLightDirection:Ee("v3[]"),uLightColor:Ee("v3[]"),uAmbientColor:Ee("v3"),uPickingAlphaThreshold:Ee("f"),uInteriorDarkening:Ee("f"),uInteriorColorFlag:Ee("b"),uInteriorColor:Ee("v3"),uHighlightColor:Ee("v3"),uSelectColor:Ee("v3"),uHighlightStrength:Ee("f"),uSelectStrength:Ee("f"),uMarkerPriority:Ee("i"),uXrayEdgeFalloff:Ee("f"),uRenderWboit:Ee("b"),uMarkingDepthTest:Ee("b"),uMarkingType:Ee("i"),uPickType:Ee("i")},Ju={tDepth:Lt("texture","depth","ushort","nearest")},ec={uObjectId:Ee("i")},hre={uColor:Ee("v3","material"),uColorTexDim:Ee("v2"),uColorGridDim:Ee("v3"),uColorGridTransform:Ee("v4"),tColor:Lt("image-uint8","rgb","ubyte","nearest"),tPalette:Lt("image-uint8","rgb","ubyte","nearest"),tColorGrid:Lt("texture","rgb","ubyte","linear"),dColorType:Ot("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:Ot("boolean")},Ah={uSize:Ee("f","material"),uSizeTexDim:Ee("v2"),tSize:Lt("image-uint8","rgb","ubyte","nearest"),dSizeType:Ot("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ee("f")},gre={uMarker:Ee("f"),uMarkerTexDim:Ee("v2"),tMarker:Lt("image-uint8","alpha","ubyte","nearest"),markerAverage:xn("number"),markerStatus:xn("number")},yre={uOverpaintTexDim:Ee("v2"),tOverpaint:Lt("image-uint8","rgba","ubyte","nearest"),dOverpaint:Ot("boolean"),uOverpaintGridDim:Ee("v3"),uOverpaintGridTransform:Ee("v4"),tOverpaintGrid:Lt("texture","rgba","ubyte","linear"),dOverpaintType:Ot("string",["groupInstance","volumeInstance"])},bre={uTransparencyTexDim:Ee("v2"),tTransparency:Lt("image-uint8","alpha","ubyte","nearest"),dTransparency:Ot("boolean"),transparencyAverage:xn("number"),uTransparencyGridDim:Ee("v3"),uTransparencyGridTransform:Ee("v4"),tTransparencyGrid:Lt("texture","alpha","ubyte","linear"),dTransparencyType:Ot("string",["groupInstance","volumeInstance"])},xre={uSubstanceTexDim:Ee("v2"),tSubstance:Lt("image-uint8","rgba","ubyte","nearest"),dSubstance:Ot("boolean"),uSubstanceGridDim:Ee("v3"),uSubstanceGridTransform:Ee("v4"),tSubstanceGrid:Lt("texture","rgba","ubyte","linear"),dSubstanceType:Ot("string",["groupInstance","volumeInstance"])},Sre={uClippingTexDim:Ee("v2"),tClipping:Lt("image-uint8","alpha","ubyte","nearest"),dClipping:Ot("boolean")},tc=I(I(I(I(I(I(I({dGeometryType:Ot("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"])},hre),gre),yre),bre),xre),Sre),{dLightCount:Ot("number"),dClipObjectCount:Ot("number"),dClipVariant:Ot("string",["instance","pixel"]),uClipObjectType:Ee("i[]"),uClipObjectInvert:Ee("b[]"),uClipObjectPosition:Ee("v3[]"),uClipObjectRotation:Ee("v4[]"),uClipObjectScale:Ee("v3[]"),aInstance:wr("float32",1,1),aTransform:wr("float32",16,1),uAlpha:Ee("f","material"),uMetalness:Ee("f","material"),uRoughness:Ee("f","material"),uBumpiness:Ee("f","material"),uVertexCount:Ee("i"),uInstanceCount:Ee("i"),uGroupCount:Ee("i"),uInvariantBoundingSphere:Ee("v4"),drawCount:xn("number"),instanceCount:xn("number"),alpha:xn("number"),matrix:xn("m4"),transform:xn("float32"),extraTransform:xn("float32"),hasReflection:xn("boolean"),boundingSphere:xn("sphere"),invariantBoundingSphere:xn("sphere")}),Cre=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,Ka=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,_re=ja();function wre(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var Are={colorBlended:"",colorWboit:"",pick:"",depth:"",marking:""},q_=Object.keys(Are),y1=q_.filter(function(e){return e!=="colorWboit"}),Tre=q_.filter(function(e){return e!=="colorBlended"}),Pre={compute:""},Ere=Object.keys(Pre);function LF(e,t,r,n,a){return r=I(I({},r),{dRenderVariant:R.create(t)}),a.dRenderVariant===void 0&&Object.defineProperty(a,"dRenderVariant",{value:Ot("string")}),e.resources.program(r,n,a)}function Ire(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function Dre(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function rc(e,t,r,n,a,i,o){return NF(e,t,r,n,a,i,o)}function zn(e,t,r,n,a,i){return i===void 0&&(i=-1),NF(e,t,r,n,a,i,Ere)}function NF(e,t,r,n,a,i,o){var s=_re(),u=e.stats,c=e.state,l=e.resources,f=e.extensions,d=f.instancedArrays,m=f.vertexArrayObject;if(a.uVertexCount){var p=a.uVertexCount.ref.value;a.aVertex=R.create(Po(new Float32Array(p))),n.aVertex=wr("float32",1,0)}for(var v=pre(n,a),h=v.attributeValues,g=v.defineValues,y=v.textureValues,b=v.uniformValues,x=v.materialUniformValues,C=v.bufferedUniformValues,_=Object.entries(b),w=Object.entries(x),T=Object.entries(C),A=Object.entries(Uee(C)),D=Object.entries(g),E=vre(a),M=wre(e,t),F={},O=0,U=o;O<U.length;O++){var N=U[O];F[N]=LF(e,N,g,r,n)}var q=Kte(e,n,y),j=Wee(e,n,h),Q,J=a.elements;J&&J.ref.value&&(Q=l.elements(J.ref.value));for(var te={},K=0,L=o;K<L.length;K++){var N=L[K];te[N]=m?l.vertexArray(F[N],j,Q):null}var W=a.drawCount.ref.value,k=a.instanceCount.ref.value;u.drawCount+=W,u.instanceCount+=k,u.instancedDrawCount+=k*W;var V=Ire(),G=!1,H=-1;return{id:s,materialId:i,getProgram:function(X){return F[X]},render:function(X,Y){if(!(W===0||k===0||e.isContextLost)){var oe=F[X];if(oe.id===H&&c.currentRenderItemId===s)oe.setUniforms(_),Y&&Y.length>0?(oe.bindTextures(Y,0),oe.bindTextures(q,Y.length)):oe.bindTextures(q,0);else{var ue=te[X];(oe.id!==c.currentProgramId||oe.id!==H||i===-1||i!==c.currentMaterialId)&&(oe.id!==c.currentProgramId&&oe.use(),oe.setUniforms(w),c.currentMaterialId=i,H=oe.id),oe.setUniforms(_),oe.setUniforms(A),Y&&Y.length>0?(oe.bindTextures(Y,0),oe.bindTextures(q,Y.length)):oe.bindTextures(q,0),ue?(ue.bind(),Q&&Q.bind()):(Q&&Q.bind(),oe.bindAttributes(j)),c.currentRenderItemId=s}if(hr)try{M_(e.gl)}catch(me){throw new Error("Framebuffer error rendering item id ".concat(s,": '").concat(me,"'"))}if(Q?d.drawElementsInstanced(M,W,Q._dataType,0,k):d.drawArraysInstanced(M,0,W,k),hr)try{rF(e.gl)}catch(me){throw new Error("Draw error rendering item id ".concat(s,": '").concat(me,"'"))}}},update:function(){if(Dre(V),a.aVertex){var X=a.uVertexCount.ref.value;a.aVertex.ref.value.length<X&&R.update(a.aVertex,Po(new Float32Array(X)))}for(var Y=0,oe=D.length;Y<oe;++Y){var ue=D[Y],me=ue[0],he=ue[1];he.ref.version!==E[me]&&(V.defines=!0,E[me]=he.ref.version)}if(V.defines)for(var Pe=0,re=o;Pe<re.length;Pe++){var me=re[Pe];F[me].destroy(),F[me]=LF(e,me,g,r,n)}a.drawCount.ref.version!==E.drawCount&&(u.drawCount+=a.drawCount.ref.value-W,u.instancedDrawCount+=k*a.drawCount.ref.value-k*W,W=a.drawCount.ref.value,E.drawCount=a.drawCount.ref.version),a.instanceCount.ref.version!==E.instanceCount&&(u.instanceCount+=a.instanceCount.ref.value-k,u.instancedDrawCount+=a.instanceCount.ref.value*W-k*W,k=a.instanceCount.ref.value,E.instanceCount=a.instanceCount.ref.version);for(var Y=0,oe=j.length;Y<oe;++Y){var ee=j[Y],me=ee[0],B=ee[1],he=h[me];if(he.ref.version!==E[me]){if(B.length>=he.ref.value.length)B.updateSubData(he.ref.value,0,B.length);else{B.destroy();var z=n[me],le=z.itemSize,pe=z.divisor;j[Y][1]=l.attribute(he.ref.value,le,pe),V.attributes=!0}E[me]=he.ref.version}}if(Q&&a.elements.ref.version!==E.elements&&(Q.length>=a.elements.ref.value.length?Q.updateSubData(a.elements.ref.value,0,Q.length):(Q.destroy(),Q=l.elements(a.elements.ref.value),V.elements=!0),E.elements=a.elements.ref.version),V.attributes||V.defines||V.elements)for(var ge=0,Ce=o;ge<Ce.length;ge++){var me=Ce[ge],Ie=te[me];Ie&&Ie.destroy(),te[me]=m?l.vertexArray(F[me],j,Q):null}for(var Y=0,oe=q.length;Y<oe;++Y){var Oe=q[Y],me=Oe[0],We=Oe[1],he=y[me];he.ref.version!==E[me]&&(n[me].kind!=="texture"?(We.load(he.ref.value),V.textures=!0):q[Y][1]=he.ref.value,E[me]=he.ref.version)}for(var Y=0,oe=T.length;Y<oe;++Y){var Ne=T[Y],me=Ne[0],Ye=Ne[1];Ye.ref.version!==E[me]&&(R.update(A[Y][1],ol(Ye.ref.value)),E[me]=Ye.ref.version)}return V},destroy:function(){if(!G){for(var X=0,Y=o;X<Y.length;X++){var oe=Y[X];F[oe].destroy();var ue=te[oe];ue&&ue.destroy()}q.forEach(function(me){var he=me[0],Pe=me[1];n[he].kind!=="texture"&&Pe.destroy()}),j.forEach(function(me){me[0];var he=me[1];return he.destroy()}),Q&&Q.destroy(),u.drawCount-=W,u.instanceCount-=k,u.instancedDrawCount-=k*W,G=!0}}}}var UF=ja();function nc(e,t,r){return{id:UF(),materialId:e.materialId,values:t,state:r,render:function(n,a){t.uAlpha&&t.alpha&&R.updateIfChanged(t.uAlpha,Ra(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,a)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function Vn(e,t){return{id:UF(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var zF=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),ua={drawCount:xn("number"),instanceCount:xn("number"),aPosition:wr("float32",2,0),uQuadScale:Ee("v2")},ca={drawCount:R.create(6),instanceCount:R.create(1),aPosition:R.create(zF),uQuadScale:R.create(Fe.create(1,1))},Mre=I(I({},ua),{tColor:Lt("texture","rgba","ubyte","nearest"),uTexSize:Ee("v2")}),Rre=Qr("copy",Ka,Cre);function VF(e,t){var r=I(I({},ca),{tColor:R.create(t),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight()))}),n=I({},Mre),a=zn(e,"triangles",Rre,n,r);return Vn(a,r)}var GF=new Uint32Array([0,1,2,1,3,2]),Bre=new Float32Array([0,1,0,0,1,1,1,0]),HF={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},Fre=Object.keys(HF),ac;(function(e){function t(d,m,p,v){return v?a(d,m,p,v):n(d,m,p)}e.create=t;function r(d){return Wa([d.cornerBuffer.ref.version])}function n(d,m,p){var v=Te(),h=-1,g=d.width,y=d.height,b={kind:"image",imageTexture:R.create(d),imageTextureDim:R.create(Fe.create(g,y)),cornerBuffer:R.create(m),groupTexture:R.create(p),get boundingSphere(){var x=r(b);if(x!==h){var C=Ore(b.cornerBuffer.ref.value);Te.copy(v,C),h=x}return v}};return b}function a(d,m,p,v){var h=d.width,g=d.height;return R.update(v.imageTexture,d),R.update(v.imageTextureDim,Fe.set(v.imageTextureDim.ref.value,h,g)),R.update(v.cornerBuffer,m),R.update(v.groupTexture,p),v}function i(d){var m=Yn(0,4,Uint8Array),p=d?d.cornerBuffer.ref.value:new Float32Array(8*3),v=Yn(0,4,Uint8Array);return t(m,p,v,d)}e.createEmpty=i,e.Params=I(I({},Je.Params),{interpolation:P.Select("bspline",P.objectToOptions(HF))}),e.Utils={Params:e.Params,createEmpty:i,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:c,createRenderableState:l,updateRenderableState:f,createPositionIterator:function(){return Wr(1,1,1,function(){return eo})}};function o(d,m,p,v,h){var g=p.instanceCount,y=p.groupCount,b=e.Utils.createPositionIterator(d,m),x=ao(p,b,v.color),C=Fo(g*y),_=ju(),w=Wu(),T=Yu(),A=Xu(),D={drawCount:GF.length,vertexCount:zF.length/3,groupCount:y,instanceCount:g},E=Te.clone(d.boundingSphere),M=sa(E,m.aTransform.ref.value,g);return I(I(I(I(I(I(I(I(I({dGeometryType:R.create("image")},x),C),_),w),T),A),m),Je.createValues(h,D)),{aPosition:d.cornerBuffer,aUv:R.create(Bre),elements:R.create(GF),aGroup:R.create(Po(new Float32Array(4))),boundingSphere:R.create(M),invariantBoundingSphere:R.create(E),uInvariantBoundingSphere:R.create(Wt.ofSphere(E)),dInterpolation:R.create(h.interpolation),uImageTexDim:d.imageTextureDim,tImageTex:d.imageTexture,tGroupTex:d.groupTexture})}function s(d,m,p,v,h){var g=Je.createSimple(p,v,h),y=I(I({},P.getDefaultValues(e.Params)),m);return o(d,g.transform,g.locationIterator,g.theme,y)}function u(d,m){Je.updateValues(d,m),R.updateIfChanged(d.dInterpolation,m.interpolation)}function c(d,m){var p=Te.clone(m.boundingSphere),v=sa(p,d.aTransform.ref.value,d.instanceCount.ref.value);Te.equals(v,d.boundingSphere.ref.value)||R.update(d.boundingSphere,v),Te.equals(p,d.invariantBoundingSphere.ref.value)||(R.update(d.invariantBoundingSphere,p),R.update(d.uInvariantBoundingSphere,Wt.fromSphere(d.uInvariantBoundingSphere.ref.value,p)))}function l(d){var m=Je.createRenderableState(d);return m.opaque=!1,m}function f(d,m){Je.updateRenderableState(d,m),d.opaque=!1}})(ac||(ac={}));function Ore(e){for(var t=S(),r=[],n=0,a=e.length;n<a;n+=3){var i=S.fromArray(S(),e,n);r.push(i),S.add(t,t,i)}S.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var i=u[s],c=S.distance(t,i);c>o&&(o=c)}var l=Te.create(t,o);return Te.setExtrema(l,r),l}var no;(function(e){function t(p,v,h,g,y,b,x,C,_){return _?i(p,v,h,g,y,b,x,C,_):a(p,v,h,g,y,b,x,C)}e.create=t;function r(p){var v=p?p.mappingBuffer.ref.value:new Float32Array(0),h=p?p.indexBuffer.ref.value:new Uint32Array(0),g=p?p.groupBuffer.ref.value:new Float32Array(0),y=p?p.startBuffer.ref.value:new Float32Array(0),b=p?p.endBuffer.ref.value:new Float32Array(0),x=p?p.scaleBuffer.ref.value:new Float32Array(0),C=p?p.capBuffer.ref.value:new Float32Array(0);return t(v,h,g,y,b,x,C,0,p)}e.createEmpty=r;function n(p){return Wa([p.cylinderCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version,p.scaleBuffer.ref.version,p.capBuffer.ref.version])}function a(p,v,h,g,y,b,x,C){var _=Te(),w,T=-1,A=-1,D={kind:"cylinders",cylinderCount:C,mappingBuffer:R.create(p),indexBuffer:R.create(v),groupBuffer:R.create(h),startBuffer:R.create(g),endBuffer:R.create(y),scaleBuffer:R.create(b),capBuffer:R.create(x),get boundingSphere(){var E=n(D);if(E!==T){var M=wl(D.startBuffer.ref.value,D.cylinderCount*6,6),F=wl(D.endBuffer.ref.value,D.cylinderCount*6,6);Te.expandBySphere(_,M,F),T=E}return _},get groupMapping(){return D.groupBuffer.ref.version!==A&&(w=Qm(D.groupBuffer.ref.value,D.cylinderCount,6),A=D.groupBuffer.ref.version),w},setBoundingSphere:function(E){Te.copy(_,E),T=n(D)}};return D}function i(p,v,h,g,y,b,x,C,_){return C>_.cylinderCount&&(R.update(_.mappingBuffer,p),R.update(_.indexBuffer,v)),_.cylinderCount=C,R.update(_.groupBuffer,h),R.update(_.startBuffer,g),R.update(_.endBuffer,y),R.update(_.scaleBuffer,b),R.update(_.capBuffer,x),_}function o(p,v){var h=p.startBuffer.ref.value;Wf(v,h,0,p.cylinderCount*6),R.update(p.startBuffer,h);var g=p.endBuffer.ref.value;Wf(v,g,0,p.cylinderCount*6),R.update(p.endBuffer,g)}e.transform=o,e.Params=I(I({},Je.Params),{sizeFactor:P.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:P.Numeric(1,{min:0,max:3,step:.01}),doubleSided:P.Boolean(!1,Je.CustomQualityParamInfo),ignoreLight:P.Boolean(!1,Je.ShadingCategory),xrayShaded:P.Boolean(!1,Je.ShadingCategory),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory),bumpAmplitude:P.Numeric(1,{min:0,max:5,step:.1},Je.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:c,updateValues:l,updateBoundingSphere:f,createRenderableState:d,updateRenderableState:m,createPositionIterator:s};function s(p,v){var h=p.cylinderCount*6,g=v.instanceCount.ref.value,y=Yf(),b=y.position,x=p.startBuffer.ref.value,C=p.endBuffer.ref.value,_=v.aTransform.ref.value,w=function(T,A){var D=T%6==0?x:C;return A<0?S.fromArray(b,D,T*3):S.transformMat4Offset(b,D,_,0,T*3,A*16),y};return Wr(h,g,2,w)}function u(p,v,h,g,y){var b=h.instanceCount,x=h.groupCount,C=s(p,v),_=ao(h,C,g.color),w=Hu(h,g.size),T=Fo(b*x),A=ju(),D=Wu(),E=Yu(),M=Xu(),F={drawCount:p.cylinderCount*4*3,vertexCount:p.cylinderCount*6,groupCount:x,instanceCount:b},O=_h(w)*y.sizeFactor,U=Te.clone(p.boundingSphere),N=sa(U,v.aTransform.ref.value,b);return I(I(I(I(I(I(I(I(I(I(I({dGeometryType:R.create("cylinders"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,aScale:p.scaleBuffer,aCap:p.capBuffer,elements:p.indexBuffer,boundingSphere:R.create(N),invariantBoundingSphere:R.create(U),uInvariantBoundingSphere:R.create(Wt.ofSphere(U))},_),w),T),A),D),E),M),v),{padding:R.create(O)}),Je.createValues(y,F)),{uSizeFactor:R.create(y.sizeFactor*y.sizeAspectRatio),uDoubleSided:R.create(y.doubleSided),dIgnoreLight:R.create(y.ignoreLight),dXrayShaded:R.create(y.xrayShaded),uBumpFrequency:R.create(y.bumpFrequency),uBumpAmplitude:R.create(y.bumpAmplitude)})}function c(p,v,h,g,y){var b=Je.createSimple(h,g,y),x=I(I({},P.getDefaultValues(e.Params)),v);return u(p,b.transform,b.locationIterator,b.theme,x)}function l(p,v){Je.updateValues(p,v),R.updateIfChanged(p.uSizeFactor,v.sizeFactor*v.sizeAspectRatio),R.updateIfChanged(p.uDoubleSided,v.doubleSided),R.updateIfChanged(p.dIgnoreLight,v.ignoreLight),R.updateIfChanged(p.dXrayShaded,v.xrayShaded),R.updateIfChanged(p.uBumpFrequency,v.bumpFrequency),R.updateIfChanged(p.uBumpAmplitude,v.bumpAmplitude)}function f(p,v){var h=Te.clone(v.boundingSphere),g=sa(h,p.aTransform.ref.value,p.instanceCount.ref.value);Te.equals(g,p.boundingSphere.ref.value)||R.update(p.boundingSphere,g),Te.equals(h,p.invariantBoundingSphere.ref.value)||(R.update(p.invariantBoundingSphere,h),R.update(p.uInvariantBoundingSphere,Wt.fromSphere(p.uInvariantBoundingSphere.ref.value,h)))}function d(p){var v=Je.createRenderableState(p);return m(v,p),v}function m(p,v){Je.updateRenderableState(p,v),p.opaque=p.opaque&&!v.xrayShaded,p.writeDepth=p.opaque}})(no||(no={}));var ya;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],c=s[1],l=s[2];return u*c*l;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:js(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return js(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function a(o){switch(o.kind){case"mesh":return At.Utils;case"points":return Qf.Utils;case"spheres":return Tl.Utils;case"cylinders":return no.Utils;case"text":return Oo.Utils;case"lines":return Xr.Utils;case"direct-volume":return ro.Utils;case"image":return ac.Utils;case"texture-mesh":return ko.Utils}}e.getUtils=a;function i(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=i})(ya||(ya={}));function ao(e,t,r,n){var a=kre(e,t,r,n);return r.palette?(R.updateIfChanged(a.dUsePalette,!0),Lre(r.palette,a.tPalette)):R.updateIfChanged(a.dUsePalette,!1),a}function kre(e,t,r,n){switch(ya.getGranularity(e,r.granularity)){case"uniform":return Ure(e,r.color,n);case"instance":return zre(e,r.color,n);case"group":return Vre(e,r.color,n);case"groupInstance":return Gre(e,r.color,n);case"vertex":return Hre(t,r.color,n);case"vertexInstance":return qre(t,r.color,n);case"volume":return qF(r.grid,"volume",n);case"volumeInstance":return qF(r.grid,"volumeInstance",n);case"direct":return jre(n)}}function Lre(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var a=n.array,i=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],c=st.toRgb(u),l=c[0],f=c[1],d=c[2];if(a[i++]!==l||a[i++]!==f||a[i++]!==d){r=!1;break}}if(!r){for(var m=new Uint8Array(e.colors.length*3),p=0,v=0,h=e.colors;v<h.length;v++){var u=h[v],g=st.toRgb(u),l=g[0],f=g[1],d=g[2];m[p++]=l,m[p++]=f,m[p++]=d}R.update(t,{array:m,height:1,width:e.colors.length,filter:e.filter})}}function Nre(e,t){return t?(R.update(t.uColor,st.toVec3Normalized(t.uColor.ref.value,e)),R.updateIfChanged(t.dColorType,"uniform"),t):{uColor:R.create(st.toVec3Normalized(S(),e)),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(vi()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(Fe.create(1,1)),uColorGridDim:R.create(S.create(1,1,1)),uColorGridTransform:R.create(Wt.create(0,0,0,1)),dColorType:R.create("uniform"),dUsePalette:R.create(!1)}}function Ure(e,t,r){return Nre(t(eo,!1),r)}function Th(e,t,r){return r?(R.update(r.tColor,e),R.update(r.uColorTexDim,Fe.create(e.width,e.height)),R.updateIfChanged(r.dColorType,t),r):{uColor:R.create(S()),tColor:R.create(e),tColorGrid:R.create(vi()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(Fe.create(e.width,e.height)),uColorGridDim:R.create(S.create(1,1,1)),uColorGridTransform:R.create(Wt.create(0,0,0,1)),dColorType:R.create(t),dUsePalette:R.create(!1)}}function zre(e,t,r){var n=e.instanceCount,a=Yn(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.instanceIndex;st.toArray(t(o,s),a.array,u*3),e.skipInstance()}return Th(a,"instance",r)}function Vre(e,t,r){var n=e.groupCount,a=Yn(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var i=e.move(),o=i.location,s=i.isSecondary,u=i.groupIndex;st.toArray(t(o,s),a.array,u*3)}return Th(a,"group",r)}function Gre(e,t,r){var n=e.groupCount,a=e.instanceCount,i=a*n,o=Yn(Math.max(1,i),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,c=s.isSecondary,l=s.index;st.toArray(t(u,c),o.array,l*3)}return Th(o,"groupInstance",r)}function Hre(e,t,r){var n=e.groupCount,a=e.stride,i=Yn(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,c=o.groupIndex,l=t(s,u),f=0;f<a;++f)st.toArray(l,i.array,(c+f)*3);return Th(i,"vertex",r)}function qre(e,t,r){var n=e.groupCount,a=e.instanceCount,i=e.stride,o=a*n,s=Yn(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),c=u.location,l=u.isSecondary,f=u.index,d=t(c,l),m=0;m<i;++m)st.toArray(d,s.array,(f+m)*3);return Th(s,"vertexInstance",r)}function qF(e,t,r){var n=e.colors,a=e.dimension,i=e.transform,o=n.getWidth(),s=n.getHeight();return r?(R.update(r.tColorGrid,n),R.update(r.uColorTexDim,Fe.create(o,s)),R.update(r.uColorGridDim,S.clone(a)),R.update(r.uColorGridTransform,Wt.clone(i)),R.updateIfChanged(r.dColorType,t),r):{uColor:R.create(S()),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(n),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(Fe.create(o,s)),uColorGridDim:R.create(S.clone(a)),uColorGridTransform:R.create(Wt.clone(i)),dColorType:R.create(t),dUsePalette:R.create(!1)}}function jre(e){return e?(R.updateIfChanged(e.dColorType,"direct"),e):{uColor:R.create(S()),tColor:R.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:R.create(vi()),tPalette:R.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:R.create(Fe.create(1,1)),uColorGridDim:R.create(S.create(1,1,1)),uColorGridTransform:R.create(Wt.create(0,0,0,1)),dColorType:R.create("direct"),dUsePalette:R.create(!1)}}var At;(function(e){function t(E,M,F,O,U,N,q){return q?i(E,M,F,O,U,N,q):a(E,M,F,O,U,N)}e.create=t;function r(E){var M=E?E.vertexBuffer.ref.value:new Float32Array(0),F=E?E.indexBuffer.ref.value:new Uint32Array(0),O=E?E.normalBuffer.ref.value:new Float32Array(0),U=E?E.groupBuffer.ref.value:new Float32Array(0);return t(M,F,O,U,0,0,E)}e.createEmpty=r;function n(E){return Wa([E.vertexCount,E.triangleCount,E.vertexBuffer.ref.version,E.indexBuffer.ref.version,E.normalBuffer.ref.version,E.groupBuffer.ref.version])}function a(E,M,F,O,U,N){var q=Te(),j,Q=-1,J=-1,te={kind:"mesh",vertexCount:U,triangleCount:N,vertexBuffer:R.create(E),indexBuffer:R.create(M),normalBuffer:R.create(F),groupBuffer:R.create(O),get boundingSphere(){var K=n(te);if(K!==Q){var L=wl(te.vertexBuffer.ref.value,te.vertexCount,1);Te.copy(q,L),Q=K}return q},get groupMapping(){return te.groupBuffer.ref.version!==J&&(j=Qm(te.groupBuffer.ref.value,te.vertexCount),J=te.groupBuffer.ref.version),j},setBoundingSphere:function(K){Te.copy(q,K),Q=n(te)},meta:{}};return te}function i(E,M,F,O,U,N,q){return q.vertexCount=U,q.triangleCount=N,R.update(q.vertexBuffer,E),R.update(q.indexBuffer,M),R.update(q.normalBuffer,F),R.update(q.groupBuffer,O),q}function o(E){var M=E.vertexCount,F=E.triangleCount,O=E.vertexBuffer.ref.value,U=E.indexBuffer.ref.value,N=E.normalBuffer.ref.value.length>=M*3?E.normalBuffer.ref.value:new Float32Array(M*3);N===E.normalBuffer.ref.value&&N.fill(0,0,M*3),PB(O,U,N,M,F),R.update(E.normalBuffer,N)}e.computeNormals=o;function s(E,M){M===void 0&&(M=3);for(var F=E.vertexBuffer.ref.value,O=new Map,U=function(K,L){return"".concat(K[0].toFixed(L),"|").concat(K[1].toFixed(L),"|").concat(K[2].toFixed(L))},N=0,q=S(),j=0,Q=E.vertexCount;j<Q;++j){S.fromArray(q,F,j*3);var J=U(q,M),te=O.get(J);te!==void 0?(N+=1,O.set(J,te+1)):O.set(J,1)}return N}e.checkForDuplicateVertices=s;var u=dn();function c(E,M){var F=E.vertexBuffer.ref.value;if(Wf(M,F,0,E.vertexCount),!se.isTranslationAndUniformScaling(M)){var O=dn.directionTransform(u,M);O$(O,E.normalBuffer.ref.value,0,E.vertexCount)}R.update(E.vertexBuffer,F)}e.transform=c;function l(E){var M=("kind"in E?E.meta:E.meta.ref.value).originalData;return M}e.getOriginalData=l;function f(E,M){M===void 0&&(M=!0);var F=E.indexBuffer,O=E.vertexBuffer,U=E.groupBuffer,N=E.normalBuffer,q=E.triangleCount,j=E.vertexCount,Q=F.ref.value,J=O.ref.value,te=U.ref.value,K=N.ref.value,L=Me.create(Uint32Array,3,1024,q),W=Me.create(Float32Array,3,1024,J);W.currentIndex=j*3,W.elementCount=j;var k=Me.create(Float32Array,3,1024,K);k.currentIndex=j*3,k.elementCount=j;var V=Me.create(Float32Array,1,1024,te);V.currentIndex=j,V.elementCount=j;var G=S(),H=S(),X=S(),Y=S(),oe=S(),ue=S();function me(Ae){S.fromArray(G,J,Ae*3),S.fromArray(Y,K,Ae*3),Me.add3(W,G[0],G[1],G[2]),Me.add3(k,Y[0],Y[1],Y[2])}function he(Ae,we){S.fromArray(G,J,Ae*3),S.fromArray(H,J,we*3),S.scale(G,S.add(G,G,H),.5),S.fromArray(Y,K,Ae*3),S.fromArray(oe,K,we*3),S.scale(Y,S.add(Y,Y,oe),.5),Me.add3(W,G[0],G[1],G[2]),Me.add3(k,Y[0],Y[1],Y[2])}function Pe(Ae,we,Ve){S.fromArray(G,J,Ae*3),S.fromArray(H,J,we*3),S.fromArray(X,J,Ve*3),S.scale(G,S.add(G,S.add(G,G,H),X),1/3),S.fromArray(Y,K,Ae*3),S.fromArray(oe,K,we*3),S.fromArray(ue,K,Ve*3),S.scale(Y,S.add(Y,S.add(Y,Y,oe),ue),1/3),Me.add3(W,G[0],G[1],G[2]),Me.add3(k,Y[0],Y[1],Y[2])}function re(Ae,we,Ve,rt,ut){++B,me(Ae),he(Ae,we),he(Ae,Ve),Me.add3(L,ee,ee+1,ee+2);for(var Ue=0;Ue<3;++Ue)Me.add(V,rt);ee+=3,B+=2,me(we),me(Ve),he(Ae,we),he(Ae,Ve),Me.add3(L,ee,ee+1,ee+3),Me.add3(L,ee,ee+3,ee+2);for(var Ue=0;Ue<4;++Ue)Me.add(V,ut);ee+=4}var ee=j,B=0;if(M)for(var z=0,le=q;z<le;++z){var pe=Q[z*3],ge=Q[z*3+1],Ce=Q[z*3+2],Ie=te[pe],Oe=te[ge],We=te[Ce];if(Ie===Oe&&Ie===We)++B,Me.add3(L,pe,ge,Ce);else if(Ie===Oe)re(Ce,pe,ge,We,Ie);else if(Ie===We)re(ge,Ce,pe,Oe,We);else if(Oe===We)re(pe,ge,Ce,Ie,Oe);else{B+=2,me(pe),he(pe,ge),he(pe,Ce),Pe(pe,ge,Ce),Me.add3(L,ee,ee+1,ee+3),Me.add3(L,ee,ee+3,ee+2);for(var Ne=0;Ne<4;++Ne)Me.add(V,Ie);ee+=4,B+=2,me(ge),he(ge,Ce),he(ge,pe),Pe(pe,ge,Ce),Me.add3(L,ee,ee+1,ee+3),Me.add3(L,ee,ee+3,ee+2);for(var Ne=0;Ne<4;++Ne)Me.add(V,Oe);ee+=4,B+=2,me(Ce),he(Ce,ge),he(Ce,pe),Pe(pe,ge,Ce),Me.add3(L,ee+3,ee+1,ee),Me.add3(L,ee+2,ee+3,ee);for(var Ne=0;Ne<4;++Ne)Me.add(V,We);ee+=4}}else for(var z=0,le=q;z<le;++z){var pe=Q[z*3],ge=Q[z*3+1],Ce=Q[z*3+2],Ie=te[pe],Oe=te[ge],We=te[Ce];if(Ie!==Oe||Ie!==We){++B,me(pe),me(ge),me(Ce),Me.add3(L,ee,ee+1,ee+2);for(var Ye=Oe===We?Oe:Ie,Ne=0;Ne<3;++Ne)Me.add(V,Ye);ee+=3}else++B,Me.add3(L,pe,ge,Ce)}var Xe=Me.compact(L),Ze=Me.compact(W),Ke=Me.compact(k),ht=Me.compact(V);return E.vertexCount=ee,E.triangleCount=B,R.update(O,Ze),R.update(U,ht),R.update(F,Xe),R.update(N,Ke),E.meta.originalData={indexBuffer:Q,vertexCount:j,triangleCount:q},E}e.uniformTriangleGroup=f;function d(E){for(var M=E.vertexCount,F=E.triangleCount,O=E.indexBuffer.ref.value,U=[],N=0;N<M;++N)U[N]=[];for(var N=0;N<F;++N){var q=O[N*3],j=O[N*3+1],Q=O[N*3+2];gn(U[q],j),gn(U[q],Q),gn(U[j],q),gn(U[j],Q),gn(U[Q],q),gn(U[Q],j)}return U}function m(E){for(var M=E.triangleCount,F=E.indexBuffer.ref.value,O=new Map,U=function(J,te){var K=aM(J,te),L=O.get(K)||0;O.set(K,L+1)},N=0;N<M;++N){var q=F[N*3],j=F[N*3+1],Q=F[N*3+2];U(q,j),U(q,Q),U(j,Q)}return O}function p(E){var M=new Set,F=[0,0];return E.forEach(function(O,U){O===1&&(Ej(F,U),M.add(F[0]),M.add(F[1]))}),M}function v(E,M,F){var O=new Map,U=function(N,q){O.has(N)?gn(O.get(N),q):O.set(N,[q])};return M.forEach(function(N){for(var q=E[N],j=0,Q=q;j<Q.length;j++){var J=Q[j];M.has(J)&&F.get(aM(N,J))===1&&U(N,J)}}),O}function h(E,M){for(var F=E.indexBuffer,O=E.triangleCount,U=F.ref.value,N=Me.create(Uint32Array,3,1024,O),q=0,j=0;j<O;++j){var Q=U[j*3],J=U[j*3+1],te=U[j*3+2];M[Q].length===2||M[J].length===2||M[te].length===2||(Me.add3(N,Q,J,te),q+=1)}var K=Me.compact(N);return E.triangleCount=q,R.update(F,K),E}function g(E,M,F,O){for(var U,N=E.vertexBuffer,q=E.indexBuffer,j=E.normalBuffer,Q=E.triangleCount,J=N.ref.value,te=q.ref.value,K=j.ref.value,L=Me.create(Uint32Array,3,1024,Q),W=0,k=0;k<Q;++k)Me.add3(L,te[k*3],te[k*3+1],te[k*3+2]),W+=1;var V=S(),G=S(),H=S(),X=S(),Y=S(),oe=S(),ue=S(),me=S(),he=S(),Pe=S(),re=pr(120),ee=new Set,B=Array.from(F.keys()).filter(function(Ze){return F.get(Ze).length<2}).map(function(Ze){var Ke=F.get(Ze);return S.fromArray(V,J,Ze*3),S.fromArray(G,J,Ke[0]*3),S.fromArray(H,J,Ke[1]*3),S.sub(Y,G,V),S.sub(oe,H,V),[Ze,S.angle(Y,oe)]});B.sort(function(Ze,Ke){var ht=Ze[1],Ae=Ke[1];return ht-Ae});for(var z=0,le=B;z<le.length;z++){var pe=le[z],ge=pe[0],Ce=pe[1];if(!(ee.has(ge)||Ce>re)){var Ie=F.get(ge);if(!(M[Ie[0]].includes(Ie[1])&&!((U=F.get(Ie[0]))===null||U===void 0?void 0:U.includes(Ie[1])))&&(S.fromArray(V,J,ge*3),S.fromArray(G,J,Ie[0]*3),S.fromArray(H,J,Ie[1]*3),S.sub(Y,G,V),S.sub(oe,H,V),S.add(me,Y,oe),!(S.squaredDistance(V,G)>=O))){for(var Oe=!1,We=0,Ne=M[ge];We<Ne.length;We++){var Ye=Ne[We];if(!Ie.includes(Ye)&&(S.fromArray(X,J,Ye*3),S.sub(ue,X,V),S.dot(me,ue)<0)){Oe=!0;break}}!Oe||(S.fromArray(he,K,ge*3),S.triangleNormal(Pe,V,G,H),S.dot(Pe,he)>0?Me.add3(L,ge,Ie[0],Ie[1]):Me.add3(L,Ie[1],Ie[0],ge),ee.add(ge),ee.add(Ie[0]),ee.add(Ie[1]),W+=1)}}}var Xe=Me.compact(L);return E.triangleCount=W,R.update(q,Xe),E}function y(E,M,F){for(var O=F.iterations,U=F.lambda,N=S(),q=S(),j=S(),Q=S(),J=-U,te=new Float32Array(E.vertexBuffer.ref.value.length),K=function(W){var k=E.vertexBuffer.ref.value;te.set(k),M.forEach(function(G,H){if(G.length===2){S.fromArray(N,k,H*3),S.fromArray(q,k,G[0]*3),S.fromArray(j,k,G[1]*3);var X=1/S.distance(N,q),Y=1/S.distance(N,j);S.scale(q,q,X),S.scale(j,j,Y),S.add(Q,q,j),S.scale(Q,Q,1/(X+Y)),S.sub(Q,Q,N),S.scale(Q,Q,W),S.add(Q,N,Q),S.toArray(Q,te,H*3)}});var V=E.vertexBuffer.ref.value;R.update(E.vertexBuffer,te),te=V},L=0;L<O;++L)K(U),K(J)}function b(E,M){h(E,d(E));for(var F=0;F<10;++F){var O=E.triangleCount,U=m(E),N=d(E),q=p(U),j=v(N,q,U);if(g(E,N,j,M.maxNewEdgeLength*M.maxNewEdgeLength),E.triangleCount===O)break}var Q=m(E),J=d(E),te=p(Q),K=v(J,te,Q);return y(E,K,{iterations:M.iterations,lambda:.5}),E}e.smoothEdges=b,e.Params=I(I({},Je.Params),{doubleSided:P.Boolean(!1,Je.CustomQualityParamInfo),flipSided:P.Boolean(!1,Je.ShadingCategory),flatShaded:P.Boolean(!1,Je.ShadingCategory),ignoreLight:P.Boolean(!1,Je.ShadingCategory),xrayShaded:P.Boolean(!1,Je.ShadingCategory),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory),bumpAmplitude:P.Numeric(1,{min:0,max:5,step:.1},Je.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:C,createValuesSimple:_,updateValues:w,updateBoundingSphere:T,createRenderableState:A,updateRenderableState:D,createPositionIterator:x};function x(E,M){var F=E.vertexCount,O=M.instanceCount.ref.value,U=Yf(),N=U.position,q=E.vertexBuffer.ref.value,j=M.aTransform.ref.value,Q=function(J,te){return te<0?S.fromArray(N,q,J*3):S.transformMat4Offset(N,q,j,0,J*3,te*16),U};return Wr(F,O,1,Q)}function C(E,M,F,O,U){var N=F.instanceCount,q=F.groupCount,j=x(E,M),Q=ao(F,j,O.color),J=Fo(N*q),te=ju(),K=Wu(),L=Yu(),W=Xu(),k={drawCount:E.triangleCount*3,vertexCount:E.vertexCount,groupCount:q,instanceCount:N},V=Te.clone(E.boundingSphere),G=sa(V,M.aTransform.ref.value,N);return I(I(I(I(I(I(I(I(I({dGeometryType:R.create("mesh"),aPosition:E.vertexBuffer,aNormal:E.normalBuffer,aGroup:E.groupBuffer,elements:E.indexBuffer,boundingSphere:R.create(G),invariantBoundingSphere:R.create(V),uInvariantBoundingSphere:R.create(Wt.ofSphere(V))},Q),J),te),K),L),W),M),Je.createValues(U,k)),{uDoubleSided:R.create(U.doubleSided),dFlatShaded:R.create(U.flatShaded),dFlipSided:R.create(U.flipSided),dIgnoreLight:R.create(U.ignoreLight),dXrayShaded:R.create(U.xrayShaded),uBumpFrequency:R.create(U.bumpFrequency),uBumpAmplitude:R.create(U.bumpAmplitude),meta:R.create(E.meta)})}function _(E,M,F,O,U){var N=Je.createSimple(F,O,U),q=I(I({},P.getDefaultValues(e.Params)),M);return C(E,N.transform,N.locationIterator,N.theme,q)}function w(E,M){Je.updateValues(E,M),R.updateIfChanged(E.uDoubleSided,M.doubleSided),R.updateIfChanged(E.dFlatShaded,M.flatShaded),R.updateIfChanged(E.dFlipSided,M.flipSided),R.updateIfChanged(E.dIgnoreLight,M.ignoreLight),R.updateIfChanged(E.dXrayShaded,M.xrayShaded),R.updateIfChanged(E.uBumpFrequency,M.bumpFrequency),R.updateIfChanged(E.uBumpAmplitude,M.bumpAmplitude)}function T(E,M){var F=Te.clone(M.boundingSphere),O=sa(F,E.aTransform.ref.value,E.instanceCount.ref.value);Te.equals(O,E.boundingSphere.ref.value)||R.update(E.boundingSphere,O),Te.equals(F,E.invariantBoundingSphere.ref.value)||(R.update(E.invariantBoundingSphere,F),R.update(E.uInvariantBoundingSphere,Wt.fromSphere(E.uInvariantBoundingSphere.ref.value,F)))}function A(E){var M=Je.createRenderableState(E);return D(M,E),M}function D(E,M){Je.updateRenderableState(E,M),E.opaque=E.opaque&&!M.xrayShaded,E.writeDepth=E.opaque}})(At||(At={}));var Wre={radius:1,detail:0};function Xre(e,t,r){var n=I(I({},Wre),r),a=n.radius,i=n.detail,o=Yre(),s=o.vertices,u=o.indices;l(i),k$(s,a);var c=new Float32Array(s.length);return PB(s,u,c,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(c),indices:new Uint32Array(u)};function l(d){for(var m=S(),p=S(),v=S(),h=0;h<t.length;h+=3)S.fromArray(m,e,t[h+0]*3),S.fromArray(p,e,t[h+1]*3),S.fromArray(v,e,t[h+2]*3),f(m,p,v,d)}function f(d,m,p,v){for(var h=Math.pow(2,v),g=[],y=0;y<=h;++y){g[y]=[];var b=S();S.lerp(b,d,p,y/h);var x=S();S.lerp(x,m,p,y/h);for(var C=h-y,_=0;_<=C;++_)if(_===0&&y===h)g[y][_]=b;else{var w=S();S.lerp(w,b,x,_/C),g[y][_]=w}}for(var y=0;y<h;++y)for(var _=0;_<2*(h-y)-1;++_){var T=Math.floor(_/2);_%2==0?o.add(g[y][T+1],g[y+1][T],g[y][T]):o.add(g[y][T+1],g[y+1][T+1],g[y+1][T])}}}function Yre(){var e=[],t=[],r=new Map;function n(a){var i="".concat(a[0].toFixed(5),"|").concat(a[1].toFixed(5),"|").concat(a[2].toFixed(5)),o=r.get(i);return o===void 0&&(o=e.length/3,r.set(i,o),e.push.apply(e,a)),o}return{vertices:e,indices:t,add:function(a,i,o){t.push(n(a),n(i),n(o))}}}var Lo=(1+Math.sqrt(5))/2,Kre=[-1,Lo,0,1,Lo,0,-1,-Lo,0,1,-Lo,0,0,-1,Lo,0,1,Lo,0,-1,-Lo,0,1,-Lo,Lo,0,-1,Lo,0,1,-Lo,0,-1,-Lo,0,1],Qre=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],j_;function Zre(){return j_||(j_=p1(Kre,Qre)),j_}var jF=Zre(),$re=jF.vertices,Jre=jF.indices;function b1(e){return 10*Math.pow(Math.pow(2,e),2)+2}function ene(e){return Xre($re,Jre,{detail:e,radius:1})}var WF=new Map,tne=se.identity();function rne(e,t,r){return se.scaleUniformly(e,se.fromTranslation(e,t),r)}function XF(e){var t=WF.get(e);return t===void 0&&(t=ene(e),WF.set(e,t)),t}function Kn(e,t,r,n){it.addPrimitive(e,rne(tne,t,r),XF(n))}var eu={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function nne(e){var t=I(I({},eu),e),r=t.radiusTop,n=t.radiusBottom,a=t.height,i=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,c=t.thetaStart,l=t.thetaLength,f=[],d=[],m=[],p=0,v=[],h=a/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(d),normals:new Float32Array(m),indices:new Uint32Array(f)};function g(){for(var b=S.zero(),x=(n-r)/a,C=0;C<=o;++C){for(var _=[],w=C/o,T=w*(n-r)+r,A=0;A<=i;++A){var D=A/i,E=D*l+c,M=Math.sin(E),F=Math.cos(E);d.push(T*M,-w*a+h,T*F),S.normalize(b,S.set(b,M,x,F)),m.push.apply(m,b),_.push(p++)}v.push(_)}for(var A=0;A<i;++A)for(var C=0;C<o;++C){var O=v[C][A],U=v[C+1][A],N=v[C+1][A+1],q=v[C][A+1];f.push(O,U,q),f.push(U,N,q)}}function y(b){for(var x=b===!0?r:n,C=b===!0?1:-1,_=p,w=1;w<=i;++w)d.push(0,h*C,0),m.push(0,C,0),++p;for(var T=p,w=0;w<=i;++w){var A=w/i,D=A*l+c,E=Math.cos(D),M=Math.sin(D);d.push(x*M,h*C,x*E),m.push(0,C,0),++p}for(var w=0;w<i;++w){var F=_+w,O=T+w;b===!0?f.push(O,O+1,F):f.push(O+1,O,F)}}}var YF=S(),KF=S(),Fi=S(),Oi=S(),tu=S(),ep=S(),ane={height:1,topCap:!0,bottomCap:!0};function tp(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=I(I({},ane),t),a=n.height,i=n.topCap,o=n.bottomCap,s=r*2,u=r*4,c=(i?1:0)+(o?1:0);r===3?(s+=c,u+=c*3):r===4?(s+=c*2,u+=c*4):(s+=c*r,u+=c*r*3);var l=Zm(s,u),f=a*.5;S.set(YF,0,0,-f),S.set(KF,0,0,f);for(var d=0;d<r;++d){var m=(d+1)%r;S.set(Fi,e[d*3],e[d*3+1],-f),S.set(Oi,e[m*3],e[m*3+1],-f),S.set(tu,e[m*3],e[m*3+1],f),S.set(ep,e[d*3],e[d*3+1],f),l.addQuad(Fi,Oi,tu,ep)}if(r===3)i&&(S.set(Fi,e[0],e[1],-f),S.set(Oi,e[3],e[4],-f),S.set(tu,e[6],e[7],-f),l.add(tu,Oi,Fi)),o&&(S.set(Fi,e[0],e[1],f),S.set(Oi,e[3],e[4],f),S.set(tu,e[6],e[7],f),l.add(Fi,Oi,tu));else if(r===4)i&&(S.set(Fi,e[0],e[1],-f),S.set(Oi,e[3],e[4],-f),S.set(tu,e[6],e[7],-f),S.set(ep,e[9],e[10],-f),l.addQuad(ep,tu,Oi,Fi)),o&&(S.set(Fi,e[0],e[1],f),S.set(Oi,e[3],e[4],f),S.set(tu,e[6],e[7],f),S.set(ep,e[9],e[10],f),l.addQuad(Fi,Oi,tu,ep));else for(var d=0;d<r;++d){var m=(d+1)%r;i&&(S.set(Fi,e[d*3],e[d*3+1],-f),S.set(Oi,e[m*3],e[m*3+1],-f),l.add(YF,Oi,Fi)),o&&(S.set(Fi,e[d*3],e[d*3+1],f),S.set(Oi,e[m*3],e[m*3+1],f),l.add(Fi,Oi,KF))}return l.getPrimitive()}var W_;function ine(){return W_||(W_=tp($s(4,!1))),W_}var X_;function one(){return X_||(X_=tp($s(5,!1))),X_}var Y_;function sne(){return Y_||(Y_=tp($s(6,!1))),Y_}var K_;function une(){return K_||(K_=tp($s(6,!0))),K_}var Q_;function cne(){return Q_||(Q_=tp($s(7,!1))),Q_}var QF=new Map,ZF=S.create(0,1,0),ru=S(),x1=S(),$F=S(),Pl=se(),JF=se(),eO=S(),rp=S(),Z_=S();function S1(e,t,r,n,a){return S.setMagnitude(x1,r,n/2),S.add($F,t,x1),a?S.matchDirection(Z_,ZF,x1):S.copy(Z_,ZF),S.set(eO,1,n,1),S.makeRotation(JF,Z_,x1),se.scale(e,JF,eO),se.setTranslation(e,$F)}var nu=new Int32Array(9);function lne(e){var t,r,n,a,i,o,s,u,c;return nu[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:eu.radiusTop)),nu[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:eu.radiusBottom)),nu[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:eu.height)),nu[3]=(a=e.radialSegments)!==null&&a!==void 0?a:eu.radialSegments,nu[4]=(i=e.heightSegments)!==null&&i!==void 0?i:eu.heightSegments,nu[5]=((o=e.topCap)!==null&&o!==void 0?o:eu.topCap)?1:0,nu[6]=((s=e.bottomCap)!==null&&s!==void 0?s:eu.bottomCap)?1:0,nu[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:eu.thetaStart)),nu[8]=Math.round(1e3*((c=e.thetaLength)!==null&&c!==void 0?c:eu.thetaLength)),Wa(nu)}function $_(e){var t=lne(e),r=QF.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),a=tp($s(n,!0,e.radiusTop),e);r=k_(a,se.rotX90)}else r=nne(e);QF.set(t,r)}return r}function la(e,t,r,n,a){var i=S.distance(t,r)*n;S.sub(ru,r,t),S1(Pl,t,ru,i,!0),it.addPrimitive(e,Pl,$_(a))}function fne(e,t,r,n,a,i){var o=S.distance(t,r)*n,s=$_(i);S.sub(ru,r,t),S.add(rp,t,a),S1(Pl,rp,ru,o,!0),it.addPrimitive(e,Pl,s),S.sub(rp,t,a),S1(Pl,rp,ru,o,!0),it.addPrimitive(e,Pl,s)}function Ph(e,t,r,n,a,i){var o=Math.floor(a/2),s=1/a;if(n<1){var u=n/2/a;n+=a%2==1?u:-u}var c=S.distance(t,r)*n,l=$_(i);S.sub(ru,r,t);for(var f=0;f<o;++f){var d=s*(f*2+1);S.setMagnitude(ru,ru,c*d),S.add(rp,t,ru),S1(Pl,rp,ru,c*s,!1),it.addPrimitive(e,Pl,l)}}var Sn=S(),tO=dn(),ic=S(),au=S(),Jf=S(),C1=S(),io=S.fromArray,dne=S.triangleNormal,rO=S.copy,_1=S.transformMat4,nO=S.transformMat3,aO=dn.directionTransform,Cs=Me.add3,J_=Me.add,it;(function(e){function t(l,f,d){return l===void 0&&(l=2048),f===void 0&&(f=1024),{currentGroup:-1,vertices:Me.create(Float32Array,3,f,d?d.vertexBuffer.ref.value:l),normals:Me.create(Float32Array,3,f,d?d.normalBuffer.ref.value:l),indices:Me.create(Uint32Array,3,f*3,d?d.indexBuffer.ref.value:l*3),groups:Me.create(Float32Array,1,f,d?d.groupBuffer.ref.value:l),mesh:d}}e.createState=t;function r(l,f,d,m){var p=l.vertices,v=l.normals,h=l.indices,g=l.groups,y=l.currentGroup,b=p.elementCount;Cs(p,f[0],f[1],f[2]),Cs(p,d[0],d[1],d[2]),Cs(p,m[0],m[1],m[2]),dne(Sn,f,d,m);for(var x=0;x<3;++x)Cs(v,Sn[0],Sn[1],Sn[2]),J_(g,y);Cs(h,b,b+1,b+2)}e.addTriangle=r;function n(l,f,d){io(Jf,f,d[0]*3),io(C1,f,d[1]*3);for(var m=2,p=d.length;m<p;m+=2)rO(ic,Jf),rO(au,C1),io(Jf,f,d[m]*3),io(C1,f,d[m+1]*3),r(l,ic,au,Jf),r(l,au,C1,Jf)}e.addTriangleStrip=n;function a(l,f,d){io(ic,f,d[0]*3);for(var m=2,p=d.length;m<p;++m)io(au,f,d[m-1]*3),io(Jf,f,d[m]*3),r(l,ic,Jf,au)}e.addTriangleFan=a;function i(l,f,d){for(var m=d.vertices,p=d.normals,v=d.indices,h=l.vertices,g=l.normals,y=l.indices,b=l.groups,x=l.currentGroup,C=h.elementCount,_=aO(tO,f),w=0,T=m.length;w<T;w+=3)_1(Sn,io(Sn,m,w),f),Cs(h,Sn[0],Sn[1],Sn[2]),nO(Sn,io(Sn,p,w),_),Cs(g,Sn[0],Sn[1],Sn[2]),J_(b,x);for(var w=0,T=v.length;w<T;w+=3)Cs(y,v[w]+C,v[w+1]+C,v[w+2]+C)}e.addPrimitive=i;function o(l,f,d){for(var m=d.vertices,p=d.normals,v=d.indices,h=l.vertices,g=l.normals,y=l.indices,b=l.groups,x=l.currentGroup,C=h.elementCount,_=aO(tO,f),w=0,T=m.length;w<T;w+=3)_1(Sn,io(Sn,m,w),f),Cs(h,Sn[0],Sn[1],Sn[2]),nO(Sn,io(Sn,p,w),_),Cs(g,-Sn[0],-Sn[1],-Sn[2]),J_(b,x);for(var w=0,T=v.length;w<T;w+=3)Cs(y,v[w+2]+C,v[w+1]+C,v[w]+C)}e.addPrimitiveFlipped=o;function s(l,f,d,m,p,v){for(var h=d.vertices,g=d.edges,y={radiusTop:m,radiusBottom:m,radialSegments:v},b=0,x=g.length;b<x;b+=2)io(ic,h,g[b]*3),io(au,h,g[b+1]*3),_1(ic,ic,f),_1(au,au,f),Kn(l,ic,m,p),Kn(l,au,m,p),la(l,ic,au,1,y)}e.addCage=s;function u(l,f,d){i(l,f,{vertices:d.vertexBuffer.ref.value.subarray(0,d.vertexCount*3),normals:d.normalBuffer.ref.value.subarray(0,d.vertexCount*3),indices:d.indexBuffer.ref.value.subarray(0,d.triangleCount*3)})}e.addMesh=u;function c(l){var f=l.vertices,d=l.normals,m=l.indices,p=l.groups,v=l.mesh,h=Me.compact(f,!0),g=Me.compact(m,!0),y=Me.compact(d,!0),b=Me.compact(p,!0);return At.create(h,g,y,b,l.vertices.elementCount,l.indices.elementCount,v)}e.getMesh=c})(it||(it={}));var mne=1,pne="Assigns sizes as defined by the shape object.",iO={};function vne(e){return iO}function ew(e,t){return{factory:ew,granularity:"groupInstance",size:function(r){return hi.isLocation(r)?r.shape.getSize(r.group,r.instance):mne},props:t,description:pne}}var hne={name:"shape-group",label:"Shape Group",category:"",factory:ew,getParams:vne,defaultValues:P.getDefaultValues(iO),isApplicable:function(e){return!!e.shape}},gne=st(13421772),yne="Assigns colors as defined by the shape object.",oO={};function bne(e){return oO}function tw(e,t){return{factory:tw,granularity:"groupInstance",color:function(r){return hi.isLocation(r)?r.shape.getColor(r.group,r.instance):gne},props:t,description:yne}}var xne={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:tw,getParams:bne,defaultValues:P.getDefaultValues(oO),isApplicable:function(e){return!!e.shape}},Sne=I(I({},tc),{aPosition:wr("float32",3,0),elements:$f("uint32"),uBboxMin:Ee("v3"),uBboxMax:Ee("v3"),uBboxSize:Ee("v3"),uMaxSteps:Ee("i"),uStepScale:Ee("f"),uJumpLength:Ee("f"),uTransform:Ee("m4"),uGridDim:Ee("v3"),tTransferTex:Lt("image-uint8","alpha","ubyte","linear"),uTransferScale:Ee("f"),dGridTexType:Ot("string",["2d","3d"]),uGridTexDim:Ee("v3"),tGridTex:Lt("texture","rgba","ubyte","linear"),uGridStats:Ee("v4"),uCellDim:Ee("v3"),uCartnToUnit:Ee("m4"),uUnitToCartn:Ee("m4"),dPackedGroup:Ot("boolean"),dAxisOrder:Ot("string",["012","021","102","120","201","210"]),dIgnoreLight:Ot("boolean"),dXrayShaded:Ot("boolean")});function Cne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Sne);e.isWebGL2||(o.uMaxSteps=Ot("number"));var s={uObjectId:R.create(t)},u=xee,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var _ne=I(I({},tc),{aGroup:wr("float32",1,0),aPosition:wr("float32",3,0),aNormal:wr("float32",3,0),elements:$f("uint32"),dFlatShaded:Ot("boolean"),uDoubleSided:Ee("b"),dFlipSided:Ot("boolean"),dIgnoreLight:Ot("boolean"),dXrayShaded:Ot("boolean"),uBumpFrequency:Ee("f"),uBumpAmplitude:Ee("f"),meta:xn("unknown")});function wne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),_ne),s={uObjectId:R.create(t)},u=qB,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Ane=I(I(I({},tc),Ah),{aGroup:wr("float32",1,0),aPosition:wr("float32",3,0),dPointSizeAttenuation:Ot("boolean"),dPointStyle:Ot("string",["square","circle","fuzzy"])});function Tne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Ane),s={uObjectId:R.create(t)},u=vee,c=rc(e,"points",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Pne=I(I(I({},tc),Ah),{aGroup:wr("float32",1,0),aMapping:wr("float32",2,0),aStart:wr("float32",3,0),aEnd:wr("float32",3,0),elements:$f("uint32"),dLineSizeAttenuation:Ot("boolean"),uDoubleSided:Ee("b"),dFlipSided:Ot("boolean")});function Ene(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Pne),s={uObjectId:R.create(t)},u=bee,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Ine=I(I(I({},tc),Ah),{aGroup:wr("float32",1,0),aPosition:wr("float32",3,0),aMapping:wr("float32",2,0),elements:$f("uint32"),padding:xn("number"),uDoubleSided:Ee("b"),dIgnoreLight:Ot("boolean"),dXrayShaded:Ot("boolean"),uBumpFrequency:Ee("f"),uBumpAmplitude:Ee("f")});function Dne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Ine),s={uObjectId:R.create(t)},u=hee,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Mne=I(I(I({},tc),Ah),{aGroup:wr("float32",1,0),aPosition:wr("float32",3,0),aMapping:wr("float32",2,0),aDepth:wr("float32",1,0),elements:$f("uint32"),aTexCoord:wr("float32",2,0),tFont:Lt("image-uint8","alpha","ubyte","linear"),padding:xn("number"),uBorderWidth:Ee("f"),uBorderColor:Ee("v3"),uOffsetX:Ee("f"),uOffsetY:Ee("f"),uOffsetZ:Ee("f"),uBackgroundColor:Ee("v3"),uBackgroundOpacity:Ee("f")});function Rne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Mne),s={uObjectId:R.create(t)},u=yee,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Bne=I(I({},tc),{uGeoTexDim:Ee("v2","buffered"),tPosition:Lt("texture","rgb","float","nearest"),tGroup:Lt("texture","alpha","float","nearest"),tNormal:Lt("texture","rgb","float","nearest"),dFlatShaded:Ot("boolean"),uDoubleSided:Ee("b"),dFlipSided:Ot("boolean"),dIgnoreLight:Ot("boolean"),dXrayShaded:Ot("boolean"),uBumpFrequency:Ee("f"),uBumpAmplitude:Ee("f"),meta:xn("unknown")});function Fne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Bne),s={uObjectId:R.create(t)},u=qB,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var One=I(I({},tc),{aGroup:wr("float32",1,0),aPosition:wr("float32",3,0),aUv:wr("float32",2,0),elements:$f("uint32"),uImageTexDim:Ee("v2"),tImageTex:Lt("image-uint8","rgba","ubyte","nearest"),tGroupTex:Lt("image-uint8","rgba","ubyte","nearest"),dInterpolation:Ot("string",Fre)});function kne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),One),s={uObjectId:R.create(t)},u=See,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Lne=I(I(I({},tc),Ah),{aGroup:wr("float32",1,0),aStart:wr("float32",3,0),aEnd:wr("float32",3,0),aMapping:wr("float32",3,0),aScale:wr("float32",1,0),aCap:wr("float32",1,0),elements:$f("uint32"),padding:xn("number"),uDoubleSided:Ee("b"),dIgnoreLight:Ot("boolean"),dXrayShaded:Ot("boolean"),uBumpFrequency:Ee("f"),uBumpAmplitude:Ee("f")});function Nne(e,t,r,n,a,i){var o=I(I(I(I({},$u),Ju),ec),Lne),s={uObjectId:R.create(t)},u=gee,c=rc(e,"triangles",u,o,I(I({},r),s),a,i);return nc(c,r,n)}var Une=ja(0,2147483647),oc=ja(0,2147483647);function np(e,t,r,n){return{id:Une(),type:e,values:t,state:r,materialId:n}}function zne(e,t,r){switch(t.type){case"mesh":return wne(e,t.id,t.values,t.state,t.materialId,r);case"points":return Tne(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return Dne(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return Nne(e,t.id,t.values,t.state,t.materialId,r);case"text":return Rne(e,t.id,t.values,t.state,t.materialId,r);case"lines":return Ene(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return Cne(e,t.id,t.values,t.state,t.materialId,r);case"image":return kne(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return Fne(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}var fr;(function(e){function t(l,f,d,m,p,v,h){return{id:zr.create22(),name:l,sourceData:f,geometry:d,transforms:h||[se.identity()],get groupCount(){return ya.getGroupCount(d)},getColor:m,getSize:p,getLabel:v}}e.create=t;function r(l){return{color:tw({shape:l},{}),size:ew({shape:l},{})}}e.getTheme=r;function n(l){var f=l.transforms.length,d=hi.Location(l),m=function(p,v){return d.group=p,d.instance=v,d};return Wr(l.groupCount,f,1,m)}e.groupIterator=n;function a(l,f){for(var d=f&&f.aTransform.ref.value.length>=l.length*16?f.aTransform.ref.value:new Float32Array(l.length*16),m=0,p=l.length;m<p;++m)se.toArray(l[m],d,m*16);return A_(d,l.length,f)}e.createTransform=a;function i(l,f){var d=e.getTheme(l),m=ya.getUtils(l.geometry),p=oc(),v=n(l),h=e.createTransform(l.transforms),g=m.createValues(l.geometry,h,v,d,f),y=m.createRenderableState(f);return np(l.geometry.kind,g,y,p)}e.createRenderObject=i;function o(l){return{kind:"shape-loci",shape:l}}e.Loci=o;function s(l){return!!l&&l.kind==="shape-loci"}e.isLoci=s;function u(l,f){return l.shape===f.shape}e.areLociEqual=u;function c(l){return l.shape.groupCount===0}e.isLociEmpty=c})(fr||(fr={}));var hi;(function(e){function t(m,p,v){return p===void 0&&(p=0),v===void 0&&(v=0),{kind:"group-location",shape:m,group:p,instance:v}}e.Location=t;function r(m){return!!m&&m.kind==="group-location"}e.isLocation=r;function n(m,p){return{kind:"group-loci",shape:m,groups:p}}e.Loci=n;function a(m){return!!m&&m.kind==="group-loci"}e.isLoci=a;function i(m,p){if(m.shape!==p.shape||m.groups.length!==p.groups.length)return!1;for(var v=0,h=m.groups.length;v<h;++v){var g=m.groups[v],y=g.ids,b=g.instance,x=p.groups[v],C=x.ids,_=x.instance;if(b!==_||!De.areEqual(y,C))return!1}return!0}e.areLociEqual=i;function o(m){return s(m)===0}e.isLociEmpty=o;function s(m){for(var p=0,v=0,h=m.groups;v<h.length;v++){var g=h[v];p+=De.size(g.ids)}return p}e.size=s;var u=new Xf,c=S.zero();function l(m,p,v,h){for(var g=p.indices,y=p.offsets,b=function(A,D){De.forEach(A,function(E){for(var M=y[E],F=y[E+1];M<F;++M)S.fromArray(c,v,g[M]*3),S.transformMat4(c,c,h[D]),u.includeStep(c)})},x=0,C=m;x<C.length;x++){var _=C[x],w=_.ids,T=_.instance;b(w,T)}}function f(m,p,v,h){for(var g=p.indices,y=p.offsets,b=function(A,D){De.forEach(A,function(E){for(var M=y[E],F=y[E+1];M<F;++M)S.fromArray(c,v,g[M]*3),S.transformMat4(c,c,h[D]),u.radiusStep(c)})},x=0,C=m;x<C.length;x++){var _=C[x],w=_.ids,T=_.instance;b(w,T)}}function d(m,p){p||(p=Te()),u.reset();var v=0,h=m.shape,g=h.geometry,y=h.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;l(m.groups,g.groupMapping,b,y),u.finishedIncludeStep(),f(m.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var x=g.startBuffer.ref.value,C=g.endBuffer.ref.value;l(m.groups,g.groupMapping,x,y),l(m.groups,g.groupMapping,C,y),u.finishedIncludeStep(),f(m.groups,g.groupMapping,x,y),f(m.groups,g.groupMapping,C,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;l(m.groups,g.groupMapping,b,y),u.finishedIncludeStep(),f(m.groups,g.groupMapping,b,y);for(var _=function(F,O){De.forEach(F,function(U){var N=m.shape.getSize(U,O);v<N&&(v=N)})},w=0,T=m.groups;w<T.length;w++){var A=T[w],D=A.ids,E=A.instance;_(D,E)}}else return Te.copy(p,g.boundingSphere);return S.copy(p.center,u.center),p.radius=Math.sqrt(u.radiusSq),Te.expand(p,p,v),p}e.getBoundingSphere=d})(hi||(hi={}));function sO(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},a=[["",""]],i=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],c=t.propertyTypes[o];(c==="uchar"||c==="uint8"||c==="ushort"||c==="uint16"||c==="uint"||c==="uint32"||c==="int")&&a.push([u,u]),(c==="uchar"||c==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var l=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var f=r.propertyNames[o],c=r.propertyTypes[o];(c==="uchar"||c==="uint8")&&l.push([f,f])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var d=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return I(I({},At.Params),{coloring:P.MappedStatic(d,{vertex:P.Group({red:P.Select(n.vRed,i,{label:"Red Property"}),green:P.Select(n.vGreen,i,{label:"Green Property"}),blue:P.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:P.Group({red:P.Select(n.mRed,l,{label:"Red Property"}),green:P.Select(n.mGreen,l,{label:"Green Property"}),blue:P.Select(n.mBlue,l,{label:"Blue Property"})},{isFlat:!0}),uniform:P.Group({color:P.Color(tr.grey)},{isFlat:!0})}),grouping:P.MappedStatic(n.group?"vertex":"none",{vertex:P.Group({group:P.Select(n.group,a,{label:"Group Property"})},{isFlat:!0}),none:P.Group({})})})}var uO=sO();function Vne(e,t,r,n,a){var i=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),c=n.getProperty("y"),l=n.getProperty("z");if(!u||!c||!l)throw new Error("missing coordinate properties");for(var f=n.getProperty("nx"),d=n.getProperty("ny"),m=n.getProperty("nz"),p=!!f&&!!d&&!!m,v=e;v<t;++v)Me.add3(i,u.value(v),c.value(v),l.value(v)),p&&Me.add3(o,f.value(v),d.value(v),m.value(v)),Me.add(s,a[v])}function Gne(e,t,r,n){for(var a=r.indices,i=e;i<t;++i){var o=n.value(i),s=o.entries,u=o.count;u===3?Me.add3(a,s[0],s[1],s[2]):u===4&&(Me.add3(a,s[2],s[1],s[0]),Me.add3(a,s[2],s[0],s[3]))}}function Hne(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,p,v,h;return ae(this,function(g){switch(g.label){case 0:if(i=it.createState(t.rowCount,t.rowCount/4,a),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");c=t.getProperty("nx"),l=t.getProperty("ny"),f=t.getProperty("nz"),d=!!c&&!!l&&!!f,m=1e5,p=0,v=t.rowCount,g.label=1;case 1:return p<v?(Vne(p,Math.min(p+m,v),i,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:p,max:v})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return p+=m,[3,1];case 4:p=0,v=r.rowCount,g.label=5;case 5:return p<v?(Gne(p,Math.min(p+m,v),i,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:p,max:v})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return p+=m,[3,5];case 8:return h=it.getMesh(i),d||At.computeNormals(h),[2,h]}})})}var sc=ce.Schema.int;function qne(e,t){for(var r=t.grouping,n=e.rowCount,a=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?Ao(r.params.group):"Vertex",o=a?a.toArray({array:Uint32Array}):Po(new Uint32Array(n)),s=a?js(o):n-1,u=new Uint32Array(s+1),c=0,l=o.length;c<l;++c)u[o[c]]=c;return{ids:o,map:u,label:i}}function cO(e,t,r){var n=r.coloring,a=e.rowCount,i,o,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||ce.ofConst(127,a,sc),o=e.getProperty(n.params.green)||ce.ofConst(127,a,sc),s=e.getProperty(n.params.blue)||ce.ofConst(127,a,sc);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||ce.ofConst(127,a,sc),o=t&&t.getProperty(n.params.green)||ce.ofConst(127,a,sc),s=t&&t.getProperty(n.params.blue)||ce.ofConst(127,a,sc);else{var u=st.toRgb(n.params.color),c=u[0],l=u[1],f=u[2];i=ce.ofConst(c,a,sc),o=ce.ofConst(l,a,sc),s=ce.ofConst(f,a,sc)}return{kind:n.name,red:i,green:o,blue:s}}function lO(e,t,r,n){var a=r.kind,i=r.red,o=r.green,s=r.blue,u=n.ids,c=n.map,l=n.label;return fr.create("ply-mesh",e,t,function(f){var d=a==="material"?f:c[f];return st.fromRgb(i.value(d),o.value(d),s.value(d))},function(){return 1},function(f){return"".concat(l," ").concat(u[f])})}function jne(){var e=this,t,r,n,a,i,o,s=function(u,c,l,f){return ie(e,void 0,void 0,function(){var d,m,p,v,h;return ae(this,function(g){switch(g.label){case 0:if(d=c.getElement("vertex"),!d)throw new Error("missing vertex element");if(m=c.getElement("face"),!m)throw new Error("missing face element");return p=c.getElement("material"),v=!1,h=!1,(!t||t!==c)&&(v=!0),(!r||!P.isParamEqual(uO.grouping,r.grouping,l.grouping))&&(v=!0),(!r||!P.isParamEqual(uO.coloring,r.coloring,l.coloring))&&(h=!0),v?(i=cO(d,p,l),o=qne(d,l),[4,Hne(u,d,m,o.ids,f&&f.geometry)]):[3,2];case 1:return a=g.sent(),n=lO(c,a,i,o),[3,3];case 2:h&&(i=cO(d,p,l),n=lO(c,a,i,o)),g.label=3;case 3:return t=c,r=ol(l),[2,n]}})})};return s}function Wne(e,t){var r=this;return Be.create("Shape Provider",function(n){return ie(r,void 0,void 0,function(){return ae(this,function(a){return[2,{label:"Mesh",data:e,params:sO(e),getShape:jne(),geometryUtils:At.Utils}]})})})}function El(e,t){return{value:e,unit:t}}var Eh;(function(e){function t(u,c,l){var f=!!u[0].cell,d=!!u[0].velocities,m=!!u[0].forces;return{id:zr.create22(),frames:u,hasCell:f,hasVelocities:d,hasForces:m,deltaTime:c,timeOffset:l}}e.create=t;function r(u,c,l){var f=u.x,d=u.y,m=u.z;return u.xyzOrdering.frozen?l?u.xyzOrdering.isIdentity?(f=o(f,l),d=o(d,l),m=o(m,l)):li(u.xyzOrdering.index,l)||(f=i(f,u.xyzOrdering.index,l),d=i(d,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l)):u.xyzOrdering.isIdentity||(f=s(f,u.xyzOrdering.index),d=s(d,u.xyzOrdering.index),m=s(m,u.xyzOrdering.index)):l&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=l,a(f,l),a(d,l),a(m,l)):li(u.xyzOrdering.index,l)||(f=i(f,u.xyzOrdering.index,l),d=i(d,u.xyzOrdering.index,l),m=i(m,u.xyzOrdering.index,l))),u.xyzOrdering.frozen=!0,{id:zr.create22(),atomId:c,occupancy:ce.ofConst(1,u.elementCount,ce.Schema.int),B_iso_or_equiv:ce.ofConst(0,u.elementCount,ce.Schema.float),xyzDefined:!0,x:f,y:d,z:m}}e.getAtomicConformation=r;var n=[.123];function a(u,c){for(var l=n,f=0,d=u.length;f<d;f++)l[f]=u[c[f]];for(var f=0,d=u.length;f<d;f++)u[f]=l[f]}function i(u,c,l){for(var f=new Float32Array(u.length),d=0,m=u.length;d<m;d++)f[d]=u[c[l[d]]];return f}function o(u,c){for(var l=new Float32Array(u.length),f=0,d=u.length;f<d;f++)l[f]=u[c[f]];return l}function s(u,c){for(var l=new Float32Array(u.length),f=0,d=u.length;f<d;f++)l[c[f]]=u[f];return l}})(Eh||(Eh={}));function ed(){return ed.empty()}(function(e){function t(a,i){return{size:a,anglesInRadians:i}}e.create=t;function r(){return t(S(),S())}e.empty=r;function n(a,i,o){var s=S.magnitude(a),u=S.magnitude(i),c=S.magnitude(o),l=Math.acos(S.dot(i,o)/(u*c)),f=Math.acos(S.dot(a,o)/(s*c)),d=Math.acos(S.dot(a,i)/(s*u));return s<=0||u<=0||c<=0||l>=Math.PI||f>=Math.PI||d>=Math.PI?r():t(S.create(s,u,c),S.create(l,f,d))}e.fromBasis=n})(ed||(ed={}));var Xne=20.45482949774598;function Yne(e){var t=this;return Be.create("Parse DCD",function(r){return ie(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(d.sent(),n=e.header,a=n.DELTA?El(n.DELTA*Xne,"ps"):El(1,"step"),i=n.ISTART>=1?El((n.ISTART-1)*a.value,a.unit):El(0,a.unit),o=[],s=0,u=e.frames.length;s<u;++s)c=e.frames[s],l={elementCount:c.elementCount,time:El(i.value+a.value*s,a.unit),x:c.x,y:c.y,z:c.z,xyzOrdering:{isIdentity:!0}},c.cell&&(f=c.cell,f[1]>=-1&&f[1]<=1&&f[3]>=-1&&f[3]<=1&&f[4]>=-1&&f[4]<=1?l.cell=ed.create(S.create(f[0],f[2],f[5]),S.create(pr(90-Math.asin(f[1])*90/nh),pr(90-Math.asin(f[3])*90/nh),pr(90-Math.asin(f[4])*90/nh))):f[0]<0||f[1]<0||f[2]<0||f[3]<0||f[4]<0||f[5]<0||f[3]>180||f[4]>180||f[5]>180?l.cell=ed.fromBasis(S.create(f[0],f[1],f[3]),S.create(f[1],f[2],f[4]),S.create(f[3],f[4],f[5])):l.cell=ed.create(S.create(f[0],f[2],f[5]),S.create(pr(qr(f[1],0,Ir)?90:f[1]),pr(qr(f[3],0,Ir)?90:f[3]),pr(qr(f[4],0,Ir)?90:f[4])))),o.push(l);return[2,Eh.create(o,a,i)]}})})})}function w1(e,t,r,n){for(var a=r,i=n-1,o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a<=i;)o=t.charCodeAt(++a);for(o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i>=a;)o=t.charCodeAt(--i);if(++i,a===i||a+1===i)return qe.add(e,a,i);if(o=t.charCodeAt(a),a+2===i){var s=t.charCodeAt(a+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return qe.add(e,a,a+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return qe.add(e,a,a+1);qe.add(e,a,a)}var Kne=/^[\s\d]+|[\s\d]+$/g;function A1(e){e=e.replace(Kne,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var ki,Li,yt=Pf({Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817});ki={},ki[0]="Hexose",ki[1]="HexNAc",ki[2]="Hexosamine",ki[3]="Hexuronate",ki[4]="Deoxyhexose",ki[5]="DeoxyhexNAc",ki[6]="Di-deoxyhexose",ki[7]="Pentose",ki[8]="Deoxynonulosonate",ki[9]="Di-deoxynonulosonate",ki[10]="Unknown",ki[11]="Assigned";var Qne=(Li={},Li[0]=0,Li[1]=1,Li[2]=2,Li[3]=3,Li[4]=4,Li[5]=5,Li[6]=6,Li[7]=7,Li[8]=8,Li[9]=9,Li[10]=10,Li[11]=11,Li);function Zne(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:Qne[e]}var fO={abbr:"Unk",name:"Unknown",color:yt.Secondary,type:10},T1=[{abbr:"Glc",name:"Glucose",color:yt.Blue,type:0},{abbr:"Man",name:"Mannose",color:yt.Green,type:0},{abbr:"Gal",name:"Galactose",color:yt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:yt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:yt.Pink,type:0},{abbr:"All",name:"Allose",color:yt.Purple,type:0},{abbr:"Tal",name:"Talose",color:yt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:yt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:yt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:yt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:yt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:yt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:yt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:yt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:yt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:yt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:yt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:yt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:yt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:yt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:yt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:yt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:yt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:yt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:yt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:yt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:yt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:yt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:yt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:yt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:yt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:yt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:yt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:yt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:yt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:yt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:yt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:yt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:yt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:yt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:yt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:yt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:yt.Red,type:5},{abbr:"Oli",name:"Olivose",color:yt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:yt.Green,type:6},{abbr:"Abe",name:"Abequose",color:yt.Orange,type:6},{abbr:"Par",name:"Paratose",color:yt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:yt.Purple,type:6},{abbr:"Col",name:"Colitose",color:yt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:yt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:yt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:yt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:yt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:yt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:yt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:yt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:yt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:yt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:yt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:yt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:yt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:yt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:yt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:yt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:yt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:yt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:yt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:yt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:yt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:yt.Brown,type:10},{abbr:"Api",name:"Apicose",color:yt.Green,type:11},{abbr:"Fru",name:"Fructose",color:yt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:yt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:yt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:yt.Pink,type:11}],$ne=function(){for(var e=new Map,t=0,r=T1.length;t<r;++t){var n=T1[t];e.set(n.abbr,n)}return e}(),Jne=[["Glc-family",yt.Blue],["Man-family",yt.Green],["Gal-family",yt.Yellow],["Gul-family",yt.Orange],["Alt-family",yt.Pink],["All-family",yt.Purple],["Tal-family",yt.LightBlue],["Ido-family",yt.Brown],["Fuc-family",yt.Red],["Generic/Unknown/Secondary",yt.Secondary]],eae={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},dO=["NGZ","LAT","PUF","GDA","9WJ"],tae={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},td=function(){for(var e=new Map,t=0,r=T1.length;t<r;++t){var n=T1[t],a=eae[n.abbr];if(a)for(var i=0,o=a.length;i<o;++i)e.set(a[i],n);var s=tae[n.abbr];if(s)for(var i=0,o=s.length;i<o;++i)e.set(s[i],n)}for(var t=0,r=dO.length;t<r;++t)e.set(dO[t],fO);return e}(),Cn;(function(e){function t(m){return Cy(m.values())}e.toArray=t;function r(m,p){var v=!0;return p.forEach(function(h){m.has(h)||(v=!1)}),v}e.isSuperset=r;function n(m){for(var p=[],v=1;v<arguments.length;v++)p[v-1]=arguments[v];for(var h=0;h<p.length;h++)p[h].forEach(function(g){return m.add(g)});return m}e.add=n;function a(m,p){var v=new Set(m);return p.forEach(function(h){return v.add(h)}),v}e.union=a;function i(){for(var m=[],p=0;p<arguments.length;p++)m[p]=arguments[p];if(m.length===0)return new Set;m.length===1&&new Set(m[0]);for(var v=new Set(m[0]),h=1,g=m.length;h<g;h++)m[h].forEach(function(y){return v.add(y)});return v}e.unionMany=i;function o(m){if(m.length===0)return new Set;for(var p=new Set(m[0]),v=1;v<m.length;v++)for(var h=0,g=m[v];h<g.length;h++){var y=g[h];p.add(y)}return p}e.unionManyArrays=o;function s(m,p){var v=new Set;return p.forEach(function(h){m.has(h)&&v.add(h)}),v}e.intersection=s;function u(m,p){var v=!1;return p.forEach(function(h){m.has(h)&&(v=!0)}),v}e.areIntersecting=u;function c(m,p){var v=0;return p.forEach(function(h){m.has(h)&&(v+=1)}),v}e.intersectionSize=c;function l(m,p){var v=new Set(m);return p.forEach(function(h){return v.delete(h)}),v}e.difference=l;function f(m,p){var v=m.size;return m.forEach(function(h){p.has(h)&&(v-=1)}),v}e.differenceSize=f;function d(m,p){if(m.size!==p.size)return!1;var v=!0;return p.forEach(function(h){m.has(h)||(v=!1)}),v}e.areEqual=d})(Cn||(Cn={}));var mO=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),pO=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),uc,rae=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,a=t;n<a.length;n++){var i=a[n];e[i]=i.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[i+u]=(i+u).toUpperCase();for(var c=0,l=t;c<l.length;c++){var f=l[c];e[i+u+f]=(i+u+f).toUpperCase()}}}return e}();function rd(e){return rae[e]||e.toUpperCase()}var vO=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],rd(e[1])]}));function nae(e){return vO.has(e)?vO.get(e):rd("H")}var aae=(uc={},uc[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},uc[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},uc[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},uc[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},uc[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},uc[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},uc[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},uc),cc=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),P1=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),hO=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),gO=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),iae=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),oae=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),sae=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),yO=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),uae=Cn.unionMany(hO,gO,yO),bO=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),xO=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),SO=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),cae=new Set(["NON-POLYMER","OTHER"]),lae=new Set(["ION"]),fae=new Set(["LIPID"]),E1=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),rw=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),CO=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),Ih=Cn.unionMany(rw,CO),Dh=new Set(["A","C","T","G","I","U","N"]),Mh=new Set(["DA","DC","DT","DG","DI","DU","DN"]),nw=new Set(["APN","CPN","TPN","GPN"]),dae=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),mae=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),I1=Cn.unionMany(Dh,Mh,nw),_O=function(e){return dae.has(e.toUpperCase())},wO=function(e){return mae.has(e.toUpperCase())},ap=Cn.unionMany(Ih,I1);function ip(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),nw.has(t)?8:uae.has(e)?5:xO.has(e)?6:bO.has(e)?7:SO.has(e)?9:E1.has(t)?2:pO.has(t)?3:mO.has(t)?4:cae.has(e)?td.has(t)?9:Ih.has(t)?5:Dh.has(t)?6:Mh.has(t)?7:1:0}function pae(e,t){return e=e.toUpperCase(),t===5?iae.has(e)?2:oae.has(e)?3:sae.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function AO(e){return e=e.toUpperCase(),Ih.has(e)?"peptide linking":Dh.has(e)?"RNA linking":Mh.has(e)?"DNA linking":td.has(e)?"saccharide":"other"}function vae(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:ap.has(e)?"y":"n",pdbx_synonyms:[],type:AO(e)}}function hae(e){return e=e.toUpperCase(),E1.has(e)?"water":ap.has(e)?"polymer":td.has(e)?"branched":"non-polymer"}function gae(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),gO.has(t)?"polypeptide(L)":hO.has(t)?"polypeptide(D)":xO.has(t)?"polyribonucleotide":bO.has(t)?"polydeoxyribonucleotide":SO.has(t)||td.has(e)?"oligosaccharide":nw.has(e)?"peptide nucleic acid":rw.has(e)?"polypeptide(L)":CO.has(e)?"polypeptide(D)":Dh.has(e)?"polyribonucleotide":Mh.has(e)?"polydeoxyribonucleotide":lae.has(t)||pO.has(e)?"ion":fae.has(t)||mO.has(e)?"lipid":yO.has(t)?"peptide-like":"other"}function D1(e){return iu(e)||TO(e)}function iu(e){return e===7||e===6||e===8}function TO(e){return e===5}var yr;(function(e){e.is=Da.has,e.create=Da.create,e.SecondaryStructureMmcif={HELX_LH_27_P:2|32|1024,HELX_LH_3T_P:2|32|2048,HELX_LH_AL_P:2|32|4096,HELX_LH_A_N:1|32|524288,HELX_LH_B_N:1|32|1048576,HELX_LH_GA_P:2|32|8192,HELX_LH_N:1|32,HELX_LH_OM_P:2|32|16384,HELX_LH_OT_N:1|32|131072,HELX_LH_OT_P:2|32|512,HELX_LH_P:2|32,HELX_LH_PI_P:2|32|32768,HELX_LH_PP_P:2|32|65536,HELX_LH_Z_N:1|32|262144,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:2|64|1024,HELX_RH_3T_P:2|64|2048,HELX_RH_AL_P:2|64|4096,HELX_RH_A_N:1|64|524288,HELX_RH_B_N:1|64|1048576,HELX_RH_GA_P:2|64|8192,HELX_RH_N:1|64,HELX_RH_OM_P:2|64|16384,HELX_RH_OT_N:1|64|131072,HELX_RH_OT_P:2|64|512,HELX_RH_P:2|64,HELX_RH_PI_P:2|64|32768,HELX_RH_PP_P:2|64|65536,HELX_RH_Z_N:1|64|262144,STRN:4|4194304,TURN_OT_P:16|33554432,TURN_P:16,TURN_TY1P_P:16|256|67108864,TURN_TY1_P:16|128|67108864,TURN_TY2P_P:16|256|134217728,TURN_TY2_P:16|128|134217728,TURN_TY3P_P:16|256|268435456,TURN_TY3_P:16|128|268435456},e.SecondaryStructurePdb={1:2|64|4096,2:2|64|16384,3:2|64|32768,4:2|64|8192,5:2|64|2048,6:2|32|4096,7:2|32|16384,8:2|32|8192,9:2|1024,10:2|65536},e.SecondaryStructureStride={H:2|4096,G:2|2048,I:2|32768,E:4|8388608,B:4|4194304,T:16,C:536870912},e.SecondaryStructureDssp={H:2|4096,B:4|4194304,E:4|8388608,G:2|2048,I:2|32768,T:16,S:8}})(yr||(yr={}));var ar;(function(e){e.is=Da.has;function t(s){return Da.create(s)}e.create=t;function r(s){return(s&1)!=0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(s){return s in e.Names}e.isName=a;function i(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function o(s){for(var u=0,c=0,l=s.length;c<l;++c)u|=i(s[c]);return u}e.fromNames=o})(ar||(ar={}));var aw={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};Jt.atom_site.label_comp_id,Jt.atom_site.label_seq_id,Jt.atom_site.pdbx_PDB_ins_code,Jt.atom_site.label_asym_id,Jt.atom_site.label_entity_id,Jt.atom_site.auth_atom_id,Jt.atom_site.auth_seq_id,Jt.atom_site.auth_asym_id;I(I({},Jt.chem_comp_bond),{molstar_protonation_variant:ce.Schema.Str()});var yae=I(I({},Jt.chem_comp),{type:ce.Schema.Aliased(ce.Schema.str)}),gi={entry:Jt.entry,struct:Jt.struct,struct_asym:Jt.struct_asym,ihm_model_list:Jt.ihm_model_list,ihm_model_group:Jt.ihm_model_group,ihm_model_group_link:Jt.ihm_model_group_link,entity:Jt.entity,entity_poly:Jt.entity_poly,entity_poly_seq:Jt.entity_poly_seq,pdbx_entity_branch:Jt.pdbx_entity_branch,chem_comp:yae,pdbx_chem_comp_identifier:Jt.pdbx_chem_comp_identifier,atom_site:Jt.atom_site,ihm_sphere_obj_site:Jt.ihm_sphere_obj_site,ihm_gaussian_obj_site:Jt.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Jt.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Jt.pdbx_molecule};function nd(e){for(var t=Object.create(null),r=0,n=Object.keys(gi);r<n.length;r++){var a=n[r];a in e?t[a]=e[a]:t[a]=Ar.ofUndefinedColumns(gi[a],0)}return t}var bae=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],xae=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],Sae=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],Cae=new Set(["FMN","NCN","FNS","FMA"]),PO=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),EO=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Il=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(ap.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var a=this.seqId.value(t);if(a!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,a=r.length;n<a;++n)if(!Cn.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,bae)?"peptide linking":this.hasAtomIds(t,xae)?"RNA linking":this.hasAtomIds(t,Sae)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(PO.has(t))this.set(PO.get(t));else if(E1.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(Cae.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&EO.has(t))this.set(EO.get(t));else{var a=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:a})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Ar.ofPartialColumns(gi.chem_comp,{id:ce.ofStringArray(this.ids),name:ce.ofStringArray(this.names),type:ce.ofStringAliasArray(this.types),mon_nstd_flag:ce.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function IO(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}var iw="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function _ae(e){for(var t=iw.length,r=e,n=0,a=iw[r%t];r>=t;)r=Math.floor(r/t),a+=iw[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),a}var ow=IO(_ae),Dl=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push("".concat(this.count)),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,a){return r===2?(this.waterId===void 0&&(this.set("water",(a==null?void 0:a.customName)||"Water"),this.waterId="".concat(this.count)),this.waterId):D1(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(a==null?void 0:a.customName)||"Polymer ".concat(this.chainMap.size+1)),this.chainMap.set(n,"".concat(this.count))),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(a==null?void 0:a.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,"".concat(this.count))),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Ar.ofPartialColumns(gi.entity,{id:ce.ofStringArray(this.ids),type:ce.ofStringAliasArray(this.types),pdbx_description:ce.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var a=t[r],i=a.chains,o=a.description;this.set("polymer",o);for(var s=0,u=i.length;s<u;++s)this.compoundsMap.set(i[s],"".concat(this.count))}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function wae(e,t){var r=[],n=[],a=[];e.x.length&&(r.push.apply(r,Ki(e.x)),n.push.apply(n,Ki(e.y)),a.push.apply(a,Ki(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,Ki(t.spheres.x)),n.push.apply(n,Ki(t.spheres.y)),a.push.apply(a,Ki(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,Ki(t.gaussians.x)),n.push.apply(n,Ki(t.gaussians.y)),a.push.apply(a,Ki(t.gaussians.z))));var i=Ki(r),o=i[0],s=i[1],u=Ki(n),c=u[0],l=u[1],f=Ki(a),d=f[0],m=f[1],p=o+(s-o)/2,v=c+(l-c)/2,h=d+(m-d)/2;return S.create(p,v,h)}function Aae(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,a){var i=n.auth_id;t.add(i),r.add(a)}),{auth:t.size,label:r.size}}var Ni;(function(e){function t(f,d){if(f===d)return!0;if(f.vertexCount!==d.vertexCount||f.edgeCount!==d.edgeCount)return!1;for(var m=f.a,p=f.b,v=f.offset,h=d.a,g=d.b,y=d.offset,b=0,x=f.a.length;b<x;b++)if(m[b]!==h[b])return!1;for(var b=0,x=f.b.length;b<x;b++)if(p[b]!==g[b])return!1;for(var b=0,x=f.offset.length;b<x;b++)if(v[b]!==y[b])return!1;for(var C=0,_=Object.keys(f.edgeProps);C<_.length;C++){var w=_[C],T=f.edgeProps[w],A=d.edgeProps[w];if(!A)return!1;for(var b=0,x=T.length;b<x;b++)if(T[b]!==A[b])return!1}return!0}e.areEqual=t;var r=function(){function f(d,m,p,v,h,g){this.offset=d,this.a=m,this.b=p,this.edgeCount=v,this.props=g,this.vertexCount=d.length-1,this.edgeProps=h||{}}return f.prototype.getEdgeIndex=function(d,m){var p,v;d<m?(p=d,v=m):(p=m,v=d);for(var h=this.offset[p],g=this.offset[p+1];h<g;h++)if(this.b[h]===v)return h;return-1},f.prototype.getDirectedEdgeIndex=function(d,m){for(var p=this.offset[d],v=this.offset[d+1];p<v;p++)if(this.b[p]===m)return p;return-1},f.prototype.getVertexEdgeCount=function(d){return this.offset[d+1]-this.offset[d]},f}();function n(f,d,m,p,v,h){return new r(f,d,m,p,v,h)}e.create=n;var a=function(){function f(d,m,p){this.vertexCount=d,this.xs=m,this.ys=p,this.current=0,this.curA=0,this.curB=0,this.edgeCount=m.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var v=new Int32Array(this.vertexCount),h=0,g=this.xs.length;h<g;h++)v[this.xs[h]]++;for(var h=0,g=this.ys.length;h<g;h++)v[this.ys[h]]++;for(var y=0,h=0;h<this.vertexCount;h++)this.offsets[h]=y,y+=v[h];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return f.prototype.createGraph=function(d,m){return n(this.offsets,this.a,this.b,this.edgeCount,d,m)},f.prototype.addNextEdge=function(){var d=this.xs[this.current],m=this.ys[this.current],p=this.offsets[d]+this.bucketFill[d],v=this.offsets[m]+this.bucketFill[m];this.a[p]=d,this.b[p]=m,this.bucketFill[d]++,this.a[v]=m,this.b[v]=d,this.bucketFill[m]++,this.current++,this.curA=p,this.curB=v},f.prototype.addAllEdges=function(){for(var d=0;d<this.edgeCount;d++)this.addNextEdge()},f.prototype.assignProperty=function(d,m){d[this.curA]=m,d[this.curB]=m},f}();e.EdgeBuilder=a;var i=function(){function f(d,m,p){this.vertexCount=d,this.xs=m,this.ys=p,this.current=0,this.curA=0,this.edgeCount=m.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var v=new Int32Array(this.vertexCount),h=0,g=this.xs.length;h<g;h++)v[this.xs[h]]++;for(var y=0,h=0;h<this.vertexCount;h++)this.offsets[h]=y,y+=v[h];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return f.prototype.createGraph=function(d){return n(this.offsets,this.a,this.b,this.edgeCount,d)},f.prototype.addNextEdge=function(){var d=this.xs[this.current],m=this.ys[this.current],p=this.offsets[d]+this.bucketFill[d];this.a[p]=d,this.b[p]=m,this.bucketFill[d]++,this.current++,this.curA=p},f.prototype.addAllEdges=function(){for(var d=0;d<this.edgeCount;d++)this.addNextEdge()},f.prototype.assignProperty=function(d,m){d[this.curA]=m},f}();e.DirectedEdgeBuilder=i;var o=function(){function f(d){this.vertexCount=d,this.xs=[],this.ys=[],this.included=new Set}return f.prototype.addEdge=function(d,m){var p=d,v=m;d>m&&(p=m,v=d);var h=To(p,v);return this.included.has(h)?!1:(this.included.add(h),this.xs[this.xs.length]=p,this.ys[this.ys.length]=v,!0)},f.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},f.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},f}();e.UniqueEdgeBuilder=o;function s(f,d,m){var p=new e.EdgeBuilder(f,d,m);return p.addAllEdges(),p.createGraph({})}e.fromVertexPairs=s;function u(f,d){for(var m=f.b,p=f.offset,v=f.vertexCount,h=f.edgeProps,g=new Int32Array(v),y=0,b=d.length;y<b;y++)g[d[y]]=y+1;for(var x=0,y=0;y<v;y++)if(g[y]!==0)for(var C=p[y],_=p[y+1];C<_;C++)m[C]>y&&g[m[C]]!==0&&x++;for(var w=new Int32Array(d.length+1),T=new Int32Array(2*x),A=new Int32Array(2*x),D=new Int32Array(2*x),E=0,M=0,y=0;y<v;y++)if(g[y]!==0){for(var F=g[y]-1,C=p[y],_=p[y+1];C<_;C++){var O=g[m[C]];O!==0&&(A[E]=F,D[E]=O-1,T[E]=C,E++)}w[++M]=E}for(var U={},N=0,q=Object.keys(h);N<q.length;N++){var j=q[N];U[j]=jj(h[j],T)}return n(w,A,D,x,U)}e.induceByVertices=u;function c(f){var d=f.vertexCount;if(d===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(f.edgeCount===0){for(var m=new Int32Array(d),p=0,v=d;p<v;p++)m[p]=p;return{componentCount:d,componentIndex:m}}for(var h=new Int32Array(d),p=0,v=d;p<v;p++)h[p]=-1;var g=0;h[0]=g;var y=f.offset,b=f.b,x=[0],C=i$(d);for(C.remove(0);x.length>0;){for(var _=x.pop(),w=h[_],T=y[_],A=y[_+1];T<A;T++){var D=b[T];!C.has(D)||(C.remove(D),x.push(D),h[D]=w)}x.length===0&&C.head>=0&&(x.push(C.head),h[C.head]=++g,C.remove(C.head))}return{componentCount:d,componentIndex:h}}e.connectedComponents=c;function l(f,d,m,p){if(Le.areIntersecting(d,m))return!0;if(p<1)return!1;for(var v=new Set,h=0,g=d.length;h<g;++h)v.add(d[h]);return DO(f,d,m,p,v)}e.areVertexSetsConnected=l})(Ni||(Ni={}));function DO(e,t,r,n,a){for(var i=e.b,o=e.offset,s=[],u=0,c=t.length;u<c;++u)for(var l=t[u],f=o[l],d=o[l+1];f<d;++f){var m=i[f];if(!a.has(m)){if(Le.has(r,m))return!0;a.add(m),s[s.length]=m}}return n>1?DO(e,s,r,n-1,a):!1}var Tae=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),_s;(function(e){function t(r){var n=r.name,a=new Tae;return{descriptor:r,formatRegistry:a,isApplicable:function(i){return a.isApplicable(i)},get:function(i){if(i._staticPropertyData[n])return i._staticPropertyData[n];if(!i.customProperties.has(r)){var o=a.get(i.sourceData.kind);if(!!o)return i._staticPropertyData[n]=o(i),i.customProperties.add(r),i._staticPropertyData[n]}},set:function(i,o){i._staticPropertyData[n]=o},delete:function(i){delete i._staticPropertyData[n]}}}e.create=t})(_s||(_s={}));function Pae(e,t,r,n){for(var a=new Ni.EdgeBuilder(n,e,t),i=new Int32Array(a.slotCount),o=new Int8Array(a.slotCount),s=new Array(a.slotCount),u=new Array(a.slotCount),c=0,l=a.edgeCount;c<l;c++)a.addNextEdge(),a.assignProperty(i,r.key?r.key[c]:-1),a.assignProperty(o,r.order?r.order[c]:1),a.assignProperty(s,r.distance?r.distance[c]:-1),a.assignProperty(u,r.flag?r.flag[c]:1);return a.createGraph({key:i,order:o,distance:s,flag:u})}var La;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=_s.create(e.Descriptor),e.DefaultProps={maxDistance:-1};function t(r,n){n===void 0&&(n={});var a=I(I({},e.DefaultProps),n),i=r.pairs,o=r.count,s=i.indexA.toArray(),u=i.indexB.toArray(),c=i.key&&i.key.toArray(),l=i.order&&i.order.toArray(),f=i.distance&&i.distance.toArray(),d=i.flag&&i.flag.toArray();return{bonds:Pae(s,u,{key:c,order:l,distance:f,flag:d},o),maxDistance:a.maxDistance}}e.fromData=t})(La||(La={}));var sw=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,a){return new e(r,n,a)}e.create=t})(sw||(sw={}));var Rh;(function(e){e.Default={assemblies:[],spacegroup:Mo.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,a){var i=a.toLocaleLowerCase(),o=_n.Provider.get(n);return o?r3(o.assemblies,function(s){return s.id.toLowerCase()===i}):void 0}e.findAssembly=t;function r(n){var a=n.spacegroup,i=a.cell,o=a.name,s=a.num,u=i.size,c=i.anglesInRadians,l=u[0].toFixed(2),f=u[1].toFixed(2),d=u[2].toFixed(2),m=ps(c[0]).toFixed(2),p=ps(c[1]).toFixed(2),v=ps(c[2]).toFixed(2),h=[];return h.push("Unit Cell <b>".concat(o,"</b> #").concat(s)),h.push("".concat(l,"\xD7").concat(f,"\xD7").concat(d," \u212B")),h.push("\u03B1=".concat(m,"\xB0 \u03B2=").concat(p,"\xB0 \u03B3=").concat(v,"\xB0")),h.join(" | ")}e.getUnitcellLabel=r})(Rh||(Rh={}));var uw;(function(e){function t(r,n,a,i){return{id:zr.create22(),label:r,basic:n,sourceData:i,bonds:a}}e.create=t})(uw||(uw={}));var Eae={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},Iae={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},Dae={A:"A",C:"C",G:"G",T:"T",U:"U"};function MO(e){var t=Eae[e];return t||"X"}function RO(e){var t=Dae[e];return t||"X"}function BO(e){var t=Iae[e];return t||"X"}var Bh;(function(e){function t(u){var c=u.code.toArray();return(c instanceof Array?c:Array.from(c)).join("")}e.getSequenceString=t;function r(u){for(var c=0,l=Math.min(u.rowCount,10);c<l;c++){var f=u.value(c)||"";if(MO(f)!=="X")return"protein";if(RO(f)!=="X")return"RNA";if(BO(f)!=="X")return"DNA"}return"generic"}function n(u,c){var l;switch(u){case"protein":l=MO;break;case"DNA":l=BO;break;case"RNA":l=RO;break;case"generic":l=function(){return"X"};break;default:throw new Error("unknown kind '".concat(u,"'"))}return c&&c.size>0?function(f){var d=l(f);return d!=="X"||!c.has(f)?d:l(c.get(f))}:l}function a(u,c){if(c.rowCount===0)throw new Error("cannot be empty");var l=r(u);return new i(l,u,c)}e.ofResidueNames=a;var i=function(){function u(c,l,f){this.kind=c,this.microHet=new Map;for(var d=n(c),m=[],p=[],v=[],h=new Map,g=0,y=new Map,b=0,x=f.rowCount;b<x;++b){var C=f.value(b);if(y.has(C))h.has(C)?h.get(C).push(l.value(b)):h.set(C,[p[y.get(C)],l.value(b)]);else{y.set(C,g);var _=l.value(b);p[g]=_,v[g]=C,m[g]=d(_),g+=1}}for(var w=[],b=0,x=g;b<x;++b){var T=h.get(v[b]);if(T){var A=T.map(function(M){var F=d(M);return F==="X"?M:F});w[b]="(".concat(A.join("|"),")")}else w[b]=m[b]==="X"?p[b]:m[b]}this.length=g,this.code=ce.ofStringArray(m),this.compId=ce.ofStringArray(p),this.seqId=ce.ofIntArray(v),this.label=ce.ofStringArray(w),this.microHet=h,this.indexMap=y}return u.prototype.index=function(c){return this.indexMap.get(c)},u}();function o(u,c){var l="generic";return new s(l,u,c)}e.ofSequenceRanges=o;var s=function(){function u(c,l,f){this.kind=c,this.seqIdStart=l,this.seqIdEnd=f,this.microHet=new Map;for(var d=0,m=Number.MAX_SAFE_INTEGER,p=0,v=this.seqIdStart.rowCount;p<v;p++){var h=this.seqIdStart.value(p),g=this.seqIdEnd.value(p);h<m&&(m=h),d<g&&(d=g)}var y=d-m+1;this.code=ce.ofConst("X",y,ce.Schema.str),this.label=ce.ofConst("",y,ce.Schema.str),this.seqId=ce.ofLambda({value:function(b){return b+m+1},rowCount:y,schema:ce.Schema.int}),this.compId=ce.ofConst("",y,ce.Schema.str),this.length=y,this.minSeqId=m}return u.prototype.index=function(c){return c-this.minSeqId},u}()})(Bh||(Bh={}));var cw;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var c=[],l={},f=0,d=s.length;f<d;++f)c.push.apply(c,s[f].sequences),Object.assign(l,s[f].byEntityKey);return{sequences:c,byEntityKey:l}}function n(s,u,c){var l=a(s,u),f=c.isDefined?i(s,c):t;return r(l,f)}e.fromHierarchy=n;function a(s,u){var c=u.atoms.label_comp_id,l=u.residues.label_seq_id,f=u.chainAtomSegments,d=u.residueAtomSegments,m=f.count,p=f.offsets,v={},h=[];if(m===1&&p[0]===0&&p[1]===0)return{byEntityKey:v,sequences:h};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(v[b]!==void 0||s.data.type.value(b)!=="polymer")){var x=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var C=d.index[p[x]],_=d.index[p[g+1]-1]+1,w=ce.window(l,C,_),T=[],A=C;A<_;++A)T.push(c.value(d.offsets[A]));var D=ce.ofStringArray(T);v[b]={entityId:s.data.id.value(b),sequence:Bh.ofResidueNames(D,w)},h.push(v[b])}}return{byEntityKey:v,sequences:h}}e.fromAtomicHierarchy=a;function i(s,u){var c=o(s,u.spheres),l=o(s,u.gaussians);return r(c,l)}e.fromCoarseHierarchy=i;function o(s,u){var c=u.chainElementSegments,l=u.seq_id_begin,f=u.seq_id_end,d=c.count,m=c.offsets,p={},v=[];if(d===1&&m[0]===0&&m[1]===0)return{byEntityKey:p,sequences:v};for(var h=0,g=d;h<g;h++){var y=u.getEntityFromChain(h);if(p[y]===void 0){var b=h;for(h++;h<g&&y===u.getEntityFromChain(h);)h++;h--;var x=m[b],C=m[h+1]-1,_=ce.window(l,x,C),w=ce.window(f,x,C);p[y]={entityId:s.data.id.value(y),sequence:Bh.ofSequenceRanges(_,w)},v.push(p[y])}}return{byEntityKey:p,sequences:v}}e.fromCoarseElements=o})(cw||(cw={}));var Qe;(function(e){function t(d,m,p){return{kind:"element-location",structure:d,unit:m,element:p||0}}e.create=t;function r(d){return t(d.structure,d.unit,d.element)}e.clone=r;function n(d,m,p,v){return m&&(d.structure=m),p&&(d.unit=p),v!==void 0&&(d.element=v),d}e.set=n;function a(d,m){return d.unit=m.unit,d.element=m.element,d}e.copy=a;function i(d){return!!d&&d.kind==="element-location"}e.is=i;function o(d,m){return d.unit===m.unit&&d.element===m.element}e.areEqual=o;var s=S.zero(),u=S.zero();function c(d,m){return d.unit.conformation.position(d.element,s),m.unit.conformation.position(m.element,u),S.distance(s,u)}e.distance=c;function l(d){return d.unit.model.atomicHierarchy.residueAtomSegments.index[d.element]}e.residueIndex=l;function f(d){return d.unit.model.atomicHierarchy.chainAtomSegments.index[d.element]}e.chainIndex=f})(Qe||(Qe={}));var be;(function(e){function t(s,u,c){return{kind:"variable",name:s,type:u,isConstraint:c}}e.Variable=t;function r(s,u,c){return{kind:"value",namespace:s,name:u,parent:c}}e.Value=r;function n(s,u,c,l){return{kind:"container",namespace:s,name:u,child:c,alias:l}}e.Container=n;function a(s){return{kind:"union",types:s}}e.Union=a;function i(s,u,c,l){for(var f=Object.create(null),d=0,m=l;d<m.length;d++){var p=m[d];f[p]=!0}return{kind:"oneof",namespace:s,name:u,type:c,values:f}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(be||(be={}));var Qn;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,c){return c?{head:u,args:c}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function a(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=a;function i(u){return!o(u)&&!s(u)}e.isLiteral=i;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(Qn||(Qn={}));function $e(e,t){var r=t||{},n=r.description,a=n===void 0?void 0:n,i=r.isOptional,o=i===void 0?!1:i,s=r.isRest,u=s===void 0?!1:s,c=r.defaultValue,l=c===void 0?void 0:c;return{type:e,isOptional:o,isRest:u,defaultValue:l,description:a}}var St;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,a){var i=(a||{}).nonEmpty,o=i===void 0?!1:i;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(St||(St={}));function Fh(e,t,r,n){var a=function(i){return Qn.Apply(Qn.Symbol(a.id),i)};return a.info={namespace:"",name:e,description:n},a.id="",a.args=t,a.type=r,a}function FO(e,t,r,n){var a=function(i){return Qn.Apply(Qn.Symbol(a.id),i)};return a.info={namespace:e,name:t,description:n},a.id="".concat(e,".").concat(t),a.args=St.None,a.type=r,a}function M1(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function It(e,t,r){return Fh("",e,t,r)}function OO(e){NO("","",e)}function kO(e){var t=[];return UO(e,t),t}function LO(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)}).replace(t,function(r,n,a,i){return"".concat(n,"-").concat(a.toLocaleLowerCase()).concat(i)})}function NO(e,t,r){if(M1(r)){r.info.namespace=e,r.info.name=r.info.name||LO(t),r.id="".concat(r.info.namespace,".").concat(r.info.name);return}for(var n="".concat(r["@namespace"]||LO(t)),a=e?"".concat(e,".").concat(n):n,i=0,o=Object.keys(r);i<o.length;i++){var s=o[i];typeof r[s]!="object"&&!M1(r[s])||NO(a,s,r[s])}}function UO(e,t){if(M1(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];typeof e[a]!="object"&&!M1(e[a])||UO(e[a],t)}}var ir;(function(e){e.AnyVar=be.Variable("a",be.Any),e.AnyValueVar=be.Variable("a",be.Any),e.ConstrainedVar=be.Variable("a",be.Any,!0),e.Regex=be.Value("Core","Regex"),e.Set=function(t){return be.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return be.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return be.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return be.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(be.Num,"BitFlags")})(ir||(ir={}));function fa(e,t){return It(St.Dictionary({0:$e(e)}),e,t)}function Ml(e,t){return It(St.List(e,{nonEmpty:!0}),e,t)}function ou(e,t,r){return It(St.Dictionary({0:$e(e),1:$e(e)}),t,r)}St.Dictionary({0:$e(be.Num),1:$e(be.Num)});$e(be.Str);var Mae={"@header":"Types",bool:It(St.Dictionary({0:$e(be.AnyValue)}),be.Bool,"Convert a value to boolean."),num:It(St.Dictionary({0:$e(be.AnyValue)}),be.Num,"Convert a value to number."),str:It(St.Dictionary({0:$e(be.AnyValue)}),be.Str,"Convert a value to string."),regex:It(St.Dictionary({0:$e(be.Str,{description:"Expression"}),1:$e(be.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),ir.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:It(St.List(ir.AnyVar),ir.List()),set:It(St.List(ir.AnyValueVar),ir.Set()),bitflags:It(St.Dictionary({0:$e(be.Num)}),ir.BitFlags,"Interpret a number as bitflags."),compositeKey:It(St.List(be.AnyValue),be.AnyValue)},Rae={"@header":"Logic",not:fa(be.Bool),and:Ml(be.Bool),or:Ml(be.Bool)},Bae={"@header":"Control",eval:It(St.Dictionary({0:$e(ir.Fn(ir.AnyVar))}),ir.AnyVar,"Evaluate a function."),fn:It(St.Dictionary({0:$e(ir.AnyVar)}),ir.Fn(ir.AnyVar),'Wrap an expression to a "lazy" function.'),if:It(St.Dictionary({0:$e(be.Bool,{description:"Condition"}),1:$e(be.Variable("a",be.Any),{description:"If true"}),2:$e(be.Variable("b",be.Any),{description:"If false"})}),be.Union([be.Variable("a",be.Any),be.Variable("b",be.Any)])),assoc:It(St.Dictionary({0:$e(be.Str,{description:"Name"}),1:$e(be.Variable("a",be.Any),{description:"Value to assign"})}),be.Variable("a",be.Any))},Fae={"@header":"Relational",eq:ou(be.Variable("a",be.AnyValue,!0),be.Bool),neq:ou(be.Variable("a",be.AnyValue,!0),be.Bool),lt:ou(be.Num,be.Bool),lte:ou(be.Num,be.Bool),gr:ou(be.Num,be.Bool),gre:ou(be.Num,be.Bool),inRange:It(St.Dictionary({0:$e(be.Num,{description:"Value to test"}),1:$e(be.Num,{description:"Minimum value"}),2:$e(be.Num,{description:"Maximum value"})}),be.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},Oae={"@header":"Math",add:Ml(be.Num),sub:Ml(be.Num),mult:Ml(be.Num),div:ou(be.Num,be.Num),pow:ou(be.Num,be.Num),mod:ou(be.Num,be.Num),min:Ml(be.Num),max:Ml(be.Num),floor:fa(be.Num),ceil:fa(be.Num),roundInt:fa(be.Num),abs:fa(be.Num),sqrt:fa(be.Num),cbrt:fa(be.Num),sin:fa(be.Num),cos:fa(be.Num),tan:fa(be.Num),asin:fa(be.Num),acos:fa(be.Num),atan:fa(be.Num),sinh:fa(be.Num),cosh:fa(be.Num),tanh:fa(be.Num),exp:fa(be.Num),log:fa(be.Num),log10:fa(be.Num),atan2:ou(be.Num,be.Num)},kae={"@header":"Strings",concat:Ml(be.Str),match:It(St.Dictionary({0:$e(ir.Regex),1:$e(be.Str)}),be.Bool)},Lae={"@header":"Lists",getAt:It(St.Dictionary({0:$e(ir.List()),1:$e(be.Num)}),ir.AnyVar),equal:It(St.Dictionary({0:$e(ir.List()),1:$e(ir.List())}),be.Bool)},Nae={"@header":"Sets",has:It(St.Dictionary({0:$e(ir.Set(ir.ConstrainedVar)),1:$e(ir.ConstrainedVar)}),be.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:It(St.Dictionary({0:$e(ir.Set(ir.ConstrainedVar)),1:$e(ir.Set(ir.ConstrainedVar))}),be.Bool,"Check if the the 1st argument is a subset of the 2nd.")},Uae={"@header":"Flags",hasAny:It(St.Dictionary({0:$e(ir.Flags(ir.ConstrainedVar)),1:$e(ir.Flags(ir.ConstrainedVar))}),be.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:It(St.Dictionary({0:$e(ir.Flags(ir.ConstrainedVar)),1:$e(ir.Flags(ir.ConstrainedVar))}),be.Bool,"Check if the the 1st argument has all 2nd one's flags.")},lw={"@header":"Language Primitives",type:Mae,logic:Rae,ctrl:Bae,rel:Fae,math:Oae,str:kae,list:Lae,set:Nae,flags:Uae};OO(lw);var zae=kO(lw);(function(){for(var e=Object.create(null),t=0,r=zae;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var lt;(function(e){e.ElementSymbol=be.Value("Structure","ElementSymbol"),e.AtomName=be.Value("Structure","AtomName"),e.BondFlag=be.OneOf("Structure","BondFlag",be.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=ir.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=be.OneOf("Structure","SecondaryStructureFlag",be.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=ir.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=be.Value("Structure","RingFingerprint"),e.EntityType=be.OneOf("Structure","EntityType",be.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=be.OneOf("Structure","EntitySubtype",be.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=be.OneOf("Structure","ObjectPrimitive",be.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=be.Value("Structure","ResidueId"),e.ElementSet=be.Value("Structure","ElementSet"),e.ElementSelection=be.Value("Structure","ElementSelection"),e.ElementReference=be.Value("Structure","ElementReference"),e.ElementSelectionQuery=ir.Fn(e.ElementSelection,"ElementSelectionQuery")})(lt||(lt={}));var Vae={"@header":"Types",elementSymbol:It(St.Dictionary({0:$e(be.Str)}),lt.ElementSymbol,"Create element symbol representation from a string value."),atomName:It(St.Dictionary({0:$e(be.AnyValue)}),lt.AtomName,"Convert a value to an atom name."),entityType:It(St.Dictionary({0:$e(lt.EntityType)}),lt.EntityType,"Create normalized representation of entity type: ".concat(be.oneOfValues(lt.EntityType).join(", "),".")),bondFlags:It(St.List(lt.BondFlag),lt.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: ".concat(be.oneOfValues(lt.BondFlag).join(", "),".")),ringFingerprint:It(St.List(lt.ElementSymbol,{nonEmpty:!0}),lt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:It(St.List(lt.SecondaryStructureFlag),lt.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: ".concat(be.oneOfValues(lt.SecondaryStructureFlag).join(", "),".")),authResidueId:It(St.Dictionary({0:$e(be.Str,{description:"auth_asym_id"}),1:$e(be.Num,{description:"auth_seq_id"}),2:$e(be.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),lt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:It(St.Dictionary({0:$e(be.Str,{description:"label_entity_id"}),1:$e(be.Str,{description:"label_asym_id"}),2:$e(be.Num,{description:"label_seq_id"}),3:$e(be.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),lt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},Gae={"@header":"Iteration Slots",element:It(St.None,lt.ElementReference,"A reference to the current element."),elementSetReduce:It(St.None,be.Variable("a",be.AnyValue,!0),"Current value of the element set reducer.")},Hae={"@header":"Generators",all:It(St.None,lt.ElementSelectionQuery,"The entire structure."),atomGroups:It(St.Dictionary({"entity-test":$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":$e(be.Bool,{isOptional:!0,defaultValue:!0}),"group-by":$e(be.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),lt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:It(St.Dictionary({0:$e(be.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),lt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:It(St.Dictionary({fingerprint:$e(lt.RingFingerprint,{isOptional:!0}),"only-aromatic":$e(be.Bool,{isOptional:!0,defaultValue:!1})}),lt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),query:$e(lt.ElementSelectionQuery),"in-complement":$e(be.Bool,{isOptional:!0,defaultValue:!1})}),lt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:It(St.None,lt.ElementSelectionQuery,"Nada.")},qae={"@header":"Selection Modifications",queryEach:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),query:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),by:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),by:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),by:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:It(St.Dictionary({0:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),"min-distance":$e(be.Num,{isOptional:!0,defaultValue:0}),"max-distance":$e(be.Num),"min-size":$e(be.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":$e(be.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),lt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),radius:$e(be.Num),"atom-radius":$e(be.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":$e(be.Bool,{isOptional:!0})}),lt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),radius:$e(be.Num),"include-water":$e(be.Bool,{isOptional:!0,defaultValue:!0})}),lt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),"bond-test":$e(be.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":$e(be.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":$e(be.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":$e(be.Bool,{isOptional:!0})}),lt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:It(St.Dictionary({0:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),property:$e(be.AnyValue)}),lt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},jae={"@header":"Selection Filters",pick:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),test:$e(be.Bool)}),lt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:It(St.Dictionary({0:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),source:$e(lt.ElementSelectionQuery),property:$e(be.Any)}),lt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),by:$e(lt.ElementSelectionQuery)}),lt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),target:$e(lt.ElementSelectionQuery),"min-radius":$e(be.Num,{isOptional:!0,defaultValue:0}),"max-radius":$e(be.Num),"atom-radius":$e(be.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:$e(be.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),lt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:It(St.Dictionary({0:$e(lt.ElementSelectionQuery),target:$e(lt.ElementSelectionQuery),"bond-test":$e(be.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:$e(be.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),lt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},Wae={"@header":"Selection Combinators",intersect:It(St.List(lt.ElementSelectionQuery),lt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:It(St.List(lt.ElementSelectionQuery),lt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:It(St.Dictionary({matrix:$e(ir.List(ir.List(be.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:$e(ir.List(lt.ElementSelectionQuery),{description:"A list of held selections."})}),lt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},Xae={"@header":"Atom Sets",atomCount:It(St.None,be.Num),countQuery:It(St.Dictionary({0:$e(lt.ElementSelectionQuery)}),be.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:It(St.Dictionary({initial:$e(be.Variable("a",be.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:$e(be.Variable("a",be.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),be.Variable("a",be.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:It(St.Dictionary({0:$e(ir.ConstrainedVar)}),ir.Set(ir.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},Yae={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:nr(lt.ElementSymbol),vdw:nr(be.Num,"Van der Waals radius"),mass:nr(be.Num,"Atomic weight"),atomicNumber:nr(be.Num,"Atomic number"),x:nr(be.Num,"Cartesian X coordinate"),y:nr(be.Num,"Cartesian Y coordinate"),z:nr(be.Num,"Cartesian Z coordinate"),atomKey:nr(be.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:It(St.Dictionary({0:$e(lt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:$e(lt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),be.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:nr(be.Num,"Index of the atom/element in the input file."),operatorName:nr(be.Str,"Name of the symmetry operator applied to this element."),modelIndex:nr(be.Num,"Index of the model in the input file."),modelLabel:nr(be.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:nr(be.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:nr(lt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:nr(lt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:nr(be.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:nr(be.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:nr(be.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:nr(be.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:nr(be.Num,"_atom_site.id"),label_atom_id:nr(lt.AtomName),label_alt_id:nr(be.Str),label_comp_id:nr(be.Str),label_asym_id:nr(be.Str),label_entity_id:nr(be.Str),label_seq_id:nr(be.Num),auth_atom_id:nr(lt.AtomName),auth_comp_id:nr(be.Str),auth_asym_id:nr(be.Str),auth_seq_id:nr(be.Num),pdbx_PDB_ins_code:nr(be.Str),pdbx_formal_charge:nr(be.Num),occupancy:nr(be.Num),B_iso_or_equiv:nr(be.Num),entityType:nr(lt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:nr(lt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:nr(be.Str,"The PRD ID of the entity."),entityDescription:nr(ir.List(be.Str)),objectPrimitive:nr(lt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:nr(be.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:nr(lt.SecondaryStructureFlags),isModified:nr(be.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:nr(be.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:nr(be.Bool,"True if this is a non-standard residue."),chemCompType:nr(be.Str,"Type of the chemical component as defined in mmCIF.")}},Kae={"@header":"Bond Properties",flags:Oh(lt.BondFlags),order:Oh(be.Num),length:Oh(be.Num),atomA:Oh(lt.ElementReference),atomB:Oh(lt.ElementReference)};function nr(e,t){return It(St.Dictionary({0:$e(lt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function Oh(e,t){return It(St.None,e,t)}var Qae={"@header":"Structure Queries",type:Vae,slot:Gae,generator:Hae,modifier:qae,filter:jae,combinator:Wae,atomSet:Xae,atomProperty:Yae,bondProperty:Kae},Zae={"@header":"Generators",bundleElement:It(St.Dictionary({groupedUnits:$e(be.Any),set:$e(be.Any),ranges:$e(be.Any)}),be.Any),bundle:It(St.Dictionary({elements:$e(be.Any)}),lt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:It(St.None,lt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},$ae={"@header":"Internal Queries",generator:Zae},ve={core:lw,structureQuery:Qae,internal:$ae};OO(ve);var Jae=kO(ve);(function(){for(var e=Object.create(null),t=0,r=Jae;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var ne;(function(e){e.core=ve.core,e.struct=ve.structureQuery,e.internal=ve.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function a(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=a;function i(y,b){return e.core.type.regex([y,b])}e.re=i;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,c=e.struct.atomProperty.macromolecular,l=e.struct.atomProperty.topology;function f(y){return u[y]()}e.acp=f;function d(y){return l[y]()}e.atp=d;function m(y){return c[y]()}e.ammp=m;var p=e.struct.atomSet.propertySet;function v(y){return p([f(y)])}e.acpSet=v;function h(y){return p([d(y)])}e.atpSet=h;function g(y){return p([m(y)])}e.ammpSet=g})(ne||(ne={}));var ad=function(){function e(t){this.map=t;var r=0,n=[],a=new Map,i=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(c){var l=s.unitA,f=s.unitB,d=e.getEdgeKey(u,l,c.indexB,f);a.set(d,n.length);var m=e.getVertexKey(u,l),p=i.get(m);p===void 0?i.set(m,[n.length]):p.push(n.length),n.push(I(I({},c),{indexA:u,unitA:l,unitB:f}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=a,this.vertexKeyIndex=i}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):zO},e.prototype.getEdgeIndex=function(t,r,n,a){var i=e.getEdgeKey(t,r,n,a),o=this.edgeKeyIndex.get(i);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,a){return this.getEdgeIndex(t,r,n,a)!==-1},e.prototype.getEdge=function(t,r,n,a){var i=this.getEdgeIndex(t,r,n,a);return i!==-1?this.edges[i]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,c,l,f){this.unitA=s,this.unitB=u,this.edgeCount=c,this.connectedIndices=l,this.edgeMap=f}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):zO},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,c){return"".concat(o,"|").concat(s,"|").concat(u,"|").concat(c)}e.getEdgeKey=r;function n(o,s){return"".concat(o,"|").concat(s)}e.getVertexKey=n;function a(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var i=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Br.create(),this.linkedB=Br.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,c){a(this.mapAB,s,{indexB:u,props:c}),a(this.mapBA,u,{indexB:s,props:c}),Br.add(this.linkedA,s,s),Br.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=i})(ad||(ad={}));var zO=[],fw;(function(e){e.Empty=Ni.create([],[],[],0,{flags:[],order:[]})})(fw||(fw={}));var R1=function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return Re.isAtomic(r.aUnit)&&Re.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return Re.isAtomic(r.aUnit)&&Re.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(ad);(function(e){var t=function(r){_t(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(ad.UnitPairEdges);e.UnitPairBonds=t})(R1||(R1={}));var eie=4,VO={forceCompute:!1,noCompute:!1,maxRadius:eie},dw={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},tie={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},rie={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},GO=2.001,kh=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var a=n[r];t.add(dw[a])}return t}();function nie(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function su(e){var t=dw[e];return t===void 0?-1:t}function aie(e,t){if(e<0||t<0)return-1;var r=rie[nie(e,t)];return r===void 0?-1:r}function Rl(e){if(e<0)return GO;var t=tie[e];return t===void 0?GO:t}function B1(e,t,r,n){var a=aie(e,t);return a>0?a:t<0?r:(r+n)/1.95}var iie=dw.H;function lc(e){return e===iie}var oie=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function sie(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],Ih.has(e)&&t==="C"&&r==="O"||I1.has(e)&&t==="OP1"&&r==="P"?2:oie.get("".concat(e,"|").concat(t,"|").concat(r))||1}var uie=new Map([["LYS|NZ|RET|C15",2]]);function HO(e,t,r,n){var a,i;return e>r&&(a=[r,e],e=a[0],r=a[1],i=[n,t],t=i[0],n=i[1]),uie.get("".concat(e,"|").concat(t,"|").concat(r,"|").concat(n))||1}var mw;(function(e){function t(s,u,c){return{name:s,type:0,value:u,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}}e.str=t;function r(s,u,c){return{name:s,type:1,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}e.int=r;function n(s,u,c){return{name:s,type:2,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount!="undefined"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}}e.float=n;function a(s){return r(s,function(u,c,l){return l+1},{typedArray:Int32Array,encoder:$t.by($t.delta).and($t.runLength).and($t.integerPacking)})}e.index=a;var i=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,c,l){return this.fields.push(e.str(u,c,l)),this},s.prototype.int=function(u,c,l){return this.fields.push(e.int(u,c,l)),this},s.prototype.vec=function(u,c,l){for(var f=0;f<c.length;f++)this.fields.push(e.int("".concat(u,"[").concat(f+1,"]"),c[f],l));return this},s.prototype.float=function(u,c,l){return this.fields.push(e.float(u,c,l)),this},s.prototype.many=function(u){for(var c=0;c<u.length;c++)this.fields.push(u[c]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=i;function o(){return new i}e.build=o})(mw||(mw={}));var oo;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var a=[],i=[],o=[],s=[],u=0,c=n.split(/[\r\n]+/);u<c.length;u++){var l=c[u];if(l=l.trim(),l.length!==0){var f=/^!/.test(l);f&&(l=l.substr(1));var d=l.split(/\./),m=d[1],p=f?m?s:i:m?o:a;p[p.length]=l,m&&!a.includes(d[0])&&(a[a.length]=d[0])}}var v=o.map(function(h){return h.split(".")[0]});return{includeCategory:function(h){return i.includes(h)?!1:a.length<=0||a.indexOf(h)!==-1},includeField:function(h,g){var y=h+"."+g;return s.includes(y)?!1:!v.includes(h)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,a){return!0}},e.DefaultFormatter={getFormat:function(n,a){}};function r(n,a){return a?{fields:qO(n._schema),source:[{data:n,rowCount:a.length,keys:function(){return r1.Array(a)}}]}:{fields:qO(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(oo||(oo={}));var pw;(function(e){function t(n,a,i){n.startDataBlock(a);for(var o=function(l){n.writeCategory({name:l,instance:function(){return oo.ofTable(i[l])}})},s=0,u=i._tableNames;s<u.length;s++){var c=u[s];o(c)}}e.writeDatabase=t;function r(n,a){for(var i=0,o=Object.keys(a);i<o.length;i++){var s=o[i];t(n,s,a[s])}}e.writeDatabaseCollection=r})(pw||(pw={}));function vw(e){return function(t,r){return r[e].value(t)}}function cie(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function hw(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,a){var i;return(i=a[e].schema.space).get.apply(i,Ht([a[e].value(n)],t,!1))}}function Lh(e){return function(t,r){return r[e].valueKind(t)}}function lie(e,t){var r=[],n=2,a=Lh(e);if(t.rank===1)for(var i=t.dimensions[0],o=0;o<i;o++){var s="".concat(e,"[").concat(o+1,"]");r.push({name:s,type:n,value:hw(e,o),valueKind:a})}else if(t.rank===2)for(var i=t.dimensions[0],u=t.dimensions[1],o=0;o<i;o++)for(var c=0;c<u;c++){var l="".concat(e,"[").concat(o+1,"][").concat(c+1,"]");r.push({name:l,type:n,value:hw(e,o,c),valueKind:a})}else if(t.rank===3)for(var f=t.dimensions[0],d=t.dimensions[1],m=t.dimensions[2],o=0;o<f;o++)for(var c=0;c<d;c++)for(var p=0;p<m;p++){var v="".concat(e,"[").concat(o+1,"][").concat(c+1,"][").concat(p+1,"]");r.push({name:v,type:n,value:hw(e,o,c,p),valueKind:a})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function qO(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var a=n[r],i=e[a];if(i.valueType==="int")t.push({name:a,type:1,value:vw(a),valueKind:Lh(a)});else if(i.valueType==="float")t.push({name:a,type:2,value:vw(a),valueKind:Lh(a)});else if(i.valueType==="str")t.push({name:a,type:0,value:vw(a),valueKind:Lh(a)});else if(i.valueType==="list")t.push({name:a,type:0,value:cie(a),valueKind:Lh(a)});else if(i.valueType==="tensor")t.push.apply(t,lie(a,i.space));else throw new Error("Unknown valueType ".concat(i.valueType))}return t}function fie(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount!="undefined"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function gw(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function jO(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var a=n.reduce(function(o,s){return o+s.rowCount},0),i=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():r1.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:a,source:i}}var die=function(){function e(){this.builder=mr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=oo.DefaultFilter,this.formatter=oo.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||oo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||oo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,mr.write(this.builder,"data_".concat((t||"").replace(/[ \n\t]/g,"").toUpperCase(),`
#
`))},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n==null?void 0:n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=jO(t,r),i=a.instance,o=a.rowCount,s=a.source;!o||(o===1?mie(t,i,s,this.builder,this.filter,this.formatter):pie(t,i,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=mr.getChunks(this.builder),n=0,a=r.length;n<a;n++)t.writeString(r[n])},e.prototype.getSize=function(){return mr.getSize(this.builder)},e.prototype.getData=function(){return mr.getString(this.builder)},e}();function WO(e,t,r,n,a,i){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?yie(e):bie(e);else{var u=n.value(r,t,i),c=n.type;if(c===0)return vie(u)?(F1(e,u),!0):xie(e,u);c===1?hie(e,u):gie(e,u,a)}return!1}function XO(e,t,r){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=r.getFormat(e,o.name);s&&typeof s.digitCount!="undefined"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,fie(o)):0}return n}function mie(e,t,r,n,a,i){var o=gw(t),s=r[0],u=s.data,c=o.reduce(function(h,g){return a.includeField(e.name,g.name)?Math.max(h,g.name.length):0},0);if(c!==0){c+=e.name.length+6;for(var l=s.keys(),f=l.move(),d=XO(e.name,t.fields,i),m=0;m<o.length;m++){var p=o[m];if(!!a.includeField(e.name,p.name)){mr.writePadRight(n,"_".concat(e.name,".").concat(p.name),c);var v=WO(n,u,f,p,d[m],0);v||mr.newline(n)}}mr.write(n,`#
`)}}function pie(e,t,r,n,a,i){var o=gw(t),s=a===oo.DefaultFilter?o:o.filter(function(b){return a.includeField(e.name,b.name)}),u=s.length;if(u!==0){var c=XO(e.name,s,i);YO(n,"loop_");for(var l=0;l<u;l++)YO(n,"_".concat(e.name,".").concat(s[l].name));for(var f=0,d=0;d<r.length;d++){var m=r[d],p=m.data;if(m.rowCount!==0)for(var v=m.keys();v.hasNext;){for(var h=v.move(),g=!1,y=0;y<u;y++)g=WO(n,p,h,s[y],c[y],f);g||mr.newline(n),f++}}mr.write(n,`#
`)}}function vie(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function YO(e,t){mr.write(e,t),mr.newline(e)}function hie(e,t){mr.writeInteger(e,t),mr.whitespace1(e)}function gie(e,t,r){mr.writeFloat(e,t,r),mr.whitespace1(e)}function yie(e){mr.writeSafe(e,". ")}function bie(e){mr.writeSafe(e,"? ")}function xie(e,t){if(!t)return mr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,a=0,i=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var c=t.charCodeAt(s);switch(c){case 9:n=!0;break;case 10:return F1(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(i)return F1(e,t),!0;o=!0,n=!0,a=0;break;case 39:if(s&&s===u)break;if(o)return F1(e,t),!0;i=!0,n=!0,a=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(mr.writeSafe(e,a?'"':"'"),mr.writeSafe(e,t),mr.writeSafe(e,a?'" ':"' ")):(mr.writeSafe(e,t),mr.writeSafe(e," ")),!1}function F1(e,t){mr.writeSafe(e,`
;`+t),mr.writeSafe(e,`
;
`)}function Sie(e){var t=new ArrayBuffer(O1(e)),r=new DataView(t),n=new Uint8Array(t);return k1(e,r,n,0),n}function O1(e){var t=typeof e;if(t==="string"){var r=Ay(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var a,i=0;if(Array.isArray(e)){a=e.length;for(var o=0;o<a;o++)i+=O1(e[o])}else{var s=Object.keys(e);a=s.length;for(var o=0;o<a;o++){var u=s[o];i+=O1(u)+O1(e[u])}}if(a<16)return 1+i;if(a<65536)return 3+i;if(a<4294967296)return 5+i;throw new Error("Array or object too long 0x"+a.toString(16))}throw new Error("Unknown type "+t)}function k1(e,t,r,n){var a=typeof e;if(a==="string"){var i=Ay(e);if(i<32)return t.setUint8(n,i|160),km(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),km(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),km(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),km(r,n+5,e),5+i}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(a==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(a==="boolean")return t.setUint8(n,e?195:194),1;if(a==="object"){var u,c=0,l=Array.isArray(e),f=void 0;if(l?u=e.length:(f=Object.keys(e),u=f.length),u<16?(t.setUint8(n,u|(l?144:128)),c=1):u<65536?(t.setUint8(n,l?220:222),t.setUint16(n+1,u),c=3):u<4294967296&&(t.setUint8(n,l?221:223),t.setUint32(n+1,u),c=5),l)for(var d=0;d<u;d++)c+=k1(e[d],t,r,n+c);else for(var d=0,m=f.length;d<m;d++){var p=f[d];c+=k1(p,t,r,n+c),c+=k1(e[p],t,r,n+c)}return c}throw new Error("Unknown type "+a)}var Cie=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=oo.DefaultFilter,this.formatter=oo.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:eK,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||oo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||oo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n==null?void 0:n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var a=jO(t,r),i=a.instance,o=a.rowCount,s=a.source;if(!!o){for(var u={name:"_"+t.name,columns:[],rowCount:o},c=gw(i),l=0,f=c;l<f.length;l++){var d=f[l];if(!!this.filter.includeField(t.name,d.name)){var m=this.formatter.getFormat(t.name,d.name);u.columns.push(Pie(t.name,d,s,o,m,this.binaryEncodingProvider,this.autoClassify))}}!u.columns.length||this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=Sie(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function _ie(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function wie(e){return e===0?hl.by($t.stringArray):hl.by($t.byteArray)}function Aie(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function Tie(e,t){return e===0?hl.by($t.stringArray):e===1?J3(t):iK(t)}function Pie(e,t,r,n,a,i,o){var s=Eie(t,_ie(t,a),n,r),u=s.array,c=s.allPresent,l=s.mask,f=Aie(e,t,a,i);f||(o?f=Tie(t.type,u):f=wie(t.type));var d=f.encode(u),m=void 0;if(!c){var p=hl.by($t.runLength).and($t.byteArray).encode(l);p.data.length<l.length?m=p:m=hl.by($t.byteArray).encode(l)}return{name:t.name,data:d,mask:m}}function Eie(e,t,r,n){for(var a=e.type===0,i=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,c=!0,l=0,f=0;f<n.length;f++)for(var d=n[f].data,m=n[f].keys();m.hasNext;){var p=m.move(),v=s?s(p,d):0;if(v!==0)o[l]=v,a&&(i[l]=""),c=!1;else{var h=u(p,d,l);typeof h=="string"&&!h?(o[l]=1,c=!1):o[l]=0,i[l]=h}l++}return{array:i,allPresent:c,mask:o}}var Zn;(function(e){e.Encoder=pw,e.Category=oo,e.Field=mw,e.Encoding=$t;function t(u){var c=u||{},l=c.binary,f=l===void 0?!1:l,d=c.encoderName,m=d===void 0?"mol*":d;return f?new Cie(m,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new die}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function a(u,c){return{fields:u,source:[c]}}e.categoryInstance=a;function i(u){return{get:function(c,l){var f=u.categories[c];if(!!f){var d=f.getField(l);return d&&d.binaryEncoding?hl.fromEncoding(d.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=i;function o(u){return{get:function(c,l){for(var f=0;f<u.length;f++){var d=u[f];if(d.categoryName===c&&d.columnName===l)return s(d)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var c=u.precision;if(c!==void 0){var l=Math.pow(10,c),f=n.by(n.fixedPoint(l));switch(u.encoding){case"pack":return f.and(n.integerPacking);case"rle":return f.and(n.runLength).and(n.integerPacking);case"delta":return f.and(n.delta).and(n.integerPacking);case"delta-rle":return f.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(Zn||(Zn={}));var Nh;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(a){var i=e.Provider.get(a.firstModel);if(!i)return Zn.Category.Empty;var o=i.data;if(!o)return Zn.Category.Empty;for(var s=a.structures[0].uniqueResidueNames,u=o.comp_id,c=o._rowCount,l=[],f=0;f<c;f++)s.has(u.value(f))&&(l[l.length]=f);return Zn.Category.ofTable(o,l)}}]}},e.Provider=_s.create(e.Descriptor);function t(a,i){return Ar.pick(i,Jt.chem_comp_bond,function(o){return a.properties.chemicalComponentMap.has(i.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(a){var i=new Map;function o(_){if(i.has(_))return i.get(_);var w=new n(_);return i.set(_,w),w}for(var s=a.comp_id,u=a.atom_id_1,c=a.atom_id_2,l=a.value_order,f=a.pdbx_aromatic_flag,d=a._rowCount,m=o(s.value(0)),p=0;p<d;p++){var v=s.value(p),h=u.value(p),g=c.value(p),y=l.value(p),b=f.value(p)==="Y";m.id!==v&&(m=o(v));var x=1,C=1;switch(b&&(x|=16),y.toLowerCase()){case"doub":case"delo":C=2;break;case"trip":C=3;break;case"quad":C=4;break}m.add(h,g,C,x)}return i}e.getEntriesFromChemCompBond=r;var n=function(){function a(i){this.id=i,this.map=new Map}return a.prototype.add=function(i,o,s,u,c){c===void 0&&(c=!0);var l=this.map.get(i);if(l!==void 0){var f=l.get(o);f===void 0&&l.set(o,{order:s,flags:u})}else{var d=new Map;d.set(o,{order:s,flags:u}),this.map.set(i,d)}c&&this.add(o,i,s,u,!1)},a}();e.Entry=n})(Nh||(Nh={}));var uu;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(i){var o=e.Provider.get(i.firstModel);if(!o||o.entries.length===0)return Zn.Category.Empty;for(var s=i.structures[0],u=[],c=0,l=o.entries;c<l.length;c++){var f=l[c];r(s,f.partnerA.atomIndex)&&r(s,f.partnerB.atomIndex)&&(u[u.length]=f.rowIndex)}return Zn.Category.ofTable(o.data,u)}}]}},e.Provider=_s.create(e.Descriptor);function t(i){var o=e.Provider.get(i);return!!o&&o.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(i,o){for(var s=i.units,u=0,c=s.length;u<c;u++)if(Le.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(i){for(var o=new Map,s=0,u=i;s<u.length;s++){var c=u[s],l=c.partnerA.atomIndex,f=c.partnerB.atomIndex;o.has(l)?o.get(l).push(c):o.set(l,[c]),o.has(f)?o.get(f).push(c):o.set(f,[c])}return o}e.getAtomIndexFromEntries=n;function a(i,o){for(var s=i.conn_type_id,u=i.pdbx_dist_value,c=i.pdbx_value_order,l={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},f={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},d=function(C,_){if(_.label_asym_id.valueKind(C)===0){var w=_.label_asym_id.value(C),T=o.atomicHierarchy.index.findEntity(w);if(!(T<0)){var A=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(T),w,_.auth_seq_id.value(C),_.ins_code.value(C));if(!(A<0)){var D=_.label_atom_id.value(C);if(!!D){var E=o.atomicHierarchy.index.findAtomOnResidue(A,D,_.label_alt_id.value(C));if(!(E<0))return{residueIndex:A,atomIndex:E,symmetry:_.symmetry.value(C)}}}}}},m=[],p=0;p<i._rowCount;p++){var v=d(p,l),h=d(p,f);if(!(v===void 0||h===void 0)){var g=s.value(p),y=(c.value(p)||"").toLowerCase(),b=0,x=1;switch(y){case"sing":x=1;break;case"doub":x=2;break;case"trip":x=3;break;case"quad":x=4;break;default:x=HO(i.ptnr1_label_comp_id.value(p),i.ptnr1_label_atom_id.value(p),i.ptnr2_label_comp_id.value(p),i.ptnr2_label_atom_id.value(p))}switch(g){case"covale":b=1;break;case"disulf":b=1|8;break;case"hydrog":b=4;break;case"metalc":b=2;break}m.push({rowIndex:p,flags:b,order:x,distance:u.value(p),partnerA:v,partnerB:h})}}return m}e.getEntriesFromStructConn=a})(uu||(uu={}));function KO(e,t,r,n,a,i){for(var o=new Ni.EdgeBuilder(a,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),c=0,l=o.edgeCount;c<l;c++)o.addNextEdge(),o.assignProperty(s,n[c]),o.assignProperty(u,r[c]);return o.createGraph({flags:s,order:u},{canRemap:i})}var QO=S(),ZO=S();function Iie(e,t,r){return e.conformation.position(t,QO),e.conformation.position(r,ZO),S.distance(QO,ZO)}var Die=new Set;function Mie(e){for(var t=La.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,a=e.elements.length,i=t.maxDistance,o=t.bonds,s=o.offset,u=o.b,c=o.edgeProps,l=c.order,f=c.distance,d=c.flag,m=e.model.atomicHierarchy.atomSourceIndex,p=jt.getInvertedAtomSourceIndex(e.model).invertedIndex,v=[],h=[],g=[],y=[],b=0;b<a;b++)for(var x=r[b],C=su(n.value(x)),_=lc(C),w=m.value(x),T=s[w],A=s[w+1];T<A;++T){var D=p[u[T]];if(!(x>=D)){var E=Le.indexOf(e.elements,D);if(!(E<0)){var M=su(n.value(D)),F=f[T],O=Iie(e,x,D),U=!1;if(F>=0)U=qr(O,F,.3);else if(i>=0)U=O<i;else{var N=B1(C,M,Rl(C),Rl(M));U=O<N,_&&lc(M)&&(U=!1)}U&&(v[v.length]=b,h[h.length]=E,y[y.length]=l[T],g[g.length]=d[T])}}}return KO(v,h,y,g,a,!1)}function Rie(e,t){for(var r=t.maxRadius,n=e.model.atomicConformation,a=n.x,i=n.y,o=n.z,s=e.elements.length,u=e.elements,c=e.residueIndex,l=e.chainIndex,f=e.model.atomicHierarchy.atoms,d=f.type_symbol,m=f.label_atom_id,p=f.label_alt_id,v=f.label_comp_id,h=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,x=uu.Provider.get(e.model),C=Nh.Provider.get(e.model),_=uu.isExhaustive(e.model),w=[],T=[],A=[],D=[],E=-1,M=void 0,F=!0,O=!0,U=!0,N=Die,q=0;q<s;q++){var j=u[q],Q=d.value(j);F&&(Q!=="H"||Q!=="O")&&(F=!1);var J=t.forceCompute?void 0:x&&x.byAtomIndex.get(j),te=!1;if(J)for(var K=0,L=J;K<L.length;K++){var W=L[K],k=W.partnerA,V=W.partnerB;if(k.symmetry===V.symmetry){var G=k.atomIndex===j?V:k,H=Le.indexOf(e.elements,G.atomIndex);H<0||u[H]<j||(w[w.length]=q,T[T.length]=H,A[A.length]=W.flags,D[D.length]=W.order,te||N.clear(),te=!0,N.add(H))}}if(!_){var X=c[j],Y=h.value(X),oe=v.value(j);if(!t.forceCompute&&X!==E)if(!!C&&C.entries.has(oe)){var ue=y[g.getEntityFromChain(l[j])];ue&&ue.sequence.microHet.has(Y)?M=void 0:M=C.entries.get(oe).map}else M=void 0;E=X;for(var me=su(Q),he=m.value(j),Pe=M?M.get(he):void 0,re=b.find(a[j],i[j],o[j],r),ee=re.indices,B=re.count,z=re.squaredDistances,le=lc(me),pe=Rl(me),ge=p.value(j),Ce=kh.has(me),Ie=0;Ie<B;Ie++){var H=ee[Ie];if(!(te&&N.has(H))){var Oe=u[H];if(!(Oe<=j)){var We=p.value(Oe);if(!(ge&&We&&ge!==We)){var Ne=su(d.value(Oe)),Ye=lc(Ne);if(!(le&&Ye)){var Xe=(Ce||kh.has(Ne))&&!(le||Ye),Ze=c[Oe];if(X===Ze&&Pe){var Ke=Pe.get(m.value(Oe));if(Ke){w[w.length]=q,T[T.length]=H,D[D.length]=Ke.order;var ht=Ke.flags;Xe&&(ht|1&&(ht^=1),ht|=2),A[A.length]=ht}continue}var Ae=Math.sqrt(z[Ie]);if(Ae!==0){var we=B1(me,Ne,pe,Rl(Ne));if(Ae<=we){w[w.length]=q,T[T.length]=H,D[D.length]=sie(oe,he,m.value(Oe)),A[A.length]=(Xe?2:1)|32;var Ve=h.value(Ze);Y===Ve&&(O=!1),Math.abs(Y-Ve)>1&&(U=!1)}}}}}}}}}var rt=F||O&&U;return KO(w,T,D,A,s,rt)}function Bie(e,t){var r=I(I({},VO),t);return r.noCompute||jt.isCoarseGrained(e.model)?fw.Empty:!r.forceCompute&&La.Provider.get(e.model)?Mie(e):Rie(e,r)}var $O=S(),JO=S();function e6(e,t,r,n){return e.conformation.position(t,$O),r.conformation.position(n,JO),S.distance($O,JO)}var Fie=se(),id=S();function Oie(e,t,r,n){var a=r.maxRadius,i=e.elements,o=e.residueIndex,s=e.model.atomicConformation,u=s.x,c=s.y,l=s.z,f=t.elements,d=t.residueIndex,m=e.elements.length,p=e.model.atomicHierarchy.atoms,v=p.type_symbol,h=p.label_alt_id,g=p.label_atom_id,y=p.label_comp_id,b=t.model.atomicHierarchy.atoms,x=b.type_symbol,C=b.label_alt_id,_=b.label_atom_id,w=b.label_comp_id,T=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,D=e.model.atomicConformation.occupancy,E=t.model.atomicConformation.occupancy,M=D.isDefined&&E.isDefined,F=e.model===t.model&&uu.Provider.get(e.model),O=!r.forceCompute&&e.model===t.model&&La.Provider.get(e.model),U=e.model.atomicHierarchy.atomSourceIndex,N=(O?jt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,q=e.model===t.model&&uu.isExhaustive(e.model),j=se.mul(Fie,t.conformation.operator.inverse,e.conformation.operator.matrix),Q=!se.isIdentity(j),J=t.boundary.sphere,te=J.center,K=J.radius,L=(K+a)*(K+a);n.startUnitPair(e.id,t.id);for(var W=0;W<m;W++){var k=i[W];if(S.set(id,u[k],c[k],l[k]),Q&&S.transformMat4(id,id,j),!(S.squaredDistance(id,te)>L)){if(!r.forceCompute&&O){for(var V=O.maxDistance,G=O.bonds,H=G.offset,X=G.b,Y=G.edgeProps,oe=Y.order,ue=Y.distance,me=Y.flag,he=U.value(k),Pe=H[he],re=H[he+1];Pe<re;++Pe){var ee=N[X[Pe]],B=Le.indexOf(t.elements,ee);if(!(B<0)){var z=su(v.value(k)),le=su(v.value(ee)),pe=ue[Pe],ge=e6(e,k,t,ee),Ce=!1;if(pe>=0)Ce=qr(ge,pe,.3);else if(V>=0)Ce=ge<V;else{var Ie=B1(z,le,Rl(z),Rl(le));Ce=ge<Ie,lc(z)&&lc(le)&&(Ce=!1)}Ce&&n.add(W,B,{order:oe[Pe],flag:me[Pe]})}}continue}var Oe=r.forceCompute?void 0:F&&F.byAtomIndex.get(k);if(Oe&&Oe.length){for(var We=!1,Ne=0,Ye=Oe;Ne<Ye.length;Ne++){var Xe=Ye[Ne],Ze=Xe.partnerA,Ke=Xe.partnerB,ht=Ze.atomIndex===k?Ke:Ze,B=Le.indexOf(t.elements,ht.atomIndex);B<0||e6(e,k,t,ht.atomIndex)>a||(n.add(W,B,{order:Xe.order,flag:Xe.flags}),We=!0)}if(We)continue}if(!q){var Ae=D.value(k),we=t.lookup3d,Ve=we.find(id[0],id[1],id[2],a),rt=Ve.indices,ut=Ve.count,Ue=Ve.squaredDistances;if(ut!==0)for(var pt=su(v.value(k)),mt=lc(pt),wt=Rl(pt),Z=h.value(k),de=kh.has(pt),ye=g.value(k),He=y.value(o[k]),ot=0;ot<ut;ot++){var B=rt[ot],ee=f[B],ct=C.value(ee);if(!(Z&&ct&&Z!==ct)&&!(M&&E.value(ee)<1&&Ae<1&&T.value(k)===A.value(ee))){var le=su(x.value(ee)),Ct=lc(le);if(!(mt&&Ct)){var vr=(de||kh.has(le))&&!(mt||Ct),ge=Math.sqrt(Ue[ot]);if(ge!==0){var Ie=B1(pt,le,wt,Rl(le));if(ge<=Ie){var Rr=_.value(ee),Ur=w.value(d[ee]);n.add(W,B,{order:HO(He,Ur,ye,Rr),flag:(vr?2:1)|32})}}}}}}}}n.finishUnitPair()}var kie=I(I({},VO),{ignoreWater:!0});function Lie(e,t){var r=new ad.Builder,n=e.models.some(function(a){return La.Provider.get(a)});return t.noCompute||e.isCoarseGrained&&!n?new R1(r.getMap()):(ke.eachUnitPair(e,function(a,i){Oie(a,i,t,r)},{maxRadius:t.maxRadius,validUnit:function(a){return Re.isAtomic(a)},validUnitPair:function(a,i){return t.validUnitPair(e,a,i)}}),new R1(r.getMap()))}function Nie(e,t){var r=I(I({},kie),t);return Lie(e,I(I({},r),{validUnitPair:t&&t.validUnitPair||function(n,a,i){var o=a.model.atomicHierarchy.derived.residue.moleculeType,s=i.model.atomicHierarchy.derived.residue.moleculeType,u=(!Re.isAtomic(a)||o[a.residueIndex[a.elements[0]]]!==2)&&(!Re.isAtomic(i)||s[i.residueIndex[i.elements[0]]]!==2);return ke.validUnitPair(n,a,i)&&(u||!r.ignoreWater)}}))}var Pt;(function(e){function t(h,g,y,b,x,C){return{kind:"bond-location",aStructure:h,aUnit:g,aIndex:y,bStructure:b,bUnit:x,bIndex:C}}e.Location=t;function r(h){return!!h&&h.kind==="bond-location"}e.isLocation=r;function n(h,g){return h.aStructure.label===g.aStructure.label&&h.bStructure.label===g.bStructure.label&&h.aIndex===g.aIndex&&h.bIndex===g.bIndex&&h.aUnit.id===g.aUnit.id&&h.bUnit.id===g.bUnit.id}e.areLocationsEqual=n;function a(h,g){return{kind:"bond-loci",structure:h,bonds:g}}e.Loci=a;function i(h){return!!h&&h.kind==="bond-loci"}e.isLoci=i;function o(h,g){if(h.structure!==g.structure||h.bonds.length!==g.bonds.length)return!1;for(var y=0,b=h.bonds.length;y<b;++y)if(!n(h.bonds[y],g.bonds[y]))return!1;return!0}e.areLociEqual=o;function s(h){return h.bonds.length===0}e.isLociEmpty=s;function u(h,g){if(g===h.structure)return h;var y=[];return h.bonds.forEach(function(b){var x=g.unitMap.get(b.aUnit.id);if(!!x){var C=g.unitMap.get(b.bUnit.id);if(!!C){var _=b.aUnit.elements[b.aIndex],w=Le.indexOf(x.elements,_);if(w!==-1){var T=b.bUnit.elements[b.bIndex],A=Le.indexOf(C.elements,T);A!==-1&&y.push(t(h.structure,x,w,h.structure,C,A))}}}}),a(g,y)}e.remapLoci=u;function c(h){for(var g=[],y=new Map,b=0,x=h.bonds;b<x.length;b++){var C=x[b],_=C.aIndex,w=C.aUnit,T=C.bIndex,A=C.bUnit;w===A?y.has(w.id)?y.get(w.id).push(_,T):y.set(w.id,[_,T]):(y.has(w.id)?y.get(w.id).push(_):y.set(w.id,[_]),y.has(A.id)?y.get(A.id).push(T):y.set(A.id,[T]))}return y.forEach(function(D,E){g.push({unit:h.structure.unitMap.get(E),indices:Le.deduplicate(Le.ofUnsortedArray(D))})}),_e(h.structure,g)}e.toStructureElementLoci=c;function l(h){var g=h.bonds[0],y=g.aUnit,b=g.aIndex;return _e(h.structure,[{unit:y,indices:De.ofSingleton(b)}])}e.toFirstStructureElementLoci=l;function f(h,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return b<0?ar.create(0):ar.create(y.edgeProps.flags[b])}else{var x=h.interUnitBonds.getBondFromLocation(g);return x?ar.create(x.props.flag):ar.create(0)}}e.getType=f;function d(h,g){if(g.aUnit===g.bUnit){var y=g.aUnit.bonds,b=y.getEdgeIndex(g.aIndex,g.bIndex);return b<0?0:y.edgeProps.order[b]}else{var x=h.interUnitBonds.getBondFromLocation(g);return x?x.props.order:0}}e.getOrder=d;function m(h){for(var g=0,y=0,b=h.units.length;y<b;++y){var x=h.units[y];Re.isAtomic(x)&&(g+=x.bonds.edgeCount)}return g}e.getIntraUnitBondCount=m;var p=function(){function h(){this.current={},this.hasNext=!1}return h.prototype.move=function(){return this.advance(),this.current},h.prototype.setElement=function(g,y,b){this.structure=g,this.unit=y,this.index=b,this.interBondIndices=g.interUnitBonds.getEdgeIndices(b,y.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=y.bonds.offset[b+1],this.intraBondIndex=y.bonds.offset[b],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h}();e.ElementBondIterator=p;function v(h,g){return Xf.fromPairProvider(h.bonds.length,function(y,b,x){var C=h.bonds[y],_=C.aUnit,w=C.aIndex,T=C.bUnit,A=C.bIndex;_.conformation.position(_.elements[w],b),T.conformation.position(T.elements[A],x)},g)}e.getBoundingSphere=v})(Pt||(Pt={}));function Uie(e){for(var t=Vie(e),r=zie(e,t),n=qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var a=n.move();Gie(r,a.start,a.end)}return r.rings}function zie(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function t6(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,a=0;a<e.count;a++)t[a]=-1,r[a]=-1,n[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function Vie(e){for(var t=qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function Gie(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var a=e.unit.elements,i=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(a[o]);gn(i,s)}if(Ff(i,""),i.length===0){t6(e);for(var o=0;o<e.count;o++)n[o]>=0||r6(e,o)}else for(var u=0;u<i.length;u++){t6(e),e.hasAltLoc=!0,e.currentAltLoc=i[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(a[e.startVertex+o]);s&&s!==e.currentAltLoc||r6(e,o)}}for(var o=0,c=e.currentRings.length;o<c;o++)e.rings.push(e.currentRings[o])}}function Hie(e,t,r){if(!(r<t)){for(var n=e.pred,a=e.color,i=e.left,o=e.right,s=++e.currentColor,u=t,c=0;c<4&&(a[u]=s,u=n[u],!(u<0));c++);var l=0,f=0,d=!1,m=0;u=r;for(var c=0;c<4;c++){if(a[u]===s){m=u,d=!0;break}if(o[f++]=u,u=n[u],u<0)break}if(!!d){u=t;for(var c=0;c<4&&(i[l++]=u,!(m===u||(u=n[u],u<0)));c++);var p=l+f;if(!(p<3)){for(var v=new Int32Array(p),h=0,c=0;c<l;c++)v[h++]=e.startVertex+i[c];for(var c=f-1;c>=0;c--)v[h++]=e.startVertex+o[c];if(vs(v),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(v[0]===b[0]&&v.length===b.length){for(var x=!0,C=0,_=v.length;C<_;C++)if(v[C]!==b[C]){x=!1;break}if(x)return}}e.currentRings.push(Le.ofSortedArray(v))}}}}function r6(e,t){var r=e.bonds,n=e.startVertex,a=e.endVertex,i=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,c=r.b,l=r.edgeProps.flags,f=r.offset;i[t]=1,o[0]=t;for(var d=0,m=1;d<m;)for(var p=o[d++],v=n+p,h=f[v],g=f[v+1],y=h;y<g;y++){var b=c[y];if(!(b<n||b>=a||!ar.isCovalent(l[y]))){if(e.hasAltLoc){var x=e.altLoc.value(u[b]);if(x&&e.currentAltLoc!==x)continue}var C=b-n;if(i[C]>0){s[C]!==p&&s[p]!==C&&Hie(e,p,C);continue}i[C]=1,o[m++]=C,s[C]=p}}}function qie(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var a=n6(e),i=n6(r),o=!1,n=0;n<t;n++){var s=e[(n+a)%t],u=r[(n+i)%t];if(s!==u){o=s<u;break}}return o?a6(e,a):a6(r,i)}function n6(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var a="",i="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(a=e[s%t],i=e[(o+n+1)%t],a!==i);)a<i&&(o=s-n-1),n=r[n];n===-1?(a=e[s%t],i=e[(o+n+1)%t],a!==i?(a<i&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function a6(e,t){var r=e.length,n=[],a;for(a=0;a<r-1;a++)n.push(e[(a+t)%r]),n.push("-");return n.push(e[(a+t)%r]),n.join("")}function jie(e,t){for(var r=new Map,n=new Map,a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var c=o[s];r.has(c)?r.get(c).push(a):r.set(c,[a])}for(var l=0,f=t.length;l<f;l++)for(var a=t[l],o=e[a],s=0,u=o.length;s<u;s++){var c=o[s];n.has(c)?n.get(c).push(a):n.set(c,[a])}for(var d=new Ni.UniqueEdgeBuilder(e.length),a=0,i=e.length;a<i;a++)for(var o=e[a],s=0,u=o.length;s<u;s++){var c=o[s],m=r.get(c);if(m.length!==1)for(var p=0,v=m.length;p<v;p++){var h=m[p];a>=h||d.addEdge(a,h)}}for(var g=Ni.connectedComponents(d.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var a=0,i=e.length;a<i;a++)b[y[a]].push(a);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}function Wie(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,a=e.coarseElements.seq_id_begin.value(t);return n.compId.value(a-1)}function yw(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=Wie(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return ip(n.type,r)}return 0}var Xie=new Set;function Bl(e,t){var r=aae[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return Xie}var i6=S.zero();function o6(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),a=e.elements,i=0,o=t.length;i<o;++i)r(a[t[i]],i6),S.toArray(i6,n,i*3);return n}var L1=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=jie(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=Yie(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=Zie(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),No;(function(e){function t(s,u){for(var c=s.elements,l=s.model.atomicHierarchy.atoms.type_symbol,f=[],d=0,m=u.length;d<m;d++)f[f.length]=l.value(c[u[d]]);return r(f)}e.fingerprint=t;function r(s){return qie(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),a=.05;function i(s,u){var c=s.elements,l=s.bonds,f=l.b,d=l.offset,m=l.edgeProps.flags,p=s.model.atomicHierarchy.atoms,v=p.type_symbol,h=p.label_comp_id;if(h.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,x=u.length;b<x;++b){var C=u[b];!y&&n.has(v.value(c[C]))&&(y=!0);for(var _=d[C],w=d[C+1];_<w;++_)ar.is(16,m[_])&&Le.has(u,f[_])&&(g+=1)}if(g===2*u.length)return!0;if(!y||u.length<5)return!1;var T=_l.calculateMomentsAxes(o6(s,u));return S.magnitude(T.dirC)<a}e.isAromatic=i;function o(s,u){for(var c=s.model.atomicHierarchy.atoms.label_alt_id,l=s.elements,f=0,d=u.length;f<d;++f){var m=l[u[f]],p=c.value(m);if(p)return p}return""}e.getAltId=o})(No||(No={}));(function(e){function t(n){var a=Uie(n);return new e(a,n)}e.create=t;function r(n,a){for(var i=new Map,o=0,s=a.length;o<s;o++){var u=a[o];Qie(n,u,i)}return i}e.byFingerprintAndResidue=r})(L1||(L1={}));function Yie(e,t){for(var r=new Map,n=0,a=0,i=t.length;a<i;a++){var o=t[a],s=No.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function Kie(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,a=n[r[t[0]]],i=1,o=t.length;i<o;i++)if(a!==n[r[t[i]]])return-1;return a}function Qie(e,t,r){var n=e.byFingerprint.get(t);if(!!n)for(var a=0,i=n.length;a<i;a++){var o=n[a],s=Kie(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function Zie(e,t){for(var r=[],n=0,a=t.length;n<a;++n)No.isAromatic(e,t[n])&&r.push(n);return r}var Tr;(function(e){function t(x){return Le.ofSortedArray(x)}e.ofSortedRanges=t;function r(x){return x[0]}e.start=r;function n(x){return x[x.length-1]+1}e.end=n;function a(x){return x[0]}e.min=a;function i(x){return x[x.length-1]}e.max=i;function o(x){for(var C=0,_=0,w=x.length;_<w;_+=2)C+=x[_+1]-x[_]+1;return C}e.size=o;function s(x){return x.length/2}e.count=s;function u(x,C){return x[C*2]}e.startAt=u;function c(x,C){return x[C*2+1]+1}e.endAt=c;function l(x,C){return x[C*2]}e.minAt=l;function f(x,C){return x[C*2+1]}e.maxAt=f;function d(x,C){if(x.length!==C.length)return!1;for(var _=0,w=x.length;_<w;++_)if(x[_]!==C[_])return!1;return!0}e.areEqual=d;function m(x,C){for(var _=0,w=0,T=x.length;w<T;w+=2)for(var A=x[w],D=x[w+1];A<=D;++A)C(A,_),++_}e.forEach=m;function p(x,C){return h(x,C)!==-1}e.has=p;function v(x,C,_){return g(x,C,_)!==-1}e.hasFrom=v;function h(x,C){return g(x,C,0)}e.firstIntersectionIndex=h;function g(x,C,_){if(l(x,_)>De.max(C)||i(x)<De.min(C))return-1;for(var w=_,T=s(x);w<T;++w){var A=Se.ofRange(l(x,w),f(x,w));if(De.areIntersecting(A,C))return w}return-1}e.firstIntersectionIndexFrom=g;function y(x,C){return new b(x,C)}e.transientSegments=y;var b=function(){function x(C,_){this.ranges=C,this.set=_,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=h(C,_),this.hasNext=this.curIndex!==-1}return x.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=De.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=De.findPredecessorIndex(this.set,c(this.ranges,this.curIndex))},x.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},x}();e.Iterator=b})(Tr||(Tr={}));function $ie(e){for(var t=[],r=e.elements,n=e.model,a=e.model.atomicHierarchy.residueAtomSegments,i=n.atomicHierarchy.derived.residue.traceElementIndex,o=Tr.transientSegments(e.model.atomicRanges.polymerRanges,r),s=qt.transientSegments(a,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var c=s.move(),l=c.start,f=c.end,d=c.index;if(De.areIntersecting(Se.ofRange(r[l],r[f-1]),r)){var m=i[d];t.push(m===-1?a.offsets[d]:m)}}}return Le.ofSortedArray(t)}function Jie(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Re.isSpheres(e)?i.polymerRanges:o.polymerRanges,u=Tr.transientSegments(s,r);u.hasNext;)for(var c=u.move(),l=c.start,f=c.end,d=l;d<f;++d)t.push(r[d]);return Le.ofSortedArray(t)}function eoe(e){for(var t=[],r=e.elements,n=e.model,a=e.residueIndex,i=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=Tr.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),c=a[r[u.start]],l=a[r[u.end-1]],f=o[c],d=o[l];t.push(f===-1?i.offsets[c]:f),t.push(d===-1?i.offsets[l]:d)}return Le.ofSortedArray(t)}function toe(e){for(var t=[],r=e.elements,n=e.model,a=n.coarseHierarchy,i=a.spheres,o=a.gaussians,s=Re.isSpheres(e)?i.gapRanges:o.gapRanges,u=Tr.transientSegments(s,r);u.hasNext;){var c=u.move(),l=c.start,f=c.end;t.push(r[l],r[f-1])}return Le.ofSortedArray(t)}function roe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=qt.transientSegments(i,r),f=qt.transientSegments(o,r);l.hasNext;)for(f.setSegment(l.move());f.hasNext;){var d=f.move().index;if(iu(u[d])){var m=c[d];t.push(m===-1?o.offsets[d]:m)}}return Le.ofSortedArray(t)}function noe(e){for(var t=[],r=e.elements,n=e.model,a=n.atomicHierarchy,i=a.chainAtomSegments,o=a.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,c=s.traceElementIndex,l=qt.transientSegments(i,r),f=qt.transientSegments(o,r);l.hasNext;)for(f.setSegment(l.move());f.hasNext;){var d=f.move().index;if(TO(u[d])){var m=c[d];t.push(m===-1?o.offsets[d]:m)}}return Le.ofSortedArray(t)}var s6=S.zero();function aoe(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),a=0,i=r.length;a<i;a++)t(r[a],s6),S.toArray(s6,n,a*3);return n}function u6(e){var t=aoe(e);return _l.ofPositions(t)}var c6=S.set,ioe=new Ji("14"),ooe=new Ji("98");function soe(e){return e>1e4?ioe:ooe}var N1=S();function op(e){var t=e.x,r=e.y,n=e.z,a=e.radius,i=e.indices,o=De.size(i);if(o>25e4){var s=Bt.computeBounding(e);return{box:s,sphere:Te.fromBox3D(Te(),s)}}var u=soe(o);u.reset();for(var c=0;c<o;c++){var l=De.getAt(i,c);c6(N1,t[l],r[l],n[l]),u.includePositionRadius(N1,a&&a[l]||0)}u.finishedIncludeStep();for(var c=0;c<o;c++){var l=De.getAt(i,c);c6(N1,t[l],r[l],n[l]),u.radiusPositionRadius(N1,a&&a[l]||0)}var f=u.getSphere();if(!a&&Te.hasExtrema(f)&&o<=f.extrema.length){for(var d=[],c=0;c<o;c++){var l=De.getAt(i,c);d.push(S.create(t[l],r[l],n[l]))}Te.setExtrema(f,d)}return{box:u.getBox(),sphere:f}}var uoe=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Le.hashCode(t);if(!!this.data.has(r))for(var n=0,a=this.data.get(r);n<a.length;n++){var i=a[n],o=i[0],s=i[1];if(Le.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=Le.hashCode(t);if(this.data.has(n)){for(var a=this.data.get(n),i=0,o=a;i<o.length;i++){var s=o[i];if(Le.areEqual(t,s[0])){s[1]=r;return}}a.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),Re;(function(e){function t(U){return U.kind===0}e.isAtomic=t;function r(U){return U.kind===1||U.kind===2}e.isCoarse=r;function n(U){return U.kind===1}e.isSpheres=n;function a(U){return U.kind===2}e.isGaussians=a;function i(U,N,q,j,Q,J,te,K,L){switch(Q){case 0:return new p(U,N,q,j,J,K,jr.createMapping(te,J.atomicConformation,void 0),L!=null?L:v());case 1:return C(U,N,q,j,J,1,K,jr.createMapping(te,J.coarseConformation.spheres,d(J)),L!=null?L:y());case 2:return C(U,N,q,j,J,2,K,jr.createMapping(te,J.coarseConformation.gaussians,m()),L!=null?L:y())}}e.create=i;function o(U){for(var N=Do.Mutable(),q=0,j=U.length;q<j;q++)N.set(U[q].id,q);return N}function s(U){for(var N=[],q=0,j=U.length;q<j;q++)N.push(U[q].id);return Wa(N)}function u(U){var N={};return{elements:U[0].elements,units:U,get unitIndexMap(){return N.unitIndexMap||(N.unitIndexMap=o(U)),N.unitIndexMap},hashCode:l(U[0]),transformHash:s(U)}}e.SymmetryGroup=u,function(U){function N(j,Q){return j.hashCode!==Q.hashCode?!1:Le.areEqual(j.elements,Q.elements)}U.areInvariantElementsEqual=N;function q(j){for(var Q=Do.Mutable(),J=0,te=j.length;J<te;++J)for(var K=j[J],L=0,W=K.units.length;L<W;++L)Q.set(K.units[L].id,J);return Q}U.getUnitSymmetryGroupsIndexMap=q}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function c(U){return e.isAtomic(U)?U.model.atomicConformation.id:U.model.coarseConformation.id}e.conformationId=c;function l(U){return If(U.invariantId,Le.hashCode(U.elements))}e.hashUnit=l,function(U){U.is=Da.has,U.create=Da.create}(e.Traits||(e.Traits={}));function f(){return{}}function d(U){var N=U.coarseConformation.spheres.radius;return function(q){return N[q]}}function m(U){return function(N){return 0}}var p=function(){function U(N,q,j,Q,J,te,K,L){this.kind=0,this.objectPrimitive="atomistic",this.id=N,this.invariantId=q,this.chainGroupId=j,this.traits=Q,this.model=J,this.elements=te,this.conformation=K,this.residueIndex=J.atomicHierarchy.residueAtomSegments.index,this.chainIndex=J.atomicHierarchy.chainAtomSegments.index,this.props=L}return U.prototype.getChild=function(N){return N.length===this.elements.length?this:new U(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,N,this.conformation,v())},U.prototype.applyOperator=function(N,q,j){j===void 0&&(j=!1);var Q=j?q:jr.compose(this.conformation.operator,q);return new U(N,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,jr.createMapping(Q,this.model.atomicConformation,this.conformation.r),this.props)},U.prototype.remapModel=function(N,q,j){j||(j=I(I({},this.props),{bonds:q?void 0:A(this,this.props.bonds,N)}),e.isSameConformation(this,N)||(j.boundary=void 0,j.lookup3d=void 0,j.principalAxes=void 0));var Q=this.conformation.operator,J=_n.Provider.get(N);if(Q.spgrOp!==-1&&J&&J!==_n.Provider.get(this.model)){var te=Q.hkl,K=te[0],L=te[1],W=te[2],k=J.spacegroup.cell.toFractional,V=S.transformMat4(S(),jt.getCenter(N),k);Q=Mo.getSymmetryOperatorRef(J.spacegroup,Q.spgrOp,K,L,W,V)}var G=this.model.atomicConformation!==N.atomicConformation||Q!==this.conformation.operator?jr.createMapping(Q,N.atomicConformation):this.conformation;return new U(this.id,this.invariantId,this.chainGroupId,this.traits,N,this.elements,G,j)},Object.defineProperty(U.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var N=this.model.atomicConformation,q=N.x,j=N.y,Q=N.z;return this.props.boundary=op({x:q,y:j,z:Q,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var N=this.model.atomicConformation,q=N.x,j=N.y,Q=N.z;return this.props.lookup3d=jf({x:q,y:j,z:Q,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=u6(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var N=uoe.get(this.model),q=N.get(this.elements);return q||(q=Bie(this),N.set(this.elements,q)),this.props.bonds=q,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=L1.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=$ie(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=eoe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=roe(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=noe(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var N=0,q=qt.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);q.hasNext;)q.move(),N+=1;return this.props.residueCount=N,this.props.residueCount},enumerable:!1,configurable:!0}),U.prototype.getResidueIndex=function(N){return this.residueIndex[this.elements[N]]},U}();e.Atomic=p;function v(){return f()}var h=function(){function U(N,q,j,Q,J,te,K,L,W){this.kind=te,this.objectPrimitive=te===1?"sphere":"gaussian",this.id=N,this.invariantId=q,this.chainGroupId=j,this.traits=Q,this.model=J,this.elements=K,this.conformation=L,this.coarseElements=te===1?J.coarseHierarchy.spheres:J.coarseHierarchy.gaussians,this.coarseConformation=te===1?J.coarseConformation.spheres:J.coarseConformation.gaussians,this.props=W}return U.prototype.getChild=function(N){return N.length===this.elements.length?this:C(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,N,this.conformation,y())},U.prototype.applyOperator=function(N,q,j){j===void 0&&(j=!1);var Q=j?q:jr.compose(this.conformation.operator,q);return C(N,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,jr.createMapping(Q,this.getCoarseConformation(),this.conformation.r),this.props)},U.prototype.remapModel=function(N,q,j){var Q=this.getCoarseConformation(),J=g(this.kind,N);j||(j=I({},this.props),e.isSameConformation(this,N)||(j.boundary=void 0,j.lookup3d=void 0,j.principalAxes=void 0));var te=Q!==J?jr.createMapping(this.conformation.operator,J):this.conformation;return new U(this.id,this.invariantId,this.chainGroupId,this.traits,N,this.kind,this.elements,te,j)},Object.defineProperty(U.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var N=this.getCoarseConformation(),q=N.x,j=N.y,Q=N.z;return this.props.boundary=op({x:q,y:j,z:Q,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var N=this.getCoarseConformation(),q=N.x,j=N.y,Q=N.z;return this.props.lookup3d=jf({x:q,y:j,z:Q,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=u6(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Jie(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=toe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),U.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},U}();function g(U,N){return U===1?N.coarseConformation.spheres:N.coarseConformation.gaussians}function y(){return f()}var b=function(U){_t(N,U);function N(){return U!==null&&U.apply(this,arguments)||this}return N}(h);e.Spheres=b;var x=function(U){_t(N,U);function N(){return U!==null&&U.apply(this,arguments)||this}return N}(h);e.Gaussians=x;function C(U,N,q,j,Q,J,te,K,L){return new h(U,N,q,j,Q,J,te,K,L)}function _(U,N){return U.chainGroupId===N.chainGroupId&&U.conformation.operator.name===N.conformation.operator.name}e.areSameChainOperatorGroup=_;function w(U,N){return se.areEqual(U.conformation.operator.matrix,N.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function T(U,N){return Le.areEqual(U.elements,N.elements)?D(U,N.model):!1}e.areConformationsEqual=T;function A(U,N,q){var j;if(!!N){if(U.model.atomicConformation.id===q.atomicConformation.id)return N;var Q=La.Provider.get(U.model);if(Q){var J=La.Provider.get(q);return!J||Q===J?N:void 0}return((j=N.props)===null||j===void 0?void 0:j.canRemap)||D(U,q)?N:void 0}}function D(U,N){var q=jt.CoordinatesHistory.get(jt.getRoot(N));if(q)return q.areEqual(U.elements,U.kind,N);for(var j=U.elements,Q=U.conformation.coordinates,J=Q.x,te=Q.y,K=Q.z,L=E(U.kind,N),W=L.x,k=L.y,V=L.z,G=0,H=j.length;G<H;G++){var X=j[G];if(J[X]!==W[X]||te[X]!==k[X]||K[X]!==V[X])return!1}return!0}e.isSameConformation=D;function E(U,N){return U===0?N.atomicConformation:U===1?N.coarseConformation.spheres:N.coarseConformation.gaussians}e.getModelConformationOfKind=E;function M(U){return E(U.kind,U.model)}e.getConformation=M;function F(U,N){return U===0?N.atomicHierarchy:U===1?N.coarseHierarchy.spheres:N.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=F;function O(U){return F(U.kind,U.model)}e.getHierarchy=O})(Re||(Re={}));var U1;(function(e){function t(a,i,o,s){a.indices[a.count]=o,a.units[a.count]=i,a.squaredDistances[a.count]=s,a.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(a,i){for(var o=0;o<i.count;++o)a.indices[o]=i.indices[o],a.units[o]=i.units[o],a.squaredDistances[o]=i.squaredDistances[o];return a.count=i.count,a}e.copy=n})(U1||(U1={}));function l6(){return{result:U1.create(),closeUnitsResult:Cl.create(),unitGroupResult:Cl.create()}}var coe=function(){function e(t){this.structure=t,this.pivot=S(),this.findContext=l6();for(var r=t.units,n=t.boundary,a=r.length,i=new Float32Array(a),o=new Float32Array(a),s=new Float32Array(a),u=new Float32Array(a),c=S(),l=0;l<a;l++){var f=r[l],d=f.boundary.sphere;S.transformMat4(c,d.center,f.conformation.operator.matrix),i[l]=c[0],o[l]=c[1],s[l]=c[2],u[l]=d.radius}var m={x:i,y:o,z:s,radius:u,indices:De.ofBounds(0,a)};this.unitLookup=jf(m,n)}return e.prototype.findUnitIndices=function(t,r,n,a){return this.unitLookup.find(t,r,n,a)},e.prototype.find=function(t,r,n,a,i){return this._find(t,r,n,a,i!=null?i:this.findContext)},e.prototype._find=function(t,r,n,a,i){Cl.reset(i.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,a,i.closeUnitsResult);if(s.count===0)return i.result;for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];S.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);for(var f=l.lookup3d,d=f.find(this.pivot[0],this.pivot[1],this.pivot[2],a,i.unitGroupResult),m=0,p=d.count;m<p;m++)U1.add(i.result,l,d.indices[m],d.squaredDistances[m])}return i.result},e.prototype.findIntoBuilder=function(t,r,n,a,i){var o=this.structure.units,s=this.unitLookup.find(t,r,n,a);if(s.count!==0)for(var u=0,c=s.count;u<c;u++){var l=o[s.indices[u]];S.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var f=l.lookup3d,d=f.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(d.count!==0){var m=l.elements;i.beginUnit(l.id);for(var p=0,v=d.count;p<v;p++)i.addElement(m[d.indices[p]]);i.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,a,i,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,a);if(u.count!==0)for(var c=Qe.create(this.structure),l=0,f=u.count;l<f;l++){var d=s[u.indices[l]];S.set(this.pivot,t,r,n),d.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse);var m=d.lookup3d,p=m.find(this.pivot[0],this.pivot[1],this.pivot[2],a);if(p.count!==0){var v=d.elements;c.unit=d,i.beginUnit(d.id);for(var h=0,g=p.count;h<g;h++)c.element=v[p.indices[h]],o(c)&&i.addElement(c.element);i.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,a,i,o,s,u){var c=this.structure.units,l=this.unitLookup.find(t,r,n,o);if(l.count!==0)for(var f=Qe.create(this.structure),d=a+i+o,m=0,p=l.count;m<p;m++){var v=c[l.indices[m]];S.set(this.pivot,t,r,n),v.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,v.conformation.operator.inverse);var h=v.lookup3d,g=h.find(this.pivot[0],this.pivot[1],this.pivot[2],d);if(g.count!==0){var y=v.elements;f.unit=v,u.beginUnit(v.id);for(var b=0,x=g.count;b<x;b++){f.element=y[g.indices[b]];var C=s(f);Math.sqrt(g.squaredDistances[b])-a-C>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,a){var i=this.structure.units,o=this.unitLookup.find(t,r,n,a);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var c=i[o.indices[s]];S.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||S.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var l=c.lookup3d;if(l.check(this.pivot[0],this.pivot[1],this.pivot[2],a))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function Uh(e,t){if(t.length===0)return ke.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,a=0,i=t;a<i.length;a++)for(var o=i[a].units,s=0,u=o.length;s<u;s++){var c=o[s];if(r.has(c.id)){if(n.has(c.id))continue;var l=Le.union(r.get(c.id),c.elements);r.set(c.id,l),l.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}else r.set(c.id,c.elements),c.elements.length===e.unitMap.get(c.id).elements.length&&n.add(c.id)}var f=e.subsetBuilder(!0);return r.forEach(loe,f),f.getStructure()}function loe(e,t){this.setUnit(t,e)}function foe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,a=0,i=r.length;a<i;a++){var o=r[a];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Le.areEqual(o.elements,s.elements))return!1}return!0}function z1(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=0,s=a.length;o<s;o++){var u=a[o];if(!!i.has(u.id)){var c=i.get(u.id);if(Le.areIntersecting(u.elements,c.elements))return!0}}return!1}function f6(e,t){if(e===t)return e;if(!z1(e,t))return ke.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var a=r.units,i=n.unitMap,o=[],s=0,u=a.length;s<u;s++){var c=a[s];if(!!i.has(c.id)){var l=i.get(c.id);if(Le.areIntersecting(c.elements,l.elements)){var f=Le.intersect(c.elements,l.elements);o[o.length]=c.getChild(f)}}}return ke.create(o,{parent:e.parent||t.parent})}function bw(e,t){if(e===t)return ke.Empty;if(!z1(e,t))return e;for(var r=e.units,n=t.unitMap,a=[],i=0,o=r.length;i<o;i++){var s=r[i];if(!n.has(s.id)){a[a.length]=s;continue}var u=n.get(s.id),c=Le.subtract(s.elements,u.elements);c.length>0&&(a[a.length]=s.getChild(c))}return ke.create(a,{parent:e.parent||t.parent})}var tt;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,ke.Empty)}e.Empty=n;function a(g){return g.kind==="singletons"}e.isSingleton=a;function i(g){return a(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=i;function o(g){return a(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return i(g)?ke.Empty:a(g)?g.structure:Uh(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,x=0,C=s(g).units;x<C.length;x++){var _=C[x];_===b.get(_.id)?y[y.length]={unit:_,indices:De.ofBounds(0,_.elements.length)}:y[y.length]={unit:_,indices:De.ofSortedArray(Le.indicesOf(b.get(_.id).elements,_.elements))}}return _e(g.source,y)}e.toLociWithCurrentUnits=u;function c(g){for(var y=[],b=g.source.unitMap,x=0,C=s(g).units;x<C.length;x++){var _=C[x],w=b.get(_.id);w===_?y[y.length]={unit:w,indices:De.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:De.ofSortedArray(Le.indicesOf(w.elements,_.elements))}}return _e(g.source,y)}e.toLociWithSourceUnits=c;function l(g,y,b){var x=y.length;return x===0?n(g):b?t(g,Uh(g,y)):r(g,y)}var f=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.source,this.structures,this.allSingletons)},g}(),d=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=V3(ke.hashCode,ke.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return l(this.structure,this.structures,this.allSingletons)},g}();function m(g){return new f(g)}e.LinearBuilder=m;function p(g){return new d(g)}e.UniqueBuilder=p;function v(g,y){var b=0;if(e.isSingleton(g))for(var x=0,C=g.structure.units;x<C.length;x++)for(var _=C[x],w=_.elements,T=0,A=w.length;T<A;T++){var D=ke.create([_.getChild(Le.ofSingleton(w[T]))],{parent:g.source});y(D,b++)}else for(var E=0,M=g.structures;E<M.length;E++){var D=M[E];y(D,b++)}}e.forEach=v;function h(g,y){return a(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=h})(tt||(tt={}));var Cr;(function(e){e.Empty={hash:-1,elements:[]};function t(l,f){return n(tt.toLociWithSourceUnits(tt.Singletons(l,f)))}e.fromSubStructure=t;function r(l){return n(tt.toLociWithSourceUnits(l))}e.fromSelection=r;function n(l){for(var f=[],d=0,m=l.elements;d<m.length;d++){var p=m[d],v=p.unit,h=p.indices;if(De.size(h)!==0){var g=[],y=[];if(De.isInterval(h))De.size(h)===1?y.push(Se.min(h)):g.push(Se.min(h),Se.max(h));else for(var b=0,x=h.length;b<x;){var C=b;for(b++;b<x&&h[b-1]+1===h[b];)b++;var _=b;if(_-C>2)g.push(h[C],h[_-1]);else for(var w=C;w<_;w++)y[y.length]=h[w]}f.push({unit:v,set:Le.ofSortedArray(y),ranges:Tr.ofSortedRanges(g)})}}for(var T=new Map,b=0,A=f.length;b<A;++b){var p=f[b],D=If(Wa(p.ranges),Wa(p.set));if(T.has(D)){var E=T.get(D).groupedUnits;E.has(p.unit.invariantId)?E.get(p.unit.invariantId).push(p.unit.id):E.set(p.unit.invariantId,[p.unit.id])}else{var E=new Map;E.set(p.unit.invariantId,[p.unit.id]),T.set(D,{groupedUnits:E,set:p.set,ranges:p.ranges})}}var M=[];return T.forEach(function(F){var O=[];F.groupedUnits.forEach(function(U){return O.push(Le.ofUnsortedArray(U))}),O.sort(function(U,N){return U[0]-N[0]}),M.push({groupedUnits:O,set:F.set,ranges:F.ranges})}),{hash:l.structure.hashCode,elements:M}}e.fromLoci=n;function a(l,f){for(var d=[],m=0,p=l.length;m<p;++m){var v=l[m];f.unitMap.has(v)&&d.push(f.unitMap.get(v))}return d}function i(l,f){l.hash!==-1&&l.hash!==f.hashCode;for(var d=[],m=0,p=l.elements;m<p.length;m++)for(var v=p[m],h=function(x){var C=a(x,f);if(C.length===0)return"continue";var _=void 0;if(v.ranges.length===0)_=v.set;else if(v.set.length===0)if(v.ranges.length===2)_=Se.ofRange(v.ranges[0],v.ranges[1]);else{var w=new Int32Array(Tr.size(v.ranges));Tr.forEach(v.ranges,function(F,O){return w[O]=F}),_=Le.ofSortedArray(w)}else{var T=Tr.size(v.ranges),A=new Int32Array(v.set.length+T);Tr.forEach(v.ranges,function(F,O){return A[O]=F}),A.set(v.set,T),_=Le.ofUnsortedArray(A)}for(var D=0,E=C;D<E.length;D++){var M=E[D];d.push({unit:M,indices:_})}},g=0,y=v.groupedUnits;g<y.length;g++){var b=y[g];h(b)}return _e(f,d)}e.toLoci=i;function o(l,f){l.hash!==-1&&l.hash!==f.hashCode;for(var d=[],m=0,p=l.elements;m<p.length;m++)for(var v=p[m],h=function(x){var C=a(x,f);if(C.length===0)return"continue";var _=C[0].elements,w=Tr.size(v.ranges),T=v.set.length,A=new Int32Array(T+w),D=void 0;if(w===0){for(var E=0,M=T;E<M;++E)A[E]=_[v.set[E]];D=Le.ofSortedArray(A)}else if(T===0)Tr.forEach(v.ranges,function(N,q){return A[q]=_[N]}),D=Le.ofSortedArray(A);else if(Le.min(v.set)>Tr.max(v.ranges)){Tr.forEach(v.ranges,function(N,q){return A[q]=_[N]});for(var E=0,M=T;E<M;++E)A[E+w]=_[v.set[E]];D=Le.ofSortedArray(A)}else if(Tr.min(v.ranges)>Le.max(v.set)){for(var E=0,M=T;E<M;++E)A[E]=_[v.set[E]];Tr.forEach(v.ranges,function(N,q){return A[q+T]=_[N]}),D=Le.ofSortedArray(A)}else{Tr.forEach(v.ranges,function(N,q){return A[q]=_[N]});for(var E=0,M=T;E<M;++E)A[E+w]=_[v.set[E]];D=Le.ofUnsortedArray(A)}for(var F=0,O=C;F<O.length;F++){var U=O[F];d.push(U.getChild(D))}},g=0,y=v.groupedUnits;g<y.length;g++){var b=y[g];h(b)}return ke.create(d,{parent:f})}e.toStructure=o;function s(l){return ne.internal.generator.bundleElement({groupedUnits:ne.core.type.list(l.groupedUnits.map(function(f){return ne.core.type.list(f)})),ranges:ne.core.type.list(l.ranges),set:ne.core.type.list(l.set)})}function u(l){return ne.internal.generator.bundle({elements:ne.core.type.list(l.elements.map(s))})}e.toExpression=u;function c(l,f){if(l.elements.length!==f.elements.length)return!1;for(var d=0,m=l.elements.length;d<m;++d){var p=l.elements[d],v=f.elements[d];if(p.groupedUnits.length!==v.groupedUnits.length)return!1;for(var h=0,g=v.groupedUnits.length;h<g;++h)if(!Le.areEqual(p.groupedUnits[h],v.groupedUnits[h]))return!1;if(!Le.areEqual(p.set,v.set)||!Tr.areEqual(p.ranges,v.ranges))return!1}return!0}e.areEqual=c})(Cr||(Cr={}));function xw(e){return ar.isCovalent(e.atomicBond.type)}function doe(){return function(t){for(var r=t.inputStructure,n=Qe.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],ft.entity.type(n)==="polymer"){for(var c=qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();l<8||a.push(s)}}}return tt.Singletons(r,ke.create(a,{parent:r}))}}function moe(){return function(t){for(var r=t.inputStructure,n=Qe.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],ft.entity.type(n)==="water"&&a.push(s)}}return tt.Singletons(r,ke.create(a,{parent:r}))}}function poe(){return function(t){for(var r=t.inputStructure,n=Qe.create(r),a=[],i=0,o=r.units;i<o.length;i++){var s=o[i];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],ft.entity.type(n)!=="water"){if(ft.entity.type(n)==="polymer"){for(var c=qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),l=0;c.hasNext;)l++,c.move();if(l>=8)continue}a.push(s)}}}return tt.Singletons(r,ke.create(a,{parent:r}))}}function voe(){return function(t){for(var r=t.inputStructure,n=[],a=0,i=r.units;a<i.length;a++){var o=i[a];o.kind===1&&n.push(o)}return tt.Singletons(r,ke.create(n,{parent:r}))}}function d6(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function m6(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return tt.Sequence(r.inputStructure,[Cr.toStructure(n,r.inputStructure)])}}var hoe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",defaultBondTest:xw,atomicSequence:doe,water:moe,atomicHet:poe,spheres:voe,bundleElementImpl:d6,bundleGenerator:m6}),Uo=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=en(),this.element=Qe.create(void 0),this.currentStructure=void 0,this.atomicBond=new p6,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Qe.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new p6,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&en()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> ".concat(this.timeoutMs/1e3,"s)."))},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),p6=function(){function e(){this.a=Qe.create(void 0),this.aIndex=0,this.b=Qe.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=xw}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||xw},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return Qe.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),v6;(function(e){function t(r,n,a){return r(new Uo(n,a))}e.run=t})(v6||(v6={}));var Sw=function(){function e(t){this.source=t,this.set=V3(ke.hashCode,ke.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){!t.elementCount||(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?tt.Singletons(this.source,Uh(this.source,this.structures)):tt.Sequence(this.source,this.structures)},e}(),goe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var a=this.builderMap.get(t);a||(a=this.source.subsetBuilder(!0),this.builders[this.builders.length]=a,this.builderMap.set(t,a)),a.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=Qe.create(this.source),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return tt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return tt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?tt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),Cw=function(e){return tt.Sequence(e.inputStructure,[])},h6=function(e){return tt.Singletons(e.inputStructure,e.inputStructure)};function yoe(e){return _w(I(I({},e),{groupBy:function(t){return ft.residue.key(t.element)}}))}function boe(e){return _w(I(I({},e),{groupBy:function(t){return ft.chain.key(t.element)}}))}function Fl(e){return!0}function xoe(e){return 0}function _w(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return h6;if(!!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return Soe(e.atomTest);var t={unitTest:e.unitTest||Fl,entityTest:e.entityTest||Fl,chainTest:e.chainTest||Fl,residueTest:e.residueTest||Fl,atomTest:e.atomTest||Fl,groupBy:e.groupBy||xoe};return e.groupBy?_oe(t):Coe(t)}function Soe(e){return function(r){var n=r.inputStructure,a=n.units,i=r.pushCurrentElement(),o=n.subsetBuilder(!0);i.structure=n;for(var s=0,u=a;s<u.length;s++){var c=u[s];i.unit=c;var l=c.elements;o.beginUnit(c.id);for(var f=0,d=l.length;f<d;f++)i.element=l[f],e(r)&&o.addElement(i.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),tt.Singletons(n,o.getStructure())}}function Coe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest;return function(s){var u=s.inputStructure,c=u.units,l=s.pushCurrentElement(),f=u.subsetBuilder(!0),d=a===Fl&&i===Fl,m=i===Fl;l.structure=u;for(var p=0,v=c;p<v.length;p++){var h=v[p];if(l.unit=h,!!t(s)){var g=h.elements,y=h.model;if(f.beginUnit(h.id),h.kind===0)for(var b=qt.transientSegments(h.model.atomicHierarchy.chainAtomSegments,g),x=qt.transientSegments(h.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var C=b.move();if(l.element=g[C.start],!(!r(s)||!n(s))){if(d){f.addElementRange(g,C.start,C.end);continue}for(x.setSegment(C);x.hasNext;){var _=x.move();if(l.element=g[_.start],!!a(s)){if(m){f.addElementRange(g,_.start,_.end);continue}for(var w=_.start,T=_.end;w<T;w++)l.element=g[w],i(s)&&f.addElement(l.element)}}}}else for(var A=y.coarseHierarchy.spheres.chainElementSegments,b=qt.transientSegments(A,g);b.hasNext;){var C=b.move();if(l.element=g[C.start],!(!r(s)||!n(s))){if(d){f.addElementRange(g,C.start,C.end);continue}for(var w=C.start,T=C.end;w<T;w++)l.element=g[w],a(s)&&f.addElement(l.element)}}f.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),tt.Singletons(u,f.getStructure())}}function _oe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,a=e.residueTest,i=e.atomTest,o=e.groupBy;return function(u){var c=u.inputStructure,l=c.units,f=u.pushCurrentElement(),d=new goe(c);f.structure=c;for(var m=0,p=l;m<p.length;m++){var v=p[m];if(f.unit=v,!!t(u)){var h=v.elements,g=v.model;if(v.kind===0)for(var y=qt.transientSegments(g.atomicHierarchy.chainAtomSegments,h),b=qt.transientSegments(g.atomicHierarchy.residueAtomSegments,h);y.hasNext;){var x=y.move();if(f.element=h[x.start],!(!r(u)||!n(u)))for(b.setSegment(x);b.hasNext;){var C=b.move();if(f.element=h[C.start],!!a(u))for(var _=C.start,w=C.end;_<w;_++)f.element=h[_],i(u)&&d.add(o(u),v.id,f.element)}}else for(var T=g.coarseHierarchy.spheres.chainElementSegments,y=qt.transientSegments(T,h);y.hasNext;){var x=y.move();if(f.element=h[x.start],!(!r(u)||!n(u)))for(var _=x.start,w=x.end;_<w;_++)f.element=h[_],a(u)&&d.add(o(u),v.id,f.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),d.getSelection()}}function ww(e,t,r){for(var n=new Int32Array(t.length),a=0,i=t.length;a<i;a++)n[a]=e.elements[t[a]];return ke.create([e.getChild(Le.ofSortedArray(n))],{parent:r})}function woe(e,t){return function(n){var a=n.inputStructure.units,i=tt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!!Re.isAtomic(u))if(t)for(var c=0,l=u.rings.aromaticRings;c<l.length;c++){var f=l[c];i.add(ww(u,u.rings.all[f],n.inputStructure))}else for(var d=0,m=u.rings.all;d<m.length;d++){var f=m[d];i.add(ww(u,f,n.inputStructure))}}else{for(var p=Br.create(),v=0;v<e.length;v++)Br.add(p,e[v],e[v]);for(var h=0,g=a;h<g.length;h++){var u=g[h];if(!!Re.isAtomic(u))for(var y=u.rings,b=0,x=p.array;b<x.length;b++){var C=x[b];if(!!y.byFingerprint.has(C))for(var _=0,w=y.byFingerprint.get(C);_<w.length;_++){var f=w[_];t&&!y.aromaticRings.includes(f)||i.add(ww(u,y.all[f],n.inputStructure))}}}}return i.getSelection()}}function Aoe(e,t,r){return r===void 0&&(r=!1),function(a){var i=e(a);if(tt.structureCount(i)===0)return i;var o=r?bw(a.inputStructure,tt.unionStructure(i)):tt.unionStructure(i);if(o.elementCount===0)return tt.Empty(a.inputStructure);a.throwIfTimedOut(),a.pushInputStructure(o);var s=t(a);return a.popInputStructure(),tt.withInputStructure(s,a.inputStructure)}}function Toe(e){return function(r){var n=r.inputStructure,a=n.interUnitBonds,i=tt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var c=u[s];if(c.kind===0){var l=c.bonds,f=l.offset,d=l.b,m=l.edgeProps,p=m.flags,v=m.order;o.a.unit=c,o.b.unit=c;for(var h=0,g=c.elements.length;h<g;h++){o.aIndex=h,o.a.element=c.elements[h];for(var y=f[h],b=f[h+1];y<b;y++)if(o.bIndex=d[y],o.b.element=c.elements[d[y]],o.type=p[y],o.order=v[y],o.test(r,!1)){var x=n.subsetBuilder(!1);x.beginUnit(c.id),x.addElement(o.a.element),x.addElement(o.b.element),x.commitUnit(),i.add(x.getStructure())}}}}for(var C=0,_=a.edges;C<_.length;C++){var w=_[C];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var x=n.subsetBuilder(!1);x.addToUnit(o.a.unit.id,o.a.element),x.addToUnit(o.b.unit.id,o.b.element),i.add(x.getStructure())}}return r.popCurrentBond(),i.getSelection()}}var Poe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",none:Cw,all:h6,residues:yoe,chains:boe,atoms:_w,rings:woe,querySelection:Aoe,bondedAtomicPairs:Toe}),V1=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Do.Mutable(),this.parentId=-1,this.currentUnit=Br.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)Br.add(n,r,r)&&this.elementCount++;else{var a=Br.create();Br.add(a,r,r),this.unitMap.set(t,a),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?Br.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Br.create():this.currentUnit},e.prototype.addElement=function(t){Br.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return ke.Empty;var t=[];vs(this.ids);for(var r=cu.UnitEquivalenceBuilder(),n=0,a=this.ids.length;n<a;n++){var i=this.ids[n],o=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&vs(s);var c=o.getChild(Le.ofSortedArray(s)),l=r.add(c.id,c);c!==l&&(c=l.applyOperator(c.id,c.conformation.operator,!0)),t[t.length]=c}return ke.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}(),Eoe={type_symbol:ce.Schema.Aliased(Jt.atom_site.type_symbol),label_atom_id:Jt.atom_site.label_atom_id,auth_atom_id:Jt.atom_site.auth_atom_id,label_alt_id:Jt.atom_site.label_alt_id,label_comp_id:Jt.atom_site.label_comp_id,auth_comp_id:Jt.atom_site.auth_comp_id,pdbx_formal_charge:Jt.atom_site.pdbx_formal_charge},Ioe={group_PDB:Jt.atom_site.group_PDB,label_seq_id:Jt.atom_site.label_seq_id,auth_seq_id:Jt.atom_site.auth_seq_id,pdbx_PDB_ins_code:Jt.atom_site.pdbx_PDB_ins_code},Doe={label_asym_id:Jt.atom_site.label_asym_id,auth_asym_id:Jt.atom_site.auth_asym_id,label_entity_id:Jt.atom_site.label_entity_id},Aw;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(Aw||(Aw={}));var od;(function(e){function t(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(a,i){return a.residueAtomSegments.index[a.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(a,i){return r(a,i)-t(a,i)}e.chainResidueCount=n})(od||(od={}));var G1={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},Moe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},Roe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},Boe=1.7,Foe=10.81,Ooe=0;function zh(e){var t=G1[e];return t===void 0?Boe:Moe[t]}function koe(e){var t=G1[e];return t===void 0?Foe:Roe[t]}function Vh(e){var t=G1[e];return t===void 0?Ooe:t}function g6(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}function Loe(e){var t=e.unit,r=e.flags,n=e.proteinInfo,a=t.conformation.position,i=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,c=function(E,M){return E===-1?S.setNaN(M):a(E,M)},l=S(),f=S(),d=S(),m=S(),p=S(),v=S(),h=S();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(c(i[b],m),c(s[b+1],p),S.squaredDistance(m,p)>6.25)continue e}var x=o[g-2],C=o[g],_=o[g+2],w=i[x],T=i[C],A=i[_];c(w,l),c(T,f),c(A,d),S.sub(v,l,f),S.sub(h,f,d);var D=ps(S.angle(v,h));D&&D>70&&(r[g]|=32)}}var Noe=9,H1=-27.888,Uoe=-.5,y6=-9.9;function zoe(e,t,r,n){var a=S.distance(e,n),i=S.distance(t,n),o=S.distance(t,r),s=S.distance(e,r),u=H1/a-H1/i,c=H1/o-H1/s,l=u+c;return l<y6?y6:l}function Voe(e,t,r){for(var n=t.residueIndices,a=t.cIndices,i=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,c=e.conformation.invariantPosition,l=e.model.atomicHierarchy.derived.residue.traceElementIndex,f=n.length,d=[],m=[],p=[],v=S(),h=S(),g=S(),y=S(),b=S(),x=S(),C=S(),_=0,w=n.length;_<w;++_){var T=_,A=n[_],D=s[T],E=a[T],M=l[A];if(!(D===-1||E===-1)&&u.findAtomOnResidue(A,"OXT")===-1){c(D,v),c(E,h),c(M,g);for(var F=r.find(g[0],g[1],g[2],Noe),O=F.indices,U=F.count,N=0;N<U;++N){var q=O[N];if(!(q===T||q-1===T||q+1===T)){var j=o[q];if(j!==-1){c(j,y);var Q=i[q];if(Q===-1){if(q===0)continue;var J=q-1,te=s[J],K=a[J];if(te===-1||K===-1)continue;c(te,C),c(K,x),S.sub(b,x,C);var L=S.distance(C,x);S.scaleAndAdd(b,y,b,1/L)}else c(Q,b);var W=zoe(v,h,y,b);W>Uoe||(d[d.length]=T,m[m.length]=q,p[p.length]=W)}}}}}return Goe(f,d,m,p)}function Goe(e,t,r,n){for(var a=new Ni.DirectedEdgeBuilder(e,t,r),i=new Float32Array(a.slotCount),o=0,s=a.edgeCount;o<s;o++)a.addNextEdge(),a.assignProperty(i,n[o]);return a.createGraph({energies:n})}var zt;(function(e){e.is=Da.has,e.create=Da.create})(zt||(zt={}));var q1=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function Hoe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=[1024,2048,4096,128,256,512],i=0;i<3;i++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+i+3)!==-1)if(n[o]|=a[i+3]|a[i],e.params.oldDefinition)for(var u=1;u<i+3;++u)n[o+u]|=a[i+3]|64;else for(var u=0;u<=i+3;++u)n[o+u]|=a[i+3]|64}function qoe(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,a=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],c=1,l=n-u;c<l;c++){var f=zt.create(r[c]),d=zt.create(r[c-1]),m=zt.create(r[c+1]);if(e.params.oldOrdering){if(u===3&&(zt.is(f,1)||zt.is(m,1))||u===5&&(zt.is(f,1)||zt.is(f,8)||zt.is(m,1)||zt.is(m,8)))continue}else if(u===4&&(zt.is(f,8)||zt.is(m,8))||u===5&&(zt.is(f,1)||zt.is(f,8)||zt.is(m,1)||zt.is(m,8)))continue;if(zt.is(f,a[u])&&zt.is(f,a[u-3])&&zt.is(d,a[u])&&zt.is(d,a[u-3]))if(e.params.oldDefinition)for(var p=0;p<u;p++)r[c+p]|=i[u];else for(var p=-1;p<=u;p++)r[c+p]|=i[u]}}function joe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function Woe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?b6(e,t):b6(t,e):!1}function b6(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function Xoe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var a=t[n],i=!1,o=0;o<r.length;o++){var s=r[o];joe(s,a)&&(i=!0,s.firstEnd++,a.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:a.partner1,firstEnd:a.partner1,secondStart:a.partner2,secondEnd:a.partner2,type:a.type})}for(var u=0;u<r.length;u++)for(var c=r[u],l=u;l<r.length;l++){var f=r[l];Woe(c,f)&&(c.nextLadder=l,f.previousLadder=u)}}function Yoe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,a=e.bridges,i=r.offset,o=r.b,s,u,c=0,l=t.residueIndices.length;c<l;++c)for(var f=i[c],d=i[c+1];f<d;f++){var m=o[f];c>m||(s=c+1,u=m,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new q1(s,u,0)),s=c,u=m-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new q1(u,s,0)),s=c,u=m,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new q1(u,s,1)),s=c+1,u=m-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,a[a.length]=new q1(u,s,1)))}a.sort(function(p,v){return p.partner1>v.partner1?1:p.partner1<v.partner1?-1:0})}function x6(e){return zt.is(e,8)||zt.is(e,1)||zt.is(e,16)}function Koe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var a=t[n],i=a.firstStart;i<=a.firstEnd;i++){var o=a.firstStart-i,s=a.secondStart-o;a.firstStart!==a.firstEnd?(r[i]|=4,r[s]|=4):(!x6(r[i])&&zt.is(r[i],4)&&(r[i]|=2),!x6(r[s])&&zt.is(r[s],4)&&(r[s]|=2))}if(a.nextLadder!==0){for(var u=t[a.nextLadder],i=a.firstStart;i<=u.firstEnd;i++)r[i]|=4;if(a.type===0)for(var i=a.secondStart;i<=u.secondEnd;i++)r[i]|=4;else for(var i=u.secondEnd;i<=a.secondStart;i++)r[i]|=4}}}function Qoe(e,t){var r=t.cIndices,n=t.nIndices,a=t.residueIndices,i=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.length,c=function(_,w){return _===-1?S.setNaN(w):i(_,w)},l=S(),f=S(),d=S(),m=S(),p=S(),v=S(),h=S(),g=S(),y=S();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),x=new Float32Array(u-1);c(-1,l),c(-1,f),c(-1,d),c(r[0],m),c(s[a[0]],p),c(n[0],v),c(r[1],h),c(s[a[1]],g),c(n[1],y);for(var C=0;C<u-1;++C)o.findAtomOnResidue(a[C],"OXT")===-1&&(b[C]=ps(S.dihedralAngle(l,v,p,m)),x[C]=ps(S.dihedralAngle(v,p,m,y)),l=m,f=p,d=v,m=h,p=g,v=y,c(r[C+1],h),c(s[a[C+1]],g),c(n[C+1],y));return{phi:b,psi:x}}function Zoe(e,t){for(var r=e.model.atomicConformation,n=r.x,a=r.y,i=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,c=t.length;u<c;++u)s[u]=o[t[u]];var l={x:n,y:a,z:i,indices:Le.ofSortedArray(s)};return jf(l,op(l))}function $oe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,a=r.length,i=new Uint32Array(a),o=new Int32Array(a),s=new Int32Array(a),u=new Int32Array(a),c=new Int32Array(a),l=0;l<a;++l){var f=n[r[l]];i[l]=f,o[l]=t.findAtomOnResidue(f,"C"),s[l]=t.findAtomOnResidue(f,"H"),u[l]=t.findAtomOnResidue(f,"O"),c[l]=t.findAtomOnResidue(f,"N")}return{residueIndices:Le.ofSortedArray(i),cIndices:o,hIndices:s,oIndices:u,nIndices:c}}var Joe={oldDefinition:P.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:P.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function ese(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_;return ae(this,function(w){for(r=$oe(e),n=r.residueIndices,a=Zoe(e,n),i=Voe(e,r,a),o=n.length,s=new Uint32Array(o),u=Qoe(e,r),c=[],l=[],f=t.oldDefinition?nse:ise,d=t.oldOrdering?ase:ose,m={params:t,getResidueFlag:f,getFlagName:d,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:u,ladders:c,bridges:l},Hoe(m),qoe(m),Loe(m),Yoe(m),Xoe(m),Koe(m),p=sse(s,f),v=new Uint32Array(o),h=[],g=[],y=function(T){return Le.indexOf(n,T)},b=0,x=n.length;b<x;++b)C=p[b],v[b]=C,_=f(s[b]),(g.length===0||_!==g[g.length-1].flags)&&(g[g.length]=tse(rse(C),s[b],f)),h[b]=g.length-1;return[2,g6(v,h,g,y)]})})}function tse(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function rse(e){return e===yr.SecondaryStructureDssp.H||e===yr.SecondaryStructureDssp.G||e===yr.SecondaryStructureDssp.I?"helix":e===yr.SecondaryStructureDssp.B||e===yr.SecondaryStructureDssp.E?"sheet":e===yr.SecondaryStructureDssp.T?"turn":e===yr.SecondaryStructureDssp.S?"bend":"none"}function nse(e){return zt.is(e,1)?yr.SecondaryStructureDssp.H:zt.is(e,4)?yr.SecondaryStructureDssp.E:zt.is(e,2)?yr.SecondaryStructureDssp.B:zt.is(e,8)?yr.SecondaryStructureDssp.G:zt.is(e,16)?yr.SecondaryStructureDssp.I:zt.is(e,64)?yr.SecondaryStructureDssp.T:zt.is(e,32)?yr.SecondaryStructureDssp.S:0}function ase(e){return zt.is(e,1)?"H":zt.is(e,4)?"E":zt.is(e,2)?"B":zt.is(e,8)?"G":zt.is(e,16)?"I":zt.is(e,64)?"T":zt.is(e,32)?"S":"-"}function ise(e){return zt.is(e,16)?yr.SecondaryStructureDssp.I:zt.is(e,1)?yr.SecondaryStructureDssp.H:zt.is(e,4)?yr.SecondaryStructureDssp.E:zt.is(e,2)?yr.SecondaryStructureDssp.B:zt.is(e,8)?yr.SecondaryStructureDssp.G:zt.is(e,64)?yr.SecondaryStructureDssp.T:zt.is(e,32)?yr.SecondaryStructureDssp.S:0}function ose(e){return zt.is(e,16)?"I":zt.is(e,1)?"H":zt.is(e,4)?"E":zt.is(e,2)?"B":zt.is(e,8)?"G":zt.is(e,64)?"T":zt.is(e,32)?"S":"-"}function sse(e,t){for(var r=new Uint32Array(e.length),n=0,a=e.length;n<a;++n){var i=zt.create(e[n]);r[n]=t(i)}return r}var Ol;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:I({},P.getDefaultValues(n.getParams(c))),data:el.create(void 0)}),c[o][i]},u=function(c,l,f){var d=s(c);c[o][i]={props:l,data:el.withValue(d.data,f)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=P.clone(n.getParams(c));return P.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,f,d){return f===void 0&&(f={}),ie(a,void 0,void 0,function(){var m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return d&&l.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(l=l.root),m=s(l.root).props,p=s(l),v=P.merge(n.defaultParams,m,f),p.data.value&&P.areEqual(n.defaultParams,p.props,v)?[2]:[4,n.obtain(c,l,v)];case 1:return h=b.sent(),g=h.value,y=h.assets,l.customPropertyDescriptors.add(n.descriptor),l.customPropertyDescriptors.assets(n.descriptor,y),u(l,v,g),[2]}})})},ref:function(c,l){return c.customPropertyDescriptors.reference(n.descriptor,l)},get:function(c){return s(c).data},set:function(c,l,f){l===void 0&&(l={}),n.type==="root"&&(c=c.root);var d=s(c),m=P.merge(n.defaultParams,d.props,l);P.areEqual(n.defaultParams,d.props,m)||(u(c,m,f),c.customPropertyDescriptors.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:P.Value(i,{isHidden:!0})};return t({label:Ao(n),descriptor:to({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:P.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ie(o,void 0,void 0,function(){return ae(this,function(f){return[2,I(I({},P.getDefaultValues(s)),l)]})})}})}e.createSimple=r})(Ol||(Ol={}));var Gh;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=_s.create(e.Descriptor);function t(r,n,a){var i=new Map,o=[{kind:"none"}],s=use(r,n);cse(r,s,i,o),lse(n,s,i,r._rowCount,o);var u=a.residues._rowCount,c=function(f){return f},l={type:new Int32Array(u),key:new Int32Array(u),elements:o};return i.size>0&&dse(a,s,i,l),g6(l.type,l.key,l.elements,c)}e.fromStruct=t})(Gh||(Gh={}));function use(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function cse(e,t,r,n){if(!!e._rowCount)for(var a=e.beg_label_asym_id,i=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,c=e.end_auth_seq_id,l=e.pdbx_end_PDB_ins_code,f=e.pdbx_PDB_helix_class,d=e.conf_type_id,m=e.details,p=t==="label"?i:o,v=t==="label"?u:c,h=0,g=e._rowCount;h<g;h++){var y=yr.create(f.valueKind(h)===0?yr.SecondaryStructurePdb[f.value(h)]:d.valueKind(h)===0?yr.SecondaryStructureMmcif[d.value(h)]:536870912),b={kind:"helix",flags:y,type_id:d.valueKind(h)===0?d.value(h):"HELIX_P",helix_class:f.value(h),details:m.valueKind(h)===0?m.value(h):void 0},x={startSeqId:p.value(h),startInsCode:s.value(h),endSeqId:v.value(h),endInsCode:l.value(h),type:y,key:n.length};n[n.length]=b;var C=a.value(h);if(r.has(C)){var _=r.get(C);_.has(x.startSeqId)?_.get(x.startSeqId).push(x):_.set(x.startSeqId,[x])}else r.set(C,new Map([[x.startSeqId,[x]]]))}}function lse(e,t,r,n,a){if(!!e._rowCount)for(var i=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,c=e.end_label_seq_id,l=e.end_auth_seq_id,f=e.pdbx_end_PDB_ins_code,d=e.sheet_id,m=t==="label"?o:s,p=t==="label"?c:l,v=new Map,h=n+1,g=0,y=e._rowCount;g<y;g++){var b=d.value(g),x=void 0;v.has(b)?x=v.get(b):(x=h++,v.set(b,x));var C=yr.create(4|8388608),_={kind:"sheet",flags:C,sheet_id:b,symmetry:void 0},w={startSeqId:m.value(g),startInsCode:u.value(g),endSeqId:p.value(g),endInsCode:f.value(g),type:C,key:a.length};a[a.length]=_;var T=i.value(g);if(r.has(T)){var A=r.get(T);A.has(w.startSeqId)?A.get(w.startSeqId).push(w):A.set(w.startSeqId,[w])}else r.set(T,new Map([[w.startSeqId,[w]]]))}}function fse(e,t,r,n,a,i){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,c=o.pdbx_PDB_ins_code,l=r.endSeqId,f=r.endInsCode,d=r.key,m=r.type,p=t==="label"?u:s,v=n;v<a;){var h=p.value(v);if(i.type[v]=m,i.key[v]=d,h>l||h===l&&c.value(v)===f)break;v++}}function dse(e,t,r,n){for(var a=e.chainAtomSegments.count,i=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,c=o.pdbx_PDB_ins_code,l=t==="label"?u:s,f=0;f<a;f++){var d=od.chainStartResidueIndex(e,f),m=od.chainEndResidueIndexExcl(e,f),p=i.value(f);if(r.has(p))for(var v=r.get(p),h=d;h<m;h++){var g=l.value(h);if(v.has(g))for(var y=v.get(g),b=0,x=y;b<x.length;b++){var C=x[b],_=c.value(h);C.startInsCode===_&&fse(e,t,C,h,m,n)}}}}function S6(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var a=e.models[r];if(jt.isFromPdbArchive(a)||jt.hasSecondaryStructure(a)){t="model";break}}}return{type:P.MappedStatic(t,{model:P.EmptyGroup({label:"Model"}),dssp:P.Group(Joe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var C6=S6(),zo=Ol.createProvider({label:"Secondary Structure",descriptor:to({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:C6,getParams:S6,isApplicable:function(e){return!0},obtain:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a,i,o;return ae(this,function(s){switch(s.label){case 0:switch(n=I(I({},P.getDefaultValues(C6)),r),a=n.type.name,a){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return i={},[4,mse(t,n.type.params)];case 2:return[2,(i.value=s.sent(),i)];case 3:return o={},[4,pse(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function mse(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o;return ae(this,function(s){switch(s.label){case 0:r=new Map,n=0,a=e.unitSymmetryGroups.length,s.label=1;case 1:return n<a?(i=e.unitSymmetryGroups[n].units[0],Re.isAtomic(i)&&!jt.isCoarseGrained(i.model)?[4,ese(i,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(i.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function pse(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i;return ae(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)a=e.unitSymmetryGroups[r].units[0],Re.isAtomic(a)&&(i=Gh.Provider.get(a.model),i&&t.set(a.invariantId,i));return[2,t]})})}function Et(e){return e}var vse={true:Et(function(e){return!0}),false:Et(function(e){return!1}),zero:Et(function(e){return 0})};function an(){throw new Error("Property only available for atomic models.")}function fc(e){throw e?new Error("Property only available for coarse models (".concat(e,").")):new Error("Property only available for coarse models.")}var Hh={key:Et(function(e){return e.element}),x:Et(function(e){return e.unit.conformation.x(e.element)}),y:Et(function(e){return e.unit.conformation.y(e.element)}),z:Et(function(e){return e.unit.conformation.z(e.element)}),id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):an()}),occupancy:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):an()}),B_iso_or_equiv:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):an()}),sourceIndex:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element}),type_symbol:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):an()}),label_atom_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):an()}),auth_atom_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):an()}),label_alt_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):an()}),label_comp_id:Et(j1),auth_comp_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):an()}),pdbx_formal_charge:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):an()}),vdw_radius:Et(function(e){return Re.isAtomic(e.unit)?zh(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):an()})};function j1(e){return Re.isAtomic(e.unit)||an(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function Tw(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):an()}function hse(e){Re.isAtomic(e.unit)||an();var t=e.unit.model.sequence.byEntityKey[yi(e)];return t&&t.sequence.microHet.has(Tw(e))}function _6(e){Re.isAtomic(e.unit)||an();var t=e.unit.model.sequence.byEntityKey[yi(e)];return t?t.sequence.microHet.get(Tw(e))||[j1(e)]:[j1(e)]}var gse={key:Et(function(e){return Re.isAtomic(e.unit)?e.unit.residueIndex[e.element]:an()}),group_PDB:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):an()}),label_seq_id:Et(Tw),auth_seq_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):an()}),pdbx_PDB_ins_code:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):an()}),isNonStandard:Et(function(e){return Re.isAtomic(e.unit)?_6(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):an()}),hasMicroheterogeneity:Et(hse),microheterogeneityCompIds:Et(_6),secondary_structure_type:Et(function(e){var t;Re.isAtomic(e.unit)||an();var r=(t=zo.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.type[r.getIndex(e.unit.residueIndex[e.element])]:536870912}),secondary_structure_key:Et(function(e){var t;Re.isAtomic(e.unit)||an();var r=(t=zo.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.key[r.getIndex(e.unit.residueIndex[e.element])]:-1}),chem_comp_type:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(j1(e)).type:an()})},yse={key:Et(function(e){return Re.isAtomic(e.unit)?e.unit.chainIndex[e.element]:an()}),label_asym_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):an()}),auth_asym_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):an()}),label_entity_id:Et(function(e){return Re.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):an()})},bse={key:Hh.key,entityKey:Et(function(e){return Re.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:fc()}),x:Hh.x,y:Hh.y,z:Hh.z,asym_id:Et(function(e){return Re.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):fc()}),entity_id:Et(function(e){return Re.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):fc()}),seq_id_begin:Et(function(e){return Re.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):fc()}),seq_id_end:Et(function(e){return Re.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):fc()}),sphere_radius:Et(function(e){return Re.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:fc("spheres")}),sphere_rmsf:Et(function(e){return Re.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:fc("spheres")}),gaussian_weight:Et(function(e){return Re.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:fc("gaussians")}),gaussian_covariance_matrix:Et(function(e){return Re.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:fc("gaussians")})};function yi(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var xse={key:Et(yi),id:Et(function(e){return e.unit.model.entities.data.id.value(yi(e))}),type:Et(function(e){return e.unit.model.entities.data.type.value(yi(e))}),src_method:Et(function(e){return e.unit.model.entities.data.src_method.value(yi(e))}),pdbx_description:Et(function(e){return e.unit.model.entities.data.pdbx_description.value(yi(e))}),formula_weight:Et(function(e){return e.unit.model.entities.data.formula_weight.value(yi(e))}),pdbx_number_of_molecules:Et(function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(yi(e))}),details:Et(function(e){return e.unit.model.entities.data.details.value(yi(e))}),pdbx_mutation:Et(function(e){return e.unit.model.entities.data.pdbx_mutation.value(yi(e))}),pdbx_fragment:Et(function(e){return e.unit.model.entities.data.pdbx_fragment.value(yi(e))}),pdbx_ec:Et(function(e){return e.unit.model.entities.data.pdbx_ec.value(yi(e))}),subtype:Et(function(e){return e.unit.model.entities.subtype.value(yi(e))}),prd_id:Et(function(e){var t,r;return(r=(t=e.unit.model.entities.prd_id)===null||t===void 0?void 0:t.value(yi(e)))!==null&&r!==void 0?r:""})},Sse=[],Cse={id:Et(function(e){return e.unit.id}),chainGroupId:Et(function(e){return e.unit.chainGroupId}),multiChain:Et(function(e){return Re.Traits.is(e.unit.traits,1)}),object_primitive:Et(function(e){return e.unit.objectPrimitive}),operator_name:Et(function(e){return e.unit.conformation.operator.name}),model_index:Et(function(e){return e.unit.model.modelNum}),model_label:Et(function(e){return e.unit.model.label}),model_entry_id:Et(function(e){return e.unit.model.entryId}),hkl:Et(function(e){return e.unit.conformation.operator.hkl}),spgrOp:Et(function(e){return e.unit.conformation.operator.spgrOp}),model_num:Et(function(e){return e.unit.model.modelNum}),pdbx_struct_assembly_id:Et(function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||jr.DefaultName}),pdbx_struct_oper_list_ids:Et(function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||Sse}),struct_ncs_oper_id:Et(function(e){return e.unit.conformation.operator.ncsId})},ft={constant:vse,atom:Hh,residue:gse,chain:yse,entity:xse,unit:Cse,coarse:bse},qh=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var a=this._find(t,n);return a?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,a=w6(t);if(!!this.index.has(a)){var i=this.index.get(a),o=A6(t);if(!!i.has(o))for(var s=i.get(o),u=T6(t),c=P6(t),l=E6(t),f=(r=I6(t))!==null&&r!==void 0?r:"1_555",d=0,m=s;d<m.length;d++){var p=m[d];if(!(p.label_comp_id!==u||p.label_alt_id!==c||p.ins_code!==l)&&!(this.checkOperator&&((n=p.operator_name)!==null&&n!==void 0?n:"1_555")!==f))return p}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),"".concat(t.label_asym_id," ").concat(t.label_comp_id," ").concat(t.label_seq_id,":").concat(t.ins_code,":").concat(t.label_alt_id).concat(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:w6(t),label_comp_id:T6(t),label_seq_id:A6(t),label_alt_id:P6(t),ins_code:E6(t),operator_name:(r=I6(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,a,i=0,o=r;i<o.length;i++){var s=o[i];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((a=t.operator_name)!==null&&a!==void 0?a:"1_555")))return!0}return!1},e}(),w6=ft.chain.label_asym_id,A6=ft.residue.label_seq_id,T6=ft.atom.label_comp_id,P6=ft.atom.label_alt_id,E6=ft.residue.pdbx_PDB_ins_code,I6=ft.unit.operator_name;function sp(e,t,r){for(var n=t.subsetBuilder(!0),a=0,i=r.units;a<i.length;a++){var o=i[a];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,c=o.elements;n.beginUnit(o.id);for(var l=qt.transientSegments(s,c);l.hasNext;)for(var f=l.move().index,d=s.offsets[f],m=s.offsets[f+1];d<m;d++)Le.has(u,d)&&n.addElement(d);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function _se(e){return function(r){var n=e(r);if(tt.isSingleton(n))return tt.Singletons(r.inputStructure,sp(r,r.inputStructure,n.structure));for(var a=new Sw(r.inputStructure),i=0,o=n.structures;i<o.length;i++){var s=o[i];a.add(sp(r,r.inputStructure,s))}return a.getSelection()}}function Pw(e,t,r,n){for(var a=new V1(t),i=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var c=u[s],l=c.conformation,f=l.x,d=l.y,m=l.z,p=c.elements,v=0,h=p.length;v<h;v++){var g=p[v];i.findIntoBuilder(f(g),d(g),m(g),o,a)}e.throwIfTimedOut()}return n.wholeResidues?sp(e,t,a.getStructure()):a.getStructure()}function D6(e,t,r,n){var a=new V1(t),i=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,c=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var l=0,f=r.units;l<f.length;l++){var d=f[l];e.element.unit=d;for(var m=d.conformation,p=m.x,v=m.y,h=m.z,g=d.elements,y=0,b=g.length;y<b;y++){var x=g[y];e.element.element=x;var C=o(e);i.findIntoBuilderWithRadius(p(x),v(x),h(x),C,u,c,s,a)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?sp(e,t,a.getStructure()):a.getStructure()}function wse(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function Ase(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,a=e.inputStructure.units;n<a.length;n++){var i=a[n];e.element.unit=i;for(var o=i.elements,s=0,u=o.length;s<u;s++){var c=o[s];e.element.element=c;var l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function Tse(e,t){return function(n){var a=e(n);if(t.elementRadius){var i=I(I({},t),{elementRadius:t.elementRadius,elementRadiusClosure:wse(n,t.elementRadius),sourceMaxRadius:Ase(n,t.elementRadius)});if(tt.isSingleton(a)){var o=D6(n,n.inputStructure,a.structure,i),s=tt.Singletons(n.inputStructure,o);return s}else{for(var u=new Sw(n.inputStructure),c=0,l=a.structures;c<l.length;c++){var f=l[c];u.add(D6(n,n.inputStructure,f,i))}return u.getSelection()}}if(tt.isSingleton(a)){var o=Pw(n,n.inputStructure,a.structure,t),s=tt.Singletons(n.inputStructure,o);return s}else{for(var u=new Sw(n.inputStructure),d=0,m=a.structures;d<m.length;d++){var f=m[d];u.add(Pw(n,n.inputStructure,f,t))}return u.getSelection()}}}function Pse(e,t){return function(n){var a=e(n);if(tt.structureCount(a)===0)return a;var i=tt.UniqueBuilder(n.inputStructure),o=function(s){return i.add(s)};return tt.forEach(a,function(s,u){n.pushInputStructure(s),tt.forEach(t(n),o),n.popInputStructure(),u%10==0&&n.throwIfTimedOut()}),i.getSelection()}}function Ese(e,t){return function(n){var a=e(n);if(tt.structureCount(a)===0)return a;var i=t(n);if(tt.structureCount(i)===0)return tt.Empty(n.inputStructure);var o=tt.unionStructure(i),s=tt.UniqueBuilder(n.inputStructure);return tt.forEach(a,function(u,c){var l=f6(o,u);l.elementCount!==0&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function Ise(e,t){return function(n){var a=e(n);if(tt.structureCount(a)===0)return a;var i=t(n);if(tt.structureCount(i)===0)return a;var o=tt.unionStructure(i),s=tt.UniqueBuilder(n.inputStructure);return tt.forEach(a,function(u,c){var l=bw(u,o);l.elementCount!==0&&s.add(l),c%50==0&&n.throwIfTimedOut()}),s.getSelection()}}function Dse(e){return function(r){var n=tt.LinearBuilder(r.inputStructure);return n.add(tt.unionStructure(e(r))),n.getSelection()}}function Mse(e,t){return function(n){var a=e(n),i=new Map,o=[];n.pushCurrentElement(),tt.forEach(a,function(C,_){n.element.structure=C;for(var w=0,T=C.units;w<T.length;w++){var A=T[w];n.element.unit=A;for(var D=A.elements,E=0,M=D.length;E<M;E++){n.element.element=D[E];var F=t(n),O=void 0;i.has(F)?O=i.get(F):(O=Br.create(),i.set(F,O)),Br.add(O,_,_)}}o[_]=n.inputStructure.subsetBuilder(!0),_%10==0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var c=u[s];n.element.unit=c;for(var l=c.elements,f=0,d=l.length;f<d;f++){n.element.element=l[f];var m=t(n);if(!!i.has(m))for(var p=i.get(m).array,v=0,h=p.length;v<h;v++)o[p[v]].addToUnit(c.id,l[f])}}n.popCurrentElement();for(var g=tt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var x=b[y];g.add(x.getStructure())}return g.getSelection()}}function Rse(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,a=e.bondTest,i=e.fixedPoint,o=Math.max(r,0);return function(u){var c=tt.UniqueBuilder(u.inputStructure),l=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(a),tt.forEach(l,function(f,d){var m=f;if(i)for(;;){var p=m.elementCount;if(m=M6(u,n,m),m.elementCount===p)break}else for(var v=0;v<o;v++)m=M6(u,n,m);c.add(m),d%10==0&&u.throwIfTimedOut()}),u.popCurrentBond(),c.getSelection()}}function M6(e,t,r){var n=Bse(e,r);return t?sp(e,e.inputStructure,n):n}function Bse(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,a=new V1(r),i=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){a.beginUnit(u.id);for(var c=0,l=u.elements.length;c<l;c++)a.addElement(u.elements[c]);a.commitUnit();continue}var f=r.unitMap.get(u.id),d=f.bonds,m=d.offset,p=d.b,v=d.edgeProps,h=v.flags,g=v.order;i.setStructure(r),i.a.unit=f,i.b.unit=f;for(var c=0,l=u.elements.length;c<l;c++){a.addToUnit(u.id,u.elements[c]);for(var y=Le.indexOf(f.elements,u.elements[c]),b=m[y],x=m[y+1];b<x;b++){var C=p[b],_=f.elements[C];Le.has(u.elements,_)||a.has(u.id,_)||(i.aIndex=y,i.a.element=u.elements[c],i.bIndex=C,i.b.element=_,i.type=h[b],i.order=g[b],i.test(e,!0)&&a.addToUnit(u.id,_))}}for(var w=0,T=n.getConnectedUnits(f.id);w<T.length;w++)for(var A=T[w],D=t.unitMap.get(A.unitB),E=r.unitMap.get(A.unitB),M=0,F=A.connectedIndices;M<F.length;M++){var O=F[M];if(!!Le.has(u.elements,f.elements[O]))for(var U=0,N=A.getEdges(O);U<N.length;U++){var q=N[U],_=E.elements[q.indexB];D&&Le.has(D.elements,_)||a.has(A.unitB,_)||(i.a.unit=f,i.aIndex=O,i.a.element=f.elements[O],i.b.unit=E,i.bIndex=q.indexB,i.b.element=_,i.type=q.props.flag,i.order=q.props.order,i.test(e,!0)&&a.addToUnit(A.unitB,_))}}}return a.getStructure()}function Fse(e){var t=e.query,r=e.radius,n=e.includeWater;return function(i){for(var o=tt.unionStructure(t(i)),s=sp(i,i.inputStructure,Pw(i,i.inputStructure,o,{radius:r})),u=Lse(i.inputStructure),c=Nse(i.inputStructure),l=Qe.create(s),f=new Map,d=new qh({checkOperator:!0}),m=0,p=s.units;m<p.length;m++){var v=p[m];if(v.kind===0){l.unit=v;for(var h=v.elements,g=qt.transientSegments(v.model.atomicHierarchy.chainAtomSegments,h),y=qt.transientSegments(v.model.atomicHierarchy.residueAtomSegments,h);g.hasNext;){var b=g.move();l.element=h[b.start];var x=ft.chain.label_asym_id(l),C=ft.unit.operator_name(l);if(u.has(x)){f.has(x)?gn(f.get(x),C):f.set(x,[C]);continue}var _=ft.entity.type(l);if(!(_==="water"||_==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();l.element=h[w.start],c.addComponent(qh.getEntryFromLocation(l),d)}}i.throwIfTimedOut()}}for(var T=i.inputStructure.subsetBuilder(!0),A=0,D=i.inputStructure.units;A<D.length;A++){var v=D[A];if(v.kind===0){l.unit=v;var h=v.elements,g=qt.transientSegments(v.model.atomicHierarchy.chainAtomSegments,h),y=qt.transientSegments(v.model.atomicHierarchy.residueAtomSegments,h);for(T.beginUnit(v.id);g.hasNext;){var b=g.move();l.element=h[b.start];var x=ft.chain.label_asym_id(l),C=ft.unit.operator_name(l);if(f.has(x)&&f.get(x).indexOf(C)>=0){T.addElementRange(h,b.start,b.end);continue}if(!!d.hasLabelAsymId(x))for(y.setSegment(b);y.hasNext;){var w=y.move();l.element=h[w.start],!!d.has(l)&&T.addElementRange(h,w.start,w.end)}}T.commitUnit(),i.throwIfTimedOut()}}var E=Uh(i.inputStructure,[T.getStructure(),o]);if(n){for(var M=new V1(i.inputStructure),F=i.inputStructure.lookup3d,O=0,U=E.units;O<U.length;O++){for(var v=U[O],N=v.conformation,q=N.x,j=N.y,Q=N.z,h=v.elements,J=0,te=h.length;J<te;J++){var K=h[J];F.findIntoBuilderIf(q(K),j(K),Q(K),r,M,kse),M.addToUnit(v.id,K)}i.throwIfTimedOut()}return tt.Sequence(i.inputStructure,[M.getStructure()])}else return tt.Sequence(i.inputStructure,[E])}}var Ose=ft.entity.type;function kse(e){return Ose(e)==="water"}function Lse(e){var t=e.models[0],r=new Set;if(!Or.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,a=n._rowCount,i=n.asym_id,o=0;o<a;o++)r.add(i.value(o));return r}function Nse(e){var t,r,n=e.models[0],a=new Use;if(!Or.is(n.sourceData))return a;for(var i=n.sourceData.data.db.struct_conn,o=i.conn_type_id,s=i.ptnr1_label_asym_id,u=i.ptnr1_label_comp_id,c=i.ptnr1_label_seq_id,l=i.ptnr1_symmetry,f=i.pdbx_ptnr1_label_alt_id,d=i.pdbx_ptnr1_PDB_ins_code,m=i.ptnr2_label_asym_id,p=i.ptnr2_label_comp_id,v=i.ptnr2_label_seq_id,h=i.ptnr2_symmetry,g=i.pdbx_ptnr2_label_alt_id,y=i.pdbx_ptnr2_PDB_ins_code,b=0;b<i._rowCount;b++){var x=o.value(b);if(!(x!=="covale"&&x!=="metalc")){var C={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:c.value(b),label_alt_id:f.value(b),ins_code:d.value(b),operator_name:(t=l.value(b))!==null&&t!==void 0?t:"1_555"},_={label_asym_id:m.value(b),label_comp_id:p.value(b),label_seq_id:v.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=h.value(b))!==null&&r!==void 0?r:"1_555"};a.addEdge(C,_)}}return a}var Use=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=qh.getLabel(t),a=qh.getLabel(r);this.addVertex(t,n),this.addVertex(r,a),gn(this.edges.get(n),a),gn(this.edges.get(a),n)},e.prototype.addComponent=function(t,r){var n=qh.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var a=new Set,i=new Set,o=[n];for(i.add(n),r.add(t);o.length>0;){var s=o.pop();a.add(s);for(var u=this.vertices.get(s),c=0,l=this.edges.get(s);c<l.length;c++){var f=l[c];if(!a.has(f)&&(o.push(f),!i.has(f))){i.add(f);var d=this.vertices.get(f);u.operator_name===d.operator_name?r.add(I(I({},d),{operator_name:t.operator_name})):r.add(d)}}}},e}(),zse=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",wholeResidues:_se,includeSurroundings:Tse,querySelection:Pse,intersectBy:Ese,exceptBy:Ise,union:Dse,expandProperty:Mse,includeConnected:Rse,surroundingLigands:Fse});function Vse(e,t,r,n,a,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?W1.check(e,t,r,n,a,i):W1.check(e,r,t,n,a,i)}function Gse(e,t,r,n,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?X1.check(e,t,r,n,a):X1.check(e,r,t,n,a)}var W1;(function(e){var t=S.zero();function r(o,s,u,c,l,f,d){var m=s.elements,p=s.conformation.position,v=t;o.element.unit=s;for(var h=!1,g=0,y=m.length;g<y;g++){var b=m[g];o.element.element=b;var x=Math.max(0,S.distance(u,p(b,v))-c-d(o));if(x<l)return 0;x<f&&(h=!0)}return h?1:2}function n(o,s,u,c,l,f,d){for(var m=s.units,p=!1,v=0,h=m.length;v<h;v++){var g=r(o,m[v],u,c,l,f,d);if(g===0)return 0;g===1&&(p=!0)}return p?1:2}e.toPoint=n;var a=S.zero();function i(o,s,u,c,l,f){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units,m=!1;o.element.structure=s;for(var p=0,v=d.length;p<v;p++){var h=d[p],g=h.elements,y=h.conformation.position;o.element.unit=h;for(var b=0,x=g.length;b<x;b++){var C=g[b];o.element.element=C;var _=n(o,u,y(C,a),f(o),c,l,f);if(_===0)return 0;_===1&&(m=!0)}}return m}e.check=i})(W1||(W1={}));var X1;(function(e){var t=S.zero();function r(o,s,u,c,l,f){var d=s.elements,m=s.conformation.position,p=t;o.element.unit=s;for(var v=0,h=d.length;v<h;v++){var g=d[v];if(o.element.element=g,Math.max(0,S.distance(u,m(g,p))-c-f(o))<=l)return!0}return!1}function n(o,s,u,c,l,f){for(var d=s.units,m=0,p=d.length;m<p;m++)if(r(o,d[m],u,c,l,f))return!0;return!1}e.toPoint=n;var a=S.zero();function i(o,s,u,c,l){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units;o.element.structure=s;for(var d=0,m=f.length;d<m;d++){var p=f[d];o.element.unit=p;for(var v=p.elements,h=p.conformation.position,g=0,y=v.length;g<y;g++){var b=v[g];if(o.element.element=b,n(o,u,h(b,a),l(o),c,l))return!0}}return!1}e.check=i})(X1||(X1={}));function Hse(e,t){return function(r){var n=e(r),a=tt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),tt.forEach(n,function(i,o){r.currentStructure=i,t(r)&&a.add(i),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function qse(e){return function(t){var r=e(t),n=tt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var a=r.structure.units[0],i=ke.create([a.getChild(Le.ofSingleton(a.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function Ew(e,t,r){var n=e.currentStructure.units,a=e.pushCurrentElement();a.structure=e.currentStructure;for(var i=0,o=n;i<o.length;i++){var s=o[i];a.unit=s;var u=s.elements,c=void 0;if(Re.isAtomic(s)?c=t.atomic:c=t.coarse,!!c){for(var l=0,f=u.length;l<f;l++)a.element=u[l],r.add(c(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function jse(e,t,r){var n=new Set,a=t(e);return e.pushCurrentElement(),tt.forEach(a,function(i,o){e.currentStructure=i,Ew(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function Wse(e,t,r){return function(n){var a=e(n),i=jse(n,t,r),o=tt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),tt.forEach(a,function(s,u){n.currentStructure=s;var c=Ew(n,r,new Set);Cn.isSuperset(c,i)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function Xse(e,t){return function(r){var n=tt.unionStructure(t(r)),a=tt.LinearBuilder(r.inputStructure);return tt.forEach(e(r),function(i,o){z1(n,i)&&a.add(i),o%10&&r.throwIfTimedOut()}),a.getSelection()}}function Yse(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius=="undefined"?Kse(r):r.minRadius===0?Qse(r):Zse(r)}}function Kse(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=tt.unionStructure(n).lookup3d,s=tt.LinearBuilder(t.inputStructure),u=S.zero();return tt.forEach(r,function(c,l){for(var f=c.units,d=!1,m=0,p=f.length;m<p;m++){for(var v=f[m],h=v.elements,g=v.conformation,y=g.position,b=g.r,x=0,C=h.length;x<C;x++){var _=h[x];if(y(_,u),o.check(u[0],u[1],u[2],a+b(_))){d=!0;break}}if(d)break}i&&(d=!d),d&&s.add(c),l%10==0&&t.throwIfTimedOut()}),s.getSelection()}function Qse(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.maxRadius,i=e.invert,o=e.elementRadius,s=tt.unionStructure(n),u=tt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),tt.forEach(r,function(c,l){var f=Gse(t,s,c,a,o);i&&(f=!f),f&&u.add(c),l%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function Zse(e){var t=e.queryCtx,r=e.selection,n=e.target,a=e.minRadius,i=e.maxRadius,o=e.invert,s=e.elementRadius,u=tt.unionStructure(n),c=tt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),tt.forEach(r,function(l,f){var d=Vse(t,u,l,a,i,s);o&&(d=!d),d&&c.add(l),f%10==0&&t.throwIfTimedOut()}),t.popCurrentElement(),c.getSelection()}function $se(e,t){var r=e.queryCtx,n=e.input,a=e.target,i=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,c=t.units;u<c.length;u++){var l=c[u];if(!!Re.isAtomic(l))for(var f=n.unitMap.get(l.id),d=f.bonds,m=d.offset,p=d.b,v=d.edgeProps,h=v.flags,g=v.order,y=s.getConnectedUnits(l.id),b=y.length,x=l.elements,C=f.elements,_=0,w=x.length;_<w;_++){var T=Le.indexOf(C,x[_]);o.a.unit=f,o.b.unit=f;for(var A=m[T],D=m[T+1];A<D;A++)if(o.b.element=f.elements[p[A]],!(i&&Le.has(l.elements,o.b.element))&&!!a.hasElement(o.b)&&(o.aIndex=T,o.a.element=x[_],o.bIndex=p[A],o.type=h[A],o.order=g[A],o.test(r,!0)))return!0;for(var E=0;E<b;E++)for(var M=y[E],F=n.unitMap.get(M.unitB),O=F.elements,U=M.getEdges(T),N=0,q=U.length;N<q;N++){var j=U[N];if(o.b.unit=F,o.b.element=O[j.indexB],!!a.hasElement(o.b)&&!(i&&t.hasElement(o.b))&&(o.a.unit=f,o.aIndex=T,o.a.element=x[_],o.bIndex=j.indexB,o.type=j.props.flag,o.order=j.props.order,o.test(r,!0)))return!0}}}return!1}function Jse(e){var t=e.query,r=e.target,n=e.disjunct,a=e.invert,i=e.bondTest;return function(o){var s=r(o);if(tt.isEmpty(s))return s;var u=t(o);if(tt.isEmpty(u))return u;var c={queryCtx:o,input:o.inputStructure,disjunct:n,target:tt.unionStructure(s)},l=tt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),tt.forEach(u,function(f,d){($se(c,f)||a)&&l.add(f),d%5==0&&o.throwIfTimedOut()}),o.popCurrentBond(),l.getSelection()}}var eue=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",pick:Hse,first:qse,getCurrentStructureProperties:Ew,withSameAtomProperties:Wse,areIntersectedBy:Xse,within:Yse,isConnectedTo:Jse});function tue(e){return e.length===0?Cw:e.length===1?e[0]:function(t){for(var r=tt.UniqueBuilder(t.inputStructure),n=function(i){tt.forEach(e[i](t),function(o,s){r.add(o),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)n(a);return r.getSelection()}}function rue(e){return e.length===0?Cw:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var a=0,i=tt.structureCount(r[0]),n=1;n<r.length;n++){var o=tt.structureCount(r[n]);o<i&&(a=n,i=o)}t.throwIfTimedOut();var s=V3(function(l){return l.hashCode},ke.areUnitIdsAndIndicesEqual);tt.forEach(r[a],function(l){return s.add(l)});for(var u=tt.UniqueBuilder(t.inputStructure),c=0;c<r.length;c++)c!==a&&(tt.forEach(r[c],function(l){s.has(l)&&u.add(l)}),t.throwIfTimedOut());return u.getSelection()}}var nue=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",merge:tue,intersect:rue}),Iw;(function(e){function t(d){return!!d&&!!d.has}function r(d,m){return function(p){return d(p)===m}}e.eq=r;function n(d,m){return function(p){return d(p)<m}}e.lt=n;function a(d,m){return function(p){return d(p)<=m}}e.lte=a;function i(d,m){return function(p){return d(p)>m}}e.gt=i;function o(d,m){return function(p){return d(p)>=m}}e.gte=o;function s(d){return!0}function u(d){return!1}function c(d,m){if(t(m))return function(h){return m.has(d(h))};if(m.length===0)return u;for(var p=new Set,v=0;v<m.length;v++)p.add(m[v]);return function(h){return p.has(d(h))}}e.inSet=c;function l(){for(var d=[],m=0;m<arguments.length;m++)d[m]=arguments[m];switch(d.length){case 0:return s;case 1:return d[0];case 2:{var p=d[0],v=d[1];return function(Q){return p(Q)&&v(Q)}}case 3:{var h=d[0],g=d[1],y=d[2];return function(Q){return h(Q)&&g(Q)&&y(Q)}}case 4:{var b=d[0],x=d[1],C=d[2],_=d[3];return function(Q){return b(Q)&&x(Q)&&C(Q)&&_(Q)}}case 5:{var w=d[0],T=d[1],A=d[2],D=d[3],E=d[4];return function(Q){return w(Q)&&T(Q)&&A(Q)&&D(Q)&&E(Q)}}case 6:{var M=d[0],F=d[1],O=d[2],U=d[3],N=d[4],q=d[5];return function(Q){return M(Q)&&F(Q)&&O(Q)&&U(Q)&&N(Q)&&q(Q)}}default:{var j=d.length;return function(Q){for(var J=0;J<j;J++)if(!d[J])return!1;return!0}}}}e.and=l;function f(){for(var d=[],m=0;m<arguments.length;m++)d[m]=arguments[m];switch(d.length){case 0:return u;case 1:return d[0];case 2:{var p=d[0],v=d[1];return function(Q){return p(Q)||v(Q)}}case 3:{var h=d[0],g=d[1],y=d[2];return function(Q){return h(Q)||g(Q)||y(Q)}}case 4:{var b=d[0],x=d[1],C=d[2],_=d[3];return function(Q){return b(Q)||x(Q)||C(Q)||_(Q)}}case 5:{var w=d[0],T=d[1],A=d[2],D=d[3],E=d[4];return function(Q){return w(Q)||T(Q)||A(Q)||D(Q)||E(Q)}}case 6:{var M=d[0],F=d[1],O=d[2],U=d[3],N=d[4],q=d[5];return function(Q){return M(Q)||F(Q)||O(Q)||U(Q)||N(Q)||q(Q)}}default:{var j=d.length;return function(Q){for(var J=0;J<j;J++)if(d[J])return!0;return!1}}}}e.or=f})(Iw||(Iw={}));var Fr={generators:Poe,filters:eue,modifiers:zse,combinators:nue,pred:Iw,internal:hoe},cu;(function(e){function t(l,f){var d=this;return Be.create("Build Assembly",function(m){return ie(d,void 0,void 0,function(){var p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F;return ae(this,function(O){if(p=l.models,p.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(v=Rh.findAssembly(p[0],f),!v)throw new Error("Assembly '".concat(f,"' is not defined."));for(h=jr.create(v.id,se.identity(),{assembly:{id:v.id,operId:0,operList:[]}}),g=ke.Builder({coordinateSystem:h,label:l.label,dynamicBonds:l.dynamicBonds}),y=new Uo(l),b=0,x=v.operatorGroups;b<x.length;b++)if(C=x[b],_=C.selector(y),tt.structureCount(_)!==0)for(w=tt.unionStructure(_).units,T=0,A=C.operators;T<A.length;T++)for(D=A[T],E=0,M=w;E<M.length;E++)F=M[E],g.addWithOperator(F,D);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(l,f,d){var m=this;return Be.create("Build Symmetry Assembly",function(p){return ie(m,void 0,void 0,function(){var v,h,g,y,b,x,C,_,w,T,A,D,E,M,F,O,U,N,q,j,Q,J,te,K,L;return ae(this,function(W){if(v=l.models,v.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(h=S(),g=ke.Builder({label:l.label,representativeModel:v[0],dynamicBonds:l.dynamicBonds}),y=new Uo(l),b=0,x=f;b<x.length;b++)if(C=x[b],_=aue(C.asymIds),w=_(y),tt.structureCount(w)!==0)for(T=tt.unionStructure(w).units,A=0,D=C.operators;A<D.length;A++)for(E=D[A],M=E.index,F=E.shift,O=F[0],U=F[1],N=F[2],q=R6(d,M,O,U,N,h),j=0,Q=T;j<Q.length;j++)for(J=Q[j],te=0,K=q;te<K.length;te++)L=K[te],g.addWithOperator(J,L);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(l,f){return Be.create("Find Symmetry Mates",function(d){return uue(d,l,f)})}e.builderSymmetryMates=n;function a(l,f,d){return Be.create("Build Symmetry",function(m){return sue(m,l,f,d)})}e.buildSymmetryRange=a;function i(l){return Be.create("Build NCS",function(f){return oue(f,l)})}e.buildNcs=i;function o(l,f){return l.invariantId===f.invariantId&&l.model.id===f.model.id&&Le.areEqual(l.elements,f.elements)}e.areUnitsEquivalent=o;function s(){return Aj(Re.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(l){for(var f=s(),d=0,m=l.units;d<m.length;d++){var p=m[d];f.add(p.id,p)}for(var v=[],h=0,g=f.groups;h<g.length;h++){var y=g[h];v.push(Re.SymmetryGroup(y.map(function(b){return l.unitMap.get(b)})))}return v}e.computeTransformGroups=u;function c(l,f){if(l.length!==f.length)return!1;for(var d=0,m=l.length;d<m;++d){var p=l[d].units,v=f[d].units;if(p.length!==v.length||l[d].hashCode!==f[d].hashCode)return!1;for(var h=0,g=p.length;h<g;h++)if(p[h].conformation!==v[h].conformation)return!1}return!0}e.areTransformGroupsEquivalent=c})(cu||(cu={}));function aue(e){return Fr.generators.atoms({chainTest:Fr.pred.and(Fr.pred.eq(function(t){return ft.unit.operator_name(t.element)},jr.DefaultName),Fr.pred.inSet(function(t){return ft.chain.label_asym_id(t.element)},e))})}function R6(e,t,r,n,a,i){var o=e.spacegroup,s=e.ncsOperators,u=[],c=o.cell.toFractional,l=S.transformMat4(S(),i,c),f=Mo.getSymmetryOperatorRef(o,t,r,n,a,l);if(s&&s.length)for(var d=0,m=s.length;d<m;++d){var p=s[d],v=se.mul(se(),f.matrix,p.matrix),h=jr.create("".concat(f.name," ").concat(p.name),v,{assembly:f.assembly,ncsId:p.ncsId,hkl:f.hkl,spgrOp:f.spgrOp});u.push(h)}else u.push(f);return u}function B6(e,t,r,n){var a=e.spacegroup,i=e.ncsOperators,o=i&&i.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=Mo.getSymmetryOperator(a,0,0,0,0));for(var u=0;u<a.operators.length;u++)for(var c=t[0];c<=r[0];c++)for(var l=t[1];l<=r[1];l++)for(var f=t[2];f<=r[2];f++)!o&&u===0&&c===0&&l===0&&f===0||s.push.apply(s,R6(e,u,c,l,f,n));return s}function iue(e,t){return e._operators_333&&S.equals(t,e._operators_333.ref)||(e._operators_333={ref:S.clone(t),operators:B6(e,S.create(-3,-3,-3),S.create(3,3,3),t)}),e._operators_333.operators}function F6(e,t){for(var r=ke.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),n=e.units,a=0,i=t;a<i.length;a++)for(var o=i[a],s=0,u=n;s<u.length;s++){var c=u[s];r.addWithOperator(c,o)}return r.getStructure()}function oue(e,t){return ie(this,void 0,void 0,function(){var r,n,a;return ae(this,function(i){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=_n.Provider.get(r[0]),n?(a=n.ncsOperators,!a||!a.length?[2,t]:[2,F6(t,a)]):[2,t]})})}function sue(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u;return ae(this,function(c){if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=_n.Provider.get(a[0]),i?(o=i.spacegroup,pi.isZero(o.cell)?[2,t]:(s=jt.getCenter(a[0]),u=B6(i,r,n,s),[2,F6(t,u)])):[2,t]})})}function uue(e,t,r){return ie(this,void 0,void 0,function(){function n(D,E){return"".concat(D.invariantId,"|").concat(E.name)}var a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A;return ae(this,function(D){switch(D.label){case 0:if(a=t.models,a.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return i=_n.Provider.get(a[0]),i?(o=i.spacegroup,pi.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=jt.getCenter(a[0]),u=iue(i,s),c=t.lookup3d,l=new Set,f=ke.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),d=t.units,m=S.zero(),p=0,v=u,D.label=3;case 3:if(!(p<v.length))return[3,6];for(h=v[p],g=0,y=d;g<y.length;g++)for(b=y[g],x=b.lookup3d.boundary.sphere,S.transformMat4(m,x.center,h.matrix),C=c.findUnitIndices(m[0],m[1],m[2],x.radius+r),_=0,w=C.count;_<w;_++)T=d[C.indices[_]],!!T.lookup3d.check(m[0],m[1],m[2],x.radius+r)&&(A=n(b,h),l.has(A)||(f.addWithOperator(b,h),l.add(A)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return p++,[3,3];case 6:return[2,f.getStructure()]}})})}var cue=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Do.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var a=r;a<n;a++)this.currentUnit[this.currentUnit.length]=t[a],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return ke.Empty;var r=[];vs(this.ids);for(var n=cu.UnitEquivalenceBuilder(),a=0,i=this.ids.length;a<i;a++){var o=this.ids[a],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),c=!1;t&&(this.isSorted||vs(u),u=Le.deduplicate(Le.ofSortedArray(this.currentUnit)),c=!0);var l=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!c&&l>1&&vs(u);var f=s.getChild(Le.ofSortedArray(u)),d=n.add(f.id,f);f!==d&&(f=d.applyOperator(f.id,f.conformation.operator,!0)),r[r.length]=f}return ke.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function O6(e,t){for(var r=1;t--;)r*=e--;return r}function lue(e,t){return t>e?0:O6(e,t)/O6(t,t)}function fue(e){var t=e&-e,r=e+t,n=r&-r,a=(n/t>>1)-1;return r|a}var due=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=lue(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=fue(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function k6(e,t){for(var r=[],n=new due(e,t);n.hasNext;)r.push(n.move().slice());return r}var sd=[],mue={links:sd,terminalLinks:sd,elements:sd,partialElements:sd,getElementIndices:function(){return sd},getLinkIndices:function(){return sd},getTerminalLinkIndices:function(){return sd}},$n=rd("C"),jh=rd("O"),pue=[No.elementFingerprint([$n,$n,$n,jh]),No.elementFingerprint([$n,$n,$n,$n,jh]),No.elementFingerprint([$n,$n,$n,$n,$n,jh]),No.elementFingerprint([$n,$n,$n,$n,$n,$n,jh])];function vue(e,t){for(var r=-1,n=-1,a=-1,i=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,c=s.label_atom_id,l=e.bonds,f=l.b,d=l.offset,m=0,p=t.length;m<p;++m){var v=o[t[m]];if(u.value(v)===$n){for(var h=0,g=0,y=d[t[m]],b=d[t[m]+1];y<b;++y){var x=o[f[y]],C=u.value(x);C===jh?++h:C===$n&&++g}if(h===2){r=v;break}else h===1&&g===1?n=v:c.value(v).startsWith("C1")?a=v:i=v}}return r!==-1?r:n!==-1?n:a!==-1?a:i!==-1?i:o[t[0]]}function hue(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function gue(e,t,r,n){var a=t.conformation.position;return S.normalize(e,S.sub(e,n,a(r,e))),e}function L6(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function yue(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,a=new Set,i=k6(Po(new Array(t.length)),2),o=0,s=i.length;o<s;++o){var u=i[o],c=n[t[u[0]]],l=n[t[u[1]]];Le.areIntersecting(c,l)&&No.getAltId(r,c)===No.getAltId(r,l)&&(a.add(t[u[0]]),a.add(t[u[1]]))}if(a.size){for(var f=[],o=0,s=t.length;o<s;++o)a.has(t[o])||f.push(t[o]);return f}else return t}}function bue(e,t){return t.properties.saccharideComponentMap.get(e)}function xue(e){if(e.models.reduce(function(me,he){return me+he.properties.saccharideComponentMap.size},0)===0)return mue;var t=[],r=[],n=[],a=[],i=new Map;function o(me,he,Pe){return"".concat(me,"|").concat(he,"|").concat(Pe)}function s(me,he){i.has(me)?i.get(me).push(he):i.set(me,[he])}function u(me,he){S.sub(n[me].geometry.direction,n[he].geometry.center,n[me].geometry.center),S.normalize(n[me].geometry.direction,n[me].geometry.direction)}var c=S.zero();function l(me,he,Pe){var re=Pe.conformation.position,ee=n[me].geometry;S.sub(ee.direction,re(Pe.elements[he],c),ee.center),S.normalize(ee.direction,ee.direction)}for(var f=0,d=e.units.length;f<d;++f){var m=e.units[f];if(!!Re.isAtomic(m))for(var p=m.model,v=m.rings,h=p.atomicHierarchy,g=h.chainAtomSegments,y=h.residueAtomSegments,b=h.atoms,x=b.label_comp_id,C=qt.transientSegments(g,m.elements),_=qt.transientSegments(y,m.elements),w=void 0;C.hasNext;)for(_.setSegment(C.move());_.hasNext;){var T=_.move().index,A=bue(x.value(y.offsets[T]),p);if(!!A){w||(w=L1.byFingerprintAndResidue(v,pue));var D=yue(v,w.get(T));if(!D||!D.length){a.push({unit:m,residueIndex:T,component:A});continue}for(var E=[],M=0,F=D.length;M<F;++M){var O=v.all[D[M]],U=vue(m,O),N=_l.calculateMomentsAxes(o6(m,O)),q=S.copy(S.zero(),N.origin),j=S.copy(S.zero(),N.dirC),Q=gue(S.zero(),m,U,q);S.orthogonalize(Q,j,Q);var J=No.getAltId(m,O),te=n.length;E.push(te),s(o(T,m.id,J),te),J&&s(o(T,m.id,""),te),n.push({geometry:{center:q,normal:j,direction:Q},component:A,ringIndex:D[M],altId:J,unit:m,residueIndex:T})}for(var K=k6(Po(new Array(D.length)),2),M=0,F=K.length;M<F;++M){var L=K[M],W=v.all[D[L[0]]],k=v.all[D[L[1]]];if(Ni.areVertexSetsConnected(m.bonds,W,k,3)){var V=E[L[0]],G=E[L[1]];n[V].altId===n[G].altId&&(u(V,G),u(G,V),t.push({carbohydrateIndexA:V,carbohydrateIndexB:G}),t.push({carbohydrateIndexA:G,carbohydrateIndexB:V}))}}}}}function H(me,he){return i.get(o(me.getResidueIndex(he),me.id,hue(me,he)))||[]}for(var f=0,d=n.length;f<d;++f)for(var X=n[f],m=X.unit,M=f+1;M<d;++M){var Y=n[M];if(!(m!==Y.unit||X.residueIndex===Y.residueIndex)){var oe=m.rings.all[X.ringIndex],ue=m.rings.all[Y.ringIndex];Ni.areVertexSetsConnected(m.bonds,oe,ue,3)&&(u(f,M),u(M,f),t.push({carbohydrateIndexA:f,carbohydrateIndexB:M}),t.push({carbohydrateIndexA:M,carbohydrateIndexB:f}))}}for(var f=0,d=e.units.length;f<d;++f){var m=e.units[f];!Re.isAtomic(m)||e.interUnitBonds.getConnectedUnits(m.id).forEach(function(re){re.connectedIndices.forEach(function(ee){re.getEdges(ee).forEach(function(B){var z=B.props,le=B.indexB;if(!!ar.isCovalent(z.flag)){var pe=e.unitMap.get(re.unitA),ge=e.unitMap.get(re.unitB),Ce=H(pe,ee),Ie=H(ge,le);if(Ce.length>0&&Ie.length>0)for(var Oe=Ce.length,We=Ie.length,Ne=0,Ye=Math.max(Oe,We);Ne<Ye;++Ne){var Xe=Ce[Math.min(Ne,Oe-1)],Ze=Ie[Math.min(Ne,We-1)],Ke=L6(pe,ee);(Ke.startsWith("O1")||Ke.startsWith("C1"))&&u(Xe,Ze),t.push({carbohydrateIndexA:Xe,carbohydrateIndexB:Ze})}else if(Ie.length===0)for(var ht=0,Ae=Ce;ht<Ae.length;ht++){var Xe=Ae[ht],Ke=L6(pe,ee);(Ke.startsWith("O1")||Ke.startsWith("C1"))&&l(Xe,le,ge),r.push({carbohydrateIndex:Xe,elementIndex:le,elementUnit:ge,fromCarbohydrate:!0})}else if(Ce.length===0)for(var we=0,Ve=Ie;we<Ve.length;we++){var Ze=Ve[we];r.push({carbohydrateIndex:Ze,elementIndex:ee,elementUnit:pe,fromCarbohydrate:!1})}}})})})}return I({links:t,terminalLinks:r,elements:n,partialElements:a},Sue(n,t,r))}function Sue(e,t,r){function n(F,O){return To(F.id,O)}function a(F,O,U){var N=[],q=F.get(n(O,U));if(q!==void 0)for(var j=0,Q=q;j<Q.length;j++){var J=Q[j];gn(N,J)}return N}for(var i=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],c=u.unit,l=u.ringIndex,f=c.rings.all[l],d=0,m=f.length;d<m;++d){var p=n(c,c.elements[f[d]]),v=i.get(p);v===void 0?i.set(p,[o]):v.push(o)}function h(F,O){return a(i,F,O)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],c=b.unit,l=b.ringIndex,f=c.rings.all[l],d=0,m=f.length;d<m;++d){var p=n(c,c.elements[f[d]]),v=g.get(p);v===void 0?g.set(p,[o]):v.push(o)}function x(F,O){return a(g,F,O)}for(var C=new Map,o=0,s=r.length;o<s;++o){var _=r[o],w=_.fromCarbohydrate,T=_.carbohydrateIndex,A=_.elementUnit,D=_.elementIndex;if(w)for(var E=e[T],c=E.unit,l=E.ringIndex,f=c.rings.all[l],d=0,m=f.length;d<m;++d){var p=n(c,c.elements[f[d]]),v=C.get(p);v===void 0?C.set(p,[o]):v.push(o)}else{var p=n(A,A.elements[D]),v=C.get(p);v===void 0?C.set(p,[o]):v.push(o)}}function M(F,O){return a(C,F,O)}return{getElementIndices:h,getLinkIndices:x,getTerminalLinkIndices:M}}var Y1=Te(),Cue=new Ji("14"),_ue=new Ji("98");function wue(e){return e>500?Cue:_ue}function Aue(e){var t=e.units,r=wue(t.length);r.reset();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Te.transform(Y1,o.sphere,s.matrix),r.includeSphere(Y1))}r.finishedIncludeStep();for(var n=0,a=t.length;n<a;n++){var i=t[n],o=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Te.transform(Y1,o.sphere,s.matrix),r.radiusSphere(Y1))}return{box:r.getBox(),sphere:r.getSphere()}}var ke=function(){function e(t,r,n,a,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=a,this._child=i==null?void 0:i.child,this._target=i==null?void 0:i.target,this._proxy=void 0}return e.prototype.subsetBuilder=function(t){return new cue(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Pt.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Js),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=Bue(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=Fue(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=Oue(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=Rue(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=kue(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return jt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Wa(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var a=this.units[r];t=31*t+a.id|0,t=31*t+Le.hashCode(a.elements)|0}return t=31*t+this.elementCount|0,t=nM(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){var t;return(t=this.state.parent)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=Aue(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new coe(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=Nie(this,{ignoreWater:!this.dynamicBonds}),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dynamicBonds",{get:function(){return this.state.dynamicBonds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=cu.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=Re.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=xue(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=Pue(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=Eue(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=Iue(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=Due(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=Mue(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Re.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Re.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Re.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Re.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=Lue(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?Le.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=this.state,n=r.dynamicBonds,a=r.interUnitBonds,i=r.parent,o=[],s=0,u=this.unitSymmetryGroups;s<u.length;s++){var c=u[s],l=c.units[0].remapModel(t,n);o.push(l);for(var f=1,d=c.units.length;f<d;++f){var m=c.units[f];o.push(m.remapModel(t,n,l.props))}}return e.create(o,{parent:i==null?void 0:i.remapModel(t),label:this.label,interUnitBonds:n?void 0:a,dynamicBonds:n})},e.prototype.asParent=function(){if(this._proxy)return this._proxy;if(this.parent){var t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,I(I({},r.state),{dynamicBonds:this.dynamicBonds}),{child:this,target:this.parent})}else this._proxy=this;return this._proxy},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function Tue(e,t,r){return e[t].id-e[r].id}function Pue(e){for(var t=e.units,r=Br.create(),n=0,a=t;n<a.length;n++){var i=a[n];Br.add(r,i.model.id,i.model)}return r.array}function Eue(e){for(var t=ft.residue.microheterogeneityCompIds,r=new Set,n=Qe.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Re.isAtomic(s)){var u=qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var c=u.move();n.element=s.elements[c.start];for(var l=t(n),f=0,d=l;f<d.length;f++){var m=d[f];r.add(m)}}}}return r}function Iue(e){for(var t=ft.atom.type_symbol,r=new Set,n=Qe.create(e),a=0,i=e.unitSymmetryGroups;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Re.isAtomic(s)){n.unit=s;for(var u=0,c=s.elements.length;u<c;++u)n.element=s.elements[u],r.add(t(n))}}return r}function Due(e){for(var t=e.units,r=Qe.create(e),n=Br.create(),a=0,i=t;a<i.length;a++){var o=i[a],s=o.kind===0?ft.entity.key:ft.coarse.entityKey;r.unit=o;for(var u=o.elements,c=qt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);c.hasNext;){var l=c.move();r.element=u[l.start];var f=s(r);Br.add(n,f,f)}}return vs(n.array),n.array}function Mue(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,a=0,i=n;a<i.length;a++){var o=i[a],s=o.units[0];if(!!Re.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=Br.create(),r.push(s.model.id),t.set(s.model.id,u));for(var c=qt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);c.hasNext;){var l=c.move();Br.add(u,l.index,l.index)}}}for(var f=new Map,d=0,m=r;d<m.length;d++){var p=m[d],v=t.get(p).array;vs(v),f.set(p,v)}return f}function Rue(e){for(var t=e.unitSymmetryGroups,r=0,n=0,a=t.length;n<a;n++)r+=t[n].elements.length;return r}function Bue(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].polymerElements.length;return r}function Fue(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)r+=t[n].gapElements.length/2;return r}function Oue(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++)t[n].polymerElements.length>0&&(r+=1);return r}function kue(e){for(var t=e.units,r=0,n=0,a=t.length;n<a;n++){var i=t[n];if(!!Re.isAtomic(i))for(var o=i.elements,s=i.residueIndex,u=-1,c=-1,l=0,f=o.length;l<f;++l)u=s[o[l]],u!==c&&(r+=1,c=u)}return r}function Lue(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,a=new Uint32Array(t.length),i=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,c=t.length;s<c;++s){a[s]=u;for(var l=t[s].elements,f=0,d=l.length;f<d;++f){var m=u+f;i[m]=s,o[m]=l[f]}u+=l.length}return{cumulativeUnitElementCount:a,unitIndices:i,elementIndices:o,getSerialIndex:function(p,v){return a[n.get(p.id)]+De.indexOf(p.elements,v)}}}(function(e){e.Empty=u([]);function t(k){return{kind:"structure-loci",structure:k}}e.Loci=t;function r(k){for(var V=[],G=0,H=k.units;G<H.length;G++){var X=H[G];V.push({unit:X,indices:Se.ofBounds(0,X.elements.length)})}return _e(k,V)}e.toStructureElementLoci=r;function n(k,V){return tt.toLociWithSourceUnits(tt.Singletons(k,V))}e.toSubStructureElementLoci=n;function a(k){return!!k&&k.kind==="structure-loci"}e.isLoci=a;function i(k,V){return k.structure===V.structure}e.areLociEqual=i;function o(k){return k.structure.isEmpty}e.isLociEmpty=o;function s(k,V){return V===k.structure?k:t(V)}e.remapLoci=s;function u(k,V){V===void 0&&(V={});for(var G=Do.Mutable(),H=Do.Mutable(),X=0,Y=!0,oe=k.length>0?k[0].id:0,ue=0,me=k.length;ue<me;ue++){var he=k[ue];G.set(he.id,he),X+=he.elements.length,he.id<oe&&(Y=!1),oe=he.id}Y||rM(k,0,k.length,Tue,Ef);for(var ue=0,me=k.length;ue<me;ue++)H.set(k[ue].id,ue);var Pe={hashCode:-1,transformHash:-1,elementCount:X,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:jr.Default,label:""};return V.parent&&(Pe.parent=V.parent.parent||V.parent),V.interUnitBonds&&(Pe.interUnitBonds=V.interUnitBonds),V.dynamicBonds?Pe.dynamicBonds=V.dynamicBonds:V.parent&&(Pe.dynamicBonds=V.parent.dynamicBonds),V.coordinateSystem?Pe.coordinateSystem=V.coordinateSystem:V.parent&&(Pe.coordinateSystem=V.parent.coordinateSystem),V.label?Pe.label=V.label:V.parent&&(Pe.label=V.parent.label),V.masterModel?Pe.masterModel=V.masterModel:V.parent&&(Pe.masterModel=V.parent.masterModel),V.representativeModel?Pe.representativeModel=V.representativeModel:V.parent&&(Pe.representativeModel=V.parent.representativeModel),new e(k,G,H,Pe)}e.create=u;function c(k,V){return ie(this,void 0,void 0,function(){var G,H,X,Y,oe,ue,me,he,Pe,re,ee,B,z;return ae(this,function(le){switch(le.label){case 0:if(k.frameCount===0)return[2,e.Empty];G=[],H=void 0,X=0,Y=0,oe=k.frameCount,le.label=1;case 1:return Y<oe?[4,Be.resolveInContext(k.getFrameAtIndex(Y),V)]:[3,4];case 2:for(ue=le.sent(),H||(H=ue),me=l(ue),he=0,Pe=me.units.length;he<Pe;++he)re=me.units[he],ee=re.invariantId+X,B=re.chainGroupId+X,z=Re.create(G.length,ee,B,re.traits,re.kind,re.model,re.conformation.operator,re.elements),G.push(z);X=G.length,le.label=3;case 3:return++Y,[3,1];case 4:return[2,u(G,{representativeModel:H,label:H.label})]}})})}e.ofTrajectory=c;function l(k,V){V===void 0&&(V={});for(var G=k.atomicHierarchy.chainAtomSegments,H=k.atomicHierarchy.index,X=k.atomicHierarchy.chains.auth_asym_id,Y=k.atomicChainOperatorMappinng,oe=new p(I({label:k.label},V)),ue=0;ue<G.count;ue++){var me=Y.get(ue)||jr.Default,he=G.offsets[ue];od.chainResidueCount(k.atomicHierarchy,ue),G.offsets[ue+1]-G.offsets[ue];var Pe=!1;if(f(k,ue))for(;ue+1<G.count&&f(k,ue+1);){var re=Y.get(ue),ee=Y.get(ue+1);if(re!==ee)break;Pe=!0,ue++}else for(;ue+1<G.count&&G.offsets[ue+1]-G.offsets[ue]==1&&G.offsets[ue+2]-G.offsets[ue+1]==1;){var B=H.getEntityFromChain(ue),z=H.getEntityFromChain(ue+1);if(B!==z)break;var le=X.value(ue),pe=X.value(ue+1);if(le!==pe)break;var re=Y.get(ue),ee=Y.get(ue+1);if(re!==ee)break;Pe=!0,ue++}var ge=Le.ofBounds(he,G.offsets[ue+1]);oe.addUnit(0,k,me,ge,Pe?1:0)}var Ce=k.coarseHierarchy;return Ce.isDefined&&(Ce.spheres.count>0&&d(oe,k,k.coarseHierarchy.spheres,1),Ce.gaussians.count>0&&d(oe,k,k.coarseHierarchy.gaussians,2)),oe.getStructure()}e.ofModel=l;function f(k,V){var G=k.atomicHierarchy.index.getEntityFromChain(V);return k.entities.data.type.value(G)==="water"}function d(k,V,G,H){for(var X=G.chainElementSegments,Y=0;Y<X.count;Y++){var oe=Le.ofBounds(X.offsets[Y],X.offsets[Y+1]);k.addUnit(H,V,jr.Default,oe,0)}}function m(k,V){if(se.isIdentity(V))return k;if(!se.isRotationAndTranslation(V,jr.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var G=[],H=0,X=k.units;H<X.length;H++){var Y=X[H],oe=Y.conformation.operator,ue=jr.create(oe.name,V,oe);G.push(Y.applyOperator(Y.id,ue))}var me=k.coordinateSystem,he=jr.compose(jr.create(me.name,V,me),me);return u(G,{parent:k,coordinateSystem:he})}e.transform=m;var p=function(){function k(V){V===void 0&&(V={}),this.props=V,this.units=[],this.invariantId=ja(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=S(),this.singleElementUnits=new Map}return k.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},k.prototype.endChainGroup=function(){this.inChainGroup=!1},k.prototype.addUnit=function(V,G,H,X,Y,oe){oe===void 0&&(oe=this.invariantId());var ue=this.inChainGroup?this.chainGroupId:++this.chainGroupId,me=Re.create(this.units.length,oe,ue,Y,V,G,H,X);return this.add(me)},k.prototype.add=function(V){if(V.elements.length===1){V.conformation.position(V.elements[0],this.p);var G=[V.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(G))return this.singleElementUnits.get(G);this.singleElementUnits.set(G,V)}return this.units.push(V),V},k.prototype.addWithOperator=function(V,G,H){return H===void 0&&(H=!1),this.add(V.applyOperator(this.units.length,G,H))},k.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(k.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),k}();e.StructureBuilder=p;function v(k){return k===void 0&&(k={}),new p(k)}e.Builder=v;function h(k){return k.hashCode}e.hashCode=h;function g(k){return JC(k.units.map(function(V){return Re.conformationId(V)}).join("|"))}e.conformationHash=g;function y(k,V){if(k===V)return!0;if(k.elementCount!==V.elementCount)return!1;var G=k.units.length;if(G!==V.units.length)return!1;for(var H=0;H<G;H++)if(k.units[H].id!==V.units[H].id)return!1;return!0}e.areUnitIdsEqual=y;function b(k,V){if(!y(k,V))return!1;for(var G=0,H=k.units.length;G<H;G++)if(!Le.areEqual(k.units[G].elements,V.units[G].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function x(k,V){if(k.hashCode!==V.hashCode)return!1;var G=k.models.length;if(G!==V.models.length)return!1;for(var H=0;H<G;H++)if(!jt.areHierarchiesEqual(k.models[H],V.models[H]))return!1;return!0}e.areHierarchiesEqual=x;function C(k,V){return k===V||k.hashCode===V.hashCode&&cu.areTransformGroupsEquivalent(k.unitSymmetryGroups,V.unitSymmetryGroups)}e.areEquivalent=C;function _(k,V){return C(k.root,V.root)}e.areRootsEquivalent=_;function w(k,V){return k.root===V.root}e.areRootsEqual=w;var T=function(){function k(V){this.structure=V,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=Qe.create(V),this.hasNext=V.elementCount>0,this.hasNext&&(this.elements=V.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=V.units[0])}return k.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},k.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},k}();e.ElementLocationIterator=T;var A=S();function D(k,V,G){for(var H=k.elements,X=k.conformation,Y=X.position,oe=X.r,ue=A,me=Number.MAX_VALUE,he=0,Pe=H.length;he<Pe;he++){var re=H[he],ee=S.distance(V,Y(re,ue))-G-oe(re);ee<me&&(me=ee)}return me}function E(k,V,G){for(var H=k.units,X=Number.MAX_VALUE,Y=0,oe=H.length;Y<oe;Y++){var ue=H[Y],me=D(ue,V,G);me<X&&(X=me)}return X}e.minDistanceToPoint=E;var M=S();function F(k,V){if(k.elementCount===0||V.elementCount===0)return 0;for(var G=k.units,H=Number.MAX_VALUE,X=0,Y=G.length;X<Y;X++)for(var oe=G[X],ue=oe.elements,me=oe.conformation,he=me.position,Pe=me.r,re=0,ee=ue.length;re<ee;re++){var B=ue[re],z=E(V,he(B,M),Pe(B));z<H&&(H=z)}return H}e.distance=F;function O(k){return k.elementCount===1?"1 element":"".concat(k.elementCount," elements")}e.elementDescription=O;function U(k,V,G){return k.masterModel?V.model===G.model||V.model===k.masterModel||G.model===k.masterModel:V.model===G.model}e.validUnitPair=U;function N(k,V,G){var H=G.maxRadius,X=G.validUnit,Y=G.validUnitPair;if(!!k.units.some(function(le){return X(le)}))for(var oe=k.lookup3d,ue=S(),me=0,he=k.units;me<he.length;me++){var Pe=he[me];if(!!X(Pe)){var re=Pe.boundary.sphere;S.transformMat4(ue,re.center,Pe.conformation.operator.matrix);for(var ee=oe.findUnitIndices(ue[0],ue[1],ue[2],re.radius+H),B=0;B<ee.count;B++){var z=k.units[ee.indices[B]];!X(z)||Pe.id>=z.id||!Y(Pe,z)||(z.elements.length>=Pe.elements.length?V(Pe,z):V(z,Pe))}}}}e.eachUnitPair=N;function q(k,V){for(var G=V.chain,H=V.residue,X=V.atom,Y=Qe.create(k),oe=0,ue=k.units;oe<ue.length;oe++){var me=ue[oe];if(me.kind===0){Y.unit=me;for(var he=me.elements,Pe=qt.transientSegments(me.model.atomicHierarchy.chainAtomSegments,he),re=qt.transientSegments(me.model.atomicHierarchy.residueAtomSegments,he);Pe.hasNext;){var ee=Pe.move();if(G&&(Y.element=he[ee.start],G(Y)),!(!H&&!X))for(re.setSegment(ee);re.hasNext;){var B=re.move();if(H&&(Y.element=he[B.start],H(Y)),!!X)for(var z=B.start,le=B.end;z<le;z++)Y.element=he[z],X(Y)}}}}}e.eachAtomicHierarchyElement=q,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function j(k){return k.unitSymmetryGroups.filter(function(V){return V.units[0].polymerElements.length>0})}function Q(k,V){var G=j(k);return G.length===1&&G[0].units.length>2&&G[0].units[0].polymerElements.length<V.fiberResidueCount}function J(k,V){var G=j(k);return G.length>=1&&G[0].units.length>V.highSymmetryUnitCount}var te;(function(k){k[k.Small=0]="Small",k[k.Medium=1]="Medium",k[k.Large=2]="Large",k[k.Huge=3]="Huge",k[k.Gigantic=4]="Gigantic"})(te=e.Size||(e.Size={}));function K(k,V,G){V===void 0&&(V={}),G===void 0&&(G=1);var H=I(I({},e.DefaultSizeThresholds),V);return k.polymerResidueCount>=H.largeResidueCount*G?J(k,H)?te.Huge:te.Gigantic:Q(k,H)||k.polymerResidueCount<H.smallResidueCount*G?te.Small:k.polymerResidueCount<H.mediumResidueCount*G?te.Medium:te.Large}e.getSize=K,e.Index=Ol.createSimple("index","root");var L="__PrincipalAxes__";function W(k){if(k.currentPropertyData[L])return k.currentPropertyData[L];var V=_e.getPrincipalAxes(e.toStructureElementLoci(k));return k.currentPropertyData[L]=V,V}e.getPrincipalAxes=W})(ke||(ke={}));var Nue=On.diff;function _e(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(G){return!!G&&G.kind==="element-loci"}e.is=t;function r(G,H){if(G.structure!==H.structure||G.elements.length!==H.elements.length)return!1;for(var X=0,Y=G.elements.length;X<Y;++X){var oe=G.elements[X],ue=H.elements[X];if(oe.unit.id!==ue.unit.id||!De.areEqual(oe.indices,ue.indices))return!1}return!0}e.areEqual=r;function n(G){for(var H=0,X=G.elements;H<X.length;H++){var Y=X[H];if(De.size(Y.indices)>0)return!1}return!0}e.isEmpty=n;function a(G){return i(G)===G.structure.elementCount}e.isWholeStructure=a;function i(G){for(var H=0,X=0,Y=G.elements;X<Y.length;X++){var oe=Y[X].indices;typeof oe=="number"?H+=Nue(oe):H+=oe.length}return H}e.size=i;function o(G){return e(G,G.units.map(function(H){return{unit:H,indices:De.ofBounds(0,H.elements.length)}}))}e.all=o;function s(G){return e(G,[])}e.none=s;function u(G,H){if(!n(G)){var X=G.elements[0].unit,Y=X.elements[De.getAt(G.elements[0].indices,0)];return H?(H.structure=G.structure,H.unit=G.elements[0].unit,H.element=Y,H):Qe.create(G.structure,X,Y)}}e.getFirstLocation=u;function c(G){return n(G)?G:e(G.structure,[{unit:G.elements[0].unit,indices:De.ofSingleton(De.start(G.elements[0].indices))}])}e.firstElement=c;function l(G){return n(G)?G:x(c(G))}e.firstResidue=l;function f(G){return n(G)?G:A(c(G))}e.firstChain=f;function d(G){for(var H=[],X=function(me){var he=me.unit,Pe=me.indices,re=new Int32Array(De.size(Pe));De.forEach(Pe,function(ee,B){return re[B]=he.elements[ee]}),H.push(he.getChild(Le.ofSortedArray(re)))},Y=0,oe=G.elements;Y<oe.length;Y++){var ue=oe[Y];X(ue)}return ke.create(H,{parent:G.structure.parent})}e.toStructure=d;function m(G,H){if(H===G.structure)return G;var X=[];return G.elements.forEach(function(Y){if(!!H.unitMap.has(Y.unit.id)){var oe=H.unitMap.get(Y.unit.id),ue=De.indexedIntersect(Y.indices,Y.unit.elements,oe.elements);De.size(ue)>0&&X.push({unit:oe,indices:ue})}}),e(H,X)}e.remap=m;function p(G,H){if(G.elements.length>H.elements.length)return p(H,G);if(e.isEmpty(G))return H;for(var X=new Map,Y=0,oe=G.elements;Y<oe.length;Y++){var ue=oe[Y];X.set(ue.unit.id,ue.indices)}for(var me=[],he=0,Pe=H.elements;he<Pe.length;he++){var ue=Pe[he];X.has(ue.unit.id)?(me[me.length]={unit:ue.unit,indices:De.union(X.get(ue.unit.id),ue.indices)},X.delete(ue.unit.id)):me[me.length]=ue}return X.forEach(function(re,ee){me[me.length]={unit:G.structure.unitMap.get(ee),indices:re}}),e(G.structure,me)}e.union=p;function v(G,H){for(var X=new Map,Y=0,oe=H.elements;Y<oe.length;Y++){var ue=oe[Y];X.set(ue.unit.id,ue.indices)}for(var me=[],he=0,Pe=G.elements;he<Pe.length;he++){var ue=Pe[he];if(X.has(ue.unit.id)){var re=De.subtract(ue.indices,X.get(ue.unit.id));if(De.size(re)===0)continue;me[me.length]={unit:ue.unit,indices:re}}else me[me.length]=ue}return e(G.structure,me)}e.subtract=v;function h(G,H){for(var X=new Map,Y=0,oe=G.elements;Y<oe.length;Y++){var ue=oe[Y];X.set(ue.unit.id,ue.indices)}for(var me=[],he=0,Pe=H.elements;he<Pe.length;he++){var ue=Pe[he];if(!!X.has(ue.unit.id)){var re=De.intersect(X.get(ue.unit.id),ue.indices);De.size(re)!==0&&(me[me.length]={unit:ue.unit,indices:re})}}return e(G.structure,me)}e.intersect=h;function g(G,H){if(G.elements.length>H.elements.length)return g(H,G);if(e.isEmpty(G))return e.isEmpty(H);for(var X=new Map,Y=0,oe=G.elements;Y<oe.length;Y++){var ue=oe[Y];X.set(ue.unit.id,ue.indices)}for(var me=0,he=H.elements;me<he.length;me++){var ue=he[me];if(!!X.has(ue.unit.id)&&De.areIntersecting(X.get(ue.unit.id),ue.indices))return!0}return!1}e.areIntersecting=g;function y(G,H){if(e.isEmpty(G))return e.isEmpty(H);for(var X=new Map,Y=0,oe=G.elements;Y<oe.length;Y++){var ue=oe[Y];X.set(ue.unit.id,ue.indices)}for(var me=!1,he=0,Pe=H.elements;he<Pe.length;he++){var ue=Pe[he];if(!!X.has(ue.unit.id))if(De.isSubset(X.get(ue.unit.id),ue.indices))me=!0;else return!1}return me}e.isSubset=y;function b(G){return G.length>3&&Le.isRange(G)?Se.ofRange(G[0],G[G.length-1]):Le.ofSortedArray(G)}function x(G,H){for(var X=[],Y=new Set,oe=0,ue=G.elements;oe<ue.length;oe++){var me=ue[oe];if(_(me)){X[X.length]=me;continue}if(me.unit.kind===0){for(var he=me.unit.elements,Pe=me.unit.model.atomicHierarchy,re=me.unit.model.atomicHierarchy.atoms.label_alt_id,ee=Pe.residueAtomSegments,B=ee.index,z=ee.offsets,le=[],pe=me.indices,ge=De.size(pe),Ce=0;Ce<ge;){Y.clear();var Ie=he[De.getAt(pe,Ce)],Oe=B[Ie];for(Y.add(re.value(Ie)),Ce++;Ce<ge;){var We=he[De.getAt(pe,Ce)];if(B[We]!==Oe)break;Y.add(re.value(We)),Ce++}for(var Ne=Y.has(""),Ye=z[Oe],Xe=z[Oe+1];Ye<Xe;Ye++){var Ze=De.indexOf(he,Ye);if(Ze>=0){var Ke=re.value(Ye);(!H||Ne||!Ke||Y.has(Ke))&&(le[le.length]=Ze)}}}X[X.length]={unit:me.unit,indices:b(le)}}else X[X.length]=me}return e(G.structure,X)}e.extendToWholeResidues=x;function C(G){switch(G.kind){case 0:return G.model.atomicHierarchy.chainAtomSegments;case 1:return G.model.coarseHierarchy.spheres.chainElementSegments;case 2:return G.model.coarseHierarchy.gaussians.chainElementSegments}}function _(G){return G.unit.elements.length===De.size(G.indices)}function w(G,H,X){for(var Y=C(G).index,oe=G.elements,ue=0,me=0,he=oe.length;me<he;me++){var Pe=oe[me],re=Y[Pe];!H.has(re)||ue++}if(ue===G.elements.length){X[X.length]={unit:G,indices:Se.ofBounds(0,ue)};return}var ee=new Int32Array(ue);ue=0;for(var me=0,he=oe.length;me<he;me++){var Pe=oe[me],re=Y[Pe];!H.has(re)||(ee[ue++]=me)}ee.length>0&&(X[X.length]={unit:G,indices:b(ee)})}function T(G,H,X,Y,oe){for(var ue=C(G.elements[0].unit).index,me=new Set,he=H;he<X;he++)for(var Pe=G.elements[he],re=Pe.indices,ee=Pe.unit.elements,B=0,z=De.size(re);B<z;B++)me.add(ue[ee[De.getAt(re,B)]]);if(Y)for(var le=G.elements[0].unit,pe=0,ge=G.structure.units;pe<ge.length;pe++){var Ce=ge[pe];!Re.areSameChainOperatorGroup(Ce,le)||w(Ce,me,oe)}else for(var he=H;he<X;he++)w(G.elements[he].unit,me,oe)}function A(G){for(var H=[],X=0,Y=G.elements.length;X<Y;X++){var oe=G.elements[X];if(Re.Traits.is(oe.unit.traits,2)){for(var ue=X;X<Y&&Re.areSameChainOperatorGroup(G.elements[X].unit,oe.unit);)X++;var me=X;X--,T(G,ue,me,!0,H)}else _(oe)?H[H.length]=oe:T(G,X,X+1,!1,H)}return e(G.structure,H)}e.extendToWholeChains=A;function D(G){return"".concat(G.unit.model.id,"|").concat(ft.entity.id(G))}function E(G){for(var H=[],X=Qe.create(G.structure),Y=new Set,oe=G.structure.units,ue=0,me=G.elements.length;ue<me;ue++){var he=G.elements[ue];X.unit=he.unit,X.element=he.unit.elements[0],Y.add(D(X))}for(var ue=0,Pe=oe.length;ue<Pe;++ue){var re=oe[ue];if(X.unit=re,X.element=re.elements[0],Y.has(D(X))){var ee=De.ofBounds(0,re.elements.length);H[H.length]={unit:re,indices:ee}}}return e(G.structure,H)}e.extendToWholeEntities=E;function M(G){for(var H=[],X=new Set,Y=G.structure.units,oe=0,ue=G.elements.length;oe<ue;oe++){var me=G.elements[oe];X.add(me.unit.model.id)}for(var oe=0,he=Y.length;oe<he;++oe){var Pe=Y[oe];if(X.has(Pe.model.id)){var re=De.ofBounds(0,Pe.elements.length);H[H.length]={unit:Pe,indices:re}}}return e(G.structure,H)}e.extendToWholeModels=M;function F(G,H){for(var X=[],Y=0,oe=De.size(H);Y<oe;++Y)X.push(G[De.getAt(H,Y)]);return Le.ofSortedArray(X)}function O(G,H){return Le.isRange(G)&&Le.areEqual(G,H)?Se.ofLength(G.length):b(Le.indicesOf(G,H))}function U(G){for(var H=[],X=new Map,Y=0,oe=G.elements.length;Y<oe;Y++){var ue=G.elements[Y],me=ue.unit.model,he=F(ue.unit.elements,ue.indices);X.has(me)?X.set(me,Le.union(he,X.get(me))):X.set(me,he)}for(var Y=0,Pe=G.structure.units.length;Y<Pe;++Y){var re=G.structure.units[Y],he=X.get(re.model);if(!!he){var ee=O(re.elements,he);De.size(ee)&&(H[H.length]={unit:re,indices:ee})}}return e(G.structure,H)}e.extendToAllInstances=U;function N(G){for(var H=[],X=new Set,Y=G.structure.units,oe=0,ue=G.elements.length;oe<ue;oe++){var me=G.elements[oe];X.add(me.unit.conformation.operator.name)}for(var oe=0,he=Y.length;oe<he;++oe){var Pe=Y[oe];if(X.has(Pe.conformation.operator.name)){var re=De.ofBounds(0,Pe.elements.length);H[H.length]={unit:Pe,indices:re}}}return e(G.structure,H)}e.extendToWholeOperators=N;var q=new Ji("98"),j=S();function Q(G,H){q.reset();for(var X=0,Y=G.elements;X<Y.length;X++)for(var oe=Y[X],ue=oe.indices,me=oe.unit.conformation.position,he=oe.unit.conformation.r,Pe=oe.unit.elements,re=0,ee=De.size(ue);re<ee;re++){var B=Pe[De.getAt(ue,re)];me(B,j),H&&S.transformMat4(j,j,H),q.includePositionRadius(j,he(B))}q.finishedIncludeStep();for(var z=0,le=G.elements;z<le.length;z++)for(var oe=le[z],ue=oe.indices,me=oe.unit.conformation.position,he=oe.unit.conformation.r,Pe=oe.unit.elements,re=0,ee=De.size(ue);re<ee;re++){var B=Pe[De.getAt(ue,re)];me(B,j),H&&S.transformMat4(j,j,H),q.radiusPositionRadius(j,he(B))}return{box:q.getBox(),sphere:q.getSphere()}}e.getBoundary=Q;var J=S();function te(G,H,X){X===void 0&&(X=0);for(var Y=X,oe=0,ue=G.elements;oe<ue.length;oe++){for(var me=ue[oe],he=me.indices,Pe=me.unit.conformation.position,re=me.unit.elements,ee=De.size(he),B=0;B<ee;B++){var z=re[De.getAt(he,B)];Pe(z,J),S.toArray(J,H,Y+B*3)}Y+=ee*3}return H}e.toPositionsArray=te;function K(G){var H=i(G),X=te(G,new Float32Array(3*H));return _l.ofPositions(X)}e.getPrincipalAxes=K;function L(G){var H=0;G.forEach(function(oe){H+=i(oe)});var X=new Float32Array(3*H),Y=0;return G.forEach(function(oe){te(oe,X,Y),Y+=i(oe)*3}),_l.ofPositions(X)}e.getPrincipalAxesMany=L;function W(G,H){return Re.isAtomic(G)?G.model.atomicHierarchy.atomSourceIndex.value(H):H}function k(G){var H;if(e.isEmpty(G))return ne.struct.generator.empty();for(var X=G.structure.models,Y=new Map,oe=0,ue=G.elements;oe<ue.length;oe++){var me=ue[oe],he=me.indices,Pe=me.unit.elements,re=me.unit.conformation.operator.name,ee=void 0;Y.has(re)?ee=Y.get(re).xs:(ee=Br.create(),Y.set(re,{modelLabel:me.unit.model.label,modelIndex:me.unit.model.modelNum,xs:ee}));for(var B=0,z=De.size(he);B<z;B++){var le=W(me.unit,Pe[De.getAt(he,B)]);Br.add(ee,le,le)}}for(var pe=[],ge=Y.keys();;){var Ce=ge.next();if(Ce.done)break;var me=Y.get(Ce.value);pe.push(V(Ce.value,me.xs.array,X.length>1,me.modelLabel,me.modelIndex))}for(var Ie=new Map,B=0,Oe=pe.length;B<Oe;++B){var We=pe[B],Ne=If(Wa(We.atom.ranges),Wa(We.atom.set)),re="".concat(Ne,"|").concat(We.entity?We.entity.modelLabel+We.entity.modelIndex:"");Ie.has(re)?(H=Ie.get(re).chain.opName).push.apply(H,We.chain.opName):Ie.set(re,We)}var Ye=[];return Ie.forEach(function(Xe){var Ze=Xe.atom,Ke=Ze.ranges,ht=Ze.set,Ae=Xe.chain.opName,we=ne.struct.atomProperty.core.operatorName(),Ve=ne.struct.atomProperty.core.sourceIndex(),rt=[];ht.length>0&&(rt[rt.length]=ne.core.set.has([ne.core.type.set(ht),Ve]));for(var ut=0,Ue=Ke.length/2;ut<Ue;ut++)rt[rt.length]=ne.core.rel.inRange([Ve,Ke[2*ut],Ke[2*ut+1]]);if(Xe.entity){var pt=Xe.entity,mt=pt.modelLabel,wt=pt.modelIndex;Ye.push(ne.struct.generator.atomGroups({"atom-test":rt.length>1?ne.core.logic.or(rt):rt[0],"chain-test":Ae.length>1?ne.core.set.has([ne.core.type.set(Ae),we]):ne.core.rel.eq([we,Ae[0]]),"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.struct.atomProperty.core.modelLabel(),mt]),ne.core.rel.eq([ne.struct.atomProperty.core.modelIndex(),wt])])}))}else Ye.push(ne.struct.generator.atomGroups({"atom-test":rt.length>1?ne.core.logic.or(rt):rt[0],"chain-test":Ae.length>1?ne.core.set.has([ne.core.type.set(Ae),we]):ne.core.rel.eq([we,Ae[0]])}))}),ne.struct.modifier.union([Ye.length===1?Ye[0]:ne.struct.combinator.merge(Ye.map(function(Xe){return ne.struct.modifier.union([Xe])}))])}e.toExpression=k;function V(G,H,X,Y,oe){vs(H);for(var ue=[],me=[],he=0,Pe=H.length;he<Pe;){var re=he;for(he++;he<Pe&&H[he-1]+1===H[he];)he++;var ee=he;if(ee-re>12)ue[ue.length]=H[re],ue[ue.length]=H[ee-1];else for(var B=re;B<ee;B++)me[me.length]=H[B]}return X?{atom:{set:me,ranges:ue},chain:{opName:[G]},entity:{modelLabel:Y,modelIndex:oe}}:{atom:{set:me,ranges:ue},chain:{opName:[G]}}}})(_e||(_e={}));var lu;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Qe.create(void 0),firstConformationLoc:Qe.create(void 0),firstResidueLoc:Qe.create(void 0),firstChainLoc:Qe.create(void 0),firstUnitLoc:Qe.create(void 0),firstStructureLoc:Qe.create(void 0)}}e.create=t;function r(u,c,l){var f=u.get(c)||0;u.set(c,f+l)}function n(u,c,l){var f=l.indices,d=l.unit,m=d.elements,p=De.size(f),v=new Map,h=new Map;if(p>0&&Qe.set(u.firstElementLoc,c,d,m[De.start(f)]),p===m.length)u.unitCount+=1,u.unitCount===1&&Qe.set(u.firstUnitLoc,c,d,m[De.start(f)]);else if(p===1){if(Re.Traits.is(d.traits,1))return;u.elementCount+=1,u.elementCount===1&&Qe.set(u.firstElementLoc,c,d,m[De.start(f)])}else if(Re.isAtomic(d))for(var g=d.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,x=d.model.atomicHierarchy.atoms.label_alt_id,C=0,_=function(){v.clear();var w=0,T=m[De.getAt(f,C)],A=y[T];for(r(v,x.value(T),1),++C,++w;C<p;){var D=m[De.getAt(f,C)];if(y[D]!==A)break;r(v,x.value(D),1),++C,++w}if(b[A+1]-b[A]===w)u.residueCount+=1,u.residueCount===1&&Qe.set(u.firstResidueLoc,c,d,b[A]);else{h.clear();for(var E=b[A],M=b[A+1];E<M;++E)r(h,x.value(E),1);h.get("")===v.get("")&&v.forEach(function(F,O){if(h.get(O)===F){if(O!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var U=b[A],N=b[A+1];U<N;++U)if(O===x.value(U)){Qe.set(u.firstConformationLoc,c,d,U);break}}w-=F}}),u.elementCount+=w}};C<p;)_();else u.elementCount+=p,u.elementCount===1&&Qe.set(u.firstElementLoc,c,d,m[De.start(f)])}function a(u,c,l){var f=l.indices,d=l.unit,m=De.size(f);if(m!==0){var p=d.elements;if(!Re.Traits.is(d.traits,1)){m===p.length&&(u.chainCount+=1,u.chainCount===1&&Qe.set(u.firstChainLoc,c,d,p[De.start(f)]));return}var v=Re.isAtomic(d)?d.model.atomicHierarchy.chainAtomSegments:Re.isSpheres(d)?d.model.coarseHierarchy.spheres.chainElementSegments:Re.isGaussians(d)?d.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var h=v.index,g=v.offsets,y=0;y<m;){var b=0,x=p[De.getAt(f,y)],C=h[x];for(++y,++b;y<m;){var _=p[De.getAt(f,y)];if(h[_]!==C)break;++y,++b}g[C+1]-g[C]===b?(u.chainCount+=1,u.chainCount===1&&Qe.set(u.firstChainLoc,c,d,g[C])):m===1&&(u.elementCount+=1,u.elementCount===1&&Qe.set(u.firstElementLoc,c,d,x))}}}function i(u,c,l,f,d){var m=l[f],p=Re.isAtomic(m.unit)?m.unit.model.atomicHierarchy.chainAtomSegments:Re.isSpheres(m.unit)?m.unit.model.coarseHierarchy.spheres.chainElementSegments:Re.isGaussians(m.unit)?m.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!p){console.warn("StructureElement loci stats: unknown unit type");return}for(var v=p.index,h=p.offsets,g=new Map,y=f;y<d;y++){m=l[y];var b=m.indices,x=m.unit,C=De.size(b);if(C!==0){var _=x.elements;if(!Re.Traits.is(x.traits,1)){var w=_[De.start(b)];r(g,v[w],_.length);continue}for(var T=0;T<C;){var A=0,w=_[De.getAt(b,T)],D=v[w];for(++T,++A;T<C;){var E=_[De.getAt(b,T)];if(v[E]!==D)break;++T,++A}r(g,D,A)}}}var M=-1;if(g.forEach(function(F,O){h[O+1]-h[O]===F&&(u.chainCount+=1,u.chainCount===1&&(M=O))}),!(M<0))for(var y=f;y<d;y++){m=l[y];var b=m.indices,x=m.unit,C=De.size(b);if(C!==0)for(var _=x.elements,T=0;T<C;){var w=_[De.getAt(b,T)],D=v[w];if(D===M){Qe.set(u.firstChainLoc,c,x,w);return}}}}function o(u){var c=t();if(_e.isEmpty(u))return c;var l=!1;if(_e.isWholeStructure(u)){if(c.structureCount+=1,c.structureCount===1){var f=u.elements[0],d=f.unit,m=f.indices;Qe.set(c.firstStructureLoc,u.structure,d,d.elements[De.min(m)])}}else for(var p=0,v=u.elements;p<v.length;p++){var h=v[p];n(c,u.structure,h),Re.Traits.is(h.unit.traits,2)?l=!0:a(c,u.structure,h)}if(l)for(var g=0,y=u.elements.length;g<y;g++){var h=u.elements[g];if(!!Re.Traits.is(h.unit.traits,2)){for(var b=g;g<y&&Re.areSameChainOperatorGroup(u.elements[g].unit,h.unit);)g++;var x=g;g--,x-b==1?a(c,u.structure,h):i(c,u.structure,u.elements,b,x)}}return c}e.ofLoci=o;function s(u,c,l){return c.elementCount===1&&l.elementCount===0?Qe.copy(u.firstElementLoc,c.firstElementLoc):c.elementCount===0&&l.elementCount===1&&Qe.copy(u.firstElementLoc,l.firstElementLoc),c.conformationCount===1&&l.conformationCount===0?Qe.copy(u.firstConformationLoc,c.firstConformationLoc):c.conformationCount===0&&l.conformationCount===1&&Qe.copy(u.firstConformationLoc,l.firstConformationLoc),c.residueCount===1&&l.residueCount===0?Qe.copy(u.firstResidueLoc,c.firstResidueLoc):c.residueCount===0&&l.residueCount===1&&Qe.copy(u.firstResidueLoc,l.firstResidueLoc),c.chainCount===1&&l.chainCount===0?Qe.copy(u.firstChainLoc,c.firstChainLoc):c.chainCount===0&&l.chainCount===1&&Qe.copy(u.firstChainLoc,l.firstChainLoc),c.unitCount===1&&l.unitCount===0?Qe.copy(u.firstUnitLoc,c.firstUnitLoc):c.unitCount===0&&l.unitCount===1&&Qe.copy(u.firstUnitLoc,l.firstUnitLoc),c.structureCount===1&&l.structureCount===0?Qe.copy(u.firstStructureLoc,c.firstStructureLoc):c.structureCount===0&&l.structureCount===1&&Qe.copy(u.firstStructureLoc,l.firstStructureLoc),u.elementCount=c.elementCount+l.elementCount,u.conformationCount=c.conformationCount+l.conformationCount,u.residueCount=c.residueCount+l.residueCount,u.chainCount=c.chainCount+l.chainCount,u.unitCount=c.unitCount+l.unitCount,u.structureCount=c.structureCount+l.structureCount,u}e.add=s})(lu||(lu={}));function Uue(e){return Re.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function zue(e){return Re.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function Vue(e){return ft.entity.key(e)}Zn.Field;Zn.Encodings;Zn.Field;Zn.Category;Zn.Category;var Gue={molstar_atom_site_operator_mapping:{label_asym_id:ce.Schema.Str(),auth_asym_id:ce.Schema.Str(),operator_name:ce.Schema.Str(),suffix:ce.Schema.Str(),assembly_id:ce.Schema.Str(),assembly_operator_id:ce.Schema.Int(),symmetry_operator_index:ce.Schema.Int(),symmetry_hkl:ce.Schema.Vector(3),ncs_id:ce.Schema.Int()}},N6=function(e,t){return typeof t[e].operator.assembly=="undefined"?1:0},Dw=function(e,t){return t[e].operator.spgrOp===-1?1:0};Zn.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:N6}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:N6}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:Dw}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:Dw}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:Dw}).getFields();Zn.Category;var U6;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(U6||(U6={}));var z6;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(z6||(z6={}));var V6;(function(e){function t(f,d,m){if(!d)return{rowCount:0};if(m&&m[d.id])return m[d.id];var p=d.getElements(f),v={data:p,rowCount:p.elements.length};return m&&(m[d.id]=v),v}e.getCifDataSource=t;function r(f){return new G6(f)}e.fromAtomMap=r;function n(f){return new G6(Mw(f))}e.fromAtomArray=n;var a=function(f){return f.atomicHierarchy.residueAtomSegments};function i(f){return new K1("residue",f,a,0)}e.fromResidueMap=i;function o(f){return new K1("residue",Mw(f),a,0)}e.fromResidueArray=o;var s=function(f){return f.atomicHierarchy.chainAtomSegments};function u(f){return new K1("chain",f,s,0)}e.fromChainMap=u;function c(f){return new K1("chain",Mw(f),s,0)}e.fromChainArray=c;function l(f){return new Hue(f)}e.fromEntityMap=l})(V6||(V6={}));function Mw(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var K1=function(){function e(t,r,n,a){this.level=t,this.map=r,this.segmentGetter=n,this.id=zr.create22(),this.kind=a}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=this.segmentGetter(r[0]),s=0,u=a;s<u.length;s++){var c=u[s],l=c.units[0];if(l.kind===this.kind)for(var f=qt.transientSegments(o,l.elements);f.hasNext;){var d=f.move();!this.has(d.index)||n.has(d.index)||(n.add(d.index),i[i.length]=Qe.create(t,l,l.elements[d.start]))}}return i.sort(function(m,p){return m.element-p.element}),i},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,a=this.getStructureElements(t);return{elements:a,property:function(i){return r.get(n[a[i].element])}}},e}(),G6=function(){function e(t){this.map=t,this.id=zr.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=t.unitSymmetryGroups,i=[],o=0,s=a;o<s.length;o++){var u=s[o],c=u.units[0];if(c.kind===this.kind)for(var l=c.elements,f=0,d=l.length;f<d;f++){var m=l[f];!this.has(m)||n.has(m)||(n.add(l[f]),i[i.length]=Qe.create(t,c,m))}}return i.sort(function(p,v){return p.element-v.element}),i},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(a){return r.get(n[a].element)}}},e}(),Hue=function(){function e(t){this.map=t,this.id=zr.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,a=new Set,i=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,c=i;u<c.length;u++){var l=c[u],f=l.units[0];if(f.kind===this.kind)for(var d=qt.transientSegments(s,f.elements);d.hasNext;){var m=d.move(),p=n.getEntityFromChain(m.index);!this.has(p)||a.has(p)||(a.add(p),o[o.length]=Qe.create(t,f,f.elements[m.start]))}}return o.sort(function(v,h){return v.element-h.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),a=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(i.getEntityFromChain(a[n[o].element]))}}},e}(),ud=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function que(e,t,r){if(!e._rowCount)return[];for(var n=Xue(r),a=[],i=0;i<e._rowCount;i++)a[a.length]=jue(e,t,i,n);return a}function jue(e,t,r,n){for(var a=e.id.value(r),i=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,c=t.asym_id_list,l=0,f=t._rowCount;l<f;l++)s.value(l)===a&&(o[o.length]={assemblyId:a,expression:u.value(l),asymIds:c.value(l)});return sw.create(a,i,Wue(o,n))}function Wue(e,t){return function(){for(var r=[],n=0,a=0;a<e.length;a++){var i=e[a],o=Que(i.expression),s=Yue(o),u=Kue(t,s,n,i.assemblyId),c=Fr.generators.atoms({chainTest:Fr.pred.and(Fr.pred.eq(function(l){return ft.unit.operator_name(l.element)},jr.DefaultName),Fr.pred.inSet(function(l){return ft.chain.label_asym_id(l.element)},i.asymIds))});r[r.length]={selector:c,operators:u},n+=u.length}return r}}function Xue(e){for(var t=e.id,r=e.matrix,n=e.vector,a=e._schema,i=new Map,o=0,s=e._rowCount;o<s;o++){var u=sr.toMat4(se(),a.matrix.space,r.value(o)),c=sr.toVec3(S(),a.vector.space,n.value(o));se.setTranslation(u,c),se.setValue(u,3,3,1),i.set(t.value(o),u)}return i}function Yue(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return H6(e,t,e.length-1,r),t}function H6(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var a=e[r],i=a.length,o=0;o<i;o++)n[r]=a[o],H6(e,t,r-1,n)}function Kue(e,t,r,n){for(var a=[],i=r,o=0,s=t;o<s.length;o++){for(var u=s[o],c=se.identity(),l=0;l<u.length;l++)se.mul(c,c,e.get(u[l]));i++,a[a.length]=jr.create("ASM_".concat(i),c,{assembly:{id:n,operId:i,operList:u}})}return a}function Que(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],a;a=t.exec(e);)r[r.length]=a[1];return r.forEach(function(i){var o=[];i.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var c=parseInt(s.substring(0,u)),l=parseInt(s.substr(u+1)),f=c;f<=l;f++)o[o.length]=f.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var _n;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=_s.create(e.Descriptor);function t(n){var a=que(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=Jue(n.symmetry,n.cell),o=Zue(n.atom_sites);return{assemblies:a,spacegroup:i,isNonStandardCrystalFrame:o,ncsOperators:ece(n.struct_ncs_oper)}}e.fromData=t;function r(n,a){var i=pi.create("P 1",n,a),o=Mo.create(i);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(_n||(_n={}));function Zue(e,t){return e._rowCount===0,!1}function $ue(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function Jue(e,t){if(e._rowCount===0||t._rowCount===0)return Mo.ZeroP1;var r=$ue(e),n=pi.create(r,S.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),S.scale(S.zero(),S.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return Mo.create(n)}function ece(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,a=Jt.struct_ncs_oper.matrix.space,i=Jt.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=sr.toMat3(dn(),a,r.value(s)),c=sr.toVec3(S(),i,n.value(s));if(!!jr.checkIfRotationAndTranslation(u,c)&&!(e.code.value(s)==="given"&&!dn.isIdentity(u)&&!S.isZero(c))){var l=t.value(s);o[o.length]=jr.ofRotationAndOffset("ncs_".concat(l),u,c,l)}}return o}}var tce={U:Jt.atom_site_anisotrop.U,U_esd:Jt.atom_site_anisotrop.U_esd},fu;(function(e){e.Schema=tce,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var a=e.Provider.get(n.firstModel);return!a||!Or.is(n.firstModel.sourceData)?Zn.Category.Empty:Zn.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=_s.create(e.Descriptor);function t(n,a){var i=new Int32Array(n.rowCount);i.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];c!==-1&&(u[c]=o)}return u}e.getElementToAnsiotrop=t;function r(n,a){for(var i={},o=0,s=n.rowCount;o<s;o++)i[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=a.rowCount;o<s;++o){var c=i[a.value(o)];c!==void 0&&(u[c]=o)}return u}e.getElementToAnsiotropFromLabel=r})(fu||(fu={}));var cd;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ce.Schema.Matrix(4,4,ce.Schema.float)},t),e.Descriptor=to({name:r,cifExport:{categories:[{name:r,instance:function(u){var c=a(u.firstModel);if(!c)return Zn.Category.Empty;var l=Ar.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Zn.Category.ofTable(l)}}],prefix:"molstar"}}),e.Provider=_s.create(e.Descriptor);function n(u,c){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,c)}e.attach=n;function a(u){return e.Provider.get(u)}e.get=a;function i(u){if(!!Or.is(u.sourceData)){var c=u.sourceData.data.frame.categories[r];if(!!c){var l=lK(e.Schema[r],c);if(l._rowCount!==0)return l.matrix.value(0)}}}e.fromMmCif=i;function o(u){if(!Or.is(u.sourceData))return!1;var c=u.sourceData.data.frame.categories[r];return!!c&&c.rowCount>0}e.hasData=o;function s(u,c){u.writeCategory({name:r,instance:function(){var l=Ar.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:c}]);return Zn.Category.ofTable(l)}})}e.writeMmCif=s})(cd||(cd={}));function rce(e){if(!!Or.is(e.sourceData))return _n.fromData(e.sourceData.data.db)}_n.Provider.formatRegistry.add("mmCIF",rce);function nce(e){if(!!Or.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return Gh.fromStruct(r,n,e.atomicHierarchy)}}Gh.Provider.formatRegistry.add("mmCIF",nce);function ace(e){if(!!Or.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=Ar.ofColumns(fu.Schema,t),n=fu.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function ice(e){return Or.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}fu.Provider.formatRegistry.add("mmCIF",ace,ice);function oce(e){if(!!Or.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:Nh.getEntriesFromChemCompBond(t)}}}Nh.Provider.formatRegistry.add("mmCIF",oce);function sce(e){if(!!Or.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=uu.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:uu.getAtomIndexFromEntries(r),entries:r}}}}uu.Provider.formatRegistry.add("mmCIF",sce);cd.Provider.formatRegistry.add("mmCIF",cd.fromMmCif,cd.hasData);var Or;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,a,i){return a||(a=zu.schema.mmCIF(n)),{kind:"mmCIF",name:a._name,data:{db:a,frame:n,source:i}}}e.fromFrame=r})(Or||(Or={}));function q6(e){var t=Or.fromFrame(e);return Be.create("Create mmCIF Model",function(r){return dc(t.data.db,t,r)})}var up;(function(e){function t(n){var a=this,i=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(c){return i in c[o]||(c[o][i]={props:I({},P.getDefaultValues(n.getParams(c))),data:el.create(void 0)}),c[o][i]},u=function(c,l,f){var d=s(c);c[o][i]={props:l,data:el.withValue(d.data,f)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(c){var l=P.clone(n.getParams(c));return P.setDefaultValues(l,s(c).props),l},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(c,l,f,d){return f===void 0&&(f={}),ie(a,void 0,void 0,function(){var m,p,v,h,g;return ae(this,function(y){switch(y.label){case 0:return d&&l.customProperties.reference(n.descriptor,!0),m=s(l),p=P.merge(n.defaultParams,m.props,f),m.data.value&&P.areEqual(n.defaultParams,m.props,p)?[2]:[4,n.obtain(c,l,p)];case 1:return v=y.sent(),h=v.value,g=v.assets,l.customProperties.add(n.descriptor),l.customProperties.assets(n.descriptor,g),u(l,p,h),[2]}})})},ref:function(c,l){return c.customProperties.reference(n.descriptor,l)},get:function(c){var l;return(l=s(c))===null||l===void 0?void 0:l.data},set:function(c,l){l===void 0&&(l={});var f=s(c),d=P.merge(n.defaultParams,f.props,l);P.areEqual(n.defaultParams,f.props,d)||(u(c,d,void 0),c.customProperties.assets(n.descriptor))},props:function(c){return s(c).props}}}e.createProvider=t;function r(n,a,i){var o=this,s={value:P.Value(i,{isHidden:!0})};return t({label:Ao(n),descriptor:to({name:n}),isHidden:!0,type:a,defaultParams:s,getParams:function(){return{value:P.Value(i,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,c,l){return ie(o,void 0,void 0,function(){var f;return ae(this,function(d){return[2,{value:(f=l.value)!==null&&f!==void 0?f:i}]})})}})}e.createSimple=r})(up||(up={}));var jt;(function(e){function t(N,q){for(var j=[],Q=q.frames,J=N.atomicHierarchy.atomSourceIndex,te=ce.isIdentity(J),K=te?void 0:J.toArray({array:Int32Array}),L=0,W=Q.length;L<W;++L){var k=Q[L],V=I(I({},N),{id:zr.create22(),modelNum:L,atomicConformation:Eh.getAtomicConformation(k,N.atomicConformation.atomId,K),customProperties:new Js,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(k.cell){var G=_n.fromCell(k.cell.size,k.cell.anglesInRadians);_n.Provider.set(V,G)}e.TrajectoryInfo.set(V,{index:L,size:Q.length}),j.push(V)}return{trajectory:j,srcIndexArray:K}}function r(N,q){return new ud(t(N,q).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(N,q){var j=this;return Be.create("Create Trajectory",function(Q){return ie(j,void 0,void 0,function(){var J,te,K,L,W,k,V,G,H;return ae(this,function(X){switch(X.label){case 0:return[4,dc(N.basic,N.sourceData,Q)];case 1:if(J=X.sent(),J.frameCount===0)throw new Error("found no model");for(te=J.representative,K=t(te,q).trajectory,L={pairs:N.bonds,count:te.atomicHierarchy.atoms._rowCount},W=La.fromData(L),k=0,V=0,G=K;V<G.length;V++)H=G[V],La.Provider.set(H,W),e.TrajectoryInfo.set(H,{index:k++,size:K.length});return[2,new ud(K)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var a="__Center__";function i(N){if(N._dynamicPropertyData[a])return N._dynamicPropertyData[a];var q=wae(N.atomicConformation,N.coarseConformation);return N._dynamicPropertyData[a]=q,q}e.getCenter=i;function o(N){for(var q=new Int32Array(N.rowCount),j=!1,Q=0,J=N.rowCount;Q<J;Q++){var te=N.value(Q);te!==Q&&(j=!1),q[te]=Q}return{isIdentity:j,invertedIndex:q}}var s="__InvertedAtomSrcIndex__";function u(N){if(N._staticPropertyData[s])return N._staticPropertyData[s];var q=o(N.atomicHierarchy.atomSourceIndex);return N._staticPropertyData[s]=q,q}e.getInvertedAtomSourceIndex=u;var c="__TrajectoryInfo__";e.TrajectoryInfo={get:function(N){return N._dynamicPropertyData[c]||{index:0,size:1}},set:function(N,q){return N._dynamicPropertyData[c]=q}};var l="__AsymIdCount__";e.AsymIdCount={get:function(N){if(N._dynamicPropertyData[l])return N._dynamicPropertyData[l];var q=Aae(N);return N._dynamicPropertyData[l]=q,q}},e.AsymIdOffset=up.createSimple("asym_id_offset","static"),e.Index=up.createSimple("index","static");function f(N){return N.parent||N}e.getRoot=f;function d(N,q){return N.atomicHierarchy===q.atomicHierarchy&&N.coarseHierarchy===q.coarseHierarchy}e.areHierarchiesEqual=d;var m="__CoordinatesHistory__";e.CoordinatesHistory={get:function(N){return N._staticPropertyData[m]},set:function(N,q){return N._staticPropertyData[m]=q}};var p="__CoarseGrained__";function v(N){if(N._staticPropertyData[p]!==void 0)return N._staticPropertyData[p];for(var q=0,j=N.atomicHierarchy.derived.residue.polymerType,Q=0;Q<j.length;++Q)j[Q]!==0&&(q+=1);for(var J=!1,te=!1,K=N.atomicHierarchy.atoms,L=K.label_atom_id,W=K._rowCount,Q=0;Q<W;++Q){var k=L.value(Q);if(!J&&k==="BB"&&(J=!0),!te&&k==="SC1"&&(te=!0),J&&te)break}var V=J&&te||(q&&W?W/q<3:!1);return N._staticPropertyData[p]=V,V}e.isCoarseGrained=v;function h(N){return N.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=h;function g(N){for(var q=N.entities.subtype,j=0,Q=q.rowCount;j<Q;++j)if(q.value(j).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(N){for(var q=N.entities.subtype,j=0,Q=q.rowCount;j<Q;++j){var J=q.value(j);if(J.endsWith("ribonucleotide hybrid")||J.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(N){if(!Or.is(N.sourceData))return!1;for(var q=N.sourceData.data.db,j=0,Q=q.database_2.database_id.rowCount;j<Q;++j)if(q.database_2.database_id.value(j)==="PDB")return!0;return!1}e.isFromPdbArchive=b;function x(N){return Or.is(N.sourceData)?N.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||N.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}e.hasPdbId=x;function C(N){if(!Or.is(N.sourceData))return!1;var q=N.sourceData.data.db;return q.struct_conf.id.isDefined||q.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=C;var _=S.create(1.5707963,1.5707963,1.5707963),w=S.create(1,1,1);function T(N){var q,j=(q=_n.Provider.get(N))===null||q===void 0?void 0:q.spacegroup;return!!j&&!(j.num===1&&S.equals(j.cell.anglesInRadians,_)&&S.equals(j.cell.size,w))}e.hasCrystalSymmetry=T;function A(N){if(!Or.is(N.sourceData))return!1;for(var q=N.sourceData.data.db,j=0;j<q.exptl.method.rowCount;j++){var Q=q.exptl.method.value(j).toUpperCase();if(Q.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=A;function D(N){if(!Or.is(N.sourceData))return!1;for(var q=N.sourceData.data.db,j=0;j<q.exptl.method.rowCount;j++){var Q=q.exptl.method.value(j).toUpperCase();if(Q.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=D;function E(N){if(!Or.is(N.sourceData))return!1;for(var q=N.sourceData.data.db,j=0;j<q.exptl.method.rowCount;j++){var Q=q.exptl.method.value(j).toUpperCase();if(Q.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=E;function M(N){if(!Or.is(N.sourceData)||!A(N))return!1;var q=N.sourceData.data.db,j=q.pdbx_database_status.status_code_sf;return j.isDefined&&j.value(0)==="REL"}e.hasXrayMap=M;function F(N){if(!Or.is(N.sourceData))return!1;for(var q=N.sourceData.data.db,j=q.pdbx_database_related,Q=j.db_name,J=j.content_type,te=0,K=q.pdbx_database_related._rowCount;te<K;++te)if(Q.value(te).toUpperCase()==="EMDB"&&J.value(te)==="associated EM volume")return!0;return!1}e.hasEmMap=F;function O(N){return Or.is(N.sourceData)?M(N)||F(N):!1}e.hasDensityMap=O;function U(N){if(!Or.is(N.sourceData))return!1;var q=N.sourceData.data.db;return O(N)||x(N)&&(!q.exptl.method.isDefined||A(N)&&(!q.pdbx_database_status.status_code_sf.isDefined||q.pdbx_database_status.status_code_sf.valueKind(0)===2)||D(N)&&!q.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=U})(jt||(jt={}));function uce(e,t,r,n){for(var a=e.atoms,i=a.label_comp_id,o=a.type_symbol,s=a._rowCount,u=e.residues._rowCount,c=t.residueAtomSegments.offsets,l=new Uint8Array(s),f=0;f<s;++f)l[f]=Vh(o.value(f));for(var d=new Int32Array(u),m=new Int32Array(u),p=new Int32Array(u),v=new Uint8Array(u),h=new Uint8Array(u),g=new Map,y=new Map,f=0;f<u;++f){var b=i.value(c[f]),x=n,C=void 0,_=void 0;if(g.has(b))C=g.get(b),_=y.get(b);else{var w=void 0;x.has(b)?w=x.get(b).type:(ih||console.info("chemComp not found",b),w=AO(b)),C=ip(w,b),_=pae(w,C),g.set(b,C),y.set(b,_)}v[f]=C,h[f]=_;var T=Bl(_,"trace"),A=r.findAtomsOnResidue(f,T);if(A===-1){var D=Bl(_,"coarseBackbone");A=r.findAtomsOnResidue(f,D),A===-1&&D1(C)&&(A=r.findElementOnResidue(f,rd("C")))}d[f]=A;var E=Bl(_,"directionFrom");m[f]=r.findAtomsOnResidue(f,E);var M=Bl(_,"directionTo");p[f]=r.findAtomsOnResidue(f,M)}return{atom:{atomicNumber:l},residue:{traceElementIndex:d,directionFromElementIndex:m,directionToElementIndex:p,moleculeType:v,polymerType:h}}}function Wh(e,t){return t?t.length===1?To(t.charCodeAt(0),e):t.length===2?To(t.charCodeAt(0),To(t.charCodeAt(1),e)):"".concat(e," ").concat(t):e}function cce(e,t,r,n){if(e.has(t)){var a=e.get(t);a.has(r)||a.set(r,n)}else{var a=new Map;e.set(t,a),a.set(r,n)}}function lce(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function fce(e,t,r){return{entities:e,segments:r,label_seq_id:Le.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var Xh=Aw.EmptyResidueKey(),dce=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,a){var i;arguments.length===1?i=t:(Xh.label_entity_id=t,Xh.label_asym_id=r,Xh.auth_seq_id=n,Xh.pdbx_PDB_ins_code=a,i=Xh);var o=this.findChainLabel(i);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=Wh(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),a=Wh(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(a)?n.get(a):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),a=Wh(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var i=Le.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=od.chainStartResidueIndex(this.map.segments,r);if(i<o)return o;var s=od.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id=="undefined"?Rw(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):Bw(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id=="undefined"?Rw(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):Bw(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n=="undefined"?Rw(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):Bw(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return mce(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e.prototype.findElementOnResidue=function(t,r){return pce(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)},e}();function Rw(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function mce(e,t,r,n){for(var a=e;a<t;a++)if(n.has(r.value(a)))return a;return-1}function Bw(e,t,r,n,a,i){for(var o=e;o<t;o++)if(r.value(o)===a&&n.value(o)===i)return o;return-1}function pce(e,t,r,n){for(var a=e;a<t;a++)if(r.value(a)===n)return a;return-1}function vce(e,t,r){for(var n=fce(t,e,r),a=e.residues,i=a.label_seq_id,o=a.auth_seq_id,s=a.pdbx_PDB_ins_code,u=e.chains,c=u.label_entity_id,l=u.label_asym_id,f=u.auth_asym_id,d=Se.ofBounds(0,e.atoms._rowCount),m=qt.transientSegments(r.chainAtomSegments,d);m.hasNext;){var p=m.move(),v=p.index,h=t.getEntityIndex(c.value(v));h<0&&lce(c.value(v)),n.chain_index_entity_index[v]=h;var g=f.value(v),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=l.value(v);n.label_asym_id.has(b)||n.label_asym_id.set(b,h),cce(n.entity_index_label_asym_id,h,b,v);var x=new Map,C=new Map;n.chain_index_label_seq_id.set(v,x),n.chain_index_auth_seq_id.set(v,C);for(var _=qt.transientSegments(r.residueAtomSegments,d,p);_.hasNext;){var w=_.move(),T=w.index,A=o.value(T),D=s.value(T);x.set(Wh(i.value(T),D),T),C.set(Wh(A,D),T),y.set(A,v)}}return new dce(n)}function hce(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],a=[t],i=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,c=e.pdbx_PDB_ins_code,l=t+1;l<r;l++){var f=!i.areValuesEqual(l-1,l)||!o.areValuesEqual(l-1,l),d=f||!s.areValuesEqual(l-1,l)||!u.areValuesEqual(l-1,l)||!c.areValuesEqual(l-1,l);d&&(n[n.length]=l),f&&(a[a.length]=l)}return{residues:n,chains:a}}function Q1(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function gce(e,t,r){var n=Ar.ofColumns(Eoe,{type_symbol:ce.ofArray({array:ce.mapToArray(e.type_symbol,rd),schema:ce.Schema.Aliased(ce.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),a=Ar.view(e,Ioe,r.residues),i=Ar.view(e,Doe,r.chains);if(!a.label_seq_id.isDefined){for(var o=new Int32Array(a.label_seq_id.rowCount),s=r.residues,u=r.chains,c=0,l=0,f=0,d=o.length;f<d;++f)s[f]>=u[c+1]&&(c+=1,l=0),o[f]=++l;a.label_seq_id=ce.ofIntArray(o)}return Ar.columnToArray(a,"label_seq_id",Int32Array),Ar.columnToArray(a,"auth_seq_id",Int32Array),Q1(n,"label_atom_id","auth_atom_id"),Q1(n,"label_comp_id","auth_comp_id"),Q1(a,"label_seq_id","auth_seq_id"),Q1(i,"label_asym_id","auth_asym_id"),{atoms:n,residues:a,chains:i,atomSourceIndex:t}}function yce(e){return{id:zr.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ce.ofConst(1,e._rowCount,ce.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function bce(e,t){return Ar.areEqual(e.chains,t.chains)&&Ar.areEqual(e.residues,t.residues)&&Ar.areEqual(e.atoms,t.atoms)}function xce(e,t){var r=new Map;if(!Or.is(t))return r;var n=Nu(Gue,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var a=new Map,i=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=jr.create(n.operator_name.value(o),se.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:S.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),c=n.suffix.value(o),l=n.label_asym_id.value(o);a.set("".concat(l).concat(c),{name:l,operator:u});var f=n.auth_asym_id.value(o);i.set("".concat(f).concat(c),f)}for(var d=e.chains,m=d.label_asym_id,p=d.auth_asym_id,v=new Array(m.rowCount),h=new Array(m.rowCount),o=0;o<m.rowCount;o++){var l=m.value(o),f=p.value(o);if(!a.has(l)){v[o]=l,h[o]=f;continue}var g=a.get(l),y=g.name,u=g.operator;r.set(o,u),v[o]=y,h[o]=i.get(f)||f}return e.chains.label_asym_id=ce.ofArray({array:v,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ce.ofArray({array:h,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function Sce(e,t,r,n,a,i){var o=hce(e),s=gce(e,t,o),u=xce(s,a);if(i&&bce(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:u};var c={residueAtomSegments:qt.ofOffsets(o.residues,Se.ofBounds(0,e._rowCount)),chainAtomSegments:qt.ofOffsets(o.chains,Se.ofBounds(0,e._rowCount))},l=vce(s,r,c),f=uce(s,c,l,n),d=I(I(I({},s),c),{index:l,derived:f});return{sameAsPrevious:!1,hierarchy:d,chainOperatorMapping:u}}function j6(e,t,r,n,a,i){var o=Sce(e,t,r,n,a,i),s=o.sameAsPrevious,u=o.hierarchy,c=o.chainOperatorMapping,l=yce(e);return{sameAsPrevious:s,hierarchy:u,conformation:l,chainOperatorMapping:c}}var W6={chainKey:[],entityKey:[],findSequenceKey:function(){return-1},findChainKey:function(){return-1},getEntityFromChain:function(){return-1},count:0,entity_id:ce.Undefined(0,ce.Schema.str),asym_id:ce.Undefined(0,ce.Schema.str),seq_id_begin:ce.Undefined(0,ce.Schema.int),seq_id_end:ce.Undefined(0,ce.Schema.int),chainElementSegments:qt.create([]),polymerRanges:Tr.ofSortedRanges([]),gapRanges:Tr.ofSortedRanges([])},Fw;(function(e){e.Empty={isDefined:!1,spheres:W6,gaussians:W6}})(Fw||(Fw={}));function Cce(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function _ce(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function wce(e,t,r){var n=e.getEntityIndex,a=function(o,s){var u=n(o);if(u<0)return-1;var c=t.get(u);return c.has(s)?c.get(s):-1},i=function(o,s,u){var c=n(o);if(c<0)return-1;var l=t.get(c);if(l===void 0)return-1;var f=l.get(s);if(f===void 0)return-1;var d=r.get(f),m=d.elementIndices,p=d.seqRanges,v=Tr.firstIntersectionIndex(p,De.ofSingleton(u));return v!==-1?m[v]:-1};return{findChainKey:a,findSequenceKey:i}}function Ace(e){throw new Error("Missing entity entry for entity id '".concat(e,"'."))}function X6(e,t){for(var r=e.entity_id,n=e.asym_id,a=e.seq_id_begin,i=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,c=new Map,l={index:0},f=new Int32Array(o),d=new Int32Array(o),m=new Int32Array(s.count),p=0;p<o;p++)d[p]=t.getEntityIndex(r.value(p)),d[p]<0&&Ace(r.value(p));for(var v=0;v<s.count;v++){var h=s.offsets[v],g=s.offsets[v+1],y=d[h];m[v]=y;for(var b=_ce(c,y),x=Cce(b,n.value(h),l),p=h;p<g;p++)f[p]=x;for(var C=[],_=[],p=h;p<g;p++){var w=a.value(p),T=i.value(p);C.push(p),_.push(w,T)}var A={elementIndices:C,seqRanges:Tr.ofSortedRanges(_)};u.set(x,A)}var D=wce(t,c,u),E=D.findChainKey,M=D.findSequenceKey,F=function(O){return m[O]};return{chainKey:f,entityKey:d,findSequenceKey:M,findChainKey:E,getEntityFromChain:F}}function Y6(e,t){for(var r=[],n=[],a=qt.transientSegments(e.chainElementSegments,Se.ofBounds(0,e.count)),i=e.seq_id_begin,o=e.seq_id_end;a.hasNext;)for(var s=a.move(),u=s.start,c=s.end,l=-1,f=-1,d=u;d<c;++d){var m=o.value(d);d===u?(l=d,f=o.value(d)):i.value(d)-f>1&&(r.push(l,d-1),n.push(d-1,d),l=d),d===c-1&&r.push(l,d),f=m}return{polymerRanges:Tr.ofSortedRanges(r),gapRanges:Tr.ofSortedRanges(n)}}var K6={hierarchy:Fw.Empty,conformation:void 0};function Tce(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return K6;var a=Q6(r),i=Pce(r),o=X6(a,e.entities),s=Y6(a),u=Q6(n),c=Ece(n),l=X6(u,e.entities),f=Y6(u);return{hierarchy:{isDefined:!0,spheres:I(I(I({},a),o),s),gaussians:I(I(I({},u),l),f)},conformation:{id:zr.create22(),spheres:i,gaussians:c}}}function Pce(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function Ece(e){for(var t=gi.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,a=0,i=n.rowCount;a<i;a++)r[a]=sr.toMat3(dn(),t,n.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function Ice(e,t,r){for(var n=[0],a=1,i=e.rowCount;a<i;a++){var o=!e.areValuesEqual(a-1,a);o&&(n[n.length]=a)}return{chainElementSegments:qt.ofOffsets(n,Se.ofBounds(0,e.rowCount))}}function Q6(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,a=e.asym_id;return I({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:r,seq_id_end:n},Ice(a))}function Z6(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return cw.fromHierarchy(t,r,n);for(var a=e.entity_poly_seq,i=a.entity_id,o=a.num,s=a.mon_id,u={},c=[],l=i.rowCount,f=0;f<l;){for(var d=f;f<l-1&&i.areValuesEqual(f,f+1);)f++;f++;var m=i.value(d),p=ce.window(s,d,f),v=ce.window(o,d,f),h=t.getEntityIndex(m);u[h]={entityId:m,sequence:Bh.ofResidueNames(p,v)},c.push(u[h])}return{byEntityKey:u,sequences:c}}function $6(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return a=n3(r,n-1),i=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=$C(a,i.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:v.sent(),v.label=2;case 2:c=0,l=u.length-1,v.label=3;case 3:if(!(c<l))return[3,10];f=$C(a,o.value,{start:u[c],end:u[c+1]}),d=0,m=f.length-1,v.label=4;case 4:return d<m?(p=f[d],s.valueKind(p)!==0?[3,6]:($C(a,s.value,{sort:!0,start:p,end:f[d+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:v.sent(),v.label=6;case 6:return d++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:v.sent(),v.label=9;case 9:return c++,[3,3];case 10:return UW(a)&&a.length===t._rowCount?[2,{atom_site:t,sourceIndex:ce.ofIntArray(a)}]:[2,{atom_site:Ar.view(t,t._schema,a),sourceIndex:ce.ofIntArray(a)}]}})})}function J6(e,t,r,n,a){var i=a.residue,o=i.polymerType,s=i.traceElementIndex,u=i.directionFromElementIndex,c=i.directionToElementIndex,l=o[e],f=o[t];if(l===0||f===0||s[e]===-1||s[t]===-1)return!1;var d=n.findAtomsOnResidue(e,Bl(l,"backboneStart")),m=n.findAtomsOnResidue(t,Bl(f,"backboneEnd"));(d===-1||m===-1)&&(d=n.findAtomsOnResidue(e,Bl(l,"coarseBackbone")),m=n.findAtomsOnResidue(t,Bl(f,"coarseBackbone")));var p=r.x,v=r.y,h=r.z,g=S.create(p[d],v[d],h[d]),y=S.create(p[m],v[m],h[m]),b=u[e]===-1||c[e]===-1||u[t]===-1||c[t]===-1;return S.distance(g,y)<(b?10:3)}function ek(e,t,r,n){for(var a=[],i=[],o=new Map,s=qt.transientSegments(e.chainAtomSegments,Se.ofBounds(0,e.atoms._rowCount)),u=qt.transientSegments(e.residueAtomSegments,Se.ofBounds(0,e.atoms._rowCount)),c=e.index,l=e.derived,f=e.residues.label_seq_id,d=e.chains.label_entity_id,m=l.residue,p=m.moleculeType,v=m.traceElementIndex,h,g,y,b;s.hasNext;){var x=s.move();u.setSegment(x),h=-1,g=-1,y=-1,b=-1;var C=t.getEntityIndex(d.value(x.index)),_=n.byEntityKey[C],w=_?_.sequence.seqId.value(_.sequence.seqId.rowCount-1):-1,T=e.residueAtomSegments.index[x.start],A=e.residueAtomSegments.index[x.end-1],D=f.value(T),E=f.value(A);for(D===1&&E===w&&r.xyzDefined&&J6(T,A,r,c,l)&&(o.set(T,A),o.set(A,T));u.hasNext;){var M=u.move(),F=M.index,O=f.value(F);if(D1(p[F])&&v[F]!==-1)if(b!==-1)if(O!==h+1)a.push(b,y-1),i.push(g,M.end-1),b=M.start;else if(!u.hasNext)a.push(b,M.end-1);else{var U=e.residueAtomSegments.index[M.start],N=e.residueAtomSegments.index[y-1];r.xyzDefined&&!J6(U,N,r,e.index,l)&&(a.push(b,y-1),i.push(g,M.end-1),b=M.start)}else b=M.start;else b!==-1&&(a.push(b,y-1),b=-1);g=M.start,y=M.end,h=O}}return{polymerRanges:Tr.ofSortedRanges(a),gapRanges:Tr.ofSortedRanges(i),cyclicPolymerMap:o}}function Dce(e){for(var t=new Map,r=function(s,u,c){return"".concat(s,"|").concat(u,"|").concat(c)},n=e.pdbx_unobs_or_zero_occ_residues,a=0,i=n._rowCount;a<i;++a){var o=r(n.PDB_model_num.value(a),n.label_asym_id.value(a),n.label_seq_id.value(a));t.set(o,{polymer_flag:n.polymer_flag.value(a),occupancy_flag:n.occupancy_flag.value(a)})}return{has:function(s,u,c){return t.has(r(s,u,c))},get:function(s,u,c){return t.get(r(s,u,c))},size:t.size}}function Mce(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,a=r.rowCount;n<a;++n)t.set(r.value(n),Ar.getRow(e.chem_comp,n));else{var i=tk(e);i.forEach(function(o){t.set(o,vae(o))})}return t}function Rce(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,a=r.type,i=r.identifier,o=0,s=n.rowCount;o<s;++o)if(a.value(o)==="SNFG CARBOHYDRATE SYMBOL"||a.value(o)==="SNFG CARB SYMBOL"){var u=i.value(o),c=$ne.get(u);c?t.set(n.value(o),c):console.warn("Unknown SNFG name '".concat(u,"'"))}}if(e.chem_comp._rowCount>0)for(var l=e.chem_comp,f=l.id,a=l.type,o=0,s=f.rowCount;o<s;++o){var d=f.value(o);if(!t.has(d)){var m=a.value(o);td.has(d)?t.set(d,td.get(d)):ip(m,d)===9&&t.set(d,fO)}}else{var p=tk(e);td.forEach(function(v,h){!t.has(h)&&p.has(h)&&t.set(h,v)})}return t}var tk=IO(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,a=r.auth_comp_id,i=n.isDefined?n:a,o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function rk(e,t){for(var r=new Map,n=e.chains,a=n.auth_asym_id,i=n.label_asym_id,o=n.label_entity_id,s=0,u=e.chains._rowCount;s<u;s++){var c=i.value(s);r.set(c,{id:c,auth_id:a.value(s),entity_id:o.value(s)})}if(t==null?void 0:t.struct_asym._rowCount)for(var l=t.struct_asym,c=l.id,f=l.entity_id,s=0,d=c.rowCount;s<d;++s){var m=c.value(s);r.has(m)||r.set(m,{id:m,auth_id:"",entity_id:f.value(s)})}return r}var Bce=ce.Schema.Aliased(ce.Schema.Str(""));function nk(e){var t;if(e.entity.id.isDefined)t=e.entity;else{for(var r=new Set,n=[],a=[],i=e.atom_site,o=i.label_entity_id,s=i.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++){var l=o.value(u);r.has(l)||(n.push(l),a.push(hae(s.value(u))),r.add(l))}for(var f=e.ihm_sphere_obj_site.entity_id,u=0,c=e.ihm_sphere_obj_site._rowCount;u<c;u++){var l=f.value(u);r.has(l)||(n.push(l),a.push("polymer"),r.add(l))}for(var d=e.ihm_gaussian_obj_site.entity_id,u=0,c=e.ihm_gaussian_obj_site._rowCount;u<c;u++){var l=d.value(u);r.has(l)||(n.push(l),a.push("polymer"),r.add(l))}t=Ar.ofPartialColumns(gi.entity,{id:ce.ofArray({array:n,schema:gi.entity.id}),type:ce.ofArray({array:a,schema:gi.entity.type})},n.length)}var m=ce.createIndexer(t.id),p=new Array(t._rowCount);p.fill("other");var v=new Set,h=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var g=e.entity_poly,y=g.entity_id,b=g.type,x=g._rowCount,u=0;u<x;++u){var l=y.value(u);p[m(l)]=b.value(u),v.add(l)}else h=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var C=e.pdbx_entity_branch,y=C.entity_id,b=C.type,x=C._rowCount,u=0;u<x;++u){var l=y.value(u);p[m(l)]=b.value(u),v.add(l)}else h=!0;if(v.size<p.length&&(h=!0),h){var _=new Map;if(e.chem_comp)for(var w=e.chem_comp,T=w.id,b=w.type,u=0,c=e.chem_comp._rowCount;u<c;u++)_.set(T.value(u),b.value(u));if(e.atom_site)for(var A=e.atom_site,o=A.label_entity_id,s=A.label_comp_id,u=0,c=e.atom_site._rowCount;u<c;u++){var l=o.value(u);if(!v.has(l)){var D=s.value(u),E=_.get(D)||"";p[m(l)]=gae(D,E),v.add(l)}}}var M=ce.ofArray({array:p,schema:Bce});return{data:t,subtype:M,getEntityIndex:m}}function ak(e,t,r){var n;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;var a=new Array(t.data._rowCount);a.fill("");for(var i=e.pdbx_molecule,o=i.asym_id,s=i.prd_id,u=i._rowCount,c=0;c<u;++c){var l=o.value(c),f=(n=r.get(l))===null||n===void 0?void 0:n.entity_id;f!==void 0&&(a[t.getEntityIndex(f)]=s.value(c))}var d=ce.ofArray({array:a,schema:ce.Schema.str});return I(I({},t),{prd_id:d})}function Fce(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,a=Ar.pickRow(n,function(o){return n.model_id.value(o)===e});if(a){var i=Ar.pickRow(r,function(o){return r.id.value(o)===a.group_id});if(i)return i.name}return""}function dc(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o;return ae(this,function(s){switch(s.label){case 0:return n=Oce(e),e.ihm_model_list._rowCount>0?[4,Uce(r,e,n,t)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,Nce(r,e,n,t)];case 3:i=s.sent(),s.label=4;case 4:for(a=i,o=0;o<a.length;o++)jt.TrajectoryInfo.set(a[o],{index:o,size:a.length});return[2,new ud(a)]}})})}function Oce(e,t){return{missingResidues:Dce(e),chemicalComponentMap:Mce(e),saccharideComponentMap:Rce(e)}}function kce(e,t,r,n,a,i,o){var s=j6(t,r,n,a.chemicalComponentMap,i,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return I(I({},o),{id:zr.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var c=K6,l=Z6(e,n,s.hierarchy,c.hierarchy),f=ek(s.hierarchy,n,s.conformation,l),d=rk(s.hierarchy),m=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,p=[];return m&&p.push(m),e.struct.title.valueKind(0)===0&&p.push(e.struct.title.value(0)),{id:zr.create22(),entryId:m,label:p.join(" | "),entry:m,sourceData:i,modelNum:u,parent:void 0,entities:ak(e,n,d),sequence:l,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:f,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:c.hierarchy,coarseConformation:c.conformation,properties:I(I({},a),{structAsymMap:d}),customProperties:new Js,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function Lce(e,t,r,n){var a=j6(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Tce(t,r.chemicalComponentMap),o=Z6(e,t.entities,a.hierarchy,i.hierarchy),s=ek(a.hierarchy,t.entities,a.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,c=[];u&&c.push(u),e.struct.title.valueKind(0)===0&&c.push(e.struct.title.value(0)),t.model_name&&c.push(t.model_name),t.model_group_name&&c.push(t.model_group_name);var l=rk(a.hierarchy,e);return{id:zr.create22(),entryId:u,label:c.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:ak(e,t.entities,l),sequence:o,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:s,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:I(I({},r),{structAsymMap:l}),customProperties:new Js,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function ik(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function Nce(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:if(a=[],!t.atom_site)return[3,3];i=t.atom_site.id.rowCount,o=nk(t),s=0,m.label=1;case 1:return s<i?(u=ik(t.atom_site.pdbx_PDB_model_num,s),[4,$6(e,t.atom_site,s,u)]):[3,3];case 2:return c=m.sent(),l=c.atom_site,f=c.sourceIndex,d=kce(t,l,f,o,r,n,a.length>0?a[a.length-1]:void 0),a.push(d),s=u,[3,1];case 3:return[2,a]}})})}function Ow(e,t){for(var r=new Map,n=e._rowCount,a=0;a<n;){var i=ik(t,a),o=t.value(a);r.set(o,{table:Ar.window(e,e._schema,a,i),start:a,end:i}),a=i}return r}function Uce(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_;return ae(this,function(w){switch(w.label){case 0:if(a=nk(t),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=Ow(t.atom_site,i),s=Ow(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=Ow(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),c=[],!t.ihm_model_list)return[3,6];l=t.ihm_model_list,f=l.model_id,d=l.model_name,m=0,w.label=1;case 1:return m<t.ihm_model_list._rowCount?(p=f.value(m),v=void 0,h=void 0,o.has(p)?(g=o.get(p),[4,$6(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,x=y.sourceIndex,v=b,h=x,[3,4];case 3:v=Ar.window(t.atom_site,t.atom_site._schema,0,0),h=ce.ofIntArray([]),w.label=4;case 4:C={model_id:p,model_name:d.value(m),model_group_name:Fce(p,t),entities:a,atom_site:v,atom_site_sourceIndex:h,ihm_sphere_obj_site:s.has(p)?s.get(p).table:Ar.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(p)?u.get(p).table:Ar.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},_=Lce(t,C,r,n),c.push(_),w.label=5;case 5:return m++,[3,1];case 6:return[2,c]}})})}function zce(e,t){for(var r=e.atomName,n=e.residueName,a=new Array(e.count),i=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Dl,c=new Il(e.residueNumber,e.atomName),l="",f=0,d="",m=0,p=0,v=-1,h=0,g=e.count;h<g;++h){var y=e.residueNumber.value(h);if(y!==v){var b=e.residueName.value(h),x=ip(c.add(b,h).type,b);(x!==p||y!==v+1&&!(v===99999&&y===0))&&(d=ow(f),f+=1,m=0),l=u.getEntityId(b,x,d),m+=1,v=y,p=x}a[h]=l,i[h]=d,o[h]=m,s[h]=h}var C=ce.ofStringArray(i),_=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:C,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ce.ofFloatArray(ce.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:ce.ofFloatArray(ce.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:ce.ofFloatArray(ce.mapToArray(e.z,function(w){return w*10},Float32Array)),id:ce.ofIntArray(s),label_asym_id:C,label_atom_id:r,label_comp_id:n,label_seq_id:ce.ofIntArray(o),label_entity_id:ce.ofStringArray(a),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(ce.mapToArray(e.atomName,function(w){return A1(w)})),pdbx_PDB_model_num:ce.ofConst(t,e.count,ce.Schema.int)},e.count);return nd({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:_})}var kw;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(kw||(kw={}));function Vce(e){var t=this;return Be.create("Parse GRO",function(r){return ie(t,void 0,void 0,function(){var n,a,i,o,s,u;return ae(this,function(c){switch(c.label){case 0:n=kw.fromGro(e),a=[],i=0,o=e.structures.length,c.label=1;case 1:return i<o?(s=zce(e.structures[i].atoms,i+1),[4,dc(s,n,r)]):[3,4];case 2:u=c.sent(),u.frameCount===1&&a.push(u.representative),c.label=3;case 3:return++i,[3,1];case 4:return[2,new ud(a)]}})})})}function Gce(e,t){var r=function(i,o){return(t.substr(i,o)||"").trim()},n={entry_id:at.ofString(e),length_a:at.ofString(r(6,9)),length_b:at.ofString(r(15,9)),length_c:at.ofString(r(24,9)),angle_alpha:at.ofString(r(33,7)),angle_beta:at.ofString(r(40,7)),angle_gamma:at.ofString(r(47,7)),Z_PDB:at.ofString(r(66,4)),pdbx_unique_axis:at.ofString("?")},a={entry_id:at.ofString(e),"space_group_name_H-M":at.ofString(r(55,11)),Int_Tables_number:at.ofString("?"),cell_setting:at.ofString("?"),space_group_name_Hall:at.ofString("?")};return[Fa.ofFields("cell",n),Fa.ofFields("symmetry",a)]}function ok(e,t){return{id:e,details:t,groups:[]}}function Hce(e,t,r){for(var n=[],a,i,o,s=1,u=1,c=function(W){return e.data.substring(e.indices[2*W],e.indices[2*W+1])},l=t;l<r;l++){var f=c(l);if(f.substr(11,12)==="BIOMOLECULE:"){var d=f.substr(23).trim(),m="Biomolecule ".concat(d);f=c(l+1),f.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(l++,m=f.substr(11).trim()),a=ok(d,m),n.push(a)}else if(f.substr(13,5)==="BIOMT"){var p=f.split(/\s+/),v=parseInt(f[18])-1;v===0&&(o=se.identity(),i.operators.push({id:s++,matrix:o})),se.setValue(o,v,0,parseFloat(p[4])),se.setValue(o,v,1,parseFloat(p[5])),se.setValue(o,v,2,parseFloat(p[6])),se.setValue(o,v,3,parseFloat(p[7]))}else if(f.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||f.substr(11,30)==="                   AND CHAINS:"){f.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},a.groups.push(i));for(var h=f.substr(41,30).split(","),g=0,y=h.length;g<y;++g){var b=h[g].trim();b&&i.chains.push(b)}}else if(f.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){a=ok("".concat(u),"Biomolecule ".concat(u)),n.push(a),u+=1,i={chains:[],operators:[]},a.groups.push(i),l++,f=c(l);for(var h=f.substr(11,69).split(","),g=0,y=h.length;g<y;++g){var b=h[g].trim();b&&i.chains.push(b)}}}if(n.length===0)return[];for(var x={id:at.ofStrings(n.map(function(W){return W.id})),details:at.ofStrings(n.map(function(W){return W.details}))},C=[],_=0,w=n;_<w.length;_++)for(var T=w[_],A=0,D=T.groups;A<D.length;A++){var E=D[A];C.push({assembly_id:T.id,oper_expression:E.operators.map(function(W){return W.id}).join(","),asym_id_list:E.chains.join(",")})}for(var M={assembly_id:at.ofStrings(C.map(function(W){return W.assembly_id})),oper_expression:at.ofStrings(C.map(function(W){return W.oper_expression})),asym_id_list:at.ofStrings(C.map(function(W){return W.asym_id_list}))},F=[],O=0,U=n;O<U.length;O++)for(var T=U[O],N=0,q=T.groups;N<q.length;N++)for(var j=q[N],Q=0,J=j.operators;Q<J.length;Q++){for(var te=J[Q],v={id:""+te.id,type:"?",name:"?",symmetry_operation:"?"},l=0;l<3;l++){for(var g=0;g<3;g++)v["matrix[".concat(l+1,"][").concat(g+1,"]")]=""+se.getValue(te.matrix,l,g);v["vector[".concat(l+1,"]")]=""+se.getValue(te.matrix,l,3)}F.push(v)}for(var K={id:at.ofStrings(F.map(function(W){return W.id})),type:at.ofStrings(F.map(function(W){return W.type})),name:at.ofStrings(F.map(function(W){return W.name})),symmetry_operation:at.ofStrings(F.map(function(W){return W.symmetry_operation}))},L=function(W){for(var k=function(H){var X="matrix[".concat(W+1,"][").concat(H+1,"]");K[X]=at.ofStrings(F.map(function(Y){return Y[X]}))},V=0;V<3;V++)k(V);var G="vector[".concat(W+1,"]");K[G]=at.ofStrings(F.map(function(H){return H[G]}))},l=0;l<3;l++)L(l);return[Fa.ofFields("pdbx_struct_assembly",x),Fa.ofFields("pdbx_struct_assembly_gen",M),Fa.ofFields("pdbx_struct_oper_list",K)]}function qce(e,t,r){for(var n=[],a,i=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=i(o),u=s.split(/\s+/),c=parseInt(s[5])-1;c===0&&(a=se.identity(),n.push(a)),se.setValue(a,c,0,parseFloat(u[2])),se.setValue(a,c,1,parseFloat(u[3])),se.setValue(a,c,2,parseFloat(u[4])),se.setValue(a,c,3,parseFloat(u[5]))}if(n.length===0)return[];for(var l=[],f=1,d=0,m=n;d<m.length;d++){for(var p=m[d],c={id:"ncsop"+f++,code:".",details:"."},o=0;o<3;o++){for(var v=0;v<3;v++)c["matrix[".concat(o+1,"][").concat(v+1,"]")]=""+se.getValue(p,o,v);c["vector[".concat(o+1,"]")]=""+se.getValue(p,o,3)}l.push(c)}for(var h={id:at.ofStrings(l.map(function(y){return y.id})),code:at.ofStrings(l.map(function(y){return y.code})),details:at.ofStrings(l.map(function(y){return y.details}))},g=function(y){for(var b=function(_){var w="matrix[".concat(y+1,"][").concat(_+1,"]");h[w]=at.ofStrings(l.map(function(T){return T[w]}))},x=0;x<3;x++)b(x);var C="vector[".concat(y+1,"]");h[C]=at.ofStrings(l.map(function(_){return _[C]}))},o=0;o<3;o++)g(o);return[Fa.ofFields("struct_ncs_oper",h)]}var jce={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function Wce(e){return jce[e]||"HELX_P"}function Xce(e,t,r){for(var n=[],a=function(d){return e.data.substring(e.indices[2*d],e.indices[2*d+1])},i=t;i<r;i++){var o=a(i);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=at.ofStrings(n.map(function(d){return d.initChainID})),u=at.ofStrings(n.map(function(d){return d.initResName})),c=at.ofStrings(n.map(function(d){return d.endChainID})),l=at.ofStrings(n.map(function(d){return d.endResName})),f={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:at.ofUndefined(n.length,ce.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:at.ofStrings(n.map(function(d){return d.initSeqNum})),conf_type_id:at.ofStrings(n.map(function(d){return Wce(d.helixClass)})),details:at.ofStrings(n.map(function(d){return d.comment})),end_label_asym_id:c,end_label_comp_id:l,end_label_seq_id:at.ofUndefined(n.length,ce.Schema.int),end_auth_asym_id:c,end_auth_comp_id:l,end_auth_seq_id:at.ofStrings(n.map(function(d){return d.endSeqNum})),id:at.ofStrings(n.map(function(d){return d.serNum})),pdbx_beg_PDB_ins_code:at.ofStrings(n.map(function(d){return d.initICode})),pdbx_end_PDB_ins_code:at.ofStrings(n.map(function(d){return d.endICode})),pdbx_PDB_helix_class:at.ofStrings(n.map(function(d){return d.helixClass})),pdbx_PDB_helix_length:at.ofStrings(n.map(function(d){return d.length})),pdbx_PDB_helix_id:at.ofStrings(n.map(function(d){return d.helixID}))};return Fa.ofFields("struct_conf",f)}function Yce(e,t,r){for(var n=[],a=function(p){return e.data.substring(e.indices[2*p],e.indices[2*p+1])},i=t;i<r;i++){var o=a(i);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=at.ofStrings(n.map(function(p){return p.initChainID})),u=at.ofStrings(n.map(function(p){return p.initResName})),c=at.ofStrings(n.map(function(p){return p.initSeqNum})),l=at.ofStrings(n.map(function(p){return p.endChainID})),f=at.ofStrings(n.map(function(p){return p.endResName})),d=at.ofStrings(n.map(function(p){return p.endSeqNum})),m={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:c,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:c,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:d,end_auth_asym_id:l,end_auth_comp_id:f,end_auth_seq_id:d,id:at.ofStrings(n.map(function(p){return p.strand})),sheet_id:at.ofStrings(n.map(function(p){return p.sheetID})),pdbx_beg_PDB_ins_code:at.ofStrings(n.map(function(p){return p.initICode})),pdbx_end_PDB_ins_code:at.ofStrings(n.map(function(p){return p.endICode}))};return Fa.ofFields("struct_sheet_range",m)}var Kce={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function Qce(e,t,r){for(var n=function(x){return e.data.substring(e.indices[2*x],e.indices[2*x+1])},a,i={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),c=u.substr(10,70).trim(),l=c.indexOf(":"),f=c.substring(0,l),d=void 0;f in Kce?(a=f,d=c.substring(l+2)):d=c,d=d.replace(/;$/,""),a==="MOL_ID"?(i={chains:[],description:""},o.push(i)):a==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=d):a==="CHAIN"&&Array.prototype.push.apply(i.chains,d.split(/\s*,\s*/))}for(var m=[],p=0,v=o;p<v.length;p++)for(var h=v[p],g=0,y=h.chains;g<y.length;g++){var b=y[g];m.push({description:h.description,chains:[b]})}return m}function Zce(e,t,r){for(var n=function(c){return e.data.substring(e.indices[2*c],e.indices[2*c+1])},a=new Map,i=t;i<r;i++){var o=n(i),s=o.substr(11,3).trim(),u=o.substr(15).trim();a.has(s)?a.set(s,"".concat(a.get(s)," ").concat(u)):a.set(s,u)}return a}function $ce(e,t){var r=function(){return[]},n=function(){return qe.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function Jce(e){var t=at.ofTokens(e.auth_asym_id),r=at.ofTokens(e.auth_atom_id),n=at.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:at.ofTokens(e.auth_seq_id),B_iso_or_equiv:at.ofTokens(e.B_iso_or_equiv),Cartn_x:at.ofTokens(e.Cartn_x),Cartn_y:at.ofTokens(e.Cartn_y),Cartn_z:at.ofTokens(e.Cartn_z),group_PDB:at.ofTokens(e.group_PDB),id:at.ofStrings(e.id),label_alt_id:at.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:at.ofUndefined(e.index,ce.Schema.int),label_entity_id:at.ofStrings(e.label_entity_id),occupancy:lY(e.occupancy)?at.ofUndefined(e.index,ce.Schema.float):at.ofTokens(e.occupancy),type_symbol:at.ofTokens(e.type_symbol),pdbx_PDB_ins_code:at.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:at.ofStrings(e.pdbx_PDB_model_num),partial_charge:at.ofTokens(e.partial_charge)}}function sk(e,t,r,n,a,i){var o=r.data,s=a-n;qe.addToken(e.group_PDB,et.trim(r,n,n+6)),et.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),qe.addToken(e.auth_atom_id,et.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?qe.add(e.label_alt_id,0,0):qe.add(e.label_alt_id,n+16,n+17),qe.addToken(e.auth_comp_id,et.trim(r,n+17,n+20)),qe.add(e.auth_asym_id,n+21,n+22),qe.addToken(e.auth_seq_id,et.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?qe.add(e.pdbx_PDB_ins_code,0,0):qe.add(e.pdbx_PDB_ins_code,n+26,n+27),qe.addToken(e.Cartn_x,et.trim(r,n+30,n+38)),qe.addToken(e.Cartn_y,et.trim(r,n+38,n+46)),qe.addToken(e.Cartn_z,et.trim(r,n+46,n+54)),qe.addToken(e.occupancy,et.trim(r,n+54,n+60)),s>=66?qe.addToken(e.B_iso_or_equiv,et.trim(r,n+60,n+66)):qe.add(e.B_iso_or_equiv,0,0),i&&qe.addToken(e.partial_charge,et.trim(r,n+70,n+76)),s>=78&&!i?(et.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?qe.addToken(e.type_symbol,r):w1(e.type_symbol,o,n+12,n+16)):w1(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function ele(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},a=function(){return qe.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:a(),pdbx_label_atom_id:a(),pdbx_label_alt_id:a(),pdbx_label_comp_id:a(),pdbx_label_asym_id:a(),pdbx_label_seq_id:a(),pdbx_PDB_ins_code:a(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:a(),pdbx_auth_comp_id:a(),pdbx_auth_asym_id:a(),pdbx_auth_atom_id:a()}}function tle(e){var t=at.ofTokens(e.pdbx_auth_seq_id),r=at.ofTokens(e.pdbx_auth_comp_id),n=at.ofTokens(e.pdbx_auth_asym_id),a=at.ofTokens(e.pdbx_auth_atom_id),i={id:at.ofStrings(e.id),type_symbol:at.ofTokens(e.type_symbol),pdbx_label_atom_id:a,pdbx_label_alt_id:at.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:at.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:a};return i["U[1][1]"]=at.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=at.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=at.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=at.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=at.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=at.ofNumbers(e["U[2][3]"]),i}function rle(e,t,r,n,a){var i=r.data,o=a-n;et.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),qe.addToken(e.pdbx_auth_atom_id,et.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?qe.add(e.pdbx_label_alt_id,0,0):qe.add(e.pdbx_label_alt_id,n+16,n+17),qe.addToken(e.pdbx_auth_comp_id,et.trim(r,n+17,n+20)),qe.add(e.pdbx_auth_asym_id,n+21,n+22),qe.addToken(e.pdbx_auth_seq_id,et.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?qe.add(e.pdbx_PDB_ins_code,0,0):qe.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Df(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Df(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Df(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Df(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Df(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Df(i,n+63,n+70)/1e4,o>=78?(et.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?qe.addToken(e.type_symbol,r):w1(e.type_symbol,i,n+12,n+16)):w1(e.type_symbol,i,n+12,n+16),e.index++}function nle(e,t,r,n){for(var a={},i=0,o=n.id.rowCount;i<o;++i)a[n.id.str(i)]=i;for(var s=function(E){return e.data.substring(e.indices[2*E],e.indices[2*E+1])},u=[],c=[],l=[],f=[],d=[],m=[],p=[],v=[],h=[],g=[],y=[11,16,21,26],b=1,i=t;i<r;i++){var x=s(i),C=a[parseInt(x.substr(6,5))],_={};if(C!==void 0)for(var w=0;w<4;++w){var T=parseInt(x.substr(y[w],5));if(!Number.isNaN(T)){var A=a[T];A!==void 0&&(C>A||_[A]===void 0&&(u.push("covale".concat(b)),c.push("covale"),l.push(n.label_asym_id.str(C)),d.push(n.auth_seq_id.int(C)),f.push(n.label_seq_id.int(C)),m.push(n.label_atom_id.str(C)),p.push(n.label_asym_id.str(A)),h.push(n.auth_seq_id.int(A)),v.push(n.label_seq_id.int(A)),g.push(n.label_atom_id.str(A)),b+=1))}}}var D={id:at.ofStrings(u),conn_type_id:at.ofStrings(c),ptnr1_label_asym_id:at.ofStrings(l),ptnr1_auth_seq_id:at.ofNumbers(d),ptnr1_label_seq_id:at.ofNumbers(f),ptnr1_label_atom_id:at.ofStrings(m),ptnr2_label_asym_id:at.ofStrings(p),ptnr2_label_seq_id:at.ofNumbers(v),ptnr2_auth_seq_id:at.ofNumbers(h),ptnr2_label_atom_id:at.ofStrings(g)};return Fa.ofFields("struct_conn",D)}function ale(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,u,c,l,f,x,x,x,x,x,x,x,C,_,w,T,A,u,D,E,M,F,O,U,N,q;return ae(this,function(j){for(t=e.lines,r=t.data,n=t.indices,a=et(r),i=!!e.isPdbqt,o=0,s=0,u=0,c=t.count;u<c;u++)switch(l=n[2*u],f=n[2*u+1],r[l]){case"A":Bn(r,l,f,"ATOM  ")?o++:Bn(r,l,f,"ANISOU")&&s++;break;case"H":Bn(r,l,f,"HETATM")&&o++;break}for(d=$ce(r,o),m=ele(r,s),p=new Dl,v=[],h=[],g=0,y="",b=void 0,u=0,c=t.count;u<c;u++)switch(l=n[2*u],f=n[2*u+1],r[l]){case"A":Bn(r,l,f,"ATOM  ")?(g||(g++,y=""+g),sk(d,y,a,l,f,i)):Bn(r,l,f,"ANISOU")&&rle(m,y,a,l,f);break;case"C":if(Bn(r,l,f,"CRYST1"))v.push.apply(v,Gce(e.id||"?",r.substring(l,f)));else if(Bn(r,l,f,"CONECT")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"CONECT");)x++;b?hr&&console.log("only single CONECT block allowed, ignoring others"):b=[u,x],u=x-1}else if(Bn(r,l,f,"COMPND")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"COMPND");)x++;p.setCompounds(Qce(t,u,x)),u=x-1}break;case"H":if(Bn(r,l,f,"HETATM"))g||(g++,y=""+g),sk(d,y,a,l,f,i);else if(Bn(r,l,f,"HELIX")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"HELIX");)x++;v.push(Xce(t,u,x)),u=x-1}else if(Bn(r,l,f,"HETNAM")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"HETNAM");)x++;h.push.apply(h,Array.from(Zce(t,u,x).entries())),u=x-1}break;case"M":if(Bn(r,l,f,"MODEL ")&&(g++,y=""+g),Bn(r,l,f,"MTRIX")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"MTRIX");)x++;v.push.apply(v,qce(t,u,x)),u=x-1}break;case"O":break;case"R":if(Bn(r,l,f,"REMARK 350")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"REMARK 350");)x++;v.push.apply(v,Hce(t,u,x)),u=x-1}break;case"S":if(Bn(r,l,f,"SHEET")){for(x=u+1;l=n[2*x],f=n[2*x+1],!!Bn(r,l,f,"SHEET");)x++;v.push(Yce(t,u,x)),u=x-1}break}for(C=ce.ofIntTokens(d.auth_seq_id),_=ce.ofStringTokens(d.auth_atom_id),w=ce.ofStringTokens(d.auth_comp_id),T=ce.ofStringTokens(d.auth_asym_id),A=new Il(C,_),A.setNames(h),p.setNames(h),u=0,D=w.rowCount;u<D;++u)E=w.value(u),M=ip(A.add(E,u).type,E),d.label_entity_id[u]=p.getEntityId(E,M,T.value(u));for(F=Jce(d),i||delete F.partial_charge,b&&v.push(nle(t,b[0],b[1],F)),O={entity:Fa.ofTable("entity",p.getEntityTable()),chem_comp:Fa.ofTable("chem_comp",A.getChemCompTable()),atom_site:Fa.ofFields("atom_site",F),atom_site_anisotrop:Fa.ofFields("atom_site_anisotrop",tle(m))},U=0,N=v;U<N.length;U++)q=N[U],O[q.name]=q;return[2,{header:e.id||"PDB",categoryNames:Object.keys(O),categories:O}]})})}var cp;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=_s.create(e.Descriptor)})(cp||(cp={}));var Lw;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(Lw||(Lw={}));function ile(e){var t=this;return Be.create("Parse PDB",function(r){return ie(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return p.sent(),[4,ale(e)];case 2:return n=p.sent(),a=Or.fromFrame(n,void 0,Lw.create(e)),[4,dc(a.data.db,a,r)];case 3:return i=p.sent(),o=(m=n.categories.atom_site)===null||m===void 0?void 0:m.getField("partial_charge"),o&&i.frameCount===1&&(s=i.representative,u=s.atomicHierarchy.atomSourceIndex,c=ce.isIdentity(u),l=c?void 0:u.toArray({array:Int32Array}),f=o.toFloatArray(),d=l?ce.ofFloatArray(ce.mapToArray(u,function(v){return f[v]},Float32Array)):ce.ofFloatArray(f),cp.Provider.set(s,{data:d,type:"GASTEIGER"})),[2,i]}})})})}function ole(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),a=new Uint32Array(e.count),i=new Dl,o=new Il(e.residueId,e.atomName),s="",u=0,c="",l=0,f=e.segmentName.value(0),d=!1,m=0,p=-1,v=0,h=e.count;v<h;++v){var g=e.residueId.value(v),y=e.segmentName.value(v);if(f!==y?(c=ow(u),u+=1,l=0,d=!0,f=y):d=!1,d||g!==p){var b=e.residueName.value(v),x=ip(o.add(b,v).type,b);!d&&(x!==m||g!==p+1)&&(c=ow(u),u+=1,l=0),s=i.getEntityId(b,x,c),l+=1,p=g,m=x}t[v]=s,r[v]=c,n[v]=l,a[v]=v}var C=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ce.ofIntArray(a),label_asym_id:ce.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ce.ofIntArray(n),label_entity_id:ce.ofStringArray(t),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(ce.mapToArray(e.atomName,function(_){return A1(_)})),pdbx_PDB_model_num:ce.ofConst(1,e.count,ce.Schema.int)},e.count);return nd({entity:i.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:C})}var Nw;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(Nw||(Nw={}));function sle(e){var t=this;return Be.create("Parse PSF",function(r){return ie(t,void 0,void 0,function(){var n,a,i,o,s,u;return ae(this,function(c){return n=Nw.fromPsf(e),a=ole(e.atoms),i=e.bonds,o=i.atomIdA,s=i.atomIdB,u={indexA:ce.ofLambda({value:function(l){return o.value(l)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ce.ofLambda({value:function(l){return s.value(l)-1},rowCount:s.rowCount,schema:s.schema}),order:ce.ofConst(1,e.bonds.count,ce.Schema.int)},[2,uw.create(e.id,a,u,n)]})})})}function ule(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function Uw(e,t,r){return e&&e[t]!==void 0?e[t]:r}function je(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function Z1(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro.".concat(e.info.name),{kind:"macro",symbol:e,translate:t,aliases:Ht([e.info.name],r,!0)}}function cle(e){return e.kind==="alias"||e.kind==="macro"}var lle=[["Core symbols",je(ve.core.type.bool,"bool"),je(ve.core.type.num,"num"),je(ve.core.type.str,"str"),je(ve.core.type.regex,"regex"),je(ve.core.type.list,"list"),je(ve.core.type.set,"set"),je(ve.core.type.compositeKey,"composite-key"),je(ve.core.logic.not,"not"),je(ve.core.logic.and,"and"),je(ve.core.logic.or,"or"),je(ve.core.ctrl.if,"if"),je(ve.core.ctrl.fn,"fn"),je(ve.core.ctrl.eval,"eval"),je(ve.core.math.add,"add","+"),je(ve.core.math.sub,"sub","-"),je(ve.core.math.mult,"mult","*"),je(ve.core.math.div,"div","/"),je(ve.core.math.pow,"pow","**"),je(ve.core.math.mod,"mod"),je(ve.core.math.min,"min"),je(ve.core.math.max,"max"),je(ve.core.math.floor,"floor"),je(ve.core.math.ceil,"ceil"),je(ve.core.math.roundInt,"round"),je(ve.core.math.abs,"abs"),je(ve.core.math.sqrt,"sqrt"),je(ve.core.math.cbrt,"cbrt"),je(ve.core.math.sin,"sin"),je(ve.core.math.cos,"cos"),je(ve.core.math.tan,"tan"),je(ve.core.math.asin,"asin"),je(ve.core.math.acos,"acos"),je(ve.core.math.atan,"atan"),je(ve.core.math.sinh,"sinh"),je(ve.core.math.cosh,"cosh"),je(ve.core.math.tanh,"tanh"),je(ve.core.math.exp,"exp"),je(ve.core.math.log,"log"),je(ve.core.math.log10,"log10"),je(ve.core.math.atan2,"atan2"),je(ve.core.rel.eq,"eq","="),je(ve.core.rel.neq,"neq","!="),je(ve.core.rel.lt,"lt","<"),je(ve.core.rel.lte,"lte","<="),je(ve.core.rel.gr,"gr",">"),je(ve.core.rel.gre,"gre",">="),je(ve.core.rel.inRange,"in-range"),je(ve.core.str.concat,"concat"),je(ve.core.str.match,"regex.match"),je(ve.core.list.getAt,"list.get"),je(ve.core.set.has,"set.has"),je(ve.core.set.isSubset,"set.subset")],["Structure",["Types",je(ve.structureQuery.type.entityType,"ent-type"),je(ve.structureQuery.type.authResidueId,"auth-resid"),je(ve.structureQuery.type.labelResidueId,"label-resid"),je(ve.structureQuery.type.ringFingerprint,"ringfp"),je(ve.structureQuery.type.bondFlags,"bond-flags")],["Slots",je(ve.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",je(ve.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),je(ve.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),je(ve.structureQuery.generator.rings,"sel.atom.rings"),je(ve.structureQuery.generator.empty,"sel.atom.empty"),je(ve.structureQuery.generator.all,"sel.atom.all"),je(ve.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),Z1(Fh("sel.atom.atoms",St.Dictionary({0:$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),lt.ElementSelection,"A selection of singleton atom sets."),function(e){return ne.struct.generator.atomGroups({"atom-test":Uw(e,0,!0)})}),Z1(Fh("sel.atom.res",St.Dictionary({0:$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),lt.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return ne.struct.generator.atomGroups({"residue-test":Uw(e,0,!0),"group-by":ne.ammp("residueKey")})}),Z1(Fh("sel.atom.chains",St.Dictionary({0:$e(be.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),lt.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return ne.struct.generator.atomGroups({"chain-test":Uw(e,0,!0),"group-by":ne.ammp("chainKey")})})],["Modifiers",je(ve.structureQuery.modifier.queryEach,"sel.atom.query-each"),je(ve.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),je(ve.structureQuery.modifier.exceptBy,"sel.atom.except-by"),je(ve.structureQuery.modifier.unionBy,"sel.atom.union-by"),je(ve.structureQuery.modifier.union,"sel.atom.union"),je(ve.structureQuery.modifier.cluster,"sel.atom.cluster"),je(ve.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),je(ve.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),je(ve.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),je(ve.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",je(ve.structureQuery.filter.pick,"sel.atom.pick"),je(ve.structureQuery.filter.first,"sel.atom.first"),je(ve.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),je(ve.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),je(ve.structureQuery.filter.within,"sel.atom.within"),je(ve.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",je(ve.structureQuery.combinator.intersect,"sel.atom.intersect"),je(ve.structureQuery.combinator.merge,"sel.atom.merge"),je(ve.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",je(ve.structureQuery.atomSet.atomCount,"atom.set.atom-count"),je(ve.structureQuery.atomSet.countQuery,"atom.set.count-query"),je(ve.structureQuery.atomSet.reduce,"atom.set.reduce"),je(ve.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",je(ve.structureQuery.atomProperty.core.elementSymbol,"atom.el"),je(ve.structureQuery.atomProperty.core.vdw,"atom.vdw"),je(ve.structureQuery.atomProperty.core.mass,"atom.mass"),je(ve.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),je(ve.structureQuery.atomProperty.core.x,"atom.x"),je(ve.structureQuery.atomProperty.core.y,"atom.y"),je(ve.structureQuery.atomProperty.core.z,"atom.z"),je(ve.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),je(ve.structureQuery.atomProperty.core.operatorName,"atom.op-name"),je(ve.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),je(ve.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),je(ve.structureQuery.atomProperty.core.atomKey,"atom.key"),je(ve.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),je(ve.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),je(ve.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),je(ve.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),je(ve.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),je(ve.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),je(ve.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),je(ve.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),je(ve.structureQuery.atomProperty.macromolecular.id,"atom.id"),je(ve.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),je(ve.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),je(ve.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),je(ve.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),je(ve.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),je(ve.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),je(ve.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),je(ve.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),je(ve.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),je(ve.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),je(ve.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),je(ve.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),je(ve.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),je(ve.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),je(ve.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),je(ve.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),je(ve.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),je(ve.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),je(ve.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),je(ve.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),je(ve.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),je(ve.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),je(ve.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",je(ve.structureQuery.bondProperty.order,"bond.order"),je(ve.structureQuery.bondProperty.length,"bond.length"),je(ve.structureQuery.bondProperty.atomA,"bond.atom-a"),je(ve.structureQuery.bondProperty.atomB,"bond.atom-b"),Z1(Fh("bond.is",St.List(lt.BondFlag),be.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: ".concat(be.oneOfValues(lt.BondFlag).join(", "))),function(e){return ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.struct.type.bondFlags(ule(e))])})]]],uk=[];function ck(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];cle(n)?uk.push(n):n instanceof Array&&ck(n)}}ck(lle);var fle=function(){for(var e=[],t=Object.create(null),r=Br.create(),n=Br.create(),a=0,i=uk;a<i.length;a++){for(var o=i[a],s=0,u=o.aliases;s<u.length;s++){var c=u[s];if(e.push([c,o]),t[c])throw new Error("Alias '".concat(c,"' already in use."));t[c]=o}var l=o.symbol.args;if(l.kind!=="dictionary"){l.type.kind==="oneof"&&be.oneOfValues(l.type).forEach(function(p){return Br.add(n,p,p)});continue}for(var f=0,d=Object.keys(l.map);f<d.length;f++){var c=d[f];isNaN(c)&&Br.add(r,c,c);var m=l.map[c];m.type.kind==="oneof"&&be.oneOfValues(m.type).forEach(function(v){return Br.add(n,v,v)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),lp=fle.symbolMap;function Yh(e){if(Qn.isLiteral(e))return e;if(Qn.isSymbol(e)){if(!lp[e.name])return e;var t=lp[e.name];if(t.kind==="alias")return Qn.Symbol(lp[e.name].symbol.id);throw t.translate([])}var r=Qn.isSymbol(e.head)&&!!lp[e.head.name]&&lp[e.head.name].kind==="macro",n=r?e.head:Yh(e.head),a=n!==e.head;if(!e.args)return r?Yh(e.head):a?Qn.Apply(n):e;var i=!1,o;if(Qn.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var c=e.args[s],l=Yh(c);c!==l&&(i=!0),o[o.length]=l}if(i||(o=e.args),!r&&!a&&!i)return e}else{o={};for(var f=0,d=Object.keys(e.args);f<d.length;f++){var m=d[f],c=e.args[m],l=Yh(c);c!==l&&(i=!0),o[m]=l}if(!r&&!a&&!i)return e;i||(o=e.args)}if(r){var p=lp[e.head.name];if(p.kind!=="macro")return Qn.Apply(n,o);var v=p.translate(o);return v}return Qn.Apply(n,o)}function dle(e){return Yh(e)}var ws=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:lk(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=vle(t,r),a=new Error(n);throw a},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return zw(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return zw(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var a=[],i=void 0;;)if(i=Vo(t._(r,n),i),i.status){if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,a.push(i.value)}else return Vo(Qa(n,a),i)})},e.prototype.times=function(t,r){var n=this,a=typeof r=="undefined"?t:r;return new e(function(i,o){var s=[],u=void 0,c=void 0,l;for(l=0;l<t;l++)if(u=n._(i,o),c=Vo(u,c),u.status)o=u.index,s.push(u.value);else return c;for(;l<a&&(u=n._(i,o),c=Vo(u,c),u.status);l+=1)o=u.index,s.push(u.value);return Vo(Qa(o,s),c)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Ht(Ht([],r[0],!0),r[1],!0)})},e.prototype.map=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status?Vo(Qa(i.index,t(i.value)),i):i})},e.prototype.skip=function(t){return zw(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);return i.status||(i.expected=[t]),i})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],a=r[1];return n(a)})},e.prototype.chain=function(t){var r=this;return new e(function(n,a){var i=r._(n,a);if(!i.status)return i;var o=t(i.value);return Vo(o._(n,i.index),i)})},e}();(function(e){function t(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];var _=x.length;return new e(function(w,T){for(var A,D=new Array(_),E=T,M=0;M<_;M++){if(A=Vo(x[M]._(w,E),A),!A.status)return A;D[M]=A.value,E=A.index}return Vo(Qa(E,D),A)})}e.seq=t;function r(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];var _=x.length;return _===0?l("zero alternates"):new e(function(w,T){for(var A,D=0;D<x.length;D++)if(A=Vo(x[D]._(w,T),A),A.status)return A;return A})}e.alt=r;function n(x,C){return a(x,C).or(c([]))}e.sepBy=n;function a(x,C){var _=C.then(x).many();return t(x,_).map(function(w){return Ht([w[0]],w[1],!0)})}e.sepBy1=a;function i(x){var C="'".concat(x,"'");if(x.length===1){var _=x.charCodeAt(0);return new e(function(w,T){return w.charCodeAt(T)===_?Qa(T+1,x):mc(T,C)})}return new e(function(w,T){var A=T+x.length;return w.slice(T,A)===x?Qa(A,x):mc(T,C)})}e.string=i;function o(x){var C=""+x;return C.slice(C.lastIndexOf("/")+1)}function s(x){return RegExp("^(?:"+x.source+")",o(x))}function u(x,C){C===void 0&&(C=0);var _=s(x),w=""+x;return new e(function(T,A){var D=_.exec(T.slice(A));if(D){if(0<=C&&C<=D.length){var E=D[0],M=D[C];return Qa(A+E.length,M)}var F="invalid match group (0 to ".concat(D.length,") in ").concat(w);return mc(A,F)}return mc(A,w)})}e.regexp=u;function c(x){return new e(function(C,_){return Qa(_,x)})}e.succeed=c;function l(x){return new e(function(C,_){return mc(_,x)})}e.fail=l;function f(x){if(gle(x))return new e(function(C,_){var w=x._(C,_);return w.status&&(w.index=_,w.value=null),w});if(typeof x=="string")return f(i(x));if(x instanceof RegExp)return f(u(x));throw new Error("not a string, regexp, or parser: "+x)}e.lookahead=f;function d(x){return new e(function(C,_){var w=x._(C,_);return w.status?mc(_,'not "'+C.slice(_,w.index)+'"'):Qa(_,null)})}e.notFollowedBy=d;function m(x){return new e(function(C,_){var w=C.charAt(_);return _<C.length&&x(w)?Qa(_+1,w):mc(_,"a character "+x)})}e.test=m;function p(x){return m(function(C){return x.indexOf(C)>=0})}e.oneOf=p;function v(x){return m(function(C){return x.indexOf(C)<0})}e.noneOf=v;function h(x,C){return m(function(_){return x<=_&&_<=C}).desc(x+"-"+C)}e.range=h;function g(x){return new e(function(C,_){for(var w=_;w<C.length&&x(C.charAt(w));)w++;return Qa(w,C.slice(_,w))})}e.takeWhile=g;function y(x){var C=new e(function(_,w){var T=x()._;return C._=T,T(_,w)});return C}e.lazy=y;function b(){return l("empty")}e.empty=b,e.index=new e(function(x,C){return Qa(C,lk(x,C))}),e.anyChar=new e(function(x,C){return C>=x.length?mc(C,"any character"):Qa(C+1,x.charAt(C))}),e.all=new e(function(x,C){return Qa(x.length,x.slice(C))}),e.eof=new e(function(x,C){return C<x.length?mc(C,"EOF"):Qa(C,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i(`
`),e.crlf=i(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(ws||(ws={}));function zw(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new ws(function(a,i){for(var o,s,u=i,c=0;c<n;c++){if(o=Vo(t[c]._(a,u),o),!o.status)return o;e===c&&(s=o.value),u=o.index}return Vo(Qa(u,s),o)})}function Qa(e,t){return{status:!0,index:e,value:t}}function mc(e,t){return{status:!1,furthest:e,expected:[t]}}function Vo(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?hle(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function lk(e,t){var r=e.slice(0,t).split(`
`),n=r.length,a=r[r.length-1].length+1;return{offset:t,line:n,column:a}}function mle(e){return e.length===1?e[0]:"one of "+e.join(", ")}function ple(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return" at line ".concat(r.line," column ").concat(r.column,", got ").concat(a).concat(e.slice(n,n+12)).concat(i)}function vle(e,t){return"expected ".concat(mle(t.expected)).concat(ple(e,t))}function hle(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var a=new Set,i=[],o=0;o<r;o++)a.has(e[o])||(i[i.length]=e[o],a.add(e[o]));for(var o=0;o<n;o++)a.has(t[o])||(i[i.length]=t[o],a.add(t[o]));return i.sort(),i}function gle(e){return e instanceof ws}function yle(e){return Vw.parse(e)}var Vw;(function(e){var t;(function(x){function C(A){return{kind:"string",value:A}}x.str=C;function _(A){return{kind:"symbol",value:A}}x.symb=_;function w(A,D){return{kind:"list",bracket:A,nodes:D}}x.list=w;function T(A){return{kind:"comment",value:A}}x.comment=T})(t||(t={}));var r=ws.regexp(/[\n\r\s]*/),n=ws.lazy(function(){return ws.alt(a,f,i,o).trim(r)}),a=ws.takeWhile(function(x){return x!=="`"}).trim("`").map(t.str),i=ws.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=ws.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(x){return t.list("(",x)}),c=s.wrap("[","]").map(function(x){return t.list("[",x)}),l=s.wrap("{","}").map(function(x){return t.list("{",x)}),f=ws.alt(u,c,l),d=n.many();function m(x){return d.tryParse(x)}function p(x){switch(x.kind){case"string":return x.value;case"symbol":{var C=x.value;if(C.length>1){var _=C.charAt(0);switch(_){case".":return ne.atomName(C.substr(1));case"_":return ne.struct.type.elementSymbol([C.substr(1)])}}return C==="true"?!0:C==="false"?!1:y(C)?+C:Qn.Symbol(C)}case"list":{switch(x.bracket){case"[":return ne.core.type.list(g(x.nodes).map(p));case"{":return ne.core.type.set(g(x.nodes).map(p));case"(":{var w=p(x.nodes[0]);return Qn.Apply(w,v(x.nodes))}}return 0}default:throw new Error("should not happen")}}function v(x){if(!(x.length<=1)){if(!h(x)){for(var C=[],_=1,w=x.length;_<w;_++){var T=x[_];T.kind!=="comment"&&(C[C.length]=p(T))}return C}for(var A={},D=!0,E=0,_=1,w=x.length;_<w;_++){var T=x[_];if(T.kind!=="comment")if(T.kind==="symbol"&&T.value.length>1&&T.value.charAt(0)===":"){var M=T.value.substr(1);for(++_;_<w&&x[_].kind==="comment";)_++;if(_>=w)throw new Error("There must be a value foolowed a named arg ':".concat(M,"'."));A[M]=p(x[_]),isNaN(+M)&&(D=!1)}else A[E++]=p(T)}if(D){for(var F=Object.keys(A).map(function(N){return+N}).sort(function(N,q){return N-q}),O=!0,_=0,w=F.length;_<w;_++)if(F[_]!==_){O=!1;break}if(O){for(var U=[],_=0,w=F.length;_<w;_++)U[_]=A[_];return U}}return A}}function h(x){for(var C=1,_=x.length;C<_;C++){var w=x[C];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function g(x){for(var C=!1,_=0,w=x.length;_<w;_++)if(x[_].kind==="comment"){C=!0;break}return C?x.filter(function(T){return T.kind!=="comment"}):x}function y(x){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(x)&&!isNaN(+x)}function b(x){for(var C=m(x),_=[],w=0,T=C;w<T.length;w++){var A=T[w];A.kind!=="comment"&&(_[_.length]=p(A))}return _}e.parse=b})(Vw||(Vw={}));var ble=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '".concat(t.symbol.id,"' already added. Call removeSymbol/removeCustomProps re-adding the symbol.")),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.addSymbol(t.symbols[a])}},e.prototype.removeCustomProp=function(t){if(!!t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var a=n[r];this.removeSymbol(t.symbols[a])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),$1=new ble,xle=function(){function e(t){this.table=t,this.constQueryContext=new Uo(ke.Empty)}return e}(),fk;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(fk||(fk={}));var ld;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(ld||(ld={}));var Kh;(function(e){function t(r,n,a,i){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)a(r[o](n),o,i);else for(var o=0,u=0,c=Object.keys(r);u<c.length;u++){var l=c[u];a(r[l](n),o++,i)}return i}e.forEachEval=t})(Kh||(Kh={}));var fp;(function(e){function t(n,a){return new dk(n,a,!0)}e.Const=t;function r(n,a){return new dk(n,a,!1)}e.Dynamic=r})(fp||(fp={}));var dk=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,a=!1;if(!r)n=void 0,a=!0;else if(Qn.isArgumentsArray(r)){n=[],a=!0;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=Gw(t,s);a=a&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),a=!0;for(var c=0,l=Object.keys(r);c<l.length;c++){var f=l[c],u=Gw(t,r[f]);a=a&&u.isConst,n[f]=u.fn}}return this.isConst?this.isConst&&a?ld.Const(this.fn(t.constQueryContext,n)):ld.Dynamic(mk(this.fn,n)):ld.Dynamic(mk(this.fn,n))},e}();function mk(e,t){return function(n){return e(n,t)}}function Gw(e,t){if(Qn.isLiteral(t))return ld.Const(t);if(Qn.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):ld.Const(t.name)}if(!Qn.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '".concat(t.head.name,"' is not implemented."));return n.compile(e,t.args)}function Qh(e){var t=new xle($1);return Gw(t,e).fn}var Nt=fp.Const,Dt=fp.Dynamic,Sle=[Nt(ve.core.type.bool,function(t,r){return!!r[0](t)}),Nt(ve.core.type.num,function(t,r){return+r[0](t)}),Nt(ve.core.type.str,function(t,r){return""+r[0](t)}),Nt(ve.core.type.list,function(t,r){return Kh.forEachEval(r,t,function(n,a,i){return i[a]=n},[])}),Nt(ve.core.type.set,function(t,r){return Kh.forEachEval(r,t,function(a,i,o){return o.add(a)},new Set)}),Nt(ve.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Nt(ve.core.type.bitflags,function(t,r){return+r[0](t)}),Nt(ve.core.type.compositeKey,function(t,r){return Kh.forEachEval(r,t,function(n,a,i){return i[a]=""+n},[]).join("-")}),Nt(ve.core.logic.not,function(e,t){return!t[0](e)}),Nt(ve.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(!t[o](e))return!1}return!0}),Nt(ve.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var a=0,i=Object.keys(t);a<i.length;a++){var o=i[a];if(t[o](e))return!0}return!1}),Nt(ve.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),Nt(ve.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),Nt(ve.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),Nt(ve.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),Nt(ve.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),Nt(ve.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),Nt(ve.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Nt(ve.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r+=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r+=t[s](e)}return r}),Nt(ve.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,a=t.length;n<a;n++)r-=t[n](e)}else{var i=Object.keys(t);if(i.length===1)return-t[i[0]](e);r=t[i[0]](e)||0;for(var n=1,a=i.length;n<a;n++)r-=t[i[n]](e)}return r}),Nt(ve.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r*=t[n](e);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r*=t[s](e)}return r}),Nt(ve.core.math.div,function(e,t){return t[0](e)/t[1](e)}),Nt(ve.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),Nt(ve.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),Nt(ve.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.min(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.min(t[s](e),r)}return r}),Nt(ve.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=Math.max(t[n](e),r);else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=Math.max(t[s](e),r)}return r}),Nt(ve.core.math.floor,function(e,t){return Math.floor(t[0](e))}),Nt(ve.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),Nt(ve.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),Nt(ve.core.math.abs,function(e,t){return Math.abs(t[0](e))}),Nt(ve.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),Nt(ve.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),Nt(ve.core.math.sin,function(e,t){return Math.sin(t[0](e))}),Nt(ve.core.math.cos,function(e,t){return Math.cos(t[0](e))}),Nt(ve.core.math.tan,function(e,t){return Math.tan(t[0](e))}),Nt(ve.core.math.asin,function(e,t){return Math.asin(t[0](e))}),Nt(ve.core.math.acos,function(e,t){return Math.acos(t[0](e))}),Nt(ve.core.math.atan,function(e,t){return Math.atan(t[0](e))}),Nt(ve.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),Nt(ve.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),Nt(ve.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),Nt(ve.core.math.exp,function(e,t){return Math.exp(t[0](e))}),Nt(ve.core.math.log,function(e,t){return Math.log(t[0](e))}),Nt(ve.core.math.log10,function(e,t){return Math.log10(t[0](e))}),Nt(ve.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),Nt(ve.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),Nt(ve.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e).toString());else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r.push(t[s](e).toString())}return r.join("")}),Nt(ve.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),Nt(ve.core.list.equal,function(e,t){return OM(t[0](e),t[1](e))}),Nt(ve.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Nt(ve.core.set.isSubset,function(t,r){return Cn.isSuperset(r[1](t),r[0](t))}),Nt(ve.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!=0:!!n}),Nt(ve.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Nt(ve.structureQuery.type.elementSymbol,function(e,t){return rd(t[0](e))}),Nt(ve.structureQuery.type.atomName,function(e,t){return dj(t[0](e))}),Nt(ve.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=pk(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=pk(r,t[s](e))}return r}),Nt(ve.structureQuery.type.ringFingerprint,function(e,t){return No.elementFingerprint(Cle(e,t))}),Nt(ve.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r=vk(r,t[n](e));else for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];r=vk(r,t[s](e))}return r}),Dt(ve.structureQuery.filter.pick,function(e,t){return Fr.filters.pick(t[0],t.test)(e)}),Dt(ve.structureQuery.filter.first,function(e,t){return Fr.filters.first(t[0])(e)}),Dt(ve.structureQuery.filter.withSameAtomProperties,function(e,t){return Fr.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),Dt(ve.structureQuery.filter.intersectedBy,function(e,t){return Fr.filters.areIntersectedBy(t[0],t.by)(e)}),Dt(ve.structureQuery.filter.within,function(e,t){return Fr.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),Dt(ve.structureQuery.filter.isConnectedTo,function(e,t){return Fr.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),Dt(ve.structureQuery.generator.atomGroups,function(t,r){return Fr.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),Dt(ve.structureQuery.generator.all,function(t){return Fr.generators.all(t)}),Dt(ve.structureQuery.generator.empty,function(t){return Fr.generators.none(t)}),Dt(ve.structureQuery.generator.bondedAtomicPairs,function(t,r){return Fr.generators.bondedAtomicPairs(r&&r[0])(t)}),Dt(ve.structureQuery.generator.rings,function(t,r){var n,a;return Fr.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(a=r==null?void 0:r["only-aromatic"])===null||a===void 0?void 0:a.call(r,t))(t)}),Dt(ve.structureQuery.modifier.includeSurroundings,function(t,r){return Fr.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),Dt(ve.structureQuery.modifier.surroundingLigands,function(t,r){return Fr.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),Dt(ve.structureQuery.modifier.wholeResidues,function(t,r){return Fr.modifiers.wholeResidues(r[0])(t)}),Dt(ve.structureQuery.modifier.union,function(t,r){return Fr.modifiers.union(r[0])(t)}),Dt(ve.structureQuery.modifier.expandProperty,function(t,r){return Fr.modifiers.expandProperty(r[0],r.property)(t)}),Dt(ve.structureQuery.modifier.exceptBy,function(t,r){return Fr.modifiers.exceptBy(r[0],r.by)(t)}),Dt(ve.structureQuery.modifier.includeConnected,function(t,r){var n,a;return Fr.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(a=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&a!==void 0?a:!1})(t)}),Dt(ve.structureQuery.combinator.merge,function(e,t){return Fr.combinators.merge(t)(e)}),Dt(ve.structureQuery.atomProperty.core.elementSymbol,kr(ft.atom.type_symbol)),Dt(ve.structureQuery.atomProperty.core.vdw,function(e,t){return zh(ft.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Dt(ve.structureQuery.atomProperty.core.mass,function(e,t){return koe(ft.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Dt(ve.structureQuery.atomProperty.core.atomicNumber,function(e,t){return Vh(ft.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Dt(ve.structureQuery.atomProperty.core.x,kr(ft.atom.x)),Dt(ve.structureQuery.atomProperty.core.y,kr(ft.atom.y)),Dt(ve.structureQuery.atomProperty.core.z,kr(ft.atom.z)),Dt(ve.structureQuery.atomProperty.core.sourceIndex,kr(ft.atom.sourceIndex)),Dt(ve.structureQuery.atomProperty.core.operatorName,kr(ft.unit.operator_name)),Dt(ve.structureQuery.atomProperty.core.modelIndex,kr(ft.unit.model_index)),Dt(ve.structureQuery.atomProperty.core.modelLabel,kr(ft.unit.model_label)),Dt(ve.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return To(r.unit.id,r.element)}),Dt(ve.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return Uue(t&&t[0]&&t[0](e)||e.element)}),Dt(ve.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return zue(t&&t[0]&&t[0](e)||e.element)}),Dt(ve.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return Vue(t&&t[0]&&t[0](e)||e.element)}),Dt(ve.structureQuery.atomProperty.macromolecular.id,kr(ft.atom.id)),Dt(ve.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return ft.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),Dt(ve.structureQuery.atomProperty.macromolecular.label_atom_id,kr(ft.atom.label_atom_id)),Dt(ve.structureQuery.atomProperty.macromolecular.label_alt_id,kr(ft.atom.label_alt_id)),Dt(ve.structureQuery.atomProperty.macromolecular.label_comp_id,kr(ft.atom.label_comp_id)),Dt(ve.structureQuery.atomProperty.macromolecular.label_seq_id,kr(ft.residue.label_seq_id)),Dt(ve.structureQuery.atomProperty.macromolecular.label_asym_id,kr(ft.chain.label_asym_id)),Dt(ve.structureQuery.atomProperty.macromolecular.label_entity_id,kr(ft.entity.id)),Dt(ve.structureQuery.atomProperty.macromolecular.auth_atom_id,kr(ft.atom.auth_atom_id)),Dt(ve.structureQuery.atomProperty.macromolecular.auth_comp_id,kr(ft.atom.auth_comp_id)),Dt(ve.structureQuery.atomProperty.macromolecular.auth_seq_id,kr(ft.residue.auth_seq_id)),Dt(ve.structureQuery.atomProperty.macromolecular.auth_asym_id,kr(ft.chain.auth_asym_id)),Dt(ve.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,kr(ft.residue.pdbx_PDB_ins_code)),Dt(ve.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,kr(ft.atom.pdbx_formal_charge)),Dt(ve.structureQuery.atomProperty.macromolecular.occupancy,kr(ft.atom.occupancy)),Dt(ve.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,kr(ft.atom.B_iso_or_equiv)),Dt(ve.structureQuery.atomProperty.macromolecular.entityType,kr(ft.entity.type)),Dt(ve.structureQuery.atomProperty.macromolecular.entitySubtype,kr(ft.entity.subtype)),Dt(ve.structureQuery.atomProperty.macromolecular.entityPrdId,kr(ft.entity.prd_id)),Dt(ve.structureQuery.atomProperty.macromolecular.entityDescription,kr(ft.entity.pdbx_description)),Dt(ve.structureQuery.atomProperty.macromolecular.objectPrimitive,kr(ft.unit.object_primitive)),Dt(ve.structureQuery.atomProperty.macromolecular.isNonStandard,kr(ft.residue.isNonStandard)),Dt(ve.structureQuery.atomProperty.macromolecular.secondaryStructureKey,kr(ft.residue.secondary_structure_key)),Dt(ve.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,kr(ft.residue.secondary_structure_type)),Dt(ve.structureQuery.atomProperty.macromolecular.chemCompType,kr(ft.residue.chem_comp_type)),Dt(ve.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),Dt(ve.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),Dt(ve.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),Dt(ve.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),Dt(ve.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),Dt(ve.internal.generator.bundleElement,function(t,r){return d6(r.groupedUnits(t),r.ranges(t),r.set(t))}),Dt(ve.internal.generator.bundle,function(t,r){return m6(r.elements(t))(t)}),Dt(ve.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function kr(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function pk(e,t){return e|(ar.isName(t)?ar.fromName(t):0)}function vk(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function Cle(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,a=t.length;n<a;n++)r.push(t[n](e));else for(var i=Object.keys(t),n=1,a=i.length;n<a;n++)r.push(t[i[n]](e));return r}(function(){for(var e=0,t=Sle;e<t.length;e++){var r=t[e];$1.addSymbol(r)}})();function Gn(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=yle(s.expression);if(u.length===0)throw new Error("No query");return dle(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function a(s){var u=n(s);return Qh(u)}e.toQuery=a;function i(s,u){var c=a(s),l=c(new Uo(u));return tt.toLociWithSourceUnits(l)}e.toLoci=i;function o(s,u,c){var l=typeof s=="function"?s(ne):s,f=Qh(l);return f(new Uo(u,c))}e.getStructureSelection=o})(Gn||(Gn={}));var dp={dynamicBonds:P.Optional(P.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules."}))},fd;(function(e){function t(u,c){var l=u&&_n.Provider.get(u),f=l?l.assemblies.map(function(x){return[x.id,"".concat(x.id,": ").concat(Ao(x.details))]}):[],d=l?!pi.isZero(l.spacegroup.cell):!0,m=[];if(l)for(var p=l.spacegroup.operators,v=0,h=p.length;v<h;v++)m.push([v,"".concat(v+1,": ").concat(Mo.getOperatorXyz(p[v]))]);var g=[];u&&u.properties.structAsymMap.forEach(function(x){var C=x.id===x.auth_id?x.id:"".concat(x.id," [auth ").concat(x.auth_id,"]");g.push([x.id,C])});var y={auto:P.Group(dp),model:P.Group(dp),assembly:P.Group(I({id:P.Optional(u?P.Select(f.length?f[0][0]:"",f,{label:"Asm Id",description:"Assembly Id"}):P.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},dp),{isFlat:!0}),"symmetry-mates":P.Group(I({radius:P.Numeric(5,{min:0,max:50,step:1})},dp),{isFlat:!0}),symmetry:P.Group(I({ijkMin:P.Vec3(S.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:P.Vec3(S.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},dp),{isFlat:!0}),"symmetry-assembly":P.Group(I({generators:P.ObjectList({operators:P.ObjectList({index:P.Select(0,m),shift:P.Vec3(S(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(x){return"".concat(x.index+1,"_").concat(x.shift.map(function(C){return C+5}).join(""))},{defaultValue:[]}),asymIds:P.MultiSelect([],g)},function(x){return"".concat(x.asymIds.length," asym ids, ").concat(x.operators.length," operators")},{defaultValue:[]})},dp),{isFlat:!0})},b=[];return c==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),f.length>0&&b.push(["assembly","Assembly"]),d&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:P.MappedStatic(c||"model",y,{options:b})}}e.getParams=t;function r(u,c){return!(c.name==="symmetry-assembly"||c.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,c,l,f,d){return ie(this,void 0,void 0,function(){var m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return m=void 0,p=_n.Provider.get(l),!f&&p&&p.assemblies.length!==0&&(f=p.assemblies[0].id),!p||p.assemblies.length===0?u.log.warn("Model '".concat(l.entryId,"' has no assembly, returning model structure.")):(m=Rh.findAssembly(l,f||""),m||u.log.warn("Model '".concat(l.entryId,"' has no assembly called '").concat(f,"', returning model structure."))),v=ke.ofModel(l,d),m?(f=m.id,[4,cu.buildAssembly(v,f).runInContext(c)]):(h={label:"Model",description:ke.elementDescription(v)},[2,new fe.Molecule.Structure(v,h)]);case 1:return g=b.sent(),y={label:"Assembly ".concat(f),description:ke.elementDescription(g)},[2,new fe.Molecule.Structure(g,y)]}})})}function a(u,c,l,f,d){return ie(this,void 0,void 0,function(){var m,p,v;return ae(this,function(h){switch(h.label){case 0:return m=ke.ofModel(c,d),[4,cu.buildSymmetryRange(m,l,f).runInContext(u)];case 1:return p=h.sent(),v={label:"Symmetry [".concat(l,"] to [").concat(f,"]"),description:ke.elementDescription(p)},[2,new fe.Molecule.Structure(p,v)]}})})}function i(u,c,l,f){return ie(this,void 0,void 0,function(){var d,m,p;return ae(this,function(v){switch(v.label){case 0:return d=ke.ofModel(c,f),[4,cu.builderSymmetryMates(d,l).runInContext(u)];case 1:return m=v.sent(),p={label:"Symmetry Mates",description:ke.elementDescription(m)},[2,new fe.Molecule.Structure(m,p)]}})})}function o(u,c,l,f,d){return ie(this,void 0,void 0,function(){var m,p,v;return ae(this,function(h){switch(h.label){case 0:return m=ke.ofModel(c,d),[4,cu.buildSymmetryAssembly(m,l,f).runInContext(u)];case 1:return p=h.sent(),v={label:"Symmetry Assembly",description:ke.elementDescription(p)},[2,new fe.Molecule.Structure(p,v)]}})})}function s(u,c,l,f){return ie(this,void 0,void 0,function(){var d,m,p,p;return ae(this,function(v){if(d=f==null?void 0:f.params,m=_n.Provider.get(l),!m||!f||f.name==="model")return p=ke.ofModel(l,d),[2,new fe.Molecule.Structure(p,{label:"Model",description:ke.elementDescription(p)})];if(f.name==="auto")return m.assemblies.length===0?(p=ke.ofModel(l,d),[2,new fe.Molecule.Structure(p,{label:"Model",description:ke.elementDescription(p)})]):[2,n(u,c,l,void 0,d)];if(f.name==="assembly")return[2,n(u,c,l,f.params.id,d)];if(f.name==="symmetry")return[2,a(c,l,f.params.ijkMin,f.params.ijkMax,d)];if(f.name==="symmetry-mates")return[2,i(c,l,f.params.radius,d)];if(f.name==="symmetry-assembly")return[2,o(c,l,f.params.generators,m,d)];throw new Error("Unknown represetation type: ".concat(f.name))})})}e.create=s})(fd||(fd={}));var Za;(function(e){function t(s,u,c){return s.currentStructure!==c?!1:Gn.is(u)?!!s.script&&Gn.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var c=Gn.is(u)?u:void 0,l=Gn.is(u)?Gn.toExpression(u):u,f=Qh(l);return{script:c,expression:l,compiled:f,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new Uo(u))}e.run=n;function a(s,u){var c=r(s,u);return{entry:c,selection:n(c,s)}}e.createAndRun=a;function i(s,u){return s.currentStructure=u,s.compiled(new Uo(u))}e.updateStructure=i;function o(s,u,c){var l=tt.unionStructure(u);s.label="".concat(c||"Selection"),s.description=ke.elementDescription(l),s.data=l}e.updateStructureObject=o})(Za||(Za={}));var _le=new Set(["LI","NA","K","RB","CS","FR"]);function wle(e){return _le.has(e)}var Ale=new Set(["BE","MG","CA","SR","BA","RA"]);function Tle(e){return Ale.has(e)}var Ple=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function Ele(e){return Ple.has(e)}var Ile=new Set(["F","CL","BR","I","AT"]);function Dle(e){return Ile.has(e)}function hk(e){var t=Vh(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function Mle(e){var t=Vh(e);return t>=57&&t<=71}function Rle(e){var t=Vh(e);return t>=89&&t<=103}function Ble(e){return wle(e)||Tle(e)||Mle(e)||Rle(e)||hk(e)||Ele(e)}var br;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(br||(br={}));function _r(e,t,r){var n;r===void 0&&(r={});var a;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:br.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return a||(a=Qh(t)),a},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(i,o,s){return ie(this,void 0,void 0,function(){var u,c;return ae(this,function(l){switch(l.label){case 0:return u=i.managers.structure.selection.getStructure(s),c=u?tt.Sequence(s,[u]):tt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:i.managers.asset},s)]:[3,2];case 1:l.sent(),l.label=2;case 2:return a||(a=Qh(t)),[2,a(new Uo(s,{currentSelection:c}))]}})})}}}var Fle=_r("All",ne.struct.generator.all(),{category:"",priority:1e3}),Ole=_r("Current Selection",ne.internal.generator.current(),{category:"",referencesCurrent:!0}),kle=_r("Polymer",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])])})]),{category:br.Type}),Lle=_r("Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"atom-test":ne.core.set.has([ne.set("CA","P"),ne.ammp("label_atom_id")])})])])]),{category:br.Structure}),mp=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ne.ammp("entitySubtype")])]),J1=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])]),dd=ne.core.str.match([ne.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ne.ammp("chemCompType")]),Nle=_r("Backbone",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.set.has([ne.set.apply(ne,Cn.toArray(cc)),ne.ammp("label_atom_id")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":J1,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.set.has([ne.set.apply(ne,Cn.toArray(P1)),ne.ammp("label_atom_id")])})])])]),{category:br.Structure}),Ule=_r("Sidechain",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Cn.toArray(cc)),ne.ammp("label_atom_id")])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":J1,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Cn.toArray(P1)),ne.ammp("label_atom_id")])])])})])])]),{category:br.Structure}),zle=_r("Sidechain with Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Cn.toArray(cc)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"CA"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("auth_comp_id"),"PRO"]),ne.core.rel.eq([ne.ammp("label_atom_id"),"N"])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":J1,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dd]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set.apply(ne,Cn.toArray(P1)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"P"])])})])])]),{category:br.Structure}),Vle=_r("Protein",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp})]),{category:br.Type}),Gle=_r("Nucleic",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":J1})]),{category:br.Type}),Hle=_r("Helix",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([2])])})]),{category:br.Structure,ensureCustomProperties:function(e,t){return zo.attach(e,t)}}),qle=_r("Beta Strand/Sheet",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":mp,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([4])])})]),{category:br.Structure,ensureCustomProperties:function(e,t){return zo.attach(e,t)}}),jle=_r("Water",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"water"])})]),{category:br.Type}),Wle=_r("Ion",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"ion"])})]),{category:br.Type}),Xle=_r("Lipid",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"lipid"])})]),{category:br.Type}),eb=_r("Carbohydrate",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"branched"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.str.match([ne.re("oligosaccharide","i"),ne.ammp("entitySubtype")])])])})]),{category:br.Type}),gk=_r("Carbohydrate with Connected",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:eb.expression,"layer-count":1,"as-whole-residues":!0})]),{category:br.Internal,isHidden:!0}),yk=_r("Connected to Carbohydrate",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:gk.expression,by:eb.expression})]),{category:br.Internal,isHidden:!0}),Hw=_r("Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.rel.neq([ne.ammp("entityPrdId"),""])]),ne.core.logic.not([ne.core.str.match([ne.re("(oligosaccharide|lipid|ion)","i"),ne.ammp("entitySubtype")])])]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ne.core.str.match([ne.re("saccharide","i"),ne.ammp("chemCompType")])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":dd})])])]),by:ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.set.has([ne.set.apply(ne,Cn.toArray(ap)),ne.ammp("label_comp_id")])})])})]),{category:br.Type}),bk=_r("Ligand with Connected",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:Hw.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([1|2])])})]),by:eb.expression})]),{category:br.Internal,isHidden:!0}),xk=_r("Connected to Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:bk.expression,by:Hw.expression})]),{category:br.Internal,isHidden:!0}),Yle=_r("Connected to Ligand or Carbohydrate",ne.struct.modifier.union([ne.struct.combinator.merge([yk.expression,xk.expression])]),{category:br.Internal,isHidden:!0}),Kle=_r("Disulfide Bridges",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.bondedAtomicPairs({0:ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([8])])})])])])])]),{category:br.Bond}),Qle=_r("NOS Bridges",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:br.Bond}),Zle=_r("Non-standard Residues in Polymers",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.ammp("isNonStandard")})]),{category:br.Residue}),$le=_r("Coarse Elements",ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),{category:br.Type}),Jle=_r("Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings()]),{category:br.Residue}),efe=_r("Aromatic Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings({"only-aromatic":!0})]),{category:br.Residue}),tfe=_r("Surrounding Residues (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ne.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:br.Manipulate,referencesCurrent:!0}),rfe=_r("Surrounding Ligands (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.surroundingLigands({0:ne.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:br.Manipulate,referencesCurrent:!0}),nfe=_r("Surrounding Atoms (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:ne.internal.generator.current()})]),{description:"Select atoms within 5 \u212B of the current selection.",category:br.Manipulate,referencesCurrent:!0}),afe=_r("Inverse / Complement of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.generator.all(),by:ne.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:br.Manipulate,referencesCurrent:!0}),ife=_r("Residues Covalently Bonded to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:br.Manipulate,referencesCurrent:!0}),ofe=_r("Covalently Bonded Component",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:br.Manipulate,referencesCurrent:!0}),sfe=_r("Residues with Cov. or Metallic Bond to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([1|2])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:br.Manipulate,referencesCurrent:!0}),ufe=_r("Whole Residues of Selection",ne.struct.modifier.union([ne.struct.modifier.wholeResidues({0:ne.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:br.Manipulate,referencesCurrent:!0}),cfe=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),lfe=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function Sk(e,t,r){var n=e[0],a=e[1];r===void 0&&(r=0);var i=n.length===1&&!ffe.has(n[0])?"[".concat(n[0],"] ").concat(a):"".concat(a," (").concat(n.join(", "),")");return _r(i,ne.struct.modifier.union([ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set.apply(ne,n),ne.ammp("auth_comp_id")])})]),{category:t,priority:r,description:i})}var ffe=Cn.unionMany(rw,Dh,Mh,E1),Jn={all:Fle,current:Ole,polymer:kle,trace:Lle,backbone:Nle,sidechain:Ule,sidechainWithTrace:zle,protein:Vle,nucleic:Gle,helix:Hle,beta:qle,water:jle,ion:Wle,lipid:Xle,branched:eb,branchedPlusConnected:gk,branchedConnectedOnly:yk,ligand:Hw,ligandPlusConnected:bk,ligandConnectedOnly:xk,connectedOnly:Yle,disulfideBridges:Kle,nosBridges:Qle,nonStandardPolymer:Zle,coarse:$le,ring:Jle,aromaticRing:efe,surroundings:tfe,surroundingLigands:rfe,surroundingAtoms:nfe,complement:afe,covalentlyBonded:ife,covalentlyOrMetallicBonded:sfe,covalentlyBondedComponent:ofe,wholeResidues:ufe},dfe=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Ht(Ht(Ht([],Object.values(Jn),!1),cfe.map(function(n){return Sk(n,br.AminoAcid)}),!1),lfe.map(function(n){return Sk(n,br.NucleicBase)}),!1)),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),mfe=function(){return{type:P.MappedStatic("static",{static:P.Text("polymer"),expression:P.Value(ne.struct.generator.all),bundle:P.Value(Cr.Empty),script:P.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:P.Optional(P.Boolean(!0,{isHidden:!0})),label:P.Text("",{isHidden:!0})}};function pfe(e,t,r){r.source=e;var n=ke.Empty,a=void 0;switch(t.type.name){case"static":{var i=void 0;switch(t.type.params){case"all":i=Jn.all.query,a="All";break;case"polymer":i=Jn.polymer.query,a="Polymer";break;case"protein":i=Jn.protein.query,a="Protein";break;case"nucleic":i=Jn.nucleic.query,a="Nucleic";break;case"water":i=Fr.internal.water(),a="Water";break;case"ion":i=Jn.ion.query,a="Ion";break;case"lipid":i=Jn.lipid.query,a="Lipid";break;case"branched":i=Jn.branchedPlusConnected.query,a="Branched";break;case"ligand":i=Jn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":i=Jn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":i=Jn.coarse.query,a="Coarse";break;default:throw new Error("".concat(t.type," is a not valid complex element."))}var o=i(new Uo(e));n=tt.unionStructure(o);break}case"script":case"expression":{var s=Za.createAndRun(e,t.type.params),u=s.selection,c=s.entry;r.entry=c,n=tt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=Cr.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return rn.Null;var l={label:"".concat(t.label||a||"Component"),description:ke.elementDescription(n)};return new fe.Molecule.Structure(n,l)}function vfe(e,t,r,n,a){if(r.type.name!==n.type.name)return Ge.UpdateResult.Recreate;var i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!ke.areEquivalent(e,a.source)?Ge.UpdateResult.Recreate:t.data.model===e.model?Ge.UpdateResult.Unchanged:jt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),Ge.UpdateResult.Updated):Ge.UpdateResult.Recreate;case"script":if(!Gn.areEqual(r.type.params,n.type.params))return Ge.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return Ge.UpdateResult.Recreate;if(e===a.source)break;var o=a.entry,s=Za.updateStructure(o,e);a.source=e,t.data=tt.unionStructure(s),Za.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===a.source&&Cr.areEqual(r.type.params,n.type.params))break;a.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:ke.Empty):(i=!0,t.data=Cr.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return Ge.UpdateResult.Null;t.description=ke.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label="".concat(n.label||t.label)),i?Ge.UpdateResult.Updated:Ge.UpdateResult.Unchanged}function hfe(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return console.error("Value ".concat(e," is outside the 0-7 range, defaulting to 0.")),0}}function Ck(e,t){for(var r=qe.create(e.data,t*2),n=qe.create(e.data,t*2),a=qe.create(e.data,t*2),i=qe.create(e.data,t*2),o=qe.create(e.data,t*2),s=0;s<t;++s){et.markLine(e);var u=e.tokenStart,c=e.position;et.trim(e,u,u+10),qe.addUnchecked(r,e.tokenStart,e.tokenEnd),et.trim(e,u+10,u+20),qe.addUnchecked(n,e.tokenStart,e.tokenEnd),et.trim(e,u+20,u+30),qe.addUnchecked(a,e.tokenStart,e.tokenEnd),et.trim(e,u+31,u+34),qe.addUnchecked(i,e.tokenStart,e.tokenEnd),et.trim(e,u+36,u+39),qe.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=c}return{count:t,x:Zt(r)(ce.Schema.float),y:Zt(n)(ce.Schema.float),z:Zt(a)(ce.Schema.float),type_symbol:Zt(i)(ce.Schema.str),formal_charge:Zt(o)(ce.Schema.int)}}function _k(e,t){for(var r=qe.create(e.data,t*2),n=qe.create(e.data,t*2),a=qe.create(e.data,t*2),i=0;i<t;++i){et.markLine(e);var o=e.tokenStart,s=e.position;et.trim(e,o,o+3),qe.addUnchecked(r,e.tokenStart,e.tokenEnd),et.trim(e,o+3,o+6),qe.addUnchecked(n,e.tokenStart,e.tokenEnd),et.trim(e,o+6,o+9),qe.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:Zt(r)(ce.Schema.int),atomIdxB:Zt(n)(ce.Schema.int),order:Zt(a)(ce.Schema.int)}}function gfe(e,t,r){et.trim(e,t+6,t+9);for(var n=parseInt(et.getTokenString(e)),a=0;a<n;++a){var i=9+a*8;et.trim(e,t+i,t+i+4);var o=et.getTokenString(e);r.atomIdx.push(+o),et.trim(e,t+i+4,t+i+8);var s=et.getTokenString(e);r.charge.push(+s)}et.eatLine(e)}function wk(e){for(var t=[],r=[],n={atomIdx:t,charge:r};e.position<e.length;){var a=e.position;et.trim(e,a+3,a+6);var i=et.getTokenString(e);if(i==="END")break;switch(et.eatLine(e),i){case"CHG":gfe(e,a,n);break}}var o={atomIdx:ce.ofIntArray(n.atomIdx),charge:ce.ofIntArray(n.charge)};return o}function yfe(e){var t=et(e),r=et.readLine(t).trim(),n=et.readLine(t).trim(),a=et.readLine(t).trim(),i=et.readLine(t),o=+i.substr(0,3),s=+i.substr(3,3),u=Ck(t,o),c=_k(t,s),l=wk(t),f={title:r,program:n,comment:a,atoms:u,bonds:c,formalCharges:l};return $r.success(f)}function bfe(e){var t=this;return Be.create("Parse Mol",function(){return ie(t,void 0,void 0,function(){return ae(this,function(r){return[2,yfe(e)]})})})}function Ak(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,f,d,m,p,v,h,g,y,b,x;return ae(this,function(C){switch(C.label){case 0:if(n=e.atoms,a=e.bonds,i=e.formalCharges,o=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),s=ce.ofConst("A",e.atoms.count,ce.Schema.str),u=ce.asArrayColumn(n.type_symbol),c=ce.ofConst(1,n.count,ce.Schema.int),l=new Int32Array(e.atoms.count),i.atomIdx.rowCount>0)for(f=0;f<i.atomIdx.rowCount;f++)l[i.atomIdx.value(f)-1]=i.charge.value(f);else for(f=0;f<e.atoms.count;f++)l[f]=hfe(n.formal_charge.value(f));return d=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:s,auth_atom_id:u,auth_comp_id:o,auth_seq_id:c,Cartn_x:ce.asArrayColumn(n.x,Float32Array),Cartn_y:ce.asArrayColumn(n.y,Float32Array),Cartn_z:ce.asArrayColumn(n.z,Float32Array),id:ce.range(0,n.count-1),label_asym_id:s,label_atom_id:u,label_comp_id:o,label_seq_id:c,label_entity_id:ce.ofConst("1",n.count,ce.Schema.str),occupancy:ce.ofConst(1,n.count,ce.Schema.float),type_symbol:u,pdbx_PDB_model_num:ce.ofConst(1,n.count,ce.Schema.int),pdbx_formal_charge:ce.ofIntArray(l)},n.count),m=new Dl,m.setNames([["MOL","Unknown Entity"]]),m.getEntityId("MOL",0,"A"),p=new Il(c,u),p.setNames([["MOL","Unknown Molecule"]]),p.add("MOL",0),v=nd({entity:m.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:d}),[4,dc(v,t!=null?t:qw.create(e),r)];case 1:return h=C.sent(),h.frameCount>0&&(g=ce.ofIntArray(ce.mapToArray(a.atomIdxA,function(_){return _-1},Int32Array)),y=ce.ofIntArray(ce.mapToArray(a.atomIdxB,function(_){return _-1},Int32Array)),b=ce.asArrayColumn(a.order,Int32Array),x=La.fromData({pairs:{indexA:g,indexB:y,order:b},count:n.count}),La.Provider.set(h.representative,x)),[2,h]}})})}var qw;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(qw||(qw={}));function xfe(e){return Be.create("Parse MOL",function(t){return Ak(e,void 0,t)})}function Sfe(e){var t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):r}function Cfe(e){var t=e.cell,r=e.space_group,n=Sfe(r),a=pi.create(n,S.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),S.scale(S(),S.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:Mo.create(a),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function _fe(e,t,r){var n;return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A,y,D,E,T,y,M,F,O,U,N,q,j,Q,J,te,y,K,L,W,k,V,G,H,X,Y,oe,ue,me,he,Pe,y,re,ee,B,z;return ae(this,function(le){switch(le.label){case 0:for(a=e.atom_site._rowCount,i=ce.ofConst("MOL",a,ce.Schema.str),o=ce.ofConst("A",a,ce.Schema.str),s=ce.ofConst(1,a,ce.Schema.int),u=Cfe(e),c=u.spacegroup.cell.fromFractional,l=e.atom_site,f=l.fract_x,d=l.fract_y,m=l.fract_z,p=new Float32Array(a),v=new Float32Array(a),h=new Float32Array(a),g=S(),y=0;y<a;++y)S.set(g,f.value(y),d.value(y),m.value(y)),S.transformMat4(g,g,c),p[y]=g[0],v[y]=g[1],h[y]=g[2];if(b=e.atom_site,x=b.type_symbol,C=b.label,x.isDefined){for(T=new Array(a),A=new Int8Array(a),y=0;y<a;++y)D=x.value(y),E=D.length,D[E-1]==="+"?(T[y]=D.substring(0,E-2),A[y]=parseInt(D[E-2])):D[E-2]==="+"?(T[y]=D.substring(0,E-2),A[y]=parseInt(D[E-1])):D[E-1]==="-"?(T[y]=D.substring(0,E-2),A[y]=-parseInt(D[E-2])):D[E-2]==="-"?(T[y]=D.substring(0,E-2),A[y]=-parseInt(D[E-1])):(T[y]=D,A[y]=0);_=ce.ofStringArray(T),w=ce.ofIntArray(A)}else{for(T=new Array(a),y=0;y<a;++y)T[y]=A1(C.value(y));_=ce.ofStringArray(T),w=ce.Undefined(a,ce.Schema.int)}return M=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:o,auth_atom_id:C,auth_comp_id:i,auth_seq_id:s,Cartn_x:ce.ofFloatArray(p),Cartn_y:ce.ofFloatArray(v),Cartn_z:ce.ofFloatArray(h),id:ce.range(0,a-1),label_asym_id:o,label_atom_id:C,label_comp_id:i,label_seq_id:s,label_entity_id:ce.ofConst("1",a,ce.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ce.ofConst(1,a,ce.Schema.float),type_symbol:_,pdbx_formal_charge:w,pdbx_PDB_model_num:ce.ofConst(1,a,ce.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},a),F=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),O=new Dl,O.setNames([["MOL",F||"Unknown Entity"]]),O.getEntityId("MOL",0,"A"),U=new Il(s,e.atom_site.type_symbol),U.setNames([["MOL",F||"Unknown Molecule"]]),U.add("MOL",0),N=nd({entity:O.getEntityTable(),chem_comp:U.getChemCompTable(),atom_site:M}),[4,dc(N,t,r)];case 1:if(q=le.sent(),q.frameCount>0&&(j=q.representative,_n.Provider.set(j,u),Q=e.geom_bond._rowCount,Q>0)){for(J={},te=e.atom_site.label,y=0,K=te.rowCount;y<K;++y)J[te.value(y)]=y;for(L=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),W=[],k=[],V=[],G=[],H=[],X=new Set,Y=0,oe=e.geom_bond,ue=oe.atom_site_label_1,me=oe.atom_site_label_2,he=oe.valence,Pe=oe.distance,y=0;y<Q;++y)re=J[ue.value(y)],ee=J[me.value(y)],B=re<ee?To(re,ee):To(ee,re),!X.has(B)&&(X.add(B),W[Y]=re,k[Y]=ee,G[Y]=Pe.value(y)||-1,L?(z=L.str(y),z==="D"?(V[Y]=2,H[Y]=1):z==="A"?(V[Y]=1,H[Y]=1|16):(V[Y]=1,H[Y]=1)):(H[Y]=1,V[Y]=he.isDefined?he.value(y):1),Y+=1);La.Provider.set(j,La.fromData({pairs:{indexA:ce.ofIntArray(W),indexB:ce.ofIntArray(k),order:ce.ofIntArray(V),distance:ce.ofFloatArray(G),flag:ce.ofIntArray(H)},count:a}))}return[2,q]}})})}function wfe(e){if(!!Zh.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,a=Ar.ofPartialColumns(fu.Schema,{U:n.u},n._rowCount),i=fu.getElementToAnsiotropFromLabel(r.label,n.label);return{data:a,elementToAnsiotrop:i}}}function Afe(e){return Zh.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}fu.Provider.formatRegistry.add("cifCore",wfe,Afe);var Zh;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,a){a||(a=zu.schema.cifCore(n));var i=a.database_code.depnum_ccdc_archive.value(0)||a.database_code.depnum_ccdc_fiz.value(0)||a.database_code.icsd.value(0)||a.database_code.mdf.value(0)||a.database_code.nbs.value(0)||a.database_code.csd.value(0)||a.database_code.cod.value(0)||a._name;return{kind:"cifCore",name:i,data:{db:a,frame:n}}}e.fromFrame=r})(Zh||(Zh={}));function Tfe(e){var t=Zh.fromFrame(e);return Be.create("Parse CIF Core",function(r){return _fe(t.data.db,t,r)})}function Pfe(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return r=e.atoms,n=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),a=ce.ofConst("A",e.atoms.count,ce.Schema.str),i=ce.ofArray({array:ce.mapToArray(r.number,function(d){return nae(d)}),schema:ce.Schema.Aliased(ce.Schema.str)}),o=ce.ofConst(1,r.count,ce.Schema.int),s=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:a,auth_atom_id:i,auth_comp_id:n,auth_seq_id:o,Cartn_x:ce.asArrayColumn(r.x,Float32Array),Cartn_y:ce.asArrayColumn(r.y,Float32Array),Cartn_z:ce.asArrayColumn(r.z,Float32Array),id:ce.range(0,r.count-1),label_asym_id:a,label_atom_id:i,label_comp_id:n,label_seq_id:o,label_entity_id:ce.ofConst("1",r.count,ce.Schema.str),occupancy:ce.ofConst(1,r.count,ce.Schema.float),type_symbol:i,pdbx_PDB_model_num:ce.ofConst(1,r.count,ce.Schema.int)},r.count),u=new Dl,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),c=new Il(o,i),c.setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0),l=nd({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:s}),[4,dc(l,jw.create(e),t)];case 1:return[2,f.sent()]}})})}var jw;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(jw||(jw={}));function Efe(e){return Be.create("Parse Cube",function(t){return Pfe(e,t)})}var Ww=et.skipWhitespace,Tk=et.eatValue,Go=et.markLine,Ho=et.getTokenString,Pk=et.readLine;function Ife(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function Dfe(e,t){return{tokenizer:e,molecule:Ife(),runtimeCtx:t}}var Ek=/\s+/g;function Mfe(e){for(var t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Go(t);Go(t),r.mol_name=Ho(t),Go(t);var n=Ho(t).trim().split(Ek);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Go(t);var a=Ho(t);if(!a.startsWith("@<TRIPOS>")){r.mol_type=a,Go(t);var i=Ho(t);if(!i.startsWith("@<TRIPOS>")){r.charge_type=i,Go(t);var o=Ho(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Go(t);var s=Ho(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function Rfe(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w;return ae(this,function(T){switch(T.label){case 0:for(t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Go(t);return n=t.position,a=t.lineNumber,i=Pk(t),o=i.trim().split(/\s+/g),s=o.length,u=qe.create(t.data,r.num_atoms*2),c=qe.create(t.data,r.num_atoms*2),l=qe.create(t.data,r.num_atoms*2),f=qe.create(t.data,r.num_atoms*2),d=qe.create(t.data,r.num_atoms*2),m=qe.create(t.data,r.num_atoms*2),p=qe.create(t.data,r.num_atoms*2),v=qe.create(t.data,r.num_atoms*2),h=qe.create(t.data,r.num_atoms*2),g=qe.create(t.data,r.num_atoms*2),y=ce.Undefined(r.num_atoms,ce.Schema.float),b=ce.Undefined(r.num_atoms,ce.Schema.int),x=ce.Undefined(r.num_atoms,ce.Schema.str),t.position=n,t.lineNumber=a,C=t.length,_=0,[4,Fu(e.runtimeCtx,1e5,void 0,function(A){for(var D=Math.min(r.num_atoms-_,A),E=0;E<D;E++)for(var M=0;M<s;M++)switch(Ww(t),t.tokenStart=t.position,Tk(t),M){case 0:qe.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:qe.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:qe.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:qe.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 4:qe.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 5:qe.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 6:qe.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 7:qe.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 8:qe.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 9:qe.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return _+=D,D},function(A){return A.update({message:"Parsing...",current:t.position,max:C})})];case 1:return T.sent(),w={count:r.num_atoms,atom_id:Zt(u)(ce.Schema.int),atom_name:Zt(c)(ce.Schema.str),x:Zt(l)(ce.Schema.float),y:Zt(f)(ce.Schema.float),z:Zt(d)(ce.Schema.float),atom_type:s>5?Zt(m)(ce.Schema.str):x,subst_id:s>6?Zt(p)(ce.Schema.int):b,subst_name:s>7?Zt(v)(ce.Schema.str):x,charge:s>8?Zt(h)(ce.Schema.float):y,status_bit:s>9?Zt(g)(ce.Schema.str):x},[2,w]}})})}function Bfe(e){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:for(t=e.tokenizer,r=e.molecule;Ho(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Go(t);return n=t.position,a=t.lineNumber,i=Pk(t),o=i.trim().split(/\s+/g),s=o.length,u=qe.create(t.data,r.num_bonds*2),c=qe.create(t.data,r.num_bonds*2),l=qe.create(t.data,r.num_bonds*2),f=qe.create(t.data,r.num_bonds*2),d=qe.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=a,m=t.length,p=0,[4,Fu(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-p,g),b=0;b<y;b++)for(var x=0;x<s;x++)switch(Ww(t),t.tokenStart=t.position,Tk(t),x){case 0:qe.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:qe.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:qe.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 3:qe.addUnchecked(f,t.tokenStart,t.tokenEnd);break;default:qe.addUnchecked(d,t.tokenStart,t.tokenEnd);break}return p+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:m})})];case 1:return h.sent(),v={count:r.num_bonds,bond_id:Zt(u)(ce.Schema.int),origin_atom_id:Zt(c)(ce.Schema.int),target_atom_id:Zt(l)(ce.Schema.int),bond_type:Zt(f)(ce.Schema.str),status_bits:s>4?Zt(d)(ce.Schema.str):ce.Undefined(r.num_bonds,ce.Schema.str)},[2,v]}})})}function Ffe(e){for(var t=e.tokenizer;t.position<t.data.length;){var r=Ho(t);if(r==="@<TRIPOS>MOLECULE")return;if(r==="@<TRIPOS>CRYSIN")break;Go(t)}if(!(t.position>=t.data.length)){Go(t);var n=Ho(t).trim().split(Ek);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}}function Ofe(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:n=et(t),e.update({message:"Parsing...",current:0,max:t.length}),a=[],l.label=1;case 1:return n.position<t.length?(i=Dfe(n,e),Mfe(i),[4,Rfe(i)]):[3,4];case 2:return o=l.sent(),[4,Bfe(i)];case 3:for(s=l.sent(),u=Ffe(i),a.push({molecule:i.molecule,atoms:o,bonds:s,crysin:u}),Ww(n);Ho(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Go(n);return[3,1];case 4:return c={name:r,structures:a},[2,$r.success(c)]}})})}function kfe(e,t){var r=this;return Be.create("Parse MOL2",function(n){return ie(r,void 0,void 0,function(){return ae(this,function(a){switch(a.label){case 0:return[4,Ofe(n,e,t)];case 1:return[2,a.sent()]}})})})}function Lfe(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F;return ae(this,function(O){switch(O.label){case 0:r=[],n=0,a=e.structures.length,O.label=1;case 1:if(!(n<a))return[3,4];for(i=e.structures[n],o=i.molecule,s=i.atoms,u=i.bonds,c=i.crysin,l=ce.ofConst("A",s.count,ce.Schema.str),f=new Array(s.count),d=!1,m=0;m<s.count;++m)if(s.atom_type.value(m).includes(".")){d=!0;break}for(p=0;p<s.count;++p)f[p]=d?s.atom_type.value(p).split(".")[0].toUpperCase():A1(s.atom_name.value(p));for(v=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:l,auth_atom_id:ce.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ce.asArrayColumn(s.x,Float32Array),Cartn_y:ce.asArrayColumn(s.y,Float32Array),Cartn_z:ce.asArrayColumn(s.z,Float32Array),id:ce.asArrayColumn(s.atom_id),label_asym_id:l,label_atom_id:ce.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ce.ofConst("1",s.count,ce.Schema.str),occupancy:ce.ofConst(1,s.count,ce.Schema.float),type_symbol:ce.ofStringArray(f),pdbx_PDB_model_num:ce.ofConst(n,s.count,ce.Schema.int)},s.count),h=new Dl,h.setNames([["MOL",o.mol_name||"Unknown Entity"]]),h.getEntityId("MOL",0,"A"),g=new Il(s.subst_id,s.atom_name),y=0,b=s.subst_name.rowCount;y<b;++y)g.add(s.subst_name.value(y),y);return x=nd({entity:h.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:v}),[4,dc(x,Xw.create(e),t)];case 2:C=O.sent(),C.frameCount>0&&(_=ce.ofIntArray(ce.mapToArray(u.origin_atom_id,function(U){return U-1},Int32Array)),w=ce.ofIntArray(ce.mapToArray(u.target_atom_id,function(U){return U-1},Int32Array)),T=u.bond_id,A=ce.ofIntArray(ce.mapToArray(u.bond_type,function(U){switch(U){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(U)}},Int8Array)),D=ce.ofIntArray(ce.mapToArray(u.bond_type,function(U){switch(U){case"ar":return 16|1;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),E=La.fromData({pairs:{key:T,indexA:_,indexB:w,order:A,flag:D},count:s.count}),M=C.representative,La.Provider.set(M,E),cp.Provider.set(M,{data:s.charge,type:o.charge_type}),c&&(F=Nfe(c),F&&_n.Provider.set(M,F)),r.push(M)),O.label=3;case 3:return++n,[3,1];case 4:return[2,new ud(r)]}})})}function Nfe(e){if(e.setting===1){var t=pi.create(e.spaceGroup,S.create(e.a,e.b,e.c),S.scale(S(),S.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:Mo.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}}var Xw;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(Xw||(Xw={}));function Ufe(e){return Be.create("Parse MOL2",function(t){return Lfe(e,t)})}var pp=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),Yw=9,Ui;(function(e){function t(l){for(var f=1,d=0;l>=f&&d<32;)d++,f<<=1;return d}e.sizeOfInt=t;var r=new Uint8Array(32);function n(l,f){var d=1,m=0;r[0]=1;for(var p=0;p<l;p++){var v=void 0,h=0;for(v=0;v<d;v++)h+=r[v]*f[p],r[v]=h&255,h>>=8;for(;h!==0;)r[v++]=h&255,h>>=8;d=v}var g=1;for(d--;r[d]>=g;)m++,g*=2;return m+d*8}e.sizeOfInts=n;var a=new ArrayBuffer(8*3);e.buf=new Int32Array(a);var i=new Uint32Array(a);function o(l,f,d){for(var m=d,p=(1<<m)-1,v=i[1],h=i[2],g=e.buf[0],y=0;m>=8;)h=h<<8|l[f+g++],y|=h>>v<<m-8,m-=8;return m>0&&(v<m&&(v+=8,h=h<<8|l[f+g++]),v-=m,y|=h>>v&(1<<m)-1),y&=p,e.buf[0]=g,e.buf[1]=v,e.buf[2]=h,y}e.decodeBits=o;function s(l,f){var d=i[2],m=e.buf[0];return d=d<<8|l[f+m],e.buf[0]=m+1,e.buf[2]=d,d>>i[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function c(l,f,d,m,p){var v=d,h=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;v>8;)u[h++]=s(l,f),v-=8;v>0&&(u[h++]=o(l,f,v));for(var g=2;g>0;g--){for(var y=0,b=m[g],x=h-1;x>=0;x--){y=y<<8|u[x];var C=y/b|0;u[x]=C,y=y-C*b}p[g]=y}p[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=c})(Ui||(Ui={}));function zfe(){throw new Error("(xdrfile error) Undefined error.")}function Vfe(e,t){return ie(this,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,y,b,x,C,_,w,T,A,D,E,M,F,y,O,U,N,q,j;return ae(this,function(Q){switch(Q.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},a=n.frames,i=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0],f=[.1,.1,.1],d=[.1,.1,.1],m=0,p=Ui.buf,Q.label=1;case 1:for(v=void 0,h=r.getInt32(m+4),m+=12,o.push(r.getFloat32(m)),m+=4,g=new Float32Array(9),y=0;y<9;++y)g[y]=r.getFloat32(m)*10,m+=4;if(i.push(g),h<=9)for(v={count:h/3,x:new Float32Array(h/3),y:new Float32Array(h/3),z:new Float32Array(h/3)},y=0;y<h/3;++y)v.x[y]=r.getFloat32(m),v.y[y]=r.getFloat32(m),v.z[y]=r.getFloat32(m),m+=4;else{for(p[0]=p[1]=p[2]=0,u[0]=u[1]=u[2]=0,l[0]=l[1]=l[2]=0,c[0]=c[1]=c[2]=0,f[0]=f[1]=f[2]=0,d[0]=d[1]=d[2]=0,v={count:h,x:new Float32Array(h),y:new Float32Array(h),z:new Float32Array(h)},b=0,x=r.getInt32(m),m+=4,C=r.getFloat32(m),m+=4,s[0]=r.getInt32(m),s[1]=r.getInt32(m+4),s[2]=r.getInt32(m+8),s[3]=r.getInt32(m+12),s[4]=r.getInt32(m+16),s[5]=r.getInt32(m+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,m+=24,_=void 0,(u[0]|u[1]|u[2])>16777215?(c[0]=Ui.sizeOfInt(u[0]),c[1]=Ui.sizeOfInt(u[1]),c[2]=Ui.sizeOfInt(u[2]),_=0):_=Ui.sizeOfInts(3,u),w=r.getInt32(m),m+=4,T=w-1,T=Yw>T?Yw:T,A=pp[T]/2|0,D=pp[w]/2|0,l[0]=l[1]=l[2]=pp[w],E=Math.ceil(r.getInt32(m)/4)*4,m+=4,M=1/C,F=0,y=0,f[0]=f[1]=f[2]=0;y<x;){if(_===0?(f[0]=Ui.decodeBits(t,m,c[0]),f[1]=Ui.decodeBits(t,m,c[1]),f[2]=Ui.decodeBits(t,m,c[2])):Ui.decodeInts(t,m,_,u,f),y++,f[0]+=s[0],f[1]+=s[1],f[2]+=s[2],d[0]=f[0],d[1]=f[1],d[2]=f[2],O=Ui.decodeBits(t,m,1),U=0,O===1&&(F=Ui.decodeBits(t,m,5),U=F%3,F-=U,U--),F>0)for(f[0]=f[1]=f[2]=0,N=0;N<F;N+=3)Ui.decodeInts(t,m,w,l,f),y++,f[0]+=d[0]-D,f[1]+=d[1]-D,f[2]+=d[2]-D,N===0?(q=f[0],f[0]=d[0],d[0]=q,q=f[1],f[1]=d[1],d[1]=q,q=f[2],f[2]=d[2],d[2]=q,v.x[b]=d[0]*M,v.y[b]=d[1]*M,v.z[b]=d[2]*M,b++):(d[0]=f[0],d[1]=f[1],d[2]=f[2]),v.x[b]=f[0]*M,v.y[b]=f[1]*M,v.z[b]=f[2]*M,b++;else v.x[b]=f[0]*M,v.y[b]=f[1]*M,v.z[b]=f[2]*M,b++;w+=U,U<0?(D=A,w>Yw?A=pp[w-1]/2|0:A=0):U>0&&(A=D,D=pp[w]/2|0),l[0]=l[1]=l[2]=pp[w],(l[0]===0||l[1]===0||l[2]===0)&&zfe()}m+=E}for(j=0;j<h;j++)v.x[j]*=10,v.y[j]*=10,v.z[j]*=10;return a.push(v),e.shouldUpdate?[4,e.update({current:m,max:t.length})]:[3,3];case 2:Q.sent(),Q.label=3;case 3:return m>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function Gfe(e){var t=this;return Be.create("Parse XTC",function(r){return ie(t,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,Vfe(r,e)];case 1:return n=i.sent(),[2,$r.success(n)];case 2:return a=i.sent(),[2,$r.error(""+a)];case 3:return[2]}})})})}function Hfe(e){var t=this;return Be.create("Parse XTC",function(r){return ie(t,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(d.sent(),n=El(e.deltaTime,"step"),a=El(e.timeOffset,n.unit),i=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],c=S.fromArray(S(),u,0),l=S.fromArray(S(),u,3),f=S.fromArray(S(),u,6),i.push({elementCount:e.frames[o].count,cell:ed.fromBasis(c,l,f),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:El(a.value+n.value*o,n.unit)});return[2,Eh.create(i,n,a)]}})})})}function qfe(e){var t=e.position>=e.data.length-1?0:+et.readLine(e);isNaN(t)&&(t=0);for(var r=et.readLine(e),n=new Float64Array(t),a=new Float64Array(t),i=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=et.readLineTrim(e),c=u.split(/\s+/g);o[s]=c[0],n[s]=+c[1],a[s]=+c[2],i[s]=+c[3]}return{count:t,comment:r,x:ce.ofFloatArray(n),y:ce.ofFloatArray(a),z:ce.ofFloatArray(i),type_symbol:ce.ofStringArray(o)}}function jfe(e){for(var t=et(e),r=[];;){var n=qfe(t);if(n.count===0)break;r.push(n)}var a={molecules:r};return $r.success(a)}function Wfe(e){var t=this;return Be.create("Parse Mol",function(){return ie(t,void 0,void 0,function(){return ae(this,function(r){return[2,jfe(e)]})})})}function Xfe(e,t){for(var r=e.molecules,n=0,a=0,i=r;a<i.length;a++){var o=i[a];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),c=new Float32Array(n),l=new Float32Array(n),f=new Float32Array(n),d=new Int32Array(n),m=0,p=0;p<r.length;p++)for(var o=r[p],v=0;v<o.count;v++)s[m]=o.type_symbol.value(v),c[m]=o.x.value(v),l[m]=o.y.value(v),f[m]=o.z.value(v),u[m]=v,d[m]=p,m++;var h=ce.ofConst("MOL",n,ce.Schema.str),g=ce.ofConst("A",n,ce.Schema.str),y=ce.ofConst(1,n,ce.Schema.int),b=ce.ofStringArray(s),x=Ar.ofPartialColumns(gi.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:h,auth_seq_id:y,Cartn_x:ce.ofFloatArray(c),Cartn_y:ce.ofFloatArray(l),Cartn_z:ce.ofFloatArray(f),id:ce.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:h,label_seq_id:y,label_entity_id:ce.ofConst("1",n,ce.Schema.str),occupancy:ce.ofConst(1,n,ce.Schema.float),type_symbol:b,pdbx_PDB_model_num:ce.ofIntArray(d)},n),C=new Dl;C.setNames([["MOL","Unknown Entity"]]),C.getEntityId("MOL",0,"A");var _=new Il(y,b);_.setNames([["MOL","Unknown Molecule"]]),_.add("MOL",0);var w=nd({entity:C.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:x});return dc(w,Kw.create(e),t)}var Kw;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(Kw||(Kw={}));function Yfe(e){return Be.create("Parse XYZ",function(t){return Xfe(e,t)})}function Kfe(e){return e.trim().endsWith("V3000")}function Qfe(e){var t=qe.create(e.data,1),r=qe.create(e.data,1);return et.eatLine(e),pc(e),pc(e),pc(e),vc(e,t),vc(e,r),et.eatLine(e),{atomCount:Zt(t)(ce.Schema.int).value(0),bondCount:Zt(r)(ce.Schema.int).value(0)}}function Zfe(e,t){for(var r=qe.create(e.data,t*2),n=qe.create(e.data,t*2),a=qe.create(e.data,t*2),i=qe.create(e.data,t*2),o=0;o<t;++o){et.markLine(e),pc(e),pc(e),pc(e);var s=e.position;vc(e,i),vc(e,r),vc(e,n),vc(e,a),e.position=s}return et.eatLine(e),et.eatLine(e),{count:t,x:Zt(r)(ce.Schema.float),y:Zt(n)(ce.Schema.float),z:Zt(a)(ce.Schema.float),type_symbol:Zt(i)(ce.Schema.str),formal_charge:ce.ofConst(0,t,ce.Schema.int)}}function $fe(e,t){for(var r=qe.create(e.data,t*2),n=qe.create(e.data,t*2),a=qe.create(e.data,t*2),i=0;i<t;++i){et.markLine(e),pc(e),pc(e),pc(e);var o=e.position;vc(e,a),vc(e,r),vc(e,n),e.position=o}return et.eatLine(e),et.eatLine(e),{count:t,atomIdxA:Zt(r)(ce.Schema.float),atomIdxB:Zt(n)(ce.Schema.float),order:Zt(a)(ce.Schema.float)}}function pc(e){et.skipWhitespace(e),et.eatValue(e)}function vc(e,t){var r=e.position;et.skipWhitespace(e),et.eatValue(e),et.trim(e,r,e.position),qe.addUnchecked(t,e.tokenStart,e.tokenEnd)}var Qw="$$$$";function Jfe(e){for(var t=qe.create(e.data,32),r=qe.create(e.data,32);e.position<e.length;){var n=et.readLine(e);if(n.startsWith(Qw))break;if(!!n&&n.startsWith("> ")){qe.add(t,e.tokenStart+2,e.tokenEnd),et.markLine(e);for(var a=e.tokenStart,i=e.tokenEnd,o=!1;e.position<e.length;){var s=et.readLine(e);if(!s||s.startsWith(Qw)||s.startsWith("> ")){qe.add(r,a,i),o=!0;break}i=e.tokenEnd}o||qe.add(r,a,i)}}return{dataHeader:Zt(t)(ce.Schema.str),data:Zt(r)(ce.Schema.str)}}function ede(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function tde(e){var t=et.readLine(e).trim(),r=et.readLine(e).trim(),n=et.readLine(e).trim(),a=et.readLine(e),i=Kfe(a),o=i?Qfe(e):ede(a),s=o.atomCount,u=o.bondCount;if(Number.isNaN(s)||Number.isNaN(u)){for(;e.position<e.length;){var c=et.readLine(e);if(c.startsWith(Qw))break}return}var l={atomIdx:ce.ofConst(0,s,ce.Schema.int),charge:ce.ofConst(0,s,ce.Schema.int)},f=i?Zfe(e,s):Ck(e,s),d=i?$fe(e,u):_k(e,u),m=i?l:wk(e),p=Jfe(e);return{molFile:{title:t,program:r,comment:n,atoms:f,bonds:d,formalCharges:m},dataItems:p}}function rde(e){for(var t=et(e),r=[];t.position<t.length;){var n=tde(t);n&&r.push(n)}return $r.success({compounds:r})}function nde(e){var t=this;return Be.create("Parse Sdf",function(){return ie(t,void 0,void 0,function(){return ae(this,function(r){return[2,rde(e)]})})})}var Zw;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(Zw||(Zw={}));function ade(e){return Be.create("Parse SDF",function(t){return Ak(e.molFile,Zw.create(e),t)})}var ide=bt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Be.create("Parse DCD",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,BQ(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,Yne(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new fe.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),ode=bt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return Be.create("Parse XTC",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,Gfe(r.data).runInContext(n)];case 1:if(a=o.sent(),a.isError)throw new Error(a.message);return[4,Hfe(a.result).runInContext(n)];case 2:return i=o.sent(),[2,new fe.Molecule.Coordinates(i,{label:r.label,description:"Coordinates"})]}})})})}}),sde=bt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[fe.Format.Psf],to:fe.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return Be.create("Create Topology",function(n){return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,sle(r.data).runInContext(n)];case 1:return a=i.sent(),[2,new fe.Molecule.Topology(a,{label:a.label||r.label,description:"Topology"})]}})})})}});function ude(e,t,r){return ie(this,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return t.type!==fe.Molecule.Topology.type?[3,2]:(n=t.data,[4,jt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,i.sent()];case 2:if(t.type===fe.Molecule.Model.type)return a=t.data,[2,jt.trajectoryFromModelAndCoordinates(a,r)];i.label=3;case 3:throw new Error("no model/topology found")}})})}var Ik=bt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:fe.Root,to:fe.Molecule.Trajectory,params:{modelRef:P.Text("",{isHidden:!0}),coordinatesRef:P.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return Be.create("Create trajectory from model/topology and coordinates",function(a){return ie(t,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return i=n[r.coordinatesRef].data,[4,ude(a,n[r.modelRef],i)];case 1:return o=u.sent(),s={label:"Trajectory",description:"".concat(o.frameCount," model").concat(o.frameCount===1?"":"s")},[2,new fe.Molecule.Trajectory(o,s)]}})})})}}),cde=bt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:fe.Format.Blob,to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse Format Blob",function(n){return ie(t,void 0,void 0,function(){var a,i,o,s,u,c,l,f,l,d;return ae(this,function(m){switch(m.label){case 0:a=[],i=0,o=r.data,m.label=1;case 1:return i<o.length?(s=o[i],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,q6(u).runInContext(n)])):[3,7];case 2:if(c=m.sent(),c.frameCount===0)throw new Error("No models found.");l=0,m.label=3;case 3:return l<c.frameCount?[4,Be.resolveInContext(c.getFrameAtIndex(l),n)]:[3,6];case 4:f=m.sent(),a.push(f),m.label=5;case 5:return l++,[3,3];case 6:return i++,[3,1];case 7:for(l=0;l<a.length;l++)jt.TrajectoryInfo.set(a[l],{index:l,size:a.length});return d={label:"Trajectory",description:"".concat(a.length," model").concat(a.length===1?"":"s")},[2,new fe.Molecule.Trajectory(new ud(a),d)]}})})})}});function hc(e){var t=e.representative;return{label:"".concat(t.entry),description:"".concat(e.frameCount," model").concat(e.frameCount===1?"":"s")}}var lde=bt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:P.Optional(P.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:P.Optional(P.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Parse mmCIF",function(a){return ie(t,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){switch(c.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(l){return l.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return[4,q6(o).runInContext(a)];case 1:if(s=c.sent(),s.frameCount===0)throw new Error("No models found.");return u=hc(s),[2,new fe.Molecule.Trajectory(s,u)]}})})})}}),fde=bt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory,params:{isPdbqt:P.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Parse PDB",function(a){return ie(t,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return[4,qQ(r.data,r.label,n.isPdbqt).runInContext(a)];case 1:if(i=u.sent(),i.isError)throw new Error(i.message);return[4,ile(i.result).runInContext(a)];case 2:return o=u.sent(),s=hc(o),[2,new fe.Molecule.Trajectory(o,s)]}})})})}}),dde=bt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse GRO",function(n){return ie(t,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return[4,HQ(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,Vce(a.result).runInContext(n)];case 2:return i=s.sent(),o=hc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),mde=bt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse XYZ",function(n){return ie(t,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return[4,Wfe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,Yfe(a.result).runInContext(n)];case 2:return i=s.sent(),o=hc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),pde=bt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse MOL",function(n){return ie(t,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return[4,bfe(r.data).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,xfe(a.result).runInContext(n)];case 2:return i=s.sent(),o=hc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),vde=bt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse SDF",function(n){return ie(t,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return[4,nde(r.data).runInContext(n)];case 1:if(a=v.sent(),a.isError)throw new Error(a.message);i=[],o=0,s=a.result.compounds,v.label=2;case 2:return o<s.length?(u=s[o],[4,ade(u).runInContext(n)]):[3,8];case 3:c=v.sent(),l=0,v.label=4;case 4:return l<c.frameCount?(d=(f=i).push,[4,Be.resolveInContext(c.getFrameAtIndex(l),n)]):[3,7];case 5:d.apply(f,[v.sent()]),v.label=6;case 6:return l++,[3,4];case 7:return o++,[3,2];case 8:return m=new ud(i),p=hc(m),[2,new fe.Molecule.Trajectory(m,p)]}})})})}}),hde=bt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse MOL2",function(n){return ie(t,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return[4,kfe(r.data,r.label).runInContext(n)];case 1:if(a=s.sent(),a.isError)throw new Error(a.message);return[4,Ufe(a.result).runInContext(n)];case 2:return i=s.sent(),o=hc(i),[2,new fe.Molecule.Trajectory(i,o)]}})})})}}),gde=bt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:fe.Format.Cube,to:fe.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return Be.create("Parse MOL",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,Efe(r.data).runInContext(n)];case 1:return a=o.sent(),i=hc(a),[2,new fe.Molecule.Trajectory(a,i)]}})})})}}),yde=bt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:P.Optional(P.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:P.Optional(P.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Parse CIF Core",function(a){return ie(t,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){switch(c.label){case 0:if(i=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(l){return l.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return[4,Tfe(o).runInContext(a)];case 1:if(s=c.sent(),s.frameCount===0)throw new Error("No models found.");return u=hc(s),[2,new fe.Molecule.Trajectory(s,u)]}})})})}}),bde=function(e){return e+1},xde=function(e){return e-1},Sde=bt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Model,params:function(e){return e?{modelIndex:P.Converted(bde,xde,P.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:P.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Model from Trajectory",function(a){return ie(t,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){switch(c.label){case 0:return i=n.modelIndex%r.data.frameCount,i<0&&(i+=r.data.frameCount),[4,Be.resolveInContext(r.data.getFrameAtIndex(i),a)];case 1:return o=c.sent(),s="Model ".concat(i+1),u=r.data.frameCount===1?void 0:"of ".concat(r.data.frameCount),[2,new fe.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Cde=bt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return Be.create("Build Structure",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,ke.ofTrajectory(r.data,n)];case 1:return a=o.sent(),i={label:"Ensemble",description:ke.elementDescription(a)},[2,new fe.Molecule.Structure(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),_de=bt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:fe.Molecule.Model,to:fe.Molecule.Structure,params:function(e){return fd.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return fd.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Build Structure",function(i){return ie(r,void 0,void 0,function(){return ae(this,function(o){return[2,fd.create(t,i,n.data,a&&a.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams;return Eu(n,a)?r.data.model===t.data?Ge.UpdateResult.Unchanged:jt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),Ge.UpdateResult.Updated):Ge.UpdateResult.Recreate:Ge.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Dk=S(),Mk=se(),Rk=se(),wde=bt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{transform:P.MappedStatic("components",{components:P.Group({axis:P.Vec3(S.create(1,0,0)),angle:P.Numeric(0,{min:-180,max:180,step:.1}),translation:P.Vec3(S.create(0,0,0))},{isFlat:!0}),matrix:P.Group({data:P.Mat4(se.identity()),transpose:P.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=se();if(r.transform.name==="components"){var a=r.transform.params,i=a.axis,o=a.angle,s=a.translation,u=t.data.boundary.sphere.center;se.fromTranslation(Mk,S.negate(Dk,u)),se.fromTranslation(Rk,S.add(Dk,u,s));var c=se.fromRotation(se(),Math.PI/180*o,S.normalize(S(),i));se.mul3(n,Rk,c,Mk)}else r.transform.name==="matrix"&&(se.copy(n,r.transform.params.data),r.transform.params.transpose&&se.transpose(n,n));var l=ke.transform(t.data,n);return new fe.Molecule.Structure(l,{label:t.label,description:"".concat(t.description," [Transformed]")})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Ade=bt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{expression:P.Value(ne.struct.generator.all,{isHidden:!0}),label:P.Optional(P.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Za.createAndRun(t.data,r.expression),i=a.selection,o=a.entry;if(n.entry=o,tt.isEmpty(i))return rn.Null;var s=tt.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:ke.elementDescription(s)};return new fe.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(n.expression!==a.expression)return Ge.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return Ge.UpdateResult.Unchanged;var s=Za.updateStructure(o,t.data);return tt.isEmpty(s)?Ge.UpdateResult.Null:(Za.updateStructureObject(r,s,a.label),Ge.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Tde=bt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:fe.Root,to:fe.Molecule.Structure.Selections,params:function(){return{selections:P.ObjectList({key:P.Text(void 0,{description:"A unique key."}),ref:P.Text(),groupId:P.Optional(P.Text()),expression:P.Value(ne.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:P.Optional(P.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:P.Optional(P.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,a=new Map,i=[],o=0,s=0,u=t.selections;s<u.length;s++){var c=u[s],l=Za.createAndRun(n[c.ref].data,c.expression),f=l.selection,d=l.entry;a.set(c.key,d);var m=tt.toLociWithSourceUnits(f);i.push({key:c.key,loci:m,groupId:c.groupId}),o+=_e.size(m)}r.entries=a;var p={label:"".concat(t.label||"Multi-selection"),description:"".concat(t.selections.length," source(s), ").concat(o," element(s) total")};return new fe.Molecule.Structure.Selections(i,p)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,a=e.cache,i=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return Ge.UpdateResult.Recreate;for(var o=a.entries,s=new Map,u=new Map,c=0,l=t.data;c<l.length;c++){var f=l[c];u.set(f.key,f)}for(var d=!1,m=0,p=[],v=0,h=n.selections;v<h.length;v++){var g=h[v],y=i[g.ref].data,b=!1;if(o.has(g.key)){var x=o.get(g.key);if(Za.isUnchanged(x,g.expression,y)&&u.has(g.key)){var C=u.get(g.key);C.groupId!==g.groupId&&(C.groupId=g.groupId,d=!0),s.set(g.key,x),p.push(C),m+=_e.size(C.loci);continue}if(x.expression!==g.expression)b=!0;else{var _=!1;if(n.isTransitive)if(ke.areUnitIdsAndIndicesEqual(x.originalStructure,y)){var w=Za.run(x,x.originalStructure);x.currentStructure=y,s.set(g.key,x);var C=_e.remap(tt.toLociWithSourceUnits(w),y);p.push({key:g.key,loci:C,groupId:g.groupId}),m+=_e.size(C),d=!0}else _=!0;else _=!0;if(_){d=!0;var w=Za.updateStructure(x,y);s.set(g.key,x);var C=tt.toLociWithSourceUnits(w);p.push({key:g.key,loci:C,groupId:g.groupId}),m+=_e.size(C)}}}else b=!0;if(b){d=!0;var T=Za.createAndRun(y,g.expression),w=T.selection,x=T.entry;s.set(g.key,x);var C=tt.toLociWithSourceUnits(w);p.push({key:g.key,loci:C}),m+=_e.size(C)}}return d?(a.entries=s,t.data=p,t.label="".concat(n.label||"Multi-selection"),t.description="".concat(p.length," source(s), ").concat(m," element(s) total"),Ge.UpdateResult.Updated):Ge.UpdateResult.Unchanged}}),Pde=bt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{script:P.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:P.Optional(P.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,a=Za.createAndRun(t.data,r.script),i=a.selection,o=a.entry;n.entry=o;var s=tt.unionStructure(i),u={label:"".concat(r.label||"Selection"),description:ke.elementDescription(s)};return new fe.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Gn.areEqual(n.script,a.script))return Ge.UpdateResult.Recreate;var o=i.entry;if(o.currentStructure===t.data)return Ge.UpdateResult.Unchanged;var s=Za.updateStructure(o,t.data);return Za.updateStructureObject(r,s,a.label),Ge.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Ede=bt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(){return{bundle:P.Value(Cr.Empty,{isHidden:!0}),label:P.Optional(P.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return rn.Null;n.source=t.data;var a=Cr.toStructure(r.bundle,t.data);if(a.elementCount===0)return rn.Null;var i={label:"".concat(r.label||"Selection"),description:ke.elementDescription(a)};return new fe.Molecule.Structure(a,i)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;if(!Cr.areEqual(n.bundle,a.bundle))return Ge.UpdateResult.Recreate;if(a.bundle.hash!==t.data.hashCode)return Ge.UpdateResult.Null;if(i.source===t.data)return Ge.UpdateResult.Unchanged;i.source=t.data;var o=Cr.toStructure(a.bundle,t.data);return o.elementCount===0?Ge.UpdateResult.Null:(r.label="".concat(a.label||"Selection"),r.description=ke.elementDescription(o),r.data=o,Ge.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Bk={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Ide=P.objectToOptions(Bk),Dde=bt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{type:P.Select("atomic-sequence",Ide,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,a;switch(r.type){case"polymer":n=Jn.polymer.query,a="Polymer";break;case"protein":n=Jn.protein.query,a="Protein";break;case"nucleic":n=Jn.nucleic.query,a="Nucleic";break;case"water":n=Fr.internal.water(),a="Water";break;case"branched":n=Jn.branchedPlusConnected.query,a="Branched";break;case"ligand":n=Jn.ligandPlusConnected.query,a="Ligand";break;case"non-standard":n=Jn.nonStandardPolymer.query,a="Non-standard";break;case"coarse":n=Jn.coarse.query,a="Coarse";break;case"atomic-sequence":n=Fr.internal.atomicSequence(),a="Sequence";break;case"atomic-het":n=Fr.internal.atomicHet(),a="HET Groups/Ligands";break;case"spheres":n=Fr.internal.spheres(),a="Coarse Spheres";break;default:throw new Error("".concat(r.type," is a not valid complex element."))}var i=n(new Uo(t.data)),o=tt.unionStructure(i);return o.elementCount===0?rn.Null:new fe.Molecule.Structure(o,{label:a,description:ke.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Mde=bt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:mfe})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return pfe(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,a=e.newParams,i=e.cache;return vfe(t.data,r,n,a,i)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Fk=bt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:fe.Molecule.Model,to:fe.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Custom Props",function(i){return ie(r,void 0,void 0,function(){return ae(this,function(o){switch(o.label){case 0:return[4,Ok(n.data,t,i,a)];case 1:return o.sent(),[2,new fe.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Be.create("Custom Props",function(s){return ie(r,void 0,void 0,function(){var u,c,l,f;return ae(this,function(d){switch(d.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)l=c[u],f=t.customModelProperties.get(l),!!f&&n.data.customProperties.reference(f.descriptor,!1);return[4,Ok(n.data,t,s,o)];case 1:return d.sent(),[2,Ge.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function Ok(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),m.label=1;case 1:if(!(s<u.length))return[3,8];if(c=u[s],l=t.customModelProperties.get(c),f=o[c],!(i.includes(c)||l.isHidden))return[3,6];m.label=2;case 2:return m.trys.push([2,4,,5]),[4,l.attach(a,e,f,!0)];case 3:return m.sent(),[3,5];case 4:return d=m.sent(),t.log.warn("Error attaching model prop '".concat(c,"': ").concat(d)),[3,5];case 5:return[3,7];case 6:l.set(e,f),m.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var kk=bt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Custom Props",function(i){return ie(r,void 0,void 0,function(){return ae(this,function(o){switch(o.label){case 0:return[4,Lk(n.data.root,t,i,a)];case 1:return o.sent(),[2,new fe.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return n.data!==a.data?Ge.UpdateResult.Recreate:Be.create("Custom Props",function(s){return ie(r,void 0,void 0,function(){var u,c,l,f;return ae(this,function(d){switch(d.label){case 0:for(a.data=n.data,a.label=n.label,a.description=n.description,u=0,c=i.autoAttach;u<c.length;u++)l=c[u],f=t.customStructureProperties.get(l),!!f&&n.data.customPropertyDescriptors.reference(f.descriptor,!1);return[4,Lk(n.data.root,t,s,o)];case 1:return d.sent(),[2,Ge.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function Lk(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:a={runtime:r,assetManager:t.managers.asset},i=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),m.label=1;case 1:if(!(s<u.length))return[3,8];if(c=u[s],l=t.customStructureProperties.get(c),f=o[c],!(i.includes(c)||l.isHidden))return[3,6];m.label=2;case 2:return m.trys.push([2,4,,5]),[4,l.attach(a,e,f,!0)];case 3:return m.sent(),[3,5];case 4:return d=m.sent(),t.log.warn("Error attaching structure prop '".concat(c,"': ").concat(d)),[3,5];case 5:return[3,7];case 6:l.set(e,f),m.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var Rde=bt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:fe.Format.Ply,to:fe.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,Be.create("Create shape from PLY",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,Wne(r.data).runInContext(n)];case 1:return a=o.sent(),i={label:"Shape"},[2,new fe.Shape.Provider(a,i)]}})})})}}),Bde=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",CoordinatesFromDcd:ide,CoordinatesFromXtc:ode,TopologyFromPsf:sde,TrajectoryFromModelAndCoordinates:Ik,TrajectoryFromBlob:cde,TrajectoryFromMmCif:lde,TrajectoryFromPDB:fde,TrajectoryFromGRO:dde,TrajectoryFromXYZ:mde,TrajectoryFromMOL:pde,TrajectoryFromSDF:vde,TrajectoryFromMOL2:hde,TrajectoryFromCube:gde,TrajectoryFromCifCore:yde,ModelFromTrajectory:Sde,StructureFromTrajectory:Cde,StructureFromModel:_de,TransformStructureConformation:wde,StructureSelectionFromExpression:Ade,MultiStructureSelectionFromExpression:Tde,StructureSelectionFromScript:Pde,StructureSelectionFromBundle:Ede,StructureComplexElement:Dde,StructureComponent:Mde,CustomModelProperties:Fk,CustomStructureProperties:kk,ShapeFromPly:Rde,StructureComplexElementTypes:Bk});function Fde(e){return e.originX===0&&e.originY===0&&e.originZ===0?S.create(e.NCSTART,e.NRSTART,e.NSSTART):S.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function Ode(e){var t=PR(e);switch(t){case Ba.Float32:return Float32Array;case Ba.Int8:return Int8Array;case Ba.Int16:return Int16Array;case Ba.Uint16:return Uint16Array}throw Error("".concat(t," is not a supported value format."))}function kde(e,t){var r=this;return Be.create("Create Volume",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x;return ae(this,function(C){return a=e.header,i=e.values,o=S.create(a.xLength,a.yLength,a.zLength),t&&t.voxelSize&&S.mul(o,o,t.voxelSize),s=S.create(pr(a.alpha),pr(a.beta),pr(a.gamma)),u=a.ISPG>65536?0:a.ISPG,c=pi.create(u||"P 1",o,s),l=S.create(a.MAPC-1,a.MAPR-1,a.MAPS-1),f=sr.convertToCanonicalAxisIndicesFastToSlow(l),d=[a.NX,a.NY,a.NZ],m=f([a.NC,a.NR,a.NS]),p=Fde(a),(t==null?void 0:t.offset)&&S.add(p,p,t.offset),v=f(p),h=S.create(v[0]/d[0],v[1]/d[1],v[2]/d[2]),g=S.create(m[0]/d[0],m[1]/d[1],m[2]/d[2]),y=sr.Space(m,sr.invertAxisOrder(l),Ode(a)),b=sr.create(y,sr.Data1(i)),x=a.AMIN===0&&a.AMAX===0&&a.AMEAN===0&&a.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:c,fractionalBox:Bt.create(h,S.add(S.zero(),h,g))},cells:b,stats:{min:isNaN(a.AMIN)||x?Ty(i):a.AMIN,max:isNaN(a.AMAX)||x?js(i):a.AMAX,mean:isNaN(a.AMEAN)||x?Py(i):a.AMEAN,sigma:isNaN(a.ARMS)||a.ARMS===0?Ey(i):a.ARMS}},sourceData:$w.create(e),customProperties:new Js,_propertyData:Object.create(null)}]})})})}var $w;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})($w||($w={}));function Lde(e,t){var r=this;return Be.create("Create Volume",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){return a=e.header,i=e.values,o=S.create(a.xlen,a.ylen,a.zlen),t&&t.voxelSize&&S.mul(o,o,t.voxelSize),s=S.create(pr(a.alpha),pr(a.beta),pr(a.gamma)),u=pi.create("P 1",o,s),c=[a.xRate,a.yRate,a.zRate],l=[a.xExtent,a.yExtent,a.zExtent],f=[a.xStart,a.yStart,a.zStart],d=S.create(f[0]/c[0],f[1]/c[1],f[2]/c[2]),m=S.create(l[0]/c[0],l[1]/c[1],l[2]/c[2]),p=sr.Space(l,[0,1,2],Float32Array),v=sr.create(p,sr.Data1(i)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Bt.create(d,S.add(S.zero(),d,m))},cells:v,stats:{min:Ty(i),max:js(i),mean:Py(i),sigma:a.sigma!==void 0?a.sigma:Ey(i)}},sourceData:Jw.create(e),customProperties:new Js,_propertyData:Object.create(null)}]})})})}var Jw;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(Jw||(Jw={}));function Nde(e,t){var r=this;return Be.create("Create Volume",function(){return ie(r,void 0,void 0,function(){var n,a,i,o,s,u;return ae(this,function(c){return n=e.header,a=e.values,i=sr.Space(n.dim,[0,1,2],Float64Array),o=sr.create(i,sr.Data1(a)),s=se.fromTranslation(se(),n.min),u=se.fromScaling(se(),n.h),se.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:Ty(a),max:js(a),mean:Py(a),sigma:Ey(a)}},sourceData:eA.create(e),customProperties:new Js,_propertyData:Object.create(null)}]})})})}var eA;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(eA||(eA={}));var Ude=bt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:fe.Format.Ccp4,to:fe.Volume.Data,params:function(e){return{voxelSize:P.Vec3(S.create(1,1,1)),offset:P.Vec3(S.create(0,0,0)),entryId:P.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Create volume from CCP4/MRC/MAP",function(a){return ie(t,void 0,void 0,function(){var i,o;return ae(this,function(s){switch(s.label){case 0:return[4,kde(r.data,I(I({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.NX,"\xD7").concat(r.data.header.NX,"\xD7").concat(r.data.header.NX)},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),zde=bt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:fe.Format.Dsn6,to:fe.Volume.Data,params:function(e){return{voxelSize:P.Vec3(S.create(1,1,1)),entryId:P.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Create volume from DSN6/BRIX",function(a){return ie(t,void 0,void 0,function(){var i,o;return ae(this,function(s){switch(s.label){case 0:return[4,Lde(r.data,I(I({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.xExtent,"\xD7").concat(r.data.header.yExtent,"\xD7").concat(r.data.header.zExtent)},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Vde=bt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:fe.Format.Cube,to:fe.Volume.Data,params:function(e){var t=e?P.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,"".concat(r)]})):P.Numeric(0);return{dataIndex:t,entryId:P.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Create volume from Cube",function(a){return ie(t,void 0,void 0,function(){var i,o;return ae(this,function(s){switch(s.label){case 0:return[4,dre(r.data,I(I({},n),{label:r.data.name||r.label})).runInContext(a)];case 1:return i=s.sent(),o={label:i.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xD7").concat(r.data.header.dim[1],"\xD7").concat(r.data.header.dim[2])},[2,new fe.Volume.Data(i,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Gde=bt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:fe.Format.Dx,to:fe.Volume.Data})({apply:function(e){var t=this,r=e.a;return Be.create("Parse DX",function(n){return ie(t,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,Nde(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return a=o.sent(),i={label:a.label||"Volume",description:"Volume ".concat(r.data.header.dim[0],"\xD7").concat(r.data.header.dim[1],"\xD7").concat(r.data.header.dim[2])},[2,new fe.Volume.Data(a,i)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Hde=bt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Volume.Data,params:function(e){if(!e)return{blockHeader:P.Optional(P.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:P.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:P.Optional(P.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:P.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return Be.create("Parse density-server CIF",function(a){return ie(t,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:if(i=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(h){return h.header===i}),!o)throw new Error("Data block '".concat([i],"' not found."));return s=zu.schema.densityServer(o),[4,kF(s,{entryId:n.entryId}).runInContext(a)];case 1:return u=v.sent(),c=u.grid.cells.space.dimensions,l=c[0],f=c[1],d=c[2],m={label:(p=n.entryId)!==null&&p!==void 0?p:s.volume_data_3d_info.name.value(0),description:"Volume ".concat(l,"\xD7").concat(f,"\xD7").concat(d)},[2,new fe.Volume.Data(u,m)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),qde=bt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,to:fe.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:P.Text()};var r=t.state.data.select(Yt.Generators.root.subtree().ofType(fe.Volume.Data).filter(function(n){var a;return!!n.obj&&!((a=n.obj)===null||a===void 0?void 0:a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:P.Text("",{isHidden:!0})}:{ref:P.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,a=e.dependencies;return Be.create("Assign Color Volume",function(i){return ie(t,void 0,void 0,function(){var o,s,u;return ae(this,function(c){if(!a||!a[n.ref])throw new Error("Dependency not available.");return o=a[n.ref].data,s=I(I({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new fe.Volume.Data(s,u)]})})})}}),jde=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VolumeFromCcp4:Ude,VolumeFromDsn6:zde,VolumeFromCube:Vde,VolumeFromDx:Gde,AssignColorVolume:qde,VolumeFromDensityServerCif:Hde}),tb=st(13421772),Wde="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",Nk={};function Xde(e){return Nk}function Uk(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,a=n.elements,i=n.getElementIndices,o=function(s,u){if(!Re.isAtomic(s))return tb;var c=i(s,u);return c.length>0?a[c[0]].component.color:tb};r=function(s,u){return u?yt.Secondary:Qe.is(s)?o(s.unit,s.element):Pt.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):tb}}else r=function(){return tb};return{factory:Uk,granularity:"group",color:r,props:t,description:Wde,legend:xl(Jne)}}var Yde={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:Uk,getParams:Xde,defaultValues:P.getDefaultValues(Nk),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return jt.hasCarbohydrate(t)})}},zk={hue:P.Interval([1,360],{min:0,max:360,step:1}),chroma:P.Interval([40,70],{min:0,max:100,step:1}),luminance:P.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:P.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:P.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function Vk(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var vp=2,md=[0,0,0],pd=[0,0,0];function Kde(e,t){return ha.toHcl(md,e),ha.fromColor(pd,ha.toColor(e)),md[0]>=t.hue[0]&&md[0]<=t.hue[1]&&md[1]>=t.chroma[0]&&md[1]<=t.chroma[1]&&md[2]>=t.luminance[0]&&md[2]<=t.luminance[1]&&pd[0]>=e[0]-vp&&pd[0]<=e[0]+vp&&pd[1]>=e[1]-vp&&pd[1]<=e[1]+vp&&pd[2]>=e[2]-vp&&pd[2]<=e[2]+vp}function Qde(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],a=0,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=Vk(n,t[o]);s>i&&(i=s,a=o)}r.push(t.splice(a,1)[0])}return r}function Zde(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,a=(t.hue[1]-t.hue[0])/n,i=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=a)for(var u=t.chroma[0];u<=t.chroma[1];u+=i)for(var c=t.luminance[0];c<=t.luminance[1];c+=o){var l=ha.fromHcl(ha(),qs.create(s,u,c));Kde(l,t)&&r.set(l.toString(),l)}return Array.from(r.values())}function $de(e,t){t===void 0&&(t={});var r=I(I({},P.getDefaultValues(zk)),t);if(e<=0)return[];var n=Zde(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var a=[],i=[],o=Math.floor(n.length/e),s=0;s<n.length&&(a.push(n[s]),i.push([]),!(a.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var c=ol(i),s=0;s<n.length;++s){for(var l=Number.MAX_SAFE_INTEGER,f=0,d=0;d<a.length;d++){var m=Vk(n[s],a[d]);m<l&&(l=m,f=d)}c[f].push(n[s])}for(var p=ol(a),s=0;s<c.length;++s){for(var v=c[s],h=v.length,g=[],y=[],b=[],x=0,C=v;x<C.length;x++){var _=C[x];g.push(_[0]),y.push(_[1]),b.push(_[2])}var w=fh(g)/h,T=fh(y)/h,A=fh(b)/h;a[s]=[w,T,A]}if(Eu(p,a))break}return Qde(a).map(function(D){return ha.toColor(D)})}var Gk={type:"generate",colorList:"red-yellow-blue"};function so(e){e===void 0&&(e={});var t=I(I({},Gk),e);return{palette:P.MappedStatic(t.type,{colors:P.Group({list:P.ColorList(t.colorList)},{isFlat:!0}),generate:P.Group(I(I({},zk),{maxCount:P.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}P.getDefaultValues(so());var Hk={valueLabel:function(e){return"".concat(e+1)},minLabel:"Start",maxLabel:"End"};function qo(e,t,r){var n;r===void 0&&(r={});var a,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=I(I({},Hk),r),c=u.minLabel,l=u.maxLabel,f=o.colors;f.length===0&&(f=Mu(Gk.colorList).list);var d=xs.create({listOrName:f,domain:s,minLabel:c,maxLabel:l});i=d.legend,a=d.color}else{var m;t.palette.name==="colors"?(m=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),m.length===0&&(m=Mu("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),m=$de(e,t.palette.params));for(var p=(n=r.valueLabel)!==null&&n!==void 0?n:Hk.valueLabel,v=m.length,h=[],g=0;g<e;++g){var y=g%v;h[y]===void 0?h[y]=[p(g),m[y]]:h[y][0]+=", ".concat(p(g))}i=xl(h),a=function(b){return m[b%v]}}return{color:a,legend:i}}var Jde="many-distinct",qk=st(16448250),eme="Gives every chain a color based on its `asym_id` value.",rb=I({asymId:P.Select("auth",P.arrayToOptions(["auth","label"]))},so({type:"colors",colorList:Jde}));function tme(e){var t,r=P.clone(rb);return((t=e.structure)===null||t===void 0?void 0:t.models.some(function(n){return n.coarseHierarchy.isDefined}))&&(r.asymId.defaultValue="label"),r}function rme(e,t){switch(e.kind){case 0:return t==="auth"?ft.chain.auth_asym_id:ft.chain.label_asym_id;case 1:case 2:return ft.coarse.asym_id}}function jk(e,t){var r=rme(e.unit,t)(e);return e.structure.root.models.length>1?Wk(e.unit.model,r):r}function Wk(e,t){return"".concat(t,"|").concat((jt.Index.get(e).value||0)+1)}function nme(e,t){for(var r=new Map,n=function(s){var u=jt.AsymIdOffset.get(s).value,c=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,l=0;s.properties.structAsymMap.forEach(function(f,d){var m=f.auth_id,p=t==="auth"?m:d,v=e.models.length>1?Wk(s,p):p;r.has(v)||(r.set(v,l+c),++l)})},a=0,i=e.models;a<i.length;a++){var o=i[a];n(o)}return r}function nb(e,t){var r,n;if(e.structure){var a=Qe.create(e.structure.root),i=nme(e.structure.root,t.asymId),o=Array.from(i.keys()),s=function(c){return o[c]},u=qo(i.size,t,{valueLabel:s});n=u.legend,r=function(c){var l=void 0;if(Qe.is(c)){var f=jk(c,t.asymId);l=i.get(f)}else if(Pt.isLocation(c)){a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex];var f=jk(a,t.asymId);l=i.get(f)}return l===void 0?qk:u.color(l)}}else r=function(){return qk};return{factory:nb,granularity:"group",color:r,props:t,description:eme,legend:n}}var Xk={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:nb,getParams:tme,defaultValues:P.getDefaultValues(rb),isApplicable:function(e){return!!e.structure}},Yk=st(13421772),ame="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",Kk=I({},so({type:"colors",colorList:"red-yellow-blue"}));function ime(e){return Kk}function Qk(e,t){var r,n;if(e.structure){for(var a=e.structure.root.units,i=a.length,o=new Map,s=new Map,u=0,c=0;c<i;++c)o.set(c,u),u+=a[c].elements.length,s.set(a[c].id,c);var l=qo(u,t);n=l.legend,r=function(f){if(Qe.is(f)){var d=s.get(f.unit.id),m=De.findPredecessorIndex(a[d].elements,f.element);return l.color(o.get(d)+m)}else if(Pt.isLocation(f)){var d=s.get(f.aUnit.id),m=De.findPredecessorIndex(a[d].elements,f.aUnit.elements[f.aIndex]);return l.color(o.get(d)+m)}return Yk}}else r=function(){return Yk};return{factory:Qk,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:ame,legend:n}}var ome={name:"element-index",label:"Element Index",category:"Atom Property",factory:Qk,getParams:ime,defaultValues:P.getDefaultValues(Kk),isApplicable:function(e){return!!e.structure}};function ab(e){var t={};return wo(e,function(r,n){t[n]=P.Color(e[n])}),t}var sme="many-distinct",Zk=st(13421772),ume="Assigns a color based on the operator name of a transformed chain.",tA=I({},so({type:"colors",colorList:sme}));function cme(e){var t=P.clone(tA);return t}function lme(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var a=e.units[r].conformation.operator.name;t.has(a)||t.set(a,t.size)}return t}function rA(e,t){var r,n;if(e.structure){var a=lme(e.structure.root),i=Array.from(a.keys()),o=function(u){return i[u]},s=qo(a.size,t,{valueLabel:o});n=s.legend,r=function(u){var c=void 0;if(Qe.is(u)){var l=u.unit.conformation.operator.name;c=a.get(l)}else if(Pt.isLocation(u)){var f=u.aUnit.conformation.operator.name;c=a.get(f)}return c===void 0?Zk:s.color(c)}}else r=function(){return Zk};return{factory:rA,granularity:"instance",color:r,props:t,description:ume,legend:n}}var nA={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:rA,getParams:cme,defaultValues:P.getDefaultValues(tA),isApplicable:function(e){return!!e.structure}},fme="many-distinct",$k=st(16448250),dme="Gives every chain a color based on its `label_entity_id` value.",ib=I({},so({type:"colors",colorList:fme}));function mme(e){var t=P.clone(ib);return t}function $h(e,t){return"".concat(e,"|").concat(t)}function pme(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r){for(var a=e.models[r].atomicHierarchy.chains.label_entity_id,i=0,o=a.rowCount;i<o;++i){var s=$h(a.value(i),r);t.has(s)||t.set(s,t.size)}var u=e.models[r].coarseHierarchy;if(u.isDefined){for(var c=u.spheres.entity_id,i=0,o=c.rowCount;i<o;++i){var s=$h(c.value(i),r);t.has(s)||t.set(s,t.size)}for(var l=u.gaussians.entity_id,i=0,o=l.rowCount;i<o;++i){var s=$h(l.value(i),r);t.has(s)||t.set(s,t.size)}}}return t}function Jk(e){switch(e.unit.kind){case 0:return ft.chain.label_entity_id(e);case 1:case 2:return ft.coarse.entity_id(e)}}function ob(e,t){var r,n;if(e.structure){var a=Qe.create(e.structure.root),i=pme(e.structure.root),o=Array.from(i.keys()),s=function(c){return o[c]},u=qo(i.size,t,{valueLabel:s});n=u.legend,r=function(c){var l=void 0;if(Qe.is(c)){var f=Jk(c),d=c.structure.models.indexOf(c.unit.model),m=$h(f,d);l=i.get(m)}else if(Pt.isLocation(c)){a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex];var f=Jk(a),d=a.structure.models.indexOf(a.unit.model),m=$h(f,d);l=i.get(m)}return l===void 0?$k:u.color(l)}}else r=function(){return $k};return{factory:ob,granularity:"group",color:r,props:t,description:dme,legend:n}}var vme={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:ob,getParams:mme,defaultValues:P.getDefaultValues(ib),isApplicable:function(e){return!!e.structure}};function sb(e){return Object.keys(e)}function vd(e){throw new Error("unreachable")}function aA(e){return typeof(e==null?void 0:e.then)=="function"}var iA="dark-2",ub=st(16448250),hme="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",cb=I({},so({type:"colors",colorList:iA}));function gme(e){var t=P.clone(cb);return e.structure&&tL(e.structure.root.models).srcKeySerialMap.size>Di[iA].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=I(I({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Mu(iA).list}})),t}function eL(e,t){return"".concat(e,"|").concat(t)}function yme(e,t,r,n,a,i){return"".concat(e,"|").concat(t,"|").concat(r,"|").concat(i||a||n)}function oA(e,t,r,n,a,i,o,s){for(var u=a.entity_id,c=a.pdbx_src_id,l=a.pdbx_beg_seq_num,f=a.pdbx_end_seq_num,d=0,m=a._rowCount;d<m;++d){var p=u.value(d),v=eL(r,p),h=void 0;if(e.has(v))h=e.get(v);else{var g=n.entities.getEntityIndex(p),y=n.sequence.sequences[g].sequence;h=new Int16Array(y.length),e.set(v,h)}var b=o?o.value(d):"",x=s?s.value(d)[0]:"",C=yme(r,p,i.value(d),c.value(d),b,x),_=l.valueKind(d)===0?l.value(d):1,w=f.valueKind(d)===0?f.value(d):h.length,T=void 0;t.has(C)?T=t.get(C):(T=t.size+1,t.set(C,T));for(var A=_,D=w;A<=D;++A)h[A-1]=T}}function tL(e){for(var t=new Map,r=new Map,n=0,a=e.length;n<a;++n){var i=e[n];if(!!Or.is(i.sourceData)){var o=i.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,c=o.pdbx_entity_src_syn;oA(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),oA(t,r,n,i,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),oA(t,r,n,i,c,c.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function bme(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),a=n[2],i=aK(n[3])?"Unnamed ".concat(++t):n[3];return"".concat(i).concat(a?" (".concat(a,")"):"")})}function lb(e,t){var r,n;if(e.structure){var a=Qe.create(e.structure),i=e.structure.root.models,o=tL(i),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,c=bme(u),l=function(m){return c[m]},f=qo(u.size,t,{valueLabel:l});n=f.legend;var d=function(m){var p=i.indexOf(m.unit.model),v=ft.entity.id(m),h=eL(p,v),g=s.get(h);if(g){var y=g[ft.residue.label_seq_id(m)-1]-1;return y===-1?ub:f.color(y)}else return ub};r=function(m){return Qe.is(m)?d(m):Pt.isLocation(m)?(a.unit=m.aUnit,a.element=m.aUnit.elements[m.aIndex],d(a)):ub}}else r=function(){return ub};return{factory:lb,granularity:"group",color:r,props:t,description:hme,legend:n}}var xme={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:lb,getParams:gme,defaultValues:P.getDefaultValues(cb),isApplicable:function(e){return!!e.structure}},rL=Pf({H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215}),nL=st(16777215),Sme="Assigns a color to every atom according to its chemical element.",aL={carbonColor:P.MappedStatic("chain-id",{"chain-id":P.Group(rb),"entity-id":P.Group(ib),"entity-source":P.Group(cb),"operator-name":P.Group(tA),"element-symbol":P.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:P.Numeric(0,{min:-6,max:6,step:.1}),lightness:P.Numeric(.2,{min:-6,max:6,step:.1}),colors:P.MappedStatic("default",{default:P.EmptyGroup(),custom:P.Group(ab(rL))})};function Cme(e){return aL}function _me(e,t){var r=e[t];return r===void 0?nL:r}function iL(e,t){var r=hy(t.colors.name==="default"?rL:t.colors.params,t.saturation,t.lightness),n=t.carbonColor,a=n.name==="chain-id"?nb(e,n.params).color:n.name==="entity-id"?ob(e,n.params).color:n.name==="entity-source"?lb(e,n.params).color:n.name==="operator-name"?rA(e,n.params).color:n.name==="element-symbol"?void 0:vd();function i(u,c){return a&&u==="C"?a(c,!1):_me(r,u)}function o(u){if(Qe.is(u)){if(Re.isAtomic(u.unit)){var c=u.unit.model.atomicHierarchy.atoms.type_symbol;return i(c.value(u.element),u)}}else if(Pt.isLocation(u)&&Re.isAtomic(u.aUnit)){var c=u.aUnit.model.atomicHierarchy.atoms.type_symbol,l=c.value(u.aUnit.elements[u.aIndex]);return i(l,u)}return nL}var s=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:iL,granularity:s,preferSmoothing:!0,color:o,props:t,description:Sme,legend:xl(Object.keys(r).map(function(u){return[u,r[u]]}))}}var wme={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:iL,getParams:Cme,defaultValues:P.getDefaultValues(aL),isApplicable:function(e){return!!e.structure}},oL=Pf({water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655}),sA=st(16777113),Ame="Assigns a color based on the molecule type of a residue.",uA={saturation:P.Numeric(0,{min:-6,max:6,step:.1}),lightness:P.Numeric(0,{min:-6,max:6,step:.1}),colors:P.MappedStatic("default",{default:P.EmptyGroup(),custom:P.Group(ab(oL))})};function Tme(e){return uA}function sL(e,t,r){var n=yw(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return sA}function cA(e,t){var r=hy(t.colors.name==="default"?oL:t.colors.params,t.saturation,t.lightness);function n(a){return Qe.is(a)?sL(r,a.unit,a.element):Pt.isLocation(a)?sL(r,a.aUnit,a.aUnit.elements[a.aIndex]):sA}return{factory:cA,granularity:"group",color:n,props:t,description:Ame,legend:xl(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Other/unknown",sA]]))}}var Pme={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:cA,getParams:Tme,defaultValues:P.getDefaultValues(uA),isApplicable:function(e){return!!e.structure}},lA="dark-2",uL=st(16448250),Eme="Gives every polymer chain a color based on its `asym_id` value.",cL=I({},so({type:"colors",colorList:lA}));function Ime(e){var t=P.clone(cL);return e.structure&&fL(e.structure.root).size>Di[lA].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=I(I({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Mu(lA).list}})),t}function lL(e){switch(e.kind){case 0:return ft.chain.label_asym_id;case 1:case 2:return ft.coarse.asym_id}}function fL(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var a=e.unitSymmetryGroups[r].units[0],i=a.model;if(Re.isAtomic(a))for(var o=i.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,c=qt.transientSegments(s,a.elements);c.hasNext;){var l=c.move().index,f=u.label_entity_id.value(l),d=i.entities.getEntityIndex(f);if(i.entities.data.type.value(d)==="polymer"){var m=u.label_asym_id.value(l);t.has(m)||t.set(m,t.size)}}else if(Re.isCoarse(a))for(var p=Re.isSpheres(a)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,v=p.chainElementSegments,h=p.asym_id,g=p.entity_id,c=qt.transientSegments(v,a.elements);c.hasNext;){var l=c.move().index,y=v.offsets[l],f=g.value(y),d=i.entities.getEntityIndex(f);if(i.entities.data.type.value(d)==="polymer"){var m=h.value(y);t.has(m)||t.set(m,t.size)}}}return t}function dL(e,t){var r,n;if(e.structure){var a=Qe.create(e.structure),i=fL(e.structure.root),o=Array.from(i.keys()),s=function(c){return o[c]},u=qo(i.size,t,{valueLabel:s});n=u.legend,r=function(c){var l=void 0;if(Qe.is(c)){var f=lL(c.unit);l=i.get(f(c))}else if(Pt.isLocation(c)){var f=lL(c.aUnit);a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex],l=i.get(f(a))}return l===void 0?uL:u.color(l)}}else r=function(){return uL};return{factory:dL,granularity:"group",color:r,props:t,description:Eme,legend:n}}var Dme={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:dL,getParams:Ime,defaultValues:P.getDefaultValues(cL),isApplicable:function(e){return!!e.structure}},fA="dark-2",mL=st(13421772),Mme="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",pL=I({},so({type:"colors",colorList:fA}));function Rme(e){var t=P.clone(pL);return e.structure&&vL(e.structure.root)>Di[fA].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=I(I({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Mu(fA).list}})),t}function vL(e){for(var t=0,r=e.units,n=0,a=r.length;n<a;++n)r[n].polymerElements.length>0&&++t;return t}function hL(e,t){var r,n;if(e.structure){var a=qo(vL(e.structure.root),t);n=a.legend;for(var i=e.structure.root.units,o=new Map,s=0,u=0,c=i.length;s<c;++s)i[s].polymerElements.length>0&&(o.set(i[s].id,a.color(u)),++u);r=function(l){var f;return Qe.is(l)?f=o.get(l.unit.id):Pt.isLocation(l)&&(f=o.get(l.aUnit.id)),f!==void 0?f:mL}}else r=function(){return mL};return{factory:hL,granularity:"instance",color:r,props:t,description:Mme,legend:n}}var Bme={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:hL,getParams:Rme,defaultValues:P.getDefaultValues(pL),isApplicable:function(e){return!!e.structure}},gL=Pf({ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945}),dA=st(16711935),Fme="Assigns a color to every residue according to its name.",yL={saturation:P.Numeric(0,{min:-6,max:6,step:.1}),lightness:P.Numeric(1,{min:-6,max:6,step:.1}),colors:P.MappedStatic("default",{default:P.EmptyGroup(),custom:P.Group(ab(gL))})};function Ome(e){return yL}function bL(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function xL(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function fb(e,t){var r=e[t];return r===void 0?dA:r}function SL(e,t){var r=hy(t.colors.name==="default"?gL:t.colors.params,t.saturation,t.lightness);function n(a){if(Qe.is(a))if(Re.isAtomic(a.unit)){var i=bL(a.unit,a.element);return fb(r,i)}else{var i=xL(a.unit,a.element);if(i)return fb(r,i)}else if(Pt.isLocation(a))if(Re.isAtomic(a.aUnit)){var i=bL(a.aUnit,a.aUnit.elements[a.aIndex]);return fb(r,i)}else{var i=xL(a.aUnit,a.aUnit.elements[a.aIndex]);if(i)return fb(r,i)}return dA}return{factory:SL,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Fme,legend:xl(Object.keys(r).map(function(a){return[a,r[a]]}).concat([["Unknown",dA]]))}}var kme={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:SL,getParams:Ome,defaultValues:P.getDefaultValues(yL),isApplicable:function(e){return!!e.structure}},CL=Pf({alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722}),mA=st(8421504),Lme="Assigns a color based on the type of secondary structure and basic molecule type.",_L={saturation:P.Numeric(-1,{min:-6,max:6,step:.1}),lightness:P.Numeric(0,{min:-6,max:6,step:.1}),colors:P.MappedStatic("default",{default:P.EmptyGroup(),custom:P.Group(ab(CL))})};function Nme(e){return _L}function wL(e,t,r,n){var a=yr.create(0);if(n&&Re.isAtomic(t)){var i=n.get(t.invariantId);i&&(a=i.type[i.getIndex(t.residueIndex[r])])}if(yr.is(a,2))return yr.is(a,2048)?e.threeTenHelix:yr.is(a,32768)?e.piHelix:e.alphaHelix;if(yr.is(a,4))return e.betaStrand;if(yr.is(a,8))return e.bend;if(yr.is(a,16))return e.turn;var o=yw(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:mA}function AL(e,t){var r=e.structure&&zo.get(e.structure),n=r?If(r.id,r.version):-1,a=hy(t.colors.name==="default"?CL:t.colors.params,t.saturation,t.lightness);function i(o){return Qe.is(o)?wL(a,o.unit,o.element,r==null?void 0:r.value):Pt.isLocation(o)?wL(a,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):mA}return{factory:AL,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:Lme,legend:xl(Object.keys(a).map(function(o){return[o,a[o]]}).concat([["Other",mA]]))}}var Ume={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:AL,getParams:Nme,defaultValues:P.getDefaultValues(_L),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?zo.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&zo.ref(e.structure,!1)}}},zme=st(13421772),Vme="Gives every polymer residue a color based on its `seq_id` value.",TL={list:P.ColorList("turbo",{presetKind:"scale"})};function Gme(e){return TL}function PL(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function EL(e,t){var r=e.model,n="";switch(e.kind){case 0:var a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var i=r.entities.getEntityIndex(n);if(i===-1)return 0;var o=r.sequence.byEntityKey[i];return o===void 0?0:o.sequence.length}function IL(e,t){var r=xs.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(a){if(Qe.is(a)){var i=a.unit,o=a.element,s=PL(i,o);if(s>0){var u=EL(i,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Pt.isLocation(a)){var c=a.aUnit,l=a.aIndex,s=PL(c,c.elements[l]);if(s>0){var u=EL(c,c.elements[l]);if(u)return r.setDomain(0,u-1),r.color(s)}}return zme};return{factory:IL,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Vme,legend:r?r.legend:void 0}}var Hme={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:IL,getParams:Gme,defaultValues:P.getDefaultValues(TL),isApplicable:function(e){return!!e.structure}},pA="dark-2",DL=st(13421772),qme="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",ML=I({},so({type:"colors",colorList:pA}));function jme(e){var t=P.clone(ML);return e.structure&&e.structure.root.units.length>Di[pA].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=I(I({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Mu(pA).list}})),t}function RL(e,t){var r,n;if(e.structure){var a=e.structure.root.units,i=qo(a.length,t);n=i.legend;for(var o=new Map,s=0,u=a.length;s<u;++s)o.set(a[s].id,i.color(s));r=function(c){return Qe.is(c)?o.get(c.unit.id):Pt.isLocation(c)?o.get(c.aUnit.id):DL}}else r=function(){return DL};return{factory:RL,granularity:"instance",color:r,props:t,description:qme,legend:n}}var Wme={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:RL,getParams:jme,defaultValues:P.getDefaultValues(ML),isApplicable:function(e){return!!e.structure}},Xme=st(16777113),Yme="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",BL={domain:P.Interval([0,100]),list:P.ColorList("red-white-blue",{presetKind:"scale"})};function Kme(e){return BL}function FL(e,t){return Re.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Re.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function OL(e,t){var r=xs.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(a){return Qe.is(a)?r.color(FL(a.unit,a.element)):Pt.isLocation(a)?r.color(FL(a.aUnit,a.aUnit.elements[a.aIndex])):Xme}return{factory:OL,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Yme,legend:r?r.legend:void 0}}var Qme={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:OL,getParams:Kme,defaultValues:P.getDefaultValues(BL),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Zme=st(15658734),$me="Assigns an illustrative color that gives every chain a color based on the choosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",kL={style:P.MappedStatic("entity-id",{uniform:P.Group(E_),"chain-id":P.Group(rb),"entity-id":P.Group(ib),"entity-source":P.Group(cb),"molecule-type":P.Group(uA)}),carbonLightness:P.Numeric(.8,{min:-6,max:6,step:.1})};function Jme(e){var t=P.clone(kL);return t}function LL(e,t){var r=t.style.name==="uniform"?u1(e,t.style.params):t.style.name==="chain-id"?nb(e,t.style.params):t.style.name==="entity-id"?ob(e,t.style.params):t.style.name==="entity-source"?lb(e,t.style.params):t.style.name==="molecule-type"?cA(e,t.style.params):vd(t.style),n=r.color,a=r.legend;function i(s,u){var c=n(s,!1);return u==="C"?st.lighten(c,t.carbonLightness):c}function o(s){if(Qe.is(s)&&Re.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,u)}else if(Pt.isLocation(s)&&Re.isAtomic(s.aUnit)){var c=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(c);return i(s,u)}return Zme}return{factory:LL,granularity:"group",preferSmoothing:!0,color:o,props:t,description:$me,legend:a}}var epe={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:LL,getParams:Jme,defaultValues:P.getDefaultValues(kL),isApplicable:function(e){return!!e.structure}},tpe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',NL={list:P.ColorList("red-yellow-green",{presetKind:"scale"}),scale:P.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function rpe(e){return NL}var npe={DGwif:0,DGwoct:1,"Oct-IF":2};function ape(e,t){var r=aw[e];return r===void 0?0:r[t]}function UL(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function zL(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var a=e.coarseElements.entityKey[t],i=e.model.sequence.byEntityKey[a].sequence;return i.compId.value(r-1)}}function VL(e,t){var r=npe[t.scale],n=1/0,a=-1/0;for(var i in aw){var o=aw[i][r];n=Math.min(n,o),a=Math.max(a,o)}var s=xs.create({listOrName:t.list.colors,domain:[a,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(c){var l;return Qe.is(c)?Re.isAtomic(c.unit)?l=UL(c.unit,c.element):l=zL(c.unit,c.element):Pt.isLocation(c)&&(Re.isAtomic(c.aUnit)?l=UL(c.aUnit,c.aUnit.elements[c.aIndex]):l=zL(c.aUnit,c.aUnit.elements[c.aIndex])),s.color(l?ape(l,r):0)}return{factory:VL,granularity:"group",preferSmoothing:!0,color:u,props:t,description:tpe,legend:s?s.legend:void 0}}var ipe={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:VL,getParams:rpe,defaultValues:P.getDefaultValues(NL),isApplicable:function(e){return!!e.structure}},GL=st(13421772),ope="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",HL=I({},so({type:"colors",colorList:"purples"}));function spe(e){return HL}function qL(e,t){var r,n,a,i;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,c=o;u<c.length;u++){var l=c[u];s=Math.max(s,((r=jt.TrajectoryInfo.get(l))===null||r===void 0?void 0:r.size)||0)}var f=qo(s,t);i=f.legend;for(var d=new Map,m=0,p=o.length;m<p;++m){var v=((n=jt.TrajectoryInfo.get(o[m]))===null||n===void 0?void 0:n.index)||0;d.set(v,f.color(v))}a=function(h){return Qe.is(h)?d.get(jt.TrajectoryInfo.get(h.unit.model).index):Pt.isLocation(h)?d.get(jt.TrajectoryInfo.get(h.aUnit.model).index):GL}}else a=function(){return GL};return{factory:qL,granularity:"instance",color:a,props:t,description:ope,legend:i}}var upe={name:"model-index",label:"Model Index",category:"Chain Property",factory:qL,getParams:spe,defaultValues:P.getDefaultValues(HL),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&jt.TrajectoryInfo.get(e.structure.models[0]).size>1}},cpe=st(13421772),lpe="Assigns a color based on the occupancy of an atom.",jL={domain:P.Interval([0,1]),list:P.ColorList("purples",{presetKind:"scale"})};function fpe(e){return jL}function WL(e,t){return Re.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function XL(e,t){var r=xs.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(a){return Qe.is(a)?r.color(WL(a.unit,a.element)):Pt.isLocation(a)?r.color(WL(a.aUnit,a.aUnit.elements[a.aIndex])):cpe}return{factory:XL,granularity:"group",preferSmoothing:!0,color:n,props:t,description:lpe,legend:r?r.legend:void 0}}var dpe={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:XL,getParams:fpe,defaultValues:P.getDefaultValues(jL),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},vA="dark-2",YL=st(13421772),mpe="Assigns a color based on the operator HKL value of a transformed chain.",KL=I({},so({type:"colors",colorList:vA}));function ppe(e){var t=P.clone(KL);return e.structure&&QL(e.structure.root).map.size>Di[vA].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=I(I({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Mu(vA).list}})),t}var Jh=1e4;function hA(e){return e.map(function(t){return"".concat(t+Jh).padStart(5,"0")}).join("")}function gA(e){var t=rK(Jh,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),a=parseInt(e.substr(t+t,t));return[r-Jh,n-Jh,a-Jh]}function yA(e){return e.map(function(t){return t+5}).join("")}function QL(e){for(var t=new Map,r=new Set,n=0,a=e.units.length;n<a;++n){var i=hA(e.units[n].conformation.operator.hkl);r.add(i)}var o=Array.from(r.values()).sort();o.forEach(function(c){return t.set(c,t.size)});var s=gA(o[0]),u=gA(o[o.length-1]);return{min:s,max:u,map:t}}function ZL(e,t){var r,n;if(e.structure){var a=QL(e.structure.root),i=a.min,o=a.max,s=a.map,u=[];s.forEach(function(f,d){var m=f%s.size,p=yA(gA(d));u[m]===void 0?u[m]=p:u[m]+=", ".concat(p)});var c={minLabel:yA(i),maxLabel:yA(o),valueLabel:function(f){return u[f]}},l=qo(s.size,t,c);n=l.legend,r=function(f){var d=void 0;if(Qe.is(f)){var m=hA(f.unit.conformation.operator.hkl);d=s.get(m)}else if(Pt.isLocation(f)){var m=hA(f.aUnit.conformation.operator.hkl);d=s.get(m)}return d===void 0?YL:l.color(d)}}else r=function(){return YL};return{factory:ZL,granularity:"instance",color:r,props:t,description:mpe,legend:n}}var vpe={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:ZL,getParams:ppe,defaultValues:P.getDefaultValues(KL),isApplicable:function(e){return!!e.structure}},bA=st(16777113),hpe="Assigns a color based on the partial charge of an atom.",$L={domain:P.Interval([-1,1]),list:P.ColorList("red-white-blue",{presetKind:"scale"})};function gpe(e){return $L}function JL(e,t){var r;return(r=cp.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function e8(e,t){var r=xs.create({domain:t.domain,listOrName:t.list.colors});function n(a){if(Qe.is(a)){var i=JL(a.unit,a.element);return i!==void 0?r.color(i):bA}else if(Pt.isLocation(a)){var i=JL(a.aUnit,a.aUnit.elements[a.aIndex]);return i!==void 0?r.color(i):bA}return bA}return{factory:e8,granularity:"group",preferSmoothing:!0,color:n,props:t,description:hpe,legend:r?r.legend:void 0}}var ype={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:e8,getParams:gpe,defaultValues:P.getDefaultValues($L),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return cp.Provider.get(t)!==void 0})}},bpe="many-distinct",t8=st(16448250),xpe="Gives every atom a color based on its `label_atom_id` value.",r8=I({},so({type:"colors",colorList:bpe}));function Spe(e){var t=P.clone(r8);return t}function Cpe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var a=n[r],i=a.atomicHierarchy.atoms.label_atom_id,o=0,s=i.rowCount;o<s;++o){var u=i.value(o);t.has(u)||t.set(u,t.size)}return t}function n8(e,t){var r,n;if(e.structure){var a=Qe.create(e.structure.root),i=Cpe(e.structure.root),o=Array.from(i.keys()),s=function(c){return o[c]},u=qo(i.size,t,{valueLabel:s});n=u.legend,r=function(c){var l=void 0;if(Qe.is(c)){var f=ft.atom.label_atom_id(c);l=i.get(f)}else if(Pt.isLocation(c)){a.unit=c.aUnit,a.element=c.aUnit.elements[c.aIndex];var f=ft.atom.label_atom_id(a);l=i.get(f)}return l===void 0?t8:u.color(l)}}else r=function(){return t8};return{factory:n8,granularity:"group",preferSmoothing:!0,color:r,props:t,description:xpe,legend:n}}var _pe={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:n8,getParams:Spe,defaultValues:P.getDefaultValues(r8),isApplicable:function(e){return!!e.structure}},wpe=st(13421772),Ape="Assign color based on the given value of a volume cell.",a8={colorList:P.ColorList({kind:"interpolate",colors:[[tr.white,0],[tr.red,.25],[tr.white,.5],[tr.blue,.75],[tr.white,1]]},{offsets:!0,isEssential:!0})};function Tpe(e){return a8}function i8(e,t){for(var r=xs.create({domain:[0,1],listOrName:t.colorList.colors}),n=[],a=0;a<256;++a)n[a]=r.color(a/255);var i={colors:n,filter:"linear"};return{factory:i8,granularity:"direct",color:function(){return wpe},props:t,description:Ape,legend:r.legend,palette:i}}var Ppe={name:"volume-value",label:"Volume Value",category:"Miscellaneous",factory:i8,getParams:Tpe,defaultValues:P.getDefaultValues(a8),isApplicable:function(e){return!!e.volume}},du;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=st(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(a,i){return a.contextHash===i.contextHash&&a.factory===i.factory&&Eu(a.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new d8(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":_pe,"carbohydrate-symbol":Yde,"chain-id":Xk,"element-index":ome,"element-symbol":wme,"entity-id":vme,"entity-source":xme,hydrophobicity:ipe,illustrative:epe,"model-index":upe,"molecule-type":Pme,occupancy:dpe,"operator-hkl":vpe,"operator-name":nA,"partial-charge":ype,"polymer-id":Dme,"polymer-index":Bme,"residue-name":kme,"secondary-structure":Ume,"sequence-id":Hme,"shape-group":xne,uncertainty:Qme,"unit-index":Wme,uniform:nJ,"volume-value":Ppe}})(du||(du={}));var Epe=1,Ipe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",o8={scale:P.Numeric(1,{min:.1,max:5,step:.1})};function Dpe(e){return o8}function xA(e,t){return Re.isAtomic(e)?zh(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Re.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function s8(e,t){var r=t.scale===void 0?1:t.scale;function n(a){var i;return Qe.is(a)?i=r*xA(a.unit,a.element):Pt.isLocation(a)?i=r*Math.min(xA(a.aUnit,a.aUnit.elements[a.aIndex]),xA(a.bUnit,a.bUnit.elements[a.bIndex])):i=r*Epe,i}return{factory:s8,granularity:"group",size:n,props:t,description:Ipe}}var Mpe={name:"physical",label:"Physical",category:"",factory:s8,getParams:Dpe,defaultValues:P.getDefaultValues(o8),isApplicable:function(e){return!!e.structure}},Rpe="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",u8={bfactorFactor:P.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:P.Numeric(.05,{min:0,max:1,step:.01}),baseSize:P.Numeric(.2,{min:0,max:2,step:.1})};function Bpe(e){return u8}function c8(e,t,r){return Re.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Re.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function l8(e,t){function r(n){var a=t.baseSize;return Qe.is(n)?a+=c8(n.unit,n.element,t):Pt.isLocation(n)&&(a+=c8(n.aUnit,n.aUnit.elements[n.aIndex],t)),a}return{factory:l8,granularity:"group",size:r,props:t,description:Rpe}}var Fpe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:l8,getParams:Bpe,defaultValues:P.getDefaultValues(u8),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},ea;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,a){return n.factory===a.factory&&Eu(n.props,a.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new d8(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:Mpe,"shape-group":hne,uncertainty:Fpe,uniform:oJ}})(ea||(ea={}));var kn;(function(e){function t(i,o,s,u){u=u||r();var c=s.colorTheme,l=s.sizeTheme;return u.color=i.colorThemeRegistry.create(c.name,o,c.params),u.size=i.sizeThemeRegistry.create(l.name,o,l.params),u}e.create=t;function r(){return{color:du.Empty,size:ea.Empty}}e.createEmpty=r;function n(i,o,s,u){var c,l;return ie(this,void 0,void 0,function(){return ae(this,function(f){switch(f.label){case 0:return[4,(c=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,s)];case 1:return f.sent(),[4,(l=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(i,s)];case 2:return f.sent(),[2]}})})}e.ensureDependencies=n;function a(i,o,s){var u,c;(u=i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(c=i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||c===void 0||c.detach(o)}e.releaseDependencies=a})(kn||(kn={}));function f8(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var d8=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,wo(t,function(a,i){if(a.name!==i)throw new Error("Fix build in themes to have matching names. ".concat(a.name," ").concat(i));n.add(a)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return f8(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered theme provider."));return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var a=this.get(t);return a.factory(r,I(I({},P.getDefaultValues(a.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return f8(this.getApplicableList(t))},e}(),xt;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(xt||(xt={}));var $a;(function(e){e.is=Da.has,e.All=xt.Highlight|xt.RemoveHighlight|xt.Select|xt.Deselect|xt.Toggle|xt.Clear,e.Highlighting=xt.Highlight|xt.RemoveHighlight|xt.Clear,e.Selecting=xt.Select|xt.Deselect|xt.Toggle|xt.Clear;function t(r,n){return r===xt.Highlight&&n===xt.RemoveHighlight||r===xt.RemoveHighlight&&n===xt.Highlight||r===xt.Select&&n===xt.Deselect||r===xt.Deselect&&n===xt.Select||r===xt.Toggle&&n===xt.Toggle}e.isReverse=t})($a||($a={}));function Ope(e,t,r){e.fill(t,0,r)}function SA(e,t,r){switch(r){case xt.Highlight:e[t]|=1;break;case xt.RemoveHighlight:e[t]&=~1;break;case xt.Select:e[t]|=2;break;case xt.Deselect:e[t]&=~2;break;case xt.Toggle:e[t]^=2;break;case xt.Clear:e[t]=0;break}}function CA(e,t,r){if(r===xt.None)return!1;if(Se.is(t)){var n=Se.start(t),a=Se.end(t),i=n+3>>2,o=i+(a-4*i>>2);if(o<=i){for(var s=n;s<a;++s)SA(e,s,r);return!0}var u=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),c=n,l=Math.min(4*i,a),f=Math.max(n,4*o),d=a;switch(r){case xt.Highlight:for(var s=i;s<o;++s)u[s]|=16843009;break;case xt.RemoveHighlight:for(var s=i;s<o;++s)u[s]&=~16843009;break;case xt.Select:for(var s=i;s<o;++s)u[s]|=33686018;break;case xt.Deselect:for(var s=i;s<o;++s)u[s]&=~33686018;break;case xt.Toggle:for(var s=i;s<o;++s)u[s]^=33686018;break;case xt.Clear:for(var s=i;s<o;++s)u[s]=0;break;default:vd()}for(var s=c;s<l;++s)SA(e,s,r);for(var s=f;s<d;++s)SA(e,s,r)}else switch(r){case xt.Highlight:for(var s=0,m=t.length;s<m;++s)e[t[s]]|=1;break;case xt.RemoveHighlight:for(var s=0,m=t.length;s<m;++s)e[t[s]]&=~1;break;case xt.Select:for(var s=0,m=t.length;s<m;++s)e[t[s]]|=2;break;case xt.Deselect:for(var s=0,m=t.length;s<m;++s)e[t[s]]&=~2;break;case xt.Toggle:for(var s=0,m=t.length;s<m;++s)e[t[s]]^=2;break;case xt.Clear:for(var s=0,m=t.length;s<m;++s)e[t[s]]=0;break;default:vd()}return!0}function kpe(e,t){var r=-1,n=-1;switch(e){case xt.Highlight:t===0||t===1?(r=1,n=1):t===2||t===3?(r=1,n=3):r=1;break;case xt.RemoveHighlight:t===0||t===1?(r=0,n=0):(t===2||t===3)&&(r=1,n=2);break;case xt.Select:t===1||t===3?(r=1,n=3):t===0||t===2?(r=1,n=2):r=1;break;case xt.Deselect:t===1||t===3?(r=1,n=1):(t===0||t===2)&&(r=0,n=0);break;case xt.Toggle:t===1?(r=1,n=3):t===2?(r=0,n=0):t===3?(r=1,n=1):t===0&&(r=1,n=2);break;case xt.Clear:r=0,n=0;break}return{average:r,status:n}}function Lpe(e,t){switch(e){case xt.Highlight:return .5;case xt.RemoveHighlight:return t===0?0:t===2||t===3?.5:-1;case xt.Select:return .5;case xt.Deselect:return t===1||t===3?.5:t===0?0:-1;case xt.Toggle:return t===-1?-1:.5;case xt.Clear:return t===-1?-1:t===0?0:.5;case xt.None:return-1;default:vd()}}var db={kind:"every-loci"};function jo(e){return!!e&&e.kind==="every-loci"}var ur={kind:"empty-loci"};function Ja(e){return!!e&&e.kind==="empty-loci"}function e0(e){return!!e&&e.kind==="data-loci"}function Npe(e,t){if(!Hv(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!Hv(e.elements[r],t.elements[r]))return!1;return!0}function Upe(e){return e.elements.length===0}function mb(e,t,r,n,a){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:a}}var Ut;(function(e){var t=new Ji("98");function r(v){var h=v.loci.map(function(_){return s(_)}).filter(function(_){return!!_});t.reset();for(var g=0,y=h;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var x=0,C=h;x<C.length;x++){var b=C[x];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(v,h){return jo(v)&&jo(h)||Ja(v)&&Ja(h)?!0:e0(v)&&e0(h)?Npe(v,h):ke.isLoci(v)&&ke.isLoci(h)?ke.areLociEqual(v,h):_e.is(v)&&_e.is(h)?_e.areEqual(v,h):Pt.isLoci(v)&&Pt.isLoci(h)?Pt.areLociEqual(v,h):fr.isLoci(v)&&fr.isLoci(h)?fr.areLociEqual(v,h):hi.isLoci(v)&&hi.isLoci(h)?hi.areLociEqual(v,h):vt.isLoci(v)&&vt.isLoci(h)?vt.areLociEqual(v,h):vt.Isosurface.isLoci(v)&&vt.Isosurface.isLoci(h)?vt.Isosurface.areLociEqual(v,h):vt.Cell.isLoci(v)&&vt.Cell.isLoci(h)?vt.Cell.areLociEqual(v,h):!1}e.areEqual=n;function a(v){return!!v&&v.kind==="every-loci"}e.isEvery=a;function i(v){return jo(v)?!1:Ja(v)?!0:e0(v)?Upe(v):ke.isLoci(v)?ke.isLociEmpty(v):_e.is(v)?_e.isEmpty(v):Pt.isLoci(v)?Pt.isLociEmpty(v):fr.isLoci(v)?fr.isLociEmpty(v):hi.isLoci(v)?hi.isLociEmpty(v):vt.isLoci(v)?vt.isLociEmpty(v):vt.Isosurface.isLoci(v)?vt.Isosurface.isLociEmpty(v):vt.Cell.isLoci(v)?vt.Cell.isLociEmpty(v):!1}e.isEmpty=i;function o(v,h){return h instanceof ke&&(_e.is(v)?v=_e.remap(v,h):ke.isLoci(v)?v=ke.remapLoci(v,h):Pt.isLoci(v)&&(v=Pt.remapLoci(v,h))),v}e.remap=o;function s(v,h){var g;if(!(v.kind==="every-loci"||v.kind==="empty-loci")){if(h||(h=Te()),v.kind==="structure-loci")return Te.copy(h,v.structure.boundary.sphere);if(v.kind==="element-loci")return Te.copy(h,_e.getBoundary(v).sphere);if(v.kind==="bond-loci")return Pt.getBoundingSphere(v,h);if(v.kind==="shape-loci")return Te.copy(h,v.shape.geometry.boundingSphere);if(v.kind==="group-loci")return hi.getBoundingSphere(v,h);if(v.kind==="data-loci")return(g=v.getBoundingSphere)===null||g===void 0?void 0:g.call(v,h);if(v.kind==="volume-loci")return vt.getBoundingSphere(v.volume,h);if(v.kind==="isosurface-loci")return vt.Isosurface.getBoundingSphere(v.volume,v.isoValue,h);if(v.kind==="cell-loci")return vt.Cell.getBoundingSphere(v.volume,v.indices,h)}}e.getBoundingSphere=s;var u=Te.zero();function c(v,h){var g=s(v,u);return g?S.copy(h||S(),g.center):void 0}e.getCenter=c;function l(v){if(!(v.kind==="every-loci"||v.kind==="empty-loci")){if(v.kind==="structure-loci")return _e.getPrincipalAxes(ke.toStructureElementLoci(v.structure));if(v.kind==="element-loci")return _e.getPrincipalAxes(v);if(v.kind==="bond-loci")return;if(v.kind==="shape-loci")return;if(v.kind==="group-loci")return;if(v.kind==="data-loci")return;if(v.kind==="volume-loci")return;if(v.kind==="isosurface-loci")return;if(v.kind==="cell-loci")return}}e.getPrincipalAxes=l;var f={element:function(v){return v},residue:function(v){return _e.is(v)?_e.extendToWholeResidues(v,!0):v},chain:function(v){return _e.is(v)?_e.extendToWholeChains(v):v},entity:function(v){return _e.is(v)?_e.extendToWholeEntities(v):v},model:function(v){return _e.is(v)?_e.extendToWholeModels(v):v},operator:function(v){return _e.is(v)?_e.extendToWholeOperators(v):v},structure:function(v){return _e.is(v)?ke.toStructureElementLoci(v.structure):hi.isLoci(v)?fr.Loci(v.shape):v},elementInstances:function(v){return _e.is(v)?_e.extendToAllInstances(v):v},residueInstances:function(v){return _e.is(v)?_e.extendToAllInstances(_e.extendToWholeResidues(v,!0)):v},chainInstances:function(v){return _e.is(v)?_e.extendToAllInstances(_e.extendToWholeChains(v)):v}};e.GranularityOptions=P.objectToOptions(f,function(v){switch(v){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return v.indexOf("Instances")?[Ao(v),"With Symmetry"]:Ao(v)}});function d(v){return v.replace("Instances","")}e.simpleGranularity=d;function m(v,h){return f[h](v)}e.applyGranularity=m;function p(v,h,g){return g===void 0&&(g=!1),(h!=="element"||g)&&Pt.isLoci(v)&&(v=Pt.toStructureElementLoci(v)),ke.isLoci(v)&&(v=ke.toStructureElementLoci(v.structure)),_e.is(v)&&(v=_e.remap(v,v.structure.root)),h&&(v=m(v,h)),v}e.normalize=p})(Ut||(Ut={}));function ba(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(c,l){if(c.layers.length===0&&l.layers.length===0)return!0;if(c.layers.length!==l.layers.length)return!1;for(var f=0,d=c.layers.length;f<d;++f)if(c.layers[f].clear!==l.layers[f].clear||c.layers[f].color!==l.layers[f].color||!Ut.areEqual(c.layers[f].loci,l.layers[f].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,l){for(var f=[],d=0,m=c.layers;d<m.length;d++){var p=m[d],v=p.loci,h=p.color,g=p.clear;v=_e.remap(v,l),_e.isEmpty(v)||f.push({loci:v,color:h,clear:g})}return{layers:f}}e.remap=n;function a(c){if(r(c))return c;for(var l=c.layers[0].loci.structure,f=new Map,d=_e.none(l),m=0,p=c.layers.length;m<p;++m){var v=c.layers[p-m-1],h=v.loci,g=v.color,y=v.clear;if(h=_e.subtract(h,d),d=_e.union(h,d),!_e.isEmpty(h)){var b=y?-1:g;f.has(b)&&(h=_e.union(h,f.get(b))),f.set(b,h)}}var x=[];return f.forEach(function(C,_){var w=_===-1,T=w?st(0):_;x.push({loci:C,color:T,clear:w})}),{layers:x}}e.merge=a;function i(c,l){if(r(c))return c;for(var f=c.layers[0].loci.structure,d=[],m=0,p=c.layers;m<p.length;m++){var v=p[m],h=v.loci,g=v.color,y=v.clear,b=_e.remap(h,l);h=_e.remap(b,f),_e.isEmpty(h)||d.push({loci:h,color:g,clear:y})}return{layers:d}}e.filter=i;function o(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.script,h=p.color,g=p.clear,y=Gn.toLoci(v,l);_e.isEmpty(y)||f.push({loci:y,color:h,clear:g})}return{layers:f}}e.ofScript=o;function s(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.bundle,h=p.color,g=p.clear,y=Cr.toLoci(v,l.root);f.push({loci:y,color:h,clear:g})}return{layers:f}}e.ofBundle=s;function u(c){for(var l=[],f=0,d=c.layers.length;f<d;++f){var m=c.layers[f],p=m.loci,v=m.color,h=m.clear,g=Cr.fromLoci(p);l.push({bundle:g,color:v,clear:h})}return{layers:l}}e.toBundle=u})(ba||(ba={}));function xa(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(c,l){if(c.layers.length===0&&l.layers.length===0)return!0;if(c.layers.length!==l.layers.length)return!1;for(var f=0,d=c.layers.length;f<d;++f)if(c.layers[f].value!==l.layers[f].value||!Ut.areEqual(c.layers[f].loci,l.layers[f].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,l){if(c.kind==="element-loci"){for(var f=[],d=0,m=c.layers;d<m.length;d++){var p=m[d],v=_e.remap(p.loci,l);_e.isEmpty(v)||f.push({loci:v,value:p.value})}return{kind:"element-loci",layers:f}}else return c}e.remap=n;function a(c){if(r(c))return c;if(c.kind==="element-loci"){for(var l=c.layers[0].loci.structure,f=new Map,d=_e.none(l),m=0,p=c.layers.length;m<p;++m){var v=c.layers[p-m-1],h=v.loci,g=v.value;h=_e.subtract(h,d),d=_e.union(h,d),_e.isEmpty(h)||(f.has(g)&&(h=_e.union(h,f.get(g))),f.set(g,h))}var y=[];return f.forEach(function(b,x){y.push({loci:b,value:x})}),{kind:"element-loci",layers:y}}else return c}e.merge=a;function i(c,l){if(r(c))return c;if(c.kind==="element-loci"){for(var f=c.layers[0].loci.structure,d=[],m=0,p=c.layers;m<p.length;m++){var v=p[m],h=v.loci,g=v.value,y=_e.remap(h,l);h=_e.remap(y,f),_e.isEmpty(h)||d.push({loci:h,value:g})}return{kind:"element-loci",layers:d}}else return c}e.filter=i;function o(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.script,h=p.value,g=Gn.toLoci(v,l);_e.isEmpty(g)||f.push({loci:g,value:h})}return{kind:"element-loci",layers:f}}e.ofScript=o;function s(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.bundle,h=p.value,g=Cr.toLoci(v,l.root);f.push({loci:g,value:h})}return{kind:"element-loci",layers:f}}e.ofBundle=s;function u(c){for(var l=[],f=0,d=c.layers.length;f<d;++f){var m=c.layers[f],p=m.loci,v=m.value,h=Cr.fromLoci(p);l.push({bundle:h,value:v})}return{kind:"element-loci",layers:l}}e.toBundle=u})(xa||(xa={}));var mu;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(mu||(mu={}));var zpe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function m8(e,t){t===void 0&&(t={});var r=I(I({},zpe),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function Vpe(e){if(e.root.models.length===1){var t=_n.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!pi.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Bt.volume(e.root.boundary.box)}function _A(e,t){var r=jn(e.quality,"auto"),n=jn(e.detail,1),a=jn(e.radialSegments,12),i=jn(e.linearSegments,8),o=jn(e.resolution,2),s=jn(e.probePositions,12),u=jn(e.doubleSided,!0),c=0;if(r==="auto"){if(t instanceof ke)r=m8(t.root),c=Vpe(t);else if(vt.is(t)){var l=t.grid.cells.space.dimensions,f=l[0],d=l[1],m=l[2];c=f*d*m,r=c<1e7?"medium":"low"}}switch(r){case"highest":n=3,a=36,i=18,o=.1,s=72,u=!0;break;case"higher":n=3,a=28,i=14,o=.3,s=48,u=!0;break;case"high":n=2,a=20,i=10,o=.5,s=36,u=!0;break;case"medium":n=1,a=12,i=8,o=.8,s=24,u=!0;break;case"low":n=0,a=8,i=3,o=1.3,s=24,u=!1;break;case"lower":n=0,a=4,i=2,o=3,s=12,u=!1;break;case"lowest":n=0,a=2,i=1,o=8,s=12,u=!1;break}return o=Math.max(o,c/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||!!e.xrayShaded)&&(u=!1),{detail:n,radialSegments:a,linearSegments:i,resolution:o,probePositions:s,doubleSided:u}}var pb=S.set,p8=S.normalize,v8=S.sub,h8=S.addScalar,vb=S.scale,g8=S.toArray;function wA(e,t,r,n){var a=!1;if(vt.isLoci(e)){if(!vt.areEquivalent(e.volume,t))return!1;n(Se.ofLength(t.grid.cells.data.length))&&(a=!0)}else if(vt.Isosurface.isLoci(e)){if(!vt.areEquivalent(e.volume,t))return!1;if(r){if(!vt.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Se.ofLength(t.grid.cells.data.length))&&(a=!0)}else for(var i=t.grid,o=i.stats,s=i.cells.data,u=o.sigma,c=vt.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,l=0,f=s.length;l<f;++l)qr(c,s[l],u)&&n(Se.ofSingleton(l))&&(a=!0)}else if(vt.Cell.isLoci(e)){if(!vt.areEquivalent(e.volume,t))return!1;Se.is(e.indices)?n(e.indices)&&(a=!0):De.forEach(e.indices,function(d){n(Se.ofSingleton(d))&&(a=!0)})}return a}function t0(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),a=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,o=e[1]+t,s=1,u=i;return a<i*e[2]?(u=Math.floor(a/i),s=Math.ceil(e[2]/u),i*=u,o*=s):i*=e[2],{width:i,height:o,columns:u,rows:s,powerOfTwoSize:o<a?a:a*2}}function y8(e,t,r){r===void 0&&(r=0);for(var n=e.grid,a=n.cells,i=a.space,o=a.data,s=n.stats,u=s.max,c=s.min,l=i.dimensions,f=i.dataOffset,d=t0(l,r),m=d.width,p=d.height,v=t==="data"?1:4,h=new Uint8Array(m*p*v),g={array:h,width:m,height:p},y=u-c,b=l[0],x=l[1],C=l[2],_=b+r,w=x+r,T=S(),A=S(),D=b-1,E=x-1,M=C-1,F=0;F<C;++F)for(var O=0;O<x;++O)for(var U=0;U<b;++U){var N=Math.floor(F*_%m/_),q=Math.floor(F*_/m),j=N*_+U,Q=v*(q*w*m+O*m+j),J=f(U,O,F);t==="data"?h[Q]=Math.round((o[J]-c)/y*255):(t==="groups"?Ch(J,h,Q):(pb(T,o[f(Math.max(0,U-1),O,F)],o[f(U,Math.max(0,O-1),F)],o[f(U,O,Math.max(0,F-1))]),pb(A,o[f(Math.min(D,U+1),O,F)],o[f(U,Math.min(E,O+1),F)],o[f(U,O,Math.min(M,F+1))]),p8(T,v8(T,T,A)),h8(T,vb(T,T,.5),.5),g8(vb(T,T,255),h,Q)),h[Q+3]=Math.round((o[J]-c)/y*255))}return g}function Gpe(e){for(var t=e.grid,r=t.cells,n=r.space,a=r.data,i=t.stats,o=i.max,s=i.min,u=n.dimensions,c=u[0],l=u[1],f=u[2],d=n.dataOffset,m=new Uint8Array(c*l*f*4),p={array:m,width:c,height:l,depth:f},v=o-s,h=S(),g=S(),y=c-1,b=l-1,x=f-1,C=0,_=0;_<f;++_)for(var w=0;w<l;++w)for(var T=0;T<c;++T){var A=d(T,w,_);pb(h,a[d(Math.max(0,T-1),w,_)],a[d(T,Math.max(0,w-1),_)],a[d(T,w,Math.max(0,_-1))]),pb(g,a[d(Math.min(y,T+1),w,_)],a[d(T,Math.min(b,w+1),_)],a[d(T,w,Math.min(x,_+1))]),p8(h,v8(h,h,g)),h8(h,vb(h,h,.5),.5),g8(vb(h,h,255),m,C),m[C+3]=Math.round((a[A]-s)/v*255),C+=4}return p}function hb(e,t,r,n,a){var i=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,c=e.transformBuffer,l=e.groupBuffer,f=e.itemSize,d=i.endsWith("Instance"),m=Bt.fromSphere3D(Bt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,v=Bt.scale(Bt(),m,p),h=Bt.size(S(),v);S.ceil(h,h),S.add(h,h,S.create(2,2,2));var g=m.min,y=h[0],b=h[1],x=t0(h),C=x.width,_=x.height,w=new Float32Array(C*_*f),T=new Float32Array(C*_),A=new Uint8Array(C*_*f),D={array:A,width:C,height:_,filter:"linear"},E=d?e.instanceCount:1,M=e.colorData.array;function F(ht,Ae,we){var Ve=Math.floor(we*y%C/y),rt=Math.floor(we*y/C),ut=Ve*y+ht;return f*(rt*b*C+Ae*C+ut)}for(var O=2,U=h[0],N=h[1],q=h[2],j=S(),Q=0;Q<E;++Q)for(var J=0;J<o;J+=r){S.fromArray(j,u,J*3),d&&S.transformMat4Offset(j,j,c,0,0,Q*16),S.sub(j,j,g),S.scale(j,j,p);for(var te=j[0],K=j[1],L=j[2],W=Math.floor(te),k=Math.floor(K),V=Math.floor(L),G=(Q*s+l[J])*f,H=Math.max(0,W-O),X=Math.max(0,k-O),Y=Math.max(0,V-O),oe=Math.min(U,W+O+2),ue=Math.min(N,k+O+2),me=Math.min(q,V+O+2),he=H;he<oe;++he)for(var Pe=he-te,re=X;re<ue;++re)for(var ee=re-K,B=Y;B<me;++B){var z=B-L,le=Math.sqrt(Pe*Pe+ee*ee+z*z);if(!(le>O)){for(var pe=O-le,ge=F(he,re,B),Ce=0;Ce<f;++Ce)w[ge+Ce]+=M[G+Ce]*pe;T[ge/f]+=pe}}}for(var Q=0,Ie=T.length;Q<Ie;++Q)for(var Oe=Q*f,We=T[Q],Ce=0;Ce<f;++Ce)A[Oe+Ce]=Math.round(w[Oe+Ce]/We);var Ne=Fe.create(C,_),Ye=Wt.create(g[0],g[1],g[2],p),Xe=d?"volumeInstance":"volume";if(n){if(!a){var Ze=f===4?"rgba":f===3?"rgb":"alpha";a=n.resources.texture("image-uint8",Ze,"ubyte","linear")}return a.load(D),{kind:"volume",texture:a,gridTexDim:Ne,gridDim:h,gridTransform:Ye,type:Xe}}else{var Ke=Hpe({vertexCount:o,instanceCount:E,transformBuffer:c,positionBuffer:u,colorType:Xe,grid:A,gridDim:h,gridTexDim:Ne,gridTransform:Ye,vertexStride:3,colorStride:f,outputStride:f});return{kind:"vertex",texture:Ke,texDim:Fe.create(Ke.width,Ke.height),type:d?"vertexInstance":"vertex"}}}function Hpe(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,a=e.grid,i=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,c=e.colorStride,l=e.itemOffset||0,f=e.outputStride;if(f+l>c)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");var d=e.colorType.endsWith("Instance"),m=d?e.instanceCount:1,p=Yn(Math.max(1,m*t),f,Uint8Array),v=p.array,h=i[0],g=i[1],y=o[0],b=S.fromArray(S(),s,0),x=s[3];function C(Oe,We,Ne){var Ye=Math.floor(Ne*h%y/h),Xe=Math.floor(Ne*h/y),Ze=Ye*h+Oe;return c*(Xe*g*y+We*y+Ze)}for(var _=S(),w=S(),T=S(),A=S(),D=0;D<m;++D)for(var E=0;E<t;++E){S.fromArray(_,r,E*u),d&&S.transformMat4Offset(_,_,n,0,0,D*16),S.sub(_,_,b),S.scale(_,_,x),S.floor(w,_),S.ceil(T,_),S.sub(A,_,w),S.sub(_,T,w),S.div(A,A,_);for(var M=w[0],F=w[1],O=w[2],U=T[0],N=T[1],q=T[2],j=A[0],Q=A[1],J=A[2],te=C(M,F,O)+l,K=C(U,F,O)+l,L=C(M,F,q)+l,W=C(U,F,q)+l,k=C(M,N,O)+l,V=C(U,N,O)+l,G=C(M,N,q)+l,H=C(U,N,q)+l,X=(D*t+E)*f,Y=0;Y<f;++Y){var oe=a[te+Y],ue=a[K+Y],me=a[L+Y],he=a[W+Y],Pe=a[k+Y],re=a[V+Y],ee=a[G+Y],B=a[H+Y],z=Xn(oe,ue,j),le=Xn(me,he,j),pe=Xn(Pe,re,j),ge=Xn(ee,B,j),Ce=Xn(z,pe,Q),Ie=Xn(le,ge,Q);v[X+Y]=Xn(Ce,Ie,J)}}return p}function qpe(e){return e==="group"||e==="groupInstance"}function AA(e,t,r,n,a){if(!!qpe(e.dColorType.ref.value)){var i=hb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dColorType,i.type),R.update(e.tColorGrid,i.texture),R.update(e.uColorTexDim,i.gridTexDim),R.update(e.uColorGridDim,i.gridDim),R.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dColorType,i.type),R.update(e.tColor,i.texture),R.update(e.uColorTexDim,i.texDim))}}function jpe(e){return e==="groupInstance"}function Wpe(e,t,r,n,a){if(!!jpe(e.dOverpaintType.ref.value)){var i=hb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dOverpaintType,i.type),R.update(e.tOverpaintGrid,i.texture),R.update(e.uOverpaintTexDim,i.gridTexDim),R.update(e.uOverpaintGridDim,i.gridDim),R.update(e.uOverpaintGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dOverpaintType,i.type),R.update(e.tOverpaint,i.texture),R.update(e.uOverpaintTexDim,i.texDim))}}function Xpe(e){return e==="groupInstance"}function Ype(e,t,r,n,a){if(!!Xpe(e.dTransparencyType.ref.value)){var i=hb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dTransparencyType,i.type),R.update(e.tTransparencyGrid,i.texture),R.update(e.uTransparencyTexDim,i.gridTexDim),R.update(e.uTransparencyGridDim,i.gridDim),R.update(e.uTransparencyGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dTransparencyType,i.type),R.update(e.tTransparency,i.texture),R.update(e.uTransparencyTexDim,i.texDim))}}function Kpe(e){return e==="groupInstance"}function Qpe(e,t,r,n,a){if(!!Kpe(e.dSubstanceType.ref.value)){var i=hb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,a);i.kind==="volume"?(R.updateIfChanged(e.dSubstanceType,i.type),R.update(e.tSubstanceGrid,i.texture),R.update(e.uSubstanceTexDim,i.gridTexDim),R.update(e.uSubstanceGridDim,i.gridDim),R.update(e.uSubstanceGridTransform,i.gridTransform)):i.kind==="vertex"&&(R.updateIfChanged(e.dSubstanceType,i.type),R.update(e.tSubstance,i.texture),R.update(e.uSubstanceTexDim,i.texDim))}}var Zpe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`,$pe=`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`,Jpe=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`,eve={drawCount:xn("number"),instanceCount:xn("number"),stride:xn("number"),uTotalCount:Ee("i"),uInstanceCount:Ee("i"),uGroupCount:Ee("i"),aTransform:wr("float32",16,1),aInstance:wr("float32",1,1),aSample:wr("float32",1,0),uGeoTexDim:Ee("v2","buffered"),tPosition:Lt("texture","rgba","float","nearest"),tGroup:Lt("texture","rgba","float","nearest"),uColorTexDim:Ee("v2"),tColor:Lt("texture","rgba","ubyte","nearest"),dColorType:Ot("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ee("f"),uCurrentX:Ee("f"),uCurrentY:Ee("f"),uBboxMin:Ee("v3","material"),uBboxSize:Ee("v3","material"),uResolution:Ee("f","material")},uo="color-accumulate",r0="color-count";function b8(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function tve(e,t,r,n,a){if(e.namedComputeRenderables[uo]){var i=S.sub(S(),r.max,r.min),o=e.namedComputeRenderables[uo].values,s=Math.round(t.vertexCount/a);(s>o.drawCount.ref.value||a!==o.stride.ref.value)&&R.update(o.aSample,b8(s,a)),R.updateIfChanged(o.drawCount,s),R.updateIfChanged(o.instanceCount,t.instanceCount),R.updateIfChanged(o.stride,a),R.updateIfChanged(o.uTotalCount,t.vertexCount),R.updateIfChanged(o.uInstanceCount,t.instanceCount),R.updateIfChanged(o.uGroupCount,t.groupCount),R.update(o.aTransform,t.transformBuffer),R.update(o.aInstance,t.instanceBuffer),R.update(o.uGeoTexDim,Fe.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),R.update(o.tPosition,t.positionTexture),R.update(o.tGroup,t.groupTexture),R.update(o.uColorTexDim,Fe.set(o.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),R.update(o.tColor,t.colorData),R.updateIfChanged(o.dColorType,t.colorType),R.updateIfChanged(o.uCurrentSlice,0),R.updateIfChanged(o.uCurrentX,0),R.updateIfChanged(o.uCurrentY,0),R.update(o.uBboxMin,r.min),R.update(o.uBboxSize,i),R.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[uo].update()}else e.namedComputeRenderables[uo]=rve(e,t,r,n,a);return e.namedComputeRenderables[uo]}function rve(e,t,r,n,a){var i=S.sub(S(),r.max,r.min),o=Math.round(t.vertexCount/a),s={drawCount:R.create(o),instanceCount:R.create(t.instanceCount),stride:R.create(a),uTotalCount:R.create(t.vertexCount),uInstanceCount:R.create(t.instanceCount),uGroupCount:R.create(t.groupCount),aTransform:R.create(t.transformBuffer),aInstance:R.create(t.instanceBuffer),aSample:R.create(b8(o,a)),uGeoTexDim:R.create(Fe.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:R.create(t.positionTexture),tGroup:R.create(t.groupTexture),uColorTexDim:R.create(Fe.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:R.create(t.colorData),dColorType:R.create(t.colorType),uCurrentSlice:R.create(0),uCurrentX:R.create(0),uCurrentY:R.create(0),uBboxMin:R.create(r.min),uBboxSize:R.create(i),uResolution:R.create(n)},u=I({},eve),c=Qr("accumulate",Jpe,$pe,{drawBuffers:"required"}),l=zn(e,"points",c,u,s);return Vn(l,s)}function nve(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var ave=I(I({},ua),{tColor:Lt("texture","rgba","float","nearest"),tCount:Lt("texture","alpha","float","nearest"),uTexSize:Ee("v2")}),n0="color-normalize";function ive(e,t,r){if(e.namedComputeRenderables[n0]){var n=e.namedComputeRenderables[n0].values;R.update(n.tColor,t),R.update(n.tCount,r),R.update(n.uTexSize,Fe.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[n0].update()}else e.namedComputeRenderables[n0]=ove(e,t,r);return e.namedComputeRenderables[n0]}function ove(e,t,r){var n=I(I({},ca),{tColor:R.create(t),tCount:R.create(r),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight()))}),a=I({},ave),i=Qr("normalize",Ka,Zpe),o=zn(e,"triangles",i,a,n);return Vn(o,n)}function sve(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function uve(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}function gb(e,t,r,n,a){var i=n.extensions.drawBuffers;if(!i)throw new Error("need WebGL draw buffers");var o=n.gl,s=n.resources,u=n.state,c=n.extensions,l=c.colorBufferHalfFloat,f=c.textureHalfFloat,d=e.colorType.endsWith("Instance"),m=Bt.fromSphere3D(Bt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,v=Bt.scale(Bt(),m,p),h=Bt.size(S(),v);S.ceil(h,h),S.add(h,h,S.create(2,2,2));var g=m.min,y=h[0],b=h[1],x=h[2],C=uve(h),_=C.texDimX,w=C.texDimY,T=C.texCols;n.namedFramebuffers[uo]||(n.namedFramebuffers[uo]=n.resources.framebuffer());var A=n.namedFramebuffers[uo];rr(o)?(n.namedTextures[uo]||(n.namedTextures[uo]=l&&f?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[r0]||(n.namedTextures[r0]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[uo]||(n.namedTextures[uo]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[r0]||(n.namedTextures[r0]=s.texture("image-float32","rgba","float","nearest")));var D=n.namedTextures[uo],E=n.namedTextures[r0];D.define(_,w),E.define(_,w),D.attachFramebuffer(A,0),E.attachFramebuffer(A,1);var M=tve(n,e,m,t,r);u.currentRenderItemId=-1,A.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);var F=M.values,O=F.uCurrentSlice,U=F.uCurrentX,N=F.uCurrentY;nve(n),o.viewport(0,0,_,w),o.scissor(0,0,_,w),o.clear(o.COLOR_BUFFER_BIT),R.update(N,0);for(var q=0,j=0,Q=0,J=0;J<x;++J)q>=T&&(q-=T,j+=b,Q=0,R.update(N,j)),R.update(U,Q),R.update(O,J),o.viewport(Q,j,y,b),o.scissor(Q,j,y,b),M.render(),++q,Q+=y;D.detachFramebuffer(A,0),E.detachFramebuffer(A,1),i.drawBuffers([o.COLOR_ATTACHMENT0,o.NONE]),a||(a=s.texture("image-uint8","rgba","ubyte","linear")),a.define(_,w);var te=ive(n,D,E);u.currentRenderItemId=-1,sve(n),a.attachFramebuffer(A,0),o.viewport(0,0,_,w),o.scissor(0,0,_,w),o.clear(o.COLOR_BUFFER_BIT),te.render();var K=Wt.create(g[0],g[1],g[2],p),L=d?"volumeInstance":"volume";return{texture:a,gridDim:h,gridTexDim:Fe.create(_,w),gridTransform:K,type:L}}var TA="color-smoothing-rgb",hp="color-smoothing-rgba",PA="color-smoothing-alpha";function cve(e){return e==="group"||e==="groupInstance"}function x8(e,t,r,n,a){if(!!cve(e.dColorType.ref.value)){r*=3,n.namedTextures[TA]||(n.namedTextures[TA]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));var i=n.namedTextures[TA];i.load(e.tColor.ref.value);var o=gb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dColorType,o.type),R.update(e.tColorGrid,o.texture),R.update(e.uColorTexDim,o.gridTexDim),R.update(e.uColorGridDim,o.gridDim),R.update(e.uColorGridTransform,o.gridTransform)}}function lve(e){return e==="groupInstance"}function fve(e,t,r,n,a){if(!!lve(e.dOverpaintType.ref.value)){r*=3,n.namedTextures[hp]||(n.namedTextures[hp]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[hp];i.load(e.tOverpaint.ref.value);var o=gb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dOverpaintType,o.type),R.update(e.tOverpaintGrid,o.texture),R.update(e.uOverpaintTexDim,o.gridTexDim),R.update(e.uOverpaintGridDim,o.gridDim),R.update(e.uOverpaintGridTransform,o.gridTransform)}}function dve(e){return e==="groupInstance"}function mve(e,t,r,n,a){if(!!dve(e.dTransparencyType.ref.value)){r*=3,n.namedTextures[PA]||(n.namedTextures[PA]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));var i=n.namedTextures[PA];i.load(e.tTransparency.ref.value);var o=gb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dTransparencyType,o.type),R.update(e.tTransparencyGrid,o.texture),R.update(e.uTransparencyTexDim,o.gridTexDim),R.update(e.uTransparencyGridDim,o.gridDim),R.update(e.uTransparencyGridTransform,o.gridTransform)}}function pve(e){return e==="groupInstance"}function vve(e,t,r,n,a){if(!!pve(e.dSubstanceType.ref.value)){r*=3,n.namedTextures[hp]||(n.namedTextures[hp]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));var i=n.namedTextures[hp];i.load(e.tSubstance.ref.value);var o=gb({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,a);R.updateIfChanged(e.dSubstanceType,o.type),R.update(e.tSubstanceGrid,o.texture),R.update(e.uSubstanceTexDim,o.gridTexDim),R.update(e.uSubstanceGridDim,o.gridDim),R.update(e.uSubstanceGridTransform,o.gridTransform)}}var Kt;(function(e){function t(f,d){f&&(f.state.visible=d)}e.setVisibility=t;function r(f,d){f&&(f.state.alphaFactor=d)}e.setAlphaFactor=r;function n(f,d){f&&(f.state.pickable=d)}e.setPickable=n;function a(f,d){f&&(f.state.colorOnly=d)}e.setColorOnly=a;function i(f,d,m,p,v){if(!f||Ja(d))return!1;var h=f.values,g=h.tMarker,y=h.uMarker,b=h.markerAverage,x=h.markerStatus,C=h.uGroupCount,_=h.instanceCount,w=C.ref.value*_.ref.value,T=g.ref.value.array,A=x.ref.value;if(!jo(d)){var D=0;if(p(d,function(U){return D+=Se.size(U),!0},!0),D===0)return!1;D===w&&(d=db)}var E=!1,M=-1,F=-1;if(jo(d)){var O=kpe(m,A);O.status!==-1?(E=A!==O.status,E&&Ope(T,O.status,w)):E=CA(T,Se.ofLength(w),m),M=O.average,F=O.status}else E=p(d,function(U){return CA(T,U,m)},!0),E&&(M=Lpe(m,A),v&&v.status!==-1&&M===-1&&$a.isReverse(v.action,m)&&Ut.areEqual(d,v.loci)&&(F=v.status,M=F===0?0:.5));return E&&(M===-1&&(M=DB(T,w),M===0&&(F=0)),v&&(v.action=m,v.loci=d,v.status=A),R.updateIfChanged(y,F),F===-1&&R.update(g,g.ref.value),R.updateIfChanged(b,M),R.updateIfChanged(x,F)),E}e.mark=i;function o(f,d,m,p,v){if(!!f){var h=f.values,g=h.tOverpaint,y=h.dOverpaintType,b=h.dOverpaint,x=h.uGroupCount,C=h.instanceCount,_=x.ref.value*C.ref.value;Zte(d.layers.length?_:0,f.values);var w=g.ref.value.array;p&&pF(w,0,_);for(var T=function(Q,J){var te=d.layers[Q],K=te.loci,L=te.color,W=te.clear,k=function(V){var G=Se.start(V),H=Se.end(V);return W?pF(w,G,H):Qte(w,G,H,L)};m(K,k,!1)},A=0,D=d.layers.length;A<D;++A)T(A);if(R.update(g,g.ref.value),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(b,d.layers.length>0),d.layers.length!==0&&v&&qu(v.props)){var E=v.geometry,M=v.props,F=v.webgl;if(E.kind==="mesh"){var O=E.meta,U=O.resolution,N=O.overpaintTexture,q=Ss(M.smoothColors,!0,U);q&&(Wpe(f.values,q.resolution,q.stride,F,N),E.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}else if(F&&E.kind==="texture-mesh"){var j=E.meta,U=j.resolution,N=j.overpaintTexture,q=Ss(M.smoothColors,!0,U);q&&(fve(f.values,q.resolution,q.stride,F,N),E.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}}}}e.setOverpaint=o;function s(f,d,m,p,v){if(!!f){var h=f.values,g=h.tTransparency,y=h.dTransparencyType,b=h.transparencyAverage,x=h.dTransparency,C=h.uGroupCount,_=h.instanceCount,w=C.ref.value*_.ref.value;ere(d.layers.length?w:0,f.values);var T=g.ref.value.array;p&&Jte(T,0,w);for(var A=function(J,te){var K=d.layers[J],L=K.loci,W=K.value,k=function(V){var G=Se.start(V),H=Se.end(V);return $te(T,G,H,W)};m(L,k,!1)},D=0,E=d.layers.length;D<E;++D)A(D);if(R.update(g,g.ref.value),R.updateIfChanged(b,hF(T,w)),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(x,d.layers.length>0),d.layers.length!==0&&v&&qu(v.props)){var M=v.geometry,F=v.props,O=v.webgl;if(M.kind==="mesh"){var U=M.meta,N=U.resolution,q=U.transparencyTexture,j=Ss(F.smoothColors,!0,N);j&&(Ype(f.values,j.resolution,j.stride,O,q),M.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}else if(O&&M.kind==="texture-mesh"){var Q=M.meta,N=Q.resolution,q=Q.transparencyTexture,j=Ss(F.smoothColors,!0,N);j&&(mve(f.values,j.resolution,j.stride,O,q),M.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}}}}e.setTransparency=s;function u(f,d,m,p,v){if(!!f){var h=f.values,g=h.tSubstance,y=h.dSubstanceType,b=h.dSubstance,x=h.uGroupCount,C=h.instanceCount,_=x.ref.value*C.ref.value;ire(d.layers.length?_:0,f.values);var w=g.ref.value.array;p&&bF(w,0,_);for(var T=function(Q,J){var te=d.layers[Q],K=te.loci,L=te.material,W=te.clear,k=function(V){var G=Se.start(V),H=Se.end(V);return W?bF(w,G,H):are(w,G,H,L)};m(K,k,!1)},A=0,D=d.layers.length;A<D;++A)T(A);if(R.update(g,g.ref.value),R.updateIfChanged(y,"groupInstance"),R.updateIfChanged(b,d.layers.length>0),d.layers.length!==0&&v&&qu(v.props)){var E=v.geometry,M=v.props,F=v.webgl;if(E.kind==="mesh"){var O=E.meta,U=O.resolution,N=O.substanceTexture,q=Ss(M.smoothColors,!0,U);q&&(Qpe(f.values,q.resolution,q.stride,F,N),E.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}else if(F&&E.kind==="texture-mesh"){var j=E.meta,U=j.resolution,N=j.substanceTexture,q=Ss(M.smoothColors,!0,U);q&&(vve(f.values,q.resolution,q.stride,F,N),E.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}}}}e.setSubstance=u;function c(f,d,m,p){if(!!f){var v=f.values,h=v.tClipping,g=v.dClipping,y=v.uGroupCount,b=v.instanceCount,x=y.ref.value*b.ref.value,C=d.layers;nre(C.length?x:0,f.values);var _=h.ref.value.array;p&&rre(_,0,x);for(var w=function(D,E){var M=d.layers[D],F=M.loci,O=M.groups,U=function(N){var q=Se.start(N),j=Se.end(N);return tre(_,q,j,O)};m(F,U,!1)},T=0,A=d.layers.length;T<A;++T)w(T);R.update(h,h.ref.value),R.updateIfChanged(g,d.layers.length>0)}}e.setClipping=c;function l(f,d,m){if(!(!f||!d&&!m)){var p=f.values;d&&(se.copy(p.matrix.ref.value,d),R.update(p.matrix,p.matrix.ref.value)),m?(p.extraTransform.ref.value.set(m),R.update(p.extraTransform,p.extraTransform.ref.value)):m===null&&(s1(p.extraTransform.ref.value,p.instanceCount.ref.value),R.update(p.extraTransform,p.extraTransform.ref.value)),FB(p);var v=sa(p.invariantBoundingSphere.ref.value,p.aTransform.ref.value,p.instanceCount.ref.value);R.update(p.boundingSphere,v)}}e.setTransform=l})(Kt||(Kt={}));function Yr(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(c){c.is=Da.has;function l(v){return Da.create(v)}c.create=l,c.Names={one:1,two:2,three:4,four:8,five:16,six:32};function f(v){return v in c.Names}c.isName=f;function d(v){switch(v){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}c.fromName=d;function m(v){for(var h=0,g=0,y=v.length;g<y;++g)h|=d(v[g]);return h}c.fromNames=m;function p(v){var h=[];return c.is(v,1)&&h.push("one"),c.is(v,2)&&h.push("two"),c.is(v,4)&&h.push("three"),c.is(v,8)&&h.push("four"),c.is(v,16)&&h.push("five"),c.is(v,32)&&h.push("six"),h}c.toNames=p}(e.Groups||(e.Groups={}));function t(c,l){if(c.layers.length!==l.layers.length)return!1;for(var f=0,d=c.layers.length;f<d;++f)if(c.layers[f].groups!==l.layers[f].groups||!Ut.areEqual(c.layers[f].loci,l.layers[f].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,l){for(var f=[],d=0,m=c.layers;d<m.length;d++){var p=m[d],v=p.loci,h=p.groups;v=_e.remap(v,l),_e.isEmpty(v)||f.push({loci:v,groups:h})}return{layers:f}}e.remap=n;function a(c){if(r(c))return c;for(var l=c.layers[0].loci.structure,f=new Map,d=_e.none(l),m=0,p=c.layers.length;m<p;++m){var v=c.layers[p-m-1],h=v.loci,g=v.groups;h=_e.subtract(h,d),d=_e.union(h,d),_e.isEmpty(h)||(f.has(g)&&(h=_e.union(h,f.get(g))),f.set(g,h))}var y=[];return f.forEach(function(b,x){y.push({loci:b,groups:x})}),{layers:y}}e.merge=a;function i(c,l){if(r(c))return c;for(var f=c.layers[0].loci.structure,d=[],m=0,p=c.layers;m<p.length;m++){var v=p[m],h=v.loci,g=v.groups,y=_e.remap(h,l);h=_e.remap(y,f),_e.isEmpty(h)||d.push({loci:h,groups:g})}return{layers:d}}e.filter=i;function o(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.script,h=p.groups,g=Gn.toLoci(v,l);_e.isEmpty(g)||f.push({loci:g,groups:h})}return{layers:f}}e.ofScript=o;function s(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.bundle,h=p.groups,g=Cr.toLoci(v,l.root);f.push({loci:g,groups:h})}return{layers:f}}e.ofBundle=s;function u(c){for(var l=[],f=0,d=c.layers.length;f<d;++f){var m=c.layers[f],p=m.loci,v=m.groups,h=Cr.fromLoci(p);l.push({bundle:h,groups:v})}return{layers:l}}e.toBundle=u})(Yr||(Yr={}));function Sa(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(c,l){if(c.layers.length===0&&l.layers.length===0)return!0;if(c.layers.length!==l.layers.length)return!1;for(var f=0,d=c.layers.length;f<d;++f)if(c.layers[f].clear!==l.layers[f].clear||!KC(c.layers[f].material,l.layers[f].material)||!Ut.areEqual(c.layers[f].loci,l.layers[f].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,l){for(var f=[],d=0,m=c.layers;d<m.length;d++){var p=m[d],v=p.loci,h=p.material,g=p.clear;v=_e.remap(v,l),_e.isEmpty(v)||f.push({loci:v,material:h,clear:g})}return{layers:f}}e.remap=n;function a(c){if(r(c))return c;for(var l=c.layers[0].loci.structure,f=void 0,d=new Map,m=_e.none(l),p=0,v=c.layers.length;p<v;++p){var h=c.layers[v-p-1],g=h.loci,y=h.material,b=h.clear;g=_e.subtract(g,m),m=_e.union(g,m),_e.isEmpty(g)||(b?f=f?_e.union(g,f):g:(d.has(y)&&(g=_e.union(g,d.get(y))),d.set(y,g)))}var x=[];return f&&x.push({loci:f,material:Ya(),clear:!0}),d.forEach(function(C,_){x.push({loci:C,material:_,clear:!1})}),{layers:x}}e.merge=a;function i(c,l){if(r(c))return c;for(var f=c.layers[0].loci.structure,d=[],m=0,p=c.layers;m<p.length;m++){var v=p[m],h=v.loci,g=v.material,y=v.clear,b=_e.remap(h,l);h=_e.remap(b,f),_e.isEmpty(h)||d.push({loci:h,material:g,clear:y})}return{layers:d}}e.filter=i;function o(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.script,h=p.material,g=p.clear,y=Gn.toLoci(v,l);_e.isEmpty(y)||f.push({loci:y,material:h,clear:g})}return{layers:f}}e.ofScript=o;function s(c,l){for(var f=[],d=0,m=c.length;d<m;++d){var p=c[d],v=p.bundle,h=p.material,g=p.clear,y=Cr.toLoci(v,l.root);f.push({loci:y,material:h,clear:g})}return{layers:f}}e.ofBundle=s;function u(c){for(var l=[],f=0,d=c.layers.length;f<d;++f){var m=c.layers[f],p=m.loci,v=m.material,h=m.clear,g=Cr.fromLoci(p);l.push({bundle:g,material:v,clear:h})}return{layers:l}}e.toBundle=u})(Sa||(Sa={}));var S8;(function(e){function t(r,n,a){return P.getDefaultValues(r.getParams(n,a))}e.getDetaultParams=t})(S8||(S8={}));var hve={name:"",label:"",description:"",factory:function(){return Vt.Empty},getParams:function(){return{}},defaultValues:{},defaultColorTheme:du.EmptyProvider,defaultSizeTheme:ea.EmptyProvider,isApplicable:function(){return!0}};function C8(e){return e.map(function(t){return[t.name,t.provider.label]})}var _8=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return C8(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error("".concat(t.name," already registered."));this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'".concat(t.label,"' is not a registered represenatation provider."));return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(a){return a.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||hve},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return C8(this.getApplicableList(t))},e}(),Vt;(function(e){(function(o){function s(c,l){return c.repr===l.repr&&Ut.areEqual(c.loci,l.loci)}o.areEqual=s;function u(c){return Ut.isEmpty(c.loci)}o.isEmpty=u,o.Empty={loci:ur}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:se.identity(),overpaint:ba.Empty,transparency:xa.Empty,substance:Sa.Empty,clipping:Yr.Empty,markerActions:$a.All}}e.createState=t;function r(o,s){s.visible!==void 0&&(o.visible=s.visible),s.alphaFactor!==void 0&&(o.alphaFactor=s.alphaFactor),s.pickable!==void 0&&(o.pickable=s.pickable),s.colorOnly!==void 0&&(o.colorOnly=s.colorOnly),s.overpaint!==void 0&&(o.overpaint=s.overpaint),s.transparency!==void 0&&(o.transparency=s.transparency),s.substance!==void 0&&(o.substance=s.substance),s.clipping!==void 0&&(o.clipping=s.clipping),s.syncManually!==void 0&&(o.syncManually=s.syncManually),s.transform!==void 0&&se.copy(o.transform,s.transform),s.markerActions!==void 0&&(o.markerActions=s.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new En,state:t(),theme:kn.createEmpty(),createOrUpdate:function(){return Be.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return ur},mark:function(){return!1},destroy:function(){}};var n=function(){function o(){this.curr=new Set,this.next=new Set,this._version=-1}return Object.defineProperty(o.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),o.prototype.add=function(s,u){this.next.add(To(s,u))},o.prototype.snapshot=function(){var s;Cn.areEqual(this.curr,this.next)||(this._version+=1),s=[this.next,this.curr],this.curr=s[0],this.next=s[1],this.next.clear()},o}();e.GeometryState=n;function a(o,s,u,c,l){var f=this,d=0,m=new En,p=new n,v=c.create(),h=kn.createEmpty(),g,y,b,x={},C=Object.keys(l).map(function(_,w){x[w]=_;var T=l[_](s,u);return T.setState(v),T});return{label:o,updated:m,get groupCount(){var _=0;if(y)for(var w=y.visuals,T=0,A=C.length;T<A;++T)(!w||w.includes(x[T]))&&(_+=C[T].groupCount);return _},get renderObjects(){var _=[];if(y)for(var w=y.visuals,T=0,A=C.length;T<A;++T)(!w||w.includes(x[T]))&&_.push.apply(_,C[T].renderObjects);return _},get geometryVersion(){return p.version},get props(){return y},get params(){return g},createOrUpdate:function(_,w){_===void 0&&(_={}),w&&w!==b&&(g=u(s,w),b=w,y||(y=P.getDefaultValues(g)));var T=_A(Object.assign({},y,_),b);Object.assign(y,_,T);var A=y.visuals;return Be.create("Creating or updating '".concat(o,"' representation"),function(D){return ie(f,void 0,void 0,function(){var E,M;return ae(this,function(F){switch(F.label){case 0:E=0,M=C.length,F.label=1;case 1:return E<M?!A||A.includes(x[E])?[4,C[E].createOrUpdate(y,b).runInContext(D)]:[3,3]:[3,5];case 2:F.sent(),F.label=3;case 3:p.add(E,C[E].geometryVersion),F.label=4;case 4:return++E,[3,1];case 5:return p.snapshot(),m.next(d++),[2]}})})})},get state(){return v},get theme(){return h},getLoci:function(_){for(var w=y.visuals,T=0,A=C.length;T<A;++T)if(!w||w.includes(x[T])){var D=C[T].getLoci(_);if(!Ja(D))return D}return ur},mark:function(_,w){for(var T=!1,A=0,D=C.length;A<D;++A)T=C[A].mark(_,w)||T;return T},setState:function(_){c.update(v,_);for(var w=0,T=C.length;w<T;++w)C[w].setState(_)},setTheme:function(_){h=_;for(var w=0,T=C.length;w<T;++w)C[w].setTheme(_)},destroy:function(){for(var _=0,w=C.length;_<w;++_)C[_].destroy()}}}e.createMulti=a;function i(o,s){var u=this,c=0,l=new En,f=new n,d=e.createState(),m=kn.createEmpty(),p=P.clone(Je.Params),v=P.getDefaultValues(Je.Params);return{label:o,updated:l,get groupCount(){return s.values.uGroupCount.ref.value},get renderObjects(){return[s]},get geometryVersion(){return f.version},get props(){return v},get params(){return p},createOrUpdate:function(h){h===void 0&&(h={});var g=_A(Object.assign({},v,h));return Object.assign(v,h,g),Be.create("Updating '".concat(o,"' representation"),function(y){return ie(u,void 0,void 0,function(){return ae(this,function(b){return f.add(0,s.id),f.snapshot(),l.next(c++),[2]})})})},get state(){return d},get theme(){return m},getLoci:function(){return ur},mark:function(h,g){return!1},setState:function(h){h.visible!==void 0&&Kt.setVisibility(s,h.visible),h.alphaFactor!==void 0&&Kt.setAlphaFactor(s,h.alphaFactor),h.pickable!==void 0&&Kt.setPickable(s,h.pickable),h.colorOnly!==void 0&&Kt.setColorOnly(s,h.colorOnly),h.overpaint!==void 0,h.transparency!==void 0,h.substance!==void 0,h.transform!==void 0&&Kt.setTransform(s,h.transform),e.updateState(d,h)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=i})(Vt||(Vt={}));function Hn(e,t,r){r===void 0&&(r={});var n=0,a=new En,i=Vt.createState(),o=oc(),s=[],u,c,l=-1,f=kn.createEmpty(),d=P.getDefaultValues(t.Params),m,p,v;r.modifyState&&Vt.updateState(i,r.modifyState(i));var h=mu.create();function g(x,C){mu.reset(h),!(!C&&!c)&&(C&&!c?h.createNew=!0:C&&c&&C.id===c.id||(C&&c&&C.id!==c.id?(h.updateTransform=!0,h.createGeometry=!0):C&&console.warn("unexpected state")),h.updateTransform&&(h.updateColor=!0,h.updateSize=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0))}function y(x,C){var _=this;return x===void 0&&(x={}),r.modifyProps&&(x=r.modifyProps(x)),Be.create("ShapeRepresentation.create",function(w){return ie(_,void 0,void 0,function(){var T,A,D,E,M,F,O,U;return ae(this,function(N){switch(N.label){case 0:return T=Object.assign(d,x),C?[4,e(w,C,T,c)]:[3,2];case 1:return D=N.sent(),[3,3];case 2:D=void 0,N.label=3;case 3:if(A=D,g(x,A),A&&(c=A,Object.assign(f,fr.getTheme(c))),h.createNew)s.length=0,p=fr.groupIterator(c),E=fr.createTransform(c.transforms),M=t.createValues(c.geometry,E,p,f,T),F=t.createRenderableState(T),r.modifyState&&Object.assign(F,r.modifyState(F)),Vt.updateState(i,F),u=np(c.geometry.kind,M,F,o),u&&s.push(u),v=t.createPositionIterator(c.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");h.updateTransform&&(fr.createTransform(c.transforms,u.values),p=fr.groupIterator(c),O=p.instanceCount,U=p.groupCount,Fo(O*U,u.values)),h.createGeometry&&(R.updateIfChanged(u.values.drawCount,ya.getDrawCount(c.geometry)),R.updateIfChanged(u.values.uVertexCount,ya.getVertexCount(c.geometry))),(h.updateTransform||h.createGeometry)&&(t.updateBoundingSphere(u.values,c.geometry),v=t.createPositionIterator(c.geometry,u.values)),h.updateColor&&ao(p,v,f.color,u.values),h.updateSize&&"uSize"in u.values&&Hu(p,f.size,u.values),t.updateValues(u.values,T),t.updateRenderableState(u.state,T)}return d=T,(h.createGeometry||h.createNew)&&(l+=1),a.next(n++),[2]}})})})}function b(x,C){return jo(x)||fr.isLoci(x)&&x.shape===c?C(Se.ofBounds(0,c.groupCount*c.transforms.length)):gve(x,c,C)}return{label:"Shape geometry",get groupCount(){return p?p.count:0},get props(){return d},get params(){return m},get state(){return i},get theme(){return f},renderObjects:s,get geometryVersion(){return l},updated:a,createOrUpdate:y,getLoci:function(x){if(x===void 0)return fr.Loci(c);var C=x.objectId,_=x.groupId,w=x.instanceId;return u&&u.id===C?hi.Loci(c,[{ids:De.ofSingleton(_),instance:w}]):ur},mark:function(x,C){if(!$a.is(i.markerActions,C))return!1;if(hi.isLoci(x)||fr.isLoci(x)){if(x.shape!==c)return!1}else if(!jo(x))return!1;return Kt.mark(u,x,C,b)},setState:function(x){r.modifyState&&(x=r.modifyState(x)),u&&(x.visible!==void 0&&Kt.setVisibility(u,x.visible),x.alphaFactor!==void 0&&Kt.setAlphaFactor(u,x.alphaFactor),x.pickable!==void 0&&Kt.setPickable(u,x.pickable),x.colorOnly!==void 0&&Kt.setColorOnly(u,x.colorOnly),x.overpaint!==void 0&&Kt.setOverpaint(u,x.overpaint,b,!0),x.transparency!==void 0&&Kt.setTransparency(u,x.transparency,b,!0),x.substance!==void 0&&Kt.setSubstance(u,x.substance,b,!0),x.transform!==void 0&&Kt.setTransform(u,x.transform)),Vt.updateState(i,x)},setTheme:function(x){hr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function gve(e,t,r){if(!hi.isLoci(e)||e.shape!==t)return!1;for(var n=!1,a=t.groupCount,i=e.groups,o=0,s=i;o<s.length;o++){var u=s[o],c=u.ids,l=u.instance;if(Se.is(c)){var f=l*a+Se.start(c),d=l*a+Se.end(c);r(Se.ofBounds(f,d))&&(n=!0)}else for(var m=0,p=c.length;m<p;m++){var v=l*a+c[m];r(Se.ofSingleton(v))&&(n=!0)}}return n}var w8=se(),gp=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Do.Mutable(),this.groupIndexMap=Do.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,a=t.unitSymmetryGroups.length;n<a;++n){var i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);var o=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=i.units.length;s<u;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}return e.prototype.reset=function(){this.version=0,s1(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(se.fromArray(w8,this.unitTransforms,t),!se.isIdentity(w8)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,se.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return se.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),A8=se();function T8(e,t,r){for(var n=0,a=e.units.length;n<a;n++){var i=e.units[n];jr.lerpFromIdentity(A8,i.conformation.operator,r),t.setTransform(A8,i)}}var P8=S(),yp=S(),yb=se();function E8(e,t,r,n){for(var a=n.radius*r,i=0,o=e.units.length;i<o;i++){var s=e.units[i];S.transformMat4(P8,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),S.sub(yp,P8,n.center),S.setMagnitude(yp,yp,a),se.fromTranslation(yb,yp),t.setTransform(yb,s)}}var yve={axis:P.MappedStatic("custom",{structure:P.Group({principalAxis:P.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:P.Group({vector:P.Vec3(S.create(0,0,1))})}),origin:P.MappedStatic("structure",{structure:P.Group({}),custom:P.Group({vector:P.Vec3(S.create(0,0,0))})})};function I8(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var a=ke.getPrincipalAxes(e);r=a.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var a=ke.getPrincipalAxes(e);n=a.momentsAxes.origin}return{axis:r,origin:n}}var D8=se(),M8=se(),bb=se();function R8(e,t,r,n,a){for(var i=0,o=e.units.length;i<o;i++){var s=e.units[i];S.negate(yp,a),se.fromTranslation(yb,yp),se.fromRotation(D8,Math.PI*r*2,n),se.fromTranslation(M8,a),se.mul(bb,D8,yb),se.mul(bb,M8,bb),t.setTransform(bb,s)}}var bve=se.fromTranslation(se(),S.create(.5,.5,.5)),xve=DF(IF(RF()),bve),As=S(),B8=se(),Sve={origin:"Origin",model:"Model"},Cve={corner:"Corner",center:"Center"},_ve=I(I({},At.Params),{cellColor:P.Color(tr.orange),cellScale:P.Numeric(2,{min:.1,max:5,step:.1}),ref:P.Select("model",P.objectToOptions(Sve),{isEssential:!0}),attachment:P.Select("corner",P.objectToOptions(Cve),{isEssential:!0})}),wve={mesh:function(e,t){return Hn(Tve,At.Utils)}},F8=I({},_ve);function Ave(e,t,r){var n=it.createState(256,128,r),a=e.symmetry.spacegroup.cell.fromFractional;S.copy(As,e.ref),t.attachment==="center"?(S.trunc(As,As),S.subScalar(As,As,.5)):S.floor(As,As),se.fromTranslation(B8,As);var i=DF(IF(xve),B8),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,it.addCage(n,a,i,o,2,20);var s=Te.fromDimensionsAndTransform(Te(),S.unit,a);S.transformMat4(As,As,a),Te.translate(s,s,As),Te.expand(s,s,o);var u=it.getMesh(n);return u.setBoundingSphere(s),u}function Tve(e,t,r,n){var a=Ave(t,r,n&&n.geometry),i=Rh.getUnitcellLabel(t.symmetry);return fr.create(i,t,a,function(){return r.cellColor},function(){return 1},function(){return i})}function O8(e,t,r){var n=S();return r.ref==="model"&&S.transformMat4(n,jt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function Pve(e,t){return Vt.createMulti("Unit Cell",e,t,Vt.StateBuilder,wve)}var Wo=new Uint16Array([0,1,2,1,3,2]),hd=Me.add3,Ca=Me.add2,k8=Me.add,gc;(function(e){function t(r,n,a,i){r===void 0&&(r={}),n===void 0&&(n=2048),a===void 0&&(a=1024),n*=2,a*=2;var o=Me.create(Float32Array,3,a,i?i.centerBuffer.ref.value:n),s=Me.create(Float32Array,2,a,i?i.mappingBuffer.ref.value:n),u=Me.create(Float32Array,1,a,i?i.depthBuffer.ref.value:n),c=Me.create(Uint32Array,3,a,i?i.indexBuffer.ref.value:n),l=Me.create(Float32Array,1,a,i?i.groupBuffer.ref.value:n),f=Me.create(Float32Array,2,a,i?i.tcoordBuffer.ref.value:n),d=I(I({},P.getDefaultValues(Oo.Params)),r),m=d.attachment,p=d.background,v=d.backgroundMargin,h=d.tether,g=d.tetherLength,y=d.tetherBaseWidth,b=ore(d),x=1/2.5*v,C=b.buffer/b.lineHeight,_=function(w,T,A,D,E){hd(o,w,T,A),k8(u,D),k8(l,E)};return{add:function(w,T,A,D,E,M,F){for(var O=0,U=w.length,N=0;N<U;++N){var q=b.get(w[N]);O+=q.nw-2*C}var j=1/1.25,Q,J;if(m.startsWith("top")?Q=j:m.startsWith("middle")?Q=j/2:Q=0,m.endsWith("right")?J=O:m.endsWith("center")?J=O/2:J=0,h)switch(m){case"bottom-left":J-=g/2+x+.1,Q-=g/2+x;break;case"bottom-center":Q-=g+x;break;case"bottom-right":J+=g/2+x+.1,Q-=g/2+x;break;case"middle-left":J-=g+x+.1;break;case"middle-center":break;case"middle-right":J+=g+x+.1;break;case"top-left":J-=g/2+x+.1,Q+=g/2+x;break;case"top-center":Q+=g+x;break;case"top-right":J+=g/2+x+.1,Q+=g/2+x;break}var te=(-J-x-.1)*M,K=(O-J+x+.1)*M,L=(j-Q+x)*M,W=(-Q-x)*M;if(p){Ca(s,te,L),Ca(s,te,W),Ca(s,K,L),Ca(s,K,W);for(var k=o.elementCount,V=0;V<4;++V)Ca(f,10,10),_(T,A,D,E,F);hd(c,k+Wo[0],k+Wo[1],k+Wo[2]),hd(c,k+Wo[3],k+Wo[4],k+Wo[5])}if(h){var G=void 0,H=void 0,X=void 0,Y=void 0,oe=void 0,ue=void 0,me=void 0,he=void 0,Pe=g*M,re=y*M;switch(m){case"bottom-left":G=te-Pe/2,X=te+re/2,oe=te,me=te,H=W-Pe/2,Y=W,ue=W+re/2,he=W;break;case"bottom-center":G=0,X=re/2,oe=-re/2,me=0,H=W-Pe,Y=W,ue=W,he=W;break;case"bottom-right":G=K+Pe/2,X=K,oe=K-re/2,me=K,H=W-Pe/2,Y=W+re/2,ue=W,he=W;break;case"middle-left":G=te-Pe,X=te,oe=te,me=te,H=0,Y=-re/2,ue=re/2,he=0;break;case"middle-center":G=0,X=0,oe=0,me=0,H=0,Y=0,ue=0,he=0;break;case"middle-right":G=K+Pe,X=K,oe=K,me=K,H=0,Y=re/2,ue=-re/2,he=0;break;case"top-left":G=te-Pe/2,X=te+re/2,oe=te,me=te,H=L+Pe/2,Y=L,ue=L-re/2,he=L;break;case"top-center":G=0,X=re/2,oe=-re/2,me=0,H=L+Pe,Y=L,ue=L,he=L;break;case"top-right":G=K+Pe/2,X=K,oe=K-re/2,me=K,H=L+Pe/2,Y=L-re/2,ue=L,he=L;break;default:throw new Error("unsupported attachment")}Ca(s,G,H),Ca(s,X,Y),Ca(s,oe,ue),Ca(s,me,he);for(var k=o.elementCount,V=0;V<4;++V)Ca(f,10,10),_(T,A,D,E,F);hd(c,k,k+1,k+3),hd(c,k,k+3,k+2)}J+=C,Q+=C;for(var ee=0,N=0;N<U;++N){var q=b.get(w[N]),B=(ee-J)*M,z=(ee+q.nw-J)*M,le=(q.nh-Q)*M,pe=-Q*M;Ca(s,B,le),Ca(s,B,pe),Ca(s,z,le),Ca(s,z,pe);var ge=b.texture.width,Ce=b.texture.height;Ca(f,q.x/ge,q.y/Ce),Ca(f,q.x/ge,(q.y+q.h)/Ce),Ca(f,(q.x+q.w)/ge,q.y/Ce),Ca(f,(q.x+q.w)/ge,(q.y+q.h)/Ce),ee+=q.nw-2*C;for(var k=o.elementCount,V=0;V<4;++V)_(T,A,D,E,F);hd(c,k+Wo[0],k+Wo[1],k+Wo[2]),hd(c,k+Wo[3],k+Wo[4],k+Wo[5])}},getText:function(){var w=b.texture,T=Me.compact(o,!0),A=Me.compact(s,!0),D=Me.compact(u,!0),E=Me.compact(c,!0),M=Me.compact(l,!0),F=Me.compact(f,!0);return Oo.create(w,T,A,D,E,M,F,c.elementCount/2,i)}}}e.create=t})(gc||(gc={}));var bp={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function xb(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(c){return c.entry}).filter(function(c){return!!c}).join(", ");case"element-loci":return Sb(lu.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?EA(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(De.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return["".concat(e.volume.label||"Volume"),"Isosurface at ".concat(vt.IsoValue.toString(e.isoValue))].join(" | ");case"cell-loci":var a=De.size(e.indices),i=De.start(e.indices),o=vt.IsoValue.absolute(e.volume.grid.cells.data[i]),s=vt.IsoValue.toRelative(o,e.volume.grid.stats),u=["".concat(e.volume.label||"Volume"),"".concat(a===1?"Cell #".concat(i):"".concat(a," Cells"))];return a===1&&u.push("".concat(vt.IsoValue.toString(o)," (").concat(vt.IsoValue.toString(s),")")),u.join(" | ")}}function xp(e,t){return e===1?"1 ".concat(t):"".concat(e," ").concat(t,"s")}function a0(e,t,r,n,a,i){return"".concat(yc(t,{granularity:r,hidePrefix:n,reverse:a,condensed:i})," <small>[+ ").concat(xp(e-1,"other ".concat(vy(r))),"]</small>")}function Eve(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,a=n.chainAtomSegments,i=n.residueAtomSegments,o=a.offsets[a.index[t[0]]],s=a.offsets[a.index[t[t.length-1]]+1]-1;return i.index[s]-i.index[o]+1}function Sb(e,t){t===void 0&&(t={});var r=I(I({},bp),t),n=Ive(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:QC(n)}function Cb(e,t){t===void 0&&(t={});for(var r=lu.create(),n=0,a=e;n<a.length;n++){var i=a[n];lu.add(r,r,lu.ofLoci(i))}return Sb(r,t)}function Ive(e,t,r,n,a){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),a===void 0&&(a=!1);var i=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,c=e.elementCount;if(!t&&c===1&&s===0&&o===0)return yc(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:a});if(!t&&c===0&&s===1&&o===0)return yc(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:a});if(!t&&c===0&&s===0&&o===1){var l=e.firstChainLoc.unit,f=Re.isAtomic(l)&&Eve(l)===1||Re.Traits.is(l.traits,1)?"residue":"chain";return yc(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:f,reverse:a})}else if(t){var d=[];return i>0&&d.push(xp(i,"Structure")),o>0&&d.push(xp(o,"Chain")),s>0&&d.push(xp(s,"Residue")),u>0&&d.push(xp(u,"Conformation")),c>0&&d.push(xp(c,"Element")),d.join("<small> + </small>")}else{var d=[];return i>0&&d.push(i===1?yc(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:a}):a0(i,e.firstStructureLoc,"structure",r,a,n)),o>0&&(d.push(o===1?yc(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:a}):a0(o,e.firstChainLoc,"chain",r,a,n)),r=!0),s>0&&(d.push(s===1?yc(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:a}):a0(s,e.firstResidueLoc,"residue",r,a,n)),r=!0),u>0&&(d.push(u===1?yc(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:a}):a0(u,e.firstConformationLoc,"conformation",r,a,n)),r=!0),c>0&&d.push(c===1?yc(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:a}):a0(c,e.firstElementLoc,"element",r,a,n)),d.join("<small> + </small>")}}function EA(e,t){return t===void 0&&(t={}),_b({loci:[_e(e.aStructure,[{unit:e.aUnit,indices:De.ofSingleton(e.aIndex)}]),_e(e.bStructure,[{unit:e.bUnit,indices:De.ofSingleton(e.bIndex)}])]},t)}function _b(e,t){t===void 0&&(t={});var r=I(I({},bp),t),n=Dve(e,r);return r.htmlStyling?n:QC(n)}function Dve(e,t){for(var r=t.granularity,n=t.hidePrefix,a=t.reverse,i=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var c=u[s];if(!_e.is(c)||_e.size(c)!==1){o=!1;break}}if(o){var l=e.loci.map(function(b){var x=b.elements[0],C=x.unit,_=x.indices;return Qe.create(b.structure,C,C.elements[De.start(_)])}),f=l.map(function(b){return L8(b,r,n,a||i)});if(i)return f.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" \u2014 ");for(var d=0,m=0,p=Math.min.apply(Math,f.map(function(b){return b.length}))-1;m<p;++m){for(var v=!0,h=1,g=f.length;h<g;++h)if(f[0][m]!==f[h][m]){v=!1;break}if(v)d+=1;else break}if(d>0){for(var y=[f[0].join(" | ")],h=1,g=f.length;h<g;++h)y.push(f[h].slice(d).filter(function(C){return!!C}).join(" | "));return y.join(" \u2014 ")}else return f.map(function(b){return b.filter(function(x){return!!x}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var f=e.loci.map(function(x){return xb(x,t)});return f.filter(function(x){return!!x}).join(i?" \u2014 ":"</br>")}}function yc(e,t){var r,n;t===void 0&&(t={});var a=I(I({},bp),t),i=L8(e,a.granularity,a.hidePrefix,a.reverse||a.condensed),o=a.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(function(s){return!!s}).join(" | ");return a.htmlStyling?o:QC(o)}function L8(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var a=[];if(!r){var i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),a.push("<small>".concat(i,"</small>")),t!=="structure"&&(a.push("<small>Model ".concat(e.unit.model.modelNum,"</small>")),a.push("<small>Instance ".concat(e.unit.conformation.operator.name,"</small>")))}return Re.isAtomic(e.unit)?a.push.apply(a,Mve(e,t,n)):Re.isCoarse(e.unit)?a.push.apply(a,Rve(e,t)):a.push("Unknown"),n?a.reverse():a}function Mve(e,t,r){r===void 0&&(r=!1);var n=Qe.residueIndex(e),a=ft.chain.label_asym_id(e),i=ft.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=ft.residue.label_seq_id(e),u=ft.residue.auth_seq_id(e),c=ft.residue.pdbx_PDB_ins_code(e),l=ft.atom.label_comp_id(e),f=ft.atom.label_atom_id(e),d=ft.atom.label_alt_id(e),m=ft.atom.occupancy(e),p=ft.residue.microheterogeneityCompIds(e),v=t==="residue"&&p.length>1?"(".concat(p.join("|"),")"):l,h=[];switch(t){case"element":h.push("<b>".concat(f,"</b>").concat(d?"%".concat(d):""));case"conformation":t==="conformation"&&d&&h.push("<small>Conformation</small> <b>".concat(d,"</b>"));case"residue":var g=s===u||!o?u:s;h.push("<b>".concat(v," ").concat(g,"</b>").concat(g!==u?" <small>[auth</small> <b>".concat(u,"</b><small>]</small>"):"","<b>").concat(c||"","</b>"));case"chain":a===i?h.push("<b>".concat(a,"</b>")):t==="chain"&&Re.Traits.is(e.unit.traits,1)?h.push("<small>[auth</small> <b>".concat(i,"</b><small>]</small>")):h.push("<b>".concat(a,"</b> <small>[auth</small> <b>").concat(i,"</b><small>]</small>"))}return h.length>0&&m!==1&&!r&&(h[0]="".concat(h[0]," <small>[occupancy</small> <b>").concat(Math.round(100*m)/100,"</b><small>]</small>")),h.reverse()}function Rve(e,t){var r=ft.coarse.asym_id(e),n=ft.coarse.seq_id_begin(e),a=ft.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===a){var o=ft.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);i.push("<b>".concat(u," ").concat(n,"</b>"))}else i.push("<b>".concat(n,"-").concat(a,"</b>"));case"chain":i.push("<b>".concat(r,"</b>"))}return i.reverse()}function IA(e,t){t===void 0&&(t={});var r=I(I(I({},bp),{measureOnly:!1,unitLabel:"\u212B"}),t),n=e.loci.map(function(u){return Ut.getCenter(u)}),a=n[0],i=n[1],o="".concat(S.distance(a,i).toFixed(2)," ").concat(r.unitLabel);if(r.measureOnly)return o;var s=_b(e,r);return r.condensed?"".concat(o," | ").concat(s):"Distance ".concat(o,"</br>").concat(s)}function DA(e,t){t===void 0&&(t={});var r=I(I(I({},bp),{measureOnly:!1}),t),n=e.loci.map(function(f){return Ut.getCenter(f)}),a=n[0],i=n[1],o=n[2],s=S.sub(S(),a,i),u=S.sub(S(),o,i),c="".concat(ps(S.angle(s,u)).toFixed(2),"\xB0");if(r.measureOnly)return c;var l=_b(e,r);return r.condensed?"".concat(c," | ").concat(l):"Angle ".concat(c,"</br>").concat(l)}function MA(e,t){t===void 0&&(t={});var r=I(I(I({},bp),{measureOnly:!1}),t),n=e.loci.map(function(l){return Ut.getCenter(l)}),a=n[0],i=n[1],o=n[2],s=n[3],u="".concat(ps(S.dihedralAngle(a,i,o,s)).toFixed(2),"\xB0");if(r.measureOnly)return u;var c=_b(e,r);return r.condensed?"".concat(u," | ").concat(c):"Dihedral ".concat(u,"</br>").concat(c)}var N8={customText:P.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:P.Color(tr.black,{isEssential:!0}),textSize:P.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},wb=I(I(I({},Oo.Params),N8),{borderWidth:P.Numeric(.2,{min:0,max:.5,step:.01})}),U8={unitLabel:P.Text("\u212B",{isEssential:!0})},Bve=I(I(I({},Xr.Params),U8),{lineSizeAttenuation:P.Boolean(!0),linesColor:P.Color(tr.lightgreen,{isEssential:!0}),linesSize:P.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:P.Numeric(.2,{min:.01,max:.2,step:.01})}),Fve=I(I({},wb),U8),z8={lines:function(e,t){return Hn(Lve,Xr.Utils,{modifyState:function(r){return I(I({},r),{markerActions:$a.Highlighting})}})},text:function(e,t){return Hn(Uve,Oo.Utils,{modifyState:function(r){return I(I({},r),{markerActions:xt.None})}})}},V8=I(I(I({},Bve),Fve),{visuals:P.MultiSelect(["lines","text"],P.objectToOptions(z8))});function Ove(){return{sphereA:Te(),sphereB:Te(),center:S(),distance:0}}function G8(e,t){var r=t.sphereA,n=t.sphereB,a=t.center,i=e.loci,o=i[0],s=i[1];return Ut.getBoundingSphere(o,r),Ut.getBoundingSphere(s,n),S.add(a,r.center,n.center),S.scale(a,a,.5),t.distance=S.distance(r.center,n.center),t}var kl=Ove();function H8(e,t){return e.pairs.length===1?"Distance ".concat(IA(e.pairs[0],{unitLabel:t,measureOnly:!0})):"".concat(e.pairs.length," Distances")}function kve(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.pairs.length;a<i;++a)G8(e.pairs[a],kl),n.addFixedLengthDashes(kl.sphereA.center,kl.sphereB.center,t.dashLength,a);return n.getLines()}function Lve(e,t,r,n){var a=kve(t,r,n&&n.geometry),i=H8(t,r.unitLabel),o=function(s){return IA(t.pairs[s],r)};return fr.create(i,t,a,function(){return r.linesColor},function(){return r.linesSize},o)}function Nve(e,t,r){for(var n=gc.create(t,128,64,r),a=0,i=e.pairs.length;a<i;++a){G8(e.pairs[a],kl);var o=kl.center,s=kl.distance,u=kl.sphereA,c=kl.sphereB,l=t.customText||"".concat(s.toFixed(2)," ").concat(t.unitLabel),f=Math.max(2,u.radius,c.radius),d=f/2;n.add(l,o[0],o[1],o[2],1,d,a)}return n.getText()}function Uve(e,t,r,n){var a=Nve(t,r,n&&n.geometry),i=H8(t,r.unitLabel),o=function(s){return IA(t.pairs[s],r)};return fr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function zve(e,t){return Vt.createMulti("Distance",e,t,Vt.StateBuilder,z8)}function q8(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function j8(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function W8(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,a=e[3].loci;return{quads:[{loci:[t,r,n,a]}]}}function X8(e){var t=e[0].loci;return{infos:[{loci:t}]}}function Y8(e){return{locis:e.map(function(t){return t.loci})}}function K8(e){return{locis:e.map(function(t){return t.loci})}}var Vve=I(I({},wb),{offsetZ:P.Numeric(2,{min:0,max:10,step:.1})}),Q8={text:function(e,t){return Hn(jve,Oo.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})}},Z8=I(I({},Vve),{scaleByRadius:P.Boolean(!0),visuals:P.MultiSelect(["text"],P.objectToOptions(Q8))}),Gve=Te();function RA(e,t){return t===void 0&&(t=!1),e.label||xb(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function Hve(e){return e.infos.length===1?RA(e.infos[0]):"".concat(e.infos.length," Labels")}function qve(e,t,r){for(var n=gc.create(t,128,64,r),a=t.customText.trim(),i=0,o=e.infos.length;i<o;++i){var s=e.infos[i],u=Ut.getBoundingSphere(s.loci,Gve);if(!!u){var c=u.center,l=u.radius,f=a||RA(s,!0);n.add(f,c[0],c[1],c[2],t.scaleByRadius?l/.9:0,t.scaleByRadius?Math.max(1,l):1,i)}}return n.getText()}function jve(e,t,r,n){var a=qve(t,r,n&&n.geometry),i=Hve(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return RA(t.infos[u])};return fr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},s)}function Wve(e,t){return Vt.createMulti("Label",e,t,Vt.StateBuilder,Q8)}var gd=S(),Xve=se.identity(),yd=new Float32Array(6*3),Yve=new Uint8Array([0,1,2,3,4,5]);function Kve(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;S.add(gd,i,o),S.toArray(S.add(gd,i,o),yd,0),S.toArray(S.sub(gd,i,o),yd,3),S.toArray(S.add(gd,i,s),yd,6),S.toArray(S.sub(gd,i,s),yd,9),S.toArray(S.add(gd,i,u),yd,12),S.toArray(S.sub(gd,i,u),yd,15);var c=L_(yd,Yve),l=Xa.volume(t),f=Math.cbrt(l)/300*r;it.addCage(e,Xve,c,f,n,a)}S.zero();S.zero();var Ll=S(),Qve=S(),Zve=S(),$ve=S(),Jve=se.identity(),$8=new Float32Array(8*3),ehe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function the(e,t,r,n,a){var i=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,c=S.negate(Qve,o),l=S.negate(Zve,s),f=S.negate($ve,u),d=0,m=function(g,y,b){S.copy(Ll,i),S.add(Ll,Ll,g),S.add(Ll,Ll,y),S.add(Ll,Ll,b),S.toArray(Ll,$8,d),d+=3};m(o,s,u),m(o,s,f),m(o,l,f),m(o,l,u),m(c,l,f),m(c,l,u),m(c,s,u),m(c,s,f);var p=L_($8,ehe),v=Xa.volume(t),h=Math.cbrt(v)/300*r;it.addCage(e,Jve,p,h,n,a)}var rhe=se.identity(),J8=S();function nhe(e,t,r,n,a){return S.add(J8,t,r),se.targetTo(e,t,J8,n),se.setTranslation(e,t),se.scale(e,e,a)}function BA(e,t,r,n,a,i){it.addPrimitive(e,nhe(rhe,t,r,n,a),XF(i))}var FA={color:P.Color(tr.orange),scaleFactor:P.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:P.Numeric(2,{min:.1,max:10,step:.1})},ahe=I(I({},At.Params),FA),ihe=I(I({},At.Params),FA),ohe=I(I({},At.Params),FA),eN={axes:function(e,t){return Hn(che,At.Utils)},box:function(e,t){return Hn(dhe,At.Utils)},ellipsoid:function(e,t){return Hn(vhe,At.Utils)}},tN=I(I(I(I({},ahe),ihe),ohe),{visuals:P.MultiSelect(["box"],P.objectToOptions(eN))});function she(e){var t=Cb(e,{countsOnly:!0});return"Principal Axes of ".concat(t)}function uhe(e,t,r){var n=it.createState(256,128,r),a=_e.getPrincipalAxesMany(e.locis);return Xa.scale(a.momentsAxes,a.momentsAxes,t.scaleFactor),n.currentGroup=0,Kve(n,a.momentsAxes,t.radiusScale,2,20),it.getMesh(n)}function che(e,t,r,n){var a=uhe(t,r,n&&n.geometry),i=she(t.locis);return fr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function lhe(e){var t=Cb(e,{countsOnly:!0});return"Oriented Box of ".concat(t)}function fhe(e,t,r){var n=it.createState(256,128,r),a=_e.getPrincipalAxesMany(e.locis);return Xa.scale(a.boxAxes,a.boxAxes,t.scaleFactor),n.currentGroup=0,the(n,a.boxAxes,t.radiusScale,2,20),it.getMesh(n)}function dhe(e,t,r,n){var a=fhe(t,r,n&&n.geometry),i=lhe(t.locis);return fr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function mhe(e){var t=Cb(e,{countsOnly:!0});return"Oriented Ellipsoid of ".concat(t)}function phe(e,t,r){var n=it.createState(256,128,r),a=_e.getPrincipalAxesMany(e.locis),i=a.boxAxes,o=i.origin,s=i.dirA,u=i.dirB,c=Xa.size(S(),i);S.scale(c,c,.5*t.scaleFactor);var l=S.create(c[2],c[1],c[0]);return n.currentGroup=0,BA(n,o,s,u,l,2),it.getMesh(n)}function vhe(e,t,r,n){var a=phe(t,r,n&&n.geometry),i=mhe(t.locis);return fr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function hhe(e,t){var r=Vt.createMulti("Orientation",e,t,Vt.StateBuilder,eN);return r.setState({markerActions:$a.Highlighting}),r}var ghe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function rN(e){var t=I(I({},ghe),e),r=t.radius,n=t.segments,a=t.thetaStart,i=t.thetaLength,o=i===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),c=new Float32Array(s*3),l=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,c[0]=0,c[1]=1,c[2]=0;for(var f=0,d=3;f<n;++f,d+=3){var m=a+f/n*i;u[d]=r*Math.sin(m),u[d+1]=0,u[d+2]=r*Math.cos(m),c[d]=0,c[d+1]=1,c[d+2]=0}for(var f=1,d=0;f<n;++f,d+=3)l[d]=f,l[d+1]=f+1,l[d+2]=0;if(o){var p=(n-1)*3;l[p]=n,l[p+1]=1,l[p+2]=0}else{var m=a+i,d=(n+1)*3;u[d]=r*Math.sin(m),u[d+1]=0,u[d+2]=r*Math.cos(m),c[d]=0,c[d+1]=1,c[d+2]=0;var p=(n-1)*3;l[p]=n,l[p+1]=n+1,l[p+2]=0}return{vertices:u,normals:c,indices:l}}var nN={color:P.Color(tr.lightgreen),arcScale:P.Numeric(.7,{min:.01,max:1,step:.01})},aN=I(I(I({},Xr.Params),nN),{lineSizeAttenuation:P.Boolean(!0),linesSize:P.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:P.Numeric(.04,{min:.01,max:.2,step:.01})}),yhe=I({},aN),bhe=I({},aN),xhe=I(I(I({},At.Params),nN),{ignoreLight:P.Boolean(!0),sectorOpacity:P.Numeric(.75,{min:0,max:1,step:.01})}),iN={vectors:function(e,t){return Hn(_he,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},arc:function(e,t){return Hn(Ahe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},sector:function(e,t){return Hn(Phe,At.Utils,{modifyProps:function(r){return I(I({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return I(I({},r),{markerActions:$a.Highlighting})}})},text:function(e,t){return Hn(Ihe,Oo.Utils,{modifyState:function(r){return I(I({},r),{markerActions:xt.None})}})}},oN=I(I(I(I(I({},yhe),bhe),xhe),wb),{visuals:P.MultiSelect(["vectors","sector","text"],P.objectToOptions(iN))});function She(){return{sphereA:Te(),sphereB:Te(),sphereC:Te(),arcDirA:S(),arcDirC:S(),arcNormal:S(),radius:0,angle:0}}var Nl=S(),i0=se();function Ab(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,c=e.loci,l=c[0],f=c[1],d=c[2];Ut.getBoundingSphere(l,n),Ut.getBoundingSphere(f,a),Ut.getBoundingSphere(d,i),S.sub(o,n.center,a.center),S.sub(s,i.center,a.center),S.cross(u,o,s);var m=Math.min(S.magnitude(o),S.magnitude(s)),p=m*r;return t.radius=p,t.angle=S.angle(o,s),t}function sN(e,t){var r=e.radius,n=e.angle,a=t?$5(n,r)/t:32;se.targetTo(i0,e.sphereB.center,e.sphereA.center,e.arcNormal),se.setTranslation(i0,e.sphereB.center),se.mul(i0,i0,se.rotY180);var i=rN({radius:r,thetaLength:n,segments:a});return k_(i,i0)}var _a=She();function Tb(e){return e.triples.length===1?"Angle ".concat(DA(e.triples[0],{measureOnly:!0})):"".concat(e.triples.length," Angles")}function Che(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.triples.length;a<i;++a)Ab(e.triples[a],_a,t.arcScale),n.addFixedLengthDashes(_a.sphereB.center,_a.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(_a.sphereB.center,_a.sphereC.center,t.dashLength,a);return n.getLines()}function _he(e,t,r,n){var a=Che(t,r,n&&n.geometry),i=Tb(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function whe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.triples.length;a<i;++a){Ab(e.triples[a],_a,t.arcScale);for(var o=sN(_a,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var f=s[c]*3,d=s[c+1]*3,m=u[f],p=u[f+1],v=u[f+2],h=u[d],g=u[d+1],y=u[d+2];n.add(m,p,v,h,g,y,a)}}return n.getLines()}function Ahe(e,t,r,n){var a=whe(t,r,n&&n.geometry),i=Tb(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function The(e,t,r){for(var n=it.createState(128,64,r),a=0,i=e.triples.length;a<i;++a){Ab(e.triples[a],_a,t.arcScale);var o=sN(_a);n.currentGroup=a,it.addPrimitive(n,se.id,o),it.addPrimitiveFlipped(n,se.id,o)}return it.getMesh(n)}function Phe(e,t,r,n){var a=The(t,r,n&&n.geometry),i=Tb(t),o=function(s){return DA(t.triples[s])};return fr.create(i,t,a,function(){return r.color},function(){return 1},o)}function Ehe(e,t,r){for(var n=gc.create(t,128,64,r),a=0,i=e.triples.length;a<i;++a){Ab(e.triples[a],_a,t.arcScale),S.add(Nl,_a.arcDirA,_a.arcDirC),S.setMagnitude(Nl,Nl,_a.radius),S.add(Nl,_a.sphereB.center,Nl);var o=ps(_a.angle).toFixed(2),s=t.customText||"".concat(o,"\xB0"),u=Math.max(2,_a.sphereA.radius,_a.sphereB.radius,_a.sphereC.radius),c=u/2;n.add(s,Nl[0],Nl[1],Nl[2],.1,c,a)}return n.getText()}function Ihe(e,t,r,n){var a=Ehe(t,r,n&&n.geometry),i=Tb(t),o=function(s){return DA(t.triples[s])};return fr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function Dhe(e,t){return Vt.createMulti("Angle",e,t,Vt.StateBuilder,iN)}var uN={color:P.Color(tr.lightgreen),arcScale:P.Numeric(.7,{min:.01,max:1,step:.01})},Pb=I(I(I({},Xr.Params),uN),{lineSizeAttenuation:P.Boolean(!0),linesSize:P.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:P.Numeric(.04,{min:.01,max:.2,step:.01})}),Mhe=I({},Pb),Rhe=I({},Pb),Bhe=I({},Pb),Fhe=I({},Pb),Ohe=I(I(I({},At.Params),uN),{ignoreLight:P.Boolean(!0),sectorOpacity:P.Numeric(.75,{min:0,max:1,step:.01})}),cN={vectors:function(e,t){return Hn(Nhe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},extenders:function(e,t){return Hn(qhe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},connector:function(e,t){return Hn(zhe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},arms:function(e,t){return Hn(Ghe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},arc:function(e,t){return Hn(Whe,Xr.Utils,{modifyState:function(r){return I(I({},r),{pickable:!1})}})},sector:function(e,t){return Hn(Yhe,At.Utils,{modifyProps:function(r){return I(I({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return I(I({},r),{markerActions:$a.Highlighting})}})},text:function(e,t){return Hn(Qhe,Oo.Utils,{modifyState:function(r){return I(I({},r),{markerActions:xt.None})}})}},lN=I(I(I(I(I(I(I({},Mhe),Rhe),Bhe),Fhe),Ohe),wb),{visuals:P.MultiSelect(["extenders","arms","sector","text"],P.objectToOptions(cN))});function khe(){return{sphereA:Te(),sphereB:Te(),sphereC:Te(),sphereD:Te(),dirBA:S(),dirCD:S(),projA:S(),projD:S(),arcPointA:S(),arcPointD:S(),arcDirA:S(),arcDirD:S(),arcCenter:S(),arcNormal:S(),radius:0,angle:0}}var ei=S(),o0=se();function bd(e,t,r){var n=t.sphereA,a=t.sphereB,i=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,c=t.projA,l=t.projD,f=t.arcPointA,d=t.arcPointD,m=t.arcDirA,p=t.arcDirD,v=t.arcCenter,h=t.arcNormal,g=e.loci,y=g[0],b=g[1],x=g[2],C=g[3];Ut.getBoundingSphere(y,n),Ut.getBoundingSphere(b,a),Ut.getBoundingSphere(x,i),Ut.getBoundingSphere(C,o),S.add(v,a.center,i.center),S.scale(v,v,.5),S.sub(s,n.center,a.center),S.sub(u,o.center,i.center),S.add(f,v,s),S.add(d,v,u),S.sub(h,i.center,a.center),S.orthogonalize(m,h,s),S.orthogonalize(p,h,u),S.projectPointOnVector(c,f,m,v),S.projectPointOnVector(l,d,p,v);var _=Math.min(S.distance(c,v),S.distance(l,v)),w=_*r;S.setMagnitude(m,m,w),S.setMagnitude(p,p,w),S.add(f,v,m),S.add(d,v,p),t.radius=w,t.angle=S.dihedralAngle(n.center,a.center,i.center,o.center),S.matchDirection(ei,h,S.sub(ei,f,n.center));var T=S.angle(s,ei),A=w/Math.cos(T-nh);S.add(c,a.center,S.setMagnitude(ei,s,A)),S.matchDirection(ei,h,S.sub(ei,d,o.center));var D=S.angle(u,ei),E=w/Math.cos(D-nh);return S.add(l,i.center,S.setMagnitude(ei,u,E)),t}function fN(e,t){var r=e.radius,n=e.angle,a=t?$5(n,r)/t:32;se.targetTo(o0,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),se.setTranslation(o0,e.arcCenter),se.mul(o0,o0,se.rotY180);var i=rN({radius:r,thetaLength:Math.abs(n),segments:a});return k_(i,o0)}var Lr=khe();function xd(e){return e.quads.length===1?"Dihedral ".concat(MA(e.quads[0],{measureOnly:!0})):"".concat(e.quads.length," Dihedrals")}function Lhe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)bd(e.quads[a],Lr,t.arcScale),n.addFixedLengthDashes(Lr.arcCenter,Lr.arcPointA,t.dashLength,a),n.addFixedLengthDashes(Lr.arcCenter,Lr.arcPointD,t.dashLength,a);return n.getLines()}function Nhe(e,t,r,n){var a=Lhe(t,r,n&&n.geometry),i=xd(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Uhe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)bd(e.quads[a],Lr,t.arcScale),n.addFixedLengthDashes(Lr.sphereB.center,Lr.sphereC.center,t.dashLength,a);return n.getLines()}function zhe(e,t,r,n){var a=Uhe(t,r,n&&n.geometry),i=xd(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Vhe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)bd(e.quads[a],Lr,t.arcScale),n.addFixedLengthDashes(Lr.sphereB.center,Lr.sphereA.center,t.dashLength,a),n.addFixedLengthDashes(Lr.sphereC.center,Lr.sphereD.center,t.dashLength,a);return n.getLines()}function Ghe(e,t,r,n){var a=Vhe(t,r,n&&n.geometry),i=xd(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Hhe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.quads.length;a<i;++a)bd(e.quads[a],Lr,t.arcScale),n.addFixedLengthDashes(Lr.arcPointA,Lr.projA,t.dashLength,a),n.addFixedLengthDashes(Lr.arcPointD,Lr.projD,t.dashLength,a);return n.getLines()}function qhe(e,t,r,n){var a=Hhe(t,r,n&&n.geometry),i=xd(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function jhe(e,t,r){for(var n=Bi.create(128,64,r),a=0,i=e.quads.length;a<i;++a){bd(e.quads[a],Lr,t.arcScale);for(var o=fN(Lr,t.dashLength),s=o.indices,u=o.vertices,c=0,l=s.length;c<l;c+=3)if(c%2!=1){var f=s[c]*3,d=s[c+1]*3,m=u[f],p=u[f+1],v=u[f+2],h=u[d],g=u[d+1],y=u[d+2];n.add(m,p,v,h,g,y,a)}}return n.getLines()}function Whe(e,t,r,n){var a=jhe(t,r,n&&n.geometry),i=xd(t);return fr.create(i,t,a,function(){return r.color},function(){return r.linesSize},function(){return""})}function Xhe(e,t,r){for(var n=it.createState(128,64,r),a=0,i=e.quads.length;a<i;++a){bd(e.quads[a],Lr,t.arcScale);var o=fN(Lr);n.currentGroup=a,it.addPrimitive(n,se.id,o),it.addPrimitiveFlipped(n,se.id,o)}return it.getMesh(n)}function Yhe(e,t,r,n){var a=Xhe(t,r,n&&n.geometry),i=xd(t),o=function(s){return MA(t.quads[s])};return fr.create(i,t,a,function(){return r.color},function(){return 1},o)}function Khe(e,t,r){for(var n=gc.create(t,128,64,r),a=0,i=e.quads.length;a<i;++a){bd(e.quads[a],Lr,t.arcScale),S.add(ei,Lr.arcDirA,Lr.arcDirD),S.setMagnitude(ei,ei,Lr.radius),S.add(ei,Lr.arcCenter,ei);var o=ps(Lr.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||"".concat(o,"\xB0"),u=Math.max(2,Lr.sphereA.radius,Lr.sphereB.radius,Lr.sphereC.radius,Lr.sphereD.radius),c=u/2;n.add(s,ei[0],ei[1],ei[2],.1,c,a)}return n.getText()}function Qhe(e,t,r,n){var a=Khe(t,r,n&&n.geometry),i=xd(t),o=function(s){return MA(t.quads[s])};return fr.create(i,t,a,function(){return r.textColor},function(){return r.textSize},o)}function Zhe(e,t){return Vt.createMulti("Dihedral",e,t,Vt.StateBuilder,cN)}var $he=bt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:fe.Root,to:fe.Shape.Provider,params:{bottomLeft:P.Vec3(S()),topRight:P.Vec3(S.create(1,1,1)),radius:P.Numeric(.15,{min:.01,max:4,step:.01}),color:P.Color(tr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return Be.create("Shape Representation",function(n){return ie(t,void 0,void 0,function(){return ae(this,function(a){return[2,new fe.Shape.Provider({label:"Box",data:r,params:At.Params,getShape:function(i,o){var s=OA(Bt.create(r.bottomLeft,r.topRight),r.radius);return fr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:At.Utils},{label:"Box"})]})})})}});function OA(e,t,r){var n=S.sub(S(),e.max,e.min),a=se.fromTranslation(se(),S.create(.5,.5,.5)),i=se.fromScaling(se(),n),o=se.fromTranslation(se(),e.min),s=se.mul3(se(),o,i,a),u=it.createState(256,128,r);u.currentGroup=1,it.addCage(u,s,RF(),t,2,20);var c=it.getMesh(u),l=S.scaleAndAdd(S(),e.min,n,.5),f=S.distance(e.min,l);return c.setBoundingSphere(Te.create(l,f)),c}var Jhe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",BoxShape3D:$he,getBoxMesh:OA}),dN={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};dN.vertices,new Uint32Array([0,1,2,3,3,1,2,0]);function e0e(){return dN}var t0e=I(I({},At.Params),{color:P.Color(tr.orange),scaleFactor:P.Numeric(1,{min:.1,max:10,step:.1})}),mN={plane:function(e,t){return Hn(a0e,At.Utils)}},pN=I(I({},t0e),{visuals:P.MultiSelect(["plane"],P.objectToOptions(mN))});function r0e(e){var t=Cb(e,{countsOnly:!0});return"Best Fit Plane of ".concat(t)}var Ul=se(),kA=S();function n0e(e,t,r){var n=it.createState(256,128,r),a=_e.getPrincipalAxesMany(e.locis),i=a.boxAxes,o=e0e();return S.add(kA,i.origin,i.dirC),se.targetTo(Ul,kA,i.origin,i.dirB),se.scale(Ul,Ul,Xa.size(kA,i)),se.scaleUniformly(Ul,Ul,t.scaleFactor),se.setTranslation(Ul,i.origin),n.currentGroup=0,it.addPrimitive(n,Ul,o),it.addPrimitiveFlipped(n,Ul,o),it.getMesh(n)}function a0e(e,t,r,n){var a=n0e(t,r,n&&n.geometry),i=r0e(t.locis);return fr.create(i,t,a,function(){return r.color},function(){return 1},function(){return i})}function i0e(e,t){var r=Vt.createMulti("Plane",e,t,Vt.StateBuilder,mN);return r.setState({markerActions:$a.Highlighting}),r}var Eb=bt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:fe.Molecule.Structure,to:fe.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e){var o={help:function(c){var l=c.name,f=c.params,d=a.colorThemeRegistry.get(l),m=d.factory({},f);return{description:m.description,legend:m.legend}}};return{type:P.Mapped(n.default.name,n.types,function(c){return P.Group(n.get(c).getParams(a,ke.Empty))}),colorTheme:P.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(c){return P.Group(a.colorThemeRegistry.get(c).getParams({structure:ke.Empty}))},o),sizeTheme:P.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(c){return P.Group(a.sizeThemeRegistry.get(c).getParams({structure:ke.Empty}))})}}var s={structure:e.data},u={help:function(c){var l=c.name,f=c.params,d=a.colorThemeRegistry.get(l),m=d.factory(s,f);return{description:m.description,legend:m.legend}}};return{type:P.Mapped(n.default.name,n.getApplicableTypes(e.data),function(c){return P.Group(n.get(c).getParams(a,e.data))}),colorTheme:P.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(s),function(c){return P.Group(a.colorThemeRegistry.get(c).getParams(s))},u),sizeTheme:P.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(s),function(c){return P.Group(a.sizeThemeRegistry.get(c).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,a=e.params;return e.cache,Be.create("Structure Representation",function(i){return ie(r,void 0,void 0,function(){var o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.structure.registry.get(a.type.name),u=((f=s.getData)===null||f===void 0?void 0:f.call(s,n.data,a.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:m.sent(),m.label=2;case 2:return c=s.factory(I({webgl:(d=t.canvas3d)===null||d===void 0?void 0:d.webgl},t.representation.structure.themes),s.getParams),[4,kn.ensureDependencies(o,t.representation.structure.themes,{structure:u},a)];case 3:return m.sent(),c.setTheme(kn.create(t.representation.structure.themes,{structure:u},a)),l=a.type.params||{},[4,c.createOrUpdate(l,u).runInContext(i)];case 4:return m.sent(),[2,new fe.Molecule.Structure.Representation3D({repr:c,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return e.cache,Be.create("Structure Representation",function(s){return ie(r,void 0,void 0,function(){var u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return o.type.name!==i.type.name?[2,Ge.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),((d=u.mustRecreate)===null||d===void 0?void 0:d.call(u,i.type.params,o.type.params))?[2,Ge.UpdateResult.Recreate]:(c=((m=u.getData)===null||m===void 0?void 0:m.call(u,n.data,o.type.params))||n.data,l={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(l,c)]:[3,2]));case 1:p.sent(),p.label=2;case 2:return kn.releaseDependencies(t.representation.structure.themes,{structure:a.data.sourceData},i),[4,kn.ensureDependencies(l,t.representation.structure.themes,{structure:c},o)];case 3:return p.sent(),a.data.repr.setTheme(kn.create(t.representation.structure.themes,{structure:c},o)),f=I(I({},a.data.repr.props),o.type.params),[4,a.data.repr.createOrUpdate(f,c).runInContext(s)];case 4:return p.sent(),a.data.sourceData=n.data,[2,Ge.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var a=r.data.sourceData,i=t.representation.structure.registry.get(n.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(a),kn.releaseDependencies(t.representation.structure.themes,{structure:a},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,a=t.colorTheme.params.value,i=st.interpolate(n,a,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),o0e=bt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:P.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new gp(n);return T8(n,a,r.t),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new gp(n)},info:n,repr:t.data.repr},{label:"Unwind T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;if(a.t===n.t)return Ge.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return T8(i,o,n.t),r.label="Unwind T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,Ge.UpdateResult.Updated}}),s0e=bt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:P.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new gp(n);return E8(n,a,r.t,n.root.boundary.sphere),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new gp(n)},info:n,repr:t.data.repr},{label:"Explode T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;if(a.t===n.t)return Ge.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return E8(i,o,n.t,i.root.boundary.sphere),r.label="Explode T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,Ge.UpdateResult.Updated}}),u0e=bt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:I({t:P.Numeric(0,{min:0,max:1,step:.01})},yve)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=new gp(n),i=I8(n.root,r),o=i.axis,s=i.origin;return R8(n,a,r.t,o,s),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:a},initialState:{unitTransforms:new gp(n)},info:n,repr:t.data.repr},{label:"Spin T = ".concat(r.t.toFixed(2))})},update:function(e){var t=e.a,r=e.b,n=e.newParams,a=e.oldParams,i=t.data.sourceData;if(r.data.info!==i||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;if(a.t===n.t&&a.axis===n.axis&&a.origin===n.origin)return Ge.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=I8(i.root,n),u=s.axis,c=s.origin;return R8(i,o,n.t,u,c),r.label="Spin T = ".concat(n.t.toFixed(2)),r.data.repr=t.data.repr,Ge.UpdateResult.Updated}}),c0e=bt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({script:P.Script(Gn("(sel.atom.all)","mol-script")),color:P.Color(tr.blueviolet),clear:P.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":st.toRgbString(e.color))},{defaultValue:[{script:Gn("(sel.atom.all)","mol-script"),color:tr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=ba.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:ba.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.overpaint,u=ba.ofScript(n.layers,i);return ba.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.overpaint=u,r.data.repr=t.data.repr,r.label="Overpaint (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),l0e=bt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({bundle:P.Value(Cr.Empty),color:P.Color(tr.blueviolet),clear:P.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":st.toRgbString(e.color))},{defaultValue:[{bundle:Cr.Empty,color:tr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=ba.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:ba.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Overpaint (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.overpaint,u=ba.ofBundle(n.layers,i);return ba.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.overpaint=u,r.data.repr=t.data.repr,r.label="Overpaint (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),f0e=bt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({script:P.Script(Gn("(sel.atom.all)","mol-script")),value:P.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{script:Gn("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=xa.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:xa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.transparency,u=xa.ofScript(n.layers,i);return xa.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.transparency=u,r.data.repr=t.data.repr,r.label="Transparency (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),d0e=bt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({bundle:P.Value(Cr.Empty),value:P.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency (".concat(e.value,")")},{defaultValue:[{bundle:Cr.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=xa.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:xa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Transparency (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.transparency,u=xa.ofBundle(n.layers,i);return xa.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.transparency=u,r.data.repr=t.data.repr,r.label="Transparency (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),m0e=bt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({script:P.Script(Gn("(sel.atom.all)","mol-script")),material:Ya.getParam(),clear:P.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":Ya.toString(e.material))},{defaultValue:[{script:Gn("(sel.atom.all)","mol-script"),material:Ya({roughness:1}),clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Sa.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Sa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.substance,u=Sa.ofScript(n.layers,i);return Sa.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.substance=u,r.data.repr=t.data.repr,r.label="Substance (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),p0e=bt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({bundle:P.Value(Cr.Empty),material:Ya.getParam(),clear:P.Boolean(!1)},function(e){return"".concat(e.clear?"Clear":Ya.toString(e.material))},{defaultValue:[{bundle:Cr.Empty,material:Ya({roughness:1}),clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=t.data.repr.geometryVersion,i=Sa.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Sa.Empty},info:{structure:n,geometryVersion:a},repr:t.data.repr},{label:"Substance (".concat(i.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info,i=t.data.sourceData;if(i!==a.structure||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var o=t.data.repr.geometryVersion;if(o!==a.geometryVersion&&qu(t.data.repr.props))return Ge.UpdateResult.Unchanged;var s=r.data.state.substance,u=Sa.ofBundle(n.layers,i);return Sa.areEqual(s,u)?Ge.UpdateResult.Unchanged:(a.geometryVersion=o,r.data.state.substance=u,r.data.repr=t.data.repr,r.label="Substance (".concat(u.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),v0e=bt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({script:P.Script(Gn("(sel.atom.all)","mol-script")),groups:P.Converted(function(e){return Yr.Groups.toNames(e)},function(e){return Yr.Groups.fromNames(e)},P.MultiSelect(sb(Yr.Groups.Names),P.objectToOptions(Yr.Groups.Names)))},function(e){return"".concat(Yr.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{script:Gn("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=Yr.ofScript(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Yr.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var i=r.data.state.clipping,o=Yr.ofScript(n.layers,a);return Yr.areEqual(i,o)?Ge.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping (".concat(o.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),h0e=bt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:function(){return{layers:P.ObjectList({bundle:P.Value(Cr.Empty),groups:P.Converted(function(e){return Yr.Groups.toNames(e)},function(e){return Yr.Groups.fromNames(e)},P.MultiSelect(sb(Yr.Groups.Names),P.objectToOptions(Yr.Groups.Names)))},function(e){return"".concat(Yr.Groups.toNames(e.groups).length," group(s)")},{defaultValue:[{bundle:Cr.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,a=Yr.ofBundle(r.layers,n);return new fe.Molecule.Structure.Representation3DState({state:{clipping:a},initialState:{clipping:Yr.Empty},info:n,repr:t.data.repr},{label:"Clipping (".concat(a.layers.length," Layers)")})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return Ge.UpdateResult.Recreate;var i=r.data.state.clipping,o=Yr.ofBundle(n.layers,a);return Yr.areEqual(i,o)?Ge.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping (".concat(o.layers.length," Layers)"),Ge.UpdateResult.Updated)}}),bc;(function(e){function t(a,i,o,s){var u=a.representation.volume.registry.get(i),c={volume:o},l=a.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(c),f=a.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(c),d=P.getDefaultValues(u.getParams(a.representation.volume.themes,o));return{type:{name:i,params:s?I(I({},d),s):d},colorTheme:{name:u.defaultColorTheme.name,params:P.getDefaultValues(l)},sizeTheme:{name:u.defaultSizeTheme.name,params:P.getDefaultValues(f)}}}e.getDefaultParams=t;function r(a,i,o,s,u,c,l){var f=a.representation.volume.registry.get(i),d=a.representation.volume.themes.colorThemeRegistry.get(s||f.defaultColorTheme.name),m=a.representation.volume.themes.sizeThemeRegistry.get(c||f.defaultSizeTheme.name);return{type:{name:i,params:o?I(I({},f.defaultValues),o):f.defaultValues},colorTheme:{name:f.defaultColorTheme.name,params:u?I(I({},d.defaultValues),u):d.defaultValues},sizeTheme:{name:f.defaultSizeTheme.name,params:l?I(I({},m.defaultValues),l):m.defaultValues}}}e.getDefaultParamsStatic=r;function n(a){var i,o,s,u;if(a.isoValue)return vt.IsoValue.toString(a.isoValue);if((o=(i=a.renderMode)===null||i===void 0?void 0:i.params)===null||o===void 0?void 0:o.isoValue)return vt.IsoValue.toString((u=(s=a.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(bc||(bc={}));var g0e=bt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:fe.Volume.Data,to:fe.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,a=r.themes,i=n.get(n.default.name);if(!e)return{type:P.Mapped(n.default.name,n.types,function(s){return P.Group(n.get(s).getParams(a,vt.One))}),colorTheme:P.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.types,function(s){return P.Group(a.colorThemeRegistry.get(s).getParams({volume:vt.One}))}),sizeTheme:P.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.types,function(s){return P.Group(a.sizeThemeRegistry.get(s).getParams({volume:vt.One}))})};var o={volume:e.data};return{type:P.Mapped(n.default.name,n.types,function(s){return P.Group(n.get(s).getParams(a,e.data))}),colorTheme:P.Mapped(i.defaultColorTheme.name,a.colorThemeRegistry.getApplicableTypes(o),function(s){return P.Group(a.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:P.Mapped(i.defaultSizeTheme.name,a.sizeThemeRegistry.getApplicableTypes(o),function(s){return P.Group(a.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Volume Representation",function(i){return ie(r,void 0,void 0,function(){var o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return o={runtime:i,assetManager:t.managers.asset},s=t.representation.volume.registry.get(a.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:f.sent(),f.label=2;case 2:return u=s.factory(I({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.volume.themes),s.getParams),u.setTheme(kn.create(t.representation.volume.themes,{volume:n.data},a)),c=a.type.params||{},[4,u.createOrUpdate(c,n.data).runInContext(i)];case 3:return f.sent(),[2,new fe.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:bc.getDescription(c)})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b,i=e.oldParams,o=e.newParams;return Be.create("Volume Representation",function(s){return ie(r,void 0,void 0,function(){var u,c,l;return ae(this,function(f){switch(f.label){case 0:return o.type.name!==i.type.name?(u=t.representation.volume.registry.get(i.type.name),(l=u.ensureCustomProperties)===null||l===void 0||l.detach(n.data),[2,Ge.UpdateResult.Recreate]):(c=I(I({},a.data.repr.props),o.type.params),a.data.repr.setTheme(kn.create(t.representation.volume.themes,{volume:n.data},o)),[4,a.data.repr.createOrUpdate(c,n.data).runInContext(s)]);case 1:return f.sent(),a.data.sourceData=n.data,a.description=bc.getDescription(c),[2,Ge.UpdateResult.Updated]}})})})}}),y0e=bt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:fe.Shape.Provider,to:fe.Shape.Representation3D,params:function(e,t){return e?e.data.params:Je.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Shape Representation",function(i){return ie(r,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return o=I(I({},P.getDefaultValues(n.data.params)),a),s=Hn(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(i)];case 1:return u.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Shape Representation",function(o){return ie(r,void 0,void 0,function(){var s;return ae(this,function(u){switch(u.label){case 0:return s=I(I({},a.data.repr.props),i),[4,a.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),a.data.sourceData=n.data,[2,Ge.UpdateResult.Updated]}})})})}}),b0e=bt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:fe.Molecule.Model,to:fe.Shape.Representation3D,params:function(){return I({},F8)}})({isApplicable:function(e){return!!_n.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Model Unit Cell",function(i){return ie(r,void 0,void 0,function(){var o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return o=_n.Provider.get(n.data),o?(s=O8(n.data,o,a),u=Pve(I({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.structure.themes),function(){return F8}),[4,u.createOrUpdate(a,s).runInContext(i)]):[2,rn.Null];case 1:return l.sent(),[2,new fe.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,a=e.newParams;return Be.create("Model Unit Cell",function(i){return ie(t,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=_n.Provider.get(r.data),o?(s=I(I({},n.data.repr.props),a),u=O8(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(i)]):[2,Ge.UpdateResult.Null];case 1:return c.sent(),n.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),x0e=bt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:fe.Molecule.Structure,to:fe.Shape.Representation3D,params:I({radius:P.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:P.Color(tr.red,{isEssential:!0})},At.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Bounding Box",function(i){return ie(r,void 0,void 0,function(){var o;return ae(this,function(s){switch(s.label){case 0:return o=Hn(function(u,c,l,f){var d=OA(c.box,c.radius,f==null?void 0:f.geometry);return fr.create("Bouding Box",c,d,function(){return c.color},function(){return 1},function(){return"Bounding Box"})},At.Utils),[4,o.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(i)];case 1:return s.sent(),[2,new fe.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Bounding Box",function(o){return ie(r,void 0,void 0,function(){return ae(this,function(s){switch(s.label){case 0:return[4,a.data.repr.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(o)];case 1:return s.sent(),a.data.sourceData=n.data,[2,Ge.UpdateResult.Updated]}})})})}}),S0e=bt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},V8)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Distance",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=q8(n.data),s=zve(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return V8}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Distance",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=q8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),C0e=bt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},oN)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Angle",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=j8(n.data),s=Dhe(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return oN}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Angle",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=j8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),_0e=bt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},lN)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Dihedral",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=W8(n.data),s=Zhe(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return lN}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Dihedral",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=W8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),w0e=bt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},Z8)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Label",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=X8(n.data),s=Wve(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Z8}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Label",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=X8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),A0e=bt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},tN)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Orientation",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=Y8(n.data),s=hhe(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return tN}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Orientation",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=Y8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),T0e=bt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:function(){return I({},pN)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,a=e.params;return Be.create("Structure Plane",function(i){return ie(r,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return o=K8(n.data),s=i0e(I({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return pN}),[4,s.createOrUpdate(a,o).runInContext(i)];case 1:return c.sent(),[2,new fe.Shape.Representation3D({repr:s,sourceData:o},{label:"Plane"})]}})})})},update:function(e,t){var r=this,n=e.a,a=e.b;e.oldParams;var i=e.newParams;return Be.create("Structure Plane",function(o){return ie(r,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return s=I(I({},a.data.repr.props),i),u=K8(n.data),[4,a.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return c.sent(),a.data.sourceData=u,[2,Ge.UpdateResult.Updated]}})})})}}),P0e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",StructureRepresentation3D:Eb,ExplodeStructureRepresentation3D:s0e,SpinStructureRepresentation3D:u0e,UnwindStructureAssemblyRepresentation3D:o0e,OverpaintStructureRepresentation3DFromScript:c0e,OverpaintStructureRepresentation3DFromBundle:l0e,TransparencyStructureRepresentation3DFromScript:f0e,TransparencyStructureRepresentation3DFromBundle:d0e,SubstanceStructureRepresentation3DFromScript:m0e,SubstanceStructureRepresentation3DFromBundle:p0e,ClippingStructureRepresentation3DFromScript:v0e,ClippingStructureRepresentation3DFromBundle:h0e,VolumeRepresentation3D:g0e,get VolumeRepresentation3DHelpers(){return bc},ShapeRepresentation3D:y0e,ModelUnitcell3D:b0e,StructureBoundingBox3D:x0e,StructureSelectionsDistance3D:S0e,StructureSelectionsAngle3D:C0e,StructureSelectionsDihedral3D:_0e,StructureSelectionsLabel3D:w0e,StructureSelectionsOrientation3D:A0e,StructureSelectionsPlane3D:T0e}),ze={Data:IQ,Misc:MQ,Model:Bde,Volume:jde,Representation:P0e,Shape:Jhe};function Zr(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=zr.create22(),e}var E0e=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,a=this.subs.get(t.id);return a||(a=[],this.subs.set(t.id,a)),a.push(r),{unsubscribe:function(){var i=n.subs.get(t.id);if(!!i){var o=i.indexOf(r);if(!(o<0)){for(var s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(a,i){if(n.disposing){i("disposed");return}var o=n.subs.get(t.id);if(!o){a();return}n.resolve({cmd:t,params:r,resolve:a,reject:i})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ie(this,void 0,void 0,function(){var r,n,a,i,o;return ae(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,a=r,s.label=2;case 2:return n<a.length?(i=a[n],[4,i(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),Xt={State:{SetCurrentObject:Zr(),ApplyAction:Zr(),Update:Zr(),RemoveObject:Zr(),ToggleExpanded:Zr(),ToggleVisibility:Zr(),Snapshots:{Add:Zr(),Replace:Zr(),Move:Zr(),Remove:Zr(),Apply:Zr(),Clear:Zr(),Upload:Zr(),Fetch:Zr(),DownloadToFile:Zr(),OpenFile:Zr(),OpenUrl:Zr()}},Interactivity:{Object:{Highlight:Zr()},Structure:{Highlight:Zr(),Select:Zr()},ClearHighlights:Zr()},Layout:{Update:Zr()},Toast:{Show:Zr(),Hide:Zr()},Camera:{Reset:Zr(),SetSnapshot:Zr(),Focus:Zr()},Canvas3D:{SetSettings:Zr(),ResetSettings:Zr()}},I0e=Pu.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(Yt.Generators.rootsOfType(fe.Molecule.Structure)),n=0,a=r;n<a.length;n++){var i=a[n];t.push([i.transform.ref,i.obj.data.models[0].label])}return{durationInMs:P.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:P.Boolean(!1),target:P.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=gr.RootRef,n=t.select(Yt.Generators.ofType(fe.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,a=!e.target||e.target==="all"?gr.RootRef:e.target,i=n.select(Yt.Generators.ofType(fe.Molecule.Structure.Representation3D,a)),o=n.build(),s=!1,u=0,c=i;u<c.length;u++){var l=c[u],f=n.select(Yt.Generators.ofTransformer(ze.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref));f.length>0||(s=!0,o.to(l).apply(ze.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(!!s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,a=n.select(Yt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:if(n=r.plugin.state.data,a=!r.params.target||r.params.target==="all"?gr.RootRef:r.params.target,i=n.select(Yt.Generators.ofTransformer(ze.Representation.UnwindStructureAssemblyRepresentation3D,a)),i.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,c=!1,r.params.playOnce&&u>=1?(c=!0,u=1):u=u%1,l=0,f=i;l<f.length;l++)d=f[l],o.to(d).update({t:u});return[4,Xt.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return m.sent(),c?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),Ib=S(),vN=S(),hN=Gr(),D0e=Pu.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:P.Numeric(4e3,{min:100,max:2e4,step:100}),speed:P.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:P.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ie(this,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):Ra(t.current/r.params.durationInMs,0,1),s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),S.sub(Ib,i.position,i.target),S.normalize(vN,i.up),Gr.setAxisAngle(hN,vN,s),S.transformQuat(Ib,Ib,hN),u=S.add(S(),i.target,Ib),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:I(I({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}]))})})}}),M0e=Pu.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:P.MappedStatic("loop",{palindrome:P.Group({}),loop:P.Group({direction:P.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:P.Group({direction:P.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:P.MappedStatic("fixed",{fixed:P.Group({durationInS:P.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:P.Group({targetFps:P.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:P.Group({maxFps:P.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(Yt.Generators.ofTransformer(ze.Model.ModelFromTrajectory)),n=0,a=r;n<a.length;n++){var i=a[n],o=Yt.findAncestorOfType(t.tree,t.cells,i.transform.ref,fe.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,a=n.select(Yt.Generators.ofTransformer(ze.Model.ModelFromTrajectory)),i=0,o=0,s=a;o<s.length;o++){var u=s[o],c=Yt.findAncestorOfType(n.tree,n.cells,u.transform.ref,fe.Molecule.Trajectory);if(!(!c||!c.obj)){var l=c.obj;i=Math.max(Math.ceil(1e3*l.data.frameCount/e.duration.params.targetFps),i)}}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,a=n.select(Yt.Generators.ofTransformer(ze.Model.ModelFromTrajectory)),a.length===0)return[2,{kind:"finished"}];for(i=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,c=!0,l=function(v){var h=Yt.findAncestorOfType(n.tree,n.cells,v.transform.ref,fe.Molecule.Trajectory);if(!h||!h.obj)return"continue";var g=h.obj;if(g.data.frameCount<=1)return"continue";i.to(v).update(function(y){var b=g.data.frameCount;if(b!==1)c=!1;else return y;if(o.duration.name==="sequential"){var x=1;if(o.mode.name==="once"){if(x=o.mode.params.direction==="backward"?-1:1,x===-1&&y.modelIndex===0||x===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?x=1:y.modelIndex===b-1?x=-1:x=s[v.transform.ref]||1);s[v.transform.ref]=x;var C=(y.modelIndex+x)%b;return C<0&&(C+=b),u=u||x===-1&&C===0||x===1&&C===b-1,{modelIndex:C}}else{var _=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),w=t.current%_/_;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var C=Math.min(Math.floor(g.data.frameCount*w),g.data.frameCount-1);return u=u||C===g.data.frameCount-1,{modelIndex:C}}})},f=0,d=a;f<d.length;f++)m=d[f],l(m);return c?[3,2]:[4,Xt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}})];case 1:p.sent(),p.label=2;case 2:return c||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function gN(e,t,r){var n;return r===void 0&&(r=!1),ie(this,void 0,void 0,function(){return ae(this,function(a){switch(a.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:a.sent(),a.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var R0e=Pu.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r==null?void 0:r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);gN(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var a;return r+((a=n.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,a){var i;return n+((i=a.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ie(this,void 0,void 0,function(){var a,i,o,s,u;return ae(this,function(c){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(a=0,i=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],a+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<a));o++)i++;return i>=e.snapshots.length?[2,{kind:"finished"}]:i===e.currentIndex?[2,{kind:"skip"}]:(gN(r.plugin,e.snapshots[i]),[2,{kind:"next",state:I(I({},e),{currentIndex:i})}])})})}}),xr;(function(e){var t=function(l){_t(f,l);function f(){return l!==null&&l.apply(this,arguments)||this}return f}(fe.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(l){_t(f,l);function f(){return l!==null&&l.apply(this,arguments)||this}return f}(fe.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(l){_t(f,l);function f(){return l!==null&&l.apply(this,arguments)||this}return f}(fe.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=bt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:P.Text("",{isHidden:!0})}})({apply:function(l){var f=l.params;return new r({},{label:f.label})}});var a=new Map;function i(l){return a.get(l.id)}e.getCategoryId=i;function o(l){var f=bt.CreateBuiltIn({name:l.name,display:l.display,from:[t],to:[n],params:l.params,apply:function(d,m){var p=d.params,v=l.label?l.label(p):{label:l.display.name,description:l.display.description};return new n(new l.ctor(m,p),v)},update:function(d){var m=this,p=d.b,v=d.newParams;return Be.create("Update Behavior",function(){return ie(m,void 0,void 0,function(){var h;return ae(this,function(g){switch(g.label){case 0:return p.data.update?[4,p.data.update(v)]:[2,Ge.UpdateResult.Unchanged];case 1:return h=g.sent(),[2,h?Ge.UpdateResult.Updated:Ge.UpdateResult.Unchanged]}})})})},canAutoUpdate:l.canAutoUpdate});return a.set(f.id,l.category),f}e.create=o;function s(l,f){return function(){function d(m){this.ctx=m,this.sub=void 0}return d.prototype.register=function(){var m=this;this.sub=l.subscribe(this.ctx,function(p){return f(p,m.ctx)})},d.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},d}()}e.simpleCommandHandler=s;var u=function(){function l(f,d){this.ctx=f,this.params=d,this.subs=[]}return l.prototype.subscribeCommand=function(f,d){this.subs.push(f.subscribe(this.ctx,d))},l.prototype.subscribeObservable=function(f,d){this.subs.push(f.subscribe(d))},l.prototype.track=function(f){this.subs.push(f)},l.prototype.unregister=function(){for(var f=0,d=this.subs;f<d.length;f++){var m=d[f];m.unsubscribe()}this.subs=[]},l.prototype.update=function(f){return Xg(f,this.params)?!1:(this.params=f,!0)},l}();e.Handler=u;var c=function(){function l(f,d){this.plugin=f,this.params=d,this.subs=[]}return l.prototype.subscribeCommand=function(f,d){this.subs.push(f.subscribe(this.plugin,d))},l.prototype.subscribeObservable=function(f,d){this.subs.push(f.subscribe(d))},l.prototype.unregister=function(){for(var f=0,d=this.subs;f<d.length;f++){var m=d[f];m.unsubscribe()}this.subs=[]},l}();e.WithSubscribers=c})(xr||(xr={}));var s0=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs=="undefined"&&(this.subs=[]);var a=t.subscribe(r);return this.subs.push(a),{unsubscribe:function(){a&&n.subs&&Ff(n.subs,a)&&(a.unsubscribe(),a=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=Lu.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),xc=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=this.state,i=cj(a,r);return i!==a?(this._state=i,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(s0),LA="3.0.2",B0e=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__!="undefined"?__MOLSTAR_DEBUG_TIMESTAMP__:1643574187710),Db=function(e){_t(t,e);function t(r){var n=e.call(this,{current:void 0,entries:wf(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ie(n,void 0,void 0,function(){var a,i,o;return ae(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,a=this.getNextId(this.state.current,1),!a||a===this.state.current?(this.stop(),[2]):(i=this.setCurrent(a),[4,this.plugin.state.setSnapshot(i)]);case 1:return s.sent(),o=typeof i.durationInMs!="undefined"?i.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(!!r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);!n||(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)},t.prototype.replace=function(r,n){var a=this.getEntry(r);if(!!a){var i=this.getIndex(a),o=t.Entry(n,{name:a.name,description:a.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(i,o)}),this.events.changed.next(void 0)}},t.prototype.move=function(r,n){var a=this.state.entries.size;if(!(a<2)){var i=this.getEntry(r);if(!!i){var o=this.getIndex(i),s=(o+n)%a;s<0&&(s+=a);var u=this.state.entries.get(s),c=this.state.entries.asMutable();c.set(s,i),c.set(o,u),this.updateState({current:i.snapshot.id,entries:c.asImmutable()}),this.events.changed.next(void 0)}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:wf()}),this.events.changed.next(void 0))},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot},t.prototype.getNextId=function(r,n){var a=this.state.entries.size;if(!r){if(a===0)return;var i=n===-1?a-1:0;return this.state.entries.get(i).snapshot.id}var o=this.getEntry(r);if(!!o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%a,s<0&&(s+=a),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:for(r.version!==LA,this.clear(),n=wf().asMutable(),a=0,i=r.entries;a<i.length;a++)o=i[a],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),s?(u=this.getEntry(s),c=u&&u.snapshot,c?[4,this.plugin.state.setSnapshot(c)]:[2]):[2];case 1:return l.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,c]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:LA,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v,h,g;return ae(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r==null?void 0:r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:a=new Uint8Array(Ay(n)),km(a,0,n),i={"state.json":a},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(c=u[s],l=c.asset,f=c.file,o.push([l.id,l]),d=i,m="assets/".concat(l.id),p=Uint8Array.bind,[4,f.arrayBuffer()]):[3,5];case 3:d[m]=new(p.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(v=JSON.stringify(o,null,2),h=new Uint8Array(Ay(v)),km(h,0,v),i["assets.json"]=h),[4,this.plugin.runTask(wW(i))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ie(this,void 0,void 0,function(){var n,a,i,a,o,s,u,c,l,f,d,m,p,v,h,g,i,y;return ae(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(fl(r,"string"))]:[3,2];case 1:return a=b.sent(),i=JSON.parse(a),t.isStateSnapshot(i)?[2,this.setStateSnapshot(i)]:t.isStateSnapshot(i.data)?[2,this.setStateSnapshot(i.data)]:(this.plugin.state.setSnapshot(i),[3,7]);case 2:return[4,this.plugin.runTask(fl(r,"zip"))];case 3:return a=b.sent(),o=Object.create(null),wo(a,function(x,C){if(!(C==="state.json"||C==="assets.json")){var _=C.substring(C.indexOf("/")+1);o[_]=new File([x],_)}}),s=new File([a["state.json"]],"state.json"),[4,this.plugin.runTask(fl(s,"string"))];case 4:return u=b.sent(),a["assets.json"]?(c=new File([a["assets.json"]],"assets.json"),d=(f=JSON).parse,[4,this.plugin.runTask(fl(c,"string"))]):[3,6];case 5:for(l=d.apply(f,[b.sent()]),m=0,p=l;m<p.length;m++)v=p[m],h=v[0],g=v[1],this.plugin.managers.asset.set(g,o[h]);b.label=6;case 6:return i=JSON.parse(u),[2,this.setStateSnapshot(i)];case 7:return[3,9];case 8:return y=b.sent(),console.error(y),this.plugin.log.error("Error reading state"),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next(void 0);var a=n.snapshot,i=typeof a.durationInMs!="undefined"?a.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle!="undefined"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(xc);(function(e){function t(n,a){return I({timestamp:+new Date,snapshot:n},a)}e.Entry=t;function r(n){var a=n;return!!a&&!!a.timestamp&&!!a.entries}e.isStateSnapshot=r})(Db||(Db={}));function F0e(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+a+"-"+i+"-"+o}function O0e(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function yN(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function bN(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,yN(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return yN(r)}))}else if(typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,a=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=function(c){O0e(i?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((a||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(typeof e=="string"?new Blob([e]):e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function NA(e,t){return"".concat(e).concat(e[e.length-1]==="/"||t[0]==="/"?"":"/").concat(t)}var xN={get preferWebGl1(){if(typeof navigator=="undefined"||typeof window=="undefined")return!1;var e=["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"];if(e.some(function(a){return navigator.userAgent.indexOf(a)>0}))return!0;var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||r&&n)},get wboit(){return typeof navigator=="undefined"||typeof window=="undefined"?!0:!/Version\/15.\d Safari/.test(navigator.userAgent)}},k0e=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function on(e,t){return new k0e(e,t)}var wn={item:on,General:{IsBusyTimeoutMs:on("plugin-config.is-busy-timeout",750),DisableAntialiasing:on("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:on("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:on("plugin-config.pixel-scale",1),PickScale:on("plugin-config.pick-scale",.25),PickPadding:on("plugin-config.pick-padding",3),EnableWboit:on("plugin-config.enable-wboit",xN.wboit),PreferWebGl1:on("plugin-config.prefer-webgl1",xN.preferWebGl1)},State:{DefaultServer:on("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:on("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:on("history-capacity.server",5)},VolumeStreaming:{Enabled:on("volume-streaming.enabled",!0),DefaultServer:on("volume-streaming.server","https://ds.litemol.org"),CanStream:on("volume-streaming.can-stream",function(e,t){return e.models.length===1&&jt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:on("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:on("viewer.show-expand-button",!0),ShowControls:on("viewer.show-controls-button",!0),ShowSettings:on("viewer.show-settings-button",!0),ShowSelectionMode:on("viewer.show-selection-model-button",!0),ShowAnimation:on("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:on("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:on("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:on("structure.size-thresholds",ke.DefaultSizeThresholds),DefaultRepresentationPreset:on("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:on("structure.default-representation-preset-params",{})}},L0e=function(){function e(t){var r=this;this._config=new Map,!!t&&t.forEach(function(n){var a=n[0],i=n[1];return r._config.set(a,i)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function N0e(e){SN(e),CN(e),_N(e),wN(e),AN(e),TN(e),PN(e),EN(e),IN(e),DN(e)}function SN(e){e.state.events.object.created.subscribe(function(t){!fe.isBehavior(t.obj)||t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){!fe.isBehavior(t.obj)||t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&fe.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&fe.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function CN(e){Xt.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function _N(e){Xt.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,a=t.options;return e.runTask(r.updateTree(n,a))})}function wN(e){Xt.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,a=t.ref;return e.runTask(r.applyAction(n.action,n.params,a))})}function AN(e){function t(r,n){var a=r.build().delete(n);return e.runTask(r.updateTree(a))}Xt.State.RemoveObject.subscribe(e,function(r){var n=r.state,a=r.ref,i=r.removeParentGhosts;if(i){var o=n.tree,s=o.transforms.get(a);if(s.parent===a)return t(n,a);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var c=o.transforms.get(s.parent);if(!c.state.isGhost)return t(n,s.ref);s=c}}else return t(n,a)})}function TN(e){Xt.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(a){var i=a.isCollapsed;return{isCollapsed:!i}})})}function PN(e){Xt.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Sp(r,n,!r.cells.get(n).state.isHidden)})}function Sp(e,t,r){Pn.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},U0e)}function U0e(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function EN(e){Xt.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var a=typeof n=="string"?[n]:n,i=0,o=a;i<o.length;i++){var s=o[i],u=r.cells.get(s);if(!!u){if(fe.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:ke.Loci(u.obj.data)},!1);else if(u&&fe.isRepresentation3D(u.obj)){var c=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:c.getLoci(),repr:c},!1)}else if(fe.Molecule.Structure.Selections.is(u.obj))for(var l=0,f=u.obj.data;l<f.length;l++){var d=f[l];e.managers.interactivity.lociHighlights.highlight({loci:d.loci},!1)}}}}})}function IN(e){Xt.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function DN(e){var t=this;e.config.set(wn.State.CurrentServer,e.config.get(wn.State.DefaultServer)),Xt.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),Xt.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),Xt.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,a=r.description,i=r.params,o=Db.Entry(e.state.getSnapshot(i),{name:n,description:a});e.managers.snapshot.add(o)}),Xt.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,a=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(a))}),Xt.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,a=r.dir;e.managers.snapshot.move(n,a)}),Xt.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,a=e.managers.snapshot.setCurrent(n);if(!!a)return e.state.setSnapshot(a)}),Xt.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,a=r.description,i=r.playOnLoad,o=r.serverUrl;return r.params,fetch(NA(o,"set?name=".concat(encodeURIComponent(n||""),"&description=").concat(encodeURIComponent(a||""))),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:a,playOnLoad:i}))})}),Xt.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ie(t,void 0,void 0,function(){var a;return ae(this,function(i){switch(i.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return a=i.sent(),[4,e.managers.snapshot.setStateSnapshot(a.data)];case 2:return i.sent(),[2]}})})}),Xt.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,a=r.type,i=r.params;return ie(t,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return o="mol-star_state_".concat(n||F0e(),".").concat(a==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:a,params:i})];case 1:return s=u.sent(),bN(s,"".concat(o)),[2]}})})}),Xt.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),Xt.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,a=r.type;return ie(t,void 0,void 0,function(){var i;return ae(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return i=o.sent(),[2,e.managers.snapshot.open(new File([i],"state.".concat(a)))]}})})})}var z0e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:N0e,SyncBehaviors:SN,SetCurrentObject:CN,Update:_N,ApplyAction:wN,RemoveObject:AN,ToggleExpanded:TN,ToggleVisibility:PN,setSubtreeVisibility:Sp,Highlight:EN,ClearHighlights:IN,Snapshots:DN});function V0e(e){MN(e),RN(e),BN(e)}function MN(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;!fe.isRepresentation3D(r.obj)||(UA(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,a;r.oldObj&&fe.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),!!fe.isRepresentation3D(r.obj)&&(UA(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(a=e.canvas3d)===null||a===void 0||a.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;!fe.isRepresentation3D(r.obj)||((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function RN(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.updated.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.state),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}}),t.object.removed.subscribe(function(r){var n;if(!!fe.Molecule.Structure.Representation3DState.is(r.obj)){var a=r.obj.data;a.repr.setState(a.initialState),(n=e.canvas3d)===null||n===void 0||n.update(a.repr)}})}function BN(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);!fe.isRepresentation3D(n.obj)||UA(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function UA(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var G0e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:V0e,SyncRepresentationToCanvas:MN,SyncStructureRepresentation3DState:RN,UpdateRepresentationVisibility:BN});function H0e(e){FN(e),kN(e),ON(e)}function FN(e){Xt.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function ON(e){Xt.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function kN(e){Xt.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,a=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:a}),e.events.canvas3d.settingsUpdated.next(void 0)})}var q0e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:H0e,Reset:FN,SetSnapshot:ON,Focus:kN});function zA(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function LN(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}var NN={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:function(e,t){return!0},pixelScale:1},Ts;(function(e){e.None=n();function t(a,i){return a.shift===i.shift&&a.alt===i.alt&&a.control===i.control&&a.meta===i.meta}e.areEqual=t;function r(a){if(!a)return 0;var i=0;return a.shift&&i++,a.alt&&i++,a.control&&i++,a.meta&&i++,i}e.size=r;function n(a){return a===void 0&&(a={}),{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}e.create=n})(Ts||(Ts={}));var Sd;(function(e){e.has=Da.has,e.create=Da.create})(Sd||(Sd={}));function UN(){return{drag:new En,interactionEnd:new En,click:new En,move:new En,wheel:new En,pinch:new En,gesture:new En,resize:new En,leave:new En,enter:new En,modifiers:new En,key:new En}}var j0e=["Backspace","Delete"],VA;(function(e){function t(n){n===void 0&&(n={});var a=I(I({},NN),n),i=a.noScroll,o=a.noContextMenu;return I(I({noScroll:i,noContextMenu:o,width:0,height:0,pixelRatio:1},UN()),{dispose:dC})}e.create=t;function r(n,a){a===void 0&&(a={});var i=I(I({},NN),a),o=i.noScroll,s=i.noMiddleClickScroll,u=i.noContextMenu,c=i.noPinchZoom,l=i.noTextSelect,f=i.mask,d=i.pixelScale,m=i.preventGestures,p=n.clientWidth*T(),v=n.clientHeight*T(),h=0,g=0,y=Fe(),b=Fe(),x=Fe(),C=Fe(),_=Fe(),w={shift:!1,alt:!1,control:!1,meta:!1};function T(){return window.devicePixelRatio*d}function A(){return I({},w)}var D=0,E=!1,M=Sd.create(0),F=0,O=!1,U=UN(),N=U.drag,q=U.interactionEnd,j=U.wheel,Q=U.pinch,J=U.gesture,te=U.click,K=U.move,L=U.leave,W=U.enter,k=U.resize,V=U.modifiers,G=U.key;return H(),I(I({get noScroll(){return o},set noScroll(Z){o=Z},get noContextMenu(){return u},set noContextMenu(Z){u=Z},get width(){return p},get height(){return v},get pixelRatio(){return T()}},U),{dispose:X});function H(){n.addEventListener("contextmenu",Y,!1),n.addEventListener("wheel",Ye,!1),n.addEventListener("mousedown",pe,!1),window.addEventListener("mousemove",ge,!1),window.addEventListener("mouseup",Ce,!1),n.addEventListener("mouseenter",rt,!1),n.addEventListener("mouseleave",ut,!1),n.addEventListener("touchstart",B,!1),n.addEventListener("touchmove",le,!1),n.addEventListener("touchend",z,!1),n.addEventListener("gesturechange",we,!1),n.addEventListener("gesturestart",ht,!1),n.addEventListener("gestureend",Ve,!1),window.addEventListener("blur",ue),window.addEventListener("keyup",he,!1),window.addEventListener("keydown",me,!1),window.addEventListener("keypress",Pe,!1),window.addEventListener("resize",Ue,!1)}function X(){E||(E=!0,n.removeEventListener("contextmenu",Y,!1),n.removeEventListener("wheel",Ye,!1),n.removeEventListener("mousedown",pe,!1),window.removeEventListener("mousemove",ge,!1),window.removeEventListener("mouseup",Ce,!1),n.removeEventListener("mouseenter",rt,!1),n.removeEventListener("mouseleave",ut,!1),n.removeEventListener("touchstart",B,!1),n.removeEventListener("touchmove",le,!1),n.removeEventListener("touchend",z,!1),n.removeEventListener("gesturechange",we,!1),n.removeEventListener("gesturestart",ht,!1),n.removeEventListener("gestureend",Ve,!1),window.removeEventListener("blur",ue),window.removeEventListener("keyup",he,!1),window.removeEventListener("keydown",me,!1),window.removeEventListener("keypress",Pe,!1),window.removeEventListener("resize",Ue,!1))}function Y(Z){!f(Z.clientX,Z.clientY)||u&&Z.preventDefault()}function oe(Z){w.alt=Z.altKey,w.shift=Z.shiftKey,w.control=Z.ctrlKey,w.meta=Z.metaKey}function ue(){(M||w.shift||w.alt||w.meta||w.control)&&(M=0,w.shift=w.alt=w.control=w.meta=!1)}function me(Z){var de=!1;!w.alt&&Z.altKey&&(de=!0,w.alt=!0),!w.shift&&Z.shiftKey&&(de=!0,w.shift=!0),!w.control&&Z.ctrlKey&&(de=!0,w.control=!0),!w.meta&&Z.metaKey&&(de=!0,w.meta=!0),de&&O&&V.next(A())}function he(Z){var de=!1;w.alt&&!Z.altKey&&(de=!0,w.alt=!1),w.shift&&!Z.shiftKey&&(de=!0,w.shift=!1),w.control&&!Z.ctrlKey&&(de=!0,w.control=!1),w.meta&&!Z.metaKey&&(de=!0,w.meta=!1),de&&O&&V.next(A()),j0e.includes(Z.key)&&Pe(Z)}function Pe(Z){G.next({key:Z.key,modifiers:A()})}function re(Z){var de=Z.touches[0],ye=Z.touches[1];return{clientX:(de.clientX+ye.clientX)/2,clientY:(de.clientY+ye.clientY)/2,pageX:(de.pageX+ye.pageX)/2,pageY:(de.pageY+ye.pageY)/2}}function ee(Z){var de=Z.touches[0].pageX-Z.touches[1].pageX,ye=Z.touches[0].pageY-Z.touches[1].pageY;return Math.sqrt(de*de+ye*ye)}function B(Z){if(Z.preventDefault(),Z.touches.length===1)M=F=1,Oe(Z.touches[0]);else if(Z.touches.length===2){M=2&4,F=2,Oe(re(Z));var de=ee(Z);h=de,Q.next({distance:de,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:M,button:F,modifiers:A()})}else Z.touches.length===3&&(M=F=8,Oe(re(Z)))}function z(Z){Ie()}function le(Z){if(F=0,c&&(Z.preventDefault(),Z.stopPropagation(),Z.originalEvent&&(Z.originalEvent.preventDefault(),Z.originalEvent.stopPropagation())),Z.touches.length===1)M=1,Ne(Z.touches[0]);else if(Z.touches.length===2){var de=ee(Z),ye=h-de;if(Math.abs(ye)<4)M=2,Ne(re(Z));else{M=4,oe(Z);var He=h/de;Q.next({delta:ye,fraction:He,fractionDelta:g-He,distance:de,isStart:!1,buttons:M,button:F,modifiers:A()}),g=He}h=de}else Z.touches.length===3&&(M=8,Ne(re(Z)))}function pe(Z){oe(Z),M=zA(Z),F=LN(Z),s&&M===4&&Z.preventDefault,Oe(Z)}function ge(Z){oe(Z),M=zA(Z),F=0,Ne(Z)}function Ce(Z){oe(Z),M=zA(Z),F=LN(Z),We(Z),Ie()}function Ie(){q.next(void 0)}function Oe(Z){!f(Z.clientX,Z.clientY)||(wt(b,Z),Fe.copy(y,b),pt(b)&&(D=1))}function We(Z){if(D=0,!!f(Z.clientX,Z.clientY)&&(wt(x,Z),Fe.distance(x,y)<4)){var de=Z.pageX,ye=Z.pageY,He=x[0],ot=x[1];te.next({x:He,y:ot,pageX:de,pageY:ye,buttons:M,button:F,modifiers:A()})}}function Ne(Z){var de;wt(x,Z);var ye=Z.pageX,He=Z.pageY,ot=x[0],ct=x[1],Ct=pt(x);if(K.next({x:ot,y:ct,pageX:ye,pageY:He,buttons:M,button:F,modifiers:A(),inside:Ct}),D!==0&&(l&&((de=Z.preventDefault)===null||de===void 0||de.call(Z)),Fe.div(C,Fe.sub(C,x,b),mt(_)),!(Fe.magnitude(C)<Ir))){var vr=D===1;if(!(vr&&!f(Z.clientX,Z.clientY))){var Rr=C[0],Ur=C[1];N.next({x:ot,y:ct,dx:Rr,dy:Ur,pageX:ye,pageY:He,buttons:M,button:F,modifiers:A(),isStart:vr}),Fe.copy(b,x),D=2}}}function Ye(Z){if(!!f(Z.clientX,Z.clientY)){wt(x,Z);var de=Z.pageX,ye=Z.pageY,He=x[0],ot=x[1];o&&Z.preventDefault();var ct=W0e(Z);M=F=4,(ct.dx||ct.dy||ct.dz)&&j.next(I(I({x:He,y:ot,pageX:de,pageY:ye},ct),{buttons:M,button:F,modifiers:A()}))}}function Xe(Z){var de,ye;!m||(Z.preventDefault(),(de=Z.stopImmediatePropagation)===null||de===void 0||de.call(Z),(ye=Z.stopPropagation)===null||ye===void 0||ye.call(Z))}var Ze=0,Ke=0;function ht(Z){Xe(Z),Ze=Z.scale,Ke=Z.rotation,J.next({scale:Z.scale,rotation:Z.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function Ae(Z,de){J.next({scale:Z.scale,rotation:Z.rotation,deltaRotation:Ke-Z.rotation,deltaScale:Ze-Z.scale,isEnd:de}),Ke=Z.rotation,Ze=Z.scale}function we(Z){Xe(Z),Ae(Z)}function Ve(Z){Xe(Z),Ae(Z,!0)}function rt(Z){O=!0,W.next(void 0)}function ut(Z){O=!1,L.next(void 0)}function Ue(Z){k.next({})}function pt(Z){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var de=n.getBoundingClientRect();return Z[0]>=0&&Z[1]>=0&&Z[0]<de.width&&Z[1]<de.height}function mt(Z){return Z[0]=n.clientWidth,Z[1]=n.clientHeight,Z}function wt(Z,de){p=n.clientWidth*T(),v=n.clientHeight*T();var ye=de.clientX||0,He=de.clientY||0,ot=n.getBoundingClientRect();return Z[0]=ye-ot.left,Z[1]=He-ot.top,Z}}e.fromElement=r})(VA||(VA={}));function W0e(e){var t=10,r=40,n=800,a=0,i=0,o=0,s=0,u=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(a=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(a=i,i=0),o=a*t,s=i*t,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(o=e.deltaX),"deltaZ"in e&&(u=e.deltaZ),(o||s||u)&&e.deltaMode&&(e.deltaMode===1?(o*=r,s*=r,u*=r):(o*=n,s*=n,u*=n)),o&&!a&&(a=o<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:a,spinY:i,dx:o,dy:s,dz:u}}function da(){return da.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,c,l,f){return{x:u,y:c,width:l,height:f}}e.create=r;function n(u){return I({},u)}e.clone=n;function a(u,c){return Object.assign(u,c)}e.copy=a;function i(u,c,l,f,d){return u.x=c,u.y=l,u.width=f,u.height=d,u}e.set=i;function o(u,c){return u[0]=c.x,u[1]=c.y,u[2]=c.width,u[3]=c.height,u}e.toVec4=o;function s(u,c){return u.x===c.x&&u.y===c.y&&u.width===c.width&&u.height===c.height}e.equals=s})(da||(da={}));var pu=Wt();function X0e(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height;Wt.set(pu,t[0],t[1],t[2],1),Wt.transformMat4(pu,pu,n);var u=pu[3];return u!==0&&(pu[0]/=u,pu[1]/=u,pu[2]/=u),e[0]=(pu[0]+1)*o*.5+a,e[1]=(1-pu[1])*s*.5+i,e[2]=(pu[2]+1)*.5,e[3]=u===0?0:1/u,e}function Mb(e,t,r,n){var a=r.x,i=r.y,o=r.width,s=r.height,u=t[0]-a,c=s-t[1]-1-i,l=t[2];return e[0]=2*u/o-1,e[1]=2*c/s-1,e[2]=2*l-1,S.transformMat4(e,e,n)}var GA={backgroundColor:P.Color(st(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:P.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:P.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:P.Boolean(!0,{label:"Use Interior Color"}),interiorColor:P.Color(st.fromNormalizedRgb(.3,.3,.3)),highlightColor:P.Color(st.fromNormalizedRgb(1,.4,.6)),selectColor:P.Color(st.fromNormalizedRgb(.2,1,.1)),highlightStrength:P.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:P.Numeric(.3,{min:0,max:1,step:.1}),markerPriority:P.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:P.Numeric(1,{min:0,max:3,step:.1}),light:P.ObjectList({inclination:P.Numeric(180,{min:0,max:180,step:1}),azimuth:P.Numeric(0,{min:0,max:360,step:1}),color:P.Color(st.fromNormalizedRgb(1,1,1)),intensity:P.Numeric(.6,{min:0,max:1,step:.01})},function(e){return st.toHexString(e.color)},{defaultValue:[{inclination:180,azimuth:0,color:st.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:P.Color(st.fromNormalizedRgb(1,1,1)),ambientIntensity:P.Numeric(.4,{min:0,max:1,step:.01})},zN=S(),HA=S();function VN(e,t){for(var r=t||{direction:new Array(5*3).fill(0),color:new Array(5*3).fill(0)},n=r.direction,a=r.color,i=0,o=e.length;i<o;++i){var s=e[i];S.directionFromSpherical(zN,pr(s.inclination),pr(s.azimuth),1),S.toArray(zN,n,i*3),S.scale(HA,st.toVec3Normalized(HA,s.color),s.intensity),S.toArray(HA,a,i*3)}return{count:e.length,direction:n,color:a}}var qA;(function(e){function t(r,n){n===void 0&&(n={});var a=r.gl,i=r.state,o=r.stats,s=P.merge(GA,P.getDefaultValues(GA),n),u=VN(s.light),c=da(),l=Fe.create(a.drawingBufferWidth,a.drawingBufferHeight),f=st.toVec3Normalized(S(),s.backgroundColor),d=!1,m=vi(a),p=[["tDepth",m]],v=se(),h=se(),g=se(),y=se(),b=se(),x=se(),C=se(),_=S(),w=Fe(),T=S();S.scale(T,st.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity);var A={uModel:R.create(se.identity()),uView:R.create(v),uInvView:R.create(h),uModelView:R.create(g),uInvModelView:R.create(y),uInvProjection:R.create(b),uProjection:R.create(se()),uModelViewProjection:R.create(x),uInvModelViewProjection:R.create(C),uIsOrtho:R.create(1),uViewOffset:R.create(w),uPixelRatio:R.create(r.pixelRatio),uViewport:R.create(da.toVec4(Wt(),c)),uDrawingBufferSize:R.create(l),uCameraPosition:R.create(S()),uCameraDir:R.create(_),uNear:R.create(1),uFar:R.create(1e4),uFogNear:R.create(1),uFogFar:R.create(1e4),uFogColor:R.create(f),uRenderWboit:R.create(!1),uMarkingDepthTest:R.create(!1),uPickType:R.create(0),uMarkingType:R.create(0),uTransparentBackground:R.create(!1),uLightDirection:R.create(u.direction),uLightColor:R.create(u.color),uAmbientColor:R.create(T),uPickingAlphaThreshold:R.create(s.pickingAlphaThreshold),uInteriorDarkening:R.create(s.interiorDarkening),uInteriorColorFlag:R.create(s.interiorColorFlag),uInteriorColor:R.create(st.toVec3Normalized(S(),s.interiorColor)),uHighlightColor:R.create(st.toVec3Normalized(S(),s.highlightColor)),uSelectColor:R.create(st.toVec3Normalized(S(),s.selectColor)),uHighlightStrength:R.create(s.highlightStrength),uSelectStrength:R.create(s.selectStrength),uMarkerPriority:R.create(s.markerPriority),uXrayEdgeFalloff:R.create(s.xrayEdgeFalloff)},D=Object.entries(A),E=!0,M=function(V,G){if(!(V.state.disposed||!V.state.visible||!V.state.pickable&&G==="pick")){var H=!1;V.values.dLightCount.ref.value!==u.count&&(R.update(V.values.dLightCount,u.count),H=!0),H&&V.update();var X=V.getProgram(G);if(i.currentProgramId!==X.id&&(E=!0,X.use()),E&&(X.setUniforms(D),E=!1),V.values.dGeometryType.ref.value==="directVolume"){if(G!=="colorWboit"&&G!=="colorBlended")return;i.disable(a.CULL_FACE),i.frontFace(a.CCW),G==="colorBlended"&&(i.disable(a.DEPTH_TEST),i.depthMask(!1))}else V.values.uDoubleSided?V.values.uDoubleSided.ref.value||V.values.hasReflection.ref.value?i.disable(a.CULL_FACE):i.enable(a.CULL_FACE):i.disable(a.CULL_FACE),V.values.dFlipSided&&V.values.dFlipSided.ref.value?(i.frontFace(a.CW),i.cullFace(a.FRONT)):(i.frontFace(a.CCW),i.cullFace(a.BACK));V.render(G,p)}},F=function(V){R.update(A.uView,V.view),R.update(A.uInvView,se.invert(h,V.view)),R.update(A.uProjection,V.projection),R.update(A.uInvProjection,se.invert(b,V.projection)),R.updateIfChanged(A.uIsOrtho,V.state.mode==="orthographic"?1:0),R.update(A.uViewOffset,V.viewOffset.enabled?Fe.set(w,V.viewOffset.offsetX*16,V.viewOffset.offsetY*16):Fe.set(w,0,0)),R.update(A.uCameraPosition,V.state.position),R.update(A.uCameraDir,S.normalize(_,S.sub(_,V.state.target,V.state.position))),R.updateIfChanged(A.uFar,V.far),R.updateIfChanged(A.uNear,V.near),R.updateIfChanged(A.uFogFar,V.fogFar),R.updateIfChanged(A.uFogNear,V.fogNear),R.updateIfChanged(A.uTransparentBackground,d)},O=function(V,G,H,X,Y){zW(p,"tDepth",H||m),R.update(A.uModel,V.view),R.update(A.uModelView,se.mul(g,V.view,G.view)),R.update(A.uInvModelView,se.invert(y,g)),R.update(A.uModelViewProjection,se.mul(x,g,G.projection)),R.update(A.uInvModelViewProjection,se.invert(C,x)),R.updateIfChanged(A.uRenderWboit,X),R.updateIfChanged(A.uMarkingDepthTest,Y),i.enable(a.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);var oe=c.x,ue=c.y,me=c.width,he=c.height;a.viewport(oe,ue,me,he),a.scissor(oe,ue,me,he),E=!0,i.currentRenderItemId=-1},U=function(V,G,H,X,Y){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,X,!1,!1),R.updateIfChanged(A.uPickType,Y);for(var oe=V.renderables,ue=0,me=oe.length;ue<me;++ue)oe[ue].state.colorOnly||M(oe[ue],H)},N=function(V,G,H){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,H,!1,!1);for(var X=V.renderables,Y=0,oe=X.length;Y<oe;++Y)M(X[Y],"depth")},q=function(V,G,H){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,H,!1,!1),R.updateIfChanged(A.uMarkingType,1);for(var X=V.renderables,Y=0,oe=X.length;Y<oe;++Y){var ue=X[Y];ue.values.markerAverage.ref.value!==1&&M(X[Y],"marking")}},j=function(V,G,H){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,H,!1,!!H),R.updateIfChanged(A.uMarkingType,2);for(var X=V.renderables,Y=0,oe=X.length;Y<oe;++Y){var ue=X[Y];ue.values.markerAverage.ref.value>0&&M(X[Y],"marking")}},Q=function(V,G,H){J(V,G,H),te(V,G,H)},J=function(V,G,H){i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,H,!1,!1);for(var X=V.renderables,Y=0,oe=X.length;Y<oe;++Y){var ue=X[Y];ue.state.opaque&&M(ue,"colorBlended")}},te=function(V,G,H){i.enable(a.DEPTH_TEST),O(V,G,H,!1,!1);var X=V.renderables;d?i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),i.depthMask(!0);for(var Y=0,oe=X.length;Y<oe;++Y){var ue=X[Y];!ue.state.opaque&&ue.state.writeDepth&&M(ue,"colorBlended")}i.depthMask(!1);for(var Y=0,oe=X.length;Y<oe;++Y){var ue=X[Y];!ue.state.opaque&&!ue.state.writeDepth&&M(ue,"colorBlended")}},K=function(V,G,H){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),O(V,G,H,!1,!1);for(var Y=V.renderables,oe=0,ue=Y.length;oe<ue;++oe){var me=Y[oe],he=Ra(me.values.alpha.ref.value*me.state.alphaFactor,0,1);he===1&&me.values.transparencyAverage.ref.value!==1&&!((X=me.values.dXrayShaded)===null||X===void 0?void 0:X.ref.value)&&M(me,"colorBlended")}},L=function(V,G,H){var X;i.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),i.enable(a.BLEND),O(V,G,H,!1,!1);for(var Y=V.renderables,oe=0,ue=Y.length;oe<ue;++oe){var me=Y[oe],he=Ra(me.values.alpha.ref.value*me.state.alphaFactor,0,1);(he<1||me.values.transparencyAverage.ref.value>0||((X=me.values.dXrayShaded)===null||X===void 0?void 0:X.ref.value))&&M(me,"colorBlended")}},W=function(V,G,H){var X,Y;i.disable(a.BLEND),i.enable(a.DEPTH_TEST),i.depthMask(!0),O(V,G,H,!1,!1);for(var oe=V.renderables,ue=0,me=oe.length;ue<me;++ue){var he=oe[ue],Pe=Ra(he.values.alpha.ref.value*he.state.alphaFactor,0,1);Pe===1&&he.values.transparencyAverage.ref.value!==1&&he.values.dGeometryType.ref.value!=="directVolume"&&((X=he.values.dPointStyle)===null||X===void 0?void 0:X.ref.value)!=="fuzzy"&&!((Y=he.values.dXrayShaded)===null||Y===void 0?void 0:Y.ref.value)&&M(he,"colorWboit")}},k=function(V,G,H){var X,Y;O(V,G,H,!0,!1);for(var oe=V.renderables,ue=0,me=oe.length;ue<me;++ue){var he=oe[ue],Pe=Ra(he.values.alpha.ref.value*he.state.alphaFactor,0,1);(Pe<1||he.values.transparencyAverage.ref.value>0||he.values.dGeometryType.ref.value==="directVolume"||((X=he.values.dPointStyle)===null||X===void 0?void 0:X.ref.value)==="fuzzy"||!!he.values.uBackgroundColor||((Y=he.values.dXrayShaded)===null||Y===void 0?void 0:Y.ref.value))&&M(he,"colorWboit")}};return{clear:function(V,G){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),d&&!G?i.clearColor(0,0,0,0):V?i.clearColor(f[0],f[1],f[2],1):i.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:function(){i.enable(a.SCISSOR_TEST),i.enable(a.DEPTH_TEST),i.depthMask(!0),a.clear(a.DEPTH_BUFFER_BIT)},update:F,renderPick:U,renderDepth:N,renderMarkingDepth:q,renderMarkingMask:j,renderBlended:Q,renderBlendedOpaque:J,renderBlendedTransparent:te,renderBlendedVolumeOpaque:K,renderBlendedVolumeTransparent:L,renderWboitOpaque:W,renderWboitTransparent:k,setProps:function(V){V.backgroundColor!==void 0&&V.backgroundColor!==s.backgroundColor&&(s.backgroundColor=V.backgroundColor,st.toVec3Normalized(f,s.backgroundColor),R.update(A.uFogColor,S.copy(A.uFogColor.ref.value,f))),V.pickingAlphaThreshold!==void 0&&V.pickingAlphaThreshold!==s.pickingAlphaThreshold&&(s.pickingAlphaThreshold=V.pickingAlphaThreshold,R.update(A.uPickingAlphaThreshold,s.pickingAlphaThreshold)),V.interiorDarkening!==void 0&&V.interiorDarkening!==s.interiorDarkening&&(s.interiorDarkening=V.interiorDarkening,R.update(A.uInteriorDarkening,s.interiorDarkening)),V.interiorColorFlag!==void 0&&V.interiorColorFlag!==s.interiorColorFlag&&(s.interiorColorFlag=V.interiorColorFlag,R.update(A.uInteriorColorFlag,s.interiorColorFlag)),V.interiorColor!==void 0&&V.interiorColor!==s.interiorColor&&(s.interiorColor=V.interiorColor,R.update(A.uInteriorColor,st.toVec3Normalized(A.uInteriorColor.ref.value,s.interiorColor))),V.highlightColor!==void 0&&V.highlightColor!==s.highlightColor&&(s.highlightColor=V.highlightColor,R.update(A.uHighlightColor,st.toVec3Normalized(A.uHighlightColor.ref.value,s.highlightColor))),V.selectColor!==void 0&&V.selectColor!==s.selectColor&&(s.selectColor=V.selectColor,R.update(A.uSelectColor,st.toVec3Normalized(A.uSelectColor.ref.value,s.selectColor))),V.highlightStrength!==void 0&&V.highlightStrength!==s.highlightStrength&&(s.highlightStrength=V.highlightStrength,R.update(A.uHighlightStrength,s.highlightStrength)),V.selectStrength!==void 0&&V.selectStrength!==s.selectStrength&&(s.selectStrength=V.selectStrength,R.update(A.uSelectStrength,s.selectStrength)),V.markerPriority!==void 0&&V.markerPriority!==s.markerPriority&&(s.markerPriority=V.markerPriority,R.update(A.uMarkerPriority,s.markerPriority)),V.xrayEdgeFalloff!==void 0&&V.xrayEdgeFalloff!==s.xrayEdgeFalloff&&(s.xrayEdgeFalloff=V.xrayEdgeFalloff,R.update(A.uXrayEdgeFalloff,s.xrayEdgeFalloff)),V.light!==void 0&&!Eu(V.light,s.light)&&(s.light=V.light,Object.assign(u,VN(V.light,u)),R.update(A.uLightDirection,u.direction),R.update(A.uLightColor,u.color)),V.ambientColor!==void 0&&V.ambientColor!==s.ambientColor&&(s.ambientColor=V.ambientColor,S.scale(T,st.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity),R.update(A.uAmbientColor,T)),V.ambientIntensity!==void 0&&V.ambientIntensity!==s.ambientIntensity&&(s.ambientIntensity=V.ambientIntensity,S.scale(T,st.toArrayNormalized(s.ambientColor,T,0),s.ambientIntensity),R.update(A.uAmbientColor,T))},setViewport:function(V,G,H,X){a.viewport(V,G,H,X),a.scissor(V,G,H,X),(V!==c.x||G!==c.y||H!==c.width||X!==c.height)&&(da.set(c,V,G,H,X),R.update(A.uViewport,Wt.set(A.uViewport.ref.value,V,G,H,X)))},setTransparentBackground:function(V){d=V},setDrawingBufferSize:function(V,G){(V!==l[0]||G!==l[1])&&R.update(A.uDrawingBufferSize,Fe.set(l,V,G))},setPixelRatio:function(V){R.update(A.uPixelRatio,V)},props:s,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(qA||(qA={}));function or(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),or.create(e,t,r)}(function(e){function t(s,u,c){return u===void 0&&(u=""),c===void 0&&(c=""),{triggers:s,action:u,description:c}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,c){return s.triggers.some(function(l){return o.match(l,u,c)})}e.match=n;function a(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=a;function i(s,u){u===void 0&&(u="");var c=s.description||Ao(u);return vj(c,{triggers:"<i>"+a(s)+"</i>"})}e.format=i;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(f,d){return{buttons:f,modifiers:d}}s.create=u,s.Empty={};function c(f,d,m){var p=f.buttons,v=f.modifiers;return p!==void 0&&(p===d||Sd.has(p,d))&&(!v||Ts.areEqual(v,m))}s.match=c;function l(f){var d=[],m=Y0e(f.buttons);m&&d.push(m);var p=K0e(f.modifiers);return p&&d.push(p),d.join(" + ")}s.format=l}(o=e.Trigger||(e.Trigger={}))})(or||(or={}));var Rb=Sd;function Y0e(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(Rb.has(e,1)&&t.push("left mouse button"),Rb.has(e,2)&&t.push("right mouse button"),Rb.has(e,4)&&t.push("wheel/middle mouse button"),Rb.has(e,8)&&t.push("three fingers")),t.join(" + ")}function K0e(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var zl=Ts,Vl=or.Trigger,Q0e={dragRotate:or([Vl(1,zl.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:or([Vl(1,zl.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:or([Vl(2,zl.create()),Vl(1,zl.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:or.Empty,dragFocus:or([Vl(8,zl.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:or([Vl(4,zl.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:or([Vl(4,zl.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:or([Vl(4,zl.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:or.Empty},GN={noScroll:P.Boolean(!0,{isHidden:!0}),rotateSpeed:P.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:P.Numeric(7,{min:1,max:15,step:1}),panSpeed:P.Numeric(1,{min:.1,max:5,step:.1}),animate:P.MappedStatic("off",{off:P.EmptyGroup(),spin:P.Group({speed:P.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:P.Group({speed:P.Numeric(.3,{min:-5,max:5,step:.1}),angle:P.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:P.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:P.Numeric(.2,{},{isHidden:!0}),minDistance:P.Numeric(.01,{},{isHidden:!0}),maxDistance:P.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:P.Numeric(1,{},{isHidden:!0}),maxWheelDelta:P.Numeric(.02,{},{isHidden:!0}),bindings:P.Value(Q0e,{isHidden:!0}),autoAdjustMinMaxDistance:P.MappedStatic("on",{off:P.EmptyGroup(),on:P.Group({minDistanceFactor:P.Numeric(0),minDistancePadding:P.Numeric(5),maxDistanceFactor:P.Numeric(10),maxDistanceMin:P.Numeric(20)})},{isHidden:!0})},jA;(function(e){function t(r,n,a){a===void 0&&(a={});var i=I(I({},P.getDefaultValues(GN)),a),o=da.clone(n.viewport),s=!1,u=r.drag.subscribe(pe),c=r.interactionEnd.subscribe(ge),l=r.wheel.subscribe(Ce),f=r.pinch.subscribe(Ie),d=r.gesture.subscribe(Oe),m=!1,p=S(),v=S(),h=Fe(),g=Fe(),y=S(),b=0,x=Fe(),C=Fe(),_=0,w=Fe(),T=Fe(),A=Fe(),D=Fe(),E=Fe(),M=Fe(),F=S.clone(n.target),O=S.clone(n.position),U=S.clone(n.up),N=Fe();function q(we,Ve){return Fe.set(N,(we-o.x)/o.width,(Ve-o.y)/o.height)}var j=Fe();function Q(we,Ve){return Fe.set(j,(we-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-Ve))/o.width)}function J(){var we=r.width/r.height;return i.rotateSpeed*r.pixelRatio*we}var te=S(),K=Gr(),L=S(),W=S(),k=S(),V=S();function G(){var we=g[0]-h[0],Ve=g[1]-h[1];S.set(V,we,Ve,0);var rt=S.magnitude(V)*J();rt?(S.sub(v,n.position,n.target),S.normalize(L,v),S.normalize(W,n.up),S.normalize(k,S.cross(k,W,L)),S.setMagnitude(W,W,Ve),S.setMagnitude(k,k,we),S.add(V,W,k),S.normalize(te,S.cross(te,V,v)),Gr.setAxisAngle(K,te,rt),S.transformQuat(v,v,K),S.transformQuat(n.up,n.up,K),S.copy(y,te),b=rt):!i.staticMoving&&b&&(b*=Math.sqrt(1-i.dynamicDampingFactor),S.sub(v,n.position,n.target),Gr.setAxisAngle(K,y,b),S.transformQuat(v,v,K),S.transformQuat(n.up,n.up,K)),Fe.copy(h,g)}var H=Gr();function X(){var we=C[0]-x[0],Ve=C[1]-x[1],rt=i.rotateSpeed*(-we+Ve)*-.05;rt?(S.sub(v,n.position,n.target),Gr.setAxisAngle(H,v,rt),S.transformQuat(n.up,n.up,H),_=rt):!i.staticMoving&&_&&(_*=Math.sqrt(1-i.dynamicDampingFactor),S.sub(v,n.position,n.target),Gr.setAxisAngle(H,v,_),S.transformQuat(n.up,n.up,H)),Fe.copy(x,C)}function Y(){var we=1+(T[1]-w[1])*i.zoomSpeed;we!==1&&we>0&&S.scale(v,v,we),i.staticMoving?Fe.copy(w,T):w[1]+=(T[1]-w[1])*i.dynamicDampingFactor}function oe(){var we=(D[1]-A[1])*i.zoomSpeed;if(we!==0){var Ve=Math.max(1,n.state.radius+n.state.radius*we);n.setState({radius:Ve})}i.staticMoving?Fe.copy(A,D):A[1]+=(D[1]-A[1])*i.dynamicDampingFactor}var ue=Fe(),me=S(),he=S();function Pe(){if(Fe.sub(ue,Fe.copy(ue,M),E),Fe.squaredMagnitude(ue)){var we=r.pixelRatio*i.panSpeed;ue[0]*=1/n.zoom*n.viewport.width*we,ue[1]*=1/n.zoom*n.viewport.height*we,S.cross(he,S.copy(he,v),n.up),S.setMagnitude(he,he,ue[0]),S.setMagnitude(me,n.up,ue[1]),S.add(he,he,me),S.add(n.position,n.position,he),S.add(n.target,n.target,he),i.staticMoving?Fe.copy(E,M):(Fe.sub(ue,M,E),Fe.scale(ue,ue,i.dynamicDampingFactor),Fe.add(E,E,ue))}}function re(){var we=Math.min(Math.max(n.state.radiusMax*1e3,.01),i.maxDistance);S.squaredMagnitude(v)>we*we&&(S.setMagnitude(v,v,we),S.add(n.position,n.target,v),Fe.copy(w,T),Fe.copy(A,D)),S.squaredMagnitude(v)<i.minDistance*i.minDistance&&(S.setMagnitude(v,v,i.minDistance),S.add(n.position,n.target,v),Fe.copy(w,T),Fe.copy(A,D))}function ee(we,Ve){return we*=r.pixelRatio,Ve*=r.pixelRatio,we>o.x+o.width||r.height-Ve>o.y+o.height||we<o.x||r.height-Ve<o.y}var B=-1;function z(we){B!==we&&(B>0&&(i.animate.name==="spin"?Ye(we-B):i.animate.name==="rock"&&Ke(we-B)),S.sub(v,n.position,n.target),G(),X(),Y(),oe(),Pe(),S.add(n.position,n.target,v),re(),S.squaredDistance(p,n.position)>Ir&&S.copy(p,n.position),B=we)}function le(){S.copy(n.target,F),S.copy(n.position,O),S.copy(n.up,U),S.sub(v,n.position,n.target),S.copy(p,n.position)}function pe(we){var Ve=we.x,rt=we.y,ut=we.pageX,Ue=we.pageY,pt=we.buttons,mt=we.modifiers,wt=we.isStart,Z=ee(Ve,rt);if(!(wt&&Z)&&!(!wt&&!m)){m=!0,ht();var de=or.match(i.bindings.dragRotate,pt,mt),ye=or.match(i.bindings.dragRotateZ,pt,mt),He=or.match(i.bindings.dragPan,pt,mt),ot=or.match(i.bindings.dragZoom,pt,mt),ct=or.match(i.bindings.dragFocus,pt,mt),Ct=or.match(i.bindings.dragFocusZoom,pt,mt);if(Q(ut,Ue),q(ut,Ue),wt&&(de&&(Fe.copy(g,j),Fe.copy(h,g)),ye&&(Fe.copy(C,j),Fe.copy(x,C)),(ot||Ct)&&(Fe.copy(w,N),Fe.copy(T,w)),ct&&(Fe.copy(A,N),Fe.copy(D,A)),He&&(Fe.copy(E,N),Fe.copy(M,E))),de&&Fe.copy(g,j),ye&&Fe.copy(C,j),(ot||Ct)&&Fe.copy(T,N),ct&&Fe.copy(D,N),Ct){var vr=S.distance(n.state.position,n.state.target);n.setState({radius:vr/5})}He&&Fe.copy(M,N)}}function ge(){m=!1}function Ce(we){var Ve=we.x,rt=we.y,ut=we.spinX,Ue=we.spinY,pt=we.dz,mt=we.buttons,wt=we.modifiers;if(!ee(Ve,rt)){var Z=nj(ut*.075,Ue*.075,pt*1e-4);Z<-i.maxWheelDelta?Z=-i.maxWheelDelta:Z>i.maxWheelDelta&&(Z=i.maxWheelDelta),or.match(i.bindings.scrollZoom,mt,wt)&&(T[1]+=Z),or.match(i.bindings.scrollFocus,mt,wt)&&(D[1]+=Z)}}function Ie(we){var Ve=we.fractionDelta,rt=we.buttons,ut=we.modifiers;or.match(i.bindings.scrollZoom,rt,ut)&&(m=!0,T[1]+=i.gestureScaleFactor*Ve)}function Oe(we){var Ve=we.deltaScale;m=!0,T[1]+=i.gestureScaleFactor*Ve}function We(){s||(s=!0,u.unsubscribe(),l.unsubscribe(),f.unsubscribe(),d.unsubscribe(),c.unsubscribe())}var Ne=Fe.create(.005,0);function Ye(we){if(!(i.animate.name!=="spin"||i.animate.params.speed===0||m)){var Ve=i.animate.params.speed/1e3;Ne[0]=60*Math.min(Math.abs(we),1e3/8)/1e3*Ve,Fe.add(g,h,Ne)}}var Xe=0,Ze=Fe.create(.005,0);function Ke(we){if(!(i.animate.name!=="rock"||i.animate.params.speed===0||m)){var Ve=we/1e3*i.animate.params.speed,rt=pr(i.animate.params.angle)/J(),ut=Math.sin(Xe*Math.PI*2)*rt,Ue=Math.sin((Xe+Ve)*Math.PI*2)*rt;Ze[0]=Ue-ut,Fe.add(g,h,Ze),Xe+=Ve,Xe>=1&&(Xe=0)}}function ht(){Xe=0}function Ae(we){B=-1,z(we)}return{viewport:o,get isAnimating(){return i.animate.name!=="off"},get props(){return i},setProps:function(we){var Ve;((Ve=we.animate)===null||Ve===void 0?void 0:Ve.name)==="rock"&&i.animate.name!=="rock"&&ht(),Object.assign(i,we)},start:Ae,update:z,reset:le,dispose:We}}e.create=t})(jA||(jA={}));var Bb;(function(e){function t(){return{view:se.identity(),position:S.create(0,0,0),direction:S.create(0,0,-1),up:S.create(0,1,0)}}e.create=t;var r=S.zero();function n(a){S.add(r,a.position,a.direction),se.lookAt(a.view,a.position,r,a.up)}e.update=n})(Bb||(Bb={}));var Z0e=function(){function e(){this.removeList=G3(),this.removeMap=new Map,this.addList=G3(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),u0=new Ji("98");function HN(e,t,r){u0.reset();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var i=e[n].values.boundingSphere.ref.value;!i.radius||u0.includeSphere(i)}u0.finishedIncludeStep();for(var n=0,a=e.length;n<a;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;!o.radius||u0.radiusSphere(o)}return u0.getSphere(t)}function $0e(e,t){var r=(e.getProgram("colorBlended")||e.getProgram("colorWboit")).id,n=(t.getProgram("colorBlended")||e.getProgram("colorWboit")).id,a=e.materialId,i=t.materialId;return r!==n?r-n:a!==i?a-i:e.id-t.id}var Cp;(function(e){function t(r,n){n===void 0&&(n=q_);var a=new Map,i=[],o=Te(),s=Te(),u=[],c=[],l=!0,f=!0,d=Bb.create(),m=d.view,p=d.position,v=d.direction,h=d.up;function g(A){if(a.has(A))return console.warn("RenderObject with id '".concat(A.id,"' already present")),a.get(A);var D=zne(r,A,n);return i.push(D),A.type==="direct-volume"?c.push(D):u.push(D),a.set(A,D),l=!0,f=!0,D}function y(A){var D=a.get(A);D&&(D.dispose(),Ff(i,D),Ff(u,D),Ff(c,D),a.delete(A),l=!0,f=!0)}var b=100;function x(A){for(var D=en(),E=0;;){var M=C.tryGetRemove();if(!M)break;if(y(M),++E%b==0&&en()-D>A)return!1}for(;;){var M=C.tryGetAdd();if(!M)break;if(g(M),++E%b==0&&en()-D>A)return!1}return i.sort($0e),!0}var C=new Z0e,_=-1;function w(){for(var A=23,D=0,E=i.length;D<E;++D)!i[D].state.visible||(A=31*A+i[D].id|0);return A=nM(A),A===-1&&(A=0),A}function T(){var A=w();return A!==_?(f=!0,!0):!1}return{view:m,position:p,direction:v,up:h,renderables:i,primitives:{view:m,position:p,direction:v,up:h,renderables:u},volumes:{view:m,position:p,direction:v,up:h,renderables:c},syncVisibility:T,update:function(A,D){var E;if(Bb.update(d),A)for(var M=0,F=A.length;M<F;++M)(E=a.get(A[M]))===null||E===void 0||E.update();else for(var M=0,F=i.length;M<F;++M)i[M].update();D?T():(l=!0,f=!0)},add:function(A){return C.add(A)},remove:function(A){return C.remove(A)},commit:function(A){return A===void 0&&(A=Number.MAX_VALUE),x(A)},get needsCommit(){return!C.isEmpty},has:function(A){return a.has(A)},clear:function(){for(var A=0,D=i.length;A<D;++A)i[A].dispose();i.length=0,a.clear(),l=!0,f=!0},forEach:function(A){a.forEach(A)},get count(){return i.length},get boundingSphere(){return l&&(HN(i,o,!1),l=!1),o},get boundingSphereVisible(){return f&&(HN(i,s,!0),f=!1,_=w()),s}}}e.create=t})(Cp||(Cp={}));var WA=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=In.createDefaultSnapshot(),this._target=In.createDefaultSnapshot(),this._current=In.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&In.copySnapshot(this._source,this.camera.state),this.inTransition||In.copySnapshot(this._target,this.camera.state),In.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode!="undefined"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){In.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(!!this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),In.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=Gr.identity();function r(n,a,i,o){In.copySnapshot(n,o),Gr.slerp(t,Gr.Identity,Gr.rotationTo(t,i.up,o.up),a),S.transformQuat(n.up,i.up,t),S.lerp(n.target,i.target,o.target,a),S.lerp(n.position,i.position,o.position,a),n.radius=Xn(i.radius,o.radius,a),n.radiusMax=Xn(i.radiusMax,o.radiusMax,a),n.fov=Xn(i.fov,o.fov,a),n.fog=Xn(i.fog,o.fog,a)}e.defaultTransition=r})(WA||(WA={}));var qN=S(),jN=S(),Fb=Wt(),In=function(){function e(t,r,n){r===void 0&&(r=da.create(0,0,128,128)),n===void 0&&(n={}),this.view=se.identity(),this.projection=se.identity(),this.projectionView=se.identity(),this.inverseProjectionView=se.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new WA(this),this.stateChanged=new dl(this.state),this.prevProjection=se.identity(),this.prevView=se.identity(),this.deltaDirection=S(),this.newPosition=S(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window!="undefined"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){S.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){S.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){S.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*S.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,tge(this),this.state.mode){case"orthographic":J0e(this);break;case"perspective":ege(this);break;default:throw new Error("unknown camera mode")}var n=!se.areEqual(this.projection,this.prevProjection,Ir)||!se.areEqual(this.view,this.prevView,Ir);if(n){if(se.mul(this.projectionView,this.projection,this.view),!se.tryInvert(this.inverseProjectionView,this.projectionView))return se.copy(this.view,this.prevView),se.copy(this.projection,this.prevProjection),se.mul(this.projectionView,this.projection,this.view),!1;se.copy(this.prevView,this.view),se.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);S.sub(this.deltaDirection,this.target,this.position),a&&S.matchDirection(this.deltaDirection,a,this.deltaDirection),S.setMagnitude(this.deltaDirection,this.deltaDirection,o),S.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=S.clone(t),s.radius=i,s.position=S.clone(this.newPosition),n&&S.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,a){var i=Math.max(r,.01),o=this.getTargetDistance(i);S.copy(this.deltaDirection,a),S.setMagnitude(this.deltaDirection,this.deltaDirection,o),S.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=S.clone(t),s.radius=i,s.position=S.clone(this.newPosition),S.copy(s.up,n),s},e.prototype.focus=function(t,r,n,a,i){r>0&&this.setState(this.getFocus(t,r,a,i),n)},e.prototype.project=function(t,r){return X0e(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return Mb(t,r,this.viewport,this.inverseProjectionView)},e.prototype.getPixelSize=function(t){return this.project(Fb,t),this.unproject(qN,Fb),Fb[0]+=1,this.unproject(jN,Fb),S.distance(qN,jN)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,c,l,f,d,m,p){u.fullWidth=c,u.fullHeight=l,u.offsetX=f,u.offsetY=d,u.width=m,u.height=p}e.setViewOffset=r;function n(u,c){u.enabled=c.enabled,u.fullWidth=c.fullWidth,u.fullHeight=c.fullHeight,u.offsetX=c.offsetX,u.offsetY=c.offsetY,u.width=c.width,u.height=c.height}e.copyViewOffset=n;function a(u,c,l,f){var d=Math.max(u,.01),m=l/f,p=f<l?1:m;return Math.abs(d/p/Math.sin(c/2))}e.targetDistance=a;function i(){return{mode:"perspective",fov:Math.PI/4,position:S.create(0,0,100),up:S.create(0,1,0),target:S.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=i;function o(u,c){return c&&(typeof c.mode!="undefined"&&(u.mode=c.mode),typeof c.fov!="undefined"&&(u.fov=c.fov),typeof c.position!="undefined"&&S.copy(u.position,c.position),typeof c.up!="undefined"&&S.copy(u.up,c.up),typeof c.target!="undefined"&&S.copy(u.target,c.target),typeof c.radius!="undefined"&&(u.radius=c.radius),typeof c.radiusMax!="undefined"&&(u.radiusMax=c.radiusMax),typeof c.fog!="undefined"&&(u.fog=c.fog),typeof c.clipFar!="undefined"&&(u.clipFar=c.clipFar)),u}e.copySnapshot=o;function s(u,c){return u.mode===c.mode&&u.fov===c.fov&&u.radius===c.radius&&u.radiusMax===c.radiusMax&&u.fog===c.fog&&u.clipFar===c.clipFar&&S.exactEquals(u.position,c.position)&&S.exactEquals(u.up,c.up)&&S.exactEquals(u.target,c.target)}e.areSnapshotsEqual=s})(In||(In={}));function J0e(e){var t=e.viewport,r=e.zoom,n=e.near,a=e.far,i=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,c=-t.height/2,l=(s-o)/(2*r),f=(u-c)/(2*r),d=(s+o)/2,m=(u+c)/2,p=d-l,v=d+l,h=m+f,g=m-f;if(i.enabled){var y=r/(i.width/i.fullWidth),b=r/(i.height/i.fullHeight),x=(s-o)/i.width,C=(u-c)/i.height;p+=x*(i.offsetX/y),v=p+x*(i.width/y),h-=C*(i.offsetY/b),g=h-C*(i.height/b)}se.ortho(e.projection,p,v,h,g,n,a),se.lookAt(e.view,e.position,e.target,e.up)}function ege(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,a=e.viewOffset,i=r*Math.tan(.5*e.state.fov),o=2*i,s=t*o,u=-.5*s;a.enabled&&(u+=a.offsetX*s/a.fullWidth,i-=a.offsetY*o/a.fullHeight,s*=a.width/a.fullWidth,o*=a.height/a.fullHeight),se.perspective(e.projection,u,u+s,i,i-o,r,n),se.lookAt(e.view,e.position,e.target,e.up)}function tge(e){var t=e.state,r=t.radius,n=t.radiusMax,a=t.mode,i=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=S.distance(e.position,e.target),c=u-r,l=u+s,f=-(50-i)/50,d=u-s*f,m=l;c=Math.max(Math.min(n,5),c),l=Math.max(5,l),c===l&&(l=c+.01),e.near=c,e.far=2*l,e.fogNear=d,e.fogFar=m}var XA={sceneBoundingSpheres:P.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:P.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:P.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:P.Boolean(!1,{description:"Show bounding spheres of visible instances."})},rge=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Cp.create(t,y1),this.parent=r,this._props=I(I({},P.getDefaultValues(XA)),n)}return e.prototype.update=function(){var t=this,r=Ob(this.scene,this.parent.boundingSphere,this.sceneData,tr.lightgrey,age);r&&(this.sceneData=r);var n=Ob(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,tr.black,ige);n&&(this.visibleSceneData=n),this.parent.forEach(function(a,i){var o=t.objectsData.get(i),s=Ob(t.scene,a.values.boundingSphere.ref.value,o,tr.tomato,oge);s&&t.objectsData.set(i,s);var u=t.instancesData.get(i),c=Ob(t.scene,a.values.invariantBoundingSphere.ref.value,u,tr.skyblue,sge,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection});c&&t.instancesData.set(i,c)}),this.objectsData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.objectsData.delete(i))}),this.instancesData.forEach(function(a,i){t.parent.has(i)||(t.scene.remove(a.renderObject),t.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var a=t.objectsData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var i=t.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function Ob(e,t,r,n,a,i){if(!r||!Te.equals(r.boundingSphere,t)){var o=nge(t,r&&r.mesh),s=r?r.renderObject:uge(o,n,a,i);return r?R.updateIfChanged(s.values.drawCount,ya.getDrawCount(o)):e.add(s),{boundingSphere:Te.clone(t),renderObject:s,mesh:o}}}function nge(e,t){var r=2,n=b1(r),a=it.createState(n,n/2,t);if(e.radius&&(Kn(a,e.center,e.radius,r),Te.hasExtrema(e)))for(var i=0,o=e.extrema;i<o.length;i++){var s=o[i];Kn(a,s,1,0)}return it.getMesh(a)}var age=oc(),ige=oc(),oge=oc(),sge=oc();function uge(e,t,r,n){var a=At.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return np("mesh",a,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}var YA=S(),KA=S(),WN=S(),XN={maxFps:P.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:P.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})},cge=function(){function e(t,r,n,a,i){var o=this;i===void 0&&(i={}),this.canvasIdentify=t,this.lociGetter=r,this.input=n,this.camera=a,this.ev=Lu.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=Vt.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Sd.create(0),this.button=Sd.create(0),this.modifiers=Ts.None,this.props=I(I({},P.getDefaultValues(XN)),i),n.drag.subscribe(function(s){var u=s.x,c=s.y,l=s.buttons,f=s.button,d=s.modifiers;o.isInteracting=!0,o.drag(u,c,l,f,d)}),n.move.subscribe(function(s){var u=s.x,c=s.y,l=s.inside,f=s.buttons,d=s.button,m=s.modifiers;!l||o.isInteracting||o.move(u,c,f,d,m)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,c=s.y,l=s.buttons,f=s.button,d=s.modifiers;o.outsideViewport(u,c)||o.click(u,c,l,f,d)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Fe.create(this.startX,this.startY),pageEnd:Fe.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var a=this.canvasIdentify(this.endX,this.endY);this.id=a==null?void 0:a.id,this.position=a==null?void 0:a.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var i=this.getLoci(this.id,this.position);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Fe.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id,this.position);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Fe.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,Vt.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Vt.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,a,i){this.inside=!0,this.buttons=n,this.button=a,this.modifiers=i,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(1,0)},e.prototype.drag=function(t,r,n,a,i){this.endX=t,this.endY=r,this.buttons=n,this.button=a,this.modifiers=i,this.identify(2,0)},e.prototype.modify=function(t){Ts.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Fe.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,a=n.input,i=n.camera.viewport;return t*=a.pixelRatio,r*=a.pixelRatio,t>i.x+i.width||a.height-r>i.y+i.height||t<i.x||a.height-r<i.y},e.prototype.getLoci=function(t,r){var n,a=this.lociGetter(t),i=a.repr,o=a.loci;if(r&&i&&Pt.isLoci(o)&&o.bonds.length===2){var s=o.bonds[0],u=s.aUnit,c=s.aIndex;u.conformation.position(u.elements[c],YA),S.sub(WN,this.camera.state.position,this.camera.state.target),S.projectPointOnPlane(KA,r,WN,YA);var l=this.camera.getPixelSize(KA),f=i.theme.size.size(o.bonds[0])*((n=i.props.sizeFactor)!==null&&n!==void 0?n:1);if(i.props.lineSizeAttenuation===!1&&(f*=l/2),f+=this.props.preferAtomPixelPadding*l,S.distance(KA,YA)<f)return{repr:i,loci:Pt.toFirstStructureElementLoci(o)}}return{repr:i,loci:o}},e.prototype.dispose=function(){this.ev.dispose()},e}(),lge=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,fge=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,dge=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,mge=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb = mix(uOutlineColor, color.rgb, outline);
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,pge=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,vge={edgeThresholdMin:P.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:P.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:P.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:P.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},hge=function(){function e(t,r){this.webgl=t,this.renderable=bge(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){R.update(this.renderable.values.uTexSizeInv,Fe.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,a=r.edgeThresholdMin,i=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(R.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==a&&(u=!0),R.updateIfChanged(n.dEdgeThresholdMin,a),n.dEdgeThresholdMax.ref.value!==i&&(u=!0),R.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(u=!0),R.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),R.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),gge=I(I({},ua),{tColor:Lt("texture","rgba","ubyte","linear"),uTexSizeInv:Ee("v2"),dEdgeThresholdMin:Ot("number"),dEdgeThresholdMax:Ot("number"),dIterations:Ot("number"),dSubpixelQuality:Ot("number")}),yge=Qr("fxaa",Ka,pge);function bge(e,t){var r=t.getWidth(),n=t.getHeight(),a=I(I({},ca),{tColor:R.create(t),uTexSizeInv:R.create(Fe.create(1/r,1/n)),dEdgeThresholdMin:R.create(.0312),dEdgeThresholdMax:R.create(.125),dIterations:R.create(12),dSubpixelQuality:R.create(.3)}),i=I({},gge),o=zn(e,"triangles",yge,i,a);return Vn(o,a)}var xge=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Sge=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,Cge=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,_ge=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,wge=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Age=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,Tge={edgeThreshold:P.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:P.Numeric(16,{min:0,max:32,step:1})},Pge=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement=="undefined"){hr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),a=r.getHeight();this.edgesTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,a,!1,"uint8","linear"),this.edgesRenderable=Dge(t,r),this.weightsRenderable=Bge(t,this.edgesTarget.texture),this.blendRenderable=kge(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.disable(n.BLEND),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),R.update(this.edgesRenderable.values.uViewport,da.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),R.update(this.weightsRenderable.values.uViewport,da.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),R.update(this.blendRenderable.values.uViewport,da.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),a=this.edgesTarget.getHeight();(t!==n||r!==a)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),R.update(this.edgesRenderable.values.uTexSizeInv,Fe.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.weightsRenderable.values.uTexSizeInv,Fe.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.blendRenderable.values.uTexSizeInv,Fe.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(R.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(R.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(R.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(R.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),Ege=I(I({},ua),{tColor:Lt("texture","rgba","ubyte","linear"),uTexSizeInv:Ee("v2"),uViewport:Ee("v4"),dEdgeThreshold:Ot("number")}),Ige=Qr("smaa-edges",wge,Age);function Dge(e,t){var r=t.getWidth(),n=t.getHeight(),a=I(I({},ca),{tColor:R.create(t),uTexSizeInv:R.create(Fe.create(1/r,1/n)),uViewport:R.create(Wt()),dEdgeThreshold:R.create(.1)}),i=I({},Ege),o=zn(e,"triangles",Ige,i,a);return Vn(o,a)}var Mge=I(I({},ua),{tEdges:Lt("texture","rgba","ubyte","linear"),tArea:Lt("texture","rgb","ubyte","linear"),tSearch:Lt("texture","rgba","ubyte","nearest"),uTexSizeInv:Ee("v2"),uViewport:Ee("v4"),dMaxSearchSteps:Ot("number")}),Rge=Qr("smaa-weights",Cge,_ge);function Bge(e,t){var r=t.getWidth(),n=t.getHeight(),a=F_(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),i=F_(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=I(I({},ca),{tEdges:R.create(t),tArea:R.create(a),tSearch:R.create(i),uTexSizeInv:R.create(Fe.create(1/r,1/n)),uViewport:R.create(Wt()),dMaxSearchSteps:R.create(16)});mF(Lge(),o.tArea,a),mF(Nge(),o.tSearch,i);var s=I({},Mge),u=zn(e,"triangles",Rge,s,o);return Vn(u,o)}var Fge=I(I({},ua),{tColor:Lt("texture","rgba","ubyte","linear"),tWeights:Lt("texture","rgba","ubyte","linear"),uTexSizeInv:Ee("v2"),uViewport:Ee("v4")}),Oge=Qr("smaa-blend",xge,Sge);function kge(e,t,r){var n=t.getWidth(),a=t.getHeight(),i=I(I({},ca),{tColor:R.create(t),tWeights:R.create(r),uTexSizeInv:R.create(Fe.create(1/n,1/a)),uViewport:R.create(Wt())}),o=I({},Fge),s=zn(e,"triangles",Oge,o,i);return Vn(s,i)}function Lge(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function Nge(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var Uge=I(I({},ua),{tDepth:Lt("texture","rgba","ubyte","nearest"),uTexSize:Ee("v2"),dOrthographic:Ot("number"),uNear:Ee("f"),uFar:Ee("f"),uMaxPossibleViewZDiff:Ee("f")});function zge(e,t){var r=I(I({},ca),{tDepth:R.create(t),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight())),dOrthographic:R.create(0),uNear:R.create(1),uFar:R.create(1e4),uMaxPossibleViewZDiff:R.create(.5)}),n=I({},Uge),a=Qr("outlines",Ka,lge),i=zn(e,"triangles",a,n,r);return Vn(i,r)}var Vge=I(I({},ua),{tDepth:Lt("texture","rgba","ubyte","nearest"),uSamples:Ee("v3[]"),dNSamples:Ot("number"),uProjection:Ee("m4"),uInvProjection:Ee("m4"),uBounds:Ee("v4"),uTexSize:Ee("v2"),uRadius:Ee("f"),uBias:Ee("f")});function Gge(e,t){var r=I(I({},ca),{tDepth:R.create(t),uSamples:R.create([0,0,1]),dNSamples:R.create(32),uProjection:R.create(se.identity()),uInvProjection:R.create(se.identity()),uBounds:R.create(Wt()),uTexSize:R.create(Fe.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:R.create(8),uBias:R.create(.025)}),n=I({},Vge),a=Qr("ssao",Ka,fge),i=zn(e,"triangles",a,n,r);return Vn(i,r)}var Hge=I(I({},ua),{tSsaoDepth:Lt("texture","rgba","ubyte","nearest"),uTexSize:Ee("v2"),uKernel:Ee("f[]"),dOcclusionKernelSize:Ot("number"),uBlurDirectionX:Ee("f"),uBlurDirectionY:Ee("f"),uMaxPossibleViewZDiff:Ee("f"),uNear:Ee("f"),uFar:Ee("f"),uBounds:Ee("v4"),dOrthographic:Ot("number")});function YN(e,t,r){var n=I(I({},ca),{tSsaoDepth:R.create(t),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight())),uKernel:R.create([0]),dOcclusionKernelSize:R.create(15),uBlurDirectionX:R.create(r==="horizontal"?1:0),uBlurDirectionY:R.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:R.create(.5),uNear:R.create(0),uFar:R.create(1e4),uBounds:R.create(Wt()),dOrthographic:R.create(0)}),a=I({},Hge),i=Qr("ssao_blur",Ka,dge),o=zn(e,"triangles",i,a,n);return Vn(o,n)}function qge(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],a=0;a<r;a++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-a*a/(2*t*t)));return n}function jge(e,t){for(var r=[],n=0;n<t;n++){var a=(n*n+2*n+1)/(t*t);a=.1+a*(1-.1),r.push(e[n][0]*a),r.push(e[n][1]*a),r.push(e[n][2]*a)}return r}var Wge=I(I({},ua),{tSsaoDepth:Lt("texture","rgba","ubyte","nearest"),tColor:Lt("texture","rgba","ubyte","nearest"),tDepth:Lt("texture","rgba","ubyte","nearest"),tOutlines:Lt("texture","rgba","ubyte","nearest"),uTexSize:Ee("v2"),dOrthographic:Ot("number"),uNear:Ee("f"),uFar:Ee("f"),uFogNear:Ee("f"),uFogFar:Ee("f"),uFogColor:Ee("v3"),uOutlineColor:Ee("v3"),uTransparentBackground:Ee("b"),uMaxPossibleViewZDiff:Ee("f"),dOcclusionEnable:Ot("boolean"),dOutlineEnable:Ot("boolean"),dOutlineScale:Ot("number"),uOutlineThreshold:Ee("f")});function Xge(e,t,r,n,a){var i=I(I({},ca),{tSsaoDepth:R.create(a),tColor:R.create(t),tDepth:R.create(r),tOutlines:R.create(n),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight())),dOrthographic:R.create(0),uNear:R.create(1),uFar:R.create(1e4),uFogNear:R.create(1e4),uFogFar:R.create(1e4),uFogColor:R.create(S.create(1,1,1)),uOutlineColor:R.create(S.create(0,0,0)),uTransparentBackground:R.create(!1),uMaxPossibleViewZDiff:R.create(.5),dOcclusionEnable:R.create(!0),dOutlineEnable:R.create(!1),dOutlineScale:R.create(1),uOutlineThreshold:R.create(.33)}),o=I({},Wge),s=Qr("postprocessing",Ka,mge),u=zn(e,"triangles",s,o,i);return Vn(u,i)}var QA={occlusion:P.MappedStatic("on",{on:P.Group({samples:P.Numeric(32,{min:1,max:256,step:1}),radius:P.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:P.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:P.Numeric(15,{min:1,max:25,step:2})}),off:P.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:P.MappedStatic("off",{on:P.Group({scale:P.Numeric(1,{min:1,max:5,step:1}),threshold:P.Numeric(.33,{min:.01,max:1,step:.01}),color:P.Color(st(0))}),off:P.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:P.MappedStatic("smaa",{fxaa:P.Group(vge),smaa:P.Group(Tge),off:P.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},Sc=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,a=r.depthTexture,i=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(i,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(i,o,!1),this.outlinesRenderable=zge(t,a),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=S();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),S.normalize(u,u),S.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var c=Math.floor(i*this.ssaoScale),l=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(c,l),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(c,l),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=Gge(t,a),this.ssaoBlurFirstPassRenderable=YN(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=YN(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=Xge(t,n.texture,a,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1],o=this.calcSsaoScale();if(t!==a||r!==i||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),R.update(this.renderable.values.uTexSize,Fe.set(this.renderable.values.uTexSize.ref.value,t,r)),R.update(this.outlinesRenderable.values.uTexSize,Fe.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),R.update(this.ssaoRenderable.values.uTexSize,Fe.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),R.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Fe.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),R.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Fe.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,a){var i=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,c=a.outline.name==="on",l=a.occlusion.name==="on",f=se.identity();if(se.invert(f,t.projection),a.occlusion.name==="on"){R.update(this.ssaoRenderable.values.uProjection,t.projection),R.update(this.ssaoRenderable.values.uInvProjection,f);var d=this.renderable.values.uTexSize.ref.value,m=d[0],p=d[1],v=this.ssaoRenderable.values.uBounds,h=t.viewport,g=this.ssaoScale;if(Wt.set(v.ref.value,Math.floor(h.x*g)/(m*g),Math.floor(h.y*g)/(p*g),Math.ceil((h.x+h.width)*g)/(m*g),Math.ceil((h.y+h.height)*g)/(p*g)),R.update(v,v.ref.value),R.update(this.ssaoBlurFirstPassRenderable.values.uBounds,v.ref.value),R.update(this.ssaoBlurSecondPassRenderable.values.uBounds,v.ref.value),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==a.occlusion.params.samples&&(o=!0,this.nSamples=a.occlusion.params.samples,R.update(this.ssaoRenderable.values.uSamples,jge(this.randomHemisphereVector,this.nSamples)),R.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),R.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,a.occlusion.params.radius)),R.updateIfChanged(this.ssaoRenderable.values.uBias,a.occlusion.params.bias),this.blurKernelSize!==a.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=a.occlusion.params.blurKernelSize;var y=qge(this.blurKernelSize);R.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),R.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),R.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),R.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(a.outline.name==="on"){var b=a.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var x=Math.pow(1e3,b)/1e3,C=x*t.state.radiusMax,_=a.outline.params.scale-1;R.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),R.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),R.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,C),R.update(this.renderable.values.uOutlineColor,st.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,a.outline.params.color)),R.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,C),this.renderable.values.dOutlineScale.ref.value!==_&&(i=!0),R.updateIfChanged(this.renderable.values.dOutlineScale,_)}R.updateIfChanged(this.renderable.values.uFar,t.far),R.updateIfChanged(this.renderable.values.uNear,t.near),R.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),R.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),R.update(this.renderable.values.uFogColor,st.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),R.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(i=!0),R.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==c&&(i=!0),R.updateIfChanged(this.renderable.values.dOutlineEnable,c),this.renderable.values.dOcclusionEnable.ref.value!==l&&(i=!0),R.updateIfChanged(this.renderable.values.dOcclusionEnable,l),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),i&&this.renderable.update();var w=this.webgl,T=w.gl,A=w.state;A.enable(T.SCISSOR_TEST),A.disable(T.BLEND),A.disable(T.DEPTH_TEST),A.depthMask(!1);var D=t.viewport,E=D.x,M=D.y,F=D.width,O=D.height;T.viewport(E,M,F,O),T.scissor(E,M,F,O)},e.prototype.render=function(t,r,n,a,i){if(this.updateState(t,n,a,i),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,c=o.width,l=o.height,f=Math.floor(s*this.ssaoScale),d=Math.floor(u*this.ssaoScale),m=Math.ceil(c*this.ssaoScale),p=Math.ceil(l*this.ssaoScale);this.webgl.gl.viewport(f,d,m,p),this.webgl.gl.scissor(f,d,m,p),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,c,l),this.webgl.gl.scissor(s,u,c,l)}r?this.webgl.unbindFramebuffer():this.target.bind();var v=this.webgl,h=v.gl,g=v.state;g.clearColor(0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),this.renderable.render()},e}(),ZA=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,a=n.getWidth(),i=n.getHeight();this.target=t.createRenderTarget(a,i,!1),this.fxaa=new hge(t,this.target.texture),this.smaa=new Pge(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),a=this.target.texture.getHeight();(t!==n||r!==a)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var a=Sc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(a,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var a=Sc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(a,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),Yge=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,Kge=I(I({},ua),{tColor:Lt("texture","rgba","ubyte","nearest"),uTexSize:Ee("v2"),uWeight:Ee("f")}),Qge=Qr("compose",Ka,Yge);function Zge(e,t){var r=I(I({},ca),{tColor:R.create(t),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight())),uWeight:R.create(1)}),n=I({},Kge),a=zn(e,"triangles",Qge,n,r);return Vn(a,r)}var KN={mode:P.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:P.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."})},kb=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,a=n.colorBufferFloat,i=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),c=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,c,!1);var l=o&&s?"fp16":a&&i?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,c,!1,l),this.holdTarget=t.createRenderTarget(u,c,!1),this.compose=Zge(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),R.update(this.compose.values.uTexSize,Fe.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,a,i){return n.multiSample.mode==="temporal"&&!i?this.renderTemporalMultiSample(t,r,n,a):(this.renderMultiSample(r,a,n),-2)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n){var a=t.camera,i=this,o=i.compose,s=i.composeTarget,u=i.drawPass,c=i.webgl,l=c.gl,f=c.state,d=$A[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],m=a.viewport,p=m.x,v=m.y,h=m.width,g=m.height,y=1/d.length,b=1/32;a.viewOffset.enabled=!0,R.update(o.values.tColor,u.getColorTarget(n.postprocessing).texture),o.update();for(var x=0;x<d.length;++x){var C=d[x];In.setViewOffset(a.viewOffset,h,g,C[0],C[1],h,g),a.update();var _=-.5+(x+.5)/d.length,w=y+b*_;R.update(o.values.uWeight,w),u.render(t,n,!1),s.bind(),f.enable(l.BLEND),f.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),f.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE),f.disable(l.DEPTH_TEST),f.depthMask(!1),l.viewport(p,v,h,g),l.scissor(p,v,h,g),x===0&&(f.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)),o.render()}R.update(o.values.uWeight,1),R.update(o.values.tColor,s.texture),o.update(),this.bindOutputTarget(r),l.viewport(p,v,h,g),l.scissor(p,v,h,g),f.disable(l.BLEND),o.render(),a.viewOffset.enabled=!1,a.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,a){var i=r.camera,o=this,s=o.compose,u=o.composeTarget,c=o.holdTarget,l=o.drawPass,f=o.webgl,d=f.gl,m=f.state,p=$A[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(t===-2||t>=p.length)return-2;var v=i.viewport,h=v.x,g=v.y,y=v.width,b=v.height,x=1/p.length;if(t===-1)l.render(r,n,!1),R.update(s.values.uWeight,1),R.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),s.update(),c.bind(),m.disable(d.BLEND),m.disable(d.DEPTH_TEST),m.depthMask(!1),d.viewport(h,g,y,b),d.scissor(h,g,y,b),s.render(),t+=1;else{i.viewOffset.enabled=!0,R.update(s.values.tColor,l.getColorTarget(n.postprocessing).texture),R.update(s.values.uWeight,x),s.update();for(var C=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2)),_=0;_<C;++_){var w=p[t];if(In.setViewOffset(i.viewOffset,y,b,w[0],w[1],y,b),i.update(),l.render(r,n,!1),u.bind(),m.enable(d.BLEND),m.blendEquationSeparate(d.FUNC_ADD,d.FUNC_ADD),m.blendFuncSeparate(d.ONE,d.ONE,d.ONE,d.ONE),m.disable(d.DEPTH_TEST),m.depthMask(!1),d.viewport(h,g,y,b),d.scissor(h,g,y,b),t===0&&(m.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT)),s.render(),t+=1,t>=p.length)break}}this.bindOutputTarget(a),d.viewport(h,g,y,b),d.scissor(h,g,y,b);var T=t*x;return T>0&&(R.update(s.values.uWeight,1),R.update(s.values.tColor,u.texture),s.update(),m.disable(d.BLEND),s.render()),T<1&&(R.update(s.values.uWeight,1-T),R.update(s.values.tColor,c.texture),s.update(),T===0?m.disable(d.BLEND):m.enable(d.BLEND),s.render()),i.viewOffset.enabled=!1,i.update(),t>=p.length?-2:t},e}(),$A=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];$A.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var QN=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,a){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!a),this.sampleIndex<0},e}(),ZN={eyeSeparation:P.Numeric(.064,{min:.01,max:.5,step:.001}),focus:P.Numeric(10,{min:1,max:100,step:.01})},$ge=P.getDefaultValues(ZN),_p=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new $N,this.right=new $N,this.props=I(I({},$ge),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),Jge(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(_p||(_p={}));var $N=function(){function e(){this.viewport=da.create(0,0,0,0),this.view=se(),this.projection=se(),this.projectionView=se(),this.inverseProjectionView=se(),this.state=In.createDefaultSnapshot(),this.viewOffset=In.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),JN=se.identity(),e7=se.identity();function Jge(e,t,r,n){da.copy(r.viewport,e.viewport),se.copy(r.view,e.view),se.copy(r.projection,e.projection),In.copySnapshot(r.state,e.state),In.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,da.copy(n.viewport,e.viewport),se.copy(n.view,e.view),se.copy(n.projection,e.projection),In.copySnapshot(n.state,e.state),In.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var a=Math.floor(e.viewport.width/2),i=a/e.viewport.height;r.viewport.width=a,n.viewport.x+=a,n.viewport.width-=a;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),c,l;JN[12]=-o,e7[12]=o,c=-u*i+s,l=u*i+s,r.projection[0]=2*e.near/(l-c),r.projection[8]=(l+c)/(l-c),se.mul(r.view,r.view,JN),se.mul(r.projectionView,r.projection,r.view),se.invert(r.inverseProjectionView,r.projectionView),c=-u*i-s,l=u*i-s,n.projection[0]=2*e.near/(l-c),n.projection[8]=(l+c)/(l-c),se.mul(n.view,n.view,e7),se.mul(n.projectionView,n.projection,n.view),se.invert(n.inverseProjectionView,n.projectionView)}var JA=Math.pow(2,24)-2,eye=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var a=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*a),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*a),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,a,i,o){var s=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,i,null,o),t.renderPick(n.volumes,r,i,s,o),t.renderPick(a.handle.scene,r,i,null,o),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderPick(a.camera.scene,a.camera.camera,i,null,o))},e.prototype.render=function(t,r,n,a){this.objectPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",1),this.instancePickTarget.bind(),this.renderVariant(t,r,n,a,"pick",2),this.groupPickTarget.bind(),this.renderVariant(t,r,n,a,"pick",3),this.depthPickTarget.bind(),this.renderVariant(t,r,n,a,"depth",0)},e}(),tye=function(){function e(t,r,n,a,i,o,s){s===void 0&&(s=1),this.webgl=t,this.renderer=r,this.scene=n,this.helper=a,this.pickPass=i,this.pickPadding=s,this.dirty=!0,this.viewport=da(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,a){da.set(this.viewport,t,r,n,a),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var i=Math.floor(n*this.pickScale),o=Math.floor(a*this.pickScale);(i!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=aj(Math.round(this.pickScale*this.pickPadding))},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,a=t.pickWidth,i=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,a,i,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),a=this.depthBuffer;return j$(a[n],a[n+1],a[n+2],a[n+3])},e.prototype.getId=function(t,r,n){var a=this.getBufferIdx(t,r);return C_(n[a],n[a+1],n[a+2])},e.prototype.render=function(t){var r=this,n=r.pickX,a=r.pickY,i=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,c=u.renderer,l=u.scene,f=u.helper;c.setTransparentBackground(!1),c.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),c.setPixelRatio(this.pickScale),_p.is(t)?(c.setViewport(n,a,s,o),this.pickPass.render(c,t.left,l,f),c.setViewport(n+s,a,i-s,o),this.pickPass.render(c,t.right,l,f)):(c.setViewport(n,a,i,o),this.pickPass.render(c,t,l,f)),this.dirty=!1},e.prototype.identifyInternal=function(t,r,n){var a=this,i=a.webgl,o=a.pickScale;if(!i.isContextLost){t*=i.pixelRatio,r*=i.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,c=r-s.y,l=Math.floor(u*o),f=Math.floor(c*o),d=this.getId(l,f,this.objectBuffer);if(!(d===-1||d===JA)){var m=this.getId(l,f,this.instanceBuffer);if(!(m===-1||m===JA)){var p=this.getId(l,f,this.groupBuffer);if(!(p===-1||p===JA)){var v=this.getDepth(l,f),h=S.create(t,s.height-r,v);if(_p.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(h[0]=s.x+(u-g)*2,Mb(h,h,s,n.right.inverseProjectionView)):(h[0]=s.x+u*2,Mb(h,h,s,n.left.inverseProjectionView))}else Mb(h,h,s,n.inverseProjectionView);return{id:{objectId:d,instanceId:m,groupId:p},position:h}}}}}}},e.prototype.identify=function(t,r,n){for(var a=0,i=this.spiral;a<i.length;a++){var o=i[a],s=this.identifyInternal(t+o[0],r+o[1],n);if(s)return s}},e}(),rye=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,nye=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,aye=I(I({},ua),{tWboitA:Lt("texture","rgba","float","nearest"),tWboitB:Lt("texture","rgba","float","nearest"),uTexSize:Ee("v2")}),iye=Qr("evaluate-wboit",Ka,nye);function oye(e,t,r){var n=I(I({},ca),{tWboitA:R.create(t),tWboitB:R.create(r),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight()))}),a=I({},aye),i=zn(e,"triangles",iye,a,n);return Vn(i,n)}var sye=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var a=t.resources;this.textureA=a.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=a.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=oye(t,this.textureA,this.textureB),this.framebuffer=a.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,a=n[0],i=n[1];(t!==a||r!==i)&&(this.textureA.define(t,r),this.textureB.define(t,r),R.update(this.renderable.values.uTexSize,Fe.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,a=r.textureFloat,i=r.colorBufferFloat,o=r.depthTexture;if(!a||!i||!o||!n){if(hr){var s=[];a||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'.concat(s.join('", "'),'" extensions required for "wboit"'))}return!1}else return!0},e}(),uye=`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`,cye=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`,t7={enabled:P.Boolean(!0),highlightEdgeColor:P.Color(st.darken(st.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:P.Color(st.darken(st.fromNormalizedRgb(.2,1,.1),1)),edgeScale:P.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),ghostEdgeStrength:P.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:P.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},r7=function(){function e(t,r,n){this.webgl=t,this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=dye(t,this.maskTarget.texture),this.overlay=vye(t,this.edgesTarget.texture)}return e.isEnabled=function(t){return t.enabled},e.prototype.setEdgeState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.ONE,n.ONE),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u),a.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setOverlayState=function(t){var r=this.webgl,n=r.gl,a=r.state;a.enable(n.SCISSOR_TEST),a.enable(n.BLEND),a.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),a.blendEquation(n.FUNC_ADD),a.disable(n.DEPTH_TEST),a.depthMask(!1);var i=t.x,o=t.y,s=t.width,u=t.height;n.viewport(i,o,s,u),n.scissor(i,o,s,u)},e.prototype.setSize=function(t,r){var n=this.depthTarget.getWidth(),a=this.depthTarget.getHeight();(t!==n||r!==a)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),R.update(this.edge.values.uTexSizeInv,Fe.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),R.update(this.overlay.values.uTexSizeInv,Fe.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t){var r=t.highlightEdgeColor,n=t.selectEdgeColor,a=t.edgeScale,i=t.innerEdgeFactor,o=t.ghostEdgeStrength,s=this.edge.values,u=Math.round(a*this.webgl.pixelRatio);s.dEdgeScale.ref.value!==u&&(R.update(s.dEdgeScale,u),this.edge.update());var c=this.overlay.values;R.update(c.uHighlightEdgeColor,st.toVec3Normalized(c.uHighlightEdgeColor.ref.value,r)),R.update(c.uSelectEdgeColor,st.toVec3Normalized(c.uSelectEdgeColor.ref.value,n)),R.update(c.uInnerEdgeFactor,i),R.update(c.uGhostEdgeStrength,o)},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render()},e}(),lye=I(I({},ua),{tMaskTexture:Lt("texture","rgba","ubyte","linear"),uTexSizeInv:Ee("v2"),dEdgeScale:Ot("number")}),fye=Qr("edge",Ka,cye);function dye(e,t){var r=t.getWidth(),n=t.getHeight(),a=I(I({},ca),{tMaskTexture:R.create(t),uTexSizeInv:R.create(Fe.create(1/r,1/n)),dEdgeScale:R.create(1)}),i=I({},lye),o=zn(e,"triangles",fye,i,a);return Vn(o,a)}var mye=I(I({},ua),{tEdgeTexture:Lt("texture","rgba","ubyte","linear"),uTexSizeInv:Ee("v2"),uHighlightEdgeColor:Ee("v3"),uSelectEdgeColor:Ee("v3"),uGhostEdgeStrength:Ee("f"),uInnerEdgeFactor:Ee("f")}),pye=Qr("overlay",Ka,uye);function vye(e,t){var r=t.getWidth(),n=t.getHeight(),a=I(I({},ca),{tEdgeTexture:R.create(t),uTexSizeInv:R.create(Fe.create(1/r,1/n)),uHighlightEdgeColor:R.create(S()),uSelectEdgeColor:R.create(S()),uGhostEdgeStrength:R.create(0),uInnerEdgeFactor:R.create(0)}),i=I({},mye),o=zn(e,"triangles",pye,i,a);return Vn(o,a)}var hye=I(I({},ua),{tDepthPrimitives:Lt("texture","depth","ushort","nearest"),tDepthVolumes:Lt("texture","depth","ushort","nearest"),uTexSize:Ee("v2"),dPackedDepth:Ot("boolean")}),gye=Qr("depth-merge",Ka,rye);function yye(e,t,r,n){var a=I(I({},ca),{tDepthPrimitives:R.create(t),tDepthVolumes:R.create(r),uTexSize:R.create(Fe.create(t.getWidth(),t.getHeight())),dPackedDepth:R.create(n)}),i=I({},hye),o=zn(e,"triangles",gye,i,a);return Vn(o,a)}var n7=function(){function e(t,r,n,a){this.webgl=t;var i=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=pte(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!i.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=yye(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=a?new sye(t,r,n):void 0,this.marking=new r7(t,r,n),this.postprocessing=new Sc(t,this),this.antialiasing=new ZA(t,this),this.copyFboTarget=VF(t,this.colorTarget.texture),this.copyFboPostprocessing=VF(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!((t=this.wboit)===null||t===void 0?void 0:t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,a=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==a||r!==i)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),R.update(this.depthMerge.values.uTexSize,Fe.set(this.depthMerge.values.uTexSize.ref.value,t,r)),R.update(this.copyFboTarget.values.uTexSize,Fe.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),R.update(this.copyFboPostprocessing.values.uTexSize,Fe.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),((n=this.wboit)===null||n===void 0?void 0:n.supported)&&this.wboit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,a,i){var o;if(!((o=this.wboit)===null||o===void 0?void 0:o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),Sc.isEnabled(i)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,i),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),Sc.isEnabled(i)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,a,i,o){if(a?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!a){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),Sc.isEnabled(o)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=Sc.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,a,i,o){var s=n.volumes.renderables.length>0,u=Sc.isEnabled(o.postprocessing),c=ZA.isEnabled(o.postprocessing),l=r7.isEnabled(o.marking),f=r.viewport,d=f.x,m=f.y,p=f.width,v=f.height;if(t.setViewport(d,m,p,v),t.update(r),o.transparentBackground&&!c&&i&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o.transparentBackground,o.postprocessing):this._renderBlended(t,r,n,!s&&!u&&!c&&i,o.transparentBackground,o.postprocessing),u?this.postprocessing.target.bind():!i||s||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),l){var h=o.marking.ghostEdgeStrength<1;h&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,h?this.marking.depthTarget.texture:null),this.marking.update(o.marking),this.marking.render(r.viewport,u?this.postprocessing.target:this.colorTarget)}a.debug.isEnabled&&(a.debug.syncVisibility(),t.renderBlended(a.debug.scene,r,null)),a.handle.isEnabled&&t.renderBlended(a.handle.scene,r,null),a.camera.isEnabled&&(a.camera.update(r),t.update(a.camera.camera),t.renderBlended(a.camera.scene,a.camera.camera,null)),c?this.antialiasing.render(r,i,o.postprocessing):i&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),u?this.copyFboPostprocessing.render():(s||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n){var a=t.renderer,i=t.camera,o=t.scene,s=t.helper;a.setTransparentBackground(r.transparentBackground),a.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),a.setPixelRatio(this.webgl.pixelRatio),_p.is(i)?(this._render(a,i.left,o,s,n,r),this._render(a,i.right,o,s,n,r)):this._render(a,i,o,s,n,r)},e.prototype.getColorTarget=function(t){return ZA.isEnabled(t)?this.antialiasing.target:Sc.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),bye=I(I({},At.Params),{alpha:I(I({},At.Params.alpha),{defaultValue:.51}),ignoreLight:I(I({},At.Params.ignoreLight),{defaultValue:!0}),colorX:P.Color(tr.red,{isEssential:!0}),colorY:P.Color(tr.green,{isEssential:!0}),colorZ:P.Color(tr.blue,{isEssential:!0}),scale:P.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),Lb={axes:P.MappedStatic("on",{on:P.Group(bye),off:P.Group({})},{cycle:!0,description:"Show camera orientation axes"})},a7=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(a,i){if(!n.renderObject||!eT(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,c=0,l=u;c<l.length;c++){var f=l[c],d=f.groupId,m=f.instanceId,p=m*s+d;i(Se.ofSingleton(p))&&(o=!0)}return o},this.scene=Cp.create(t,y1),this.camera=new In,S.set(this.camera.up,0,1,0),S.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Lf(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var a=I(I({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=Aye(a),r.scene.add(r.renderObject),r.scene.commit(),S.set(r.camera.position,0,0,a.scale*200),se.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=I({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?ur:Sye(this,n,a)},e.prototype.mark=function(t,r){return!$a.is($a.Highlighting,r)||!eT(t)||t.data!==this?!1:Kt.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(!!this.renderObject){Cye(this.camera,t.viewport,t.viewOffset),se.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;se.setTranslation(this.scene.view,S.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function xye(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function Sye(e,t,r){return mb("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return xye(t)})}function eT(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function Cye(e,t,r){var n=e.near,a=e.far,i=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,c=(o-i)/2,l=(s-u)/2,f=(o+i)/2,d=(s+u)/2,m=f-c,p=f+c,v=d+l,h=d-l;if(r.enabled){var g=(o-i)/r.width,y=(s-u)/r.height;m+=g*r.offsetX,p=m+g*r.width,v-=y*r.offsetY,h=v-y*r.height}se.ortho(e.projection,m,p,v,h,n,a)}function _ye(e,t){var r=it.createState(512,256,t),n=.075*e,a=S.scale(S(),S.unitX,e),i=S.scale(S(),S.unitY,e),o=S.scale(S(),S.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,Kn(r,S.origin,n,2),r.currentGroup=1,Kn(r,a,n,2),la(r,S.origin,a,1,s),r.currentGroup=2,Kn(r,i,n,2),la(r,S.origin,i,1,s),r.currentGroup=3,Kn(r,o,n,2),la(r,S.origin,o,1,s),S.scale(a,a,.5),S.scale(i,i,.5),S.scale(o,o,.5),r.currentGroup=4,it.addTriangle(r,S.origin,a,i),it.addTriangle(r,S.origin,i,a);var u=S.add(S(),a,i);it.addTriangle(r,u,a,i),it.addTriangle(r,u,i,a),r.currentGroup=5,it.addTriangle(r,S.origin,a,o),it.addTriangle(r,S.origin,o,a);var c=S.add(S(),a,o);it.addTriangle(r,c,a,o),it.addTriangle(r,c,o,a),r.currentGroup=6,it.addTriangle(r,S.origin,i,o),it.addTriangle(r,S.origin,o,i);var l=S.add(S(),i,o);return it.addTriangle(r,l,i,o),it.addTriangle(r,l,o,i),it.getMesh(r)}function wye(e,t){var r=100*e.scale,n=_ye(r,t==null?void 0:t.geometry);n.setBoundingSphere(Te.create(S.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return tr.grey}};return fr.create("axes",{},n,a,function(){return 1},function(){return""})}function Aye(e){var t=wye(e);return fr.createRenderObject(t,e)}var Tye={transparentBackground:P.Boolean(!1),multiSample:P.Group(KN),postprocessing:P.Group(QA),marking:P.Group(t7),cameraHelper:P.Group(Lb)},Pye=function(){function e(t,r,n,a,i,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=a,this._width=0,this._height=0,this._camera=new In,this.props=I(I({},P.getDefaultValues(Tye)),s),this.drawPass=new n7(t,128,128,o),this.multiSamplePass=new kb(t,this.drawPass),this.multiSampleHelper=new QN(this.multiSamplePass),this.helper={camera:new a7(t,this.props.cameraHelper),debug:i.debug,handle:i.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){In.copySnapshot(this._camera.state,this.camera.state),da.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();var t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};kb.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var a,i;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(a=n==null?void 0:n.width)!==null&&a!==void 0?a:t,s=(i=n==null?void 0:n.height)!==null&&i!==void 0?i:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var c=Kf.create(u,o,s);return Kf.flipY(c),Kf.divideByAlpha(c),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),Eye=I(I({},At.Params),{alpha:I(I({},At.Params.alpha),{defaultValue:1}),ignoreLight:I(I({},At.Params.ignoreLight),{defaultValue:!0}),colorX:P.Color(tr.red,{isEssential:!0}),colorY:P.Color(tr.green,{isEssential:!0}),colorZ:P.Color(tr.blue,{isEssential:!0}),scale:P.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),i7={handle:P.MappedStatic("off",{on:P.Group(Eye),off:P.Group({})},{cycle:!0,description:"Show handle tool"})},Iye=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=se(),this.eachGroup=function(a,i){if(!n.renderObject||!o7(a))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=a.elements,c=0,l=u;c<l.length;c++){var f=l[c],d=f.groupId,m=f.instanceId,p=m*s+d;i(Se.ofSingleton(p))&&(o=!0)}return o},this.scene=Cp.create(t,y1),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Te.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),se.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Te.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Lf(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var a=I(I({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=Bye(a),r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=I({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){!this.renderObject||(se.setTranslation(this.renderObject.values.aTransform.ref.value,r),se.fromMat3(this.renderObject.values.aTransform.ref.value,n),R.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,a=t.instanceId;return!this.renderObject||r!==this.renderObject.id?ur:Mye(this,n,a)},e.prototype.mark=function(t,r){return!$a.is($a.Highlighting,r)||!o7(t)||t.data!==this?!1:Kt.mark(this.renderObject,t,r,this.eachGroup)},e}();function Dye(e,t){var r=it.createState(512,256,t),n=.05*e,a=S.scale(S(),S.unitX,e),i=S.scale(S(),S.unitY,e),o=S.scale(S(),S.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=Cd.TranslateScreenXY,Kn(r,S.origin,n*3,2),r.currentGroup=Cd.TranslateObjectX,Kn(r,a,n,2),la(r,S.origin,a,1,s),r.currentGroup=Cd.TranslateObjectY,Kn(r,i,n,2),la(r,S.origin,i,1,s),r.currentGroup=Cd.TranslateObjectZ,Kn(r,o,n,2),la(r,S.origin,o,1,s),it.getMesh(r)}var Cd={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function Mye(e,t,r){return mb("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id ".concat(t," | Instance Id ").concat(r)})}function o7(e){return e.kind==="data-loci"&&e.tag==="handle"}function Rye(e,t){var r=10*e.scale,n=Dye(r,t==null?void 0:t.geometry);n.setBoundingSphere(Te.create(S.create(r/2,r/2,r/2),r+r/4));var a=function(i){switch(i){case Cd.TranslateObjectX:return e.colorX;case Cd.TranslateObjectY:return e.colorY;case Cd.TranslateObjectZ:return e.colorZ;default:return tr.grey}};return fr.create("handle",{},n,a,function(){return 1},function(){return""})}function Bye(e){var t=Rye(e);return fr.createRenderObject(t,e)}var Fye={debug:P.Group(XA),camera:P.Group({helper:P.Group(Lb)}),handle:P.Group(i7)},Oye=P.getDefaultValues(Fye),kye=function(){function e(t,r,n){n===void 0&&(n={});var a=I(I({},Oye),n);this.debug=new rge(t,r,a.debug),this.camera=new a7(t,a.camera.helper),this.handle=new Iye(t,a.handle)}return e}(),Lye=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new n7(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new eye(t,this.draw,r.pickScale||.25),this.multiSample=new kb(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),s7={camera:P.Group({mode:P.Select("perspective",P.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:P.Group(Lb,{isFlat:!0}),stereo:P.MappedStatic("off",{on:P.Group(ZN),off:P.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:P.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:P.MappedStatic("on",{on:P.Group({intensity:P.Numeric(15,{min:1,max:100,step:1})}),off:P.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:P.Group({radius:P.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:P.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:P.MappedStatic("canvas",{canvas:P.Group({}),"static-frame":P.Group({x:P.Numeric(0),y:P.Numeric(0),width:P.Numeric(128),height:P.Numeric(128)}),"relative-frame":P.Group({x:P.Numeric(.33,{min:0,max:1,step:.01}),y:P.Numeric(.33,{min:0,max:1,step:.01}),width:P.Numeric(.5,{min:.01,max:1,step:.01}),height:P.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:P.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:P.Boolean(!1),multiSample:P.Group(KN),postprocessing:P.Group(QA),marking:P.Group(t7),renderer:P.Group(GA),trackball:P.Group(GN),interaction:P.Group(XN),debug:P.Group(XA),handle:P.Group(i7)},tT=P.getDefaultValues(s7),rT;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,pickPadding:1,enableWboit:!0,preferWebGl1:!1};function t(r,n){n===void 0&&(n={});var a=I(I({},e.DefaultAttribs),n),i=a.antialias,o=a.preserveDrawingBuffer,s=a.pixelScale,u=a.preferWebGl1,c=vte(r,{antialias:i,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:u});if(c===null)throw new Error("Could not create a WebGL rendering context");var l=VA.fromElement(r,{pixelScale:s,preventGestures:!0}),f=xte(c,{pixelScale:s}),d=new Lye(f,n);if(hr){var m=c.getExtension("WEBGL_lose_context");m&&r.addEventListener("mousedown",function(g){f.isContextLost||!g.shiftKey||!g.ctrlKey||!g.altKey||(hr&&console.log("lose context"),m.loseContext(),setTimeout(function(){!f.isContextLost||(hr&&console.log("restore context"),m.restoreContext())},1e3))},!1)}var p=new dl(0),v=function(g){f.setContextLost(),g.preventDefault(),hr&&console.log("context lost"),p.next(en())},h=function(){!f.isContextLost||(f.handleContextRestored(function(){d.draw.reset()}),hr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",v,!1),r.addEventListener("webglcontextrestored",h,!1),{canvas:r,webgl:f,input:l,passes:d,attribs:a,contextLost:p,contextRestored:f.contextRestored,dispose:function(g){l.dispose(),r.removeEventListener("webglcontextlost",v,!1),r.removeEventListener("webglcontextrestored",h,!1),f.destroy(g)}}}e.fromCanvas=t})(rT||(rT={}));var Nye=typeof window!="undefined"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},Uye=typeof window!="undefined"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},nT;(function(e){function t(r,n){var a=r.webgl,i=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=I(I({},tT),n),c=new Map,l=new Map,f=new dl(0),d=en(),m=new dl(0),p=new dl(0),v=a.gl,h=a.contextRestored,g=0,y=0,b=128,x=128;Ke();var C=Cp.create(a,o.draw.wboitEnabled?Tre:y1),_=new In({position:S.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:x},{pixelScale:s.pixelScale}),w=new _p(_,u.camera.stereo.params),T=jA.create(i,_,u.trackball),A=qA.create(a,u.renderer),D=new kye(a,C,u),E=new tye(a,A,C,D,o.pick,{x:g,y,width:b,height:x},s.pickPadding),M=new cge(he,Q,i,_,u.interaction),F=new QN(o.multiSample),O=!1,U=void 0,N=void 0,q=!1,j=!0;function Q(Ae){var we=ur,Ve=Vt.Empty;if(Ae){var rt=D.camera.getLoci(Ae);if(rt!==ur)return{loci:rt,repr:Ve};we=D.handle.getLoci(Ae),c.forEach(function(ut,Ue){var pt=Ue.getLoci(Ae);Ja(pt)||(Ja(we)||console.warn("found another loci, this should not happen"),we=pt,Ve=Ue)})}return{loci:we,repr:Ve}}function J(Ae,we,Ve){Ve===void 0&&(Ve=!1);var rt=Ae.repr,ut=Ae.loci,Ue=!1;if(rt?Ue=rt.mark(ut,we):(Ue=D.handle.mark(ut,we),Ue=D.camera.mark(ut,we)||Ue,c.forEach(function(mt,wt){Ue=wt.mark(ut,we)||Ue})),Ue)if(Ve)K=!0;else{C.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var pt=E.dirty;V({force:!0,allowMulti:!0}),E.dirty=pt}}function te(Ae,we){if(a.isContextLost)return!1;var Ve=!1;if(q&&(Ze(!1),q=!1,Ve=!0),g>v.drawingBufferWidth||g+b<0||y>v.drawingBufferHeight||y+x<0)return!1;var rt=!1;T.update(W);var ut=_.update(),Ue=Ae||ut||Ve||K;K=!1;var pt=F.update(Ue,u.multiSample);if(Ue||pt){var mt=_;u.camera.stereo.name==="on"&&(w.update(),mt=w);var wt={renderer:A,camera:mt,scene:C,helper:D};if(kb.isEnabled(u.multiSample)){var Z=!ut&&we&&!T.isAnimating;F.render(wt,u,!0,Z)}else o.draw.render(wt,u,!0);E.dirty=!0,rt=!0}return rt}var K=!1,L=!1,W=0,k=!1;function V(Ae){k||te(!!(Ae==null?void 0:Ae.force),!!(Ae==null?void 0:Ae.allowMulti))&&j&&m.next(en()-d)}function G(){K=!0}var H=0;function X(Ae,we){W=Ae,Pe(we==null?void 0:we.isSynchronous),_.transition.tick(W),!(we==null?void 0:we.manualDraw)&&(V(),!_.transition.inTransition&&!a.isContextLost&&M.tick(W))}function Y(){X(en()),H=Nye(Y)}function oe(Ae){d=Ae,T.start(Ae)}function ue(){k=!1,T.start(en()),H===0&&Y()}function me(Ae){Ae===void 0&&(Ae=!1),k=Ae,Uye(H),H=0}function he(Ae,we){var Ve=u.camera.stereo.name==="on"?w:_;return a.isContextLost?void 0:E.identify(Ae,we,Ve)}function Pe(Ae){Ae===void 0&&(Ae=!1);var we=pe(Ae);we&&(re(),L&&(D.debug.isEnabled&&D.debug.update(),V({force:!0}),L=!1),p.next(en()))}function re(){if(!!O){var Ae=C.boundingSphereVisible,we=Ae.center,Ve=Ae.radius,rt=T.props.autoAdjustMinMaxDistance;if(rt.name==="on"){var ut=rt.params.minDistanceFactor*Ve+rt.params.minDistancePadding,Ue=Math.max(rt.params.maxDistanceFactor*Ve,rt.params.maxDistanceMin);T.setProps({minDistance:ut,maxDistance:Ue})}if(Ve>0){var pt=U===void 0?u.cameraResetDurationMs:U,mt=_.getFocus(we,Ve),wt=typeof N=="function"?N(C,_):N,Z=wt?I(I({},mt),wt):mt;_.setState(I(I({},Z),{radiusMax:C.boundingSphere.radius}),pt)}U=void 0,N=void 0,O=!1}}var ee=Te(),B=Te();function z(){if(_.state.radiusMax===0)return!0;if(_.transition.inTransition||N)return!1;var Ae=!0,we=!0;Te.set(B,_.state.target,_.state.radius);for(var Ve=0,rt=C.renderables;Ve<rt.length;Ve++){var ut=rt[Ve];if(!!ut.state.visible){var Ue=ut.values.boundingSphere.ref.value;if(!!Ue.radius){we=!1;var pt=S.distance(B.center,Ue.center);if((pt>B.radius||pt>Ue.radius||Ue.radius>_.state.radiusMax)&&!Te.includes(ee,Ue))return!0;Te.overlaps(B,Ue)&&(Ae=!1)}}}return Ae||!we&&B.radius<=.1}var le=250;function pe(Ae){return C.needsCommit?(Te.copy(ee,C.boundingSphereVisible),C.commit(Ae?void 0:le)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(f.value===0||z())&&(O=!0),ee.radius===0&&(U=0),_.setState({radiusMax:C.boundingSphere.radius},0),f.next(c.size),hr&&ge(),!0):!1):!0}function ge(){console.table(C.renderables.map(function(ut){return{drawCount:ut.values.drawCount.ref.value,instanceCount:ut.values.instanceCount.ref.value,materialId:ut.materialId,renderItemId:ut.id}})),console.log(a.stats);var Ae=a.resources.getByteCounts(),we=Ae.texture,Ve=Ae.attribute,rt=Ae.elements;console.log({texture:"".concat((we/1024/1024).toFixed(3)," MiB"),attribute:"".concat((Ve/1024/1024).toFixed(3)," MiB"),elements:"".concat((rt/1024/1024).toFixed(3)," MiB")})}function Ce(Ae){Oe(Ae);var we=c.get(Ae),Ve=new Set;Ae.renderObjects.forEach(function(rt){return Ve.add(rt)}),we?Cn.areEqual(Ve,we)||(Ve.forEach(function(rt){we.has(rt)||C.add(rt)}),we.forEach(function(rt){Ve.has(rt)||C.remove(rt)})):Ae.renderObjects.forEach(function(rt){return C.add(rt)}),c.set(Ae,Ve),C.update(Ae.renderObjects,!1),L=!0,hr&&ge()}function Ie(Ae){We(Ae);var we=c.get(Ae);we&&(we.forEach(function(Ve){return C.remove(Ve)}),c.delete(Ae),L=!0,hr&&ge())}function Oe(Ae){l.has(Ae)||l.set(Ae,Ae.updated.subscribe(function(we){Ae.state.syncManually||Ce(Ae)}))}function We(Ae){var we=l.get(Ae);we&&(we.unsubscribe(),l.delete(Ae))}function Ne(){var Ae=C.boundingSphere.radius>0?100-Math.round(_.transition.target.radius/C.boundingSphere.radius*100):0;return{camera:{mode:_.state.mode,helper:I({},D.camera.props),stereo:I({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:_.state.fog>0?{name:"on",params:{intensity:_.state.fog}}:{name:"off",params:{}},cameraClipping:{far:_.state.clipFar,radius:Ae},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:I({},u.postprocessing),marking:I({},u.marking),multiSample:I({},u.multiSample),renderer:I({},A.props),trackball:I({},T.props),interaction:I({},M.props),debug:I({},D.debug.props),handle:I({},D.handle.props)}}var Ye=h.subscribe(function(){E.dirty=!0,V({force:!0}),V({force:!0})}),Xe=new dl(0);function Ze(Ae){Ae===void 0&&(Ae=!0),o.updateSize(),Ke(),ht(),Ae&&G(),Xe.next(+new Date)}return{webgl:a,add:Ce,remove:Ie,commit:Pe,update:function(Ae,we){if(Ae){if(!c.has(Ae))return;C.update(Ae.renderObjects,!!we)}else C.update(void 0,!!we);L=!0},clear:function(){l.forEach(function(Ae){return Ae.unsubscribe()}),l.clear(),c.clear(),C.clear(),D.debug.clear(),G(),f.next(c.size)},syncVisibility:function(){_.state.radiusMax===0&&(O=!0,U=0),C.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),G()},requestDraw:G,tick:X,animate:ue,resetTime:oe,pause:me,resume:function(){k=!1},identify:he,mark:J,getLoci:Q,handleResize:Ze,requestResize:function(){q=!0},requestCameraReset:function(Ae){U=Ae==null?void 0:Ae.durationMs,N=Ae==null?void 0:Ae.snapshot,O=!0},camera:_,boundingSphere:C.boundingSphere,boundingSphereVisible:C.boundingSphereVisible,get notifyDidDraw(){return j},set notifyDidDraw(Ae){j=Ae},didDraw:m,commited:p,reprCount:f,resized:Xe,setProps:function(Ae,we){var Ve,rt,ut;we===void 0&&(we=!1);var Ue=typeof Ae=="function"?Lf(Ne(),Ae):Ae,pt=Object.create(null);if(Ue.camera&&Ue.camera.mode!==void 0&&Ue.camera.mode!==_.state.mode&&(pt.mode=Ue.camera.mode),Ue.cameraFog!==void 0&&Ue.cameraFog.params){var mt=Ue.cameraFog.name==="on"?Ue.cameraFog.params.intensity:0;mt!==_.state.fog&&(pt.fog=mt)}if(Ue.cameraClipping!==void 0&&(Ue.cameraClipping.far!==void 0&&Ue.cameraClipping.far!==_.state.clipFar&&(pt.clipFar=Ue.cameraClipping.far),Ue.cameraClipping.radius!==void 0)){var wt=C.boundingSphere.radius/100*(100-Ue.cameraClipping.radius);wt>0&&wt!==pt.radius&&(pt.radius=Math.max(wt,.01))}if(Object.keys(pt).length>0&&_.setState(pt),((Ve=Ue.camera)===null||Ve===void 0?void 0:Ve.helper)&&D.camera.setProps(Ue.camera.helper),((rt=Ue.camera)===null||rt===void 0?void 0:rt.manualReset)!==void 0&&(u.camera.manualReset=Ue.camera.manualReset),((ut=Ue.camera)===null||ut===void 0?void 0:ut.stereo)!==void 0&&Object.assign(u.camera.stereo,Ue.camera.stereo),Ue.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=Ue.cameraResetDurationMs),Ue.transparentBackground!==void 0&&(u.transparentBackground=Ue.transparentBackground),Ue.viewport!==void 0){var Z=u.viewport===Ue.viewport||u.viewport.name===Ue.viewport.name&&Hv(u.viewport.params,Ue.viewport.params);Z||(u.viewport=Ue.viewport,Ke(),ht())}Ue.postprocessing&&Object.assign(u.postprocessing,Ue.postprocessing),Ue.marking&&Object.assign(u.marking,Ue.marking),Ue.multiSample&&Object.assign(u.multiSample,Ue.multiSample),Ue.renderer&&A.setProps(Ue.renderer),Ue.trackball&&T.setProps(Ue.trackball),Ue.interaction&&M.setProps(Ue.interaction),Ue.debug&&D.debug.setProps(Ue.debug),Ue.handle&&D.handle.setProps(Ue.handle),pt.mode==="orthographic"&&(u.camera.stereo.name="off"),we||G()},getImagePass:function(Ae){return Ae===void 0&&(Ae={}),new Pye(a,A,C,_,D,o.draw.wboitEnabled,Ae)},getRenderObjects:function(){var Ae=[];return C.forEach(function(we,Ve){return Ae.push(Ve)}),Ae},get props(){return Ne()},get input(){return i},get stats(){return A.stats},get interaction(){return M.events},dispose:function(){Ye.unsubscribe(),C.clear(),D.debug.clear(),T.dispose(),A.dispose(),M.dispose()}};function Ke(){var Ae=g,we=y,Ve=b,rt=x;u.viewport.name==="canvas"?(g=0,y=0,b=v.drawingBufferWidth,x=v.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*a.pixelRatio,x=u.viewport.params.height*a.pixelRatio,y=v.drawingBufferHeight-x-u.viewport.params.y*a.pixelRatio,b=u.viewport.params.width*a.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*v.drawingBufferWidth),x=Math.round(u.viewport.params.height*v.drawingBufferHeight),y=Math.round(v.drawingBufferHeight-x-u.viewport.params.y*v.drawingBufferHeight),b=Math.round(u.viewport.params.width*v.drawingBufferWidth)),(Ae!==g||we!==y||Ve!==b||rt!==x)&&(K=!0)}function ht(){E.setViewport(g,y,b,x),A.setViewport(g,y,b,x),da.set(_.viewport,g,y,b,x),da.set(T.viewport,g,y,b,x)}}e.create=t})(nT||(nT={}));function zye(e){u7(e)}function u7(e){Xt.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(tT),e.events.canvas3d.settingsUpdated.next(void 0)}),Xt.Canvas3D.SetSettings.subscribe(e,function(t){var r;!e.canvas3d||((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var Vye=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",registerDefault:zye,Canvas3DSetSettings:u7}),Gl=Ts,_d=or.Trigger,Gye={hoverHighlightOnly:or([_d(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:or([_d(0,Gl.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},Hye={bindings:P.Value(Gye,{isHidden:!0}),ignore:P.Value([],{isHidden:!0}),preferAtoms:P.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:P.Boolean(!0)},qye=xr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,a,i){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,a,i)},r}return t.prototype.getLoci=function(r){return this.params.preferAtoms&&Pt.isLoci(r)&&r.bonds.length===2?Pt.toFirstStructureElementLoci(r):r},t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var a=n.current,i=n.buttons,o=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){var s=r.getLoci(a.loci);if(r.params.ignore.includes(s.kind)){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:ur});return}var u=!1;or.match(r.params.bindings.hoverHighlightOnly,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:s}),u=!0),or.match(r.params.bindings.hoverHighlightOnlyExtend,i,o)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:s}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:ur})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(xr.Handler),params:function(){return Hye},display:{name:"Highlight Loci on Canvas"}}),jye={clickSelect:or.Empty,clickToggleExtend:or([_d(1,Gl.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:or.Empty,clickToggle:or([_d(1,Gl.create())],"Toggle selection","${triggers} on element"),clickDeselect:or.Empty,clickDeselectAllOnEmpty:or([_d(1,Gl.create())],"Deselect all","Click on nothing using ${triggers}")},Wye={bindings:P.Value(jye,{isHidden:!0}),ignore:P.Value([],{isHidden:!0}),preferAtoms:P.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:P.Boolean(!0)},Xye=xr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){_t(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a.lociMarkProvider=function(i,o,s){!a.ctx.canvas3d||!a.params.mark||a.ctx.canvas3d.mark({loci:i.loci},o,s)},a.spine=new Uy.Impl(r.state.data.cells),a}return t.prototype.getLoci=function(r){return this.params.preferAtoms&&Pt.isLoci(r)&&r.bonds.length===2?Pt.toFirstStructureElementLoci(r):r},t.prototype.applySelectMark=function(r,n){var a=this.ctx.state.data.cells.get(r);if(a&&fe.isRepresentation3D(a.obj)){this.spine.current=a;var i=this.spine.getRootOfType(fe.Molecule.Structure);if(i){n&&this.lociMarkProvider({loci:ke.Loci(i.data)},xt.Deselect);var o=this.ctx.managers.structure.selection.getLoci(i.data);this.lociMarkProvider({loci:o},xt.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return Ut.isEmpty(o)},a=function(o){return!Ut.isEmpty(o)},i=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},a],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},a],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},a],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},a],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},a],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];i.sort(function(o,s){var u=r.params.bindings[o[0]],c=r.params.bindings[s[0]],l=u.triggers.length===0?0:js(u.triggers.map(function(d){return Gl.size(d.modifiers)})),f=c.triggers.length===0?0:js(c.triggers.map(function(d){return Gl.size(d.modifiers)}));return f-l}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s=o.current,u=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)){var l=r.getLoci(s.loci);if(!r.params.ignore.includes(l.kind))for(var f=0,d=i;f<d.length;f++){var m=d[f],p=m[0],v=m[1],h=m[2];if(or.match(r.params.bindings[p],u,c)&&(!h||h(l))){v({repr:s.repr,loci:l});break}}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,c=o.oldObj,l=o.oldData,f=o.action,d=r.ctx.state.data.cells.get(s);if(d&&fe.Molecule.Structure.is(d.obj)){var m=u.data,p=f==="recreate"?c==null?void 0:c.data:f==="in-place"?l:void 0;if(p&&ke.areEquivalent(m,p)&&ke.areHierarchiesEqual(m,p))return;for(var v=r.ctx.state.data.select(Yt.children(s).ofType(fe.Molecule.Structure.Representation3D)),h=0,g=v;h<g.length;h++){var y=g[h];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(xr.Handler),params:function(){return Wye},display:{name:"Select Loci on Canvas"}}),Yye=xr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(_e.is(r)){for(var a=new Set,i=0,o=r.elements;i<o.length;i++){var s=o[i].unit,u=Qe.create(r.structure,s,s.elements[0]),c=ft.entity.pdbx_description(u).join(", ");a.add(c)}a.size===1&&a.forEach(function(l){return n.push(l)})}return n.push(xb(r)),n.filter(function(l){return!!l}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),Kye={clickFocus:or([_d(1,Gl.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:or([_d(1,Gl.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:or([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:or([],"Representation Focus Add","Click element using ${triggers}")},Qye={bindings:P.Value(Kye,{isHidden:!0})},Zye=xr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a,i=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,c=u.clickFocus,l=u.clickFocusAdd,f=u.clickFocusSelectMode,d=u.clickFocusAddSelectMode,m=r.ctx.managers.interactivity.props.granularity;if(!(m!=="residue"&&m!=="element")){var p=r.ctx.selectionMode?f:c,v=or.match(p,o,s),h=r.ctx.selectionMode?d:l,g=or.match(h,o,s);if(!(!v&&!g)){var y=Ut.normalize(i.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&Ut.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(v)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var x=(a=r.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;x&&r.ctx.managers.camera.focusLoci(x)}}}})},t}(xr.Handler),params:function(){return Qye},display:{name:"Representation Focus Loci on Canvas"}}),$ye=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",HighlightLoci:qye,SelectLoci:Xye,DefaultLociLabelProvider:Yye,FocusLoci:Zye}),c0=Ts,l0=or.Trigger,Jye={clickCenterFocus:or([l0(1,c0.create()),l0(2,c0.create()),l0(1,c0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:or([l0(2,c0.create()),l0(1,c0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},e1e={minRadius:P.Numeric(8,{min:1,max:50,step:1}),extraRadius:P.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:P.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:P.Value(Jye,{isHidden:!0})},t1e=xr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var a=n.current,i=n.button,o=n.modifiers;if(!!r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(or.match(s,i,o)){if(Ut.isEmpty(a.loci)){Xt.Camera.Reset(r.ctx,{});return}var u=Ut.normalize(a.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(xr.Handler),params:function(){return e1e},display:{name:"Camera Focus Loci on Canvas"}}),r1e=xr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,a=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(i){var o=i.current;if(!(!r.ctx.canvas3d||!eT(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,a=0;return}var u=r.ctx.canvas3d.camera,c,l;if(s>=1&&s<=3){n=0,a=0;var f=S.sub(S(),u.target,u.position),d=S.cross(S(),f,u.up);l=S(),l[s-1]=1,c=S.cross(S(),l,d),S.magnitude(c)===0&&(c=f)}else n===s?a=(a+1)%2:(n=s,a=0),s===4?(l=a?S.unitX:S.unitY,c=S.negUnitZ):s===5?(l=a?S.unitX:S.unitZ,c=S.negUnitY):(l=a?S.unitY:S.unitZ,c=S.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(m,p){return p.getInvariantFocus(m.boundingSphereVisible.center,m.boundingSphereVisible.radius,l,c)}})}})},t}(xr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}}),n1e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",FocusLoci:t1e,CameraAxisHelper:r1e}),a1e=xr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(Yt.Generators.rootsOfType(fe.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],c=((r=u.obj)===null||r===void 0?void 0:r.data)&&jt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;c!==void 0&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,a=-1,i=this.ctx.state.data.select(Yt.Generators.rootsOfType(fe.Molecule.Structure)),o=0,s=i;o<s.length;o++){var u=s[o],c=((r=u.obj)===null||r===void 0?void 0:r.data)&&ke.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;c!==void 0&&c>a&&(a=c)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,a=0,i=this.ctx.state.data.select(Yt.Generators.rootsOfType(fe.Molecule.Model)),o=0,s=i;o<s.length;o++){var u=s[o],c=(r=u.obj)===null||r===void 0?void 0:r.data;if(c){var l=jt.AsymIdCount.get(c),f=jt.AsymIdOffset.get(c).value;l!==void 0&&f!==void 0&&(n=Math.max(n,f.auth+l.auth),a=Math.max(a,f.label+l.label))}}return{auth:n,label:a}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(jt.Index.get(r).value===void 0){var a=n&&jt.Index.get(n).value,i=a!=null?a:this.maxModelIndex+1;jt.Index.set(r,{value:i})}if(jt.AsymIdOffset.get(r).value===void 0){var o=n&&jt.AsymIdOffset.get(n).value,i=o!=null?o:I({},this.asymIdOffset);jt.AsymIdOffset.set(r,{value:i})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&ke.Index.get(r).value===void 0){var a=n&&ke.Index.get(n).value,i=a!=null?a:this.maxStructureIndex+1;ke.Index.set(r,{value:i})}},t.prototype.handle=function(r,n,a){if(fe.Molecule.Structure.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);!i.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,a==null?void 0:a.data)}else if(fe.Molecule.Model.is(n)){var i=this.ctx.state.data.tree.transforms.get(r);i.transformer.definition.isDecorator||this.handleModel(n.data,a==null?void 0:a.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(jt.AsymIdOffset,!0),this.ctx.customModelProperties.register(jt.Index,!0),this.ctx.customStructureProperties.register(ke.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(jt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(jt.Index.descriptor.name),this.ctx.customStructureProperties.unregister(ke.Index.descriptor.name)},t}(xr.Handler)}),Hl=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],c7={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},i1e=121;function o1e(e){var t=ft.residue.key,r=ft.atom,n=r.type_symbol,a=r.label_atom_id,i=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,c=Qe.create(o),l=0,f=0,d=-1;c.structure=o;for(var m=0,p=0,v=o.units.length;m<v;++m){var h=o.units[m],g=h.elements;c.unit=h,l=-1;for(var y=0,b=g.length;y<b;++y){var x=g[y],C=p+y;c.element=x,f=t(c),l!==f&&++d,l=f;var _=n(c),w=su(_);if(lc(w)){s[C]=0,u[C]=-1;continue}var T=a(c),A=yw(h,x);if(A===2||!e.nonPolymer&&!D1(A)){s[C]=0,u[C]=-1;continue}var D=i(c);if(e.traceOnly&&(T!=="CA"&&T!=="BB"||!c7[D])){s[C]=0,u[C]=d;continue}iu(A)?s[C]=u1e(T,_):A===5?s[C]=s1e(T,_,D):s[C]=aT(_),u[C]=d}p+=g.length}}function s1e(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return aT(t)}function u1e(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return aT(t)}function aT(e){var t=zh(e),r=Hl.indexOf(t);return r===-1&&(r=Hl.length,Hl[r]=t),r}var l7=5e3;function c1e(e,t){return ie(this,void 0,void 0,function(){var r,n;return ae(this,function(a){switch(a.label){case 0:r=t.atomRadiusType,n=0,a.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:a.sent(),a.label=3;case 3:l1e(t,n,Math.min(n+l7,r.length)),a.label=4;case 4:return n+=l7,[3,1];case 5:return[2]}})})}function l1e(e,t,r){for(var n=e.structure,a=e.atomRadiusType,i=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,c=e.maxLookupRadius,l=e.probeSize,f=n.lookup3d,d=n.serialMapping,m=n.unitIndexMap,p=n.units,v=d.cumulativeUnitElementCount,h=d.elementIndices,g=d.unitIndices,y=t;y<r;++y){var b=Hl[a[y]];if(b===Hl[0])continue;for(var x=p[g[y]],C=h[y],_=x.conformation.x(C),w=x.conformation.y(C),T=x.conformation.z(C),A=f.find(_,w,T,c),D=A.count,E=A.units,M=A.indices,F=A.squaredDistances,O=l+b,U=l+O,N=[],q=0;q<D;++q){var j=E[q],Q=v[m.get(j.id)]+M[q],J=h[Q],te=Hl[a[Q]];if(!(x===j&&C===J||te===Hl[0])){var K=l+te;if(F[q]<(U+te)*(U+te)){var L=h[Q];N[N.length]=[F[q],(F[q]+O*O-K*K)/(2*O),j.conformation.x(L)-_,j.conformation.y(L)-w,j.conformation.z(L)-T]}}}N.sort(function(ee,B){return ee[0]-B[0]});var W=0;e:for(var k=0;k<s.length;++k){for(var V=s[k],G=V[0],H=V[1],X=V[2],Y=0;Y<N.length;++Y){var oe=N[Y],ue=oe[1],me=oe[2],he=oe[3],Pe=oe[4],re=G*me+H*he+X*Pe;if(re>ue)continue e}++W}o[i[y]]+=u*W*O*O}}var f7={numberOfSpherePoints:P.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:P.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:P.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:P.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},wp;(function(e){function t(c,l){var f=this;l===void 0&&(l={});var d=I(I({},P.getDefaultValues(f7)),l);return Be.create("Compute Accessible Surface Area",function(m){return ie(f,void 0,void 0,function(){return ae(this,function(p){switch(p.label){case 0:return[4,r(m,c,d)];case 1:return[2,p.sent()]}})})})}e.compute=t;function r(c,l,f){return ie(this,void 0,void 0,function(){var d,m,p;return ae(this,function(v){switch(v.label){case 0:return d=n(l,f),o1e(d),[4,c1e(c,d)];case 1:return v.sent(),m=d.area,p=d.serialResidueIndex,[2,{area:m,serialResidueIndex:p}]}})})}function n(c,l){var f=c.elementCount,d=c.atomicResidueCount,m=l.probeSize,p=l.nonPolymer,v=l.traceOnly,h=l.numberOfSpherePoints;return{structure:c,probeSize:m,nonPolymer:p,traceOnly:v,spherePoints:a(h),scalingConstant:4*Math.PI/h,maxLookupRadius:2*l.probeSize+2*Hl[2],atomRadiusType:new Int8Array(f),serialResidueIndex:new Int32Array(f),area:new Float32Array(d)}}function a(c){for(var l=[],f=Math.PI*(3-Math.sqrt(5)),d=2/c,m=0;m<c;++m){var p=m*d-1+d/2,v=Math.sqrt(1-p*p),h=m*f;l[l.length]=S.create(Math.cos(h)*v,p,Math.sin(h)*v)}return l}function i(c,l){var f=c7[c]||i1e;return l/f}e.normalize=i;function o(c,l){var f=l.area,d=l.serialResidueIndex,m=d[Le.indexOf(Le.ofSortedArray(c.structure.root.serialMapping.elementIndices),c.element)];return m===-1?-1:f[m]}e.getValue=o;function s(c,l){var f=o(c,l);return f===-1?-1:i(ft.atom.label_comp_id(c),f)}e.getNormalizedValue=s;function u(c,l){var f=s(c,l);return f===-1?0:f<.16?1:2}e.getFlag=u})(wp||(wp={}));var iT=I({},f7),oT={isBuried:fp.Dynamic(FO("computed","accessible-surface-area.is-buried",be.Bool),function(e){if(!Re.isAtomic(e.element.unit))return!1;var t=Xo.get(e.element.structure).value;return t?wp.getFlag(e.element,t)===1:!1}),isAccessible:fp.Dynamic(FO("computed","accessible-surface-area.is-accessible",be.Bool),function(e){if(!Re.isAtomic(e.element.unit))return!1;var t=Xo.get(e.element.structure).value;return t?wp.getFlag(e.element,t)===2:!1})},Xo=Ol.createProvider({label:"Accessible Surface Area",descriptor:to({name:"molstar_accessible_surface_area",symbols:oT}),type:"root",defaultParams:iT,getParams:function(e){return iT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=I(I({},P.getDefaultValues(iT)),r),a={},[4,wp.compute(t,n).runInContext(e.runtime)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),sT=st(16448250),f1e="Assigns a color based on the relative accessible surface area of a residue.",d7={list:P.ColorList("rainbow",{presetKind:"scale"})};function d1e(e){return d7}function m7(e,t){var r,n=xs.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),a=e.structure&&Xo.get(e.structure),i=a?If(a.id,a.version):-1;if((a==null?void 0:a.value)&&e.structure){var o=Qe.create(e.structure),s=a.value,u=function(c){var l=wp.getNormalizedValue(c,s);return l===-1?sT:n.color(l)};r=function(c){return Qe.is(c)&&Re.isAtomic(c.unit)?u(c):Pt.isLocation(c)?(o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],u(o)):sT}}else r=function(){return sT};return{factory:m7,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:f1e,legend:n?n.legend:void 0}}var p7={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:m7,getParams:d1e,defaultValues:P.getDefaultValues(d7),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Xo.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Xo.ref(e.structure,!1)}}},m1e=xr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Xo,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return p1e(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){$1.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(p7),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(v7),this.ctx.query.structure.registry.add(h7)},t.prototype.unregister=function(){$1.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(p7),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(v7),this.ctx.query.structure.registry.remove(h7)},t}(xr.Handler),params:function(){return{autoAttach:P.Boolean(!1),showTooltip:P.Boolean(!0)}}});function p1e(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Xo.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Xo.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,a=t.serialResidueIndex,i=new Set,o=0,s=function(p,v){var h=v.elements;De.forEach(p,function(g){var y=a[r(v,h[g])];y!==-1&&!i.has(y)&&(o+=n[y],i.add(y))})},u=0,c=e.elements;u<c.length;u++){var l=c[u],f=l.indices,d=l.unit;s(f,d)}if(i.size===0)return;var m="<small>(".concat(i.size," ").concat(i.size>1?"Residues sum":"Residue",")</small>");return"Accessible Surface Area ".concat(m,": ").concat(o.toFixed(2)," \u212B<sup>2</sup>")}else if(e.kind==="structure-loci"){var t=Xo.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Xo.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: ".concat(fh(t.area).toFixed(2)," \u212B<sup>2</sup>")}}var v7=_r("Buried Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":oT.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:br.Residue,ensureCustomProperties:function(e,t){return Xo.attach(e,t)}}),h7=_r("Accessible Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":oT.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:br.Residue,ensureCustomProperties:function(e,t){return Xo.attach(e,t)}});function Sr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function g7(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function f0(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function Nb(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function uT(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function v1e(e,t,r){for(var n=0,a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]];ar.isCovalent(s.props.flag)&&(n+=1)}return n}function h1e(e,t){for(var r=0,n=e.bonds,a=n.offset,i=n.edgeProps.flags,o=a[t],s=a[t+1];o<s;++o)ar.isCovalent(i[o])&&(r+=1);return r}function vu(e,t,r){return v1e(e,t,r)+h1e(t,r)}function bi(e,t,r,n){var a=0;return Yo(e,t,r,function(i,o){Sr(i,o)===n&&(a+=1)}),a}function g1e(e,t,r){var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags;ar.is;for(var s=a[t],u=a[t+1];s<u;++s)if(i[s]===r&&ar.isCovalent(o[s]))return!0;return!1}function y1e(e,t,r,n,a){var i=e.interUnitBonds.getEdge(r,t.id,a,n.id);return i&&ar.isCovalent(i.props.flag)}function b1e(e,t,r,n,a){return t===n?g1e(t,r,a):y1e(e,t,r,n,a)}function x1e(e,t,r,n){for(var a=e.interUnitBonds.getEdgeIndices(r,t.id),i=0,o=a.length;i<o;++i){var s=e.interUnitBonds.edges[a[i]],u=e.unitMap.get(s.unitB);ar.isCovalent(s.props.flag)&&n(u,s.indexB)}}function S1e(e,t,r){for(var n=e.bonds,a=n.offset,i=n.b,o=n.edgeProps.flags,s=a[t],u=a[t+1];s<u;++s)ar.isCovalent(o[s])&&r(e,i[s])}function Yo(e,t,r,n){x1e(e,t,r,n),S1e(t,r,n)}function C1e(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function Ap(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var y7=new Map([[2,pr(180)],[3,pr(120)],[4,pr(109.4721)],[6,pr(90)]]),Ub=S(),zb=S(),wd=S(),Vb=S(),Tp=S();function Gb(e,t,r,n,a){var i=[];return t.conformation.position(t.elements[r],wd),n.conformation.position(n.elements[a],Vb),S.sub(Ub,Vb,wd),Yo(e,t,r,function(o,s){Sr(o,s)!=="H"&&(o.conformation.position(o.elements[s],Tp),S.sub(zb,Tp,wd),i.push(S.angle(Ub,zb)))}),i}function b7(e,t,r,n,a){t.conformation.position(t.elements[r],wd),n.conformation.position(n.elements[a],Vb),S.sub(Ub,Vb,wd);var i=[S(),S()],o=0,s,u;if(Yo(e,t,r,function(c,l){o>1||Sr(c,l)!=="H"&&(s=c,u=l,c.conformation.position(c.elements[l],Tp),S.sub(i[o++],Tp,wd))}),o===1&&s&&u&&Yo(e,s,u,function(c,l){o>1||c===t&&l===r||Sr(c,l)!=="H"&&(c.conformation.position(c.elements[l],Tp),S.sub(i[o++],Tp,wd))}),o===2)return S.cross(zb,i[0],i[1]),Math.abs(Math.PI/2-S.angle(zb,Ub))}var cT=new Pt.ElementBondIterator,lT=new Pt.ElementBondIterator;function _1e(e,t,r){var n=Sr(t,r),a=n==="O"||n==="N";if(a&&vu(e,t,r)===4)return!1;for(cT.setElement(e,t,r);cT.hasNext;){var i=cT.move();if(i.order>1)return!0;if(a){var o=Sr(i.otherUnit,i.otherIndex);for(lT.setElement(e,i.otherUnit,i.otherIndex);lT.hasNext;){var s=lT.move();if(s.order>1){if((o==="P"||o==="S")&&Sr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function w1e(e,t,r){for(var n=0,a=t.bonds,i=a.offset,o=a.edgeProps,s=o.flags,u=o.order,c=i[r],l=i[r+1];c<l;++c)ar.isCovalent(s[c])&&(n+=u[c]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(f){var d=e.interUnitBonds.edges[f];ar.isCovalent(d.props.flag)&&(n+=d.props.order)}),n}var Pp=new Pt.ElementBondIterator,fT=new Pt.ElementBondIterator;function A1e(e,t,r,n){var a=bi(e,t,r,"H"),i=Sr(t,r),o=g7(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&a===0,c=vu(e,t,r),l=w1e(e,t,r),f=_1e(e,t,r),d=l-c>0,m=0,p=8;switch(i){case"H":s&&(c===0?(o=1,p=0):c===1&&(o=0,p=1));break;case"C":s&&(o=0),u&&(m=Math.max(0,4-l-Math.abs(o))),p=Ap(c+m+Math.max(0,-o));break;case"N":if(s)if(!u)o=l-3;else if(f&&l<4)c-a==1&&l-a==2?o=1:o=0;else for(Pp.setElement(e,t,r);Pp.hasNext;){var v=Pp.move(),h=Sr(v.otherUnit,v.otherIndex);if(h==="S"||Ble(h)){o=0;break}else o=1}u&&(m=Math.max(0,3-l+o)),f&&!d?p=Ap(c+m-o):p=Ap(c+m+1-o);break;case"O":if(s&&(u||(o=l-2),l===1)){Pp.setElement(e,t,r);e:for(;Pp.hasNext;){var g=Pp.move();for(fT.setElement(e,g.otherUnit,g.otherIndex);fT.hasNext;){var y=fT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Sr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(m=Math.max(0,2-l+o)),f&&!d?p=Ap(c+m-o+1):p=Ap(c+m-o+2);break;case"S":s&&(u||(l<=3&&bi(e,t,r,"O")===0?o=l-2:o=0)),u&&l<2&&(m=Math.max(0,2-l+o)),l<=3&&(p=Ap(c+m-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=l-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-l);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-l);break;default:hr&&console.warn("Requested charge, protonation for an unhandled element",i)}return[o,m,m+a,p]}function T1e(e,t,r){var n=t.elements.length,a=new Int8Array(n),i=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,c;if(u){var l=e.root.unitMap.get(t.id);if(c=Le.indicesOf(l.elements,t.elements),c.length!==t.elements.length)throw new Error("expected to find an index for every element");t=l,e=e.root}for(var f=0;f<n;++f){var d=u?c[f]:f,m=A1e(e,t,d,r),p=m[0],v=m[1],h=m[2],g=m[3];a[f]=p,i[f]=v,o[f]=h,s[f]=g}return{charge:a,implicitH:i,totalH:o,idealGeometry:s}}var x7={assignCharge:P.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:P.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function P1e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u;return ae(this,function(c){for(n=I(I({},P.getDefaultValues(x7)),r),a=new Map,i=0,o=t.units.length;i<o;++i)s=t.units[i],Re.isAtomic(s)&&(u=T1e(t,s,n),a.set(s.id,u));return[2,a]})})}var dT=I({},x7),d0=Ol.createProvider({label:"Valence Model",descriptor:to({name:"molstar_computed_valence_model"}),type:"local",defaultParams:dT,getParams:function(e){return dT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=I(I({},P.getDefaultValues(dT)),r),a={},[4,P1e(e.runtime,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),Jr;(function(e){function t(f,d,m,p){return S.set(f,p.x[m],p.y[m],p.z[m]),S.transformMat4(f,f,d.conformation.operator.matrix),f}e.setPosition=t;function r(f,d){for(var m=new Int32Array(d+1),p=new Int32Array(d),v=new Int32Array(d),h=f.members,g=f.count,y=f.offsets,b=0,x=y[g];b<x;++b)++v[h[b]];for(var C=0,b=0;b<d;b++)m[b]=C,C+=v[b];m[d]=C;for(var _=new Int32Array(C),b=0;b<g;++b)for(var w=y[b],T=y[b+1];w<T;++w){var A=h[w],D=m[A]+p[A];_[D]=b,++p[A]}return{indices:_,offsets:m}}e.createElementsIndex=r;function n(f,d){var m,p;return I(I({},d),{get lookup3d(){if(!m){var v={x:d.x,y:d.y,z:d.z,indices:De.ofBounds(0,d.count)};m=jf(v,op(v))}return m},get elementsIndex(){return p||(p=r(d,f))},subset:function(v){return a(d,v)}})}e.create=n;function a(f,d){for(var m,p=f.count,v=f.types,h=[],g=0;g<p;++g)d.has(v[g])&&h.push(g);var y=Le.ofSortedArray(h);return{indices:y,get lookup3d(){if(!m){var b={x:f.x,y:f.y,z:f.z,indices:y};m=jf(b,op(b))}return m}}}e.createSubset=a;function i(f,d,m){var p=d0.get(f).value;if(!p||!p.has(d.id))throw new Error("valence model required");return{unit:d,types:m.types,feature:-1,x:m.x,y:m.y,z:m.z,members:m.members,offsets:m.offsets,idealGeometry:p.get(d.id).idealGeometry}}e.Info=i;function o(f,d){return S.set(f,d.x[d.feature],d.y[d.feature],d.z[d.feature]),S.transformMat4(f,f,d.unit.conformation.operator.matrix),f}e.position=o;var s=S(),u=S();function c(f,d){var m=f.members[f.offsets[f.feature]],p=d.members[d.offsets[d.feature]];return f.unit.conformation.position(f.unit.elements[m],s),d.unit.conformation.position(d.unit.elements[p],u),S.distance(s,u)}e.distance=c;function l(f,d){return{types:new Set(f),add:d}}e.Provider=l})(Jr||(Jr={}));var mT;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Me.create(Float32Array,1,n,a?a.x:r),o=Me.create(Float32Array,1,n,a?a.y:r),s=Me.create(Float32Array,1,n,a?a.z:r),u=Me.create(Uint8Array,1,n,a?a.types:r),c=Me.create(Uint8Array,1,n,a?a.groups:r),l=Me.create(Uint32Array,1,n,a?a.offsets:r),f=Me.create(Uint32Array,1,n,a?a.members:r),d={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){d.x=0,d.y=0,d.z=0,d.offset=f.elementCount,d.count=0},pushMember:function(m,p,v,h){Me.add(f,h),d.x+=m,d.y+=p,d.z+=v,d.count+=1},finishState:function(m,p){var v=d.count;v!==0&&(Me.add(u,m),Me.add(c,p),Me.add(i,d.x/v),Me.add(o,d.y/v),Me.add(s,d.z/v),Me.add(l,d.offset))},add:function(m,p,v,h,g,y){Me.add(u,m),Me.add(c,p),Me.add(i,v),Me.add(o,h),Me.add(s,g),Me.add(l,f.elementCount),Me.add(f,y)},getFeatures:function(m){Me.add(l,f.elementCount);var p=Me.compact(i,!0),v=Me.compact(o,!0),h=Me.compact(s,!0),g=i.elementCount;return Jr.create(m,{x:p,y:v,z:h,count:g,types:Me.compact(u,!0),groups:Me.compact(c,!0),offsets:Me.compact(l,!0),members:Me.compact(f,!0)})}}}e.create=t})(mT||(mT={}));var pT;(function(e){function t(r,n,a){for(var i=new Int32Array(a+1),o=new Int32Array(a),s=new Int32Array(a),u=n.members,c=n.offsets,l=0,f=r.edgeCount*2;l<f;++l){var d=r.a[l],m=r.b[l];if(!(d>m)){for(var p=c[d],v=c[d+1];p<v;++p)++s[u[p]];for(var p=c[m],v=c[m+1];p<v;++p)++s[u[p]]}}for(var h=0,l=0;l<a;l++)i[l]=h,h+=s[l];i[a]=h;for(var g=new Int32Array(h),l=0,f=r.edgeCount*2;l<f;++l){var d=r.a[l],m=r.b[l];if(!(d>m)){for(var p=c[d],v=c[d+1];p<v;++p){var y=u[p],b=i[y]+o[y];g[b]=l,++o[y]}for(var p=c[m],v=c[m+1];p<v;++p){var y=u[p],b=i[y]+o[y];g[b]=l,++o[y]}}}return{indices:g,offsets:i}}e.createElementsIndex=t})(pT||(pT={}));var E1e=function(e){_t(t,e);function t(r,n){var a=e.call(this,r)||this;a.elementKeyIndex=new Map;for(var i=0,o=a.edges.length;i<o;++i)for(var s=a.edges[i],u=s.unitA,c=s.indexA,l=n.get(u),f=l.offsets,d=l.members,m=f[c],p=f[c+1];m<p;++m){var v=a.getElementKey(d[m],u),h=a.elementKeyIndex.get(v);h===void 0?a.elementKeyIndex.set(v,[i]):h.push(i)}return a}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return"".concat(r,"|").concat(n)},t}(ad);function S7(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function I1e(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function D1e(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var vT;(function(e){function t(r,n){var a=[],i=[],o=[];return{add:function(s,u,c){a[a.length]=s,i[i.length]=u,o[o.length]=c},getContacts:function(){for(var s=new Ni.EdgeBuilder(r.count,a,i),u=new Int8Array(s.slotCount),c=new Int8Array(s.slotCount),l=0,f=s.edgeCount;l<f;l++)s.addNextEdge(),s.assignProperty(u,o[l]);var d=s.createGraph({type:u,flag:c}),m,p=Object.defineProperty(d,"elementsIndex",{get:function(){return m||(m=pT.createElementsIndex(d,r,n))}});return p}}}e.create=t})(vT||(vT={}));var hT;(function(e){function t(){var r=new ad.Builder;return{startUnitPair:function(n,a){r.startUnitPair(n.id,a.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,a,i){r.add(n,a,{type:i,flag:0})},getContacts:function(n){return new E1e(r.getMap(),n)}}}e.create=t})(hT||(hT={}));var M1e={lineOfSightDistFactor:P.Numeric(1,{min:0,max:3,step:.1})},R1e=3;function C7(e,t,r){var n=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(n===a&&t.unit===r.unit)return!1;var i=Nb(t.unit,n),o=Nb(r.unit,a);return!(i&&o&&i!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[a]]&&t.unit===r.unit||b1e(e,t.unit,n,r.unit,a))}function _7(e,t,r,n){var a=Nb(e,t),i=Nb(r,n);return a&&i&&a!==i}function w7(e,t){for(var r=t.feature,n=t.offsets,a=t.members,i=n[r],o=n[r+1];i<o;++i)if(a[i]===e)return!0;return!1}var ql=S(),gT=S(),yT=S(),B1e=l6();function A7(e,t,r,n){var a=t.feature,i=r.feature,o=t.members[t.offsets[a]],s=r.members[r.offsets[i]];Jr.position(gT,t),Jr.position(yT,r),S.scale(ql,S.add(ql,gT,yT),.5);var u=n*R1e,c=e.lookup3d.find(ql[0],ql[1],ql[2],u,B1e),l=c.count,f=c.indices,d=c.units,m=c.squaredDistances;if(l===0)return!0;for(var p=0;p<l;++p){var v=f[p],h=d[p];if(!!Re.isAtomic(h)){var g=Sr(h,v);if(g!=="H"){var y=zh(g);if(!(y*y*n*n<=m[p])&&!(_7(h,v,t.unit,o)||_7(h,v,r.unit,s))&&!(t.unit===h&&w7(v,t)||r.unit===h&&w7(v,r))&&(h.conformation.position(h.elements[v],ql),!(S.squaredDistance(ql,gT)<1||S.squaredDistance(ql,yT)<1)))return!1}}}return!0}function F1e(e,t,r,n,a,i){for(var o=0,s=a;o<s.length;o++){var u=s[o];O1e(e,t,r,n,u,i)}}function O1e(e,t,r,n,a,i){for(var o=r.x,s=r.y,u=r.z,c=r.subset(a.requiredFeatures),l=c.lookup3d,f=c.indices,d=Jr.Info(e,t,r),m=I({},d),p=i.lineOfSightDistFactor,v=0,h=De.size(f);v<h;++v){var g=De.getAt(f,v),y=l.find(o[g],s[g],u[g],a.maxDistance),b=y.count,x=y.indices,C=y.squaredDistances;if(b!==0){d.feature=g;for(var _=0;_<b;++_){var w=De.getAt(f,x[_]);if(!(w<=g)&&(m.feature=w,!!C7(e,d,m))){var T=a.getType(e,d,m,C[_]);T&&A7(e,d,m,p)&&n.add(g,w,T)}}}}}var k1e=se();function L1e(e,t,r,n,a,i,o,s){var u=r.count,c=r.x,l=r.y,f=r.z,d=a.lookup3d,m=se.mul(k1e,n.conformation.operator.inverse,t.conformation.operator.matrix),p=!se.isIdentity(m),v=S(),h=Math.max.apply(Math,o.map(function(J){return J.maxDistance})),g=d.boundary.sphere,y=g.center,b=g.radius,x=(b+h)*(b+h),C=s.lineOfSightDistFactor,_=Jr.Info(e,t,r),w=Jr.Info(e,n,a);i.startUnitPair(t,n);for(var T=0;T<u;++T)if(S.set(v,c[T],l[T],f[T]),p&&S.transformMat4(v,v,m),!(S.squaredDistance(v,y)>x)){var A=d.find(v[0],v[1],v[2],h),D=A.indices,E=A.count,M=A.squaredDistances;if(E!==0){_.feature=T;for(var F=0;F<E;++F){var O=D[F];if(w.feature=O,!!C7(e,_,w))for(var U=M[F],N=0,q=o;N<q.length;N++){var j=q[N];if(U<j.maxDistance*j.maxDistance){var Q=j.getType(e,_,w,U);if(Q&&A7(e,_,w,C)){i.add(T,O,Q);break}}}}}}i.finishUnitPair()}var N1e={distanceMax:P.Numeric(4,{min:1,max:5,step:.1}),angleMax:P.Numeric(30,{min:0,max:60,step:1})},U1e=["CL","BR","I","AT"];function z1e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=Sr(t,u);U1e.includes(l)&&r.add(6,0,i[n[u]],o[n[u]],s[n[u]],u)}}var V1e=["N","O","S"],G1e=["C","N","P","S"];function H1e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(f,d){var m=Sr(t,f);if(V1e.includes(m)){var p=!1;Yo(e,t,f,function(v,h){G1e.includes(Sr(v,h))&&(p=!0)}),p&&r.add(7,0,i[n[f]],o[n[f]],s[n[f]],f)}},c=0,l=n.length;c<l;++c)u(c)}function q1e(e,t){return e===7&&t===6||e===6&&t===7}var j1e=pr(180),W1e=pr(120);function X1e(e){return{angleMax:pr(e.angleMax)}}function Y1e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!q1e(a,i)){var o=a===6?[t,r]:[r,t],s=o[0],u=o[1],c=s.members[s.offsets[s.feature]],l=u.members[u.offsets[u.feature]],f=Gb(e,s.unit,c,u.unit,l);if(f.length===1&&!(j1e-f[0]>n.angleMax)){var d=Gb(e,u.unit,l,s.unit,c);if(d.length!==0&&!d.some(function(m){return W1e-m>n.angleMax}))return 5}}}var K1e=Jr.Provider([6],z1e),Q1e=Jr.Provider([7],H1e),Z1e={name:"halogen-bonds",params:N1e,createTester:function(e){var t=X1e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,a){return Y1e(r,n,a,t)}}}},T7={distanceMax:P.Numeric(3.5,{min:1,max:5,step:.1}),backbone:P.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:P.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:P.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:P.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:P.Numeric(45,{min:0,max:180,step:1})},$1e=I(I({},T7),{water:P.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:P.Numeric(4.1,{min:1,max:5,step:.1})}),J1e=I({},T7);function bT(e,t){var r=d0.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function ebe(e,t,r){for(var n=bT(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c){var f=Sr(t,c);(I7(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[a[c]],s[a[c]],u[a[c]],c)}}function tbe(e,t,r){for(var n=bT(e,t).totalH,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=0,l=a.length;c<l;++c)Sr(t,c)==="C"&&n[c]>0&&(bi(e,t,c,"N")>0||bi(e,t,c,"O")>0||rbe(t,c))&&r.add(9,0,o[a[c]],s[a[c]],u[a[c]],c)}function rbe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,a=r.all,i=n.get(t);if(i===void 0)return!1;for(var o=0,s=i.length;o<s;++o)for(var u=a[i[o]],c=0,l=u.length;c<l;++c){var f=Sr(e,u[c]);if(f==="N"||f==="O")return!0}return!1}function nbe(e,t,r){for(var n=bT(e,t),a=n.charge,i=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,c=u.x,l=u.y,f=u.z,d=function(b){r.add(5,0,c[s[b]],l[s[b]],f[s[b]],b)},m=0,p=s.length;m<p;++m){var v=Sr(t,m);if(v==="O")d(m);else if(v==="N"){if(I7(t,m))d(m);else if(a[m]<1){var h=vu(e,t,m)+i[m],g=o[m];(g===4&&h<4||g===3&&h<3||g===2&&h<2)&&d(m)}}else if(v==="S"){var y=uT(t,m);(y==="CYS"||y==="MET"||g7(t,m)===-1)&&d(m)}}}function P7(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function E7(e,t){return cc.has(f0(e,t))}function abe(e,t){return e.rings.elementRingIndices.has(t)}function I7(e,t){return uT(e,t)==="HIS"&&Sr(e,t)==="N"&&abe(e,t)}function ibe(e,t,r,n){return E7(e,t)&&E7(r,n)}function obe(e,t,r,n){return P7(e,t)&&P7(r,n)}function sbe(e,t){return e===5&&t===4||e===4&&t===5}function ube(e,t){return e===9&&t===5||e===5&&t===9}function D7(e){return{includeBackbone:e.backbone,maxAccAngleDev:pr(e.accAngleDevMax),maxDonAngleDev:pr(e.donAngleDevMax),maxAccOutOfPlaneAngle:pr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:pr(e.donOutOfPlaneAngleMax)}}function cbe(e){return I(I({},D7(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var M7=pr(120);function R7(e,t,r,n){var a=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&ibe(t.unit,a,r.unit,i))){var o=Gb(e,t.unit,a,r.unit,i),s=y7.get(t.idealGeometry[a])||M7;if(!o.some(function(f){return Math.abs(s-f)>n.maxDonAngleDev})){if(t.idealGeometry[a]===3){var u=b7(e,t.unit,a,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var c=Gb(e,r.unit,i,t.unit,a),l=y7.get(r.idealGeometry[i])||M7;if(!c.some(function(f){return l-f>n.maxAccAngleDev})){if(r.idealGeometry[i]===3){var u=b7(e,r.unit,i,t.unit,a);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function lbe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!sbe(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],c=s[1],l=u.members[u.offsets[u.feature]],f=c.members[c.offsets[c.feature]],d=Sr(u.unit,l)==="S"||Sr(c.unit,f)==="S"?a.maxSulfurDistSq:a.maxDistSq;if(!(n>d)&&!(!a.includeWater&&obe(u.unit,l,c.unit,f))&&!!R7(e,u,c,a))return 4}}function fbe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(!!ube(i,o)){var s=o===5?[t,r]:[r,t],u=s[0],c=s[1];if(!!R7(e,u,c,a))return 8}}var dbe=Jr.Provider([4],ebe),mbe=Jr.Provider([9],tbe),pbe=Jr.Provider([5],nbe),vbe={name:"hydrogen-bonds",params:$1e,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=cbe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,a,i,o){return lbe(n,a,i,o,r)}}}},hbe={name:"weak-hydrogen-bonds",params:J1e,createTester:function(e){var t=D7(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,a,i){return fbe(r,n,a,i,t)}}}};function gbe(e,t,r){return Sr(t,r)==="S"&&bi(e,t,r,"O")===3}function ybe(e,t,r){return Sr(t,r)==="S"&&bi(e,t,r,"O")===4}function B7(e,t,r){return Sr(t,r)==="P"&&bi(e,t,r,"O")===vu(e,t,r)}function bbe(e,t,r){var n=0;return Sr(t,r)==="C"&&bi(e,t,r,"O")===2&&bi(e,t,r,"C")===1&&Yo(e,t,r,function(a,i){Sr(a,i)==="O"&&vu(e,a,i)-bi(e,a,i,"H")==1&&(n+=1)}),n===2}function xbe(e,t,r){var n=0;return Sr(t,r)==="C"&&vu(e,t,r)===3&&bi(e,t,r,"N")===3&&Yo(e,t,r,function(a,i){vu(e,a,i)-bi(e,a,i,"H")==1&&(n+=1)}),n===2}function Sbe(e,t,r){var n=0;return Sr(t,r)==="C"&&vu(e,t,r)===3&&bi(e,t,r,"N")===2&&bi(e,t,r,"C")===1&&Yo(e,t,r,function(a,i){vu(e,a,i)-bi(e,a,i,"H")==1&&(n+=1)}),n===2}var Cbe={distanceMax:P.Numeric(5,{min:0,max:8,step:.1})},_be={distanceMax:P.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:P.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:P.Numeric(30,{min:0,max:180,step:1})},wbe={distanceMax:P.Numeric(6,{min:1,max:8,step:.1}),offsetMax:P.Numeric(2,{min:0,max:4,step:.1})},Abe=["ARG","HIS","LYS"],Tbe=["GLU","ASP"];function F7(e,t){var r=d0.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function Pbe(e,t,r){for(var n=F7(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,f=qt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);f.hasNext;){var d=f.move(),m=d.index,p=d.start,v=d.end,h=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Abe.includes(h)){r.startState();for(var g=p;g<v;++g)Sr(t,g)==="N"&&!cc.has(f0(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(1,0)}else if(!ap.has(h)){c.clear();for(var g=p;g<v;++g){var y=0;xbe(e,t,g)?y=8:Sbe(e,t,g)&&(y=9),y&&(r.startState(),Yo(e,t,g,function(x,C){Sr(t,C)==="N"&&(c.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(1,y))}for(var g=p;g<v;++g)n[g]>0&&!c.has(g)&&r.add(1,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function Ebe(e,t,r){for(var n=F7(e,t).charge,a=t.elements,i=t.model.atomicConformation,o=i.x,s=i.y,u=i.z,c=new Set,l=t.model.atomicHierarchy.atoms.label_comp_id,f=qt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,a);f.hasNext;){var d=f.move(),m=d.index,p=d.start,v=d.end,h=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Tbe.includes(h)){r.startState();for(var g=p;g<v;++g)Sr(t,g)==="O"&&!cc.has(f0(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g);r.finishState(2,0)}else if(I1.has(h))for(var g=p;g<v;++g)B7(e,t,g)&&(r.startState(),Yo(e,t,g,function(x,C){Sr(t,C)==="O"&&r.pushMember(o[a[C]],s[a[C]],u[a[C]],C)}),r.finishState(2,6));else if(!ap.has(h)){for(var g=p;g<v;++g){r.startState(),Sr(t,g)==="N"&&!cc.has(f0(t,g))&&r.pushMember(o[a[g]],s[a[g]],u[a[g]],g),r.finishState(2,0);var y=0;gbe(e,t,g)?y=4:B7(e,t,g)?y=6:ybe(e,t,g)?y=5:bbe(e,t,g)&&(y=10),y&&(r.startState(),Yo(e,t,g,function(x,C){Sr(t,C)==="O"&&(c.add(C),r.pushMember(o[a[C]],s[a[C]],u[a[C]],C))}),r.finishState(2,y))}for(var g=p;g<v;++g)n[g]<0&&!c.has(g)&&r.add(2,0,o[a[g]],s[a[g]],u[a[g]],g)}}}function Ibe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=t.rings.aromaticRings;u<c.length;u++){var l=c[u],f=t.rings.all[l];r.startState();for(var d=0,m=f.length;d<m;++d){var p=f[d];r.pushMember(i[n[p]],o[n[p]],s[n[p]],p)}r.finishState(3,0)}}function Dbe(e,t){return e===2&&t===1||e===1&&t===2}function Mbe(e,t){return e===3&&t===3}function Rbe(e,t){return e===3&&t===1||e===1&&t===3}var O7=S(),k7=S();function Bbe(e,t,r){for(var n=e.feature,a=e.offsets,i=e.members,o=t.feature,s=t.offsets,u=t.members,c=a[n],l=a[n+1];c<l;++c){var f=i[c];e.unit.conformation.position(e.unit.elements[f],O7);for(var d=s[o],m=s[o+1];d<m;++d){var p=u[d];if(t.unit.conformation.position(t.unit.elements[p],k7),S.squaredDistance(O7,k7)<r)return!0}}return!1}var Hb=S(),Ep=S(),qb=S(),jb=S();function xT(e,t){var r=t.unit,n=t.feature,a=t.offsets,i=t.members,o=r.elements,s=a[n];return t.unit.conformation.position(o[i[s]],Hb),t.unit.conformation.position(o[i[s+1]],Ep),t.unit.conformation.position(o[i[s+2]],qb),S.triangleNormal(e,Hb,Ep,qb)}var ST=function(e,t,r){return Jr.position(Hb,e),Jr.position(Ep,t),S.sub(qb,Hb,Ep),S.projectOnPlane(jb,qb,r),S.add(jb,jb,Ep),S.distance(jb,Ep)};function Fbe(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function Obe(e){return{offsetMax:e.offsetMax,angleDevMax:pr(e.angleDevMax)}}function kbe(e){return{offsetMax:e.offsetMax}}var Lbe=pr(180),L7=pr(90),m0=S(),CT=S();function Nbe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(Dbe(i,o)&&Bbe(t,r,a.distanceMaxSq))return 1}function Ube(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(Mbe(i,o)){xT(m0,t),xT(CT,r);var s=S.angle(m0,CT),u=Math.min(ST(t,r,CT),ST(r,t,m0));if(u<=a.offsetMax){if(s<=a.angleDevMax||s>=Lbe-a.angleDevMax)return 3;if(s<=a.angleDevMax+L7&&s>=L7-a.angleDevMax)return 3}}}function zbe(e,t,r,n,a){var i=t.types[t.feature],o=r.types[r.feature];if(Rbe(i,o)){var s=i===3?[t,r]:[r,t],u=s[0],c=s[1];xT(m0,u);var l=ST(c,u,m0);if(l<=a.offsetMax)return 2}}var Vbe=Jr.Provider([2],Ebe),Gbe=Jr.Provider([1],Pbe),Hbe=Jr.Provider([3],Ibe),qbe={name:"ionic",params:Cbe,createTester:function(e){var t=Fbe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,a,i){return Nbe(r,n,a,i,t)}}}},jbe={name:"pi-stacking",params:_be,createTester:function(e){var t=Obe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,a,i){return Ube(r,n,a,i,t)}}}},Wbe={name:"cation-pi",params:wbe,createTester:function(e){var t=kbe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,a,i){return zbe(r,n,a,i,t)}}}},Xbe={distanceMax:P.Numeric(4,{min:1,max:5,step:.1})};function Ybe(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=function(f,d){var m=Sr(t,f),p=!1;m==="C"?(p=!0,Yo(e,t,f,function(v,h){var g=Sr(v,h);g!=="C"&&g!=="H"&&(p=!1)})):m==="F"&&(p=!0),p&&r.add(8,0,i[n[f]],o[n[f]],s[n[f]],f)},c=0,l=n.length;c<l;++c)u(c)}function Kbe(e,t){return e===8&&t===8}function Qbe(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!!Kbe(a,i)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Sr(t.unit,o)==="F"&&Sr(r.unit,s)==="F"))return 6}}var Zbe=Jr.Provider([8],Ybe),$be={name:"hydrophobic",params:Xbe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,a){return Qbe(t,r,n)}}}},Jbe={distanceMax:P.Numeric(3,{min:1,max:5,step:.1})},e2e=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function t2e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=Sr(t,u),f=0;e2e.includes(l)?f=13:(hk(l)||l==="ZN"||l==="CD")&&(f=12),f&&r.add(f,0,i[n[u]],o[n[u]],s[n[u]],u)}}function N7(e){return!cc.has(e)}function r2e(e){return cc.has(e)}function n2e(e){return P1.has(e)}function a2e(e,t,r){for(var n=t.elements,a=t.model.atomicConformation,i=a.x,o=a.y,s=a.z,u=0,c=n.length;u<c;++u){var l=Sr(t,u),f=uT(t,u),d=f0(t,u),m=!1,p=!1,v=Ih.has(f),h=I1.has(f);!v&&!h?Dle(l)||l==="O"||l==="S"?(m=!0,p=!0):l==="N"&&(m=!0):v?l==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(f)&&N7(d)||r2e(d))&&(m=!0,p=!0):l==="S"&&(f==="CYS"||f==="MET")?(m=!0,p=!0):l==="N"&&f==="HIS"&&N7(d)&&(m=!0):h&&(l==="O"&&n2e(d)?(m=!0,p=!0):["N3","N4","N7"].includes(d)?m=!0:["O2","O4","O6"].includes(d)&&(m=!0,p=!0)),m&&r.add(11,0,i[n[u]],o[n[u]],s[n[u]],u),p&&r.add(10,0,i[n[u]],o[n[u]],s[n[u]],u)}}function U7(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function i2e(e,t,r,n){var a=t.types[t.feature],i=r.types[r.feature];if(!(!U7(a,i)&&!U7(i,a)))return 7}var o2e=Jr.Provider([13,12],t2e),s2e=Jr.Provider([10,11],a2e),u2e={name:"metal-coordination",params:Jbe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,a){return i2e(t,r,n)}}}};function c2e(e,t){for(var r=t.contacts,n=t.unitsContacts,a=t.unitsFeatures,i=[l2e(e,t),f2e(e,t),d2e(e,t),m2e(e,t),p2e(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],c=e.unitMap.get(u.unitA),l=e.unitMap.get(u.unitB),f=Jr.Info(e,c,a.get(u.unitA));f.feature=u.indexA;var d=Jr.Info(e,l,a.get(u.unitB));d.feature=u.indexB;for(var m=0,p=i;m<p.length;m++){var v=p[m];v.isApplicable(u.props.type)&&v.handleInterContact(o,f,d)}}for(var h=n.keys();;){var g=h.next(),y=g.done,b=g.value;if(y)break;var x=n.get(b),C=a.get(b),_=e.unitMap.get(b);if(!!Re.isAtomic(_)){for(var f=Jr.Info(e,_,C),d=Jr.Info(e,_,C),w=0,T=i;w<T.length;w++){var v=T[w];v.startUnit(_,x,C)}for(var o=0,s=x.edgeCount*2;o<s;++o){f.feature=x.a[o],d.feature=x.b[o];for(var A=0,D=i;A<D.length;A++){var v=D[A];v.isApplicable(x.edgeProps.type[o])&&v.handleIntraContact(o,f,d)}}}}}function l2e(e,t){var r=t.contacts,n=function(c,l,f,d,m){var p=d.get(f)||[1/0,-1],v=p[0],h=p[1];c<v?(h!==-1&&m(h),d.set(f,[c,l])):m(l)};function a(c,l,f,d,m){var p=l.members[l.offsets[l.feature]],v=f.members[f.offsets[f.feature]],h=l.unit.getResidueIndex(p),g=f.unit.getResidueIndex(v),y="".concat(p,"|").concat(l.unit.id,"|").concat(g,"|").concat(f.unit.id,"|A"),b="".concat(v,"|").concat(f.unit.id,"|").concat(h,"|").concat(l.unit.id,"|B"),x=Jr.distance(l,f);n(x,c,y,d,m),n(x,c,b,d,m)}var i=new Map,o=function(c){return r.edges[c].props.flag=1},s,u;return{isApplicable:function(c){return c===6},handleInterContact:function(c,l,f){a(c,l,f,i,o)},startUnit:function(c,l,f){s=new Map,u=function(d){return l.edgeProps.flag[d]=1}},handleIntraContact:function(c,l,f){a(c,l,f,s,u)}}}function f2e(e,t){var r=t.contacts,n=function(a,i){for(var o=a.types[a.feature]===9?i:a,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),c=u.edgeProps.type,l=u.elementsIndex,f=l.offsets,d=l.indices,m=f[s],p=f[s+1];m<p;++m)if(c[d[m]]===4)return!0;for(var v=r.getEdgeIndices(o.feature,o.unit.id),m=0,p=v.length;m<p;++m)if(r.edges[v[m]].props.type===4)return!0;return!1};return{isApplicable:function(a){return a===8},handleInterContact:function(a,i,o){n(i,o)&&(r.edges[a].props.flag=1)},startUnit:function(){},handleIntraContact:function(a,i,o){if(n(i,o)){var s=t.unitsContacts.get(i.unit.id).edgeProps.flag;s[a]=1}}}}function _T(e,t,r,n,a){for(var i=r.offsets,o=r.feature,s=n.offsets,u=n.feature,c=i[o],l=i[o+1];c<l;++c)for(var f=r.members[c],d=a.getContactIndicesForElement(f,r.unit),m=0,p=d.length;m<p;++m){var v=d[m];if(e.includes(a.edges[v].props.type))for(var h=s[u],g=s[u+1];h<g;++h){var y=n.members[h];if(a.getContactIndicesForElement(y,n.unit).includes(v)){a.edges[t].props.flag=1;return}}}}function wT(e,t,r,n,a){for(var i=a.edgeProps,o=i.type,s=i.flag,u=a.elementsIndex,c=u.offsets,l=u.indices,f=r.offsets,d=r.feature,m=n.offsets,p=n.feature,v=f[d],h=f[d+1];v<h;++v)for(var g=r.members[v],y=c[g],b=c[g+1];y<b;++y){var x=l[y];if(e.includes(o[x])){for(var C=m[p],_=m[p+1];C<_;++C)for(var w=n.members[C],T=c[w],A=c[w+1];T<A;++T)if(x===l[T]){s[t]=1;return}}}}function d2e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){_T([4,8],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){wT([4,8],n,a,i,t.unitsContacts.get(a.unit.id))}}}function m2e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,a,i){_T([3],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){wT([3],n,a,i,t.unitsContacts.get(a.unit.id))}}}function p2e(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,a,i){_T([7],n,a,i,r)},startUnit:function(){},handleIntraContact:function(n,a,i){wT([7],n,a,i,t.unitsContacts.get(a.unit.id))}}}var Cc;(function(e){function t(l,f,d,m,p,v){return MB("interactions",{structure:f,interactions:l},{unitA:d,indexA:m,unitB:p,indexB:v})}e.Location=t;function r(l){return!!l&&l.kind==="data-location"&&l.tag==="interactions"}e.isLocation=r;function n(l,f){return l.data.structure===f.data.structure&&l.data.interactions===f.data.interactions&&l.element.indexA===f.element.indexA&&l.element.indexB===f.element.indexB&&l.element.unitA===f.element.unitA&&l.element.unitB===f.element.unitB}e.areLocationsEqual=n;function a(l,f){var d=f.unitA,m=f.indexA,p=f.unitB,v=f.indexB,h=l.contacts,g=l.unitsContacts;if(d===p){var y=g.get(d.id),b=y.getDirectedEdgeIndex(m,v);return S7(y.edgeProps.type[b])}else{var b=h.getEdgeIndex(m,d.id,v,p.id);return S7(h.edges[b].props.type)}}function i(l){return a(l.data.interactions,l.element)}e.locationLabel=i;function o(l,f,d){return mb("interactions",{structure:l,interactions:f},d,function(m){return u(f,d,m)},function(){return c(l,f,d)})}e.Loci=o;function s(l){return!!l&&l.kind==="data-loci"&&l.tag==="interactions"}e.isLoci=s;function u(l,f,d){var m=l.unitsFeatures;return Xf.fromPairProvider(f.length,function(p,v,h){var g=f[p];Jr.setPosition(v,g.unitA,g.indexA,m.get(g.unitA.id)),Jr.setPosition(h,g.unitB,g.indexB,m.get(g.unitB.id))},d)}e.getBoundingSphere=u;function c(l,f,d){var m=d[0];if(m===void 0)return"";var p=m.unitA,v=m.indexA,h=m.unitB,g=m.indexB,y=f.unitsFeatures,b=y.get(p.id),x=b.members,C=b.offsets,_=y.get(h.id),w=_.members,T=_.offsets,A={granularity:"element"};return(C[v+1]-C[v]>1||T[g+1]-T[g]>1)&&(A.granularity="residue"),[a(f,m),EA(Pt.Location(l,p,x[C[v]],l,h,w[T[g]]),A)].join("</br>")}e.getLabel=c})(Cc||(Cc={}));var v2e=[dbe,mbe,pbe,Vbe,Gbe,Hbe,K1e,Q1e,Zbe,o2e,s2e],Wb={ionic:qbe,"pi-stacking":jbe,"cation-pi":Wbe,"halogen-bonds":Z1e,"hydrogen-bonds":vbe,"weak-hydrogen-bonds":hbe,hydrophobic:$be,"metal-coordination":u2e};function h2e(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(Wb).forEach(function(r){t[r]=P.MappedStatic(e.includes(r)?"on":"off",{on:P.Group(Wb[r].params),off:P.Group({})},{cycle:!0})}),t}var g2e=h2e(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),z7={providers:P.Group(g2e,{isFlat:!0}),contacts:P.Group(M1e,{label:"Advanced Options"})};function y2e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return n=I(I({},P.getDefaultValues(z7)),r),[4,d0.attach(e,t)];case 1:b.sent(),a=[],sb(Wb).forEach(function(x){var C=n.providers[x],_=C.name,w=C.params;_==="on"&&a.push(Wb[x].createTester(w))}),i=new Set,a.forEach(function(x){return Cn.add(i,x.requiredFeatures)}),o=v2e.filter(function(x){return Cn.areIntersecting(i,x.types)}),s=Do.Mutable(),u=Do.Mutable(),c=0,l=t.unitSymmetryGroups.length,b.label=2;case 2:return c<l?(f=t.unitSymmetryGroups[c],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:c,max:l})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(d=b2e(t,f.units[0],o),m=x2e(t,f.units[0],d,a,n.contacts),p=0,v=f.units.length;p<v;++p)h=f.units[p],s.set(h.id,d),u.set(h.id,m);b.label=5;case 5:return++c,[3,2];case 6:return g=S2e(t,s,a,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},c2e(t,y),[2,y]}})})}function b2e(e,t,r){var n=t.elements.length,a=mT.create(n,n/2);if(Re.isAtomic(t))for(var i=0,o=r;i<o.length;i++){var s=o[i];s.add(e,t,a)}return a.getFeatures(n)}function x2e(e,t,r,n,a){var i=vT.create(r,t.elements.length);return Re.isAtomic(t)&&F1e(e,t,r,i,n,a),i.getContacts()}function S2e(e,t,r,n){var a=hT.create();return ke.eachUnitPair(e,function(i,o){var s=t.get(i.id),u=t.get(o.id);L1e(e,i,s,o,u,a,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(i){return i.maxDistance})),validUnit:function(i){return Re.isAtomic(i)},validUnitPair:function(i,o){return ke.validUnitPair(e,i,o)}}),a.getContacts(t)}var AT=I({},z7),pn=Ol.createProvider({label:"Interactions",descriptor:to({name:"molstar_computed_interactions"}),type:"local",defaultParams:AT,getParams:function(e){return AT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=I(I({},P.getDefaultValues(AT)),r),a={},[4,y2e(e,t,n)];case 1:return[2,(a.value=i.sent(),a)]}})})}}),TT=st(13421772),C2e="Assigns colors according the interaction type of a link.",ti=Pf({HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404}),_2e=[["Hydrogen Bond",ti.HydrogenBond],["Hydrophobic",ti.Hydrophobic],["Halogen Bond",ti.HalogenBond],["Ionic",ti.Ionic],["Metal Coordination",ti.MetalCoordination],["Cation Pi",ti.CationPi],["Pi Stacking",ti.PiStacking],["Weak HydrogenBond",ti.WeakHydrogenBond]];function V7(e){switch(e){case 4:return ti.HydrogenBond;case 6:return ti.Hydrophobic;case 5:return ti.HalogenBond;case 1:return ti.Ionic;case 7:return ti.MetalCoordination;case 2:return ti.CationPi;case 3:return ti.PiStacking;case 8:return ti.WeakHydrogenBond;case 0:return TT}}var G7={};function w2e(e){return G7}function H7(e,t){var r,n=e.structure?pn.get(e.structure):void 0,a=n?If(n.id,n.version):-1;return n&&n.value?r=function(i){if(Cc.isLocation(i)){var o=i.data.interactions,s=o.unitsContacts,u=o.contacts,c=i.element,l=c.unitA,f=c.unitB,d=c.indexA,m=c.indexB;if(l===f){var p=s.get(l.id),v=p.getDirectedEdgeIndex(d,m);return V7(p.edgeProps.type[v])}else{var v=u.getEdgeIndex(d,l.id,m,f.id);return V7(u.edges[v].props.type)}}return TT}:r=function(){return TT},{factory:H7,granularity:"group",color:r,props:t,contextHash:a,description:C2e,legend:xl(_2e)}}var PT={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:H7,getParams:w2e,defaultValues:P.getDefaultValues(G7),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?pn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&pn.ref(e.structure,!1)}}};function Ps(e,t,r,n){var a=0,i=t.webgl,o=new En,s=new Vt.GeometryState,u=oc(),c=[],l=ta.create(),f,d,m,p,v=kn.createEmpty();function h(_,w){var T=this;return _===void 0&&(_={}),w&&w!==d&&(m=r(t,w),d=w,p||(p=P.getDefaultValues(m))),p=Object.assign({},p,_),Be.create("Creating or updating ComplexRepresentation",function(A){return ie(T,void 0,void 0,function(){var D,E,M;return ae(this,function(F){switch(F.label){case 0:return D=!1,f?((M=f.mustRecreate)===null||M===void 0?void 0:M.call(f,d,p,i))&&(f.destroy(),f=n(u,d,p,i),D=!0):(f=n(u,d,p,i),D=!0),E=f.createOrUpdate({webgl:i,runtime:A},v,p,w),E?[4,E]:[3,2];case 1:F.sent(),F.label=2;case 2:return D&&b(l),c.length=0,f&&f.renderObject&&(c.push(f.renderObject),s.add(f.renderObject.id,f.geometryVersion)),s.snapshot(),a+=1,o.next(a),[2]}})})})}function g(_){return _===void 0?ke.Loci(d.target):f?f.getLoci(_):ur}function y(_,w){if(!d||!$a.is(l.markerActions,w))return!1;if(ke.isLoci(_)||_e.is(_)||Pt.isLoci(_)){if(!ke.areRootsEquivalent(_.structure,d))return!1;_=Ut.remap(_,d),(ke.isLoci(_)||_e.is(_)&&_e.isWholeStructure(_))&&(_=db)}else if(!jo(_)&&!e0(_))return!1;return Ut.isEmpty(_)?!1:f?f.mark(_,w):!1}function b(_){if(ta.update(l,_),_.visible!==void 0&&f&&f.setVisibility(_.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),_.alphaFactor!==void 0&&f&&f.setAlphaFactor(_.alphaFactor),_.pickable!==void 0&&f&&f.setPickable(_.pickable),_.overpaint!==void 0&&f){var w=ba.remap(_.overpaint,d);f.setOverpaint(w,i)}if(_.transparency!==void 0&&f){var T=xa.remap(_.transparency,d);f.setTransparency(T,i)}if(_.substance!==void 0&&f){var A=Sa.remap(_.substance,d);f.setSubstance(A,i)}if(_.clipping!==void 0&&f){var D=Yr.remap(_.clipping,d);f.setClipping(D)}_.transform!==void 0&&f&&f.setTransform(_.transform),_.unitTransforms!==void 0&&f&&f.setVisibility(l.visible&&(_.unitTransforms===null||_.unitTransforms.isIdentity))}function x(_){v=_}function C(){f&&f.destroy()}return{label:e,get groupCount(){return f?f.groupCount:0},get props(){return p},get params(){return m},get state(){return l},get theme(){return v},get geometryVersion(){return s.version},renderObjects:c,updated:o,createOrUpdate:h,setState:b,setTheme:x,getLoci:g,mark:y,destroy:C}}function q7(e,t,r){var n=t.elements,a=t.model;if(De.indexOf(n,r)!==-1){for(var i=a.atomicHierarchy.residueAtomSegments,o=i.index,s=i.offsets,u=o[r],c=[],l=s[u],f=s[u+1];l<f;++l){var d=De.indexOf(n,l);d!==-1&&c.push(d)}var m=De.ofSortedArray(Le.ofSortedArray(c));return _e(e,[{unit:t,indices:m}])}return ur}function A2e(e,t,r){var n=t.elements,a=t.model,i=a.atomicHierarchy.atoms.label_alt_id,o=i.value(r);if(De.indexOf(n,r)!==-1){var s=a.atomicHierarchy.residueAtomSegments.index,u=s[r];return p0(e,t,u,o)}return _e(e,[])}function p0(e,t,r,n){for(var a=t.elements,i=t.model,o=i.atomicHierarchy.atoms.label_alt_id,s=i.atomicHierarchy.residueAtomSegments.offsets,u=[],c=s[r],l=s[r+1];c<l;++c){var f=De.indexOf(a,c);if(f!==-1){var d=o.value(c);(n===d||d==="")&&u.push(f)}}var m=De.ofSortedArray(Le.ofSortedArray(u));return _e(e,[{unit:t,indices:m}])}function j7(e,t,r){for(var n=e.structure.child,a=t&&n?e.group.units.filter(function(c){return n.unitMap.has(c.id)}):e.group.units,i=a.length,o=i*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<i;u++)se.toArray(a[u].conformation.operator.matrix,s,u*16);return A_(s,i,r)}var T2e={atomic:{},spheres:{},gaussians:{}},P2e=P.objectToOptions(T2e);function E2e(e,t){for(var r=0,n=e.length;r<n;++r)if(Re.isAtomic(t)&&e[r]==="atomic"||Re.isSpheres(t)&&e[r]==="spheres"||Re.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var W7=5e8;function X7(e,t,r){r===void 0&&(r=W7);var n=Bt.size(S(),e);S.ceil(n,n),n.sort(function(s,u){return u-s});var a=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],o=Math.ceil(i/(t*t));return{area:i,areaCells:o,maxAreaCells:a}}function Ad(e,t,r){r===void 0&&(r=W7);var n=X7(e,t.resolution,r),a=n.area,i=n.areaCells,o=n.maxAreaCells,s=i>o?Math.sqrt(a/o):t.resolution;return I(I({},t),{resolution:s})}function I2e(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var Xb={ignoreHydrogens:P.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:P.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:P.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};P.getDefaultValues(Xb);var D2e=S();function M2e(e,t,r,n){return S.squaredDistance(S.set(D2e,e,t,r),n)}function R2e(e,t,r){for(var n=0,a=t.length,i=0,o=r.length;i<o;++i){var s=Le.indexOfInRange(t,r[i],n,a);s===-1?e[i]=-2:(e[i]=s,n=s)}}function Yb(e,t,r,n){var a=n.ignoreHydrogens,i=n.traceOnly,o=n.includeParent,s=o?e.root.unitMap.get(t.id):t,u=I2e(s),c=u.x,l=u.y,f=u.z,d=s.elements,m=t.boundary.sphere,p=m.center,v=m.radius,h=(2+1.5)*2,g=(v+h)*(v+h),y,b;if(a||i||o&&s!==t){for(var x=[],C=[],_=0,w=d.length;_<w;++_){var T=d[_];a&&Kb(s,T)||i&&!IT(s,T)||o&&M2e(c[T],l[T],f[T],p)>g||(x.push(T),C.push(_))}y=Le.ofSortedArray(x),b=C}else y=d,b=Po(new Int32Array(y.length));o&&s!==t&&R2e(b,t.elements,y);var A={indices:y,x:c,y:l,z:f,id:b},D=t===s?t.boundary:op(A),E=Qe.create(e,s),M=function(F){return E.element=F,r.size(E)};return{position:A,boundary:D,radius:M}}function ET(e,t,r,n){var a=Qe.create(e),i,o,s,u,c;if(r||n){for(var l=[],f=[],d=[],m=[],p=[],v=0,h=0,g=e.units.length;v<g;++v){var y=e.units[v],b=y.elements,x=y.conformation,C=x.x,_=x.y,w=x.z;a.unit=y;for(var T=0,A=b.length;T<A;++T){var D=b[T];r&&Kb(y,D)||n&&!IT(y,D)||(l.push(C(D)),f.push(_(D)),d.push(w(D)),a.element=D,m.push(t.size(a)),p.push(h+T))}h+=b.length}i=l,o=f,s=d,u=m,c=p}else{for(var E=e.elementCount,l=new Float32Array(E),f=new Float32Array(E),d=new Float32Array(E),m=new Float32Array(E),v=0,h=0,g=e.units.length;v<g;++v){var y=e.units[v],b=y.elements,M=y.conformation,C=M.x,_=M.y,w=M.z;a.unit=y;for(var T=0,A=b.length;T<A;++T){var D=b[T],F=h+T;l[F]=C(D),f[F]=_(D),d[F]=w(D),a.element=D,m[F]=t.size(a)}h+=b.length}i=l,o=f,s=d,u=m,c=Po(new Uint32Array(E))}var O={indices:De.ofRange(0,c.length),x:i,y:o,z:s,id:c},U=function(N){return u[N]};return{position:O,radius:U}}var Y7=G1.H;function Kb(e,t){return Re.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===Y7}function Qb(e,t){return e[t]===Y7}function IT(e,t){if(Re.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Ip(e){if(Re.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,a=0,i=r.length;a<i;a++){var o=n(r[a]);o>t&&(t=o)}return t+1}function Zb(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var a=n[r],i=Ip(a.units[0]);i>t&&(t=i)}return t}function v0(e){return P.MultiSelect(e,P2e,{description:"For which kinds of units/chains to show the representation visuals."})}var zi={unitKinds:v0(["atomic","spheres"]),includeParent:P.Boolean(!1,{isHidden:!0})},K7=I({},At.Params),B2e=I({},Tl.Params),Q7=I({},no.Params),F2e=I({},Qf.Params),Z7=I({},Xr.Params),$7=I({},Oo.Params),J7=I({},ro.Params),eU=I({},ko.Params);function O2e(e,t,r,n,a,i){var o=ya.getUtils(t),s=o.createValues,u=o.createRenderableState,c=P_(),l=s(t,c,r,n,a),f=u(a);return np(t.kind,l,f,i)}function Dp(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,f=e.geometryUtils,d=f.updateValues,m=f.updateBoundingSphere,p=f.updateRenderableState,v=f.createPositionIterator,h=mu.create(),g={loci:ur,action:xt.None,status:-1},y,b,x,C,_=Object.assign({},r),w=kn.createEmpty(),T,A,D=-1,E,M;function F(j,Q,J){if(!J&&!T)throw new Error("missing structure");if(b=Object.assign({},_,Q),x=j,C=J,mu.reset(h),!y||!T){h.createNew=!0,h.createGeometry=!0;return}s(h,b,_,x,w,C,T),ke.areEquivalent(C,T)||(h.createGeometry=!0),ke.areHierarchiesEqual(C,T)||(h.updateTransform=!0,h.createGeometry=!0),du.areEqual(j.color,w.color)||(h.updateColor=!0),Eu(b.unitKinds,_.unitKinds)||(h.createGeometry=!0),T.child!==C.child&&(h.createGeometry=!0),h.updateSize&&!("uSize"in y.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}function O(j){if(h.createNew)if(E=a(C),j)y=O2e(C,j,E,x,b,t),M=v(j,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(h.updateTransform){E=a(C);var Q=E.instanceCount,J=E.groupCount;Fo(Q*J,y.values)}if(h.createGeometry)if(j)R.updateIfChanged(y.values.drawCount,ya.getDrawCount(j)),R.updateIfChanged(y.values.uVertexCount,ya.getVertexCount(j));else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(m(y.values,j||A),M=v(A,y.values)),h.updateSize&&"uSize"in y.values&&Hu(E,x.size,y.values),h.updateColor&&ao(E,M,x.color,y.values),d(y.values,b),p(y.state,b)}_=b,w=x,T=C,j&&(A=j,D+=1)}function U(j){return!!(jo(j)||ke.isLoci(j)&&ke.areRootsEquivalent(j.structure,T)||_e.is(j)&&ke.areRootsEquivalent(j.structure,T)&&_e.isWholeStructure(j))}function N(j,Q,J){return U(j)?Q(Se.ofBounds(0,E.groupCount*E.instanceCount)):o(j,T,Q,J)}function q(j){y&&(c==null||c(y.values,A,_,w,j.webgl))}return{get groupCount(){return E?E.count:0},get renderObject(){return E&&E.count?y:void 0},get geometryVersion(){return D},createOrUpdate:function(j,Q,J,te){if(J===void 0&&(J={}),F(Q,J,te||T),h.createGeometry){var K=n(j,C,x,b,A);if(aA(K))return K.then(function(L){O(L),q(j)});O(K)}else O();q(j)},getLoci:function(j){return y?i(j,T,y.id):ur},mark:function(j,Q){return Kt.mark(y,j,Q,N,g)},setVisibility:function(j){Kt.setVisibility(y,j)},setAlphaFactor:function(j){Kt.setAlphaFactor(y,j)},setPickable:function(j){Kt.setPickable(y,j)},setColorOnly:function(j){Kt.setColorOnly(y,j)},setTransform:function(j,Q){Kt.setTransform(y,j,Q)},setOverpaint:function(j,Q){var J={geometry:A,props:_,webgl:Q};Kt.setOverpaint(y,j,N,!0,J)},setTransparency:function(j,Q){var J={geometry:A,props:_,webgl:Q};Kt.setTransparency(y,j,N,!0,J)},setSubstance:function(j,Q){var J={geometry:A,props:_,webgl:Q};Kt.setSubstance(y,j,N,!0,J)},setClipping:function(j){Kt.setClipping(y,j,N,!0)},destroy:function(){l==null||l(A),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var h0=I(I({},K7),zi);function Td(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:At.Utils}),t)}var k2e=I(I({},Q7),zi);function L2e(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:no.Utils}),t)}var N2e=I(I({},Z7),zi);function U2e(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Xr.Utils}),t)}var z2e=I(I({},$7),zi);function V2e(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0),n.background!==a.background&&(r.createGeometry=!0),n.backgroundMargin!==a.backgroundMargin&&(r.createGeometry=!0),n.tether!==a.tether&&(r.createGeometry=!0),n.tetherLength!==a.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==a.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==a.attachment&&(r.createGeometry=!0),n.fontFamily!==a.fontFamily&&(r.createGeometry=!0),n.fontQuality!==a.fontQuality&&(r.createGeometry=!0),n.fontStyle!==a.fontStyle&&(r.createGeometry=!0),n.fontVariant!==a.fontVariant&&(r.createGeometry=!0),n.fontWeight!==a.fontWeight&&(r.createGeometry=!0)},geometryUtils:Oo.Utils}),t)}var G2e=I(I({},J7),zi);function H2e(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ro.Utils}),t)}var q2e=I(I({},eU),zi);function j2e(e,t){return Dp(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ko.Utils}),t)}function sn(e,t,r,n){var a=0,i=t.webgl,o=new En,s=oc(),u=[],c=new Vt.GeometryState,l=ta.create(),f=new Map,d,m,p,v,h=kn.createEmpty();function g(T,A){var D=this;return T===void 0&&(T={}),A&&A!==d&&(p=r(t,A),v||(v=P.getDefaultValues(p))),v=Object.assign({},v,T),Be.create("Creating or updating UnitsRepresentation",function(E){return ie(D,void 0,void 0,function(){var M,F,O,U,N,M,F,q,O,U,U,j,O,U,M,F,q,O,U,U,Q,M,J,te,O,F,U,U,K,L,W;return ae(this,function(k){switch(k.label){case 0:if(!(!d&&!A))return[3,1];throw new Error("missing structure");case 1:if(!(A&&!d))return[3,8];m=A.unitSymmetryGroups,M=0,k.label=2;case 2:return M<m.length?(F=m[M],O=n(s,A,v,i),U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,4]):[3,7];case 3:k.sent(),k.label=4;case 4:return x(O,F,l),f.set(F.hashCode,{visual:O,group:F}),E.shouldUpdate?[4,E.update({message:"Creating or updating UnitsVisual",current:M,max:m.length})]:[3,6];case 5:k.sent(),k.label=6;case 6:return M++,[3,2];case 7:return[3,43];case 8:if(!(A&&(!ke.areUnitIdsAndIndicesEqual(A,d)||A.child!==d.child)))return[3,22];m=A.unitSymmetryGroups,N=f,f=new Map,M=0,k.label=9;case 9:return M<m.length?(F=m[M],q=N.get(F.hashCode),q?(O=q.visual,((K=O.mustRecreate)===null||K===void 0?void 0:K.call(O,{group:F,structure:A},v,i))?(O.destroy(),O=n(s,A,v,i),U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,11]):[3,12]):[3,15]):[3,21];case 10:k.sent(),k.label=11;case 11:return x(O,F,l),[3,14];case 12:return U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,14];case 13:k.sent(),k.label=14;case 14:return f.set(F.hashCode,{visual:O,group:F}),N.delete(F.hashCode),O.renderObject&&(j=O.renderObject.values.tMarker.ref.value.array,CA(j,Se.ofBounds(0,j.length),xt.RemoveHighlight)),[3,18];case 15:return O=n(s,A,v,i),U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,17];case 16:k.sent(),k.label=17;case 17:x(O,F,l),f.set(F.hashCode,{visual:O,group:F}),k.label=18;case 18:return E.shouldUpdate?[4,E.update({message:"Creating or updating UnitsVisual",current:M,max:m.length})]:[3,20];case 19:k.sent(),k.label=20;case 20:return M++,[3,9];case 21:return N.forEach(function(V){var G=V.visual;G.destroy()}),[3,43];case 22:if(!(A&&A!==d&&ke.areUnitIdsAndIndicesEqual(A,d)))return[3,34];m=A.unitSymmetryGroups,M=0,k.label=23;case 23:return M<m.length?(F=m[M],q=f.get(F.hashCode),q?(O=q.visual,((L=O.mustRecreate)===null||L===void 0?void 0:L.call(O,{group:F,structure:A},v,t.webgl))?(O.destroy(),O=n(s,A,v,t.webgl),q.visual=O,U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,25]):[3,26]):[3,29]):[3,33];case 24:k.sent(),k.label=25;case 25:return x(O,F,l),[3,28];case 26:return U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:A}),U?[4,U]:[3,28];case 27:k.sent(),k.label=28;case 28:return q.group=F,[3,30];case 29:throw new Error("expected to find visual for hashCode ".concat(F.hashCode));case 30:return E.shouldUpdate?[4,E.update({message:"Creating or updating UnitsVisual",current:M,max:m.length})]:[3,32];case 31:k.sent(),k.label=32;case 32:return M++,[3,23];case 33:return[3,43];case 34:Q=[],f.forEach(function(V){return Q.push(V)}),M=0,J=Q.length,k.label=35;case 35:return M<J?(te=Q[M],O=te.visual,F=te.group,((W=O.mustRecreate)===null||W===void 0?void 0:W.call(O,{group:F,structure:d},v,t.webgl))?(O.destroy(),O=n(s,d,v,i),Q[M].visual=O,U=O.createOrUpdate({webgl:i,runtime:E},h,v,{group:F,structure:d}),U?[4,U]:[3,37]):[3,38]):[3,43];case 36:k.sent(),k.label=37;case 37:return x(O,F,l),[3,40];case 38:return U=O.createOrUpdate({webgl:i,runtime:E},h,v),U?[4,U]:[3,40];case 39:k.sent(),k.label=40;case 40:return E.shouldUpdate?[4,E.update({message:"Creating or updating UnitsVisual",current:M,max:J})]:[3,42];case 41:k.sent(),k.label=42;case 42:return++M,[3,35];case 43:return u.length=0,f.forEach(function(V){var G=V.visual;G.renderObject&&(u.push(G.renderObject),c.add(G.renderObject.id,G.geometryVersion))}),c.snapshot(),A&&(d=A),o.next(a++),[2]}})})})}function y(T){if(T===void 0)return ke.Loci(d.target);var A=ur;return f.forEach(function(D){var E=D.visual,M=E.getLoci(T);Ja(M)||(A=M)}),A}function b(T,A){if(!d||!$a.is(l.markerActions,A))return!1;if(ke.isLoci(T)||_e.is(T)||Pt.isLoci(T)){if(!ke.areRootsEquivalent(T.structure,d))return!1;T=Ut.remap(T,d),(ke.isLoci(T)||_e.is(T)&&_e.isWholeStructure(T))&&(T=db)}else if(!jo(T)&&!e0(T))return!1;if(Ut.isEmpty(T))return!1;var D=!1;return f.forEach(function(E){var M=E.visual;D=M.mark(T,A)||D}),D}function x(T,A,D){var E=D.visible,M=D.alphaFactor,F=D.pickable,O=D.overpaint,U=D.transparency,N=D.substance,q=D.clipping,j=D.transform,Q=D.unitTransforms;E!==void 0&&T.setVisibility(E),M!==void 0&&T.setAlphaFactor(M),F!==void 0&&T.setPickable(F),O!==void 0&&T.setOverpaint(O,i),U!==void 0&&T.setTransparency(U,i),N!==void 0&&T.setSubstance(N,i),q!==void 0&&T.setClipping(q),j!==void 0&&T.setTransform(j),Q!==void 0&&(Q?T.setTransform(void 0,Q.getSymmetryGroupTransforms(A)):T.setTransform(void 0,null))}function C(T){var A=T.visible,D=T.alphaFactor,E=T.pickable,M=T.overpaint,F=T.transparency,O=T.substance,U=T.clipping,N=T.transform,q=T.unitTransforms,j=T.syncManually,Q=T.markerActions,J={};A!==l.visible&&(J.visible=A),D!==l.alphaFactor&&(J.alphaFactor=D),E!==l.pickable&&(J.pickable=E),M!==void 0&&d&&(J.overpaint=ba.remap(M,d)),F!==void 0&&d&&(J.transparency=xa.remap(F,d)),O!==void 0&&d&&(J.substance=Sa.remap(O,d)),U!==void 0&&d&&(J.clipping=Yr.remap(U,d)),N!==void 0&&!se.areEqual(N,l.transform,Ir)&&(J.transform=N),(q!==l.unitTransforms||(q==null?void 0:q.version)!==T.unitTransformsVersion)&&(J.unitTransforms=q,l.unitTransformsVersion=q?q==null?void 0:q.version:-1),j!==l.syncManually&&(J.syncManually=j),Q!==l.markerActions&&(J.markerActions=Q),f.forEach(function(te){var K=te.visual,L=te.group;return x(K,L,J)}),ta.update(l,J)}function _(T){h=T}function w(){f.forEach(function(T){var A=T.visual;return A.destroy()}),f.clear()}return{label:e,get groupCount(){var T=0;return f.forEach(function(A){var D=A.visual;D.renderObject&&(T+=D.groupCount)}),T},get geometryVersion(){return c.version},get props(){return v},get params(){return p},get state(){return l},get theme(){return h},renderObjects:u,updated:o,createOrUpdate:g,setState:C,setTheme:_,getLoci:y,mark:b,destroy:w}}function W2e(e,t,r,n,a,i){var o=ya.getUtils(t),s=o.createValues,u=o.createRenderableState,c=j7(e,a.includeParent),l=s(t,c,r,n,a),f=u(a);return np(t.kind,l,f,i)}function Pd(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.processValues,l=e.dispose,f=e.geometryUtils,d=f.createEmpty,m=f.updateValues,p=f.updateBoundingSphere,v=f.updateRenderableState,h=f.createPositionIterator,g=mu.create(),y={loci:ur,action:xt.None,status:-1},b,x=Object.assign({},r),C=kn.createEmpty(),_,w,T,A,D,E=-1,M,F;function O(J,te,K){if(!K&&!A)throw new Error("missing structureGroup");if(x=te,C=J,_=K,mu.reset(g),!b||!A){g.createNew=!0,g.createGeometry=!0;return}s(g,x,w,C,T,_,A),ke.areHierarchiesEqual(A.structure,_.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),du.areEqual(C.color,T.color)||(g.updateColor=!0),A.structure.child!==_.structure.child&&(g.createGeometry=!0),Eu(x.unitKinds,w.unitKinds)||(g.createGeometry=!0),_.group.transformHash!==A.group.transformHash&&(_.group.units.length!==A.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var L=_.group.units[0],W=A.group.units[0];Re.areOperatorsEqual(L,W)||(g.updateTransform=!0),Re.areConformationsEqual(L,W)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in b.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(A.structure.hashCode!==_.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(C.color.granularity.startsWith("vertex")||b.values.dColorType.ref.value.startsWith("vertex")||C.color.granularity.startsWith("volume")||b.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function U(J){if(g.createNew)if(M=a(_),J)b=W2e(_,J,M,C,x,t),F=h(J,b.values);else throw new Error("expected geometry to be given");else{if(!b)throw new Error("expected renderObject to be available");if(g.updateTransform){M=a(_);var te=M.instanceCount,K=M.groupCount;Fo(te*K,b.values)}if(g.updateMatrix&&j7(_,x.includeParent,b.values),g.createGeometry)if(J)R.updateIfChanged(b.values.drawCount,ya.getDrawCount(J)),R.updateIfChanged(b.values.uVertexCount,ya.getVertexCount(J));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(p(b.values,J||D),F=h(J||D,b.values)),g.updateSize&&"uSize"in b.values&&Hu(M,C.size,b.values),g.updateColor&&ao(M,F,C.color,b.values),m(b.values,x),v(b.state,x)}w=x,T=C,A=_,J&&(D=J,E+=1)}function N(J,te,K,L,W,k){return E2e(W.unitKinds,te)?n(J,te,K,L,W,k):d(k)}function q(J){return!!(jo(J)||ke.isLoci(J)&&ke.areRootsEquivalent(J.structure,A.structure)||_e.is(J)&&ke.areRootsEquivalent(J.structure,A.structure)&&_e.isWholeStructure(J))}function j(J,te,K){return q(J)?te(Se.ofBounds(0,M.groupCount*M.instanceCount)):o(J,A,te,K)}function Q(J){b&&(c==null||c(b.values,D,w,T,J.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?b:void 0},get geometryVersion(){return E},createOrUpdate:function(J,te,K,L){if(O(te,K,L||A),g.createGeometry){var W=N(J,_.group.units[0],_.structure,C,x,D);if(aA(W))return W.then(function(k){U(k),Q(J)});U(W)}else U();Q(J)},getLoci:function(J){return b?i(J,A,b.id):ur},mark:function(J,te){var K=!0;if(_e.is(J)){K=!1;for(var L=A.group.units[0].invariantId,W=0,k=J.elements;W<k.length;W++){var V=k[W];if(V.unit.invariantId===L){K=!0;break}}}return K?Kt.mark(b,J,te,j,y):!1},setVisibility:function(J){Kt.setVisibility(b,J)},setAlphaFactor:function(J){Kt.setAlphaFactor(b,J)},setPickable:function(J){Kt.setPickable(b,J)},setColorOnly:function(J){Kt.setColorOnly(b,J)},setTransform:function(J,te){Kt.setTransform(b,J,te)},setOverpaint:function(J,te){var K={geometry:D,props:w,webgl:te};Kt.setOverpaint(b,J,j,!0,K)},setTransparency:function(J,te){var K={geometry:D,props:w,webgl:te};Kt.setTransparency(b,J,j,!0,K)},setSubstance:function(J,te){var K={geometry:D,props:w,webgl:te};Kt.setSubstance(b,J,j,!0,K)},setClipping:function(J){Kt.setClipping(b,J,j,!0)},destroy:function(){l==null||l(D),b&&(b.state.disposed=!0,b=void 0)},mustRecreate:u}}var Na=I(I({},K7),zi);function xi(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:At.Utils}),t)}var tU=I(I({},B2e),zi);function rU(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Tl.Utils}),t)}var nU=I(I({},Q7),zi);function aU(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:no.Utils}),t)}var X2e=I(I({},F2e),zi);function Y2e(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Qf.Utils}),t)}var $b=I(I({},Z7),zi);function Jb(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.updateSize=!0)},geometryUtils:Xr.Utils}),t)}I(I({},$7),zi);var K2e=I(I({},J7),zi);function Q2e(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ro.Utils}),t)}var Z2e=I(I({},eU),zi);function $2e(e,t){return Pd(I(I({},e),{setUpdateState:function(r,n,a,i,o,s,u){e.setUpdateState(r,n,a,i,o,s,u),ea.areEqual(i.size,o.size)||(r.createGeometry=!0)},geometryUtils:ko.Utils}),t)}var ta={create:function(){return I(I({},Vt.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){Vt.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function ri(e){return e}var e2=S(),t2=S(),Ed=S(),DT=Me.add,iU=Me.add3,r2;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Me.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r),o=Me.create(Float32Array,3,n,a?a.startBuffer.ref.value:r),s=Me.create(Float32Array,3,n,a?a.endBuffer.ref.value:r),u=Me.create(Float32Array,1,n,a?a.scaleBuffer.ref.value:r),c=Me.create(Float32Array,1,n,a?a.capBuffer.ref.value:r),l=function(d,m,p,v,h,g,y,b,x,C){for(var _=0;_<6;++_)iU(o,d,m,p),iU(s,v,h,g),DT(i,C),DT(u,y),DT(c,(b?1:0)+(x?2:0))},f=function(d,m,p,v,h,g,y){var b=S.distance(d,m),x=Math.floor(p/2),C=1/p;S.sub(Ed,m,d);for(var _=0;_<x;++_){var w=C*(_*2+1);S.setMagnitude(Ed,Ed,b*w),S.add(e2,d,Ed),S.setMagnitude(Ed,Ed,b*C*((_+1)*2)),S.add(t2,d,Ed),l(e2[0],e2[1],e2[2],t2[0],t2[1],t2[2],v,h,g,y)}};return{add:l,addFixedCountDashes:f,addFixedLengthDashes:function(d,m,p,v,h,g,y){var b=S.distance(d,m);f(d,m,b/p,v,h,g,y)},getCylinders:function(){var d=i.elementCount/6,m=Me.compact(i,!0),p=Me.compact(o,!0),v=Me.compact(s,!0),h=Me.compact(u,!0),g=Me.compact(c,!0),y=a&&d<=a.cylinderCount?a.mappingBuffer.ref.value:new Float32Array(d*18),b=a&&d<=a.cylinderCount?a.indexBuffer.ref.value:new Uint32Array(d*12);return(!a||d>a.cylinderCount)&&J2e(d,y,b),no.create(y,b,m,p,v,h,g,d,a)}}}e.create=t})(r2||(r2={}));function J2e(e,t,r){for(var n=0;n<e;++n){var a=n*18;t[a]=-1,t[a+1]=1,t[a+2]=-1,t[a+3]=-1,t[a+4]=-1,t[a+5]=-1,t[a+6]=1,t[a+7]=1,t[a+8]=-1,t[a+9]=1,t[a+10]=1,t[a+11]=1,t[a+12]=1,t[a+13]=-1,t[a+14]=-1,t[a+15]=1,t[a+16]=-1,t[a+17]=1}for(var n=0;n<e;++n){var i=n*6,o=n*12;r[o]=i,r[o+1]=i+1,r[o+2]=i+2,r[o+3]=i+1,r[o+4]=i+4,r[o+5]=i+2,r[o+6]=i+2,r[o+7]=i+4,r[o+8]=i+3,r[o+9]=i+4,r[o+10]=i+5,r[o+11]=i+3}}var Id={linkScale:P.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:P.Numeric(1,{min:0,max:2,step:.01}),linkCap:P.Boolean(!1),aromaticScale:P.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:P.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:P.Numeric(2,{min:2,max:6,step:2}),dashCount:P.Numeric(4,{min:2,max:10,step:2}),dashScale:P.Numeric(.8,{min:0,max:2,step:.1}),dashCap:P.Boolean(!0),stubCap:P.Boolean(!0),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo)};P.getDefaultValues(Id);var oU={linkScale:P.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:P.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:P.Numeric(2,{min:2,max:6,step:2}),dashCount:P.Numeric(4,{min:2,max:10,step:2})};P.getDefaultValues(oU);var cr=S(),jl=S(),Ko=S(),exe=S.create(0,1,0);function MT(e,t,r,n){S.normalize(jl,S.sub(jl,t,r)),n!==null?S.sub(Ko,t,n):S.copy(Ko,t),S.normalize(Ko,Ko);var a=S.dot(jl,Ko);return 1-Math.abs(a)<1e-5&&(S.set(Ko,1,0,0),a=S.dot(jl,Ko),1-Math.abs(a)<1e-5&&(S.set(Ko,0,1,0),a=S.dot(jl,Ko))),S.setMagnitude(jl,jl,a),S.sub(Ko,Ko,jl),S.normalize(e,Ko)}var co=S.scale,wa=S.add,Kr=S.sub,Ua=S.setMagnitude,txe=S.dot;function Dd(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return At.createEmpty(n);for(var f=r.linkScale,d=r.linkSpacing,m=r.radialSegments,p=r.linkCap,v=r.aromaticScale,h=r.aromaticSpacing,g=r.aromaticDashCount,y=r.dashCount,b=r.dashScale,x=r.dashCap,C=r.stubCap,_=m*2*a*2,w=it.createState(_,_/4,n),T=S(),A=S(),D=S(),E={radiusTop:1,radiusBottom:1,radialSegments:m,topCap:p,bottomCap:p},M=y+1,F=0,O=a;F<O;++F)if(!(c&&c(F))){o(T,A,F),Kr(cr,A,T);var U=txe(cr,exe)>0,N=u(F),q=s?s(F):0,j=C&&(l?l(F):!1),Q=U?[j,p]:[p,j],J=Q[0],te=Q[1];w.currentGroup=F;var K=g+1;if(q===0)E.radiusTop=E.radiusBottom=N,E.topCap=J,E.bottomCap=te,la(w,T,A,.5,E);else if(q===1)E.radiusTop=E.radiusBottom=N*b,E.topCap=E.bottomCap=x,Ph(w,T,A,.5,M,E);else if(q===2||q===3||q===4||q===5||q===7||q===8){var L=q===2||q===3?2:q===4||q===5?3:1.5,W=N*(f/(.5*L)),k=(N-W)*d;if(MT(D,T,A,i?i(F):null),E.topCap=J,E.bottomCap=te,q===7||q===8){E.radiusTop=E.radiusBottom=N,la(w,T,A,.5,E);var V=N+v*N+v*N*h;Ua(cr,Kr(cr,A,T),N*.5),wa(T,T,cr),Kr(A,A,cr),E.radiusTop=E.radiusBottom=N*v,E.topCap=E.bottomCap=x,Ua(D,D,V),Kr(T,T,D),Kr(A,A,D),Ph(w,T,A,.5,K,E),q===8&&(Ua(D,D,V*2),wa(T,T,D),wa(A,A,D),Ph(w,T,A,.5,K,E))}else if(q===3||q===5){var G=N+W+f*N*d;Ua(D,D,G),E.radiusTop=E.radiusBottom=N,la(w,T,A,.5,E),co(cr,cr,d*f*.2),wa(T,T,cr),Kr(A,A,cr),E.radiusTop=E.radiusBottom=W,E.topCap=U?j:x,E.bottomCap=U?x:j,Ua(D,D,G),Kr(T,T,D),Kr(A,A,D),la(w,T,A,.5,E),L===3&&(Ua(D,D,G*2),wa(T,T,D),wa(A,A,D),la(w,T,A,.5,E))}else Ua(D,D,k),E.radiusTop=E.radiusBottom=W,L===3&&la(w,T,A,.5,E),fne(w,T,A,.5,D,E)}else q===6&&(co(cr,cr,.475),wa(T,T,cr),Kr(A,A,cr),E.radiusTop=E.radiusBottom=N,E.topCap=J,E.bottomCap=te,la(w,T,A,.5,E))}return it.getMesh(w)}function sU(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.radius,c=t.ignore,l=t.stub;if(!a)return no.createEmpty(n);for(var f=r.linkScale,d=r.linkSpacing,m=r.linkCap,p=r.aromaticScale,v=r.aromaticSpacing,h=r.aromaticDashCount,g=r.dashCount,y=r.dashScale,b=r.dashCap,x=r.stubCap,C=a*2,_=r2.create(C,C/4,n),w=S(),T=S(),A=S(),D=S(),E=g%2==1?g:g+1,M=.5-.5/2/E,F=h+1,O=.5-.5/2/F,U=0,N=a;U<N;++U)if(!(c&&c(U))){o(w,T,U);var q=u(U),j=s?s(U):0,Q=x&&(l?l(U):!1);if(j===0)co(A,wa(A,w,T),.5),_.add(w[0],w[1],w[2],A[0],A[1],A[2],1,m,Q,U);else if(j===1)co(cr,Kr(cr,T,w),M),Kr(T,T,cr),_.addFixedCountDashes(w,T,E,y,b,b,U);else if(j===2||j===3||j===4||j===5||j===7||j===8){var J=j===2||j===3?2:j===4||j===5?3:1.5,te=f/(.5*J),K=(q-te*q)*d;if(co(A,wa(A,w,T),.5),MT(D,w,T,i?i(U):null),j===7||j===8){_.add(w[0],w[1],w[2],A[0],A[1],A[2],1,m,Q,U);var L=q+p*q+p*q*v;co(cr,Kr(cr,T,w),O),Kr(T,T,cr),Ua(cr,Kr(cr,T,w),q*.5),wa(w,w,cr),Ua(D,D,L),Kr(w,w,D),Kr(T,T,D),_.addFixedCountDashes(w,T,F,p,b,b,U),j===8&&(Ua(D,D,L*2),wa(w,w,D),wa(T,T,D),_.addFixedCountDashes(w,T,F,p,b,b,U))}else if(j===3||j===5){var W=q+te*q+f*q*d;Ua(D,D,W),_.add(w[0],w[1],w[2],A[0],A[1],A[2],1,m,Q,U),Ua(cr,Kr(cr,w,T),q/1.5),Kr(w,w,cr),J===3&&_.add(w[0]+D[0],w[1]+D[1],w[2]+D[2],A[0]+D[0],A[1]+D[1],A[2]+D[2],te,m,Q,U),_.add(w[0]-D[0],w[1]-D[1],w[2]-D[2],A[0]-D[0],A[1]-D[1],A[2]-D[2],te,b,Q,U)}else Ua(D,D,K),J===3&&_.add(w[0],w[1],w[2],A[0],A[1],A[2],te,m,Q,U),_.add(w[0]+D[0],w[1]+D[1],w[2]+D[2],A[0]+D[0],A[1]+D[1],A[2]+D[2],te,m,Q,U),_.add(w[0]-D[0],w[1]-D[1],w[2]-D[2],A[0]-D[0],A[1]-D[1],A[2]-D[2],te,m,Q,U)}else j===6&&(co(cr,Kr(cr,T,w),.475),wa(w,w,cr),Kr(T,T,cr),_.add(w[0],w[1],w[2],T[0],T[1],T[2],1,m,Q,U))}return _.getCylinders()}function uU(e,t,r,n){var a=t.linkCount,i=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!a)return Xr.createEmpty(n);for(var c=r.linkScale,l=r.linkSpacing,f=r.aromaticDashCount,d=r.dashCount,m=a*2,p=Bi.create(m,m/4,n),v=S(),h=S(),g=S(),y=S(),b=d%2==1?d:d+1,x=.5-.5/2/b,C=f+1,_=.5-.5/2/C,w=4.5,T=3,A=0,D=a;A<D;++A)if(!(u&&u(A))){o(v,h,A);var E=s?s(A):0;if(E===0)co(g,wa(g,v,h),.5),p.add(v[0],v[1],v[2],g[0],g[1],g[2],A);else if(E===1)co(cr,Kr(cr,h,v),x),Kr(h,h,cr),p.addFixedCountDashes(v,h,b,A);else if(E===2||E===3||E===4||E===5||E===7||E===8){var M=E===2||E===3?2:E===4||E===5?3:1.5,F=1*(c/(.5*M)),O=(1-F)*l;co(g,wa(g,v,h),.5),MT(y,v,h,i?i(A):null),E===7||E===8?(p.add(v[0],v[1],v[2],g[0],g[1],g[2],A),co(cr,Kr(cr,h,v),_),Kr(h,h,cr),Ua(y,y,O*w),Kr(v,v,y),Kr(h,h,y),p.addFixedCountDashes(v,h,C,A),E===8&&(Ua(y,y,O*w*2),wa(v,v,y),wa(h,h,y),p.addFixedCountDashes(v,h,C,A))):E===3||E===5?(Ua(y,y,O*T),p.add(v[0],v[1],v[2],g[0],g[1],g[2],A),co(cr,Kr(cr,v,h),l*c),Kr(v,v,cr),M===3&&p.add(v[0]+y[0],v[1]+y[1],v[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],A),p.add(v[0]-y[0],v[1]-y[1],v[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],A)):(Ua(y,y,O*1.5),M===3&&p.add(v[0],v[1],v[2],g[0],g[1],g[2],A),p.add(v[0]+y[0],v[1]+y[1],v[2]+y[2],g[0]+y[0],g[1]+y[1],g[2]+y[2],A),p.add(v[0]-y[0],v[1]-y[1],v[2]-y[2],g[0]-y[0],g[1]-y[1],g[2]-y[2],A))}else E===6&&(co(cr,Kr(cr,h,v),.475),wa(v,v,cr),Kr(h,h,cr),p.add(v[0],v[1],v[2],h[0],h[1],h[2],A))}return p.getLines()}function rxe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T;return ae(this,function(A){return Re.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,At.createEmpty(i)]:(u=Qe.create(r,t),c=pn.get(r).value,l=c.unitsFeatures.get(t.id),f=c.unitsContacts.get(t.id),d=l.x,m=l.y,p=l.z,v=l.members,h=l.offsets,g=f.edgeCount,y=f.a,b=f.b,x=f.edgeProps.flag,C=a.sizeFactor,g?(_={linkCount:g*2,position:function(D,E,M){S.set(D,d[y[M]],m[y[M]],p[y[M]]),S.set(E,d[b[M]],m[b[M]],p[b[M]])},style:function(D){return 1},radius:function(D){u.element=t.elements[v[h[y[D]]]];var E=n.size.size(u);u.element=t.elements[v[h[b[D]]]];var M=n.size.size(u);return Math.min(E,M)*C},ignore:function(D){if(x[D]===1)return!0;if(s)for(var E=y[D],M=h[E],F=h[E+1];M<F;++M){var O=t.elements[v[h[M]]];if(!Le.has(s.elements,O))return!0}return!1}},w=Dd(e,_,a,i),T=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*C),w.setBoundingSphere(T),[2,w]):[2,At.createEmpty(i)])):[2,At.createEmpty(i)]})})}var cU=I(I(I({},Na),Id),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),dashCount:P.Numeric(6,{min:2,max:10,step:2}),dashScale:P.Numeric(.4,{min:0,max:2,step:.1}),includeParent:P.Boolean(!1)});function nxe(e){return xi({defaultProps:P.getDefaultValues(cU),createGeometry:rxe,createLocationIterator:oxe,getLoci:axe,eachLocation:ixe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=pn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function axe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[a].id),c=pn.get(o).value,l=c.unitsContacts.get(u.id),f=l.a,d=l.b;return Cc.Loci(o,c,[{unitA:u,indexA:f[i],unitB:u,indexB:d[i]},{unitA:u,indexA:d[i],unitB:u,indexB:f[i]}])}return ur}var RT=new Set;function ixe(e,t,r,n){var a=!1;if(Cc.isLoci(e)){var i=t.structure,o=t.group;if(!ke.areEquivalent(e.data.structure,i))return!1;var s=pn.get(i).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],c=s.unitsContacts.get(u.id),l=c.edgeCount*2,f=0,d=e.elements;f<d.length;f++){var m=d[f];if(m.unitA===m.unitB){var p=o.unitIndexMap.get(m.unitA.id);if(p!==void 0){var v=c.getDirectedEdgeIndex(m.indexA,m.indexB);v!==-1&&r(Se.ofSingleton(p*l+v))&&(a=!0)}}}}else if(_e.is(e)){var i=t.structure,o=t.group;if(!ke.areEquivalent(e.structure,i))return!1;var s=pn.get(i).value;if(!s)return!1;for(var u=o.units[0],h=s.unitsContacts.get(u.id),g=s.unitsFeatures.get(u.id),y=h.edgeCount*2,b=h.offset,x=g.elementsIndex,C=x.offsets,_=x.indices,w=g.members,T=g.offsets,A=function(N){var q=o.unitIndexMap.get(N.unit.id);if(q===void 0)return"continue";De.forEach(N.indices,function(j){for(var Q=C[j],J=C[j+1];Q<J;++Q)for(var te=_[Q],K=b[te],L=b[te+1];K<L;++K)RT.add(K)}),RT.forEach(function(j){if(n){for(var Q=h.a[j],J=T[Q],te=T[Q+1];J<te;++J)if(!De.has(N.indices,w[J]))return;for(var K=h.b[j],J=T[K],te=T[K+1];J<te;++J)if(!De.has(N.indices,w[J]))return}r(Se.ofSingleton(q*y+j))&&(a=!0)}),RT.clear()},D=0,E=e.elements;D<E.length;D++){var m=E[D];A(m)}}return a}function oxe(e){var t=e.structure,r=e.group,n=r.units[0],a=pn.get(t).value,i=a.unitsContacts.get(n.id),o=i.edgeCount*2,s=r.units.length,u=Cc.Location(a,t),c=u.element,l=function(f,d){var m=r.units[d];return c.unitA=m,c.indexA=i.a[f],c.unitB=m,c.indexB=i.b[f],u};return Wr(o,s,1,l)}function sxe(e,t,r,n,a){if(!t.hasAtomic)return At.createEmpty(a);var i=Qe.create(t),o=pn.get(t).value,s=o.contacts,u=o.unitsFeatures,c=s.edgeCount,l=s.edges,f=n.sizeFactor;if(!c)return At.createEmpty(a);var d=t.child,m={linkCount:c,position:function(h,g,y){var b=l[y],x=b.unitA,C=b.indexA,_=b.unitB,w=b.indexB,T=u.get(x),A=u.get(_),D=t.unitMap.get(x),E=t.unitMap.get(_);S.set(h,T.x[C],T.y[C],T.z[C]),S.transformMat4(h,h,D.conformation.operator.matrix),S.set(g,A.x[w],A.y[w],A.z[w]),S.transformMat4(g,g,E.conformation.operator.matrix)},style:function(h){return 1},radius:function(h){var g=l[h],y=u.get(g.unitA);i.unit=t.unitMap.get(g.unitA),i.element=i.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(i),x=u.get(g.unitB);i.unit=t.unitMap.get(g.unitB),i.element=i.unit.elements[x.members[x.offsets[g.indexB]]];var C=r.size.size(i);return Math.min(b,C)*f},ignore:function(h){if(l[h].props.flag===1)return!0;if(d){var g=l[h],y=d.unitMap.get(g.unitA);if(!y)return!0;for(var b=t.unitMap.get(g.unitA),x=u.get(g.unitA),C=x.offsets,_=x.members,w=C[g.indexA],T=C[g.indexA+1];w<T;++w){var A=b.elements[_[w]];if(!Le.has(y.elements,A))return!0}}return!1}},p=Dd(e,m,n,a),v=Te.expand(Te(),(d!=null?d:t).boundary.sphere,1*f);return p.setBoundingSphere(v),p}var lU=I(I(I({},h0),Id),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),dashCount:P.Numeric(6,{min:2,max:10,step:2}),dashScale:P.Numeric(.4,{min:0,max:2,step:.1}),includeParent:P.Boolean(!1)});function uxe(e){return Td({defaultProps:P.getDefaultValues(lU),createGeometry:sxe,createLocationIterator:fxe,getLoci:cxe,eachLocation:lxe,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=pn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function cxe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=pn.get(t).value,o=i.contacts.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Cc.Loci(t,i,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return ur}var n2=new Map,BT=new Set;function lxe(e,t,r,n){var a=!1;if(Cc.isLoci(e)){if(!ke.areEquivalent(e.data.structure,t))return!1;var i=pn.get(t).value;if(e.data.interactions!==i)return!1;for(var o=i.contacts,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=o.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);l!==-1&&r(Se.ofSingleton(l))&&(a=!0)}}else if(_e.is(e)){if(!ke.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var i=pn.get(t).value;if(!i)return!1;for(var f=i.contacts,d=i.unitsFeatures,m=0,p=e.elements;m<p.length;m++){var v=p[m];n2.set(v.unit.id,v.indices)}for(var h=function(x){var C=x.unit;if(!Re.isAtomic(C))return"continue";De.forEach(x.indices,function(_){for(var w=0,T=f.getContactIndicesForElement(_,C);w<T.length;w++){var A=T[w];BT.add(A)}})},g=0,y=e.elements;g<y.length;g++){var v=y[g];h(v)}BT.forEach(function(x){if(n){var C=f.edges[x],_=C.indexA,w=C.unitA,T=C.indexB,A=C.unitB,D=n2.get(w),E=n2.get(A);if(!D||!E)return;for(var M=d.get(w),F=M.offsets,O=M.members,U=F[_],N=F[_+1];U<N;++U)if(!De.has(D,O[U]))return;for(var q=d.get(A),j=q.offsets,Q=q.members,U=j[T],N=j[T+1];U<N;++U)if(!De.has(E,Q[U]))return}r(Se.ofSingleton(x))&&(a=!0)}),n2.clear(),BT.clear()}return a}function fxe(e){var t=pn.get(e).value,r=t.contacts,n=r.edgeCount,a=1,i=Cc.Location(t,e),o=i.element,s=function(u){var c=r.edges[u];return o.unitA=e.unitMap.get(c.unitA),o.indexA=c.indexA,o.unitB=e.unitMap.get(c.unitB),o.indexB=c.indexB,i};return Wr(n,a,1,s,!0)}var fU={"intra-unit":function(e,t){return sn("Intra-unit interactions cylinder",e,t,nxe)},"inter-unit":function(e,t){return Ps("Inter-unit interactions cylinder",e,t,uxe)}},dU=I(I(I({},cU),lU),{unitKinds:v0(["atomic"]),sizeFactor:P.Numeric(.2,{min:.01,max:1,step:.01}),visuals:P.MultiSelect(["intra-unit","inter-unit"],P.objectToOptions(fU))});function dxe(e,t){return P.clone(dU)}function mxe(e,t){return Vt.createMulti("Interactions",e,t,ta,fU)}var a2=ri({name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:mxe,getParams:dxe,defaultValues:P.getDefaultValues(dU),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&pn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return pn.attach(e,t,void 0,!0)},detach:function(e){return pn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}}),pxe=xr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=pn,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(!!c){var l=_e.remap(n,u);if(l.elements.length===1){var f=l.elements[0];if(De.size(f.indices)===1){var d=c.unitsFeatures.get(f.unit.id);if(!!d){for(var m=[],p=[],v=[],h=De.start(f.indices),g=d.types,y=d.groups,b=d.elementsIndex,x=b.indices,C=b.offsets,_=C[h],w=C[h+1];_<w;++_){var T=x[_],A=g[T],D=y[T];A&&m.push(I1e(A)),D&&p.push(D1e(D))}m.length&&v.push("<small>Types</small> ".concat(m.join(", "))),p.length&&v.push("<small>Groups</small> ".concat(p.join(", "))),v.length&&a.push("Interaction Feature: ".concat(v.join(" | ")))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(Yt.Generators.ofType(fe.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var c=u[s];c.obj&&gn(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(PT),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(a2)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(PT),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(a2)},t}(xr.Handler),params:function(){return{autoAttach:P.Boolean(!1),showTooltip:P.Boolean(!0)}}}),vxe=xr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=zo,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(xr.Handler),params:function(){return{autoAttach:P.Boolean(!1)}}}),hxe=xr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=d0,r.labelProvider={label:function(n){if(!!r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var a=[],i=r.getStructures(n.structure),o=0,s=i;o<s.length;o++){var u=s[o],c=r.provider.get(u).value;if(!!c){var l=_e.remap(n,u);if(l.elements.length===1){var f=l.elements[0];if(De.size(f.indices)===1){var d=c.get(f.unit.id);if(!!d){var m=De.start(f.indices),p=d.charge[m],v=d.idealGeometry[m],h=d.implicitH[m],g=d.totalH[m];a.push("Valence Model: <small>Charge</small> ".concat(p," | <small>Ideal Geometry</small> ").concat(C1e(v)," | <small>Implicit H</small> ").concat(h," | <small>Total H</small> ").concat(g))}}}}}return a.length?a.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],a=this.ctx.helpers.substructureParent.get(r);if(a)for(var i=this.ctx.state.data,o=i.select(Yt.Generators.ofType(fe.Molecule.Structure,a.transform.ref)),s=0,u=o;s<u.length;s++){var c=u[s];c.obj&&gn(n,c.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(xr.Handler),params:function(){return{autoAttach:P.Boolean(!1),showTooltip:P.Boolean(!0)}}}),_c;(function(e){var t=this;e.Provider=up.createProvider({label:"Best Database Sequence Mapping",descriptor:to({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(i){var o,s;return Or.is(i.sourceData)&&((s=(o=i.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("pdbx_sifts_xref_db_name"))>=0},obtain:function(i,o){return ie(t,void 0,void 0,function(){return ae(this,function(s){return[2,{value:a(o)}]})})}});function r(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=i.unit.elements[i.element],c=o.atomicHierarchy.residueAtomSegments.index[u];return s.accession[c]}e.getKey=r;function n(i){var o=i.unit.model,s=e.Provider.get(o).value;if(!!s){var u=i.unit.elements[i.element],c=o.atomicHierarchy.residueAtomSegments.index[u],l=s.dbName[c];if(!!l)return"".concat(l," ").concat(s.accession[c]," ").concat(s.num[c]," ").concat(s.residue[c])}}e.getLabel=n;function a(i){if(!!Or.is(i.sourceData)){var o=i.sourceData.data.frame.categories.atom_site,s=o.getField("pdbx_sifts_xref_db_name"),u=o.getField("pdbx_sifts_xref_db_acc"),c=o.getField("pdbx_sifts_xref_db_num"),l=o.getField("pdbx_sifts_xref_db_res");if(!(!s||!u||!c||!l)){for(var f=i.atomicHierarchy.atomSourceIndex,d=i.atomicHierarchy.residueAtomSegments,m=d.count,p=d.offsets,v=new Array(m),h=new Array(m),g=new Array(m),y=new Array(m),b=0;b<m;b++){var x=f.value(p[b]);if(s.valueKind(x)!==0){v[b]="",h[b]="",g[b]=0,y[b]="";continue}v[b]=s.str(x),h[b]=u.str(x),g[b]=c.int(x),y[b]=l.str(x)}return{dbName:v,accession:h,num:g,residue:y}}}}})(_c||(_c={}));var FT=st(16448250),gxe="Assigns a color based on best dababase sequence mapping.",g0=new Map,mU=I({},so({type:"colors",colorList:"set-1"}));function yxe(e){return mU}function pU(e,t){var r;if(e.structure){for(var n=0,a=e.structure.models;n<a.length;n++){var i=a[n],o=_c.Provider.get(i).value;if(!!o)for(var s=0,u=o.accession;s<u.length;s++){var c=u[s];!c||g0.has(c)||g0.set(c,g0.size)}}var l=Qe.create(e.structure),f=qo(g0.size+1,t,{valueLabel:function(p){return"".concat(p)}}),d=new Map,m=function(p){var v=_c.getKey(p);if(!v)return FT;if(d.has(v))return d.get(v);var h=f.color(g0.get(v));return d.set(v,h),h};r=function(p){return Qe.is(p)&&Re.isAtomic(p.unit)?m(p):Pt.isLocation(p)?(l.unit=p.aUnit,l.element=p.aUnit.elements[p.aIndex],m(l)):FT}}else r=function(){return FT};return{factory:pU,granularity:"group",preferSmoothing:!0,color:r,props:t,description:gxe}}var vU={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:pU,getParams:yxe,defaultValues:P.getDefaultValues(mU),isApplicable:function(e){var t;return!!((t=e.structure)===null||t===void 0?void 0:t.models.some(function(r){return _c.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n,a;return ae(this,function(i){switch(i.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,i.label=1;case 1:return r<n.length?(a=n[r],[4,_c.Provider.attach(e,a,void 0,!0)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(!!e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];_c.Provider.ref(n,!1)}}}},bxe=xr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=_c.Provider,r.labelProvider={label:function(n){if(!!r.params.showTooltip)return xxe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(vU),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(vU),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(xr.Handler),params:function(){return{autoAttach:P.Boolean(!0),showTooltip:P.Boolean(!0)}}});function xxe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=Qe.create(e.structure,r,r.elements[De.getAt(t.indices,0)]);return _c.getLabel(n)}}var wc;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=_s.create(e.Descriptor);function t(r,n){var a={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(p,v,h){var g=p.get(v);g?g.push(h):p.set(v,[h])}function s(p,v){var h=v.entity_id.value(p),g=v.asym_id.value(p),y=v.seq_id.value(p);if(r.model_granularity.value(p)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:v.atom_id.value(p),label_entity_id:h});b>=0&&o(c,b,p)}else if(n.coarseHierarchy.isDefined){var x=n.coarseHierarchy.spheres.findSequenceKey(h,g,y);if(x>=0)o(l,x,p);else{var C=n.coarseHierarchy.gaussians.findSequenceKey(h,g,y);C>=0&&o(f,C,p)}}}function u(p){switch(p){case 0:return c;case 1:return l;case 2:return f}}for(var c=new Map,l=new Map,f=new Map,d=[],m=0;m<r._rowCount;++m)s(m,a),s(m,i);return{getIndicesByElement:function(p,v){var h=u(v),g=h.get(p);return g!==void 0?g:d},data:r}}e.fromTable=t})(wc||(wc={}));var Sxe=[];function hU(e,t,r,n){return"".concat(e,"|").concat(t.id,"|").concat(r,"|").concat(n.id)}var gU=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,a){var i=hU(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(i);o?o.push(a):r.set(i,[a])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,a){var i=hU(t,r,n,a);return this.pairKeyIndices.get(i)||Sxe},e.prototype.getPairs=function(t,r,n,a){var i=this,o=this.getPairIndices(t,r,n,a);return o.map(function(s){return i.pairs[s]})},e}(),Ac=Ol.createProvider({label:"Cross Link Restraint",descriptor:to({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!wc.Provider.get(t)})},obtain:function(e,t,r){return ie(void 0,void 0,void 0,function(){return ae(this,function(n){return[2,{value:wxe(t)}]})})}}),Es;(function(e){(function(p){p.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(p){return p.models.some(function(v){return!!wc.Provider.get(v)})}e.isApplicable=t;var r=S(),n=S();function a(p){return p.unitA.conformation.position(p.unitA.elements[p.indexA],r),p.unitB.conformation.position(p.unitB.elements[p.indexB],n),S.distance(r,n)}e.distance=a;function i(p,v,h){return MB("cross-link-restraints",{structure:v,crossLinkRestraints:p},h)}e.Location=i;function o(p){return!!p&&p.kind==="data-location"&&p.tag==="cross-link-restraints"}e.isLocation=o;function s(p,v){return p.data.structure===v.data.structure&&p.data.crossLinkRestraints===v.data.crossLinkRestraints&&p.element===v.element}e.areLocationsEqual=s;function u(p,v){var h=p.pairs[v];return"Cross Link Restraint | Type: ".concat(h.restraintType," | Threshold: ").concat(h.distanceThreshold," \u212B | Psi: ").concat(h.psi," | Sigma 1: ").concat(h.sigma1," | Sigma 2: ").concat(h.sigma2," | Distance: ").concat(a(h).toFixed(2)," \u212B")}function c(p){return u(p.data.crossLinkRestraints,p.element)}e.locationLabel=c;function l(p,v,h){return mb("cross-link-restraints",{structure:p,crossLinkRestraints:v},h,function(g){return d(v,h,g)},function(){return m(p,v,h)})}e.Loci=l;function f(p){return!!p&&p.kind==="data-loci"&&p.tag==="interactions"}e.isLoci=f;function d(p,v,h){return Xf.fromPairProvider(v.length,function(g,y,b){var x=p.pairs[v[g]];x.unitA.conformation.position(x.unitA.elements[x.indexA],y),x.unitB.conformation.position(x.unitB.elements[x.indexB],b)},h)}e.getBoundingSphere=d;function m(p,v,h){var g=h[0];if(g===void 0)return"";var y=v.pairs[g];return[u(v,g),EA(Pt.Location(p,y.unitA,y.indexA,p,y.unitB,y.indexB))].join("</br>")}e.getLabel=m})(Es||(Es={}));function yU(e,t,r){for(var n=t.elements,a=n.length,i=t.kind,o=function(u){var c=n[u];r.getIndicesByElement(c,i).forEach(function(l){return e.set(l,u)})},s=0;s<a;s++)o(s)}function Cxe(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=wc.Provider.get(t.model);if(!!n){var a=new Map,i=new Map;yU(a,t,n),yU(i,r,n),a.forEach(function(o,s){var u=i.get(s);u!==void 0&&e.push(i2(t,o,r,u,n,s),i2(r,u,t,o,n,s))})}}}function _xe(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=wc.Provider.get(t.model);if(!!r){for(var n=t.elements,a=n.length,i=t.kind,o=new Map,s=function(c){var l=n[c];r.getIndicesByElement(l,i).forEach(function(f){var d=o.get(f);d?d.push(c):o.set(f,[c])})},u=0;u<a;u++)s(u);o.forEach(function(c,l){if(!(c.length<2)){var f=c[0],d=c[1];e.push(i2(t,f,t,d,r,l),i2(t,d,t,f,r,l))}})}}}function i2(e,t,r,n,a,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:a.data.restraint_type.value(i),distanceThreshold:a.data.distance_threshold.value(i),psi:a.data.psi.value(i),sigma1:a.data.sigma_1.value(i),sigma2:a.data.sigma_2.value(i)}}function wxe(e){var t=[];if(!e.models.some(function(s){return wc.Provider.get(s)}))return new gU(t);for(var r=e.units.length,n=0;n<r;++n){var a=e.units[n];_xe(t,a);for(var i=n+1;i<r;++i){var o=e.units[i];a.model===o.model&&Cxe(t,a,o)}}return new gU(t)}function Axe(e,t,r,n,a){var i=Ac.get(t).value;if(!i.count)return At.createEmpty(a);var o=n.sizeFactor,s=Qe.create(t),u={linkCount:i.count,position:function(c,l,f){var d=i.pairs[f],m=d.unitA,p=d.unitB;m.conformation.position(m.elements[d.indexA],c),p.conformation.position(p.elements[d.indexB],l)},radius:function(c){var l=i.pairs[c];return s.unit=l.unitA,s.element=l.unitA.elements[l.indexA],r.size.size(s)*o}};return Dd(e,u,n,a)}var bU=I(I(I({},h0),Id),{sizeFactor:P.Numeric(.5,{min:0,max:10,step:.1})});function Txe(e){return Td({defaultProps:P.getDefaultValues(bU),createGeometry:Axe,createLocationIterator:Pxe,getLoci:Exe,eachLocation:Ixe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Pxe(e){var t=Ac.get(e).value,r=t.pairs,n=r.length,a=1,i=Es.Location(t,e),o=function(s){return i.element=s,i};return Wr(n,a,1,o,!0)}function Exe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=Ac.get(t).value,o=i.pairs[a];if(o)return Es.Loci(t,i,[a])}return ur}function Ixe(e,t,r){var n=!1;if(Es.isLoci(e)){if(!ke.areEquivalent(e.data.structure,t))return!1;var a=Ac.get(t).value;if(e.data.crossLinkRestraints!==a)return!1;for(var i=0,o=e.elements;i<o.length;i++){var s=o[i];r(Se.ofSingleton(s))&&(n=!0)}}return n}var Dxe={"cross-link-restraint":function(e,t){return Ps("Cross-link restraint",e,t,Txe)}},xU=I({},bU);function Mxe(e,t){return P.clone(xU)}function Rxe(e,t){return Vt.createMulti("CrossLinkRestraint",e,t,ta,Dxe)}var SU=ri({name:Es.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:Rxe,getParams:Mxe,defaultValues:P.getDefaultValues(xU),defaultColorTheme:{name:Es.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return Es.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Ac.attach(e,t,void 0,!0)},detach:function(e){return Ac.ref(e,!1)}}}),CU=st(13421772),Bxe="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",_U={domain:P.Interval([.5,1.5],{step:.01}),list:P.ColorList("red-grey",{presetKind:"scale"})};function Fxe(e){return _U}function wU(e,t){var r,n=void 0,a=e.structure&&Ac.get(e.structure).value;if(a){n=xs.create({domain:t.domain,listOrName:t.list.colors});var i=n.color;r=function(o){if(Es.isLocation(o)){var s=a.pairs[o.element];if(s)return i(Es.distance(s)/s.distanceThreshold)}return CU}}else r=function(){return CU};return{factory:wU,granularity:"group",color:r,props:t,description:Bxe,legend:n?n.legend:void 0}}var AU={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:wU,getParams:Fxe,defaultValues:P.getDefaultValues(_U),isApplicable:function(e){return!!e.structure&&Es.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?Ac.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ac.ref(e.structure,!1)}}},Oxe=xr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=wc.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",kxe),this.ctx.representation.structure.themes.colorThemeRegistry.add(AU),this.ctx.representation.structure.registry.add(SU)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(AU),this.ctx.representation.structure.registry.remove(SU)},t}(xr.Handler)});function kxe(e){if(!!Or.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return wc.fromTable(t,e)}}var Lxe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",StructureInfo:a1e,AccessibleSurfaceArea:m1e,Interactions:pxe,SecondaryStructure:vxe,ValenceModel:hxe,BestDatabaseSequenceMapping:bxe,CrossLinkRestraint:Oxe}),o2={State:z0e,Representation:G0e,Camera:q0e,Misc:Vye},lo={Representation:$ye,Camera:n1e,CustomProps:Lxe};function s2(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?Nxe(e,t||ke.Empty,r):PU(e,t||ke.Empty,r)}function OT(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),l=P.getDefaultValues(c.getParams({structure:t||ke.Empty}));return c.name===u.defaultColorTheme.name&&Object.assign(l,u.defaultColorTheme.props),{name:c.name,params:Object.assign(l,a)}}function TU(e,t,r,n,a){var i=e.representation.structure,o=i.registry,s=i.themes,u=o.get(r||o.default.name),c=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),l=P.getDefaultValues(c.getParams({structure:t||ke.Empty}));return c.name===u.defaultSizeTheme.name&&Object.assign(l,u.defaultSizeTheme.props),{name:c.name,params:Object.assign(l,a)}}function Nxe(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,a=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return PU(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function PU(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,a={structure:t},i=r.type||e.representation.structure.registry.default.provider,o=P.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=P.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),f=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=P.getDefaultValues(f.getParams(a));f.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);var m=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:f.name,params:m}}}var Uxe=function(e){var t=ze.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:P.Numeric(5,{min:1,max:10,step:1}),targetParams:P.Group(t,{label:"Target",customDefault:s2(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51,adjustCylinderLength:!0}})}),surroundingsParams:P.Group(t,{label:"Surroundings",customDefault:s2(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:P.Group(t,{label:"Non-covalent Int.",customDefault:s2(e,void 0,{type:a2,color:PT,size:ea.BuiltIn.uniform})}),components:P.MultiSelect(EU,P.arrayToOptions(EU)),excludeTargetFromSurroundings:P.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:P.Boolean(!1),material:Ya.getParam(),clip:P.Group(Al.Params)}},EU=["target","surroundings","interactions"],Nr;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(Nr||(Nr={}));var zxe=new Set([Nr.TargetSel,Nr.TargetRepr,Nr.SurrSel,Nr.SurrRepr,Nr.SurrNciRepr]),Vxe=function(e){_t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings (".concat(this.params.expandRadius," \xC5)")},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return I(I({},this.params.targetParams),{type:{name:r.type.name,params:I(I({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens,material:this.params.material,clip:this.params.clip})}})},t.prototype.ensureShape=function(r){var n,a=this.plugin.state.data,i=a.tree,o=a.build(),s=Yt.findUniqueTagsInSubtree(i,r.transform.ref,zxe);s[Nr.TargetSel]||(s[Nr.TargetSel]=o.to(r).apply(ze.Model.StructureSelectionFromBundle,{bundle:Cr.Empty,label:"[Focus] Target"},{tags:Nr.TargetSel}).ref),s[Nr.SurrSel]||(s[Nr.SurrSel]=o.to(r).apply(ze.Model.StructureSelectionFromExpression,{expression:ne.struct.generator.empty(),label:this.surrLabel},{tags:Nr.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[Nr.TargetRepr]&&(s[Nr.TargetRepr]=o.to(s[Nr.TargetSel]).apply(ze.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:Nr.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[Nr.SurrRepr]&&(s[Nr.SurrRepr]=o.to(s[Nr.SurrSel]).apply(ze.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:Nr.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[Nr.SurrNciRepr]&&r.obj&&a2.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[Nr.SurrNciRepr]=o.to(s[Nr.SurrSel]).apply(ze.Representation.StructureRepresentation3D,this.params.nciParams,{tags:Nr.SurrNciRepr}).ref),{state:a,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var a=n.select(Yt.Generators.byRef(r).subtree().withTag(Nr.TargetSel)),i=n.select(Yt.Generators.byRef(r).subtree().withTag(Nr.SurrSel));if(!(a.length===0&&i.length===0)){for(var o=n.build(),s=Cr.Empty,u=0,c=a;u<c.length;u++){var l=c[u];o.to(l).update(ze.Model.StructureSelectionFromBundle,function(v){return I(I({},v),{bundle:s})})}for(var f=ne.struct.generator.empty(),d=0,m=i;d<m.length;d++){var p=m[d];o.to(p).update(ze.Model.StructureSelectionFromExpression,function(v){return I(I({},v),{expression:f})})}return Xt.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m=this;return ae(this,function(p){switch(p.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,a=_e.remap(r,n.obj.data),i=_e.extendToWholeResidues(a),o=Cr.fromLoci(i),s=Cr.toExpression(o),u=ne.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=ne.struct.modifier.exceptBy({0:u,by:s})),c=this.ensureShape(n),l=c.state,f=c.builder,d=c.refs,f.to(d[Nr.TargetSel]).update(ze.Model.StructureSelectionFromBundle,function(v){return I(I({},v),{bundle:o})}),f.to(d[Nr.SurrSel]).update(ze.Model.StructureSelectionFromExpression,function(v){return I(I({},v),{expression:u,label:m.surrLabel})}),[4,Xt.State.Update(this.plugin,{state:l,tree:f,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return p.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(a){a?n.focus(a.loci):n.clear(gr.RootRef)})},t.prototype.update=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,f,p,v,f;return ae(this,function(h){switch(h.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(a=this.plugin.state.data,i=a.build(),o=Yt.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,c=0,l=a.select(o.withTag(Nr.TargetRepr));c<l.length;c++)f=l[c],u?i.to(f).update(this.getReprParams(this.params.targetParams)):i.delete(f.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,m=a.select(o.withTag(Nr.SurrRepr));d<m.length;d++)f=m[d],u?i.to(f).update(this.getReprParams(this.params.surroundingsParams)):i.delete(f.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,v=a.select(o.withTag(Nr.SurrNciRepr));p<v.length;p++)f=v[p],u?i.to(f).update(this.params.nciParams):i.delete(f.transform.ref);return[4,Xt.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return h.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(xr.WithSubscribers),kT=xr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:Vxe,params:function(e,t){return Uxe(t)}});function ni(e){return e}(function(e){e.CommonParams={ignoreHydrogens:P.Optional(P.Boolean(!1)),quality:P.Optional(P.Select("auto",D_)),theme:P.Optional(P.Group({globalName:P.Optional(P.Text("")),carbonColor:P.Optional(P.Select("chain-id",P.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:P.Optional(P.Text("")),focus:P.Optional(P.Group({name:P.Optional(P.Text("")),params:P.Optional(P.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:Xk.defaultValues}:i==="operator-name"?{name:i,params:nA.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(i,o,s){var u,c,l,f,d,m,p=i.state.data.build(),v=i.builders.structure.representation,h={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!i.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(h.quality=o.quality),o.ignoreHydrogens!==void 0&&(h.ignoreHydrogens=!!o.ignoreHydrogens);var g=((u=o.theme)===null||u===void 0?void 0:u.globalName)?(c=o.theme)===null||c===void 0?void 0:c.globalName:void 0,y=((l=o.theme)===null||l===void 0?void 0:l.carbonColor)!==void 0?{carbonColor:t((f=o.theme)===null||f===void 0?void 0:f.carbonColor)}:{},b=s&&((d=o.theme)===null||d===void 0?void 0:d.symmetryColor)&&r(s)?(m=o.theme)===null||m===void 0?void 0:m.symmetryColor:g;return{update:p,builder:v,color:g,symmetryColor:b,typeParams:h,ballAndStickColor:y}}e.reprBuilder=n;function a(i,o,s,u){return i.state.updateBehavior(kT,function(c){var l=OT(i,o,"ball-and-stick",s||"element-symbol",u);c.surroundingsParams.colorTheme=l,c.targetParams.colorTheme=l})}e.updateFocusRepr=a})(ni||(ni={}));var Md=ni.CommonParams,Mp=ni.reprBuilder,Rp=ni.updateFocusRepr;function Bp(e){if(e.canvas3d){var t=P.getDefaultValues(QA);e.canvas3d.setProps({postprocessing:{outline:t.outline,occlusion:t.occlusion}})}}var Gxe=ni({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return Md},apply:function(e,t,r){var n,a,i=(a=(n=ia.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return{};var o=r.config.get(wn.Structure.SizeThresholds)||ke.DefaultSizeThresholds,s=ke.getSize(i,o),u=i.polymerResidueCount/i.polymerGapCount;switch(s){case ke.Size.Gigantic:case ke.Size.Huge:return DU.apply(e,t,r);case ke.Size.Large:return MU.apply(e,t,r);case ke.Size.Medium:if(u>3)return IU.apply(e,t,r);case ke.Size.Small:return RU.apply(e,I(I({},t),{showCarbohydrateSymbol:!0}),r);default:vd()}}}),Hxe=ni({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ie(this,void 0,void 0,function(){return ae(this,function(n){return Bp(r),[2,{}]})})}}),y0="Basic",IU=ni({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:y0,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return Md},apply:function(e,t,r){var n,a,i,o,s,u,c,l,f,d;return ie(this,void 0,void 0,function(){var m,p,v,h,g,y,b,x,C,_,w,T,A,D,E;return ae(this,function(M){switch(M.label){case 0:return m=ia.resolveAndCheck(r.state.data,e),m?(E={},[4,Vi(r,m,"polymer")]):[2,{}];case 1:return E.polymer=M.sent(),[4,Vi(r,m,"ligand")];case 2:return E.ligand=M.sent(),[4,Vi(r,m,"non-standard")];case 3:return E.nonStandard=M.sent(),[4,Vi(r,m,"branched",{label:"Carbohydrate"})];case 4:return E.branched=M.sent(),[4,Vi(r,m,"water")];case 5:return E.water=M.sent(),[4,Vi(r,m,"ion")];case 6:return E.ion=M.sent(),[4,Vi(r,m,"lipid")];case 7:return E.lipid=M.sent(),[4,Vi(r,m,"coarse")];case 8:return p=(E.coarse=M.sent(),E),v=m.obj.data,h={sizeFactor:v.isCoarseGrained?.8:.2},g=(((i=(a=(n=p.water)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=p.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Mp(r,t,v),x=b.update,C=b.builder,_=b.typeParams,w=b.color,T=b.symmetryColor,A=b.ballAndStickColor,D={polymer:C.buildRepresentation(x,p.polymer,{type:"cartoon",typeParams:I(I({},_),h),color:T},{tag:"polymer"}),ligand:C.buildRepresentation(x,p.ligand,{type:"ball-and-stick",typeParams:_,color:w,colorParams:A},{tag:"ligand"}),nonStandard:C.buildRepresentation(x,p.nonStandard,{type:"ball-and-stick",typeParams:_,color:w,colorParams:A},{tag:"non-standard"}),branchedBallAndStick:C.buildRepresentation(x,p.branched,{type:"ball-and-stick",typeParams:I(I({},_),{alpha:.3}),color:w,colorParams:A},{tag:"branched-ball-and-stick"}),branchedSnfg3d:C.buildRepresentation(x,p.branched,{type:"carbohydrate",typeParams:_,color:w},{tag:"branched-snfg-3d"}),water:C.buildRepresentation(x,p.water,{type:g,typeParams:I(I({},_),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:C.buildRepresentation(x,p.ion,{type:"ball-and-stick",typeParams:_,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:C.buildRepresentation(x,p.lipid,{type:y,typeParams:I(I({},_),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:C.buildRepresentation(x,p.coarse,{type:"spacefill",typeParams:_,color:w||"chain-id"},{tag:"coarse"})},[4,x.commit({revertOnError:!1})];case 9:return M.sent(),[4,Rp(r,v,(l=(c=t.theme)===null||c===void 0?void 0:c.focus)===null||l===void 0?void 0:l.name,(d=(f=t.theme)===null||f===void 0?void 0:f.focus)===null||d===void 0?void 0:d.params)];case 10:return M.sent(),Bp(r),[2,{components:p,representations:D}]}})})}}),qxe=ni({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:y0,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return Md},apply:function(e,t,r){var n,a,i,o;return ie(this,void 0,void 0,function(){var s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return s=ia.resolveAndCheck(r.state.data,e),s?(y={},[4,BU(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,BU(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),c=s.obj.data,l={sizeFactor:c.isCoarseGrained?.8:.2},f={radiusOffset:c.isCoarseGrained?2:0,smoothness:c.isCoarseGrained?1:1.5},d=Mp(r,t,c),m=d.update,p=d.builder,v=d.typeParams,h=d.symmetryColor,g={protein:p.buildRepresentation(m,u.protein,{type:"cartoon",typeParams:I(I({},v),l),color:h},{tag:"protein"}),nucleic:p.buildRepresentation(m,u.nucleic,{type:"gaussian-surface",typeParams:I(I({},v),f),color:h},{tag:"nucleic"})},[4,m.commit({revertOnError:!0})];case 3:return b.sent(),[4,Rp(r,c,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),Bp(r),[2,{components:u,representations:g}]}})})}}),DU=ni({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:y0,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return Md},apply:function(e,t,r){var n,a,i,o;return ie(this,void 0,void 0,function(){var s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return s=ia.resolveAndCheck(r.state.data,e),s?(y={},[4,Vi(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,Vi(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),c=s.obj.data,l=ke.getSize(c),f=Object.create(null),l===ke.Size.Gigantic?Object.assign(f,{traceOnly:!c.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):l===ke.Size.Huge?Object.assign(f,{radiusOffset:c.isCoarseGrained?2:0,smoothness:1}):c.isCoarseGrained&&Object.assign(f,{radiusOffset:2,smoothness:1}),d=Mp(r,t,c),m=d.update,p=d.builder,v=d.typeParams,h=d.symmetryColor,g={polymer:p.buildRepresentation(m,u.polymer,{type:"gaussian-surface",typeParams:I(I({},v),f),color:h},{tag:"polymer"}),lipid:p.buildRepresentation(m,u.lipid,{type:"gaussian-surface",typeParams:I(I({},v),f),color:h},{tag:"lipid"})},[4,m.commit({revertOnError:!0})];case 3:return b.sent(),[4,Rp(r,c,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),Bp(r),[2,{components:u,representations:g}]}})})}}),MU=ni({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:y0,description:"Shows polymers as Cartoon."},params:function(){return Md},apply:function(e,t,r){var n,a,i,o;return ie(this,void 0,void 0,function(){var s,u,c,l,f,d,m,p,v,h,g;return ae(this,function(y){switch(y.label){case 0:return s=ia.resolveAndCheck(r.state.data,e),s?(g={},[4,Vi(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),c=s.obj.data,l={sizeFactor:c.isCoarseGrained?.8:.2},f=Mp(r,t,c),d=f.update,m=f.builder,p=f.typeParams,v=f.symmetryColor,h={polymer:m.buildRepresentation(d,u.polymer,{type:"cartoon",typeParams:I(I({},p),l),color:v},{tag:"polymer"})},[4,d.commit({revertOnError:!0})];case 2:return y.sent(),[4,Rp(r,c,(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name,(o=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),Bp(r),[2,{components:u,representations:h}]}})})}}),RU=ni({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:y0,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return I(I({},Md),{showCarbohydrateSymbol:P.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s,u;return ie(this,void 0,void 0,function(){var c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F,O;return ae(this,function(U){switch(U.label){case 0:return c=ia.resolveAndCheck(r.state.data,e),c?(F={},[4,Vi(r,c,"all")]):[2,{}];case 1:return l=(F.all=U.sent(),F.branched=void 0,F),f=c.obj.data,d=f.elementCount>1e5,m=f.atomicResidueCount&&f.elementCount>1e3&&f.atomicResidueCount/f.elementCount<3,p=f.models[0],v=!!La.Provider.get(p)||uu.isExhaustive(p),h="ball-and-stick",f.isCoarseGrained?h=f.elementCount>1e6?"point":"spacefill":m&&!v?h="spacefill":d&&(h="line"),g=t.showCarbohydrateSymbol&&!d&&!m,g?(b=(y=Object).assign,x=[l],O={},[4,Vi(r,c,"branched",{label:"Carbohydrate"})]):[3,3];case 2:b.apply(y,x.concat([(O.branched=U.sent(),O)])),U.label=3;case 3:return C=Mp(r,t,f),_=C.update,w=C.builder,T=C.typeParams,A=C.color,D=C.ballAndStickColor,E=m&&!v?{carbonColor:{name:"element-symbol",params:{}}}:D,M={all:w.buildRepresentation(_,l.all,{type:h,typeParams:T,color:A,colorParams:E},{tag:"all"})},g&&Object.assign(M,{snfg3d:w.buildRepresentation(_,l.branched,{type:"carbohydrate",typeParams:I(I({},T),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:A},{tag:"snfg-3d"})}),[4,_.commit({revertOnError:!0})];case 4:return U.sent(),[4,Rp(r,f,(i=(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name)!==null&&i!==void 0?i:A,(u=(s=(o=t.theme)===null||o===void 0?void 0:o.focus)===null||s===void 0?void 0:s.params)!==null&&u!==void 0?u:E)];case 5:return U.sent(),Bp(r),[2,{components:l,representations:M}]}})})}}),jxe=ni({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:function(){return I(I({},Md),{showCarbohydrateSymbol:P.Boolean(!1)})},apply:function(e,t,r){var n,a,i,o,s;return ie(this,void 0,void 0,function(){var u,c,l,f,d,m,p,v,h,g;return ae(this,function(y){switch(y.label){case 0:return u=ia.resolveAndCheck(r.state.data,e),u?(g={},[4,Vi(r,u,"all")]):[2,{}];case 1:return c=(g.all=y.sent(),g.branched=void 0,g),l=u.obj.data,f=Mp(r,t,l),d=f.update,m=f.builder,p=f.typeParams,v=f.color,h={all:m.buildRepresentation(d,c.all,{type:"spacefill",typeParams:I(I({},p),{ignoreLight:!0}),color:"illustrative"},{tag:"all"})},[4,d.commit({revertOnError:!0})];case 2:return y.sent(),[4,Rp(r,l,(i=(a=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||a===void 0?void 0:a.name)!==null&&i!==void 0?i:v,(s=(o=t.theme)===null||o===void 0?void 0:o.focus)===null||s===void 0?void 0:s.params)];case 3:return y.sent(),r.canvas3d&&r.canvas3d.setProps({postprocessing:{outline:{name:"on",params:{scale:1,color:st(0),threshold:.25}},occlusion:{name:"on",params:{bias:.9,blurKernelSize:15,radius:5,samples:32}}}}),[2,{components:c,representations:h}]}})})}});function Vi(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function BU(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Jn[r],"selection-".concat(r),n)}var hu={empty:Hxe,auto:Gxe,"atomic-detail":RU,"polymer-cartoon":MU,"polymer-and-ligand":IU,"protein-and-nucleic":qxe,"coarse-surface":DU,illustrative:jxe};function Tc(e){return e}function LT(e,t){if(e.ext==="bcif")try{if(VR(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Pc="Trajectory";function Ec(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var Wxe={label:"mmCIF",description:"mmCIF",category:Pc,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?LT(e,t)===-1:!1},parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a,i,o,s;return ae(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(ze.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(ze.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Ec},Xxe={label:"cifCore",description:"CIF Core",category:Pc,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?LT(e,t)==="coreCif":!1},parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a,i,o,s;return ae(this,function(u){switch(u.label){case 0:return n=e.state.data,a=n.build().to(t).apply(ze.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,a.apply(ze.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return i=u.sent(),(((s=(o=a.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),[2,{trajectory:i}]}})})},visuals:Ec};function Rd(e,t){var r=this;return function(n,a,i){return ie(r,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(a).apply(e,t,{tags:i==null?void 0:i.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var Yxe={label:"PDB",description:"PDB",category:Pc,stringExtensions:["pdb","ent"],parse:Rd(ze.Model.TrajectoryFromPDB),visuals:Ec},Kxe={label:"PDBQT",description:"PDBQT",category:Pc,stringExtensions:["pdbqt"],parse:Rd(ze.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Ec},Qxe={label:"XYZ",description:"XYZ",category:Pc,stringExtensions:["xyz"],parse:Rd(ze.Model.TrajectoryFromXYZ),visuals:Ec},Zxe={label:"GRO",description:"GRO",category:Pc,stringExtensions:["gro"],binaryExtensions:[],parse:Rd(ze.Model.TrajectoryFromGRO),visuals:Ec},$xe={label:"MOL",description:"MOL",category:Pc,stringExtensions:["mol"],parse:Rd(ze.Model.TrajectoryFromMOL),visuals:Ec},Jxe={label:"SDF",description:"SDF",category:Pc,stringExtensions:["sdf","sd"],parse:Rd(ze.Model.TrajectoryFromSDF),visuals:Ec},eSe={label:"MOL2",description:"MOL2",category:Pc,stringExtensions:["mol2"],parse:Rd(ze.Model.TrajectoryFromMOL2),visuals:Ec},FU=[["mmcif",Wxe],["cifCore",Xxe],["pdb",Yxe],["pdbqt",Kxe],["gro",Zxe],["xyz",Qxe],["mol",$xe],["sdf",Jxe],["mol2",eSe]],tSe=["gz","zip"],rSe=["bcif","ccp4","dcd"];function u2(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var a=t.lastIndexOf("?"),i=a!==-1?t.substring(a):"";t=t.substring(0,a===-1?t.length:a);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),c=u.length>1?(u.pop()||"").toLowerCase():"",l=t.match(/^(.+):\/\/(.+)$/);l&&(n=l[1].toLowerCase(),t=l[2]||"");var f=t.substring(0,t.lastIndexOf("/")+1);if(tSe.includes(c)){r=c;var d=t.length-c.length-1;c=(t.substr(0,d).split(".").pop()||"").toLowerCase();var m=s.length-c.length-1;s=s.substr(0,m)}else r=!1;var p=rSe.includes(c);return{path:t,name:o,ext:c,base:s,dir:f,compressed:r,binary:p,protocol:n,query:i,src:e}}var nSe=function(e){var t=e.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id;return P.Group({type:fd.getParams(void 0,"auto").type,representation:P.Select(t,e.builders.structure.representation.getPresets().map(function(r){return[r.id,r.display.name,r.display.group]}),{description:"Which representation preset to use."}),representationParams:P.Group(ni.CommonParams,{isHidden:!0}),asTrajectory:P.Optional(P.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},OU={rcsb:P.Group({encoding:P.Select("bcif",P.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:P.Group({variant:P.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:P.EmptyGroup({label:"PDBj"})},aSe=Mi.build({from:fe.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=nSe(t),n=t.config.get(wn.Download.DefaultPdbProvider)||"pdbe";return{source:P.MappedStatic("pdb",{pdb:P.Group({provider:P.Group({id:P.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:P.MappedStatic(n,OU)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":P.Group({provider:P.Group({id:P.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:P.Select("bcif",P.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:P.Group({id:P.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:P.Group({id:P.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:P.Group({id:P.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:P.Group({id:P.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:P.Group({url:P.Url(""),format:P.Select("mmcif",P.arrayToOptions(FU.map(function(a){return a[0]}),function(a){return a})),isBinary:P.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return Be.create("Download Structure",function(a){return ie(void 0,void 0,void 0,function(){var i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),i=r.source,s=!1,u="mmcif",c=i.name,c){case"url":return[3,1];case"pdb":return[3,2];case"pdb-dev":return[3,4];case"swissmodel":return[3,6];case"alphafolddb":return[3,8];case"modelarchive":return[3,10];case"pubchem":return[3,12]}return[3,14];case 1:return o=[{url:i.params.url,isBinary:i.params.isBinary}],u=i.params.format,[3,15];case 2:return[4,i.params.provider.server.name==="pdbe"?iSe(i):i.params.provider.server.name==="pdbj"?oSe(i):i.params.provider.server.name==="rcsb"?sSe(i):vd()];case 3:return o=m.sent(),s=!!i.params.options.asTrajectory,[3,15];case 4:return[4,Is(i.params.provider.id,function(p){var v=p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_".concat(p.padStart(8,"0"));return i.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/".concat(v.toUpperCase(),".bcif"):"https://pdb-dev.wwpdb.org/cif/".concat(v.toUpperCase(),".cif")},function(p){return p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_".concat(p.padStart(8,"0"))},i.params.provider.encoding==="bcif")];case 5:return o=m.sent(),s=!!i.params.options.asTrajectory,[3,15];case 6:return[4,Is(i.params.id,function(p){return"https://swissmodel.expasy.org/repository/uniprot/".concat(p.toUpperCase(),".pdb")},function(p){return"SWISS-MODEL: ".concat(p)},!1)];case 7:return o=m.sent(),s=!!i.params.options.asTrajectory,u="pdb",[3,15];case 8:return[4,Is(i.params.id,function(p){return ie(void 0,void 0,void 0,function(){var v,h;return ae(this,function(g){switch(g.label){case 0:return v="https://www.alphafold.ebi.ac.uk/api/prediction/".concat(p.toUpperCase()),[4,t.runTask(t.fetch({url:v,type:"json"}))];case 1:if(h=g.sent(),Array.isArray(h)&&h.length>0)return[2,h[0].cifUrl];throw new Error("No AlphaFold DB entry for '".concat(p,"'"))}})})},function(p){return"AlphaFold DB: ".concat(p)},!1)];case 9:return o=m.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 10:return[4,Is(i.params.id,function(p){return"https://www.modelarchive.org/doi/10.5452/".concat(p.toLowerCase(),".cif")},function(p){return"Model Archive: ".concat(p)},!1)];case 11:return o=m.sent(),s=!!i.params.options.asTrajectory,u="mmcif",[3,15];case 12:return[4,Is(i.params.id,function(p){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/".concat(p.trim(),"/record/SDF/?record_type=3d")},function(p){return"PubChem: ".concat(p)},!1)];case 13:return o=m.sent(),s=!!i.params.options.asTrajectory,u="mol",[3,15];case 14:throw new Error("".concat(i.name," not supported."));case 15:return l=r.source.params.options.representation||t.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id,f=l!==hu.empty.id,d=i.params.options.type.name==="auto"?void 0:i.params.options.type,[4,n.transaction(function(){return ie(void 0,void 0,void 0,function(){var p,v,h,g,y,b,x,v,C;return ae(this,function(_){switch(_.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(w,T){return{id:""+T,url:w.url,isBinary:w.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return p=_.sent(),[4,t.builders.structure.parseTrajectory(p,{formats:o.map(function(w,T){return{id:""+T,format:"cif"}})})];case 2:return v=_.sent(),[4,t.builders.structure.hierarchy.applyPreset(v,"default",{structure:d,showUnitcell:f,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return _.sent(),[3,10];case 4:h=0,g=o,_.label=5;case 5:return h<g.length?(y=g[h],[4,t.builders.data.download(y,{state:{isGhost:!0}})]):[3,10];case 6:if(b=_.sent(),x=u==="auto"?t.dataFormats.auto(u2(mn.getUrl(y.url)),(C=b.cell)===null||C===void 0?void 0:C.obj):t.dataFormats.get(u),!x)throw new Error("unknown file format");return[4,t.builders.structure.parseTrajectory(b,x)];case 7:return v=_.sent(),[4,t.builders.structure.hierarchy.applyPreset(v,"default",{structure:d,showUnitcell:f,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:_.sent(),_.label=9;case 9:return h++,[3,5];case 10:return[2]}})})}).runInContext(a)];case 16:return m.sent(),[2]}})})})});function Is(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:a=e.split(/[,\s]/).map(function(v){return v.trim()}).filter(function(v){return!!v&&(v.length>=4||/^[1-9][0-9]*$/.test(v))}),i=[],o=0,s=a,p.label=1;case 1:return o<s.length?(u=s[o],l=(c=i).push,m={},d=(f=mn).Url,[4,t(u)]):[3,4];case 2:l.apply(c,[(m.url=d.apply(f,[p.sent()]),m.isBinary=n,m.label=r(u),m)]),p.label=3;case 3:return o++,[3,1];case 4:return[2,i]}})})}function iSe(e){return ie(this,void 0,void 0,function(){return ae(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbe")throw new Error("expected pdbe");return[2,e.params.provider.server.params.variant==="updated"?Is(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),"_updated.cif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!1):e.params.provider.server.params.variant==="updated-bcif"?Is(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/entry-files/download/".concat(r.toLowerCase(),".bcif")},function(r){return"PDBe: ".concat(r," (updated cif)")},!0):Is(e.params.provider.id,function(r){return"https://www.ebi.ac.uk/pdbe/static/entry/".concat(r.toLowerCase(),".cif")},function(r){return"PDBe: ".concat(r," (cif)")},!1)]})})}function oSe(e){return ie(this,void 0,void 0,function(){return ae(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbj")throw new Error("expected pdbj");return[2,Is(e.params.provider.id,function(r){return"https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/".concat(r.toLowerCase().substring(1,3),"/").concat(r.toLowerCase(),".cif")},function(r){return"PDBj: ".concat(r," (cif)")},!1)]})})}function sSe(e){return ie(this,void 0,void 0,function(){return ae(this,function(t){if(e.name!=="pdb"||e.params.provider.server.name!=="rcsb")throw new Error("expected rcsb");return[2,e.params.provider.server.params.encoding==="cif"?Is(e.params.provider.id,function(r){return"https://files.rcsb.org/download/".concat(r.toUpperCase(),".cif")},function(r){return"RCSB PDB: ".concat(r," (cif)")},!1):Is(e.params.provider.id,function(r){return"https://models.rcsb.org/".concat(r.toUpperCase(),".bcif")},function(r){return"RCSB PDB: ".concat(r," (bcif)")},!0)]})})}var uSe=Mi.build({display:{name:"Update Trajectory"},params:{action:P.Select("advance",P.arrayToOptions(["advance","reset"])),by:P.Optional(P.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(f){return f.ofTransformer(ze.Model.ModelFromTrajectory)}),a=r.build();if(t.action==="reset")for(var i=0,o=n;i<o.length;i++){var s=o[i];a.to(s).update({modelIndex:0})}else for(var u=function(f){var d=Yt.findAncestorOfType(r.tree,r.cells,f.transform.ref,fe.Molecule.Trajectory);if(!d||!d.obj)return"continue";var m=d.obj;a.to(f).update(function(p){var v=(p.modelIndex+t.by)%m.data.frameCount;return v<0&&(v+=m.data.frameCount),{modelIndex:v}})},c=0,l=n;c<l.length;c++){var s=l[c];u(s)}return r.updateTree(a)}),cSe=Mi.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:fe.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==Fk}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),lSe=Mi.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:fe.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==kk}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),fSe=Mi.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:fe.Root,params:function(e,t){var r=t.state.data,n=Ht(Ht([],r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Model)}),!0),r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Topology)}),!0),a=n.map(function(s){return[s.transform.ref,s.obj.label]}),i=r.selectQ(function(s){return s.rootsOfType(fe.Molecule.Coordinates)}),o=i.map(function(s){return[s.transform.ref,s.obj.label]});return{model:P.Select(a.length?a[0][0]:"",a),coordinates:P.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return Be.create("Add Trajectory",function(a){return n.transaction(function(){return ie(void 0,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return i=[r.model,r.coordinates],o=n.build().toRoot().apply(Ik,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:i}).apply(ze.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(a)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(a)})}),dSe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",PdbDownloadProvider:OU,DownloadStructure:aSe,UpdateTrajectory:uSe,EnableModelCustomProps:cSe,EnableStructureCustomProps:lSe,AddTrajectory:fSe}),mSe=Mi.build({from:fe.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:P.MappedStatic("pdb-xray",{"pdb-xray":P.Group({provider:P.Group({id:P.Text("1tqn",{label:"Id"}),server:P.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:P.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":P.Group({provider:P.Group({id:P.Text("1tqn",{label:"Id"}),server:P.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:P.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":P.Group({provider:P.Group({id:P.Text("emd-8004",{label:"Id"}),server:P.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:P.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:P.Group({url:P.Url(""),isBinary:P.Boolean(!1),format:P.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return Be.create("Download Density",function(n){return ie(void 0,void 0,void 0,function(){var a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:switch(a=r.source,a.name){case"url":i=a.params;break;case"pdb-xray":i=a.params.provider.server==="pdbe"?{url:mn.Url(a.params.type==="2fofc"?"https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),".ccp4"):"https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.params.provider.id.toLowerCase(),"_diff.ccp4")),isBinary:!0,label:"PDBe X-ray map: ".concat(a.params.provider.id)}:{url:mn.Url(a.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"_2fofc.dsn6"):"https://edmaps.rcsb.org/maps/".concat(a.params.provider.id.toLowerCase(),"_fofc.dsn6")),isBinary:!0,label:"RCSB X-ray map: ".concat(a.params.provider.id)};break;case"pdb-emd-ds":i=a.params.provider.server==="pdbe"?{url:mn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe EMD Density Server: ".concat(a.params.provider.id)}:{url:mn.Url("https://maps.rcsb.org/em/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB EMD Density Server: ".concat(a.params.provider.id)};break;case"pdb-xray-ds":i=a.params.provider.server==="pdbe"?{url:mn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"PDBe X-ray Density Server: ".concat(a.params.provider.id)}:{url:mn.Url("https://maps.rcsb.org/x-ray/".concat(a.params.provider.id.toLowerCase(),"/cell?detail=").concat(a.params.detail)),isBinary:!0,label:"RCSB PDB X-ray Density Server: ".concat(a.params.provider.id)};break;default:throw new Error("".concat(a.name," not supported."))}return[4,t.builders.data.download(i)];case 1:switch(s=d.sent(),u=void 0,a.name){case"url":i=a.params,o=a.params.format==="auto"?t.dataFormats.auto(u2(mn.getUrl(i.url)),(l=s.cell)===null||l===void 0?void 0:l.obj):t.dataFormats.get(a.params.format);break;case"pdb-xray":u=a.params.provider.id,o=a.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=a.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error("".concat(a.name," not supported."))}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return c=d.sent(),[4,(f=o.visuals)===null||f===void 0?void 0:f.call(o,t,c)];case 3:return d.sent(),[2]}})})})}),kU=Mi.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(Yt.Generators.root.subtree().ofType(fe.Volume.Data).filter(function(n){var a;return!!n.obj&&!((a=n.obj)===null||a===void 0?void 0:a.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:P.Text("",{isHidden:!0,label:"Volume"})}:{ref:P.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(ze.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()}),pSe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DownloadDensity:mSe,AssignColorVolume:kU}),vSe=Mi.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:fe.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,a=r.options;return{files:P.FileList({accept:Array.from(n.values()).map(function(i){return".".concat(i)}).join(",")+",.gz,.zip",multiple:!0}),format:P.MappedStatic("auto",{auto:P.EmptyGroup(),specific:P.Select(a[0][0],a)}),visuals:P.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Be.create("Open Files",function(a){return ie(void 0,void 0,void 0,function(){return ae(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ie(void 0,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y,b;return ae(this,function(x){switch(x.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=function(C){return ie(void 0,void 0,void 0,function(){var _,w,T,A,D,E,M;return ae(this,function(F){switch(F.label){case 0:return _=u2(C.file),w=t.dataFormats.binaryExtensions.has(_.ext),[4,t.builders.data.readFile({file:C,isBinary:w})];case 1:return T=F.sent().data,A=r.format.name==="auto"?t.dataFormats.auto(_,(E=T.cell)===null||E===void 0?void 0:E.obj):t.dataFormats.get(r.format.params),A?[4,A.parse(t,T)]:(t.log.warn("OpenFiles: could not find data provider for '".concat(_.name,".").concat(_.ext,"'")),[2]);case 2:return D=F.sent(),r.visuals?[4,(M=A.visuals)===null||M===void 0?void 0:M.call(A,t,D)]:[3,4];case 3:F.sent(),F.label=4;case 4:return[2]}})})},s=0,u=r.files,x.label=1;case 1:if(!(s<u.length))return[3,14];c=u[s],x.label=2;case 2:return x.trys.push([2,12,,13]),c.file&&c.name.toLowerCase().endsWith(".zip")?(f=p3,d=[a],[4,c.file.arrayBuffer()]):[3,9];case 3:return[4,f.apply(void 0,d.concat([x.sent()]))];case 4:l=x.sent(),m=0,p=Object.entries(l),x.label=5;case 5:return m<p.length?(v=p[m],h=v[0],g=v[1],y=mn.File(new File([g],h)),[4,o(y)]):[3,8];case 6:x.sent(),x.label=7;case 7:return m++,[3,5];case 8:return[3,11];case 9:return[4,o(c)];case 10:x.sent(),x.label=11;case 11:return[3,13];case 12:return b=x.sent(),console.error(b),t.log.error("Error opening file '".concat(c.name,"'")),[3,13];case 13:return s++,[3,1];case 14:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),hSe=Mi.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:fe.Root,params:function(e,t){var r=t.dataFormats.options;return{url:P.Url(""),format:P.Select(r[0][0],r),isBinary:P.Boolean(!1),visuals:P.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return Be.create("Open Files",function(a){return ie(void 0,void 0,void 0,function(){return ae(this,function(i){switch(i.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ie(void 0,void 0,void 0,function(){var o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return f.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '".concat(r.format,"'")),[2]);case 1:return s=f.sent(),[4,o.parse(t,s)];case 2:return u=f.sent(),r.visuals?[4,(l=o.visuals)===null||l===void 0?void 0:l.call(o,t,u)]:[3,4];case 3:f.sent(),f.label=4;case 4:return[3,6];case 5:return c=f.sent(),console.error(c),t.log.error("Error downloading '".concat(typeof r.url=="string"?r.url:r.url.url,"'")),[3,6];case 6:return[2]}})})}).runInContext(a)];case 1:return i.sent(),[2]}})})})}),gSe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",OpenFiles:vSe,DownloadFile:hSe}),Bd={Structure:dSe,Volume:pSe,DataFormat:gSe},NT=function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(fe.Create({name:"Volume Streaming",typeClass:"Object"})),LU;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(LU||(LU={}));function ySe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return Or.is(r.sourceData)?jt.hasEmMap(r)?"em":jt.hasXrayMap(r)?"x-ray":jt.isFromEm(r)?"em":jt.isFromXray(r)?"x-ray":t:t}function bSe(e){var t=[];if(!Or.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,a=r.db_name,i=r.content_type;if(!a.isDefined)return[e.entryId];for(var o=0,s=a.rowCount;o<s;++o)a.value(o).toUpperCase()==="EMDB"&&i.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function xSe(e){return[e.entryId]}function SSe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return bSe(r);case"x-ray":return xSe(r)}}function NU(e,t,r,n){return ie(this,void 0,void 0,function(){return ae(this,function(a){switch(e){case"emdb":return[2,UU(t,r,n)];case"pdbe":return[2,CSe(t,r,n)]}return[2]})})}function UU(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o;return ae(this,function(s){switch(s.label){case 0:return n=e.config.get(wn.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:"".concat(n,"/").concat(r.toUpperCase(),"/header/").concat(r.toLowerCase(),".xml"),type:"xml"}).runInContext(t)];case 1:return a=s.sent(),i=a.getElementsByTagName("map")[0],o=parseFloat(i.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function CSe(e,t,r){var n,a,i,o;return ie(this,void 0,void 0,function(){var s,u;return ae(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return s=c.sent(),u=(a=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||a===void 0?void 0:a.contour,!u||u.length===0?[2,_Se(e,t,r)]:[2,(o=(i=u.find(function(l){return l.primary}))===null||i===void 0?void 0:i.level)!==null&&o!==void 0?o:u[0].level]}})})}function _Se(e,t,r){var n,a,i;return ie(this,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/".concat(r),type:"json"}).runInContext(t)];case 1:return o=c.sent(),s=o==null?void 0:o[r],u=void 0,((i=(a=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||a===void 0?void 0:a.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function wSe(e,t,r){var n;return ie(this,void 0,void 0,function(){var a,i,o,s;return ae(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/".concat(r),type:"json"}).runInContext(t)];case 1:if(a=u.sent(),i=a==null?void 0:a[r],o=[],(n=i==null?void 0:i[0])===null||n===void 0?void 0:n.related_structures){if(s=i[0].related_structures.filter(function(c){return c.resource==="EMDB"&&c.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '".concat(r,"'."));o.push.apply(o,s.map(function(c){return c.accession}))}else throw new Error("No related EMDB entry found for '".concat(r,"'."));return[2,o]}})})}var b0;(function(e){function t(i,o){return{key:i,data:o}}function r(i){return{entries:G3(),capacity:Math.max(1,i)}}e.create=r;function n(i,o){for(var s=i.entries.first;s;s=s.next)if(s.value.key===o)return i.entries.remove(s),i.entries.addLast(s.value),s.value.data}e.get=n;function a(i,o,s){var u=void 0;if(i.entries.count>=i.capacity){var c=i.entries.first;u=c.value.data,i.entries.remove(c)}return i.entries.addLast(t(o,s)),u}e.set=a})(b0||(b0={}));var fo=function(e){_t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(fe.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,c,l){var f,d,m,p;return l===void 0&&(l={}),P.Group({isoValue:vt.createIsoValueParam((f=l.isoValue)!==null&&f!==void 0?f:u,c),color:P.Color((d=l.color)!==null&&d!==void 0?d:s),wireframe:P.Boolean((m=l.wireframe)!==null&&m!==void 0?m:!1),opacity:P.Numeric((p=l.opacity)!==null&&p!==void 0?p:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,c=o.channelParams,l=new Map;s&&s.entries.forEach(function(m){return l.set(m.dataId,m)});var f=s?s.entries.map(function(m){return[m.dataId,m.dataId]}):[],d=s?s.entries[0].dataId:"";return{entry:P.Mapped(d,f,function(m){return P.Group(a({entryData:l.get(m),defaultView:u,structure:s&&s.structure,channelParams:c}))})}}e.createParams=n;function a(o){var s=o.entryData,u=o.defaultView,c=o.structure,l=o.channelParams,f=l===void 0?{}:l,d=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:vt.IsoValue.relative(0)},m=c&&c.boundary.box||Bt();return{view:P.MappedStatic(u||(d.kind==="em"?"cell":"selection-box"),{off:P.Group({}),box:P.Group({bottomLeft:P.Vec3(m.min),topRight:P.Vec3(m.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":P.Group({radius:P.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:P.Vec3(S.create(0,0,0),{},{isHidden:!0}),topRight:P.Vec3(S.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:P.Group({}),auto:P.Group({radius:P.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:P.Select(Math.min(6,d.header.availablePrecisions.length-1),d.header.availablePrecisions.map(function(p,v){return[v,"".concat(v+1," [ ").concat(Math.pow(p.maxVoxels,1/3)|0,"^3 cells ]")]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:P.Boolean(!1,{isHidden:!0}),bottomLeft:P.Vec3(m.min,{},{isHidden:!0}),topRight:P.Vec3(m.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:P.Select(Math.min(3,d.header.availablePrecisions.length-1),d.header.availablePrecisions.map(function(p,v){return[v,"".concat(v+1," [ ").concat(Math.pow(p.maxVoxels,1/3)|0,"^3 cells ]")]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:d.kind==="em"?P.Group({em:t("EM",st(6524815),d.emDefaultContourLevel||vt.IsoValue.relative(1),d.header.sampling[0].valuesInfo[0],f.em)},{isFlat:!0}):P.Group({"2fo-fc":t("2Fo-Fc",st(3367602),vt.IsoValue.relative(1.5),d.header.sampling[0].valuesInfo[0],f["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",st(3390259),vt.IsoValue.relative(3),d.header.sampling[0].valuesInfo[1],f["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",st(12268339),vt.IsoValue.relative(-3),d.header.sampling[0].valuesInfo[1],f["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=a,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var i=function(o){_t(s,o);function s(u,c){var l=o.call(this,u,{})||this;return l.plugin=u,l.data=c,l.cache=b0.create(25),l.params={},l.lastLoci=ur,l.ref="",l.channels={},l._invTransform=se(),l.infoMap=new Map,l.data.entries.forEach(function(f){return l.infoMap.set(f.dataId,f)}),l}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return ie(this,void 0,void 0,function(){var c,l,f,d,m,p,v,h,g;return ae(this,function(y){switch(y.label){case 0:return c=NA(this.data.serverUrl,"".concat(this.info.kind,"/").concat(this.info.dataId.toLowerCase())),u?(l=u.min,f=u.max,c+="/box"+"/".concat(l.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+"/".concat(f.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):c+="/cell",d=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(d=this.params.entry.params.view.params.selectionDetailLevel),c+="?detail=".concat(d),m=b0.get(this.cache,c),m?[2,m.data]:(p=mn.getUrlAsset(this.plugin.managers.asset,c),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(p,"binary"))]);case 1:return v=y.sent(),[4,this.parseCif(v.data)];case 2:return h=y.sent(),h?(g=b0.set(this.cache,c,{data:h,asset:v}),g&&g.asset.dispose(),[2,h]):[2]}})})},s.prototype.parseCif=function(u){return ie(this,void 0,void 0,function(){var c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return[4,this.plugin.runTask(zu.parseBinary(u))];case 1:if(c=v.sent(),c.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+c.toString()),[2];if(c.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];l={},f=1,v.label=2;case 2:return f<c.result.blocks.length?(d=c.result.blocks[f],m=zu.schema.densityServer(d),[4,this.plugin.runTask(kF(m))]):[3,5];case 3:p=v.sent(),l[d.header]=p,v.label=4;case 4:return f++,[3,2];case 5:return[2,l]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var c=this.plugin.state.data,l=I(I({},this.params),{entry:{name:this.params.entry.name,params:I(I({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),f=c.build().to(this.ref).update(l);Xt.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,c){if(this.params.entry.params.view.name==="auto"){var l=this.plugin.state.data,f=I(I({},this.params),{entry:{name:this.params.entry.name,params:I(I({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:c,bottomLeft:(u==null?void 0:u.min)||S.zero(),topRight:(u==null?void 0:u.max)||S.zero()}}})}}),d=l.build().to(this.ref).update(f);Xt.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(Yt.Generators.byRef(this.ref).rootOfType(fe.Molecule.Structure))[0]},s.prototype.register=function(u){var c=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(l){!fe.Molecule.Structure.is(l.obj)||!_e.is(c.lastLoci)||c.lastLoci.structure===l.obj.data&&(c.lastLoci=ur)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(l){!fe.Molecule.Structure.is(l.oldObj)||!_e.is(c.lastLoci)||c.lastLoci.structure===l.oldObj.data&&(c.lastLoci=ur)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(l){if(!!c.plugin.state.data.tree.children.has(c.ref)){var f=l?l.loci:ur;switch(c.params.entry.params.view.name){case"auto":c.updateAuto(f);break;case"selection-box":c.updateSelectionBox(f);break;default:c.lastLoci=f;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var c,l,f;if(Ut.isEmpty(u)||Ja(u))return Bt();var d=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!d)return Bt();var m=this.getStructureRoot();if(!m||((c=m.obj)===null||c===void 0?void 0:c.data)!==((l=d.obj)===null||l===void 0?void 0:l.data))return Bt();var p=cd.get((f=m.obj)===null||f===void 0?void 0:f.data.models[0]);p&&se.invert(this._invTransform,p);var v=_e.extendToWholeResidues(u),h=_e.getBoundary(v,p&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return _e.size(v)===1&&Bt.expand(h,h,S.create(1,1,1)),h},s.prototype.updateAuto=function(u){if(this.lastLoci=u,Ja(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var c=this.getBoxFromLoci(u);this.updateAutoParams(c,!0)},s.prototype.updateSelectionBox=function(u){if(Ut.areEqual(this.lastLoci,u)){this.lastLoci=ur,this.updateSelectionBoxParams(Bt());return}if(this.lastLoci=u,Ja(u)){this.updateSelectionBoxParams(Bt());return}var c=this.getBoxFromLoci(u);this.updateSelectionBoxParams(c)},s.prototype.update=function(u){return ie(this,void 0,void 0,function(){var c,l,f,d,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:switch(c=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,l=void 0,f=!1,u.entry.params.view.name){case"off":f=!0;break;case"box":l=Bt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),f=Bt.volume(l)<1e-4;break;case"selection-box":{c?l=this.getBoxFromLoci(this.lastLoci)||Bt():l=Bt.create(S.clone(u.entry.params.view.params.bottomLeft),S.clone(u.entry.params.view.params.topRight)),d=u.entry.params.view.params.radius,f=Bt.volume(l)<1e-4,Bt.expand(l,l,S.create(d,d,d));break}case"cell":l=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":l=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Bt.create(S.clone(u.entry.params.view.params.bottomLeft),S.clone(u.entry.params.view.params.topRight)):void 0,l&&(f=Bt.volume(l)<1e-4,u.entry.params.view.params.isSelection&&(d=u.entry.params.view.params.radius,Bt.expand(l,l,S.create(d,d,d))));break}return f?(p={},[3,3]):[3,1];case 1:return[4,this.queryData(l)];case 2:p=h.sent(),h.label=3;case 3:return m=p,m?(v=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(m["2FO-FC"]||vt.One,v["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(m["FO-FC"]||vt.One,v["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(m["FO-FC"]||vt.One,v["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(m.EM||vt.One,v.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,c,l){var f=c;return{data:u,color:f.color,wireframe:f.wireframe,opacity:f.opacity,isoValue:f.isoValue.kind==="relative"?f.isoValue:vt.IsoValue.toRelative(f.isoValue,l)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(xr.WithSubscribers);e.Behavior=i})(fo||(fo={}));function Wl(e,t,r){return{i:e,j:t,k:r}}function Qo(e,t){return{a:e,b:t}}var An=[Wl(0,0,0),Wl(1,0,0),Wl(1,1,0),Wl(0,1,0),Wl(0,0,1),Wl(1,0,1),Wl(1,1,1),Wl(0,1,1)],ASe=[Qo(An[0],An[1]),Qo(An[1],An[2]),Qo(An[2],An[3]),Qo(An[3],An[0]),Qo(An[4],An[5]),Qo(An[5],An[6]),Qo(An[6],An[7]),Qo(An[7],An[4]),Qo(An[0],An[4]),Qo(An[1],An[5]),Qo(An[2],An[6]),Qo(An[3],An[7])],TSe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],PSe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Fp=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],UT=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function ESe(e,t){var r=Math.min(1<<16,e*4),n=Me.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),a=Me.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=Me.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=Me.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(c,l,f){return++s,Me.add3(n,c,l,f)},addNormal:function(c,l,f){Me.add3(a,c,l,f)},addGroup:function(c){Me.add(i,c)},addTriangle:function(c,l,f,d){var m=c[l],p=c[f],v=c[d];m>=0&&p>=0&&v>=0&&(++u,Me.add3(o,m,p,v))},get:function(){var c=Me.compact(n,!0),l=Me.compact(a,!0),f=Me.compact(o,!0),d=Me.compact(i,!0);return At.create(c,f,l,d,s,u,t)}}}function ISe(e,t){var r=Me.create(Float32Array,3,e),n=Me.create(Float32Array,1,e),a=Me.create(Float32Array,2,e),i=0;return{addVertex:function(o,s,u){return Me.add3(r,o,s,u)},addNormal:function(){return dC},addGroup:function(o){Me.add(n,o)},addTriangle:function(o,s,u,c,l){var f=o[s],d=o[u],m=o[c];f>=0&&d>=0&&m>=0&&(UT[s][u]&l&&(++i,Me.add2(a,o[s],o[u])),UT[u][c]&l&&(++i,Me.add2(a,o[u],o[c])),UT[s][c]&l&&(++i,Me.add2(a,o[s],o[c])))},get:function(){for(var o=Me.compact(r,!0),s=Me.compact(a,!0),u=Me.compact(n,!0),c=Bi.create(i,i/10,t),l=0;l<i;++l){var f=s[l*2],d=s[l*2+1];c.add(o[f*3],o[f*3+1],o[f*3+2],o[d*3],o[d*3+1],o[d*3+2],u[f])}return c.getLines()}}}function zU(e){return I(I({},e),{bottomLeft:jn(e.bottomLeft,[0,0,0]),topRight:jn(e.topRight,e.scalarField.space.dimensions)})}function VU(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function c2(e,t){var r=this;return Be.create("Marching Cubes Mesh",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return a=zU(e),i=VU(a),o=i.dX,s=i.dY,u=i.dZ,c=Math.min(262144,Math.max(o*s*u/32,1024)),l=ESe(c,t),[4,new GU(n,l,a).run()];case 1:return f.sent(),[2,l.get()]}})})})}function zT(e,t){var r=this;return Be.create("Marching Cubes Lines",function(n){return ie(r,void 0,void 0,function(){var a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return a=zU(e),i=VU(a),o=i.dX,s=i.dY,u=i.dZ,c=Math.min(262144,Math.max(o*s*u/32,1024)),l=ISe(c,t),[4,new GU(n,l,a).run()];case 1:return f.sent(),[2,l.get()]}})})})}var GU=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new DSe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ie(this,void 0,void 0,function(){var t,r;return ae(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=~4,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=~2){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=~1)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ie(this,void 0,void 0,function(){return ae(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),DSe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2==0?0:3*this.nX*this.nY,n=t%2==0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=TSe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,a=this.verticesOnEdges[n];if(a>0)return a-1;var i=this.scalarField,o=this.scalarFieldGet,s=ASe[t],u=s.a,c=s.b,l=u.i+this.i,f=u.j+this.j,d=u.k+this.k,m=c.i+this.i,p=c.j+this.j,v=c.k+this.k,h=o(i,l,f,d),g=o(i,m,p,v),y=(this.isoLevel-h)/(h-g);if(this.idField){var b=this.idFieldGet(this.idField,l,f,d),x=this.idFieldGet(this.idField,m,p,v),C=y<.5?b:x;if(C===-1&&(C=y<.5?x:b),C===-2)return-1;this.builder.addGroup(C)}else this.builder.addGroup(0);var _=this.builder.addVertex(l+y*(l-m),f+y*(f-p),d+y*(d-v));this.verticesOnEdges[n]=_+1;var w=o(i,Math.max(0,l-1),f,d)-o(i,Math.min(this.nX-1,l+1),f,d),T=o(i,l,Math.max(0,f-1),d)-o(i,l,Math.min(this.nY-1,f+1),d),A=o(i,l,f,Math.max(0,d-1))-o(i,l,f,Math.min(this.nZ,d+1)),D=o(i,Math.max(0,m-1),p,v)-o(i,Math.min(this.nX-1,m+1),p,v),E=o(i,m,Math.max(0,p-1),v)-o(i,m,Math.min(this.nY-1,p+1),v),M=o(i,m,p,Math.max(0,v-1))-o(i,m,p,Math.min(this.nZ-1,v+1)),F=w+y*(w-D),O=T+y*(T-E),U=A+y*(A-M);return this.isoLevel>=0?this.builder.addNormal(F,O,U):this.builder.addNormal(-F,-O,-U),_},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,a){var i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),!(i===0||i===255)){this.i=t,this.j=r,this.k=n;var o=PSe[i];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Fp[i],u=0;u<s.length;u+=3){var c=s[u],l=s[u+1],f=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,c,l,f,a):this.builder.addTriangle(this.vertList,f,l,c,a)}}},e}();function MSe(e,t,r,n,a,i){var o=ya.getUtils(t),s=o.createValues,u=o.createRenderableState,c=P_(),l=s(t,c,r,n,a),f=u(a);return np(t.kind,l,f,i)}function x0(e,t){var r=e.defaultProps,n=e.createGeometry,a=e.createLocationIterator,i=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,c=e.dispose,l=e.geometryUtils,f=l.updateValues,d=l.updateBoundingSphere,m=l.updateRenderableState,p=l.createPositionIterator,v=mu.create(),h,g,y,b,x=Object.assign({},r),C=kn.createEmpty(),_,w,T=-1,A,D;function E(O,U,N){if(!N&&!_)throw new Error("missing volume");if(g=Object.assign({},x,U),y=O,b=N,mu.reset(v),h?(!_||!vt.areEquivalent(b,_))&&(v.createNew=!0):v.createNew=!0,v.createNew){v.createGeometry=!0;return}s(v,N,g,x,y,C),du.areEqual(O.color,C.color)||(v.updateColor=!0),v.createGeometry&&(v.updateColor=!0)}function M(O){if(v.createNew)if(A=a(b),O)h=MSe(b,O,A,y,g,t),D=p(O,h.values);else throw new Error("expected geometry to be given");else{if(!h)throw new Error("expected renderObject to be available");if(A.reset(),v.createGeometry)if(O)R.updateIfChanged(h.values.drawCount,ya.getDrawCount(O)),R.updateIfChanged(h.values.uVertexCount,ya.getVertexCount(O));else throw new Error("expected geometry to be given");(v.updateTransform||v.createGeometry)&&(d(h.values,O||w),D=p(O||w,h.values)),v.updateSize&&"uSize"in h.values&&Hu(A,y.size,h.values),v.updateColor&&ao(A,D,y.color,h.values),f(h.values,g),m(h.state,g)}x=g,C=y,_=b,O&&(w=O,T+=1)}function F(O,U){return jo(O)?U(Se.ofBounds(0,A.groupCount*A.instanceCount)):o(O,_,x,U)}return{get groupCount(){return A?A.count:0},get renderObject(){return h},get geometryVersion(){return T},createOrUpdate:function(O,U,N,q){return N===void 0&&(N={}),ie(this,void 0,void 0,function(){var j;return ae(this,function(Q){return E(U,N,q||_),v.createGeometry?(j=n(O,b,y,g,w),[2,aA(j)?j.then(M):M(j)]):(M(),[2])})})},getLoci:function(O){return h?i(O,_,x,h.id):ur},mark:function(O,U){return Kt.mark(h,O,U,F)},setVisibility:function(O){Kt.setVisibility(h,O)},setAlphaFactor:function(O){Kt.setAlphaFactor(h,O)},setPickable:function(O){Kt.setPickable(h,O)},setColorOnly:function(O){Kt.setColorOnly(h,O)},setTransform:function(O,U){Kt.setTransform(h,O,U)},setOverpaint:function(O){return Kt.setOverpaint(h,O,F,!0)},setTransparency:function(O){return Kt.setTransparency(h,O,F,!0)},setSubstance:function(O){return Kt.setSubstance(h,O,F,!0)},setClipping:function(O){return Kt.setClipping(h,O,F,!0)},destroy:function(){c==null||c(w),h&&(h.state.disposed=!0,h=void 0)},mustRecreate:u}}function VT(e){return e}I({},Je.Params);function l2(e,t,r,n,a){var i=0,o=t.webgl,s=new En,u=new Vt.GeometryState,c=oc(),l=[],f=Vt.createState(),d,m,p,v,h=kn.createEmpty();function g(_,w){var T=this;_===void 0&&(_={}),w&&w!==m&&(p=r(t,w),m=w,v||(v=P.getDefaultValues(p)));var A=_A(Object.assign({},v,_),m);return Object.assign(v,_,A),Be.create("Creating or updating VolumeRepresentation",function(D){return ie(T,void 0,void 0,function(){var E,M;return ae(this,function(F){switch(F.label){case 0:return d?((M=d.mustRecreate)===null||M===void 0?void 0:M.call(d,m,v,o))&&(d.destroy(),d=n(c,m,v,o)):d=n(c,m,v,o),E=d.createOrUpdate({webgl:o,runtime:D},h,v,w),E?[4,E]:[3,2];case 1:F.sent(),F.label=2;case 2:return l.length=0,d&&d.renderObject&&(l.push(d.renderObject),u.add(d.renderObject.id,d.geometryVersion)),u.snapshot(),s.next(i++),[2]}})})})}function y(_,w){return d?d.mark(_,w):!1}function b(_){_.visible!==void 0&&d&&d.setVisibility(_.visible),_.alphaFactor!==void 0&&d&&d.setAlphaFactor(_.alphaFactor),_.pickable!==void 0&&d&&d.setPickable(_.pickable),_.overpaint!==void 0&&d&&d.setOverpaint(_.overpaint),_.transparency!==void 0&&d&&d.setTransparency(_.transparency),_.transform!==void 0&&d&&d.setTransform(_.transform),Vt.updateState(f,_)}function x(_){h=_}function C(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return p},get state(){return f},get theme(){return h},get geometryVersion(){return u.version},renderObjects:l,updated:s,createOrUpdate:g,setState:b,setTheme:x,getLoci:function(_){return _===void 0?a(m,v):d?d.getLoci(_):ur},mark:y,destroy:C}}var RSe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,BSe=I(I({},ua),{tTexture:Lt("texture","rgba","float","nearest")}),Zo="histopyramid-sum";function FSe(e,t){if(e.namedComputeRenderables[Zo]){var r=e.namedComputeRenderables[Zo].values;R.update(r.tTexture,t),e.namedComputeRenderables[Zo].update()}else e.namedComputeRenderables[Zo]=OSe(e,t);return e.namedComputeRenderables[Zo]}function OSe(e,t){var r=I(I({},ca),{tTexture:R.create(t)}),n=I({},BSe),a=Qr("sum",Ka,RSe,{},{0:"ivec4"}),i=zn(e,"triangles",a,n,r);return Vn(i,r)}function kSe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var f2=new Uint8Array(4),HU=new Int32Array(4);function LSe(e,t){var r=e.gl,n=e.resources,a=FSe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Zo]||(e.namedFramebuffers[Zo]=n.framebuffer());var i=e.namedFramebuffers[Zo];e.namedTextures[Zo]||(e.namedTextures[Zo]=rr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[Zo].define(1,1));var o=e.namedTextures[Zo];return o.attachFramebuffer(i,0),kSe(e),r.viewport(0,0,1,1),a.render(),r.finish(),e.readPixels(0,0,1,1,rr(r)?HU:f2),e.unbindFramebuffer(),rr(r)?HU[0]:C_(f2[0],f2[1],f2[2])}var NSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,USe=I(I({},ua),{tInputLevel:Lt("texture","rgba","float","nearest"),tPreviousLevel:Lt("texture","rgba","float","nearest"),uSize:Ee("f"),uTexSize:Ee("f"),uFirst:Ee("b")}),Xl="histogram-pyramid";function zSe(e,t,r){if(e.namedComputeRenderables[Xl]){var n=e.namedComputeRenderables[Xl].values;R.update(n.tInputLevel,t),R.update(n.tPreviousLevel,r),e.namedComputeRenderables[Xl].update()}else e.namedComputeRenderables[Xl]=VSe(e,t,r);return e.namedComputeRenderables[Xl]}function VSe(e,t,r){var n=I(I({},ca),{tInputLevel:R.create(t),tPreviousLevel:R.create(r),uSize:R.create(0),uTexSize:R.create(0),uFirst:R.create(!0)}),a=I({},USe),i=Qr("reduction",Ka,NSe,{},{0:"ivec4"}),o=zn(e,"triangles",i,a,n);return Vn(o,n)}function GSe(e,t){var r=Math.pow(2,t),n="level".concat(t),a=e.isWebGL2?d2(n,e,"image-int32","alpha","int","nearest"):d2(n,e,"image-uint8","rgba","ubyte","nearest");a.define(r,r);var i=qSe(n,e);return i||(i=qU(n,e),a.attachFramebuffer(i,0)),{texture:a,framebuffer:i}}function HSe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function qU(e,t){var r="".concat(Xl,"-").concat(e);return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function d2(e,t,r,n,a,i){var o="".concat(Xl,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function qSe(e,t){var r="".concat(Xl,"-").concat(e);return t.namedFramebuffers[r]}function jSe(e,t,r,n){var a=e.gl,i=t.getWidth(),o=t.getHeight();if(i!==o||!rj(i))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(i)/Math.log(2)),u=Math.pow(2,s),c=Math.pow(2,s),l=Math.pow(2,s-1),f=e.isWebGL2?d2("pyramid",e,"image-int32","alpha","int","nearest"):d2("pyramid",e,"image-uint8","rgba","ubyte","nearest");f.define(c,l);var d=qU("pyramid",e);f.attachFramebuffer(d,0),a.viewport(0,0,c,l),rr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT);for(var m=[],p=0;p<s;++p)m.push(GSe(e,p));var v=zSe(e,t,m[0].texture);e.state.currentRenderItemId=-1,HSe(e);for(var h=0,p=0;p<s;p++){var g=s-1-p,y=m[g];y.framebuffer.bind();var b=Math.pow(2,g);R.update(v.values.uSize,Math.pow(2,p+1)/u),R.update(v.values.uTexSize,b),R.updateIfChanged(v.values.uFirst,p===0),p>0&&(R.update(v.values.tPreviousLevel,m[s-p].texture),v.update()),e.state.currentRenderItemId=-1,a.viewport(0,0,b,b),a.scissor(0,0,b,b),rr(a)?a.clearBufferiv(a.COLOR,0,[0,0,0,0]):a.clear(a.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),v.render(),f.bind(0),a.copyTexSubImage2D(a.TEXTURE_2D,0,h,0,0,0,b,b),f.unbind(0),h+=b}a.finish();var x=Math.max(1,LSe(e,m[0].texture)),C=Math.ceil(x/Math.pow(2,s));return{pyramidTex:f,count:x,height:C,levels:s,scale:r}}var S0;function WSe(){if(S0!==void 0)return S0;S0=Yn(16*16,1,Uint8Array);for(var e=S0.array,t=0,r=Fp.length;t<r;++t)e[t]=Fp[t].length/3;return S0}var C0;function XSe(){if(C0!==void 0)return C0;C0=Yn(64*64,1,Uint8Array);for(var e=C0.array,t=0,r=Fp.length;t<r;++t)for(var n=0;n<16;++n)n<Fp[t].length?e[t*16+n]=Fp[t][n]:e[t*16+n]=255;return C0}var YSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,KSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,QSe=I(I({},ua),{tTriCount:Lt("image-uint8","alpha","ubyte","nearest"),tVolumeData:Lt("texture","rgba","ubyte","nearest"),uIsoValue:Ee("f"),uGridDim:Ee("v3"),uGridTexDim:Ee("v3"),uScale:Ee("v2")}),Ds="active-voxels";function ZSe(e,t,r,n,a,i){if(e.namedComputeRenderables[Ds]){var o=e.namedComputeRenderables[Ds].values;R.update(o.uQuadScale,i),R.update(o.tVolumeData,t),R.updateIfChanged(o.uIsoValue,a),R.update(o.uGridDim,r),R.update(o.uGridTexDim,n),R.update(o.uScale,i),e.namedComputeRenderables[Ds].update()}else e.namedComputeRenderables[Ds]=$Se(e,t,r,n,a,i);return e.namedComputeRenderables[Ds]}function $Se(e,t,r,n,a,i){var o=I(I({},ca),{tTriCount:R.create(WSe()),uQuadScale:R.create(i),tVolumeData:R.create(t),uIsoValue:R.create(a),uGridDim:R.create(r),uGridTexDim:R.create(n),uScale:R.create(i)}),s=I({},QSe),u=Qr("active-voxels",Ka,KSe),c=zn(e,"triangles",u,s,o);return Vn(c,o)}function JSe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function eCe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=t.getWidth(),c=t.getHeight();e.namedFramebuffers[Ds]||(e.namedFramebuffers[Ds]=s.framebuffer());var l=e.namedFramebuffers[Ds];l.bind(),e.namedTextures[Ds]||(e.namedTextures[Ds]=s.texture("image-uint8","rgba","ubyte","nearest"));var f=e.namedTextures[Ds];f.define(u,c);var d=ZSe(e,t,r,n,a,i);return e.state.currentRenderItemId=-1,f.attachFramebuffer(l,0),JSe(e),o.viewport(0,0,u,c),o.scissor(0,0,u,c),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),d.render(),o.finish(),f}var tCe=I(I({},ua),{tTriIndices:Lt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:Lt("texture","rgba","float","nearest"),tActiveVoxelsBase:Lt("texture","rgba","float","nearest"),tVolumeData:Lt("texture","rgba","ubyte","nearest"),uIsoValue:Ee("f"),uSize:Ee("f"),uLevels:Ee("f"),uCount:Ee("f"),uInvert:Ee("b"),uGridDim:Ee("v3"),uGridTexDim:Ee("v3"),uGridTransform:Ee("m4"),uScale:Ee("v2"),dPackedGroup:Ot("boolean"),dAxisOrder:Ot("string",["012","021","102","120","201","210"])}),Yl="isosurface";function rCe(e,t,r,n,a,i,o,s,u,c,l,f,d,m){if(e.namedComputeRenderables[Yl]){var p=e.namedComputeRenderables[Yl].values;R.update(p.tActiveVoxelsPyramid,t),R.update(p.tActiveVoxelsBase,r),R.update(p.tVolumeData,n),R.updateIfChanged(p.uIsoValue,s),R.updateIfChanged(p.uSize,Math.pow(2,u)),R.updateIfChanged(p.uLevels,u),R.updateIfChanged(p.uCount,l),R.updateIfChanged(p.uInvert,f),R.update(p.uGridDim,a),R.update(p.uGridTexDim,i),R.update(p.uGridTransform,o),R.update(p.uScale,c),R.update(p.dPackedGroup,d),R.updateIfChanged(p.dAxisOrder,m.join("")),e.namedComputeRenderables[Yl].update()}else e.namedComputeRenderables[Yl]=nCe(e,t,r,n,a,i,o,s,u,c,l,f,d,m);return e.namedComputeRenderables[Yl]}function nCe(e,t,r,n,a,i,o,s,u,c,l,f,d,m){var p=I(I({},ca),{tTriIndices:R.create(XSe()),tActiveVoxelsPyramid:R.create(t),tActiveVoxelsBase:R.create(r),tVolumeData:R.create(n),uIsoValue:R.create(s),uSize:R.create(Math.pow(2,u)),uLevels:R.create(u),uCount:R.create(l),uInvert:R.create(f),uGridDim:R.create(a),uGridTexDim:R.create(i),uGridTransform:R.create(o),uScale:R.create(c),dPackedGroup:R.create(d),dAxisOrder:R.create(m.join(""))}),v=I({},tCe),h=Qr("isosurface",Ka,YSe,{drawBuffers:"required"}),g=zn(e,"triangles",h,v,p);return Vn(g,p)}function aCe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function iCe(e,t,r,n,a,i,o,s,u,c,l,f,d,m){var p=e.extensions.drawBuffers;if(!p)throw new Error("need WebGL draw buffers");var v=e.gl,h=e.resources,g=e.extensions,y=n.pyramidTex,b=n.height,x=n.levels,C=n.scale,_=n.count,w=y.getWidth();e.namedFramebuffers[Yl]||(e.namedFramebuffers[Yl]=h.framebuffer());var T=e.namedFramebuffers[Yl];rr(v)?(f||(f=g.colorBufferHalfFloat&&g.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-uint8","rgba","ubyte","nearest")),m||(m=g.colorBufferHalfFloat&&g.textureHalfFloat?h.texture("image-float16","rgba","fp16","nearest"):h.texture("image-float32","rgba","float","nearest"))):(f||(f=h.texture("image-float32","rgba","float","nearest")),d||(d=h.texture("image-float32","rgba","float","nearest")),m||(m=h.texture("image-float32","rgba","float","nearest"))),f.define(w,b),d.define(w,b),m.define(w,b),f.attachFramebuffer(T,0),d.attachFramebuffer(T,1),m.attachFramebuffer(T,2);var A=rCe(e,y,t,r,a,i,o,s,x,C,_,u,c,l);return e.state.currentRenderItemId=-1,T.bind(),p.drawBuffers([p.COLOR_ATTACHMENT0,p.COLOR_ATTACHMENT1,p.COLOR_ATTACHMENT2]),aCe(e),v.viewport(0,0,w,b),v.clear(v.COLOR_BUFFER_BIT),A.render(),v.finish(),{vertexTexture:f,groupTexture:d,normalTexture:m,vertexCount:_}}function GT(e,t,r,n,a,i,o,s,u,c,l,f,d){var m=eCe(e,t,r,n,o,a),p=jSe(e,m,a,n),v=iCe(e,m,t,p,r,n,i,o,s,u,c,l,f,d);return v}var jU={isoValue:vt.IsoValueParam};function oCe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var _0=1;function HT(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;var r=e.grid.cells.space.dimensions,n=t0(r,_0).powerOfTwoSize;return n<=t.maxTextureSize/2}function sCe(e,t,r,n){return r.tryUseGpu&&n&&oCe(n)&&HT(t,n)?fCe(e):cCe(e)}function WU(e,t){return vt.Isosurface.Loci(e,t.isoValue)}function qT(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?vt.Cell.Loci(t,Se.ofSingleton(i)):ur}function jT(e,t,r,n){return wA(e,t,r.isoValue,n)}function uCe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Po(new Int32Array(t.grid.cells.data.length)),[4,c2({isoLevel:vt.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:sr.create(t.grid.cells.space,sr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=ka.getGridToCartesianTransform(t.grid),At.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&At.uniformTriangleGroup(o,!1),o.setBoundingSphere(vt.getBoundingSphere(t)),[2,o]}})})}var WT=I(I(I(I({},At.Params),ko.Params),jU),{quality:I(I({},At.Params.quality),{isEssential:!1}),tryUseGpu:P.Boolean(!0)});function cCe(e){return x0({defaultProps:P.getDefaultValues(WT),createGeometry:uCe,createLocationIterator:function(t){return Wr(t.grid.cells.data.length,1,1,function(){return eo})},getLoci:qT,eachLocation:jT,setUpdateState:function(t,r,n,a){vt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:At.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&HT(t,n)}},e)}var XT;(function(e){var t="volume-isosurface-texture";e.descriptor=to({name:t});function r(n,a){var i=a.resources,o=ka.getGridToCartesianTransform(n.grid),s=S.clone(n.grid.cells.space.dimensions),u=t0(s,_0),c=u.width,l=u.height,f=u.powerOfTwoSize,d=S.create(c,l,0),m=Fe.create(c/f,l/f);if(f>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");var p=n._propertyData[t];p.define(f,f),p.load(y8(n,"data",_0),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return p.destroy()}}])}return s[0]+=_0,s[1]+=_0,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:d,gridTexScale:m}}e.get=r})(XT||(XT={}));function lCe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x;return ae(this,function(C){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return t.grid.cells.data.length<=1?[2,ko.createEmpty(a)]:(i=t.grid.stats,o=i.max,s=i.min,u=o-s,c=vt.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,l=(c-s)/u,f=XT.get(t,e.webgl),d=f.texture,m=f.gridDimension,p=f.gridTexDim,v=f.gridTexScale,h=f.transform,g=t.grid.cells.space.axisOrderSlowToFast,y=a==null?void 0:a.doubleBuffer.get(),b=GT(e.webgl,d,m,p,v,h,l,c<0,!1,g,y==null?void 0:y.vertex,y==null?void 0:y.group,y==null?void 0:y.normal),x=ko.create(b.vertexCount,1,b.vertexTexture,b.groupTexture,b.normalTexture,vt.getBoundingSphere(t),a),[2,x])})})}function fCe(e){return x0({defaultProps:P.getDefaultValues(WT),createGeometry:lCe,createLocationIterator:function(t){return Wr(t.grid.cells.data.length,1,1,function(){return eo})},getLoci:qT,eachLocation:jT,setUpdateState:function(t,r,n,a){vt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ko.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!HT(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function dCe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s;return ae(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),i=Po(new Int32Array(t.grid.cells.data.length)),[4,zT({isoLevel:vt.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:sr.create(t.grid.cells.space,sr.Data1(i))},a).runAsChild(e.runtime)];case 1:return o=u.sent(),s=ka.getGridToCartesianTransform(t.grid),Xr.transform(o,s),o.setBoundingSphere(vt.getBoundingSphere(t)),[2,o]}})})}var XU=I(I(I({},Xr.Params),jU),{quality:I(I({},Xr.Params.quality),{isEssential:!1}),sizeFactor:P.Numeric(3,{min:0,max:10,step:.1})});function mCe(e){return x0({defaultProps:P.getDefaultValues(XU),createGeometry:dCe,createLocationIterator:function(t){return Wr(t.grid.cells.data.length,1,1,function(){return eo})},getLoci:qT,eachLocation:jT,setUpdateState:function(t,r,n,a){vt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Xr.Utils},e)}var YU={solid:function(e,t){return l2("Isosurface mesh",e,t,sCe,WU)},wireframe:function(e,t){return l2("Isosurface wireframe",e,t,mCe,WU)}},KU=I(I(I({},WT),XU),{visuals:P.MultiSelect(["solid"],P.objectToOptions(YU)),bumpFrequency:P.Numeric(1,{min:0,max:10,step:.1},Je.ShadingCategory)});function pCe(e,t){var r=P.clone(KU);return r.isoValue=vt.createIsoValueParam(vt.IsoValue.relative(2),t.grid.stats),r}function vCe(e,t){return Vt.createMulti("Isosurface",e,t,Vt.StateBuilder,YU)}var hCe=VT({name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:vCe,getParams:pCe,defaultValues:P.getDefaultValues(KU),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!vt.isEmpty(e)}});function gCe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F,O,U,N,q,j,Q,J,te,K,L,W,k,V;return ae(this,function(G){for(i=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,c=s.data,l=t.grid.stats,f=l.min,d=l.max,m=vt.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,p=r.color.color(eo,!1),v=st.toRgbNormalized(p),h=v[0],g=v[1],y=v[2],b=YT(t.grid,n),x=b.width,C=b.height,_=b.x,w=b.y,T=b.z,A=b.x0,D=b.y0,E=b.z0,M=b.nx,F=b.ny,O=b.nz,U=new Float32Array(i==="x"?[_,0,0,_,w,0,_,0,T,_,w,T]:i==="y"?[0,w,0,_,w,0,0,w,T,_,w,T]:[0,0,T,0,w,T,_,0,T,_,w,T]),N=new Uint8Array(x*C*4),q=yCe(t.grid,n),j=0,Q=D;Q<F;++Q)for(J=A;J<M;++J)for(te=E;te<O;++te)K=u.get(c,J,Q,te),L=(K-f)/(d-f),N[j]=h*L*2*255,N[j+1]=g*L*2*255,N[j+2]=y*L*2*255,N[j+3]=K>=m?255:0,j+=4;return W={width:x,height:C,array:N,flipY:!0},k={width:x,height:C,array:q,flipY:!0},V=ka.getGridToCartesianTransform(t.grid),Wf(V,U,0,4),[2,ac.create(W,U,k,a)]})})}function YT(e,t){var r=t.dimension,n=r.name,a=r.params,i=e.cells.space,o,s,u,c,l,f=0,d=0,m=0,p=i.dimensions,v=p[0],h=p[1],g=p[2];return n==="x"?(u=a,c=h-1,l=g-1,o=g,s=h,f=u,v=f+1):n==="y"?(u=v-1,c=a,l=g-1,o=g,s=v,d=c,h=d+1):(u=v-1,c=h-1,l=a,o=v,s=h,m=l,g=m+1),{width:o,height:s,x:u,y:c,z:l,x0:f,y0:d,z0:m,nx:v,ny:h,nz:g}}function yCe(e,t){for(var r=e.cells.space,n=YT(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,f=n.nz,d=new Uint8Array(a*i*4),m=0,p=s;p<l;++p)for(var v=o;v<c;++v)for(var h=u;h<f;++h)Ch(r.dataOffset(v,p,h),d,m),m+=4;return d}function bCe(e,t){for(var r=e.cells.space,n=YT(e,t),a=n.width,i=n.height,o=n.x0,s=n.y0,u=n.z0,c=n.nx,l=n.ny,f=n.nz,d=new Uint32Array(a*i),m=0,p=s;p<l;++p)for(var v=o;v<c;++v)for(var h=u;h<f;++h)d[m]=r.dataOffset(v,p,h),m+=1;return d}function xCe(e,t){var r=bCe(e.grid,t);return vt.Cell.Loci(e,Le.ofUnsortedArray(r))}function SCe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?vt.Cell.Loci(t,Se.ofSingleton(i)):ur}function CCe(e,t,r,n){return wA(e,t,void 0,n)}var KT=I(I({},ac.Params),{quality:I(I({},ac.Params.quality),{isEssential:!1}),dimension:P.MappedStatic("x",{x:P.Numeric(0,{min:0,max:0,step:1}),y:P.Numeric(0,{min:0,max:0,step:1}),z:P.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:vt.IsoValueParam});function _Ce(e,t){var r=P.clone(KT),n=t.grid.cells.space.dimensions;return r.dimension=P.MappedStatic("x",{x:P.Numeric(0,{min:0,max:n[0]-1,step:1}),y:P.Numeric(0,{min:0,max:n[1]-1,step:1}),z:P.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=vt.createIsoValueParam(vt.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function wCe(e){return x0({defaultProps:P.getDefaultValues(KT),createGeometry:gCe,createLocationIterator:function(t){return Wr(t.grid.cells.data.length,1,1,function(){return eo})},getLoci:SCe,eachLocation:CCe,setUpdateState:function(t,r,n,a,i,o){t.createGeometry=n.dimension.name!==a.dimension.name||n.dimension.params!==a.dimension.params||!vt.IsoValue.areSame(n.isoValue,a.isoValue,r.grid.stats)||!du.areEqual(i.color,o.color)},geometryUtils:I(I({},ac.Utils),{createRenderableState:function(t){var r=ac.Utils.createRenderableState(t);return QU(r,t),r},updateRenderableState:QU})},e)}function QU(e,t){ac.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function ACe(e,t){return l2("Slice",e,t,wCe,xCe)}var TCe=VT({name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:ACe,getParams:_Ce,defaultValues:P.getDefaultValues(KT),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!vt.isEmpty(e)}});function ZU(e,t){var r=Bt();return Bt.add(r,e),Bt.transform(r,r,t),r}function PCe(e,t,r,n){var a=r.grid.cells.space.dimensions,i=t0(a),o=i.width,s=i.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=y8(r,"normals"),c=ka.getGridToCartesianTransform(r.grid),l=ZU(a,c),f=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");f.load(u);var d=$U(r.grid),m=d.unitToCartn,p=d.cellDim,v=r.grid.cells.space.axisOrderSlowToFast;return ro.create(l,a,c,m,p,f,r.grid.stats,!1,v,n)}function $U(e){if(e.transform.kind==="matrix")return{unitToCartn:se.mul(se(),e.transform.matrix,se.fromScaling(se(),e.cells.space.dimensions)),cellDim:se.getScaling(S(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Bt.size(S(),t);return{unitToCartn:se.mul3(se(),e.transform.cell.fromFractional,se.fromTranslation(se(),t.min),se.fromScaling(se(),r)),cellDim:S.div(S(),e.transform.cell.size,e.cells.space.dimensions)}}function ECe(e,t,r,n){var a=r.grid.cells.space.dimensions;if(Math.max.apply(Math,a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var i=Gpe(r),o=ka.getGridToCartesianTransform(r.grid),s=ZU(a,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(i);var c=$U(r.grid),l=c.unitToCartn,f=c.cellDim,d=r.grid.cells.space.axisOrderSlowToFast;return ro.create(s,a,o,l,f,u,r.grid.stats,!1,d,n)}function ICe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o;return ae(this,function(s){if(i=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?ECe(i,o,t,a):PCe(i,o,t,a)]})})}function DCe(e,t){return vt.Loci(e)}function MCe(e,t,r,n){var a=e.objectId,i=e.groupId;return n===a?vt.Cell.Loci(t,Se.ofSingleton(i)):ur}function RCe(e,t,r,n){return wA(e,t,void 0,n)}var QT=I(I({},ro.Params),{quality:I(I({},ro.Params.quality),{isEssential:!1})});function BCe(e,t){return P.clone(QT)}function FCe(e){return x0({defaultProps:P.getDefaultValues(QT),createGeometry:ICe,createLocationIterator:function(t){return Wr(t.grid.cells.data.length,1,1,function(){return eo})},getLoci:MCe,eachLocation:RCe,setUpdateState:function(t,r,n,a){},geometryUtils:ro.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function OCe(e,t){return l2("Direct Volume",e,t,FCe,DCe)}var kCe=VT({name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:OCe,getParams:BCe,defaultValues:P.getDefaultValues(QT),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!vt.isEmpty(e)}}),m2=function(e){_t(t,e);function t(){var r=e.call(this)||this;return wo(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return t}(_8);(function(e){e.BuiltIn={isosurface:hCe,slice:TCe,"direct-volume":kCe}})(m2||(m2={}));function JU(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:vt.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var LCe=Mi.build({display:{name:"Volume Streaming"},from:fe.Molecule.Structure,params:function(e,t){var r=ySe(e&&e.data),n=SSe(r,e&&e.data);return{method:P.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:P.ObjectList({id:P.Text(n[0]||"")},function(a){var i=a.id;return i},{defaultValue:n.map(function(a){return{id:a}})}),defaultView:P.Select(r==="em"?"cell":"selection-box",fo.ViewTypeOptions),options:P.Group({serverUrl:P.Text(t.config.get(wn.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:P.Text("",{isHidden:!0}),emContourProvider:P.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:P.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(wn.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&jt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,a=e.params;return Be.create("Volume Streaming",function(i){return ie(void 0,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_;return ae(this,function(w){switch(w.label){case 0:o=[],s=0,u=a.entries.length,w.label=1;case 1:return s<u?(c=a.entries[s].id.toLowerCase(),l=void 0,a.method!=="em"?[3,14]:c.toUpperCase().startsWith("EMD")?[3,11]:[4,i.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,wSe(t,i,c)];case 3:f=w.sent(),d=0,m=f.length,w.label=4;case 4:if(!(d<m))return[3,10];p=f[d],v=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,NU(a.options.emContourProvider,t,i,p)];case 6:return v=w.sent(),[3,8];case 7:return h=w.sent(),console.info("Could not get map info for ".concat(p,": ").concat(h)),[3,9];case 8:JU(o,a.method,p,v||0),w.label=9;case 9:return++d,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,NU(a.options.emContourProvider,t,i,c)];case 12:return l=w.sent(),[3,14];case 13:return g=w.sent(),console.info("Could not get map info for ".concat(c,": ").concat(g)),[3,15];case 14:JU(o,a.method,c,l||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(fo.RootTag,zCe,{serverUrl:a.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(x=n.tree.children.get(b.ref),(x==null?void 0:x.size)>0?[4,t.managers.structure.hierarchy.remove(x==null?void 0:x.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return C=b.cell.obj,_=n.build().to(y.ref).apply(ez,P.getDefaultValues(fo.createParams({data:C.data,defaultView:a.defaultView,channelParams:a.options.channelParams})),{ref:a.options.behaviorRef?a.options.behaviorRef:void 0}),a.method==="em"?_.apply(p2,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(_.apply(p2,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),_.apply(p2,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),_.apply(p2,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(_).runInContext(i)];case 20:return w.sent(),[2]}})})})}),NCe=Mi.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:fo,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,a=e.state,i=r.data.params;if(i.entry.params.view.name==="selection-box"){var o=Bt.create(S.clone(i.entry.params.view.params.bottomLeft),S.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Bt.expand(o,o,S.create(s,s,s));var u=I(I({},i),{entry:{name:i.entry.name,params:I(I({},i.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return a.updateTree(a.build().to(n).update(u))}}),UCe={dataId:P.Text(""),source:P.MappedStatic("x-ray",{em:P.Group({isoValue:vt.createIsoValueParam(vt.IsoValue.relative(1))}),"x-ray":P.Group({})})},zCe=bt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:fe.Molecule.Structure,to:NT,params:function(e){return{serverUrl:P.Text("https://ds.litemol.org"),entries:P.ObjectList(UCe,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return Be.create("",function(a){return ie(void 0,void 0,void 0,function(){var i,o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:i=[],o=0,s=n.entries.length,m.label=1;case 1:return o<s?(u=n.entries[o],c=u.dataId,l=u.source.name==="em"?u.source.params.isoValue:vt.IsoValue.relative(1),[4,a.update("Getting server header...")]):[3,5];case 2:return m.sent(),[4,t.fetch({url:NA(n.serverUrl,"".concat(u.source.name,"/").concat(c.toLocaleLowerCase())),type:"json"}).runInContext(a)];case 3:f=m.sent(),i.push({dataId:c,kind:u.source.name,header:f,emDefaultContourLevel:l}),m.label=4;case 4:return++o,[3,1];case 5:return d={serverUrl:n.serverUrl,entries:i,structure:r.data},[2,new NT(d,{label:"Volume Server",description:"".concat(i.map(function(p){return p.dataId}).join(", "))})]}})})})}}),ez=bt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:NT,to:fo,params:function(e){return fo.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return Be.create("Volume streaming",function(a){return ie(void 0,void 0,void 0,function(){var i;return ae(this,function(o){switch(o.label){case 0:return i=new fo.Behavior(t,r.data),[4,i.update(n)];case 1:return o.sent(),[2,new fo(i,{label:"Volume Streaming",description:i.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,a=e.newParams;return Be.create("Update Volume Streaming",function(i){return ie(t,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return n.entry.name!==a.entry.name&&"em"in a.entry.params.channels&&(o=r.data.infoMap.get(a.entry.name).emDefaultContourLevel,o&&(a.entry.params.channels.em.isoValue=o)),[4,r.data.update(a)];case 1:return s=u.sent()?Ge.UpdateResult.Updated:Ge.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),p2=bt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:fo,to:fe.Volume.Representation3D,params:{channel:P.Select("em",fo.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,a=e.spine;return Be.create("Volume Representation",function(i){return ie(void 0,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return o=r.data.channels[n.channel],o?(s=tz(r.data,n.channel),u=m2.BuiltIn.isosurface,c=s.type.params||{},l=u.factory(I({webgl:(m=t.canvas3d)===null||m===void 0?void 0:m.webgl},t.representation.volume.themes),u.getParams),l.setTheme(kn.create(t.representation.volume.themes,{volume:o.data},s)),f=(p=a.getAncestorOfType(fe.Molecule.Structure))===null||p===void 0?void 0:p.data,d=(f==null?void 0:f.models.length)===0?void 0:cd.get(f==null?void 0:f.models[0]),[4,l.createOrUpdate(c,o.data).runInContext(i)]):[2,rn.Null];case 1:return v.sent(),d&&l.setState({transform:d}),[2,new fe.Volume.Representation3D({repr:l,sourceData:o.data},{label:"".concat(Math.round(o.isoValue.relativeValue*100)/100," \u03C3 [").concat(n.channel,"]")})]}})})})},update:function(e,t){var r=e.a,n=e.b,a=e.newParams;return e.spine,Be.create("Volume Representation",function(i){return ie(void 0,void 0,void 0,function(){var o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return o=r.data.channels[a.channel],o?(s=n.data.repr.state.visible,u=tz(r.data,a.channel),c=I(I({},n.data.repr.props),u.type.params),n.data.repr.setTheme(kn.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(c,o.data).runInContext(i)]):[2,Ge.UpdateResult.Unchanged];case 1:return l.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,Ge.UpdateResult.Updated]}})})})}});function tz(e,t){var r=e.channels[t];return bc.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var VCe=Pu.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:P.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_;return ae(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(a=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===i&&o++,o=o%n.size,s=n.get(i).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(c=s.data.tree.transforms,l=u.data.tree.transforms,f=r.plugin.state.data,d=f.build(),m=0,p=c;m<p.length;m++)for(v=p[m],h=0,g=l;h<g.length;h++)y=g[h],y.ref===v.ref&&y.version!==v.version&&(b=gr.fromJSON(v),x=gr.fromJSON(y),C=f.cells.get(v.ref),!!C&&(_=void 0,b.transformer.definition.interpolate?_=b.transformer.definition.interpolate(b.params,x.params,a,r.plugin):_=a<=.5?b.params:x.params,Hv(C,_)||d.to(v.ref).update(_)));return[4,Xt.State.Update(r.plugin,{state:f,tree:d,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),GCe=Pu.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:P.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ae(this,function(f){for(n=r.state.data,a=n.select(Yt.Generators.ofType(fe.Molecule.Structure.Representation3D)),i=n.build(),o=!1,s=0,u=a;s<u.length;s++)c=u[s],l=n.select(Yt.Generators.ofTransformer(ze.Representation.SpinStructureRepresentation3D,c.transform.ref)),!(l.length>0)&&(o=!0,i.to(c.transform.ref).apply(ze.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,i.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,a=n.select(Yt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(a.length!==0){for(var i=n.build(),o=0,s=a;o<s.length;o++){var u=s[o];i.delete(u.transform.ref)}return i.commit()}},apply:function(e,t,r){var n;return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:if(a=r.plugin.state.data,i=a.select(Yt.Generators.ofTransformer(ze.Representation.SpinStructureRepresentation3D)),i.length===0)return[2,{kind:"finished"}];for(o=a.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,c=0,l=i;c<l.length;c++)f=l[c],o.to(f).update(I(I({},(n=f.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,Xt.State.Update(r.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}})];case 1:return d.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),v2=S(),rz=S(),nz=Gr(),HCe=Pu.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:function(){return{durationInMs:P.Numeric(4e3,{min:100,max:2e4,step:100}),speed:P.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:P.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}},initialState:function(e,t){return{snapshot:t.canvas3d.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,a;return ie(this,void 0,void 0,function(){var i,o,s,u;return ae(this,function(c){return t.current===0?[2,{kind:"next",state:e}]:(i=e.snapshot,i.radiusMax<1e-4?[2,{kind:"finished"}]:(o=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):Ra(t.current/r.params.durationInMs,0,1),s=Math.sin(o*r.params.speed*Math.PI*2)*pr(r.params.angle),S.sub(v2,i.position,i.target),S.normalize(rz,i.up),Gr.setAxisAngle(nz,rz,s),S.transformQuat(v2,v2,nz),u=S.add(S(),i.target,v2),(a=r.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({snapshot:I(I({},i),{position:u}),durationMs:0}),o>=.99999?[2,{kind:"finished"}]:[2,{kind:"next",state:e}]))})})}}),kt;(function(e){function t(n,a){return{action:n,customControl:a&&a.customControl,autoUpdate:a&&a.autoUpdate}}e.Action=t;function r(n,a){return a===void 0&&(a={}),{transformer:n,defaultParams:a}}e.Behavior=r})(kt||(kt={}));var HPe=function(){return{actions:[kt.Action(Bd.Structure.DownloadStructure),kt.Action(Bd.Structure.AddTrajectory),kt.Action(Bd.Volume.DownloadDensity),kt.Action(Bd.DataFormat.DownloadFile),kt.Action(Bd.DataFormat.OpenFiles),kt.Action(Bd.Structure.EnableModelCustomProps),kt.Action(Bd.Structure.EnableStructureCustomProps),kt.Action(LCe),kt.Action(NCe),kt.Action(ez),kt.Action(ze.Data.Download),kt.Action(ze.Data.ParseCif),kt.Action(ze.Data.ParseCcp4),kt.Action(ze.Data.ParseDsn6),kt.Action(ze.Model.TrajectoryFromMmCif),kt.Action(ze.Model.TrajectoryFromCifCore),kt.Action(ze.Model.TrajectoryFromPDB),kt.Action(ze.Model.TransformStructureConformation),kt.Action(ze.Model.StructureFromModel),kt.Action(ze.Model.StructureFromTrajectory),kt.Action(ze.Model.ModelFromTrajectory),kt.Action(ze.Model.StructureSelectionFromScript),kt.Action(ze.Representation.StructureRepresentation3D),kt.Action(ze.Representation.StructureSelectionsDistance3D),kt.Action(ze.Representation.StructureSelectionsAngle3D),kt.Action(ze.Representation.StructureSelectionsDihedral3D),kt.Action(ze.Representation.StructureSelectionsLabel3D),kt.Action(ze.Representation.StructureSelectionsOrientation3D),kt.Action(ze.Representation.ModelUnitcell3D),kt.Action(ze.Representation.StructureBoundingBox3D),kt.Action(ze.Representation.ExplodeStructureRepresentation3D),kt.Action(ze.Representation.SpinStructureRepresentation3D),kt.Action(ze.Representation.UnwindStructureAssemblyRepresentation3D),kt.Action(ze.Representation.OverpaintStructureRepresentation3DFromScript),kt.Action(ze.Representation.TransparencyStructureRepresentation3DFromScript),kt.Action(ze.Representation.ClippingStructureRepresentation3DFromScript),kt.Action(ze.Representation.SubstanceStructureRepresentation3DFromScript),kt.Action(kU),kt.Action(ze.Volume.VolumeFromCcp4),kt.Action(ze.Volume.VolumeFromDsn6),kt.Action(ze.Volume.VolumeFromCube),kt.Action(ze.Volume.VolumeFromDx),kt.Action(ze.Representation.VolumeRepresentation3D)],behaviors:[kt.Behavior(lo.Representation.HighlightLoci),kt.Behavior(lo.Representation.SelectLoci),kt.Behavior(lo.Representation.DefaultLociLabelProvider),kt.Behavior(lo.Representation.FocusLoci),kt.Behavior(lo.Camera.FocusLoci),kt.Behavior(lo.Camera.CameraAxisHelper),kt.Behavior(kT),kt.Behavior(lo.CustomProps.StructureInfo),kt.Behavior(lo.CustomProps.AccessibleSurfaceArea),kt.Behavior(lo.CustomProps.BestDatabaseSequenceMapping),kt.Behavior(lo.CustomProps.Interactions),kt.Behavior(lo.CustomProps.SecondaryStructure),kt.Behavior(lo.CustomProps.ValenceModel),kt.Behavior(lo.CustomProps.CrossLinkRestraint)],animations:[M0e,D0e,HCe,R0e,I0e,GCe,VCe]}};function qCe(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:"".concat(t,"px"),height:"".concat(r,"px")})}function jCe(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,a=window.innerHeight;t!==document.body&&(n=t.offsetWidth,a=t.offsetHeight),qCe(e,n,a,r)}function WCe(e,t,r,n){for(var a=atob(e.toDataURL(r,n).split(",")[1]),i=a.length,o=i>>2,s=new Uint8Array(i),u=new Uint32Array(s.buffer,0,o),c=0,l=0;l<o;++l)u[l]=a.charCodeAt(c++)|a.charCodeAt(c++)<<8|a.charCodeAt(c++)<<16|a.charCodeAt(c++)<<24;for(var f=i&3;f--;)s[c]=a.charCodeAt(c++);t(new Blob([s],{type:r||"image/png"}))}function az(e,t,r){return ie(this,void 0,void 0,function(){return ae(this,function(n){return[2,new Promise(function(a,i){var o=function(s){s?a(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):WCe(e,o,t,r)})]})})}var h2;(function(e){var t=function(){function r(){this.providers=ds().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var a={},i=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var c=u.value;!c.isApplicable(n)||(c.isHidden||(i.push([c.descriptor.name,c.label]),this.defaultAutoAttachValues.get(c.descriptor.name)&&o.push(c.descriptor.name)),a[c.descriptor.name]=P.Group(I({},c.getParams(n)),{label:c.label,isHidden:c.isHidden}))}return{autoAttach:P.MultiSelect(o,i),properties:P.Group(a,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,a){this.defaultAutoAttachValues.set(n,a)},r.prototype.get=function(n){var a=this.providers.get(n);if(!a)throw new Error("Custom property '".concat(n,"' is not registered."));return this.providers.get(n)},r.prototype.register=function(n,a){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,a)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(h2||(h2={}));var XCe=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(eB,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply($R,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(JR,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return ie(this,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(tB,t,r).commit({revertOnError:!0})];case 1:return a=o.sent(),i=u2(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:a,fileInfo:i}]}})})},e}(),YCe=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=hu.auto,wo(hu,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=hu[t])!==null&&r!==void 0?r:r3(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name,i.display.group])}return P.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?P.Group(o.params(t,this.plugin)):P.EmptyGroup())}return r.length===0?P.MappedStatic("",{"":P.EmptyGroup()}):P.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),dh(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i,o=this.resolveProvider(r);if(!!o){var s=this.plugin.state.data,u=ia.resolveAndCheck(s,t);if(!u){ih||console.warn("Applying structure repr. provider to bad cell.");return}var c=((i=o.params)===null||i===void 0?void 0:i.call(o,u.obj,this.plugin))||{},l=n||(o.params?P.getDefaultValues(c):{}),f=this.plugin.config.get(wn.Structure.DefaultRepresentationPresetParams);l=P.merge(c,f,l);var d=Be.create("".concat(o.display.name),function(){return o.apply(u,l,a.plugin)});return this.plugin.runTask(d)}},e.prototype.addRepresentation=function(t,r,n){return ie(this,void 0,void 0,function(){var a,i;return ae(this,function(o){switch(o.label){case 0:return a=this.dataState.build(),i=this.buildRepresentation(a,t,r,n),i?[4,a.commit()]:[2];case 1:return o.sent(),[2,i]}})})},e.prototype.buildRepresentation=function(t,r,n,a){var i,o;if(!!r){var s=(o=(i=ia.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!s){var u=s2(this.plugin,s,n);return(a==null?void 0:a.tag)?t.to(r).applyOrUpdateTagged(a.tag,Eb,u,{state:a==null?void 0:a.initialState}).selector:t.to(r).apply(Eb,u,{state:a==null?void 0:a.initialState}).selector}}},e}();function Kl(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:P.Optional(P.Group(Ge.getParamDefinition(ze.Model.CustomModelProperties,void 0,r))),structureProperties:P.Optional(P.Group(Ge.getParamDefinition(ze.Model.CustomStructureProperties,void 0,r))),representationPreset:P.Optional(P.Text("auto"))}}})(Kl||(Kl={}));var g2=Kl.CommonParams,KCe=function(e,t){return I({model:P.Optional(P.Group(Ge.getParamDefinition(ze.Model.ModelFromTrajectory,e,t))),showUnitcell:P.Optional(P.Boolean(!1)),structure:P.Optional(fd.getParams(void 0,"assembly").type),representationPresetParams:P.Optional(P.Group(ni.CommonParams))},g2(e,t))},iz=Kl({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:KCe,apply:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=d.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=d.sent(),[4,n.createStructure(i||a,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||!!t.showUnitcell?[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})]:[3,6];case 5:return c=d.sent(),[3,7];case 6:c=void 0,d.label=7;case 7:return u=c,l=t.representationPreset||r.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id,[4,r.builders.structure.representation.applyPreset(s,l,t.representationPresetParams)];case 8:return f=d.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:f}]}})})}}),QCe=function(e,t){return I({useDefaultIfSingleModel:P.Optional(P.Boolean(!1)),representationPresetParams:P.Optional(P.Group(ni.CommonParams))},g2(e,t))},ZCe=Kl({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:QCe,apply:function(e,t,r){var n,a;return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:if(i=(a=(n=ia.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data,!i)return[2,{}];if(i.frameCount===1&&t.useDefaultIfSingleModel)return[2,iz.apply(e,t,r)];o=r.builders.structure,s=[],u=[],c=0,h.label=1;case 1:return c<i.frameCount?[4,o.createModel(e,{modelIndex:c})]:[3,8];case 2:return l=h.sent(),[4,o.insertModelProperties(l,t.modelProperties,{isCollapsed:!0})];case 3:return f=h.sent(),[4,o.createStructure(f||l,{name:"model",params:{}})];case 4:return d=h.sent(),[4,o.insertStructureProperties(d,t.structureProperties)];case 5:return m=h.sent(),s.push(l),u.push(d),p=d.obj?m8(d.obj.data,{elementCountFactor:i.frameCount}):"medium",v=t.representationPreset||r.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id,[4,o.representation.applyPreset(m,v,{theme:{globalName:"model-index"},quality:p})];case 6:h.sent(),h.label=7;case 7:return c++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),oz=function(e,t){return I({model:P.Optional(P.Group(Ge.getParamDefinition(ze.Model.ModelFromTrajectory,e,t)))},g2(e,t))};function sz(e,t,r,n){return ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return a=n.builders.structure,[4,a.createModel(t,r.model)];case 1:return i=d.sent(),[4,a.insertModelProperties(i,r.modelProperties)];case 2:return o=d.sent(),[4,a.createStructure(o||i,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,a.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,a.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return c=d.sent(),l=r.representationPreset||n.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id,[4,n.builders.structure.representation.applyPreset(u,l,{theme:{globalName:e.theme}})];case 6:return f=d.sent(),[2,{model:i,modelProperties:o,unitcell:c,structure:s,structureProperties:u,representation:f}]}})})}var $Ce=Kl({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:oz,apply:function(e,t,r){return ie(this,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,sz({ijkMin:S.create(0,0,0),ijkMax:S.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),JCe=Kl({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:oz,apply:function(e,t,r){return ie(this,void 0,void 0,function(){return ae(this,function(n){switch(n.label){case 0:return[4,sz({ijkMin:S.create(-1,-1,-1),ijkMax:S.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),e3e=function(e,t){return I({model:P.Optional(P.Group(Ge.getParamDefinition(ze.Model.ModelFromTrajectory,e,t)))},g2(e,t))},t3e=Kl({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:function(e){return jt.hasCrystalSymmetry(e.data.representative)},params:e3e,apply:function(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return a=f.sent(),[4,n.insertModelProperties(a,t.modelProperties)];case 2:return i=f.sent(),[4,n.createStructure(i||a,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=f.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=f.sent(),[4,n.tryCreateUnitcell(i,void 0,{isHidden:!0})];case 5:return u=f.sent(),c=t.representationPreset||r.config.get(wn.Structure.DefaultRepresentationPreset)||hu.auto.id,[4,r.builders.structure.representation.applyPreset(s,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:nA.defaultValues}}}}})];case 6:return l=f.sent(),[2,{model:a,modelProperties:i,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),ZT={default:iz,"all-models":ZCe,unitcell:$Ce,supercell:JCe,crystalContacts:t3e},r3e=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=ZT.default,wo(ZT,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=ZT[t])!==null&&r!==void 0?r:r3(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var a=n[r];if(!a.isApplicable||a.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push(i)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,a=this._providers;n<a.length;n++){var i=a[n];t&&i.isApplicable&&!i.isApplicable(t,this.plugin)||r.push([i.id,i.display.name])}return P.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),a=0,i=this._providers;a<i.length;a++){var o=i[a];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?P.Group(o.params(t,this.plugin)):P.EmptyGroup())}return r.length===0?P.MappedStatic("",{"":P.EmptyGroup()}):P.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '".concat(t.id,"' already registered."));this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),dh(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var a=this,i=this.resolveProvider(r);if(!!i){var o=this.plugin.state.data,s=ia.resolveAndCheck(o,t);if(!s){ih||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(i.params?P.getDefaultValues(i.params(s.obj,this.plugin)):{}),c=Be.create("".concat(i.display.name),function(){return i.apply(s,u,a.plugin)});return this.plugin.runTask(c)}},e}(),n3e=function(){function e(t){this.plugin=t,this.hierarchy=new r3e(this.plugin),this.representation=new YCe(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ie(this,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'".concat(r,"' is not a supported data format."));return[4,n.parse(this.plugin,t)];case 1:return a=i.sent().trajectory,[2,a]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,a=n.build().to(t).apply(ze.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(ze.Model.TrajectoryFromBlob,void 0);return a.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=ia.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return fe.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(ze.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return i.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var a=this.dataState,i=a.build().to(t).apply(ze.Model.CustomModelProperties,r,{state:n});return i.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var a,i,o,s=this.dataState,u=(i=(a=ia.resolveAndCheck(s,t))===null||a===void 0?void 0:a.obj)===null||i===void 0?void 0:i.data;if(!!u){var c=(o=_n.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!pi.isZero(c)){var l=s.build().to(t).apply(ze.Representation.ModelUnitcell3D,r,{state:n});return l.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var a,i=this.dataState;if(!r){var o=ia.resolveAndCheck(i,t);if(o){var s=_n.Provider.get((a=o.obj)===null||a===void 0?void 0:a.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=i.build().to(t).apply(ze.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,a=n.build().to(t).apply(ze.Model.CustomStructureProperties,r);return a.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===ze.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,a){var i,o;return ie(this,void 0,void 0,function(){var s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return s=this.dataState,u=s.build().to(t),c="structure-component-".concat(n),l=u.applyOrUpdateTagged(c,ze.Model.StructureComponent,r,{tags:a?Ht(Ht([],a,!0),[c],!1):[c]}),[4,l.commit()];case 1:return d.sent(),f=l.selector,!f.isOk||((o=(i=f.cell)===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(f.ref).commit()]:[3,3];case 2:return d.sent(),[2];case 3:return[2,f]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,a){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((a==null?void 0:a.label)||"").trim()},n,a==null?void 0:a.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-".concat(r),n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,a){var i=this;return this.plugin.runTask(Be.create("Query Component",function(o){return ie(i,void 0,void 0,function(){var s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:return s=a||{},u=s.label,c=s.tags,u=(u||"").trim(),l=(y=(g=ia.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,l?r.referencesCurrent?(v={},h={name:"bundle"},p=(m=Cr).fromSelection,[4,r.getSelection(this.plugin,o,l)]):[3,2]:[2];case 1:return d=(v.type=(h.params=p.apply(m,[b.sent()]),h),v.nullIfEmpty=!0,v.label=u||r.label,v),[3,3];case 2:d={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return f=d,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},l)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,f,n,c)]}})})}))},e}();function w0(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?a3e(e,t||vt.One,r):uz(e,t||vt.One,r)}function a3e(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,a=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return uz(e,t,{type:n,typeParams:r.typeParams,color:a,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function uz(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,a={volume:t},i=r.type||e.representation.volume.registry.default.provider,o=P.getDefaultValues(i.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=P.getDefaultValues(u.getParams(a));u.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);var l=Object.assign(c,r.colorParams),f=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=P.getDefaultValues(f.getParams(a));f.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);var m=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:u.name,params:l},sizeTheme:{name:f.name,params:m}}}var $T;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(a){return a._propertyData[n]},set:function(a,i){a.customProperties.add(r),a._propertyData[n]=i}}}e.create=t})($T||($T={}));var y2;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=$T.create(e.Descriptor)})(y2||(y2={}));var A0="Volume";function T0(e,t){return ie(this,void 0,void 0,function(){var r,n=this;return ae(this,function(a){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(Be.create("Try Set Recommended IsoValue",function(i){return ie(n,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,UU(e,i,r)];case 1:return o=u.sent(),y2.Provider.set(t,vt.IsoValue.absolute(o)),[3,3];case 2:return s=u.sent(),console.warn(s),[3,3];case 3:return[2]}})})}))]):[2]})})}function cz(e){var t=y2.Provider.get(e);if(!!t)return t.kind==="relative"?t:vt.adjustedIsoValue(e,t.absoluteValue,"absolute")}function JT(e,t){return ie(this,void 0,void 0,function(){var r,n,a;return ae(this,function(i){switch(i.label){case 0:return r={},n=t.volume.data&&cz(t.volume.data),n&&(r.isoValue=n),a=e.build().to(t.volume).apply(ze.Representation.VolumeRepresentation3D,w0(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,a.commit()];case 1:return[2,[i.sent()]]}})})}var i3e=Tc({label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:A0,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(ze.Data.ParseCcp4,{},{state:{isGhost:!0}}),a=n.apply(ze.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,T0(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:JT}),o3e=Tc({label:"DSN6/BRIX",description:"DSN6/BRIX",category:A0,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(ze.Data.ParseDsn6,{},{state:{isGhost:!0}}),a=n.apply(ze.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return i.sent(),[4,T0(e,a.selector.data)];case 2:return i.sent(),[2,{format:n.selector,volume:a.selector}]}})})},visuals:JT}),s3e=Tc({label:"DX",description:"DX",category:A0,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=e.build().to(t).apply(ze.Data.ParseDx,{},{state:{isGhost:!0}}),a=n.apply(ze.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,a.commit({revertOnError:!0})];case 1:return i.sent(),[4,T0(e,a.selector.data)];case 2:return i.sent(),[2,{volume:a.selector}]}})})},visuals:JT}),u3e=Tc({label:"Cube",description:"Cube",category:A0,stringExtensions:["cub","cube"],parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a,i;return ae(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(ze.Data.ParseCube,{},{state:{isGhost:!0}}),a=n.apply(ze.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),i=n.apply(ze.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(ze.Model.ModelFromTrajectory).apply(ze.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,T0(e,a.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:a.selector,structure:i.selector}]}})})},visuals:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return r=e.build(),n=[],a=(f=(l=t.volume.cell)===null||l===void 0?void 0:l.obj)===null||f===void 0?void 0:f.data,a&&vt.isOrbitals(a)?(i=r.to(t.volume).apply(ze.Representation.VolumeRepresentation3D,w0(e,a,{type:"isosurface",typeParams:{isoValue:vt.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:tr.blue}})),o=r.to(t.volume).apply(ze.Representation.VolumeRepresentation3D,w0(e,a,{type:"isosurface",typeParams:{isoValue:vt.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:tr.red}})),n.push(i.selector,o.selector)):(s=r.to(t.volume).apply(ze.Representation.VolumeRepresentation3D,w0(e,a,{type:"isosurface",typeParams:{isoValue:vt.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:tr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=d.sent(),[4,r.commit()];case 2:return d.sent(),c=[],wo(u==null?void 0:u.representations,function(m){m&&c.push(m)}),[2,Ht(Ht([],n,!0),c,!0)]}})})}}),c3e=Tc({label:"DensityServer CIF",description:"DensityServer CIF",category:A0,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return LT(e,t)==="dscif"},parse:function(e,t,r){return ie(void 0,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return[4,e.build().to(t).apply(ze.Data.ParseCif).commit()];case 1:if(n=v.sent(),a=e.build().to(n),i=n.obj.data.blocks.slice(1),i.length!==1&&i.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,c=i;u<c.length;u++)l=c[u],f=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(a.apply(ze.Volume.VolumeFromDensityServerCif,{blockHeader:l.header,entryId:f}).selector),s++;return[4,a.commit()];case 2:v.sent(),d=0,m=o,v.label=3;case 3:return d<m.length?(p=m[d],[4,T0(e,p.data)]):[3,6];case 4:v.sent(),v.label=5;case 5:return d++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n,a,i,o,s;return ae(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),a=[],r.length>0&&(i=r[0].data&&cz(r[0].data)||vt.IsoValue.relative(1.5),a[0]=n.to(r[0]).apply(ze.Representation.VolumeRepresentation3D,bc.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:tr.teal})).selector),r.length>1&&(o=bc.getDefaultParamsStatic(e,"isosurface",{isoValue:vt.IsoValue.relative(3),alpha:.3},"uniform",{value:tr.green}),s=bc.getDefaultParamsStatic(e,"isosurface",{isoValue:vt.IsoValue.relative(-3),alpha:.3},"uniform",{value:tr.red}),a[a.length]=n.to(r[1]).apply(ze.Representation.VolumeRepresentation3D,o).selector,a[a.length]=n.to(r[1]).apply(ze.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,a]}})})}}),l3e=[["ccp4",i3e],["dsn6",o3e],["cube",u3e],["dx",s3e],["dscif",c3e]],f3e="Shape",d3e=Tc({label:"PLY",description:"PLY",category:f3e,stringExtensions:["ply"],parse:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n;return ae(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(ze.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(ze.Model.ShapeFromPly),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(ze.Representation.ShapeRepresentation3D);return r.commit()}}),m3e=[["ply",d3e]],eP="Structure",p3e=Tc({label:"PSF",description:"PSF",category:eP,stringExtensions:["psf"],parse:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n;return ae(this,function(a){switch(a.label){case 0:return r=e.state.data.build().to(t).apply(ze.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(ze.Model.TopologyFromPsf),[4,r.commit()];case 1:return a.sent(),[2,{format:r.selector,topology:n.selector}]}})})}}),v3e=Tc({label:"DCD",description:"DCD",category:eP,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(ze.Model.CoordinatesFromDcd);return r.commit()}}),h3e=Tc({label:"XTC",description:"XTC",category:eP,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(ze.Model.CoordinatesFromXtc);return r.commit()}}),g3e=[["psf",p3e],["dcd",v3e],["xtc",h3e]],y3e=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=l3e;t<r.length;t++){var n=r[t],a=n[0],i=n[1];this.add(a,i)}for(var o=0,s=g3e;o<s.length;o++){var u=s[o],a=u[0],i=u[1];this.add(a,i)}for(var c=0,l=m3e;c<l.length;c++){var f=l[c],a=f[0],i=f[1];this.add(a,i)}for(var d=0,m=FU;d<m.length;d++){var p=m[d],a=p[0],i=p[1];this.add(a,i)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,a,i=r.provider;(n=i.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(a=i.binaryExtensions)===null||a===void 0||a.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,a=r.provider;return(n=a.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(i){return t.add(i)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,a=r.provider;return t.push([n,a.label,a.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,a=this.list.length;n<a;++n){var i=this._list[n].provider,o=!1;if((i.binaryExtensions&&i.binaryExtensions.indexOf(t.ext)>=0||i.stringExtensions&&i.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '".concat(t,"'"))},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),b3e=function(e){_t(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next(void 0)},t.prototype.triggerApply=function(){this.events.applied.next(void 0)},t.prototype.getParams=function(){return this._params||(this._params={current:P.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:I(I({},this.state.params),r)});var n=this.map.get(this.state.params.current),a=n.params(this.context);this._current={anim:n,params:a,paramValues:P.getDefaultValues(a),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=I(I({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '".concat(r.name,"' is already registered."));return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return ie(this,void 0,void 0,function(){return ae(this,function(a){switch(a.label){case 0:return[4,this.stop()];case 1:return a.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return a.sent(),[2]}})})},t.prototype.tick=function(r,n,a){return ie(this,void 0,void 0,function(){return ae(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n||a?[4,this.applyFrame(a)]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ie(this,void 0,void 0,function(){var r,n,a;return ae(this,function(i){switch(i.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:a=i.sent(),a&&(n=a),i.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ie(this,void 0,void 0,function(){var r;return ae(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ie(this,void 0,void 0,function(){return ae(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(r){return ie(this,void 0,void 0,function(){var n,a;return ae(this,function(i){switch(i.label){case 0:return n=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=n),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context})];case 1:return a=i.sent(),a.kind==="finished"?this.stop():a.kind==="next"&&(this._current.state=a.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return ie(this,void 0,void 0,function(){var r;return ae(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(xc),x3e={minRadius:5,extraRadius:4,durationMs:250},S3e=function(){function e(t){this.plugin=t,this.boundaryHelper=new Ji("98")}return e.prototype.transformedLoci=function(t){var r,n;if(_e.is(t)){var a=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;a&&(t=_e.remap(t,a))}return t},e.prototype.focusRenderObjects=function(t,r){if(!!t){for(var n=[],a=0,i=t;a<i.length;a++){var o=i[a],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=Ut.getBoundingSphere(this.transformedLoci(s));u&&a.push(u)}if(a.length===0)return;this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++){var u=l[c];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var f=0,d=a;f<d.length;f++){var u=d[f];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=Ut.getBoundingSphere(this.transformedLoci(t[0]))}else n=Ut.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var a=[],i=0,o=t;i<o.length;i++){var s=o[i],u=r(s);u&&a.push(u)}if(a.length!==0){if(a.length===1)return this.focusSphere(a[0],n);this.boundaryHelper.reset();for(var c=0,l=a;c<l.length;c++){var u=l[c];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var f=0,d=a;f<d.length;f++){var u=d[f];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,a,i,o,s=I(I({},x3e),r),u=s.extraRadius,c=s.minRadius,l=s.durationMs,f=Math.max(t.radius+u,c);if(r==null?void 0:r.principalAxes){var d=r==null?void 0:r.principalAxes.boxAxes,m=d.origin,p=d.dirA,v=d.dirC,h=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(m,f,p,v);(a=this.plugin.canvas3d)===null||a===void 0||a.requestCameraReset({durationMs:l,snapshot:h})}else{var h=(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.camera.getFocus(t.center,f);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:l,snapshot:h})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),tP=function(e){_t(t,e);function t(r,n){n===void 0&&(n={});var a=e.call(this,{props:I(I({},P.getDefaultValues(t.Params)),n)})||this;return a.plugin=r,a._props=P.getDefaultValues(t.Params),a.events={propsUpdated:a.ev()},a.lociSelects=new t.LociSelectManager(r,a._props),a.lociHighlights=new t.LociHighlightManager(r,a._props),a}return Object.defineProperty(t.prototype,"props",{get:function(){return I({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,a=I(I({},this.state.props),r);KC(n,a)||(this.updateState({props:a}),this.lociSelects.setProps(a),this.lociHighlights.setProps(a),this.events.propsUpdated.next(void 0))},t}(xc);(function(e){e.Params={granularity:P.Select("residue",Ut.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function a(i,o){o===void 0&&(o={}),this.ctx=i,this.providers=[],this.props=P.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(o)}return a.prototype.setProps=function(i){Object.assign(this.props,i)},a.prototype.addProvider=function(i){this.providers.push(i)},a.prototype.removeProvider=function(i){this.providers=this.providers.filter(function(o){return o!==i})},a.prototype.normalizedLoci=function(i,o,s){s===void 0&&(s=!1);var u=i.loci,c=i.repr,l=o?this.props.granularity:void 0;return{loci:Ut.normalize(u,l,s),repr:c}},a.prototype.mark=function(i,o,s){if(s===void 0&&(s=!1),!Ut.isEmpty(i.loci))for(var u=0,c=this.providers;u<c.length;u++){var l=c[u];l(i,o,s)}},a}();e.LociMarkManager=t;var r=function(a){_t(i,a);function i(){var o=a!==null&&a.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(s){s===void 0&&(s=!1);for(var u=0,c=o.prev;u<c.length;u++){var l=c[u];o.mark(l,xt.RemoveHighlight,s)}o.prev.length=0},o}return i.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var c=u[s];if(Vt.Loci.areEqual(c,o))return!0}return!1},i.prototype.addHighlight=function(o){this.mark(o,xt.Highlight),this.prev.push(o)},i.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},i.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(Ut.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))},i.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(_e.is(u.loci)){var c={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(c)||(Ut.isEmpty(c.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(c)))}},i}(t);e.LociHighlightManager=r;var n=function(a){_t(i,a);function i(){return a!==null&&a.apply(this,arguments)||this}return i.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!Ut.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);_e.is(u.loci)?this.toggleSel(u):a.prototype.mark.call(this,u,xt.Toggle)}},i.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!Ut.isEmpty(o.loci)){var u=this.normalizedLoci(o,s,!0);if(_e.is(u.loci)){var c=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:c,repr:u.repr})}}},i.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);_e.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,xt.Select)},i.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);_e.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,xt.Select)},i.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);_e.is(u.loci)&&(this.deselect({loci:ke.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,xt.Select)},i.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s,!0);_e.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,xt.Deselect)},i.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:db},xt.Deselect)},i.prototype.deselectAllOnEmpty=function(o){Ja(o.loci)&&this.deselectAll()},i.prototype.mark=function(o,s){var u=o.loci;if(!Ut.isEmpty(u))if(_e.is(u)){var c=this.sel.getLoci(u.structure);a.prototype.mark.call(this,{loci:ke.Loci(u.structure)},xt.Deselect,!Ut.isEmpty(c)),a.prototype.mark.call(this,{loci:c},xt.Select)}else a.prototype.mark.call(this,o,s)},i.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,xt.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,xt.Select))},i}(t);e.LociSelectManager=n})(tP||(tP={}));var C3e=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,a,i){r.mark(n,a),i||r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(a){return Vt.Loci.areEqual(t,a)});n===-1&&r===xt.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===xt.RemoveHighlight&&(mh(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var a=n[r],i=0,o=this.locis;i<o.length;i++){var s=o[i];if(!Ut.isEmpty(s.loci)){var u=a.label(s.loci,s.repr);if(u){var c=a.group?a.group(u):u.toString(),l=this.groupedLabels.get(c);l?l.push(u):this.groupedLabels.set(c,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(f,d){var m=f.length,p=m>1&&f[0]!==f[1]?d:f[0];t.labels.push(m===1?p:"".concat(p," <small>|| \xD7 ").concat(m,"</small>"))}),this.isDirty=!1}return this.labels},e}(),lz="overpaint-controls";function fz(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i=this;return ae(this,function(o){switch(o.label){case 0:return[4,_3e(e,t,function(s,u,c){return ie(i,void 0,void 0,function(){var l,f,d,m,p,p;return ae(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(l=u.obj.data.sourceData,[4,n(l.root)]);case 1:return f=v.sent(),Ut.isEmpty(f)||Ja(f)?[2]:(d={bundle:Cr.fromLoci(f),color:r===-1?st(0):r,clear:r===-1},c?(m=Ht(Ht([],c.params.values.layers,!0),[d],!1),p=dz(m,l),s.to(c).update(ba.toBundle(p))):(p=dz([d],l),s.to(u.transform.ref).apply(ze.Representation.OverpaintStructureRepresentation3DFromBundle,ba.toBundle(p),{tags:lz})),[2])}})})})];case 1:return o.sent(),[2]}})})}function _3e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,d.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,c=s.representations,d.label=2;case 2:return u<c.length?(l=c[u],f=n.select(Yt.Generators.ofTransformer(ze.Representation.OverpaintStructureRepresentation3DFromBundle,l.cell.transform.ref).withTag(lz)),[4,r(a,l.cell,f[0])]):[3,5];case 3:d.sent(),d.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function dz(e,t){var r=ba.ofBundle(e,t.root),n=ba.merge(r);return ba.filter(n,t)}var mz="clipping-controls";function w3e(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i=this;return ae(this,function(o){switch(o.label){case 0:return[4,A3e(e,t,function(s,u,c){return ie(i,void 0,void 0,function(){var l,f,d,m,p,p;return ae(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(l=u.obj.data.sourceData,[4,n(l.root)]);case 1:return f=v.sent(),Ut.isEmpty(f)||Ja(f)?[2]:(d={bundle:Cr.fromLoci(f),groups:r},c?(m=Ht(Ht([],c.params.values.layers,!0),[d],!1),p=pz(m,l),s.to(c).update(Yr.toBundle(p))):(p=pz([d],l),s.to(u.transform.ref).apply(ze.Representation.ClippingStructureRepresentation3DFromBundle,Yr.toBundle(p),{tags:mz})),[2])}})})})];case 1:return o.sent(),[2]}})})}function A3e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,d.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,c=s.representations,d.label=2;case 2:return u<c.length?(l=c[u],f=n.select(Yt.Generators.ofTransformer(ze.Representation.ClippingStructureRepresentation3DFromBundle,l.cell.transform.ref).withTag(mz)),[4,r(a,l.cell,f[0])]):[3,5];case 3:d.sent(),d.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function pz(e,t){var r=Yr.ofBundle(e,t.root),n=Yr.merge(r);return Yr.filter(n,t)}var vz="transparency-controls";function T3e(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i=this;return ae(this,function(o){switch(o.label){case 0:return[4,P3e(e,t,function(s,u,c){return ie(i,void 0,void 0,function(){var l,f,d,m,p,p;return ae(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(l=u.obj.data.sourceData,[4,n(l.root)]);case 1:return f=v.sent(),Ut.isEmpty(f)||Ja(f)?[2]:(d={bundle:Cr.fromLoci(f),value:r},c?(m=Ht(Ht([],c.params.values.layers,!0),[d],!1),p=hz(m,l),s.to(c).update(xa.toBundle(p))):(p=hz([d],l),s.to(u.transform.ref).apply(ze.Representation.TransparencyStructureRepresentation3DFromBundle,xa.toBundle(p),{tags:vz})),[2])}})})})];case 1:return o.sent(),[2]}})})}function P3e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,d.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,c=s.representations,d.label=2;case 2:return u<c.length?(l=c[u],f=n.select(Yt.Generators.ofTransformer(ze.Representation.TransparencyStructureRepresentation3DFromBundle,l.cell.transform.ref).withTag(vz)),[4,r(a,l.cell,f[0])]):[3,5];case 3:d.sent(),d.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function hz(e,t){var r=xa.ofBundle(e,t.root),n=xa.merge(r);return xa.filter(n,t)}var gz="substance-controls";function yz(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i=this;return ae(this,function(o){switch(o.label){case 0:return[4,E3e(e,t,function(s,u,c){return ie(i,void 0,void 0,function(){var l,f,d,m,p,p;return ae(this,function(v){switch(v.label){case 0:return a&&a.length>0&&!a.includes(u.params.values.type.name)?[2]:(l=u.obj.data.sourceData,[4,n(l.root)]);case 1:return f=v.sent(),Ut.isEmpty(f)||Ja(f)?[2]:(d={bundle:Cr.fromLoci(f),material:r!=null?r:Ya(),clear:!r},c?(m=Ht(Ht([],c.params.values.layers,!0),[d],!1),p=bz(m,l),s.to(c).update(Sa.toBundle(p))):(p=bz([d],l),s.to(u.transform.ref).apply(ze.Representation.SubstanceStructureRepresentation3DFromBundle,Sa.toBundle(p),{tags:gz})),[2])}})})})];case 1:return o.sent(),[2]}})})}function E3e(e,t,r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:n=e.state.data,a=n.build(),i=0,o=t,d.label=1;case 1:if(!(i<o.length))return[3,6];s=o[i],u=0,c=s.representations,d.label=2;case 2:return u<c.length?(l=c[u],f=n.select(Yt.Generators.ofTransformer(ze.Representation.SubstanceStructureRepresentation3DFromBundle,l.cell.transform.ref).withTag(gz)),[4,r(a,l.cell,f[0])]):[3,5];case 3:d.sent(),d.label=4;case 4:return u++,[3,2];case 5:return i++,[3,1];case 6:return[2,a.commit({doNotUpdateCurrent:!0})]}})})}function bz(e,t){var r=Sa.ofBundle(e,t.root),n=Sa.merge(r);return Sa.filter(n,t)}var rP=function(e){_t(t,e);function t(r){var n=e.call(this,{options:P.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f=this;return ae(this,function(d){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(void 0),a=this.dataState.build(),i=0,o=this.currentStructures;i<o.length;i++)for(s=o[i],u=0,c=s.components;u<c.length;u++)l=c[u],this.updateReprParams(a,l);return[2,this.plugin.dataTransaction(function(){return ie(f,void 0,void 0,function(){return ae(this,function(m){switch(m.label){case 0:return[4,a.commit()];case 1:return m.sent(),[4,this.plugin.state.updateBehavior(kT,function(p){p.ignoreHydrogens=!r.showHydrogens,p.material=r.materialStyle,p.clip=r.clipObjects})];case 2:return m.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:m.sent(),m.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var a=this.state.options,i=a.showHydrogens,o=a.visualQuality,s=a.materialStyle,u=a.clipObjects,c=!i,l=0,f=n.representations;l<f.length;l++){var d=f[l];if(d.cell.transform.transformer===Eb){var m=d.cell.transform.params;(!!m.type.params.ignoreHydrogens!==c||m.type.params.quality!==o||!Hv(m.type.params.material,s)||!P.areEqual(Al.Params,m.type.params.clip,u))&&r.to(d.cell).update(function(p){p.type.params.ignoreHydrogens=c,p.type.params.quality=o,p.type.params.material=s,p.type.params.clip=u})}}},t.prototype.updateInterationProps=function(){var r,n,a;return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d=this;return ae(this,function(m){switch(m.label){case 0:i=0,o=this.currentStructures,m.label=1;case 1:return i<o.length?(s=o[i],u=pn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(c=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[pn.descriptor.name],P.areEqual(u,c,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(p){p.properties[pn.descriptor.name]=d.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return m.sent(),[3,5];case 3:return l=this.plugin.customStructureProperties.getParams((a=s.cell.obj)===null||a===void 0?void 0:a.data),f=P.getDefaultValues(l),P.areEqual(u,f.properties[pn.descriptor.name],this.state.options.interactions)?[3,5]:(f.properties[pn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,f)]);case 4:m.sent(),m.label=5;case 5:return i++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ie(i,void 0,void 0,function(){var o,s,u,c;return ae(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,a)]):[3,5];case 2:return c=l.sent(),[4,this.syncPreset(u,c)];case 3:l.sent(),l.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var a=new Set;if(wo(n.components,function(y){y&&a.add(y.ref)}),n.representations&&wo(n.representations,function(y){y&&a.add(y.ref)}),a.size===0)return this.clearComponents([r]);for(var i=!1,o=this.dataState.build(),s=function(y){a.has(y.cell.transform.ref)||(i=!0,o.delete(y.cell))},u=0,c=r.components;u<c.length;u++){var l=c[u];s(l);for(var f=0,d=l.representations;f<d.length;f++){var m=d[f];s(m)}if(l.genericRepresentations)for(var p=0,v=l.genericRepresentations;p<v.length;p++){var m=v[p];s(m)}}if(r.genericRepresentations)for(var h=0,g=r.genericRepresentations;h<g.length;h++){var m=g[h];s(m)}if(i)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,a=this.plugin.managers.structure.selection;a.clear();for(var i=0,o=r;i<o.length;i++){var s=o[i],u=ke.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);a.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var a=this;return this.plugin.runTask(Be.create("Modify Component",function(i){return ie(a,void 0,void 0,function(){var o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)c=u[s],!!this.canBeModified(c)&&(l=this.plugin.managers.structure.selection.getStructure(c.structure.cell.obj.data),!(!l||l.elementCount===0)&&this.modifyComponent(o,c,l,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(i)];case 1:return f.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),a=!n.cell.state.isHidden,c=0,l=r;c<l.length;c++){var s=l[c],f=s.representations[u];!f||Sp(this.dataState,f.cell.transform.ref,a)}else for(var a=!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Sp(this.dataState,s.cell.transform.ref,a)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var a=[];if(n){var i=r[0].representations.indexOf(n);if(i<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[i]&&a.push(u.representations[i])}}else for(var c=0,l=r;c<l.length;c++)for(var u=l[c],f=0,d=u.representations;f<d.length;f++){var m=d[f];a.push(m)}return this.plugin.managers.structure.hierarchy.remove(a,!0)}},t.prototype.updateRepresentations=function(r,n,a){if(r.length===0)return Promise.resolve();var i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var c=u[s],l=c.representations[i];!l||l.cell.transform.transformer===n.cell.transform.transformer&&o.to(l.cell).update(a)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var a,i,o,s;if(r.length!==0){for(var u=this.dataState.build(),c=0,l=r;c<l.length;c++)for(var f=l[c],d=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(f,g):n,x=b.color==="default"?OT(m.plugin,(a=f.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name):b.color?OT(m.plugin,(i=f.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,C=b.size==="default"?TU(m.plugin,(o=f.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?TU(m.plugin,(s=f.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(x||C)&&u.to(g.cell).update(function(_){x&&(_.colorTheme=x),C&&(_.sizeTheme=C)})},m=this,p=0,v=f.representations;p<v.length;p++){var h=v[p];d(h)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var a=this;if(r.length!==0){var i=this.state.options,o=i.showHydrogens,s=i.visualQuality,u=i.materialStyle,c=i.clipObjects,l=!o,f={ignoreHydrogens:l,quality:s,material:u,clip:c};return this.plugin.dataTransaction(function(){return ie(a,void 0,void 0,function(){var d,m,p;return ae(this,function(v){switch(v.label){case 0:d=0,m=r,v.label=1;case 1:return d<m.length?(p=m[d],[4,this.plugin.builders.structure.representation.addRepresentation(p.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:f})]):[3,4];case 2:v.sent(),v.label=3;case 3:return d++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var a=this;if(r.components.length!==0)return this.plugin.runTask(Be.create("Find Component",function(i){return ie(a,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:return o=(p=r.cell.obj)===null||p===void 0?void 0:p.data,o?(c=(u=tt).unionStructure,[4,n.getSelection(this.plugin,i,o)]):[2];case 1:for(s=c.apply(u,[h.sent()]),l=0,f=r.components;l<f.length;l++)if(d=f[l],m=(v=d.cell.obj)===null||v===void 0?void 0:v.data,!(!m||!d.cell.parent)&&foe(s,m))return[2,d.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ie(this,void 0,void 0,function(){var a=this;return ae(this,function(i){return[2,this.plugin.dataTransaction(function(){return ie(a,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,c=s.visualQuality,l=s.materialStyle,f=s.clipObjects,d=!u,m={ignoreHydrogens:d,quality:c,material:l,clip:f},p=zr.create22(),v=0,h=o,b.label=1;case 1:return v<h.length?(g=h[v],y=void 0,r.options.checkExisting?[4,this.tryFindComponent(g,r.selection)]:[3,3]):[3,8];case 2:y=b.sent(),b.label=3;case 3:return y?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(g.cell,r.selection,p,{label:r.options.label||(r.selection===Jn.current?"Custom Selection":"")})];case 4:y=b.sent(),b.label=5;case 5:return r.representation==="none"||!y?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(y,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:m})];case 6:b.sent(),b.label=7;case 7:return v++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ie(this,void 0,void 0,function(){var a=this;return ae(this,function(i){return[2,this.plugin.dataTransaction(function(o){return ie(a,void 0,void 0,function(){var s,u,c,l,f,d,d,d,d,m=this;return ae(this,function(p){switch(p.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(v){return ie(m,void 0,void 0,function(){var h,g;return ae(this,function(y){switch(y.label){case 0:return g=(h=tt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,v)];case 1:return[2,g.apply(h,[y.sent()])]}})})},c=0,l=s,p.label=1;case 1:return c<l.length?(f=l[c],r.action.name!=="color"?[3,3]:(d=r.action.params,[4,fz(this.plugin,f.components,d.color,u,r.representations)])):[3,14];case 2:return p.sent(),[3,13];case 3:return r.action.name!=="resetColor"?[3,5]:[4,fz(this.plugin,f.components,-1,u,r.representations)];case 4:return p.sent(),[3,13];case 5:return r.action.name!=="transparency"?[3,7]:(d=r.action.params,[4,T3e(this.plugin,f.components,d.value,u,r.representations)]);case 6:return p.sent(),[3,13];case 7:return r.action.name!=="material"?[3,9]:(d=r.action.params,[4,yz(this.plugin,f.components,d.material,u,r.representations)]);case 8:return p.sent(),[3,13];case 9:return r.action.name!=="resetMaterial"?[3,11]:[4,yz(this.plugin,f.components,void 0,u,r.representations)];case 10:return p.sent(),[3,13];case 11:return r.action.name!=="clipping"?[3,13]:(d=r.action.params,[4,w3e(this.plugin,f.components,Yr.Groups.fromNames(d.excludeGroups),u,r.representations)]);case 12:p.sent(),p.label=13;case 13:return c++,[3,1];case 14:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,a,i){var o,s,u,c=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(!!c&&!((i==="subtract"||i==="intersect")&&!z1(c,a))){var l=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,f=i==="union"?Uh(l,[c,a]):i==="intersect"?f6(c,a):bw(c,a);if(f.elementCount===0)r.delete(n.cell.transform.ref);else{var d=Cr.fromSubStructure(l,f),m={type:{name:"bundle",params:d},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(m)}}},t.prototype.updateLabel=function(r,n){var a,i,o={type:(a=r.cell.params)===null||a===void 0?void 0:a.values.type,nullIfEmpty:(i=r.cell.params)===null||i===void 0?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),a=0,i=r;a<i.length;a++)for(var o=i[a],s=0,u=o.components;s<u.length;s++){var c=u[s];n.delete(c.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(xc);(function(e){e.OptionsParams={showHydrogens:P.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:P.Select("auto",D_,{description:"Control the visual/rendering quality of representations"}),materialStyle:Ya.getParam(),clipObjects:P.Group(Al.Params),interactions:P.Group(pn.defaultParams,{label:"Non-covalent Interactions"})};function t(i,o){var s=i.query.structure.registry.options;return o=I({pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:P.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:a(i,o==null?void 0:o.pivot,(o==null?void 0:o.allowNone)?[["none","< Create Later >"]]:[]),options:P.Group({label:P.Text(""),checkExisting:P.Boolean(!!(o==null?void 0:o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(i,o){var s=i.query.structure.registry.options;return{selection:P.Select(s[1][0],s,{isHidden:!1}),action:P.MappedStatic("color",{color:P.Group({color:P.Color(tr.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:P.EmptyGroup({label:"Reset Color"}),transparency:P.Group({value:P.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:P.Group({material:Ya.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:P.EmptyGroup({label:"Reset Material"}),clipping:P.Group({excludeGroups:P.MultiSelect([],P.objectToOptions(Yr.Groups.Names))},{isFlat:!0})}),representations:P.MultiSelect([],n(i,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,o){var s,u;return((s=o==null?void 0:o.cell.obj)===null||s===void 0?void 0:s.data)?i.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function a(i,o,s,u){var c=Ht(Ht([],s,!0),n(i,o),!0);return P.Select(c[0][0],c,{label:u})}})(rP||(rP={}));var I3e=8,D3e=function(e){_t(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(i){var o,s,u=i.obj;if(!!fe.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var c=[],l=0,f=n.history;l<f.length;l++){var d=f[l];d.loci.structure===u.data&&c.push(d)}c.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,c),n.events.historyUpdated.next(void 0))}});var a=Te();return r.state.data.events.object.updated.subscribe(function(i){var o,s=i.oldData,u=i.obj,c=i.action;if(!!fe.Molecule.Structure.is(u)&&s!==u.data&&c==="in-place"){var l=n.state.current,f=u.data;if(l&&l.loci.structure===s){var d=_e.remap(l.loci,f);n.state.current=I(I({},l),{loci:d}),n.behaviors.current.next(n.state.current),Ut.getBoundingSphere(d,a);var m=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,p=m.getTargetDistance(a.radius+4);(S.distance(m.target,a.center)>a.radius||p>m.viewport.height/m.zoom)&&n.plugin.managers.camera.focusSphere(a,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!_e.isEmpty(r.loci)){for(var n=0,a=void 0,i=0,o=this.state.history;i<o.length;i++){var s=o[i];if(_e.areEqual(s.loci,r.loci)){a=s;break}n++}if(a){mh(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(r),this.state.history.length>I3e&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!_e.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=Ut.normalize(r);if(!_e.is(n)||_e.isEmpty(n)){this.clear();return}this.set({loci:n,label:xb(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&_e.is(r)&&r.structure===this.state.current.loci.structure?_e.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Cr.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,a;if(!r.current){this.clear();return}var i=r.current,o=i.label,s=i.ref,u=i.bundle,c=i.category,l=(a=(n=this.plugin.state.data.select(Yt.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!!l){var f=Cr.toLoci(u,l);this.set({label:o,loci:f,category:c})}},t}(xc);function M3e(e,t){var r=G3e(e,t||nP());return W3e(e.tree,r),t&&t.refs.forEach(q3e,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function nP(){return{trajectories:[],models:[],structures:[],refs:new Map}}function R3e(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function xz(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function B3e(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function F3e(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function Sz(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function O3e(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function k3e(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function L3e(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function N3e(e){return e.transform.tags?Ht([],e.transform.tags,!0).sort().join():e.transform.ref}function U3e(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:N3e(e),representations:[]}}function z3e(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function V3e(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function G3e(e,t){return{state:e,oldHierarchy:t,hierarchy:nP(),changed:!1,added:new Set}}function Op(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Fd(e,t,r){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var i=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,i);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function Cz(e){return function(t){return e.is(t.obj)}}function _z(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function b2(e){return function(t){return t.transform.transformer===e}}function Od(){}var H3e=[[Cz(fe.Molecule.Trajectory),function(e,t){e.currentTrajectory=Op(e,t,e.hierarchy.trajectories,R3e,t)},function(e){return e.currentTrajectory=void 0}],[_z(fe.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Op(e,t,e.currentTrajectory.models,xz,t,e.currentTrajectory):e.currentModel=Fd(e,t,xz,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[b2(ze.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Fd(e,t,B3e,t,e.currentModel)},Od],[b2(ze.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Fd(e,t,F3e,t,e.currentModel)},Od],[_z(fe.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Op(e,t,e.currentModel.structures,Sz,t,e.currentModel):e.currentStructure=Fd(e,t,Sz,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[b2(ze.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Fd(e,t,O3e,t,e.currentStructure)},Od],[b2(ze.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Fd(e,t,k3e,t,e.currentStructure)},Od],[Cz(fo),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Fd(e,t,L3e,t,e.currentStructure)),!1},Od],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:fe.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Op(e,t,e.currentStructure.components,U3e,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&fe.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Op(e,t,e.currentComponent.representations,z3e,t,e.currentComponent),!1},Od],[function(e){return!e.state.isGhost&&fe.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Op(e,t,r.genericRepresentations,V3e,t,r))},Od]];function wz(e){if(!e||!(e==null?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===rn.Null||e.status!=="ok"&&e.status!=="error")}function q3e(e){var t=e.cell;wz(t)||(this.changed=!0)}function j3e(e){Az(this,this.tree.transforms.get(e))}function Az(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!wz(n)){for(var a=void 0,i=!1,o=0,s=H3e;o<s.length;o++){var u=s[o],c=u[0],l=u[1],f=u[2];if(c(n,r)){var d=l(r,n);if(d===!1){i=!0;break}a=f;break}}if(!i){var m=e.tree.children.get(t.ref);m&&m.size&&m.forEach(j3e,e),a&&a(r)}}}function W3e(e,t){var r={tree:e,state:t};return Az(r,e.root),r.state}var aP=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:nP(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var a=n[r];this._currentSelectionSet.add(a.cell.transform.ref)}for(var i=0,o=this.selection.models;i<o.length;i++){var a=o[i];this._currentSelectionSet.add(a.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var a=u[s];this._currentSelectionSet.add(a.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],a=0,i=r;a<i.length;a++){var o=i[a];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var a=this.seletionSet,i=[],o=0,s=r;o<s.length;o++){var u=s[o],c=u.cell.transform.ref;(a.has(c)||n.has(c))&&i.push(u)}return i.length===0?r.length>0?[r[0]]:[]:i},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(I({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=M3e(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy,i=this.syncCurrent(a.trajectories,n.added),o=this.syncCurrent(a.models,n.added),s=this.syncCurrent(a.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=a,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,trajectories:i,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var a=this.current,i=n==="add"?Cn.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):Cn.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],c=0,l=a.trajectories;c<l.length;c++){var f=l[c];i.has(f.cell.transform.ref)&&o.push(f)}for(var d=0,m=a.models;d<m.length;d++){var p=m[d];i.has(p.cell.transform.ref)&&s.push(p)}for(var v=0,h=a.structures;v<h.length;v++){var g=h[v];i.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:a,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Sp(this.dataState,s.cell.transform.ref,a)}},t.prototype.applyPreset=function(r,n,a){var i=this;return this.plugin.dataTransaction(function(){return ie(i,void 0,void 0,function(){var o,s,u;return ae(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:c.sent(),c.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,a)];case 4:c.sent(),c.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ie(this,void 0,void 0,function(){var a=this;return ae(this,function(i){switch(i.label){case 0:return[4,this.plugin.dataTransaction(function(){return ie(a,void 0,void 0,function(){var o,s;return ae(this,function(u){switch(u.label){case 0:return o=Pn.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return i.sent(),Xt.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),a=0,i=r.models;a<i.length;a++){var o=i[a];n.delete(o.cell)}return n.commit()},t}(s0);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(p){return[p]});for(var a=[],i=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],c=0,l=u.components;c<l.length;c++){var f=l[c],d=f.key;if(!!d){var m=i.get(d);m||(m=[],i.set(d,m),a.push(m)),m.push(f)}}return a}e.getComponentGroups=t;function r(n){var a,i,o,s,u,c,l,f,d,m=n.managers.structure.hierarchy.selection.structures;if(m.length===0)return"";if(m.length===1){var p=m[0],v=(a=p.cell.obj)===null||a===void 0?void 0:a.data;if(!v)return((i=p.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";var h=v.models[0]||v.representativeModel||v.masterModel;if(!h)return((o=p.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=h.entryId;return((u=(s=p.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0?void 0:u.models)&&p.model.trajectory.models.length===1?g:p.model?"".concat((c=p.model.cell.obj)===null||c===void 0?void 0:c.label," | ").concat(g):g}for(var y=m[0],b=(l=y==null?void 0:y.model)===null||l===void 0?void 0:l.trajectory,x=!0,C=0,_=m;C<_.length;C++){var p=_[C];if(((f=p==null?void 0:p.model)===null||f===void 0?void 0:f.trajectory)!==b){x=!1;break}}return x&&b?"".concat((d=b.cell.obj)===null||d===void 0?void 0:d.label," | ").concat(m.length," structures"):"".concat(m.length," structures")}e.getSelectedStructuresDescription=r})(aP||(aP={}));var iP="measurement-group",x2="measurement-order-label",X3e={distanceUnitLabel:P.Text("\u212B",{isEssential:!0}),textColor:N8.textColor},Y3e=P.getDefaultValues(X3e),K3e=function(e){_t(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:Y3e})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=Yt.findTagInSubtree(r.tree,gr.RootRef,iP),a=this.plugin.state.data.build();return n?a.to(n):a.toRoot().group(ze.Misc.CreateGroup,{label:"Measurements"},{tags:iP})},t.prototype.setOptions=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,o,c,l,o,f,d,o;return ae(this,function(m){switch(m.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),a=0,i=this.state.distances;a<i.length;a++)o=i[a],n.to(o).update(function(p){p.unitLabel=r.distanceUnitLabel,p.textColor=r.textColor});for(s=0,u=this.state.labels;s<u.length;s++)o=u[s],n.to(o).update(function(p){p.textColor=r.textColor});for(c=0,l=this.state.angles;c<l.length;c++)o=l[c],n.to(o).update(function(p){p.textColor=r.textColor});for(f=0,d=this.state.dihedrals;f<d.length;f++)o=d[f],n.to(o).update(function(p){p.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,Xt.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return m.sent(),[2]}})})},t.prototype.addDistance=function(r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!i||!o?[2]:(s=[i.transform.ref],gn(s,o.transform.ref),u=this.getGroup(),u.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,expression:_e.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:_e.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:a==null?void 0:a.selectionTags}).apply(ze.Representation.StructureSelectionsDistance3D,I(I(I({customText:(a==null?void 0:a.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),c=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:c,tree:u,options:{doNotLogTiming:!0}})]);case 1:return l.sent(),[2]}})})},t.prototype.addAngle=function(r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f;return ae(this,function(d){switch(d.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(a.structure),!o||!s||!u?[2]:(c=[o.transform.ref],gn(c,s.transform.ref),gn(c,u.transform.ref),l=this.getGroup(),l.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:_e.toExpression(r)},{key:"b",ref:s.transform.ref,expression:_e.toExpression(n)},{key:"c",ref:u.transform.ref,expression:_e.toExpression(a)}],isTransitive:!0,label:"Angle"},{dependsOn:c,tags:i==null?void 0:i.selectionTags}).apply(ze.Representation.StructureSelectionsAngle3D,I(I(I({customText:(i==null?void 0:i.customText)||"",textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),f=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:f,tree:l,options:{doNotLogTiming:!0}})]);case 1:return d.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,a,i,o){return ie(this,void 0,void 0,function(){var s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),c=this.plugin.helpers.substructureParent.get(a.structure),l=this.plugin.helpers.substructureParent.get(i.structure),!s||!u||!c||!l?[2]:(f=[s.transform.ref],gn(f,u.transform.ref),gn(f,c.transform.ref),gn(f,l.transform.ref),d=this.getGroup(),d.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:_e.toExpression(r)},{key:"b",ref:u.transform.ref,expression:_e.toExpression(n)},{key:"c",ref:c.transform.ref,expression:_e.toExpression(a)},{key:"d",ref:l.transform.ref,expression:_e.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:f,tags:o==null?void 0:o.selectionTags}).apply(ze.Representation.StructureSelectionsDihedral3D,I(I(I({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),m=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:m,tree:d,options:{doNotLogTiming:!0}})]);case 1:return p.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ie(this,void 0,void 0,function(){var a,i,o,s;return ae(this,function(u){switch(u.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),a?(i=[a.transform.ref],o=this.getGroup(),o.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:_e.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n==null?void 0:n.selectionTags}).apply(ze.Representation.StructureSelectionsLabel3D,I(I({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)s=r[i],u=this.plugin.helpers.substructureParent.get(s.structure),!!u&&(gn(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:_e.toExpression(s)}));return n.length===0?[2]:(c=this.getGroup(),c.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:a}).apply(ze.Representation.StructureSelectionsOrientation3D),l=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:l,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addPlane=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l;return ae(this,function(f){switch(f.label){case 0:for(n=[],a=[],i=0,o=r.length;i<o;++i)s=r[i],u=this.plugin.helpers.substructureParent.get(s.structure),!!u&&(gn(a,u.transform.ref),n.push({key:"l".concat(i),ref:u.transform.ref,expression:_e.toExpression(s)}));return n.length===0?[2]:(c=this.getGroup(),c.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:a}).apply(ze.Representation.StructureSelectionsPlane3D),l=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:l,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addOrderLabels=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:for(n=this.getGroup(),a=this.plugin.state.data.select(Yt.Generators.ofType(fe.Molecule.Structure.Selections).withTag(x2)),i=0,o=a;i<o.length;i++)s=o[i],n.delete(s);for(u=1,c=0,l=r;c<l.length;c++)f=l[c],d=this.plugin.helpers.substructureParent.get(f.structure),!!d&&(m=[d.transform.ref],n.apply(ze.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:d.transform.ref,expression:_e.toExpression(f)}],isTransitive:!0,label:"Order"},{dependsOn:m,tags:x2}).apply(ze.Representation.StructureSelectionsLabel3D,{textColor:st.fromRgb(255,255,255),borderColor:st.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:"".concat(u++)},{tags:x2}));return p=this.plugin.state.data,[4,Xt.State.Update(this.plugin,{state:p,tree:n,options:{doNotLogTiming:!0}})];case 1:return v.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,a=Yt.findTagInSubtree(n.tree,gr.RootRef,iP),i=a?n.select(Yt.Generators.ofTransformer(r,a)):this._empty;return i.length===0?this._empty:i},t.prototype.sync=function(){for(var r=[],n=0,a=this.getTransforms(ze.Representation.StructureSelectionsLabel3D);n<a.length;n++){var i=a[n],o=i.obj.tags;(!o||!o.includes(x2))&&r.push(i)}var s=this.updateState({labels:r,distances:this.getTransforms(ze.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(ze.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(ze.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(ze.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(ze.Representation.StructureSelectionsPlane3D)});s&&this.stateUpdated()},t}(xc),P0=new Ji("98"),Q3e=24,Z3e=function(e){_t(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:$3e()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(a){return n.onRemove(a.ref,a.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(a){return n.onUpdate(a.ref,a.oldObj,a.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(!!n){var a=n.transform.ref;if(!this.entries.has(a)){var i=new oP(_e(r,[]));return this.entries.set(a,i),i}return this.entries.get(a)}},t.prototype.calcStats=function(){var r=0,n=0,a=lu.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,c=s.length;u<c;++u)n+=De.size(s[u].indices);lu.add(a,a,lu.ofLoci(o.selection))}});var i=Sb(a,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}},t.prototype.add=function(r){if(!_e.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=_e.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!_e.areEqual(a,n.selection)},t.prototype.remove=function(r){if(!_e.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=_e.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!_e.areEqual(a,n.selection)},t.prototype.intersect=function(r){if(!_e.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=_e.intersect(n.selection,r),this.referenceLoci=r,!_e.areEqual(a,n.selection)},t.prototype.set=function(r){if(!_e.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var a=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!_e.areEqual(a,n.selection)},t.prototype.modifyHistory=function(r,n,a,i){i===void 0&&(i=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":mh(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var c=a?Math.min(o.length,a):o.length;;)if(u=u%c,u<0&&(u+=c),!i||o[s].loci.structure===o[u].loci.structure){var l=o[s];o[s]=o[u],o[u]=l;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.tryAddHistory=function(r){if(!Ut.isEmpty(r)){for(var n=0,a=void 0,i=0,o=this.additionsHistory;i<o.length;i++){var s=o[i];if(Ut.areEqual(s.loci,r)){a=s;break}n++}if(a){mh(this.additionsHistory,n),this.additionsHistory.unshift(a),this.events.additionsHistoryUpdated.next(void 0);return}var u=lu.ofLoci(r),c=Sb(u,{reverse:!0});this.additionsHistory.unshift({id:zr.create22(),loci:r,label:c}),this.additionsHistory.length>Q3e&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))},t.prototype.clearHistoryForStructure=function(r){for(var n=[],a=0,i=this.state.additionsHistory;a<i.length;a++){var o=i[a];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next(void 0)},t.prototype.onRemove=function(r,n){var a;this.entries.has(r)&&(this.entries.delete(r),(n==null?void 0:n.data)&&this.clearHistoryForStructure(n.data),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))},t.prototype.onUpdate=function(r,n,a){var i,o,s,u;if(!(n===a||(n==null?void 0:n.data)===a.data)){var c=this.plugin.helpers.substructureParent.get(a.data,!0);if(!!c&&r===c.transform.ref&&!!this.entries.has(r)){var l=(o=(i=this.plugin.helpers.substructureParent.get(a.data))===null||i===void 0?void 0:i.obj)===null||o===void 0?void 0:o.data;if(!!l)if(!(n==null?void 0:n.data)||ke.areUnitIdsAndIndicesEqual(n.data,a.data)){this.entries.set(r,J3e(this.entries.get(r),l)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===l.root&&(this.referenceLoci=_e.remap(this.referenceLoci,l));for(var f=!1,d=0,m=this.state.additionsHistory;d<m.length;d++){var p=m[d];p.loci.structure.root===l.root&&(p.loci=_e.remap(p.loci,l),f=!0)}f&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new oP(_e(l,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===l.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(l),this.state.stats=void 0,this.events.changed.next(void 0)}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var a=r.next();if(a.done)break;var i=this.entries.get(a.value);_e.isEmpty(i.selection)||n.push(i.selection),i.selection=_e(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:ur},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(!!n)return n.structure},t.prototype.structureHasSelection=function(r){var n,a,i=(a=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||a===void 0?void 0:a.data;if(!i)return!1;var o=this.getEntry(i);return!!o&&!_e.isEmpty(o.selection)},t.prototype.has=function(r){if(_e.is(r)){var n=this.getEntry(r.structure);if(n)return _e.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(!!_e.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(!!n){var a=r.elements[0];if(!!a){var i=this.referenceLoci;if(!(!i||!_e.is(i)||i.structure!==r.structure)){for(var o,s=0,u=i.elements;s<u.length;s++){var c=u[s];if(a.unit===c.unit){o=c;break}}if(!!o&&a.unit===o.unit)return e_e(r.structure,o,a)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=_e.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=S.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=S.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);P0.reset();var a=[];this.entries.forEach(function(l){var f=l.selection;_e.isEmpty(f)||a.push(_e.getBoundary(f))});for(var i=0,o=a.length;i<o;++i){var s=a[i],u=s.box,c=s.sphere;S.min(r,r,u.min),S.max(n,n,u.max),P0.includePositionRadius(c.center,c.radius)}P0.finishedIncludeStep();for(var i=0,o=a.length;i<o;++i){var c=a[i].sphere;P0.radiusPositionRadius(c.center,c.radius)}return{box:{min:r,max:n},sphere:P0.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=Cy(this.entries.values());return _e.getPrincipalAxesMany(r.map(function(n){return n.selection}))},t.prototype.modify=function(r,n){var a=!1;switch(r){case"add":a=this.add(n);break;case"remove":a=this.remove(n);break;case"intersect":a=this.intersect(n);break;case"set":a=this.set(n);break}a&&(this.state.stats=void 0,this.events.changed.next(void 0))},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,a){switch(a===void 0&&(a=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},a);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},a);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},a);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},a);break}},t.prototype.fromLoci=function(r,n,a){a===void 0&&(a=!0),this.triggerInteraction(r,n,a)},t.prototype.fromCompiledQuery=function(r,n,a){a===void 0&&(a=!0);for(var i=0,o=this.applicableStructures;i<o.length;i++){var s=o[i],u=n(new Uo(s));this.triggerInteraction(r,tt.toLociWithSourceUnits(u),a)}},t.prototype.fromSelectionQuery=function(r,n,a){var i=this;a===void 0&&(a=!0),this.plugin.runTask(Be.create("Structure Selection",function(o){return ie(i,void 0,void 0,function(){var s,u,c,l;return ae(this,function(f){switch(f.label){case 0:s=0,u=this.applicableStructures,f.label=1;case 1:return s<u.length?(c=u[s],[4,n.getSelection(this.plugin,o,c)]):[3,4];case 2:l=f.sent(),this.triggerInteraction(r,tt.toLociWithSourceUnits(l),a),f.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,a=ia.resolveAndCheck(this.plugin.state.data,r);if(!(!a||!a.obj)){if(!fe.Molecule.Structure.Selections.is(a.obj)){console.warn("fromSelections applied to wrong object type.",a.obj);return}this.clear();for(var i=0,o=(n=a.obj)===null||n===void 0?void 0:n.data;i<o.length;i++){var s=o[i];this.fromLoci("set",s.loci)}}},t}(xc);function $3e(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var oP=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(Ut.isEmpty(this._selection)?this._structure=void 0:this._structure=_e.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function J3e(e,t){return new oP(_e.remap(e.selection,t))}function e_e(e,t,r){var n=Math.min(De.min(t.indices),De.min(r.indices)),a=Math.max(De.max(t.indices),De.max(r.indices));return _e(e,[{unit:t.unit,indices:De.ofRange(n,a)}])}function t_e(e,t){var r=i_e(e,t||sP());return l_e(e.tree,r),t&&t.refs.forEach(u_e,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function sP(){return{volumes:[],lazyVolumes:[],refs:new Map}}function r_e(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function n_e(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function a_e(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function i_e(e,t){return{state:e,oldHierarchy:t,hierarchy:sP(),changed:!1,added:new Set}}function uP(e,t,r,n){for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];var o=n.apply(void 0,a);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function o_e(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function Tz(){}var s_e=[[o_e(fe.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=uP(e,t,e.hierarchy.volumes,r_e,t)},function(e){return e.currentVolume=void 0}],[function(e){return fe.Volume.Lazy.is(e.obj)},function(e,t){uP(e,t,e.hierarchy.lazyVolumes,n_e,t)},Tz],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&fe.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&uP(e,t,e.currentVolume.representations,a_e,t,e.currentVolume),!1},Tz]];function Pz(e){if(!e||!(e==null?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===rn.Null||e.status!=="ok"&&e.status!=="error")}function u_e(e){var t=e.cell;Pz(t)||(this.changed=!0)}function c_e(e){Ez(this,this.tree.transforms.get(e))}function Ez(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(!!Pz(n)){for(var a=void 0,i=!1,o=0,s=s_e;o<s.length;o++){var u=s[o],c=u[0],l=u[1],f=u[2];if(c(n,r)){var d=l(r,n);if(d===!1){i=!0;break}a=f;break}}if(!i){var m=e.tree.children.get(t.ref);m&&m.size&&m.forEach(c_e,e),a&&a(r)}}}function l_e(e,t){var r={tree:e,state:t};return Ez(r,e.root),r.state}var cP=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:sP(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(a){a.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(a){!a&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=t_e(this.plugin.state.data,this.current);if(!!n.changed){var a=n.hierarchy;this.state.hierarchy=a,this.state.selection?this.state.selection=a.refs.has(this.state.selection.cell.transform.ref)?a.refs.get(this.state.selection.cell.transform.ref):a.volumes[0]:this.state.selection=a.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:a,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var a=this.plugin.state.data.build(),i=0,o=r;i<o.length;i++){var s=o[i];a.delete(typeof s=="string"?s:s.cell.transform.ref)}return a.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var a=n!==void 0?n!=="show":!r[0].cell.state.isHidden,i=0,o=r;i<o.length;i++){var s=o[i];Sp(this.dataState,s.cell.transform.ref,a)}},t.prototype.addRepresentation=function(r,n){var a,i=this.dataState.build().to(r.cell).apply(ze.Representation.VolumeRepresentation3D,w0(this.plugin,(a=r.cell.obj)===null||a===void 0?void 0:a.data,{type:n}));return i.commit({canUndo:"Add Representation"})},t}(s0);(function(e){function t(r,n){var a,i;return((a=n==null?void 0:n.cell.obj)===null||a===void 0?void 0:a.data)?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(cP||(cP={}));var f_e=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],lP=[["full","Full"],["hidden","Hidden"]],d_e={isExpanded:P.Boolean(!1),showControls:P.Boolean(!0),regionState:P.Group({left:P.Select("full",f_e),top:P.Select("full",lP),right:P.Select("full",lP),bottom:P.Select("full",lP)}),controlsDisplay:P.Value("outside",{isHidden:!0})},m_e=function(e){_t(t,e);function t(r){var n=e.call(this,I(I({},P.getDefaultValues(d_e)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,Xt.Layout.Update.subscribe(r,function(a){return n.updateProps(a.state)}),typeof document!="undefined"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var a=n.children,i=[],o=!1,s=0;s<a.length;s++)a[s]===this.expandedViewport?o=!0:(a[s].name||"").toLowerCase()==="viewport"&&i.push(a[s]);for(var u=0,c=i;u<c.length;u++){var l=c[u];n.removeChild(l)}o||n.appendChild(this.expandedViewport);var f=r.style,d=this.getScrollElement(),m=d.scrollLeft,p=d.scrollTop;this.rootState={top:f.top,bottom:f.bottom,right:f.right,left:f.left,scrollTop:p,scrollLeft:m,position:f.position,overflow:f.overflow,viewports:i,zIndex:this.root.style.zIndex,width:f.width,height:f.height,maxWidth:f.maxWidth,maxHeight:f.maxHeight,margin:f.margin,marginLeft:f.marginLeft,marginRight:f.marginRight,marginTop:f.marginTop,marginBottom:f.marginBottom},f.overflow="hidden",f.position="fixed",f.top="0",f.bottom="0",f.right="0",f.left="0",f.width="100%",f.height="100%",f.maxWidth="100%",f.maxHeight="100%",f.margin="0",f.marginLeft="0",f.marginRight="0",f.marginTop="0",f.marginBottom="0"}else{for(var a=n.children,s=0;s<a.length;s++)if(a[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var v=this.rootState,h=0,g=v.viewports;h<g.length;h++){var l=g[h];n.appendChild(l)}var f=r.style;f.top=v.top,f.bottom=v.bottom,f.left=v.left,f.right=v.right,f.width=v.width,f.height=v.height,f.maxWidth=v.maxWidth,f.maxHeight=v.maxHeight,f.margin=v.margin,f.marginLeft=v.marginLeft,f.marginRight=v.marginRight,f.marginTop=v.marginTop,f.marginBottom=v.marginBottom,f.position=v.position,f.overflow=v.overflow||"";var d=this.getScrollElement();d.scrollTop=v.scrollTop,d.scrollLeft=v.scrollLeft,this.rootState=void 0,this.root.style.zIndex=v.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(xc),fP={includeTypes:P.MultiSelect(sb(ar.Names),P.objectToOptions(ar.Names)),excludeTypes:P.MultiSelect([],P.objectToOptions(ar.Names)),ignoreHydrogens:P.Boolean(!1),aromaticBonds:P.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:P.Select("symmetric",P.arrayToOptions(["off","symmetric","offset"]))};P.getDefaultValues(fP);var dP=I(I(I({},Id),fP),{adjustCylinderLength:P.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})});P.getDefaultValues(dP);var mP=I(I({},oU),fP);P.getDefaultValues(mP);function S2(e,t,r){return!ar.is(e,r)||ar.is(t,r)}function Iz(e,t,r){var n=t.elements,a=t.model.atomicHierarchy.derived.atom.atomicNumber,i=t.bonds,o=i.a,s=i.b,u=i.edgeProps,c=u.flags,l=r.ignoreHydrogens,f=r.includeTypes,d=r.excludeTypes,m=ar.fromNames(f),p=ar.fromNames(d),v=ar.isAll(m)&&p===0,h=e.child,g=h==null?void 0:h.unitMap.get(t.id);if(h&&!g)throw new Error("expected childUnit to exist if child exists");if(!(v&&!l&&!h))return function(y){return!!g&&!Le.has(g.elements,n[o[y]])||l&&(Qb(a,n[o[y]])||Qb(a,n[s[y]]))||!v&&S2(m,p,c[y])}}function Dz(e,t){var r=e.interUnitBonds,n=r.edges,a=t.ignoreHydrogens,i=t.includeTypes,o=t.excludeTypes,s=ar.fromNames(i),u=ar.fromNames(o),c=ar.isAll(s)&&u===0,l=e.child;if(!(c&&!a&&!l))return function(f){if(l){var d=n[f],m=l.unitMap.get(d.unitA);if(!m)return!0;var p=e.unitMap.get(d.unitA),v=p.elements[d.indexA];if(!Le.has(m.elements,v))return!0}if(a){var d=n[f],h=e.unitMap.get(d.unitA),g=e.unitMap.get(d.unitB);if(Kb(h,h.elements[d.indexA])||Kb(g,g.elements[d.indexB]))return!0}return!!(!c&&S2(s,u,n[f].props.flag))}}var Ql;(function(e){function t(n){var a=n.group,i=n.structure,o=a.units[0],s=Re.isAtomic(o)?o.bonds.edgeCount*2:0,u=a.units.length,c=Pt.Location(i,void 0,void 0,i,void 0,void 0),l=function(f,d){var m=a.units[d];return c.aUnit=m,c.bUnit=m,c.aIndex=m.bonds.a[f],c.bIndex=m.bonds.b[f],c};return Wr(s,u,1,l)}e.fromGroup=t;function r(n){var a=n.interUnitBonds.edgeCount,i=1,o=Pt.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var c=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(c.unitA),o.aIndex=c.indexA,o.bUnit=n.unitMap.get(c.unitB),o.bIndex=c.indexB,o};return Wr(a,i,1,s,!0)}e.fromStructure=r})(Ql||(Ql={}));function pP(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Re.isAtomic(u)){var c=o.target,l=u.bonds.a[i],f=u.bonds.b[i];return Pt.Loci(c,[Pt.Location(c,u,l,c,u,f),Pt.Location(c,u,f,c,u,l)])}}return ur}function vP(e,t,r,n){var a=!1;if(Pt.isLoci(e)){var i=t.structure,o=t.group;if(!ke.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!Re.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,c=0,l=e.bonds;c<l.length;c++){var f=l[c];if(f.aUnit===f.bUnit){var d=o.unitIndexMap.get(f.aUnit.id);if(d!==void 0){var m=s.bonds.getDirectedEdgeIndex(f.aIndex,f.bIndex);m!==-1&&r(Se.ofSingleton(d*u+m))&&(a=!0)}}}}else if(_e.is(e)){var i=t.structure,o=t.group;if(!ke.areEquivalent(e.structure,i))return!1;var s=o.units[0];if(!Re.isAtomic(s))return!1;for(var p=s.bonds.edgeCount*2,v=function(_){var w=o.unitIndexMap.get(_.unit.id);if(w!==void 0){var T=s.bonds,A=T.offset,D=T.b;De.forEach(_.indices,function(E){for(var M=A[E],F=A[E+1];M<F;M++)(!n||De.has(_.indices,D[M]))&&r(Se.ofSingleton(w*p+M))&&(a=!0)})}},h=0,g=e.elements;h<g.length;h++){var y=g[h];v(y)}}return a}function hP(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.target,o=t.interUnitBonds.edges[a],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Pt.Loci(i,[Pt.Location(i,s,o.indexA,i,u,o.indexB),Pt.Location(i,u,o.indexB,i,s,o.indexA)])}return ur}var gP=new Map;function yP(e,t,r,n){var a=!1;if(Pt.isLoci(e)){if(!ke.areEquivalent(e.structure,t))return!1;for(var i=0,o=e.bonds;i<o.length;i++){var s=o[i],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Se.ofSingleton(u))&&(a=!0)}}else if(_e.is(e)){if(!ke.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var c=0,l=e.elements;c<l.length;c++){var f=l[c];gP.set(f.unit.id,f.indices)}for(var d=function(v){var h=v.unit;if(!Re.isAtomic(h))return"continue";t.interUnitBonds.getConnectedUnits(h.id).forEach(function(g){var y=gP.get(g.unitB);(!n||y)&&De.forEach(v.indices,function(b){!g.connectedIndices.includes(b)||g.getEdges(b).forEach(function(x){if(!n||y&&De.has(y,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(b,h.id,x.indexB,g.unitB);r(Se.ofSingleton(C))&&(a=!0)}})})})},m=0,p=e.elements;m<p.length;m++){var f=p[m];d(f)}gP.clear()}return a}var bP=ar.is;function Mz(e,t,r,n){var a=e.elements,i=e.bonds,o=i.edgeCount,s=i.a,u=i.b,c=i.edgeProps,l=i.offset,f=c.order,d=c.flags,m=n.sizeFactor,p=n.sizeAspectRatio,v=n.adjustCylinderLength,h=n.aromaticBonds,g=n.includeTypes,y=n.excludeTypes,b=n.multipleBonds,x=b==="off",C=b==="symmetric",_=ar.fromNames(g),w=ar.fromNames(y),T=S2(_,w,32),A=S(),D=S(),E=e.conformation.invariantPosition,M,F=Qe.create(t,e),O=Pt.Location(t,e,void 0,t,e,void 0),U=t.child;if(n.includeParent&&U){var N=U.unitMap.get(e.id);if(!N)throw new Error("expected childUnit to exist");M=function(L){var W=a[s[L]],k=a[u[L]];return Le.has(N.elements,W)&&!Le.has(N.elements,k)}}var q=function(L){return O.aIndex=s[L],O.bIndex=u[L],r.size.size(O)*m},j=function(L){return F.element=a[s[L]],r.size.size(F)*m},Q=function(L){return F.element=a[u[L]],r.size.size(F)*m},J=e.rings,te=J.elementRingIndices,K=J.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(L){var W,k,V=s[L],G=u[L];V>G&&(W=[G,V],V=W[0],G=W[1]),l[V+1]-l[V]==1&&(k=[G,V],V=k[0],G=k[1]);for(var H=K.get(V)||te.get(V),X=0,Y=l[V],oe=l[V+1];Y<oe;++Y){var ue=u[Y];if(ue!==G&&ue!==V)if(H){var me=K.get(ue)||te.get(ue);if(!me)continue;var he=Iy(H,me);he>X&&(X=he,E(a[ue],A))}else return E(a[ue],A)}return X>0?A:null},position:function(L,W,k){if(E(a[s[k]],L),E(a[u[k]],W),v){var V=j(k),G=Q(k),H=Math.min(V,G)*p,X=Math.sqrt(Math.max(0,V*V-H*H))-.05,Y=Math.sqrt(Math.max(0,G*G-H*H))-.05;if(X<=.01&&Y<=.01)return;S.normalize(D,S.sub(D,W,L)),S.scaleAndAdd(L,L,D,X),S.scaleAndAdd(W,W,D,-Y)}},style:function(L){var W=f[L],k=d[L];if(bP(k,2)||bP(k,4))return 1;if(W===3)return x?0:C?4:5;if(h){var V=s[L],G=u[L],H=K.get(V),X=K.get(G),Y=H&&X?Iy(H,X):0;if(bP(k,16)||Y&&!T)return Y===2?8:7}return W!==2||x?0:C?2:3},radius:function(L){return q(L)*p},ignore:Iz(t,e,n),stub:M}}function p_e(e,t,r,n,a,i){if(!Re.isAtomic(t)||!t.bonds.edgeCount)return no.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return no.createEmpty(i);var u=Mz(t,r,n,a),c=sU(e,u,a,i),l=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return c.setBoundingSphere(l),c}function v_e(e,t,r,n,a,i){if(!Re.isAtomic(t)||!t.bonds.edgeCount)return At.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return At.createEmpty(i);var u=Mz(t,r,n,a),c=Dd(e,u,a,i),l=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*a.sizeFactor);return c.setBoundingSphere(l),c}var C2=I(I(I(I({},Na),nU),dP),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:P.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:P.Boolean(!0),includeParent:P.Boolean(!1)});function Rz(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?h_e(e):g_e(e)}function h_e(e){return aU({defaultProps:P.getDefaultValues(C2),createGeometry:p_e,createLocationIterator:Ql.fromGroup,getLoci:pP,eachLocation:vP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Re.isAtomic(u)&&Re.isAtomic(c)&&(Ni.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function g_e(e){return xi({defaultProps:P.getDefaultValues(C2),createGeometry:v_e,createLocationIterator:Ql.fromGroup,getLoci:pP,eachLocation:vP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Re.isAtomic(u)&&Re.isAtomic(c)&&(Ni.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var xP=new Pt.ElementBondIterator;function Bz(e,t,r,n){for(xP.setElement(t,r,n);xP.hasNext;){var a=xP.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}var Fz=S();function Oz(e,t,r){var n=Qe.create(e),a=Pt.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,o=i.edgeCount,s=i.edges,u=r.sizeFactor,c=r.sizeAspectRatio,l=r.adjustCylinderLength,f=r.aromaticBonds,d=r.multipleBonds,m=d==="off",p=d==="symmetric",v=S(),h,g=e.child;r.includeParent&&g&&(h=function(C){var _=s[C],w=g.unitMap.get(_.unitA),T=g.unitMap.get(_.unitB),A=e.unitMap.get(_.unitA),D=A.elements[_.indexA],E=e.unitMap.get(_.unitB),M=E.elements[_.indexB];return w&&Le.has(w.elements,D)&&(!T||!Le.has(T.elements,M))});var y=function(C){var _=s[C];return a.aUnit=e.unitMap.get(_.unitA),a.aIndex=_.indexA,a.bUnit=e.unitMap.get(_.unitB),a.bIndex=_.indexB,t.size.size(a)*u},b=function(C){var _=s[C];return n.unit=e.unitMap.get(_.unitA),n.element=n.unit.elements[_.indexA],t.size.size(n)*u},x=function(C){var _=s[C];return n.unit=e.unitMap.get(_.unitB),n.element=n.unit.elements[_.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(C){var _=s[C],w,T,A,D;if(_.unitA<_.unitB)w=e.unitMap.get(_.unitA),T=e.unitMap.get(_.unitB),A=_.indexA,D=_.indexB;else if(_.unitA>_.unitB)w=e.unitMap.get(_.unitB),T=e.unitMap.get(_.unitA),A=_.indexB,D=_.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return Bz(Fz,e,w,A)||Bz(Fz,e,T,D)},position:function(C,_,w){var T=s[w],A=e.unitMap.get(T.unitA),D=e.unitMap.get(T.unitB);if(A.conformation.position(A.elements[T.indexA],C),D.conformation.position(D.elements[T.indexB],_),l){var E=b(w),M=x(w),F=Math.min(E,M)*c,O=Math.sqrt(Math.max(0,E*E-F*F))-.05,U=Math.sqrt(Math.max(0,M*M-F*F))-.05;if(O<=.01&&U<=.01)return;S.normalize(v,S.sub(v,_,C)),S.scaleAndAdd(C,C,v,O),S.scaleAndAdd(_,_,v,-U)}},style:function(C){var _=s[C].props.order,w=Da.create(s[C].props.flag);return ar.is(w,2)||ar.is(w,4)?1:_===3?m?0:p?4:5:f&&ar.is(w,16)?7:_!==2||m?0:p?2:3},radius:function(C){return y(C)*c},ignore:Dz(e,r),stub:h}}function y_e(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return no.createEmpty(a);var i=Oz(t,r,n),o=sU(e,i,n,a),s=t.child,u=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function b_e(e,t,r,n,a){if(!t.interUnitBonds.edgeCount)return At.createEmpty(a);var i=Oz(t,r,n),o=Dd(e,i,n,a),s=t.child,u=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var _2=I(I(I(I({},h0),k2e),dP),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:P.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:P.Boolean(!0),includeParent:P.Boolean(!1)});function kz(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?x_e(e):S_e(e)}function x_e(e){return L2e({defaultProps:P.getDefaultValues(_2),createGeometry:y_e,createLocationIterator:Ql.fromStructure,getLoci:hP,eachLocation:yP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function S_e(e){return Td({defaultProps:P.getDefaultValues(_2),createGeometry:b_e,createLocationIterator:Ql.fromStructure,getLoci:hP,eachLocation:yP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Lz=new Float32Array([-1,1,-1,-1,1,1,1,-1]),kp=new Uint16Array([0,1,2,1,3,2]),SP=Me.add3,C_e=Me.add2,__e=Me.add,w2;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var i=Me.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Me.create(Float32Array,2,n,a?a.mappingBuffer.ref.value:r),s=Me.create(Uint32Array,3,n/2,a?a.indexBuffer.ref.value:r/2),u=Me.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(c,l,f,d){for(var m=i.elementCount,p=0;p<4;++p)SP(i,c,l,f),C_e(o,Lz[p*2],Lz[p*2+1]),__e(u,d);SP(s,m+kp[0],m+kp[1],m+kp[2]),SP(s,m+kp[3],m+kp[4],m+kp[5])},getSpheres:function(){var c=Me.compact(i,!0),l=Me.compact(o,!0),f=Me.compact(s,!0),d=Me.compact(u,!0);return Tl.create(c,l,f,d,i.elementCount/4,a)}}}e.create=t})(w2||(w2={}));var Nz=S.add;function A2(e,t,r){var n=r.ignoreHydrogens,a=r.traceOnly,i=t.model.atomicHierarchy.derived.atom.atomicNumber,o=Re.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!a))return function(c){return!!u&&!Le.has(u.elements,c)||!o&&n&&Qb(i,c)||a&&!IT(t,c)}}function w_e(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return At.createEmpty(i);for(var u=a.detail,c=a.sizeFactor,l=t.elements,f=l.length,d=f*b1(u),m=it.createState(d,d/2,i),p=S(),v=t.conformation.invariantPosition,h=A2(r,t,a),g=Qe.create(r,t),y=n.size.size,b=S(),x=0,C=0,_=0;_<f;_++)if(!(h&&h(l[_]))){g.element=l[_],v(l[_],p),Nz(b,b,p),C+=1,m.currentGroup=_;var w=y(g);w>x&&(x=w),Kn(m,p,w*c,u)}var T;S.scale(b,b,1/C),i&&S.distance(b,i.boundingSphere.center)/i.boundingSphere.radius<1?T=Te.clone(i.boundingSphere):T=Te.expand(Te(),(s!=null?s:t).boundary.sphere,x*c+.05);var A=it.getMesh(m);return A.setBoundingSphere(T),A}function A_e(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Tl.createEmpty(i);for(var u=t.elements,c=u.length,l=w2.create(c,c/2,i),f=S(),d=t.conformation.invariantPosition,m=A2(r,t,a),p=Qe.create(r,t),v=n.size.size,h=S(),g=0,y=0,b=0;b<c;b++)if(!(m==null?void 0:m(u[b]))){d(u[b],f),l.add(f[0],f[1],f[2],b),Nz(h,h,f),y+=1,p.element=u[b];var x=v(p);x>g&&(g=x)}var C;S.scale(h,h,1/y),i&&S.distance(h,i.boundingSphere.center)/i.boundingSphere.radius<1?C=Te.clone(i.boundingSphere):C=Te.expand(Te(),(s!=null?s:t).boundary.sphere,g*a.sizeFactor+.05);var _=l.getSpheres();return _.setBoundingSphere(C),_}function Ms(e,t,r){var n=!1;if(!_e.is(e))return!1;var a=t.structure,i=t.group;if(!ke.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=i.unitIndexMap,u=0,c=e.elements;u<c.length;u++){var l=c[u],f=s.get(l.unit.id);if(f!==void 0){var d=f*o;if(Se.is(l.indices)){var m=d+Se.start(l.indices),p=d+Se.end(l.indices);r(Se.ofBounds(m,p))&&(n=!0)}else for(var v=0,h=l.indices.length;v<h;v++){for(var m=l.indices[v],g=v+1;g<h&&l.indices[g]===m;)g++;v=g-1;var p=l.indices[v];n=r(Se.ofRange(d+m,d+p))||n}}}return n}function Rs(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],c=De.ofSingleton(i);return _e(o.target,[{unit:u,indices:c}])}return ur}function T2(e,t,r){var n=!1;if(!_e.is(e)||!ke.areEquivalent(e.structure,t))return!1;for(var a=t.serialMapping.cumulativeUnitElementCount,i=0,o=e.elements;i<o.length;i++){var s=o[i],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Se.is(s.indices)){var c=a[u]+Se.start(s.indices),l=a[u]+Se.end(s.indices);r(Se.ofBounds(c,l))&&(n=!0)}else for(var f=0,d=s.indices.length;f<d;f++){var m=a[u]+s.indices[f];r(Se.ofSingleton(m))&&(n=!0)}}return n}function P2(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.serialMapping,o=i.unitIndices,s=i.cumulativeUnitElementCount,u=o[a],c=t.units[u],l=a-s[u],f=De.ofSingleton(l);return _e(t,[{unit:c,indices:f}])}return ur}var za;(function(e){function t(n){var a=n.group,i=n.structure,o=a.elements.length,s=a.units.length,u=Qe.create(i),c=function(l,f){var d=a.units[f];return u.unit=d,u.element=d.elements[l],u};return Wr(o,s,1,c)}e.fromGroup=t;function r(n){var a=n.units,i=n.elementCount,o=i,s=1,u=n.serialMapping,c=u.unitIndices,l=u.elementIndices,f=Qe.create(n),d=function(m){return f.unit=a[c[m]],f.element=l[m],f};return Wr(o,s,1,d,!0)}e.fromStructure=r})(za||(za={}));var E2=I(I(I({},Na),tU),{sizeFactor:P.Numeric(1,{min:0,max:10,step:.1}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),ignoreHydrogens:P.Boolean(!1),traceOnly:P.Boolean(!1),tryUseImpostor:P.Boolean(!0)});function Uz(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?T_e(e):P_e(e)}function T_e(e){return rU({defaultProps:P.getDefaultValues(E2),createGeometry:A_e,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function P_e(e){return xi({defaultProps:P.getDefaultValues(E2),createGeometry:w_e,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var zz={"element-sphere":function(e,t){return sn("Element sphere",e,t,Uz)},"intra-bond":function(e,t){return sn("Intra-unit bond cylinder",e,t,Rz)},"inter-bond":function(e,t){return Ps("Inter-unit bond cylinder",e,t,kz)}},Vz=I(I(I(I(I({},E2),{traceOnly:P.Boolean(!1,{isHidden:!0})}),C2),_2),{includeParent:P.Boolean(!1),unitKinds:v0(["atomic"]),sizeFactor:P.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:P.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:P.MultiSelect(["element-sphere","intra-bond","inter-bond"],P.objectToOptions(zz)),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory)});function E_e(e,t){return P.clone(Vz)}function I_e(e,t){return Vt.createMulti("Ball & Stick",e,t,ta,zz)}var D_e=ri({name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:I_e,getParams:E_e,defaultValues:P.getDefaultValues(Vz),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}});function M_e(e,t,r,n,a){var i=t.carbohydrates,o=i.links,s=i.elements,u=n.linkSizeFactor,c=Qe.create(t),l={linkCount:o.length,position:function(f,d,m){var p=o[m];S.copy(f,s[p.carbohydrateIndexA].geometry.center),S.copy(d,s[p.carbohydrateIndexB].geometry.center)},radius:function(f){var d=o[f],m=s[d.carbohydrateIndexA],p=m.unit.rings.all[m.ringIndex];return c.unit=m.unit,c.element=m.unit.elements[p[0]],r.size.size(c)*u}};return Dd(e,l,n,a)}var Gz=I(I(I({},Na),Id),{linkSizeFactor:P.Numeric(.3,{min:0,max:3,step:.01})});function R_e(e){return Td({defaultProps:P.getDefaultValues(Gz),createGeometry:M_e,createLocationIterator:B_e,getLoci:F_e,eachLocation:O_e,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function B_e(e){var t=e.carbohydrates,r=t.elements,n=t.links,a=n.length,i=1,o=Qe.create(e),s=function(u){var c=n[u],l=r[c.carbohydrateIndexA],f=l.unit.rings.all[l.ringIndex];return o.unit=l.unit,o.element=l.unit.elements[f[0]],o};return Wr(a,i,1,s,!0)}function F_e(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.links,s=i.elements,u=o[a],c=s[u.carbohydrateIndexA],l=s[u.carbohydrateIndexB];return _e.union(p0(t,c.unit,c.residueIndex,c.altId),p0(t,l.unit,l.residueIndex,l.altId))}return ur}var CP=new Set;function O_e(e,t,r){var n=!1;if(!_e.is(e)||!ke.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getLinkIndices,i=function(f,d){if(!Re.isAtomic(f))return"continue";CP.clear(),De.forEach(d,function(m){for(var p=a(f,f.elements[m]),v=0,h=p.length;v<h;++v)CP.has(p[v])||(CP.add(p[v]),r(Se.ofSingleton(p[v]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],c=u.unit,l=u.indices;i(c,l)}return n}var k_e=S.create(0,0,-.5),L_e=S.create(0,0,.5),Zl=S(),$l=S(),I2=S(),Hz=S();function N_e(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,a=t===4?t*3+4:n*3,i=Zm(n,a),o=0;o<t;++o){var s=(o+1)%t;S.set(Zl,e[o*3],e[o*3+1],-.5),S.set($l,e[s*3],e[s*3+1],-.5),i.add(Zl,$l,L_e)}if(t===3)S.set(Zl,e[0],e[1],-.5),S.set($l,e[3],e[4],-.5),S.set(I2,e[6],e[7],-.5),i.add(I2,$l,Zl);else if(t===4)S.set(Zl,e[0],e[1],-.5),S.set($l,e[3],e[4],-.5),S.set(I2,e[6],e[7],-.5),S.set(Hz,e[9],e[10],-.5),i.addQuad(Hz,I2,$l,Zl);else for(var o=0;o<t;++o){var s=(o+1)%t;S.set(Zl,e[o*3],e[o*3+1],-.5),S.set($l,e[s*3],e[s*3+1],-.5),i.add(k_e,$l,Zl)}return i.getPrimitive()}var _P;function U_e(){return _P||(_P=N_e($s(8,!0))),_P}var wP;function z_e(){if(!wP){for(var e=$s(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];wP=p1(t,n)}return wP}var V_e={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},AP=S.zero(),TP=S.zero(),PP=S.zero(),E0=S.zero(),EP=S.zero();function G_e(e){for(var t=I(I({},V_e),e),r=t.outerRadius,n=t.innerRadius,a=t.thickness,i=t.pointCount,o=i*2*2,s=Zm(o),u=new Float32Array(i*2),c=new Float32Array(i*2),l=0;l<i;++l){var f=l*2,d=l*2+1,m=(f+1)/i*Math.PI,p=(d+1)/i*Math.PI;c[f]=Math.cos(m)*r,c[d]=Math.sin(m)*r,u[f]=Math.cos(p)*n,u[d]=Math.sin(p)*n}S.set(AP,0,0,a/2),S.set(TP,0,0,-a/2);for(var l=0;l<i;++l){var v=(l+1)%i;S.set(PP,c[l*2],c[l*2+1],0),S.set(E0,u[l*2],u[l*2+1],0),S.set(EP,c[v*2],c[v*2+1],0),s.add(AP,PP,E0),s.add(E0,PP,TP),s.add(AP,E0,EP),s.add(EP,E0,TP)}return s.getPrimitive()}var qz=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],H_e=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],q_e=[0,2,4,0,4,3,1,2,5,1,5,3],IP;function j_e(){return IP||(IP=p1(qz,H_e)),IP}var DP;function W_e(){return DP||(DP=p1(qz,q_e)),DP}var Tt=se.identity(),Ic=S(),jz=S(),X_e=2*.806,Wz=z_(),Xz=lre(),Y_e=U_e(),Yz=z_e(),K_e=G_e({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Q_e=j_e(),Kz=W_e(),Qz=ine(),Z_e=one(),$_e=sne(),J_e=une(),ewe=cne();function twe(e,t,r,n,a){for(var i=it.createState(256,128,a),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,c=u.elements.length,l=Qe.create(t),f=0;f<c;++f){var d=u.elements[f],m=d.unit.rings.all[d.ringIndex],p=Zne(d.component.type,m.length);l.unit=d.unit,l.element=d.unit.elements[m[0]];var v=r.size.size(l),h=v*s,g=v*s*X_e,y=d.geometry,b=y.center,x=y.normal,C=y.direction;switch(S.add(jz,b,C),se.targetTo(Tt,b,jz,x),se.setTranslation(Tt,b),i.currentGroup=f*2,p){case 0:Kn(i,b,h,o);break;case 1:se.scaleUniformly(Tt,Tt,g),it.addPrimitive(i,Tt,Wz);break;case 2:se.scaleUniformly(Tt,Tt,g),it.addPrimitive(i,Tt,Xz),se.mul(Tt,Tt,se.rotZ90X180),i.currentGroup+=1,it.addPrimitive(i,Tt,Xz);break;case 4:se.scaleUniformly(Tt,Tt,g*1.2),it.addPrimitive(i,Tt,Y_e);break;case 5:se.scaleUniformly(Tt,Tt,g*1.2),it.addPrimitive(i,Tt,Yz),se.mul(Tt,Tt,se.rotZ90),i.currentGroup+=1,it.addPrimitive(i,Tt,Yz);break;case 6:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g,g/2)),it.addPrimitive(i,Tt,Wz);break;case 7:se.scaleUniformly(Tt,Tt,g),se.mul(Tt,Tt,se.rotZY90),it.addPrimitive(i,Tt,K_e);break;case 8:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g*1.4,g*1.4,g*1.4)),it.addPrimitive(i,Tt,Q_e);break;case 3:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g*1.4,g*1.4,g*1.4)),it.addPrimitive(i,Tt,Kz),se.mul(Tt,Tt,se.rotY90),i.currentGroup+=1,it.addPrimitive(i,Tt,Kz);break;case 9:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g/2,g/2)),it.addPrimitive(i,Tt,Qz);break;case 12:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g,g/2)),it.addPrimitive(i,Tt,Qz);break;case 13:case 11:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g,g/2)),it.addPrimitive(i,Tt,Z_e);break;case 14:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g,g/2)),it.addPrimitive(i,Tt,$_e);break;case 15:se.mul(Tt,Tt,se.rotZY90),se.scale(Tt,Tt,S.set(Ic,g,g,g/2)),it.addPrimitive(i,Tt,ewe);break;case 10:default:se.mul(Tt,Tt,se.rotZYZ90),se.scale(Tt,Tt,S.set(Ic,g/1.5,g,g/2)),it.addPrimitive(i,Tt,J_e);break}}return it.getMesh(i)}var Zz=I(I({},h0),{detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),sizeFactor:P.Numeric(1.75,{min:0,max:10,step:.01})});function rwe(e){return Td({defaultProps:P.getDefaultValues(Zz),createGeometry:twe,createLocationIterator:nwe,getLoci:awe,eachLocation:iwe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function nwe(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,a=Qe.create(e);function i(s,u){var c=t[Math.floor(s/2)],l=c.unit.rings.all[c.ringIndex];return a.unit=c.unit,a.element=c.unit.elements[l[0]],a}function o(s,u){return s%2==1}return Wr(r,n,1,i,!0,o)}function awe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates.elements[Math.floor(a/2)];return p0(t,i.unit,i.residueIndex,i.altId)}return ur}var MP=new Set;function iwe(e,t,r){var n=t.carbohydrates.getElementIndices,a=!1;if(!_e.is(e)||!ke.areEquivalent(e.structure,t))return!1;for(var i=function(f,d){if(!Re.isAtomic(f))return"continue";MP.clear(),De.forEach(d,function(m){for(var p=n(f,f.elements[m]),v=0,h=p.length;v<h;++v)MP.has(p[v])||(MP.add(p[v]),r(Se.ofSingleton(p[v]*2))&&(a=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],c=u.unit,l=u.indices;i(c,l)}return a}function owe(e,t,r,n,a){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=n.terminalLinkSizeFactor,c=Qe.create(t),l={linkCount:o.length,position:function(f,d,m){var p=o[m];p.fromCarbohydrate?(S.copy(f,s[p.carbohydrateIndex].geometry.center),p.elementUnit.conformation.position(p.elementUnit.elements[p.elementIndex],d)):(p.elementUnit.conformation.position(p.elementUnit.elements[p.elementIndex],f),S.copy(d,s[p.carbohydrateIndex].geometry.center))},radius:function(f){var d=o[f];if(d.fromCarbohydrate){var m=s[d.carbohydrateIndex],p=m.unit.rings.all[m.ringIndex];c.unit=m.unit,c.element=m.unit.elements[p[0]]}else c.unit=d.elementUnit,c.element=d.elementUnit.elements[d.elementIndex];return r.size.size(c)*u},style:function(f){var d=o[f],m=d.elementUnit.elements[d.elementIndex],p=su(d.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(m));return kh.has(p)?1:0}};return Dd(e,l,n,a)}var $z=I(I(I({},Na),Id),{terminalLinkSizeFactor:P.Numeric(.2,{min:0,max:3,step:.01})});function swe(e){return Td({defaultProps:P.getDefaultValues($z),createGeometry:owe,createLocationIterator:uwe,getLoci:cwe,eachLocation:lwe,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function uwe(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,a=n.length,i=1,o=Qe.create(e),s=function(u){var c=n[u];if(c.fromCarbohydrate){var l=r[c.carbohydrateIndex],f=l.unit.rings.all[l.ringIndex];o.unit=l.unit,o.element=l.unit.elements[f[0]]}else o.unit=c.elementUnit,o.element=c.elementUnit.elements[c.elementIndex];return o};return Wr(a,i,1,s,!0)}function cwe(e,t,r){var n=e.objectId,a=e.groupId;if(r===n){var i=t.carbohydrates,o=i.terminalLinks,s=i.elements,u=o[a],c=s[u.carbohydrateIndex];return _e.union(p0(t,c.unit,c.residueIndex,c.altId),A2e(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return ur}var RP=new Set;function lwe(e,t,r){var n=!1;if(!_e.is(e)||!ke.areEquivalent(e.structure,t))return!1;for(var a=t.carbohydrates.getTerminalLinkIndices,i=function(f,d){if(!Re.isAtomic(f))return"continue";RP.clear(),De.forEach(d,function(m){for(var p=a(f,f.elements[m]),v=0,h=p.length;v<h;++v)RP.has(p[v])||(RP.add(p[v]),r(Se.ofSingleton(p[v]))&&(n=!0))})},o=0,s=e.elements;o<s.length;o++){var u=s[o],c=u.unit,l=u.indices;i(c,l)}return n}var Jz={"carbohydrate-symbol":function(e,t){return Ps("Carbohydrate symbol mesh",e,t,rwe)},"carbohydrate-link":function(e,t){return Ps("Carbohydrate link cylinder",e,t,R_e)},"carbohydrate-terminal-link":function(e,t){return Ps("Carbohydrate terminal link cylinder",e,t,swe)}},e9=I(I(I(I({},Zz),Gz),$z),{visuals:P.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],P.objectToOptions(Jz)),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory)});function fwe(e,t){return P.clone(e9)}function dwe(e,t){return Vt.createMulti("Carbohydrate",e,t,ta,Jz)}var mwe=ri({name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:dwe,getParams:fwe,defaultValues:P.getDefaultValues(e9),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return jt.hasCarbohydrate(t)})}});function t9(e,t){switch(e.kind){case 0:return pwe(e,t);case 1:case 2:return vwe(e,t)}}function pwe(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Tr.transientSegments(D0(e),e.elements),a=qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,c=!0,l=-1,f=0;n.hasNext;){for(c=!0,l=f,a.setSegment(n.move());a.hasNext;){if(c){var d=a.move().index;if(++f,!a.hasNext)continue;c=!1,u=d}var m=a.move().index;s=u,u=m,t(i[s],i[u],f-1,f,o[s]),++f}r.has(u)&&(s=u,u=r.get(s),t(i[s],i[u],f-1,l,o[s]))}}function vwe(e,t){for(var r=Tr.transientSegments(D0(e),e.elements),n=e.elements,a=!0,i=0;r.hasNext;){a=!0;for(var o=r.move(),s=o.start,u=o.end,c=s,l=u;c<l;++c){if(a){if(++c,++i,c>l)continue;a=!1}t(n[c-1],n[c],i-1,i,0),++i}}}function r9(e,t){switch(e.kind){case 0:return hwe(e,t);case 1:case 2:return gwe(e,t)}}function hwe(e,t){for(var r=Tr.transientSegments(D0(e),e.elements),n=qt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(a[o],i),++i}}function gwe(e,t){for(var r=Tr.transientSegments(D0(e),e.elements),n=e.elements,a=0;r.hasNext;)for(var i=r.move(),o=i.start,s=i.end,u=o,c=s;u<c;++u)t(n[u],a),++a}function ywe(e,t){switch(t.kind){case 0:return new bwe(e,t);case 1:case 2:return new xwe(e,t)}}function n9(e,t){return{centerA:Qe.create(e,t),centerB:Qe.create(e,t)}}var bwe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Tr.transientSegments(d9(r),r.elements),this.value=n9(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,a=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[a.start]]],this.value.centerB.element=this.traceElementIndex[n[r[a.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),xwe=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Tr.transientSegments(d9(r),r.elements),this.value=n9(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function Swe(e){for(var t=e.atomicConformation,r=t.x,n=t.y,a=t.z,i=e.atomicHierarchy.derived.residue,o=i.polymerType,s=i.traceElementIndex,u=o.length,c=De.ofBounds(0,e.atomicConformation.atomId.rowCount),l=Tr.transientSegments(e.atomicRanges.polymerRanges,c),f=qt.transientSegments(e.atomicHierarchy.residueAtomSegments,c),d=new Float32Array(u*3),m=new Float32Array(u*3),p=0,v=-1,h=-1,g=S(),y=S(),b=S(),x=S(),C=S(),_=S(),w=S(),T=S(),A=S(),D=S(),E=S(),M=S(),F=S(),O=S();l.hasNext;){var U=l.move();for(f.setSegment(U),p=-1,h=-1;f.hasNext;){p+=1;var N=f.move().index;p===0&&(h=N),v=N-2;var q=v*3;S.copy(g,y),S.copy(y,b),S.copy(b,x);var j=s[N];if(S.set(x,r[j],n[j],a[j]),!(p<3)){S.sub(C,y,g),S.sub(_,b,y),S.sub(w,x,b),S.sub(E,C,_),S.sub(M,_,w),S.cross(F,E,M),S.normalize(F,F),S.toArray(F,m,q);var Q=Math.cos(S.angle(E,M)),J=S.magnitude(E),te=S.magnitude(M),K=Math.sqrt(te*J)/Math.max(2,2*(1-Q));S.scale(T,E,K/J),S.sub(T,y,T),S.toArray(T,d,q),S.scale(A,M,K/te),S.sub(A,b,A),S.toArray(A,d,q+3),S.copy(O,F)}}var L=h*3;S.fromArray(T,d,L+3),S.fromArray(A,d,L+6),S.normalize(F,S.sub(F,T,A));var W=s[h];S.set(g,r[W],n[W],a[W]),S.copy(D,g),S.projectPointOnVector(D,D,F,T),S.toArray(D,d,L);var k=v+2,V=k*3;S.fromArray(T,d,V-3),S.fromArray(A,d,V-6),S.normalize(F,S.sub(F,T,A));var G=s[k];S.set(g,r[G],n[G],a[G]),S.copy(D,g),S.projectPointOnVector(D,D,F,T),S.toArray(D,d,V)}return{centers:d}}var BP=up.createProvider({label:"Helix Orientation",descriptor:to({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ie(void 0,void 0,void 0,function(){return ae(this,function(r){return[2,{value:Swe(t)}]})})}});function Bs(e){return yr.is(e,2)}function Cwe(e){return yr.is(e,4)}function FP(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new _we(e,t,r);case 1:case 2:return new wwe(e,t)}}var D2=yr.create(536870912);function a9(e,t){return{center:Qe.create(e,t),centerPrev:Qe.create(e,t),centerNext:Qe.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:D2,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:S(),p1:S(),p2:S(),p3:S(),p4:S(),d12:S(),d23:S()}}var Ft=S(),M2=S(),R2=S(),_we=function(){function e(t,r,n){n===void 0&&(n={});var a;if(this.unit=t,this.state=0,this.p0=S(),this.p1=S(),this.p2=S(),this.p3=S(),this.p4=S(),this.p5=S(),this.p6=S(),this.d01=S(),this.d12=S(),this.d23=S(),this.d34=S(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Tr.transientSegments(this.polymerRanges,t.elements),this.residueIt=qt.transientSegments(this.residueAtomSegments,t.elements),this.value=a9(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(a=zo.get(r).value)===null||a===void 0?void 0:a.get(t.invariantId)),n.useHelixOrientation){var i=BP.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var a=this.traceElementIndex[r];this.helixOrientationCenters&&Bs(n)?S.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,a)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,a=r.getIndex,i=n[a(t)];return Bs(i)?2:i}else return D2},e.prototype.setControlPoint=function(t,r,n,a,i){Cwe(i)||this.helixOrientationCenters&&Bs(i)?S.scale(t,S.add(t,r,S.add(t,a,S.add(t,n,n))),1/4):S.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&Bs(n)?S.set(t,1,0,0):(this.atomicPos(M2,this.directionFromElementIndex[r]),this.atomicPos(R2,this.directionToElementIndex[r]),S.sub(t,R2,M2))},e.prototype.setDirection=function(t,r,n,a){S.matchDirection(M2,r,n),S.matchDirection(R2,a,n),S.scale(t,S.add(t,M2,S.add(t,R2,S.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,a=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?D2:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),c=this.getResidueIndex(s-2),l=this.getResidueIndex(s-1),f=this.getResidueIndex(s+1),d=this.getResidueIndex(s+2),m=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===f?D2:this.getSecStruc(f),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[f]===-1||this.directionToElementIndex[f]===-1,a.secStrucType=this.currSecStrucType,a.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,a.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,a.isCoarseBackbone=this.currCoarseBackbone,a.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,a.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,a.first=s===this.residueSegmentMin,a.last=s===this.residueSegmentMax,a.moleculeType=this.moleculeType[s],a.initial=s===l,a.final=s===f,a.centerPrev.element=this.traceElementIndex[l],a.center.element=this.traceElementIndex[s],a.centerNext.element=this.traceElementIndex[f];var p=this.getSecStruc(u),v=this.getSecStruc(c),h=this.getSecStruc(l),g=this.getSecStruc(s),y=this.getSecStruc(f),b=this.getSecStruc(d),x=this.getSecStruc(m);this.pos(this.p0,u,p),this.pos(this.p1,c,v),this.pos(this.p2,l,h),this.pos(this.p3,s,g),this.pos(this.p4,f,y),this.pos(this.p5,d,b),this.pos(this.p6,m,x);var C=Bs(p),_=Bs(v),w=Bs(h),T=Bs(g),A=Bs(y),D=Bs(b),E=Bs(x);this.helixOrientationCenters&&(T!==w?T?(S.copy(this.p0,this.p3),S.copy(this.p1,this.p3),S.copy(this.p2,this.p3)):w&&(S.scale(Ft,S.sub(Ft,this.p2,this.p3),2),S.add(this.p2,this.p3,Ft),S.add(this.p1,this.p2,Ft),S.add(this.p0,this.p1,Ft)):T!==_?T?(S.copy(this.p0,this.p2),S.copy(this.p1,this.p2)):_&&(S.scale(Ft,S.sub(Ft,this.p1,this.p2),2),S.add(this.p1,this.p2,Ft),S.add(this.p0,this.p1,Ft)):T!==C&&(T?S.copy(this.p0,this.p1):C&&(S.scale(Ft,S.sub(Ft,this.p0,this.p1),2),S.add(this.p0,this.p1,Ft))),T!==A?T?(S.copy(this.p4,this.p3),S.copy(this.p5,this.p3),S.copy(this.p6,this.p3)):A&&(S.scale(Ft,S.sub(Ft,this.p4,this.p3),2),S.add(this.p4,this.p3,Ft),S.add(this.p5,this.p4,Ft),S.add(this.p6,this.p5,Ft)):T!==D?T?(S.copy(this.p5,this.p4),S.copy(this.p6,this.p4)):D&&(S.scale(Ft,S.sub(Ft,this.p5,this.p4),2),S.add(this.p5,this.p4,Ft),S.add(this.p6,this.p5,Ft)):T!==E&&(T?S.copy(this.p6,this.p5):E&&(S.scale(Ft,S.sub(Ft,this.p6,this.p5),2),S.add(this.p6,this.p5,Ft)))),this.setFromToVector(this.d01,l,h),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,f,y),this.setFromToVector(this.d34,d,b);var M=T&&this.helixOrientationCenters,F=1.5;s===l||g!==h&&M?(S.setMagnitude(Ft,S.sub(Ft,this.p3,this.p4),F),S.add(this.p2,this.p3,Ft),S.add(this.p1,this.p2,Ft),S.add(this.p0,this.p1,Ft)):l===c||g!==v&&M?(S.setMagnitude(Ft,S.sub(Ft,this.p2,this.p3),F),S.add(this.p1,this.p2,Ft),S.add(this.p0,this.p1,Ft)):(c===u||g!==p&&M)&&(S.setMagnitude(Ft,S.sub(Ft,this.p1,this.p2),F),S.add(this.p0,this.p1,Ft)),s===f||g!==y&&M?(S.setMagnitude(Ft,S.sub(Ft,this.p3,this.p2),F),S.add(this.p4,this.p3,Ft),S.add(this.p5,this.p4,Ft),S.add(this.p6,this.p5,Ft)):f===d||g!==b&&M?(S.setMagnitude(Ft,S.sub(Ft,this.p4,this.p3),F),S.add(this.p5,this.p4,Ft),S.add(this.p6,this.p5,Ft)):(d===m||g!==x&&M)&&(S.setMagnitude(Ft,S.sub(Ft,this.p5,this.p4),F),S.add(this.p6,this.p5,Ft)),this.setControlPoint(a.p0,this.p0,this.p1,this.p2,v),this.setControlPoint(a.p1,this.p1,this.p2,this.p3,h),this.setControlPoint(a.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(a.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(a.p4,this.p4,this.p5,this.p6,b),this.setDirection(a.d12,this.d01,this.d12,this.d23),this.setDirection(a.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),wwe=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Tr.transientSegments(D0(t),t.elements),this.value=a9(r,t),S.set(this.value.d12,1,0,0),S.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),a=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,a);var i=.5;this.elementIndex===r?(S.scale(Ft,S.sub(Ft,this.value.p2,this.value.p3),i),S.add(this.value.p1,this.value.p2,Ft),S.add(this.value.p0,this.value.p1,Ft)):r===t&&(S.scale(Ft,S.sub(Ft,this.value.p1,this.value.p2),i),S.add(this.value.p0,this.value.p1,Ft)),this.elementIndex===n?(S.scale(Ft,S.sub(Ft,this.value.p2,this.value.p1),i),S.add(this.value.p3,this.value.p2,Ft),S.add(this.value.p4,this.value.p3,Ft)):n===a&&(S.scale(Ft,S.sub(Ft,this.value.p3,this.value.p2),i),S.add(this.value.p4,this.value.p3,Ft)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),kd=S.fromArray,Lp=S.toArray,OP=S.normalize,Awe=S.sub,Np=S.spline,Twe=S.slerp,i9=S.copy,o9=S.cross,kP=S.orthogonalize,Pwe=S.matchDirection,Ewe=S.scale,s9=S.add;function LP(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function NP(e,t,r,n){Iwe(e,t,r,n),Mwe(e,t)}var UP=S(),zP=S(),VP=S();function Iwe(e,t,r,n){for(var a=e.curvePoints,i=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,c=t.p2,l=t.p3,f=t.p4,d=t.secStrucFirst,m=t.secStrucLast,p=1-n,v=d?.5:r,h=m?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<p){var b=Xn(v,r,y);Np(VP,s,u,c,l,y+n,b),Np(UP,s,u,c,l,y+n+.01,v),Np(zP,s,u,c,l,y+n-.01,v)}else{var b=Xn(r,h,y);Np(VP,u,c,l,f,y-p,b),Np(UP,u,c,l,f,y-p+.01,b),Np(zP,u,c,l,f,y-p-.01,b)}Lp(VP,a,g*3),OP(Jl,Awe(Jl,UP,zP)),Lp(Jl,i,g*3)}}var Dwe=S(),Jl=S(),Fs=S(),Up=S(),I0=S(),u9=S(),c9=S(),l9=S(),GP=S(),B2=S();function Mwe(e,t){var r=e.curvePoints,n=e.tangentVectors,a=e.normalVectors,i=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;kd(c9,n,0),kd(l9,n,(u-1)*3),kP(GP,c9,o),kP(B2,l9,s),Pwe(B2,B2,GP),i9(I0,GP);for(var c=u-1,l=0;l<u;++l){var f=J5(0,c,l)*c,d=l===0?0:1/(u-f);kd(Jl,n,l*3),kP(Fs,Jl,Twe(Dwe,I0,B2,d)),Lp(Fs,a,l*3),i9(I0,Fs),OP(Up,o9(Up,Jl,Fs)),Lp(Up,i,l*3)}for(var l=1;l<c;++l)kd(I0,a,(l-1)*3),kd(Fs,a,l*3),kd(u9,a,(l+1)*3),Ewe(Fs,s9(Fs,I0,s9(Fs,u9,Fs)),1/3),Lp(Fs,a,l*3),kd(Jl,n,l*3),OP(Up,o9(Up,Jl,Fs)),Lp(Up,i,l*3)}function HP(e,t,r,n,a,i,o,s){for(var u=e.widthValues,c=e.heightValues,l=e.linearSegments,f=1-s,d=0;d<=l;++d){var m=d*1/l;m<f?(u[d]=Xn(t,r,m+s),c[d]=Xn(a,i,m+s)):(u[d]=Xn(r,n,m-f),c[d]=Xn(i,o,m-f))}}var f9=.5,Rwe=.9,F2=.5,O2=.3,k2=2;function D0(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function d9(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var Dc;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].polymerElements,o=i.length,s=n.units.length,u=Qe.create(a),c=function(l,f){var d=n.units[f];return u.unit=d,u.element=i[l],u};return Wr(o,s,1,c)}e.fromGroup=t})(Dc||(Dc={}));var qP;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0].gapElements,o=i.length,s=n.units.length,u=Qe.create(a),c=function(l,f){var d=n.units[f];return u.unit=d,u.element=i[l],u};return Wr(o,s,1,c)}e.fromGroup=t})(qP||(qP={}));function Ld(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Re.isAtomic(u))return q7(o,u,u.polymerElements[i]);var c=u.elements,l=u.polymerElements[i],f=De.indexOf(c,l);if(f!==-1){var d=De.ofSingleton(f);return _e(o,[{unit:u,indices:d}])}}return ur}function m9(e,t,r,n,a,i){for(var o=-1,s=-1,u=a;u<=i;u++){var c=r[u];if(!(c<0)&&(o=De.indexOf(t,c),o>=0)){s=u;break}}if(o<0)return!1;for(var l=o,u=i;u>s;u--){var c=r[u];if(!(c<0)){var f=De.indexOf(t,c);if(f>=0){l=f;break}}}return n(Se.ofRange(e+o,e+l))}function p9(e,t,r,n,a){var i=!1,o=a.unit.elements,s=a.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=a.unit.model.atomicHierarchy.residueAtomSegments.index,c=r(a.unit);if(Se.is(a.indices))if(Se.start(a.indices)===0&&Se.end(a.indices)===a.unit.elements.length)i=n(Se.ofBounds(e,e+t))||i;else{var l=u[o[Se.min(a.indices)]],f=u[o[Se.max(a.indices)]];i=m9(e,c,s,n,l,f)||i}else for(var d=a.indices,m=0,p=d.length;m<p;m++){for(var l=u[o[d[m]]],f=l,v=m+1;v<p;){var h=u[o[d[v]]];if(h-f>1)break;f=h,v++}m=v-1,i=m9(e,c,s,n,l,f)||i}return i}function Bwe(e){return e.polymerElements}function Nd(e,t,r){var n=!1;if(!_e.is(e))return!1;var a=t.structure,i=t.group;if(!ke.areEquivalent(e.structure,a))return!1;for(var o=i.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s];if(!!i.unitIndexMap.has(c.unit.id)){var l=i.unitIndexMap.get(c.unit.id)*o;if(Re.isAtomic(c.unit))n=p9(l,o,Bwe,r,c)||n;else if(Se.is(c.indices)){var f=l+Se.start(c.indices),d=l+Se.end(c.indices);n=r(Se.ofBounds(f,d))||n}else for(var m=0,p=c.indices.length;m<p;m++){for(var f=c.indices[m],v=m+1;v<p&&c.indices[v]===f;)v++;m=v-1;var d=c.indices[m];n=r(Se.ofRange(l+f,l+d))||n}}}return n}function Fwe(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a],c=De.indexOf(u.elements,u.gapElements[i]),l=De.indexOf(u.elements,u.gapElements[i%2?i-1:i+1]);if(c!==-1&&l!==-1)return Pt.Loci(o,[Pt.Location(o,u,c,o,u,l),Pt.Location(o,u,l,o,u,c)])}return ur}function Owe(e,t,r){var n=!1;if(Pt.isLoci(e)){var a=t.structure,i=t.group;if(!ke.areRootsEquivalent(e.structure,a))return!1;e=Pt.remapLoci(e,a);for(var o=i.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.aUnit.id);if(l!==void 0){var f=De.indexOf(c.aUnit.gapElements,c.aUnit.elements[c.aIndex]),d=De.indexOf(c.bUnit.gapElements,c.bUnit.elements[c.bIndex]);f!==-1&&d!==-1&&r(Se.ofSingleton(l*o+f))&&(n=!0)}}}else if(_e.is(e)){var a=t.structure,i=t.group;if(!ke.areRootsEquivalent(e.structure,a))return!1;e=_e.remap(e,a);for(var m=i.units[0].gapElements.length,p=function(x){var C=i.unitIndexMap.get(x.unit.id);C!==void 0&&De.forEach(x.indices,function(_){var w=De.indexOf(x.unit.gapElements,x.unit.elements[_]);w!==-1&&r(Se.ofSingleton(C*m+w))&&(n=!0)})},v=0,h=e.elements;v<h.length;v++){var g=h[v];p(g)}}return n}var L2;(function(e){function t(r){var n=r.group,a=r.structure,i=n.units[0],o=Re.isAtomic(i)?i.nucleotideElements:[],s=o.length,u=n.units.length,c=Qe.create(a),l=function(f,d){var m=n.units[d];return c.unit=m,c.element=o[f],c};return Wr(s,u,1,l)}e.fromGroup=t})(L2||(L2={}));function v9(e,t,r){var n=e.objectId,a=e.instanceId,i=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[a];if(Re.isAtomic(u))return q7(o,u,u.nucleotideElements[i])}return ur}function kwe(e){return e.nucleotideElements}function h9(e,t,r){var n=!1;if(!_e.is(e))return!1;var a=t.structure,i=t.group;if(!ke.areEquivalent(e.structure,a))return!1;var o=i.units[0];if(!Re.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,c=0,l=e.elements;c<l.length;c++){var f=l[c];if(!!Re.isAtomic(f.unit)&&!!i.unitIndexMap.has(f.unit.id)){var d=i.unitIndexMap.get(f.unit.id)*u;Re.isAtomic(f.unit)&&(n=p9(d,u,kwe,r,f)||n)}}return n}var M0=S(),N2=S(),g9=S(),y9=S(),b9=S(),x9=S(),U2=S(),jP=S(),WP=S(),S9=S(),R0=se.identity(),Lwe=S(),C9=z_(),_9={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo)};P.getDefaultValues(_9);function Nwe(e,t,r,n,a,i){if(!Re.isAtomic(t))return At.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=o*(C9.vertices.length/3+u*2),l=it.createState(c,c/4,i),f=t.elements,d=t.model,m=d.atomicHierarchy,p=m.chainAtomSegments,v=m.residueAtomSegments,h=m.atoms,g=m.index,y=d.atomicHierarchy.derived.residue,b=y.moleculeType,x=y.traceElementIndex,C=h.label_comp_id,_=t.conformation.invariantPosition,w=qt.transientSegments(p,f),T=qt.transientSegments(v,f),A={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;w.hasNext;)for(T.setSegment(w.move());T.hasNext;){var E=T.move().index;if(iu(b[E])){var M=C.value(v.offsets[E]),F=-1,O=-1,U=-1,N=-1,q=-1,j=-1,Q=4.5,J=2.5*s,te=4.5,K=_O(M),L=wO(M);if(!K&&!L){var W=g.findAtomOnResidue(E,"C4"),k=g.findAtomOnResidue(E,"N9");W!==-1&&k!==-1&&S.distance(_(W,M0),_(k,N2))<1.6?K=!0:L=!0}K?(te=4.5,F=g.findAtomOnResidue(E,"N1"),O=g.findAtomOnResidue(E,"C4"),U=g.findAtomOnResidue(E,"C6"),N=g.findAtomOnResidue(E,"C2"),q=g.findAtomOnResidue(E,"N9"),j=x[E]):L&&(te=3,F=g.findAtomOnResidue(E,"N3"),O=g.findAtomOnResidue(E,"C6"),U=g.findAtomOnResidue(E,"C4"),N=g.findAtomOnResidue(E,"C2"),q=g.findAtomOnResidue(E,"N1"),q===-1&&(q=g.findAtomOnResidue(E,"C1")),j=x[E]),q!==-1&&j!==-1&&(_(q,b9),_(j,x9),l.currentGroup=D,la(l,b9,x9,1,A),F!==-1&&O!==-1&&U!==-1&&N!==-1&&(_(F,M0),_(O,N2),_(U,g9),_(N,y9),S.normalize(U2,S.sub(U2,N2,M0)),S.normalize(jP,S.sub(jP,y9,g9)),S.normalize(WP,S.cross(WP,U2,jP)),se.targetTo(R0,M0,N2,WP),S.scaleAndAdd(S9,M0,U2,te/2-.2),se.scale(R0,R0,S.set(Lwe,Q,J,te)),se.setTranslation(R0,S9),it.addPrimitive(l,R0,C9))),++D}}var V=it.getMesh(l),G=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return V.setBoundingSphere(G),V}var w9=I(I({},Na),_9);function Uwe(e){return xi({defaultProps:P.getDefaultValues(w9),createGeometry:Nwe,createLocationIterator:L2.fromGroup,getLoci:v9,eachLocation:h9,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var z2=S.zero(),ef=S.zero(),V2=S.zero(),G2=S.zero(),Ud=S.zero(),zp=S.zero(),H2=S.zero(),A9=S.zero(),T9=S.zero(),B0=S.zero(),tf=S.zero(),P9={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo)};P.getDefaultValues(P9);var q2=new Float32Array(2*9*3),zwe=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Vwe=new Uint32Array([8,12,14,16,6,4,2,0,10]),Gwe=new Uint32Array([9,11,1,3,5,7,17,15,13]),j2=new Float32Array(2*6*3),Hwe=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),qwe=new Uint32Array([0,10,8,6,4,2]),jwe=new Uint32Array([1,3,5,7,9,11]),E9=S.zero();function I9(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var a=0,i=r.length;a<i;++a){var o=r[a];S.toArray(S.add(E9,o,t),e,a*2*3),S.toArray(S.sub(E9,o,t),e,(a*2+1)*3)}}function Wwe(e,t,r,n,a,i){if(!Re.isAtomic(t))return At.createEmpty(i);var o=t.nucleotideElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=a.detail,l=o*(26+u*2),f=it.createState(l,l/4,i),d=t.elements,m=t.model,p=m.atomicHierarchy,v=p.chainAtomSegments,h=p.residueAtomSegments,g=p.atoms,y=p.index,b=m.atomicHierarchy.derived.residue,x=b.moleculeType,C=b.traceElementIndex,_=g.label_comp_id,w=t.conformation.invariantPosition,T=qt.transientSegments(v,d),A=qt.transientSegments(h,d),D=1*s,E=1.25*s,M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},F=0;T.hasNext;)for(A.setSegment(T.move());A.hasNext;){var O=A.move().index;if(iu(x[O])){var U=_.value(h.offsets[O]),N=-1,q=-1,j=-1,Q=-1,J=-1,te=-1,K=-1,L=-1,W=-1,k=-1;f.currentGroup=F;var V=_O(U),G=wO(U);if(!V&&!G){var H=y.findAtomOnResidue(O,"C4"),X=y.findAtomOnResidue(O,"N9");H!==-1&&X!==-1&&S.distance(w(H,Ud),w(X,B0))<1.6?V=!0:G=!0}V?(N=C[O],q=y.findAtomOnResidue(O,"N1"),j=y.findAtomOnResidue(O,"C2"),Q=y.findAtomOnResidue(O,"N3"),J=y.findAtomOnResidue(O,"C4"),te=y.findAtomOnResidue(O,"C5"),te===-1&&(te=y.findAtomOnResidue(O,"N5")),K=y.findAtomOnResidue(O,"C6"),L=y.findAtomOnResidue(O,"N7"),L===-1&&(L=y.findAtomOnResidue(O,"C7")),W=y.findAtomOnResidue(O,"C8"),k=y.findAtomOnResidue(O,"N9"),k!==-1&&N!==-1&&(w(k,B0),w(N,z2),f.currentGroup=F,la(f,B0,z2,1,M),Kn(f,B0,D,c)),q!==-1&&j!==-1&&Q!==-1&&J!==-1&&te!==-1&&K!==-1&&L!==-1&&W!==-1&&k!==-1&&(w(q,ef),w(j,V2),w(Q,G2),w(J,Ud),w(te,zp),w(K,H2),w(L,A9),w(W,T9),S.triangleNormal(tf,ef,Ud,zp),S.scale(tf,tf,E),I9(q2,tf,ef,V2,G2,Ud,zp,H2,A9,T9,B0),it.addTriangleStrip(f,q2,zwe),it.addTriangleFan(f,q2,Vwe),it.addTriangleFan(f,q2,Gwe))):G&&(N=C[O],q=y.findAtomOnResidue(O,"N1"),q===-1&&(q=y.findAtomOnResidue(O,"C1")),j=y.findAtomOnResidue(O,"C2"),Q=y.findAtomOnResidue(O,"N3"),J=y.findAtomOnResidue(O,"C4"),te=y.findAtomOnResidue(O,"C5"),K=y.findAtomOnResidue(O,"C6"),q!==-1&&N!==-1&&(w(q,ef),w(N,z2),f.currentGroup=F,la(f,ef,z2,1,M),Kn(f,ef,D,c)),q!==-1&&j!==-1&&Q!==-1&&J!==-1&&te!==-1&&K!==-1&&(w(j,V2),w(Q,G2),w(J,Ud),w(te,zp),w(K,H2),S.triangleNormal(tf,ef,Ud,zp),S.scale(tf,tf,E),I9(j2,tf,ef,V2,G2,Ud,zp,H2),it.addTriangleStrip(f,j2,Hwe),it.addTriangleFan(f,j2,qwe),it.addTriangleFan(f,j2,jwe))),++F}}var Y=it.getMesh(f),oe=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return Y.setBoundingSphere(oe),Y}var D9=I(I({},Na),P9);function Xwe(e){return xi({defaultProps:P.getDefaultValues(D9),createGeometry:Wwe,createLocationIterator:L2.fromGroup,getLoci:v9,eachLocation:h9,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var zd=S.zero(),Vp=S.zero(),Vd=S.zero(),M9=S.zero(),ra=$s(3,!1);function Ywe(){for(var e=Zm(8),t=0;t<3;++t){var r=(t+1)%3;S.set(zd,ra[t*3],ra[t*3+1],-.5),S.set(Vp,ra[r*3],ra[r*3+1],-.5),S.set(Vd,ra[r*3],ra[r*3+1],.5),S.set(M9,ra[t*3],ra[t*3+1],.5),e.add(zd,Vp,Vd),e.add(Vd,M9,zd)}return S.set(zd,ra[0],ra[1],-.5),S.set(Vp,ra[3],ra[4],-.5),S.set(Vd,ra[6],ra[7],-.5),e.add(Vd,Vp,zd),S.set(zd,ra[0],ra[1],.5),S.set(Vp,ra[3],ra[4],.5),S.set(Vd,ra[6],ra[7],.5),e.add(zd,Vp,Vd),e.getPrimitive()}var XP;function Kwe(){return XP||(XP=Ywe()),XP}var Gd=se.identity(),Qwe=S.zero(),R9=S.zero(),B9=S.zero(),YP=S.zero(),Zwe=4,$we=4,Jwe=6,eAe=Kwe(),F9={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01})};P.getDefaultValues(F9);function tAe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=o*24,c=it.createState(u,u/10,i),l=1,f=LP(l),d=f.normalVectors,m=f.binormalVectors,p=0,v=FP(t,r);v.hasNext;){var h=v.move();c.currentGroup=p;var g=iu(h.moleculeType),y=yr.is(h.secStrucType,4),b=g||y?.5:.9,x=g?.3:.5;if(NP(f,h,b,x),y&&!h.secStrucLast||!y){var C=n.size.size(h.center)*s,_=Zwe*C,w=$we*C,T=Jwe*C,A=g?m:d;S.fromArray(R9,A,0),S.fromArray(B9,A,3),S.normalize(YP,S.add(YP,R9,B9)),se.targetTo(Gd,h.p3,h.p1,YP),se.mul(Gd,Gd,se.rotY90Z180),se.scale(Gd,Gd,S.set(Qwe,T,w,_)),se.setTranslation(Gd,h.p2),it.addPrimitive(c,Gd,eAe)}++p}var D=it.getMesh(c),E=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return D.setBoundingSphere(E),D}var O9=I(I({},Na),F9);function rAe(e){return xi({defaultProps:P.getDefaultValues(O9),createGeometry:tAe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var KP=10,k9={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo)};P.getDefaultValues(k9);function nAe(e,t,r,n,a,i){var o=t.gapElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=a.radialSegments,c=KP*u*2*o*2,l=it.createState(c,c/10,i),f=t.conformation.invariantPosition,d=S.zero(),m=S.zero(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},v=0,h=ywe(r,t);h.hasNext;){var g=h.move(),y=g.centerA,b=g.centerB;y.element===b.element||(f(y.element,d),f(b.element,m),p.radiusTop=p.radiusBottom=n.size.size(y)*s,l.currentGroup=v,Ph(l,d,m,.5,KP,p),p.radiusTop=p.radiusBottom=n.size.size(b)*s,l.currentGroup=v+1,Ph(l,m,d,.5,KP,p)),v+=2}var x=it.getMesh(l),C=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return x.setBoundingSphere(C),x}var W2=I(I({},Na),k9);function QP(e){return xi({defaultProps:P.getDefaultValues(W2),createGeometry:nAe,createLocationIterator:qP.fromGroup,getLoci:Fwe,eachLocation:Owe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var dr=S(),Pr=S(),aAe=S(),mo=S(),gu=S(),X2=S(),Y2=S(),F0=S(),Os=S(),yu=S(),ZP=S(),rf=S(),nf=S(),af=S(),of=S(),$o=S.fromArray,Gp=S.scale,Jo=S.add,Mc=S.sub,iAe=S.magnitude,L9=S.negate,$P=S.copy,N9=S.cross,oAe=S.set,Dr=Me.add3,sAe=Me.add;function K2(e,t,r,n,a,i,o,s,u){var c=t.vertices,l=t.normals,f=t.indices,d=c.elementCount;if($o(dr,n,e),Gp(Y2,dr,o),Gp(X2,dr,s),$o(Pr,a,e),Gp(mo,Pr,i),N9(yu,Pr,dr),$o(Os,r,e),Jo(rf,Jo(rf,Os,mo),X2),Mc(nf,Jo(nf,Os,mo),Y2),Mc(af,Mc(af,Os,mo),Y2),Jo(of,Mc(of,Os,mo),X2),o<s?(Dr(c,of[0],of[1],of[2]),Dr(c,af[0],af[1],af[2]),Dr(c,nf[0],nf[1],nf[2]),Dr(c,rf[0],rf[1],rf[2]),$P(gu,X2)):(Dr(c,rf[0],rf[1],rf[2]),Dr(c,nf[0],nf[1],nf[2]),Dr(c,af[0],af[1],af[2]),Dr(c,of[0],of[1],of[2]),$P(gu,Y2)),u){for(var m=0;m<4;++m)Dr(l,-yu[0],-yu[1],-yu[2]);Dr(f,d,d+1,d+2),Dr(f,d+2,d+3,d)}else{for(var m=0;m<4;++m)Dr(l,yu[0],yu[1],yu[2]);Dr(f,d+2,d+1,d),Dr(f,d,d+3,d+2)}}function Q2(e,t,r,n,a,i,o,s,u,c){var l=e.currentGroup,f=e.vertices,d=e.normals,m=e.indices,p=e.groups,v=f.elementCount,h=0;s>0?($o(dr,t,0),$o(Pr,t,a*3),h=s/iAe(Mc(aAe,Pr,dr))):oAe(F0,0,0,0);for(var g=0;g<=a;++g){var y=i[g],b=o[g],x=s===0?b:s*(1-g/a),C=g*3;$o(gu,r,C),Gp(gu,gu,x),$o(mo,n,C),Gp(mo,mo,y),s>0&&($o(dr,r,C),$o(Pr,n,C),Gp(F0,N9(F0,dr,Pr),h)),$o(Os,t,C),$o(yu,r,C),$o(ZP,n,C),Jo(dr,Jo(dr,Os,mo),gu),Jo(Pr,yu,F0),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),Jo(dr,Mc(dr,Os,mo),gu),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),L9(Pr,ZP),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),Mc(dr,Mc(dr,Os,mo),gu),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),Jo(Pr,L9(Pr,yu),F0),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),Mc(dr,Jo(dr,Os,mo),gu),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),$P(Pr,ZP),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2]),Jo(dr,Jo(dr,Os,mo),gu),Dr(f,dr[0],dr[1],dr[2]),Dr(d,Pr[0],Pr[1],Pr[2])}for(var g=0;g<a;++g){for(var _=0;_<2;_++)Dr(m,v+g*8+2*_,v+(g+1)*8+2*_+1,v+g*8+2*_+1),Dr(m,v+g*8+2*_,v+(g+1)*8+2*_,v+(g+1)*8+2*_+1);for(var _=2;_<4;_++)Dr(m,v+g*8+2*_,v+(g+1)*8+2*_,v+g*8+2*_+1),Dr(m,v+(g+1)*8+2*_,v+(g+1)*8+2*_+1,v+g*8+2*_+1)}if(u){var y=i[0],b=o[0],w=s===0?b:s;K2(0,e,t,r,n,y,w,w,!1)}else if(s>0){var y=i[0],b=o[0];K2(0,e,t,r,n,y,s,-b,!1),K2(0,e,t,r,n,y,-s,b,!1)}if(c&&s===0){var y=i[a],b=o[a];K2(a*3,e,t,r,n,y,b,b,!0)}for(var T=(a+1)*8+(u?4:s>0?8:0)+(c&&s===0?4:0),g=0,A=T;g<A;++g)sAe(p,l)}var Dn=S(),qn=S(),Si=S(),Aa=S(),ai=S();function Z2(e,t,r,n,a){e[0]=t[0]*n+r[0]*a,e[1]=t[1]*n+r[1]*a,e[2]=t[2]*n+r[2]*a}function Hp(e,t,r,n,a,i){e[0]=t[0]*a+r[0]*i+n[0],e[1]=t[1]*a+r[1]*i+n[1],e[2]=t[2]*a+r[2]*i+n[2]}var Rc=S.fromArray,uAe=S.normalize,JP=S.scaleAndAdd,U9=S.cross,cAe=S.dot,lAe=S.unitX,ii=Me.add3,e4=new Map;function fAe(e,t){var r=t?1:0,n=To(e,r);if(!e4.has(n)){for(var a=[],i=[],o=0;o<e;++o){var s=(o*2+r)/e*Math.PI;a[o]=Math.cos(s),i[o]=Math.sin(s)}e4.set(n,{cos:a,sin:i})}return e4.get(n)}function t4(e,t,r,n,a,i,o,s,u,c,l){for(var f=e.currentGroup,d=e.vertices,m=e.normals,p=e.indices,v=e.groups,h=d.elementCount,g=fAe(i,l==="rounded"),y=g.cos,b=g.sin,x=Math.round(i/4),C=x*3,_=0;_<=a;++_){var w=_*3;Rc(Aa,r,w),Rc(ai,n,w),Rc(Si,t,w);for(var T=o[_],A=s[_],D=l==="rounded"&&A>T,E=0;E<i;++E){if(D){Hp(qn,Aa,ai,Si,T*y[E],T*b[E]);var M=cAe(ai,lAe)<0?E<x||E>=C?A-T:-A+T:E>=x&&E<C?-A+T:A-T;JP(qn,qn,Aa,M),E===x||E===x-1?Z2(Dn,Aa,ai,0,1):E===C||E===C-1?Z2(Dn,Aa,ai,0,-1):Z2(Dn,Aa,ai,y[E],b[E])}else Hp(qn,Aa,ai,Si,A*y[E],T*b[E]),Z2(Dn,Aa,ai,T*y[E],A*b[E]);uAe(Dn,Dn),ii(d,qn[0],qn[1],qn[2]),ii(m,Dn[0],Dn[1],Dn[2])}}for(var F=Math.round(i/2),_=0;_<a;++_){for(var E=0;E<F;++E)ii(p,h+_*i+(E+1)%i,h+(_+1)*i+(E+1)%i,h+_*i+E),ii(p,h+(_+1)*i+(E+1)%i,h+(_+1)*i+E,h+_*i+E);for(var E=F;E<i;++E)ii(p,h+_*i+(E+1)%i,h+(_+1)*i+E,h+_*i+E),ii(p,h+(_+1)*i+(E+1)%i,h+(_+1)*i+E,h+_*i+(E+1)%i)}if(u){var O=0,U=d.elementCount;Rc(Aa,r,O),Rc(ai,n,O),Rc(Si,t,O),U9(Dn,ai,Aa),ii(d,Si[0],Si[1],Si[2]),ii(m,Dn[0],Dn[1],Dn[2]);var T=o[0],A=s[0],D=l==="rounded"&&A>T;D&&(A-=T),h=d.elementCount;for(var _=0;_<i;++_)D?(Hp(qn,Aa,ai,Si,T*y[_],T*b[_]),JP(qn,qn,Aa,_<x||_>=C?A:-A)):Hp(qn,Aa,ai,Si,A*y[_],T*b[_]),ii(d,qn[0],qn[1],qn[2]),ii(m,Dn[0],Dn[1],Dn[2]),ii(p,h+(_+1)%i,h+_,U)}if(c){var O=a*3,U=d.elementCount;Rc(Aa,r,O),Rc(ai,n,O),Rc(Si,t,O),U9(Dn,Aa,ai),ii(d,Si[0],Si[1],Si[2]),ii(m,Dn[0],Dn[1],Dn[2]);var T=o[a],A=s[a],D=l==="rounded"&&A>T;D&&(A-=T),h=d.elementCount;for(var _=0;_<i;++_)D?(Hp(qn,Aa,ai,Si,T*y[_],T*b[_]),JP(qn,qn,Aa,_<x||_>=C?A:-A)):Hp(qn,Aa,ai,Si,A*y[_],T*b[_]),ii(d,qn[0],qn[1],qn[2]),ii(m,Dn[0],Dn[1],Dn[2]),ii(p,h+_,h+(_+1)%i,U)}var N=(a+1)*i+(u?i+1:0)+(c?i+1:0);Me.addRepeat(v,N,f)}var Bc=S.fromArray,dAe=S.magnitude,r4=S.sub,z9=S.add,n4=S.scale,mAe=S.negate,pAe=S.copy,vAe=S.cross,es=Me.add3,hAe=Me.add,na=S(),Ta=S(),gAe=S(),a4=S(),Hd=S(),V9=S(),O0=S(),yAe=S(),i4=S();function $2(e,t,r,n,a,i,o,s){var u=e.currentGroup,c=e.vertices,l=e.normals,f=e.indices,d=e.groups,m=c.elementCount,p=0;s>0&&(Bc(na,t,0),Bc(Ta,t,a*3),p=s/dAe(r4(gAe,Ta,na)));for(var v=0;v<=a;++v){var h=i[v],g=o[v],y=s===0?g:s*(1-v/a),b=v*3;Bc(Hd,r,b),n4(Hd,Hd,y),Bc(a4,n,b),n4(a4,a4,h),s>0&&(Bc(na,r,b),Bc(Ta,n,b),n4(V9,vAe(V9,na,Ta),p)),Bc(O0,t,b),Bc(yAe,r,b),Bc(i4,n,b),z9(na,O0,Hd),mAe(Ta,i4),es(c,na[0],na[1],na[2]),es(l,Ta[0],Ta[1],Ta[2]),r4(na,O0,Hd),es(c,na[0],na[1],na[2]),es(l,Ta[0],Ta[1],Ta[2]),z9(na,O0,Hd),pAe(Ta,i4),es(c,na[0],na[1],na[2]),es(l,Ta[0],Ta[1],Ta[2]),r4(na,O0,Hd),es(c,na[0],na[1],na[2]),es(l,Ta[0],Ta[1],Ta[2])}for(var v=0;v<a;++v)es(f,m+v*4,m+(v+1)*4+1,m+v*4+1),es(f,m+v*4,m+(v+1)*4,m+(v+1)*4+1),es(f,m+v*4+2+1,m+(v+1)*4+2+1,m+v*4+2),es(f,m+v*4+2,m+(v+1)*4+2+1,m+(v+1)*4+2);for(var x=(a+1)*4,v=0,C=x;v<C;++v)hAe(d,u)}var G9={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:P.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:P.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:P.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:P.Select("elliptical",P.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein and nucleic helix trace profile"}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),linearSegments:P.Numeric(8,{min:1,max:48,step:1},Je.CustomQualityParamInfo),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo)};P.getDefaultValues(G9);var Gi=S();function bAe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,f=a.aspectRatio,d=a.arrowFactor,m=a.tubularHelices,p=a.helixProfile,v=c*l*o+(l+1)*o*2,h=it.createState(v,v/10,i),g=Re.isCoarse(t),y=LP(c),b=y.curvePoints,x=y.normalVectors,C=y.binormalVectors,_=y.widthValues,w=y.heightValues,T=0,A=FP(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:m});A.hasNext;){var D=A.move();h.currentGroup=T;var E=iu(D.moleculeType),M=yr.is(D.secStrucType,4),F=yr.is(D.secStrucType,2),O=F&&!m?Rwe:f9,U=E?O2:F2;NP(y,D,O,U);var N=n.size.size(D.centerPrev)*s,q=n.size.size(D.center)*s,j=n.size.size(D.centerNext)*s;g&&(N*=f/2,q*=f/2,j*=f/2);var Q=D.secStrucFirst||D.coarseBackboneFirst||D.first,J=D.secStrucLast||D.coarseBackboneLast||D.last,te=c;if(D.initial){te=Math.max(Math.round(c*U),1);var K=c-te;b.copyWithin(0,K*3),C.copyWithin(0,K*3),x.copyWithin(0,K*3),S.fromArray(Gi,b,3),S.normalize(Gi,S.sub(Gi,D.p2,Gi)),S.scaleAndAdd(Gi,D.p2,Gi,q*k2),S.toArray(Gi,b,0)}else D.final&&(te=Math.max(Math.round(c*(1-U)),1),S.fromArray(Gi,b,te*3-3),S.normalize(Gi,S.sub(Gi,D.p2,Gi)),S.scaleAndAdd(Gi,D.p2,Gi,q*k2),S.toArray(Gi,b,te*3));if(D.initial===!0&&D.final===!0)Kn(h,D.p2,q*2,u);else if(M){var L=N*f,W=q*f,k=j*f,V=D.secStrucLast?W*d:0;HP(y,N,q,j,L,W,k,U),l===2?$2(h,b,x,C,te,_,w,V):Q2(h,b,x,C,te,_,w,V,Q,J)}else{var L=void 0,W=void 0,k=void 0;F&&!D.isCoarseBackbone?m?(N*=f*1.5,q*=f*1.5,j*=f*1.5,L=N,W=q,k=j):(L=N*f,W=q*f,k=j*f):E&&!D.isCoarseBackbone?(L=N*f,W=q*f,k=j*f):(L=N,W=q,k=j),HP(y,N,q,j,L,W,k,U);var G=E&&!D.isCoarseBackbone?[C,x]:[x,C],H=G[0],X=G[1];if(E&&!D.isCoarseBackbone)for(var Y=0,oe=H.length;Y<oe;Y++)H[Y]*=-1;l===2?E&&!D.isCoarseBackbone?$2(h,b,H,X,te,w,_,0):$2(h,b,H,X,te,_,w,0):l===4?Q2(h,b,H,X,te,_,w,0,Q,J):W===q?t4(h,b,H,X,te,l,_,w,Q,J,"elliptical"):p==="square"?Q2(h,b,H,X,te,_,w,0,Q,J):t4(h,b,H,X,te,l,_,w,Q,J,p)}++T}var ue=it.getMesh(h),me=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return ue.setBoundingSphere(me),ue}var H9=I(I({},Na),G9);function xAe(e){return xi({defaultProps:P.getDefaultValues(H9),createGeometry:bAe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile;var u=zo.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=t.info.secondaryStructureHash!==void 0,t.info.secondaryStructureHash=u)}},e)}var q9={"polymer-trace":function(e,t){return sn("Polymer trace mesh",e,t,xAe)},"polymer-gap":function(e,t){return sn("Polymer gap cylinder",e,t,QP)},"nucleotide-block":function(e,t){return sn("Nucleotide block mesh",e,t,Uwe)},"nucleotide-ring":function(e,t){return sn("Nucleotide ring mesh",e,t,Xwe)},"direction-wedge":function(e,t){return sn("Polymer direction wedge",e,t,rAe)}},j9=I(I(I(I(I(I({},H9),W2),w9),D9),O9),{sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),visuals:P.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],P.objectToOptions(q9)),bumpFrequency:P.Numeric(2,{min:0,max:10,step:.1},Je.ShadingCategory)});function SAe(e,t){var r=P.clone(j9),n=!1,a=!1;return t.units.forEach(function(i){!n&&Re.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function CAe(e,t){return Vt.createMulti("Cartoon",e,t,ta,q9)}var _Ae=ri({name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:CAe,getParams:SAe,defaultValues:P.getDefaultValues(j9),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ie(void 0,void 0,void 0,function(){var r,n,a;return ae(this,function(i){switch(i.label){case 0:return[4,zo.attach(e,t,void 0,!0)];case 1:i.sent(),r=0,n=t.models,i.label=2;case 2:return r<n.length?(a=n[r],[4,BP.attach(e,a,void 0,!0)]):[3,5];case 3:i.sent(),i.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){zo.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];BP.ref(n,!1)}}}}),W9=I(I({},Na),{sizeFactor:P.Numeric(1,{min:0,max:10,step:.1}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),ignoreHydrogens:P.Boolean(!1)});function wAe(e){return xi({defaultProps:P.getDefaultValues(W9),createGeometry:AAe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function AAe(e,t,r,n,a,i){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return At.createEmpty(i);var u=a.detail,c=a.sizeFactor,l=a.ignoreHydrogens,f=t.elements,d=t.model,m=t.model.atomicHierarchy.derived.atom.atomicNumber,p=f.length,v=p*b1(u),h=it.createState(v,v/2,i),g=fu.Provider.get(d);if(!g)return At.createEmpty(i);var y=S(),b=dn(),x=S(),C=S(),_=S(),w=g.elementToAnsiotrop,T=g.data,A=T.U,D=T._schema.U.space,E=t.conformation.invariantPosition,M=Qe.create(r);M.unit=t;for(var F=0;F<p;F++){var O=f[F],U=w[O];if(U!==-1&&!(!!s&&!Le.has(s.elements,O)||l&&Qb(m,O))){M.element=O,E(O,y),h.currentGroup=F,sr.toMat3(b,D,A.value(U)),dn.symmtricFromLower(b,b),dn.symmetricEigenvalues(x,b),dn.eigenvector(C,b,x[1]),dn.eigenvector(_,b,x[2]);for(var N=0;N<3;++N)x[N]=c*1.5958*Math.sqrt(Math.abs(x[N]));qr(x[0],x[1],Ir)&&qr(x[1],x[2],Ir)?Kn(h,y,x[0],u):BA(h,y,_,C,x,u)}}var q=it.getMesh(h),j=Te.expand(Te(),(s||t).boundary.sphere,1*c);return q.setBoundingSphere(j),q}var X9={"ellipsoid-mesh":function(e,t){return sn("Ellipsoid Mesh",e,t,wAe)},"intra-bond":function(e,t){return sn("Intra-unit bond cylinder",e,t,Rz)},"inter-bond":function(e,t){return Ps("Inter-unit bond cylinder",e,t,kz)}},Y9=I(I(I(I({},W9),C2),_2),{includeParent:P.Boolean(!1),adjustCylinderLength:P.Boolean(!1,{isHidden:!0}),unitKinds:v0(["atomic"]),sizeFactor:P.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:P.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:P.Boolean(!0),visuals:P.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],P.objectToOptions(X9)),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory)});function TAe(e,t){return P.clone(Y9)}function PAe(e,t){return Vt.createMulti("Ellipsoid",e,t,ta,X9)}var EAe=ri({name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:PAe,getParams:TAe,defaultValues:P.getDefaultValues(Y9),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return fu.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}}),IAe=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,DAe=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`,MAe={drawCount:xn("number"),instanceCount:xn("number"),aRadius:wr("float32",1,0),aPosition:wr("float32",3,0),aGroup:wr("float32",1,0),uCurrentSlice:Ee("f"),uCurrentX:Ee("f"),uCurrentY:Ee("f"),uBboxMin:Ee("v3","material"),uBboxSize:Ee("v3","material"),uGridDim:Ee("v3","material"),uGridTexDim:Ee("v3","material"),uGridTexScale:Ee("v2","material"),uAlpha:Ee("f","material"),uResolution:Ee("f","material"),uRadiusFactorInv:Ee("f","material"),tMinDistanceTex:Lt("texture","rgba","float","nearest"),dGridTexType:Ot("string",["2d","3d"]),dCalcType:Ot("string",["density","minDistance","groupId"])},bu="gaussian-density";function K9(e){return e.namedFramebuffers[bu]||(e.namedFramebuffers[bu]=e.resources.framebuffer()),e.namedFramebuffers[bu]}function Q9(e,t,r,n,a,i){var o="".concat(bu,"-").concat(e);return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,a,i)),t.namedTextures[o]}function Z9(e,t,r,n,a,i){return e.isWebGL2?RAe(e,t,r,n,a,i):o4(e,t,r,n,!1,a,i)}function o4(e,t,r,n,a,i,o){return $9(FAe(e,t,r,n,a,i,o))}function RAe(e,t,r,n,a,i){return $9(OAe(e,t,r,n,a,i))}function $9(e){var t=e.texture,r=e.scale,n=e.bbox,a=e.gridDim,i=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:BAe(r,n),texture:t,bbox:n,gridDim:a,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:u}}function BAe(e,t){var r=se.identity();return se.fromScaling(r,e),se.setTranslation(r,t.min),r}function FAe(e,t,r,n,a,i,o){var s=e.gl,u=e.resources,c=e.state,l=e.extensions,f=l.colorBufferFloat,d=l.textureFloat,m=l.colorBufferHalfFloat,p=l.textureHalfFloat,v=l.blendMinMax,h=i.smoothness,g=i.resolution,y=J9(t,r,n,i),b=y.drawCount,x=y.positions,C=y.radii,_=y.groups,w=y.scale,T=y.expandedBox,A=y.dim,D=y.maxRadius,E=A[0],M=A[1],F=A[2],O=LAe(A),U=O.texDimX,N=O.texDimY,q=O.texCols,j=O.powerOfTwoSize,Q=S.create(U,N,0),J=Fe.create(U/j,N/j),te=D*2,K=a?j:U,L=a?j:N,W=Q9("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");W.define(K,L);var k=eV(e,b,x,C,_,W,T,A,Q,J,h,g,te),V=k.values,G=V.uCurrentSlice,H=V.uCurrentX,X=V.uCurrentY,Y=K9(e);Y.bind(),tV(e),o||(o=m&&p?u.texture("image-float16","rgba","fp16","linear"):f&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(K,L);function oe(ue,me){c.currentRenderItemId=-1,ue.attachFramebuffer(Y,0),me&&(s.viewport(0,0,K,L),s.scissor(0,0,K,L),s.clear(s.COLOR_BUFFER_BIT)),R.update(X,0);for(var he=0,Pe=0,re=0,ee=0;ee<F;++ee)he>=q&&(he-=q,Pe+=M,re=0,R.update(X,Pe)),R.update(H,re),R.update(G,ee),s.viewport(re,Pe,E,M),s.scissor(re,Pe,E,M),k.render(),++he,re+=E;s.flush()}return nV(e,k),oe(o,!0),v&&(rV(e,k),oe(W,!0),aV(e,k),oe(o,!1)),{texture:o,scale:w,bbox:T,gridDim:A,gridTexDim:Q,gridTexScale:J,radiusFactor:te,resolution:g}}function OAe(e,t,r,n,a,i){var o=e.gl,s=e.resources,u=e.state,c=e.extensions,l=c.colorBufferFloat,f=c.textureFloat,d=c.colorBufferHalfFloat,m=c.textureHalfFloat,p=a.smoothness,v=a.resolution,h=J9(t,r,n,a),g=h.drawCount,y=h.positions,b=h.radii,x=h.groups,C=h.scale,_=h.expandedBox,w=h.dim,T=h.maxRadius,A=w[0],D=w[1],E=w[2],M=Q9("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");M.define(A,D,E);var F=Fe.create(1,1),O=T*2,U=eV(e,g,y,b,x,M,_,w,w,F,p,v,O),N=U.values.uCurrentSlice,q=K9(e);q.bind(),tV(e),o.viewport(0,0,A,D),o.scissor(0,0,A,D),i||(i=d&&m?s.texture("volume-float16","rgba","fp16","linear"):l&&f?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(A,D,E);function j(Q,J){u.currentRenderItemId=-1;for(var te=0;te<E;++te)R.update(N,te),Q.attachFramebuffer(q,0,te),J&&o.clear(o.COLOR_BUFFER_BIT),U.render();o.flush()}return nV(e,U),j(i,!0),rV(e,U),j(M,!0),aV(e,U),j(i,!1),{texture:i,scale:C,bbox:_,gridDim:w,gridTexDim:w,gridTexScale:F,radiusFactor:O,resolution:v}}function J9(e,t,r,n){for(var a=n.resolution,i=n.radiusOffset,o=1/a,s=e.indices,u=e.x,c=e.y,l=e.z,f=e.id,d=De.size(s),m=new Float32Array(d*3),p=new Float32Array(d),v=new Float32Array(d),h=0,g=0;g<d;++g){var y=De.getAt(s,g);m[g*3]=u[y],m[g*3+1]=c[y],m[g*3+2]=l[y];var b=r(y)+i;h<b&&(h=b),p[g]=b,v[g]=f?f[g]:g}var x=h*2+a*4,C=Bt.expand(Bt(),t,S.create(x,x,x)),_=Bt.scale(Bt(),C,o),w=Bt.size(S(),_);S.ceil(w,w);var T=S.create(a,a,a);return{drawCount:d,positions:m,radii:p,groups:v,scale:T,expandedBox:C,dim:w,maxRadius:h}}function eV(e,t,r,n,a,i,o,s,u,c,l,f,d){if(e.namedComputeRenderables[bu]){var m=S.sub(S(),o.max,o.min),p=e.namedComputeRenderables[bu].values;R.updateIfChanged(p.drawCount,t),R.updateIfChanged(p.instanceCount,1),R.update(p.aRadius,n),R.update(p.aPosition,r),R.update(p.aGroup,a),R.updateIfChanged(p.uCurrentSlice,0),R.updateIfChanged(p.uCurrentX,0),R.updateIfChanged(p.uCurrentY,0),R.update(p.uBboxMin,o.min),R.update(p.uBboxSize,m),R.update(p.uGridDim,s),R.update(p.uGridTexDim,u),R.update(p.uGridTexScale,c),R.updateIfChanged(p.uAlpha,l),R.updateIfChanged(p.uResolution,f),R.updateIfChanged(p.uRadiusFactorInv,1/d),R.update(p.tMinDistanceTex,i),R.updateIfChanged(p.dGridTexType,i.getDepth()>0?"3d":"2d"),R.updateIfChanged(p.dCalcType,"density"),e.namedComputeRenderables[bu].update()}else e.namedComputeRenderables[bu]=kAe(e,t,r,n,a,i,o,s,u,c,l,f,d);return e.namedComputeRenderables[bu]}function kAe(e,t,r,n,a,i,o,s,u,c,l,f,d){var m=S.sub(S(),o.max,o.min),p={drawCount:R.create(t),instanceCount:R.create(1),aRadius:R.create(n),aPosition:R.create(r),aGroup:R.create(a),uCurrentSlice:R.create(0),uCurrentX:R.create(0),uCurrentY:R.create(0),uBboxMin:R.create(o.min),uBboxSize:R.create(m),uGridDim:R.create(s),uGridTexDim:R.create(u),uGridTexScale:R.create(c),uAlpha:R.create(l),uResolution:R.create(f),uRadiusFactorInv:R.create(1/d),tMinDistanceTex:R.create(i),dGridTexType:R.create(i.getDepth()>0?"3d":"2d"),dCalcType:R.create("density")},v=I({},MAe),h=Qr(bu,IAe,DAe),g=zn(e,"points",h,v,p);return Vn(g,p)}function tV(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function rV(e,t){var r=e.gl,n=e.state;if(R.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function nV(e,t){var r=e.gl,n=e.state;R.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function aV(e,t){var r=e.gl,n=e.state;R.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function LAe(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),a=0,i=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),a=s*e[0],i*=o):a=e[0]*e[2],{texDimX:a,texDimY:i,texRows:o,texCols:s,powerOfTwoSize:i<n?n:n*2}}var iV=new ArrayBuffer(4),NAe=new Int32Array(iV),UAe=new Float32Array(iV);function zAe(e){var t=e<-126?-126:e;return NAe[0]=(1<<23)*(t+126.94269504),UAe[0]}function VAe(e){return zAe(1.44269504*e)}function oV(e,t,r,n,a){return ie(this,void 0,void 0,function(){function i(H,X){for(var Y=H;Y<X;++Y)for(var oe=De.getAt(f,Y),ue=d[oe],me=m[oe],he=p[oe],Pe=g[Y],re=Pe*Pe,ee=1/re,B=Pe*2,z=B*B,le=Math.ceil(B*l),pe=Math.floor(l*(ue-w[0])),ge=Math.floor(l*(me-w[1])),Ce=Math.floor(l*(he-w[2])),Ie=Math.max(0,pe-le),Oe=Math.max(0,ge-le),We=Math.max(0,Ce-le),Ne=Math.min(U,pe+le+2),Ye=Math.min(N,ge+le+2),Xe=Math.min(q,Ce+le+2),Ze=Ie;Ze<Ne;++Ze)for(var Ke=te[Ze]-ue,ht=Ze*J,Ae=Oe;Ae<Ye;++Ae)for(var we=K[Ae]-me,Ve=Ke*Ke+we*we,rt=Ae*j+ht,ut=We;ut<Xe;++ut){var Ue=L[ut]-he,pt=Ve+Ue*Ue;if(pt<=z){var mt=VAe(-k*(pt*ee)),wt=ut+rt;E[wt]+=mt,mt>W[wt]&&(W[wt]=mt,F[wt]=v?v[Y]:Y)}}}function o(){return ie(this,void 0,void 0,function(){var H;return ae(this,function(X){switch(X.label){case 0:H=0,X.label=1;case 1:return H<h?(i(H,Math.min(H+V,h)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:H,max:h})]:[3,3]):[3,4];case 2:X.sent(),X.label=3;case 3:return H+=V,[3,1];case 4:return[2]}})})}var s,u,c,l,f,d,m,p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F,O,U,N,q,j,Q,J,te,K,L,W,k,V,G;return ae(this,function(H){switch(H.label){case 0:for(s=a.resolution,u=a.radiusOffset,c=a.smoothness,l=1/s,f=t.indices,d=t.x,m=t.y,p=t.z,v=t.id,h=De.size(f),g=new Float32Array(h),y=0,b=0;b<h;++b)x=n(De.getAt(f,b))+u,y<x&&(y=x),g[b]=x;return C=y*2+s,_=Bt.expand(Bt(),r,S.create(C,C,C)),w=_.min,T=Bt.scale(Bt(),_,l),A=Bt.size(S(),T),S.ceil(A,A),D=sr.Space(A,[0,1,2],Float32Array),E=D.create(),M=sr.create(D,E),F=D.create(),F.fill(-1),O=sr.create(D,F),U=A[0],N=A[1],q=A[2],j=q,Q=N,J=j*Q,te=Km(A[0],w[0],s),K=Km(A[1],w[1],s),L=Km(A[2],w[2],s),W=D.create(),k=c,V=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*l)),[4,o()];case 1:return H.sent(),G=se.identity(),se.fromScaling(G,S.create(s,s,s)),se.setTranslation(G,_.min),[2,{field:M,idField:O,transform:G,radiusFactor:1,resolution:s}]}})})}var k0=I({resolution:P.Numeric(1,{min:.1,max:20,step:.1},I({description:"Grid resolution/cell spacing."},Je.CustomQualityParamInfo)),radiusOffset:P.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:P.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},Xb);P.getDefaultValues(k0);function J2(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function sV(e,t,r,n){var a=this,i=t.lookup3d.boundary.box,o=Ad(i,n),s=Yb(e,t,r,o),u=s.position,c=s.radius;return Be.create("Gaussian Density",function(l){return ie(a,void 0,void 0,function(){return ae(this,function(f){switch(f.label){case 0:return[4,oV(l,u,i,c,o)];case 1:return[2,f.sent()]}})})})}function GAe(e,t,r,n,a,i){var o=this,s=t.lookup3d.boundary.box,u=Ad(s,n,J2(a,e)),c=Yb(e,t,r,u),l=c.position,f=c.radius;return Be.create("Gaussian Density",function(d){return ie(o,void 0,void 0,function(){return ae(this,function(m){return[2,Z9(a,l,s,f,u,i)]})})})}function HAe(e,t,r,n,a,i,o){var s=this,u=t.lookup3d.boundary.box,c=Ad(u,a,J2(i,e)),l=Yb(e,t,r,c),f=l.position,d=l.radius;return Be.create("Gaussian Density",function(m){return ie(s,void 0,void 0,function(){return ae(this,function(p){return[2,o4(i,f,u,d,n,c,o)]})})})}function qAe(e,t,r){var n=this,a=e.lookup3d.boundary.box,i=Ad(a,r),o=ET(e,t,r.ignoreHydrogens,r.traceOnly),s=o.position,u=o.radius;return Be.create("Gaussian Density",function(c){return ie(n,void 0,void 0,function(){return ae(this,function(l){switch(l.label){case 0:return[4,oV(c,s,a,u,i)];case 1:return[2,l.sent()]}})})})}function jAe(e,t,r,n,a){var i=this,o=e.lookup3d.boundary.box,s=Ad(o,r,J2(n)),u=ET(e,t,r.ignoreHydrogens,r.traceOnly),c=u.position,l=u.radius;return Be.create("Gaussian Density",function(f){return ie(i,void 0,void 0,function(){return ae(this,function(d){return[2,Z9(n,c,o,l,s,a)]})})})}function WAe(e,t,r,n,a,i){var o=this,s=e.lookup3d.boundary.box,u=Ad(s,n,J2(a)),c=ET(e,t,n.ignoreHydrogens,n.traceOnly),l=c.position,f=c.radius;return Be.create("Gaussian Density",function(d){return ie(o,void 0,void 0,function(){return ae(this,function(m){return[2,o4(a,l,s,f,r,u,i)]})})})}var uV=I(I(I({},k0),LB),{ignoreHydrogens:P.Boolean(!1),tryUseGpu:P.Boolean(!0),includeParent:P.Boolean(!1,{isHidden:!0})}),s4=I(I(I({},Na),Z2e),uV),cV=I(I(I({},h0),q2e),uV);function lV(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function qp(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,a=X7(e.boundary.box,t.resolution,n*n),i=a.areaCells,o=a.maxAreaCells;return i<o}function XAe(e,t,r,n){return r.tryUseGpu&&n&&lV(n)&&qp(t,r,n)?eTe(e):QAe(e)}function YAe(e,t,r,n){return r.tryUseGpu&&n&&lV(n)&&qp(t,r,n)?rTe(e):$Ae(e)}function KAe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v;return ae(this,function(h){switch(h.label){case 0:return o=a.smoothness,[4,sV(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=h.sent(),u=s.transform,c=s.field,l=s.idField,f=s.radiusFactor,d=s.resolution,m={isoLevel:Math.exp(-o)/f,scalarField:c,idField:l},[4,c2(m,i).runAsChild(e.runtime)];case 2:return p=h.sent(),p.meta.resolution=d,At.transform(p,u),e.webgl&&!e.webgl.isWebGL2&&At.uniformTriangleGroup(p),v=Te.expand(Te(),t.boundary.sphere,a.radiusOffset+Ip(t)),p.setBoundingSphere(v),[2,p]}})})}function QAe(e){return xi({defaultProps:P.getDefaultValues(s4),createGeometry:KAe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&qp(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,c=Ss(n.smoothColors,a.color.preferSmoothing,s);c&&(AA(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function ZAe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return i=n.smoothness,[4,qAe(t,r.size,n).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,c=o.idField,l=o.radiusFactor,f=o.resolution,d={isoLevel:Math.exp(-i)/l,scalarField:u,idField:c},[4,c2(d,a).runAsChild(e.runtime)];case 2:return m=v.sent(),m.meta.resolution=f,At.transform(m,s),e.webgl&&!e.webgl.isWebGL2&&At.uniformTriangleGroup(m),p=Te.expand(Te(),t.boundary.sphere,n.radiusOffset+Zb(t)),m.setBoundingSphere(p),[2,m]}})})}function $Ae(e){return Td({defaultProps:P.getDefaultValues(cV),createGeometry:ZAe,createLocationIterator:za.fromStructure,getLoci:P2,eachLocation:T2,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&qp(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,c=Ss(n.smoothColors,a.color.preferSmoothing,s);c&&(AA(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var jp="gaussian-surface";function JAe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y,b,x;return ae(this,function(C){switch(C.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,c=o.extensions,l=c.colorBufferFloat,f=c.textureFloat,d=c.colorBufferHalfFloat,m=c.textureHalfFloat,s[jp]||(s[jp]=d&&m?u.texture("image-float16","rgba","fp16","linear"):l&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,HAe(r,t,n.size,!0,a,e.webgl,s[jp]).runInContext(e.runtime)];case 1:return p=C.sent(),v=Math.exp(-a.smoothness)/p.radiusFactor,h=S.create(0,1,2),g=i==null?void 0:i.doubleBuffer.get(),y=GT(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,v,!1,!0,h,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=Te.expand(Te(),t.boundary.sphere,a.radiusOffset+Zb(r)),x=ko.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,b,i),x.meta.resolution=p.resolution,[2,x]}})})}function eTe(e){return $2e({defaultProps:P.getDefaultValues(s4),createGeometry:JAe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!qp(t.structure,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,c=Ss(n.smoothColors,a.color.preferSmoothing,s);c&&i&&(x8(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function tTe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,h,g,y,b;return ae(this,function(x){switch(x.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return i=e.webgl,o=i.namedTextures,s=i.resources,u=i.extensions,c=u.colorBufferFloat,l=u.textureFloat,f=u.colorBufferHalfFloat,d=u.textureHalfFloat,o[jp]||(o[jp]=f&&d?s.texture("image-float16","rgba","fp16","linear"):c&&l?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,WAe(t,r.size,!0,n,e.webgl,o[jp]).runInContext(e.runtime)];case 1:return m=x.sent(),p=Math.exp(-n.smoothness)/m.radiusFactor,v=S.create(0,1,2),h=a==null?void 0:a.doubleBuffer.get(),g=GT(e.webgl,m.texture,m.gridDim,m.gridTexDim,m.gridTexScale,m.transform,p,!1,!0,v,h==null?void 0:h.vertex,h==null?void 0:h.group,h==null?void 0:h.normal),y=Te.expand(Te(),t.boundary.sphere,n.radiusOffset+Zb(t)),b=ko.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,a),b.meta.resolution=m.resolution,[2,b]}})})}function rTe(e){return j2e({defaultProps:P.getDefaultValues(cV),createGeometry:tTe,createLocationIterator:za.fromStructure,getLoci:P2,eachLocation:T2,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!qp(t,r,n)},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,c=Ss(n.smoothColors,a.color.preferSmoothing,s);c&&i&&(x8(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function nTe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m;return ae(this,function(p){switch(p.label){case 0:return o=a.smoothness,[4,sV(r,t,n.size,a).runInContext(e.runtime)];case 1:return s=p.sent(),u=s.transform,c=s.field,l=s.idField,f={isoLevel:Math.exp(-o),scalarField:c,idField:l},[4,zT(f,i).runAsChild(e.runtime)];case 2:return d=p.sent(),Xr.transform(d,u),m=Te.expand(Te(),t.boundary.sphere,a.radiusOffset+Ip(t)),d.setBoundingSphere(m),[2,d]}})})}var fV=I(I(I({},$b),k0),{sizeFactor:P.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:P.Boolean(!1),ignoreHydrogens:P.Boolean(!1),includeParent:P.Boolean(!1,{isHidden:!0})});function aTe(e){return Jb({defaultProps:P.getDefaultValues(fV),createGeometry:nTe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var dV={"gaussian-surface-mesh":function(e,t){return sn("Gaussian surface mesh",e,t,XAe)},"structure-gaussian-surface-mesh":function(e,t){return Ps("Structure-Gaussian surface mesh",e,t,YAe)},"gaussian-surface-wireframe":function(e,t){return sn("Gaussian surface wireframe",e,t,aTe)}},mV=I(I(I({},s4),fV),{visuals:P.MultiSelect(["gaussian-surface-mesh"],P.objectToOptions(dV)),bumpFrequency:P.Numeric(1,{min:0,max:10,step:.1},Je.ShadingCategory)});function iTe(e,t){return P.clone(mV)}function oTe(e,t){return Vt.createMulti("Gaussian Surface",e,t,ta,dV)}var sTe=ri({name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:oTe,getParams:iTe,defaultValues:P.getDefaultValues(mV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}}),pV=I(I({},z2e),{background:P.Boolean(!1),backgroundMargin:P.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:P.Color(tr.black),backgroundOpacity:P.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:P.Numeric(.25,{min:0,max:.5,step:.01}),level:P.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),chainScale:P.Numeric(10,{min:0,max:20,step:.1}),residueScale:P.Numeric(1,{min:0,max:20,step:.1}),elementScale:P.Numeric(.5,{min:0,max:20,step:.1})});function uTe(e){return V2e({defaultProps:P.getDefaultValues(pV),createGeometry:cTe,createLocationIterator:za.fromStructure,getLoci:P2,eachLocation:T2,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function cTe(e,t,r,n,a){switch(n.level){case"chain":return lTe(e,t,r,n,a);case"residue":return fTe(e,t,r,n,a);case"element":return dTe(e,t,r,n,a)}}var ts=S(),L0=new Ji("98");function lTe(e,t,r,n,a){for(var i=Qe.create(t),o=t.units,s=t.serialMapping,u=ft.chain,c=u.auth_asym_id,l=u.label_asym_id,f=s.cumulativeUnitElementCount,d=o.length,m=n.chainScale,p=gc.create(n,d,d/2,a),v=0,h=o.length;v<h;++v){var g=o[v];i.unit=g,i.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,x=y.radius;S.transformMat4(ts,b,g.conformation.operator.matrix);var C=c(i),_=l(i),w=C===_?_:"".concat(_," [").concat(C,"]");p.add(w,ts[0],ts[1],ts[2],x,m,f[v])}return p.getText()}function fTe(e,t,r,n,a){for(var i=Qe.create(t),o=t.units,s=t.serialMapping,u=ft.atom.label_comp_id,c=ft.residue.auth_seq_id,l=s.cumulativeUnitElementCount,f=t.polymerResidueCount*2,d=n.residueScale,m=gc.create(n,f,f/2,a),p=0,v=o.length;p<v;++p){var h=o[p],g=h.conformation.position,y=h.elements;i.unit=h,i.element=h.elements[0];for(var b=h.model.atomicHierarchy.residueAtomSegments.index,x=l[p],C=0,_=y.length;C<_;){var w=C,T=b[y[C]];for(C++;C<_&&b[y[C]]===T;)C++;L0.reset();for(var A=w;A<C;A++)g(y[A],ts),L0.includePosition(ts);L0.finishedIncludeStep();for(var A=w;A<C;A++)g(y[A],ts),L0.radiusPosition(ts);i.element=y[w];var D=L0.getSphere(),E=D.center,M=D.radius,F=c(i),O=u(i),U="".concat(O," ").concat(F);m.add(U,E[0],E[1],E[2],M,d,x+w)}}return m.getText()}function dTe(e,t,r,n,a){for(var i=Qe.create(t),o=t.units,s=t.serialMapping,u=ft.atom,c=u.label_atom_id,l=u.label_alt_id,f=s.cumulativeUnitElementCount,d=r.size,m=t.elementCount,p=n.elementScale,v=gc.create(n,m,m/2,a),h=0,g=o.length;h<g;++h){var y=o[h],b=y.conformation.position,x=y.elements;i.unit=y;for(var C=f[h],_=0,w=x.length;_<w;_++){i.element=x[_],b(i.element,ts);var T=c(i),A=l(i),D=A?"".concat(T,"%").concat(A):T;v.add(D,ts[0],ts[1],ts[2],d.size(i),p,C+_)}}return v.getText()}var vV={"label-text":function(e,t){return Ps("Label text",e,t,uTe)}},hV=I(I({},pV),{visuals:P.MultiSelect(["label-text"],P.objectToOptions(vV))});function mTe(e,t){return P.clone(hV)}function pTe(e,t){var r=Vt.createMulti("Label",e,t,ta,vV);return r.setState({pickable:!1,markerActions:xt.None}),r}var vTe=ri({name:"label",label:"Label",description:"Displays labels.",factory:pTe,getParams:mTe,defaultValues:P.getDefaultValues(hV),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}});function hTe(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function gTe(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),a=new Float32Array(e),i=0;i<e;i++)n[i]=Math.cos(t),a[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:a}}var u4={probeRadius:P.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:P.Numeric(.5,{min:.01,max:20,step:.01},I({description:"Grid resolution/cell spacing."},Je.CustomQualityParamInfo)),probePositions:P.Numeric(36,{min:12,max:90,step:1},I({description:"Number of positions tested for probe target intersection."},Je.CustomQualityParamInfo))};P.getDefaultValues(u4);function yTe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){function o(Ie,Oe,We,Ne,Ye){if(m!==-1){var Xe=m;if(Xe!==Ne&&Xe!==Ye&&s(Xe,Ie,Oe,We))return Xe;m=-1}for(var Ze=0,Ke=A.count;Ze<Ke;++Ze){var Xe=De.getAt(D,A.indices[Ze]);if(Xe!==Ne&&Xe!==Ye&&s(Xe,Ie,Oe,We))return m=Xe,Xe}return-1}function s(Ie,Oe,We,Ne){var Ye=U[Ie],Xe=E[Ie]-Oe,Ze=M[Ie]-We,Ke=F[Ie]-Ne,ht=Xe*Xe+Ze*Ze+Ke*Ke;return ht<Ye*Ye}function u(Ie,Oe){for(var We=Ie;We<Oe;++We){var Ne=De.getAt(D,We),Ye=E[Ne],Xe=M[Ne],Ze=F[Ne],Ke=U[Ne],ht=Ke*Ke;T.find(Ye,Xe,Ze,Ke);for(var Ae=Math.ceil(Ke*C),we=Math.floor(C*(Ye-J)),Ve=Math.floor(C*(Xe-te)),rt=Math.floor(C*(Ze-K)),ut=Math.max(0,we-Ae),Ue=Math.max(0,Ve-Ae),pt=Math.max(0,rt-Ae),mt=Math.min(k,we+Ae+2),wt=Math.min(V,Ve+Ae+2),Z=Math.min(G,rt+Ae+2),de=ut;de<mt;++de)for(var ye=ee[de]-Ye,He=de*Y,ot=Ue;ot<wt;++ot)for(var ct=B[ot]-Xe,Ct=ye*ye+ct*ct,vr=ot*H+He,Rr=pt;Rr<Z;++Rr){var Ur=z[Rr]-Ze,ma=Ct+Ur*Ur;if(ma<ht){var oi=Rr+vr;Pe[oi]<0&&(Pe[oi]*=-1);var si=Math.sqrt(ma),rs=Ke/si,ex=ye*rs+Ye,tx=ct*rs+Xe,qd=Ur*rs+Ze;if(o(ex,tx,qd,Ne,-1)===-1){var jd=Ke-si;jd<Pe[oi]&&(Pe[oi]=jd,re[oi]=O[We])}}}}}function c(){return ie(this,void 0,void 0,function(){var Ie;return ae(this,function(Oe){switch(Oe.label){case 0:Ie=0,Oe.label=1;case 1:return Ie<N?(u(Ie,Math.min(Ie+le,N)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Ie,max:N})]:[3,3]):[3,4];case 2:Oe.sent(),Oe.label=3;case 3:return Ie+=le,[3,1];case 4:return[2]}})})}function l(Ie,Oe){var We=U[Ie],Ne=U[Oe],Ye=p[0]=E[Oe]-E[Ie],Xe=p[1]=M[Oe]-M[Ie],Ze=p[2]=F[Oe]-F[Ie],Ke=Ye*Ye+Xe*Xe+Ze*Ze,ht=Math.sqrt(Ke),Ae=(We*We+ht*ht-Ne*Ne)/(2*We*ht),we=We*Ae;S.normalize(p,p),hTe(h,p),S.normalize(h,h),S.cross(g,p,h),S.normalize(g,g);var Ve=Math.sqrt(We*We-we*we);S.scale(h,h,Ve),S.scale(g,g,Ve),S.scale(p,p,we),v[0]=p[0]+E[Ie],v[1]=p[1]+M[Ie],v[2]=p[2]+F[Ie],m=-1;for(var rt=0;rt<x;++rt){var ut=ue[rt],Ue=me[rt],pt=v[0]+ut*h[0]+Ue*g[0],mt=v[1]+ut*h[1]+Ue*g[1],wt=v[2]+ut*h[2]+Ue*g[2];if(o(pt,mt,wt,Ie,Oe)===-1)for(var Z=Math.floor(C*(pt-J)),de=Math.floor(C*(mt-te)),ye=Math.floor(C*(wt-K)),He=Math.max(0,Z-_),ot=Math.max(0,de-_),ct=Math.max(0,ye-_),Ct=Math.min(k,Z+_+2),vr=Math.min(V,de+_+2),Rr=Math.min(G,ye+_+2),Ur=He;Ur<Ct;++Ur)for(var ma=pt-ee[Ur],oi=Ur*Y,si=ot;si<vr;++si)for(var rs=mt-B[si],ex=ma*ma+rs*rs,tx=si*H+oi,qd=ct;qd<Rr;++qd){var jd=wt-z[qd],y4=ex+jd*jd,rx=qd+tx,nx=Pe[rx];if(nx>0&&y4<nx*nx){Pe[rx]=Math.sqrt(y4);var KV=ma*p[0]+rs*p[1]+jd*p[2];re[rx]=O[De.indexOf(D,KV<0?Oe:Ie)]}}}}function f(Ie,Oe){for(var We=Ie;We<Oe;++We){var Ne=De.getAt(D,We);T.find(E[Ne],M[Ne],F[Ne],U[Ne]);for(var Ye=0,Xe=A.count;Ye<Xe;++Ye){var Ze=De.getAt(D,A.indices[Ye]);Ne<Ze&&l(Ne,Ze)}}}function d(){return ie(this,void 0,void 0,function(){var Ie;return ae(this,function(Oe){switch(Oe.label){case 0:Ie=0,Oe.label=1;case 1:return Ie<N?(f(Ie,Math.min(Ie+le,N)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Ie,max:N})]:[3,3]):[3,4];case 2:Oe.sent(),Oe.label=3;case 3:return Ie+=le,[3,1];case 4:return[2]}})})}var m,p,v,h,g,y,b,x,C,_,w,T,A,D,E,M,F,O,U,N,q,j,Q,J,te,K,L,W,k,V,G,H,X,Y,oe,ue,me,he,Pe,re,ee,B,z,le,pe,ge,Ce;return ae(this,function(Ie){switch(Ie.label){case 0:return m=-1,p=S(),v=S(),h=S(),g=S(),y=i.resolution,b=i.probeRadius,x=i.probePositions,C=1/y,_=Math.max(5,2+Math.floor(b*C)),w=S.create(n,n,n),S.scale(w,w,2),T=jf(t,r,w),A=T.result,a===null&&(a=T.boundary.box),D=t.indices,E=t.x,M=t.y,F=t.z,O=t.id,U=t.radius,N=De.size(D),q=n+y,j=Bt.expand(Bt(),a,S.create(q,q,q)),Q=j.min,J=Q[0],te=Q[1],K=Q[2],L=Bt.scale(Bt(),j,C),W=Bt.size(S(),L),S.ceil(W,W),k=W[0],V=W[1],G=W[2],H=G,X=V,Y=H*X,oe=gTe(x),ue=oe.cosTable,me=oe.sinTable,he=sr.Space(W,[0,1,2],Float32Array),Pe=he.create(),re=he.create(),Pe.fill(-1001),re.fill(-1),ee=Km(k,J,y),B=Km(V,te,y),z=Km(G,K,y),le=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*C)),[4,c()];case 1:return Ie.sent(),[4,d()];case 2:return Ie.sent(),pe=sr.create(he,Pe),ge=sr.create(he,re),Ce=se.identity(),se.fromScaling(Ce,S.create(y,y,y)),se.setTranslation(Ce,j.min),[2,{field:pe,idField:ge,transform:Ce,resolution:y}]}})})}function bTe(e,t,r,n){for(var a=n.probeRadius,i=Yb(e,t,r,n),o=i.position,s=i.boundary,u=i.radius,c=o.indices,l=De.size(c),f=new Float32Array(De.end(c)),d=0,m=0;m<l;++m){var p=De.getAt(c,m),v=u(p);d<v&&(d=v),f[p]=v+a}return{position:I(I({},o),{radius:f}),boundary:s,maxRadius:d}}function gV(e,t,r,n){var a=this,i=t.lookup3d.boundary.box,o=Ad(i,n),s=bTe(e,t,r,o),u=s.position,c=s.boundary,l=s.maxRadius;return Be.create("Molecular Surface",function(f){return ie(a,void 0,void 0,function(){return ae(this,function(d){switch(d.label){case 0:return[4,xTe(f,u,c,l,i,o)];case 1:return[2,d.sent()]}})})})}function xTe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){return ae(this,function(o){return[2,yTe(e,t,r,n,a,i)]})})}var yV=I(I(I(I({},Na),u4),Xb),LB);function STe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p;return ae(this,function(v){switch(v.label){case 0:return[4,gV(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,c=o.idField,l=o.resolution,f={isoLevel:a.probeRadius,scalarField:u,idField:c},[4,c2(f,i).runAsChild(e.runtime)];case 2:return d=v.sent(),a.includeParent&&(m=Math.ceil(2/a.resolution),At.smoothEdges(d,{iterations:m,maxNewEdgeLength:Math.sqrt(2)})),At.transform(d,s),e.webgl&&!e.webgl.isWebGL2&&At.uniformTriangleGroup(d),p=Te.expand(Te(),t.boundary.sphere,Ip(t)),d.setBoundingSphere(p),d.meta.resolution=l,[2,d]}})})}function CTe(e){return xi({defaultProps:P.getDefaultValues(yV),createGeometry:STe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,a,i){var o=r.meta,s=o.resolution,u=o.colorTexture,c=Ss(n.smoothColors,a.color.preferSmoothing,s);c&&(AA(t,c.resolution,c.stride,i,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var bV=I(I(I(I({},$b),u4),Xb),{sizeFactor:P.Numeric(1.5,{min:0,max:10,step:.1})});function _Te(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d;return ae(this,function(m){switch(m.label){case 0:return[4,gV(r,t,n.size,a).runInContext(e.runtime)];case 1:return o=m.sent(),s=o.transform,u=o.field,c=o.idField,l={isoLevel:a.probeRadius,scalarField:u,idField:c},[4,zT(l,i).runAsChild(e.runtime)];case 2:return f=m.sent(),Xr.transform(f,s),d=Te.expand(Te(),t.boundary.sphere,a.probeRadius+Ip(t)),f.setBoundingSphere(d),[2,f]}})})}function wTe(e){return Jb({defaultProps:P.getDefaultValues(bV),createGeometry:_Te,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var xV={"molecular-surface-mesh":function(e,t){return sn("Molecular surface mesh",e,t,CTe)},"molecular-surface-wireframe":function(e,t){return sn("Molecular surface wireframe",e,t,wTe)}},SV=I(I(I({},yV),bV),{visuals:P.MultiSelect(["molecular-surface-mesh"],P.objectToOptions(xV)),bumpFrequency:P.Numeric(1,{min:0,max:10,step:.1},Je.ShadingCategory)});function ATe(e,t){return P.clone(SV)}function TTe(e,t){return Vt.createMulti("Molecular Surface",e,t,ta,xV)}var PTe=ri({name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:TTe,getParams:ATe,defaultValues:P.getDefaultValues(SV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}}),CV=I(I({},Na),{sizeFactor:P.Numeric(1,{min:0,max:2,step:.1}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo)});function ETe(e){return xi({defaultProps:P.getDefaultValues(CV),createGeometry:DTe,createLocationIterator:MTe,getLoci:RTe,eachLocation:BTe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function ITe(e){if(Re.Traits.is(e.traits,1)||Re.Traits.is(e.traits,2))return!1;if(Re.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function DTe(e,t,r,n,a,i){if(!ITe(t))return At.createEmpty(i);var o=a.detail,s=a.sizeFactor,u=256,c=it.createState(u,u/2,i),l=t.principalAxes.boxAxes,f=l.origin,d=l.dirA,m=l.dirB,p=Xa.size(S(),l);S.scale(p,p,s/2);var v=S.create(p[2],p[1],p[0]);c.currentGroup=0,BA(c,f,d,m,v,o+1);var h=it.getMesh(c),g=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return h.setBoundingSphere(g),h}function MTe(e){var t=e.group,r=e.structure,n=1,a=t.units.length,i=Qe.create(r),o=function(s,u){var c=t.units[u];return i.unit=c,i.element=c.elements[s],i};return Wr(n,a,1,o)}function RTe(e,t,r){var n=e.objectId,a=e.instanceId;if(r===n){var i=t.structure,o=t.group,s=o.units[a],u=De.ofBounds(0,s.elements.length);return _e(i,[{unit:s,indices:u}])}return ur}function BTe(e,t,r){var n=!1;if(!_e.is(e))return!1;var a=t.structure,i=t.group;if(!ke.areEquivalent(e.structure,a))return!1;for(var o=i.elements.length,s=0,u=e.elements;s<u.length;s++){var c=u[s],l=i.unitIndexMap.get(c.unit.id);l!==void 0&&De.size(c.indices)===o&&r(Se.ofSingleton(l))&&(n=!0)}return n}var _V={"orientation-ellipsoid-mesh":function(e,t){return sn("Orientation ellipsoid mesh",e,t,ETe)}},wV=I(I({},CV),{visuals:P.MultiSelect(["orientation-ellipsoid-mesh"],P.objectToOptions(_V)),bumpFrequency:P.Numeric(1,{min:0,max:10,step:.1},Je.ShadingCategory)});function FTe(e,t){return P.clone(wV)}function OTe(e,t){return Vt.createMulti("Orientation",e,t,ta,_V)}var kTe=ri({name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:OTe,getParams:FTe,defaultValues:P.getDefaultValues(wV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}}),LTe=Me.add3,NTe=Me.add,c4;(function(e){function t(r,n,a){r===void 0&&(r=2048),n===void 0&&(n=1024);var i=Me.create(Float32Array,3,n,a?a.centerBuffer.ref.value:r),o=Me.create(Float32Array,1,n,a?a.groupBuffer.ref.value:r);return{add:function(s,u,c,l){LTe(i,s,u,c),NTe(o,l)},getPoints:function(){var s=Me.compact(i,!0),u=Me.compact(o,!0);return Qf.create(s,u,i.elementCount,a)}}}e.create=t})(c4||(c4={}));var l4=I(I({},X2e),{pointSizeAttenuation:P.Boolean(!1),ignoreHydrogens:P.Boolean(!1),traceOnly:P.Boolean(!1)});function UTe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return Qf.createEmpty(i);var s=t.elements,u=s.length,c=c4.create(u,u/10,i),l=S(),f=t.conformation.invariantPosition,d=A2(r,t,a);if(d)for(var m=0;m<u;++m)d(s[m])||(f(s[m],l),c.add(l[0],l[1],l[2],m));else for(var m=0;m<u;++m)f(s[m],l),c.add(l[0],l[1],l[2],m);var p=c.getPoints(),v=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return p.setBoundingSphere(v),p}function AV(e){return Y2e({defaultProps:P.getDefaultValues(l4),createGeometry:UTe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var zTe={"element-point":function(e,t){return sn("Points",e,t,AV)}},TV=I({},l4);function VTe(e,t){return P.clone(TV)}function GTe(e,t){return Vt.createMulti("Point",e,t,ta,zTe)}var HTe=ri({name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:GTe,getParams:VTe,defaultValues:P.getDefaultValues(TV),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}}),PV={sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),linearSegments:P.Numeric(8,{min:1,max:48,step:1},Je.CustomQualityParamInfo),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo)};P.getDefaultValues(PV);var Hi=S();function qTe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return At.createEmpty(i);for(var s=a.sizeFactor,u=a.detail,c=a.linearSegments,l=a.radialSegments,f=c*l*o+(l+1)*o*2,d=it.createState(f,f/10,i),m=LP(c),p=m.curvePoints,v=m.normalVectors,h=m.binormalVectors,g=m.widthValues,y=m.heightValues,b=0,x=FP(t,r,{ignoreSecondaryStructure:!0});x.hasNext;){var C=x.move();d.currentGroup=b;var _=iu(C.moleculeType),w=_?O2:F2;NP(m,C,f9,w);var T=C.coarseBackboneFirst||C.first,A=C.coarseBackboneLast||C.last,D=n.size.size(C.centerPrev)*s,E=n.size.size(C.center)*s,M=n.size.size(C.centerNext)*s;HP(m,D,E,M,D,E,M,w);var F=c;if(C.initial){F=Math.max(Math.round(c*w),1);var O=c-F;p.copyWithin(0,O*3),h.copyWithin(0,O*3),v.copyWithin(0,O*3),g.copyWithin(0,O*3),y.copyWithin(0,O*3),S.fromArray(Hi,p,3),S.normalize(Hi,S.sub(Hi,C.p2,Hi)),S.scaleAndAdd(Hi,C.p2,Hi,E*k2),S.toArray(Hi,p,0)}else C.final&&(F=Math.max(Math.round(c*(1-w)),1),S.fromArray(Hi,p,F*3-3),S.normalize(Hi,S.sub(Hi,C.p2,Hi)),S.scaleAndAdd(Hi,C.p2,Hi,E*k2),S.toArray(Hi,p,F*3));C.initial===!0&&C.final===!0?Kn(d,C.p2,E*2,u):l===2?$2(d,p,v,h,F,g,y,0):l===4?Q2(d,p,v,h,F,g,y,0,T,A):t4(d,p,v,h,F,l,g,y,T,A,"elliptical"),++b}var U=it.getMesh(d),N=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return U.setBoundingSphere(N),U}var EV=I(I({},Na),PV);function jTe(e){return xi({defaultProps:P.getDefaultValues(EV),createGeometry:qTe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var IV={"polymer-tube":function(e,t){return sn("Polymer tube mesh",e,t,jTe)},"polymer-gap":function(e,t){return sn("Polymer gap cylinder",e,t,QP)}},DV=I(I(I({},EV),W2),{sizeFactor:P.Numeric(.2,{min:0,max:10,step:.01}),visuals:P.MultiSelect(["polymer-tube","polymer-gap"],P.objectToOptions(IV)),bumpFrequency:P.Numeric(2,{min:0,max:10,step:.1},Je.ShadingCategory)});function WTe(e,t){var r=P.clone(DV),n=!1,a=!1;return t.units.forEach(function(i){!n&&Re.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!a&&i.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-tube"],a&&r.visuals.defaultValue.push("polymer-gap"),r}function XTe(e,t){return Vt.createMulti("Putty",e,t,ta,IV)}var YTe=ri({name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:XTe,getParams:WTe,defaultValues:P.getDefaultValues(DV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}}),KTe={"element-sphere":function(e,t){return sn("Sphere mesh",e,t,Uz)}},MV=I(I({},E2),{bumpFrequency:P.Numeric(1,{min:0,max:10,step:.1},Je.ShadingCategory)});function QTe(e,t){var r=P.clone(MV);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function ZTe(e,t){return Vt.createMulti("Spacefill",e,t,ta,KTe)}var $Te=ri({name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:ZTe,getParams:QTe,defaultValues:P.getDefaultValues(MV),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}}),f4=ar.is;function JTe(e,t,r,n,a,i){if(!Re.isAtomic(t))return Xr.createEmpty(i);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Xr.createEmpty(i);var u=Qe.create(r,t),c=t.elements,l=t.bonds,f=l.edgeCount,d=l.a,m=l.b,p=l.edgeProps,v=l.offset;if(!f)return Xr.createEmpty(i);var h=p.order,g=p.flags,y=a.sizeFactor,b=a.aromaticBonds,x=a.includeTypes,C=a.excludeTypes,_=a.multipleBonds,w=_==="off",T=_==="symmetric",A=ar.fromNames(x),D=ar.fromNames(C),E=S2(A,D,32),M=S(),F=t.conformation.invariantPosition,O=t.rings,U=O.elementRingIndices,N=O.elementAromaticRingIndices,q={linkCount:f*2,referencePosition:function(J){var te,K,L=d[J],W=m[J];L>W&&(te=[W,L],L=te[0],W=te[1]),v[L+1]-v[L]==1&&(K=[W,L],L=K[0],W=K[1]);for(var k=N.get(L)||U.get(L),V=0,G=v[L],H=v[L+1];G<H;++G){var X=m[G];if(X!==W&&X!==L)if(k){var Y=N.get(X)||U.get(X);if(!Y)continue;var oe=Iy(k,Y);oe>V&&(V=oe,F(c[X],M))}else return F(c[X],M)}return V>0?M:null},position:function(J,te,K){F(c[d[K]],J),F(c[m[K]],te)},style:function(J){var te=h[J],K=g[J];if(f4(K,2)||f4(K,4))return 1;if(te===3)return w?0:T?4:5;if(b){var L=d[J],W=m[J],k=N.get(L),V=N.get(W),G=k&&V?Iy(k,V):0;if(f4(K,16)||G&&!E)return G===2?8:7}return te!==2||w?0:T?2:3},radius:function(J){u.element=c[d[J]];var te=n.size.size(u);u.element=c[m[J]];var K=n.size.size(u);return Math.min(te,K)*y},ignore:Iz(r,t,a)},j=uU(e,q,a,i),Q=Te.expand(Te(),(s!=null?s:t).boundary.sphere,1*y);return j.setBoundingSphere(Q),j}var RV=I(I(I({},$b),mP),{includeParent:P.Boolean(!1)});function ePe(e){return Jb({defaultProps:P.getDefaultValues(RV),createGeometry:JTe,createLocationIterator:Ql.fromGroup,getLoci:pP,eachLocation:vP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;var u=o.group.units[0],c=s.group.units[0];Re.isAtomic(u)&&Re.isAtomic(c)&&(Ni.areEqual(u.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var d4=new Pt.ElementBondIterator;function BV(e,t,r,n){for(d4.setElement(t,r,n);d4.hasNext;){var a=d4.move();return a.otherUnit.conformation.position(a.otherUnit.elements[a.otherIndex],e),e}return null}function tPe(e,t,r,n,a){var i=t.interUnitBonds,o=i.edgeCount,s=i.edges;if(!o)return Xr.createEmpty(a);var u=n.sizeFactor,c=n.aromaticBonds,l=n.multipleBonds,f=l==="off",d=l==="symmetric",m=S(),p=Qe.create(),v={linkCount:o,referencePosition:function(b){var x=s[b],C,_,w,T;if(x.unitA<x.unitB)C=t.unitMap.get(x.unitA),_=t.unitMap.get(x.unitB),w=x.indexA,T=x.indexB;else if(x.unitA>x.unitB)C=t.unitMap.get(x.unitB),_=t.unitMap.get(x.unitA),w=x.indexB,T=x.indexA;else throw new Error("same units in createInterUnitBondLines");return BV(m,t,C,w)||BV(m,t,_,T)},position:function(b,x,C){var _=s[C],w=t.unitMap.get(_.unitA),T=t.unitMap.get(_.unitB);w.conformation.position(w.elements[_.indexA],b),T.conformation.position(T.elements[_.indexB],x)},style:function(b){var x=s[b].props.order,C=Da.create(s[b].props.flag);return ar.is(C,2)||ar.is(C,4)?1:x===3?f?0:d?4:5:c&&ar.is(C,16)?7:x!==2||f?0:d?2:3},radius:function(b){var x=s[b];p.structure=t,p.unit=t.unitMap.get(x.unitA),p.element=p.unit.elements[x.indexA];var C=r.size.size(p);p.unit=t.unitMap.get(x.unitB),p.element=p.unit.elements[x.indexB];var _=r.size.size(p);return Math.min(C,_)*u},ignore:Dz(t,n)},h=uU(e,v,n,a),g=t.child,y=Te.expand(Te(),(g!=null?g:t).boundary.sphere,1*n.sizeFactor);return h.setBoundingSphere(y),h}var FV=I(I(I({},N2e),mP),{includeParent:P.Boolean(!1)});function rPe(e){return U2e({defaultProps:P.getDefaultValues(FV),createGeometry:tPe,createLocationIterator:Ql.fromStructure,getLoci:hP,eachLocation:yP,setUpdateState:function(t,r,n,a,i,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!li(r.includeTypes,n.includeTypes)||!li(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,o.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var Wp=S.scaleAndAdd,OV=S.unitX,kV=S.unitY,LV=S.unitZ,NV=I(I({},$b),{lineSizeAttenuation:P.Boolean(!1),ignoreHydrogens:P.Boolean(!1),traceOnly:P.Boolean(!1),crosses:P.Select("lone",P.arrayToOptions(["lone","all"])),crossSize:P.Numeric(.35,{min:0,max:2,step:.01})});function nPe(e,t,r,n,a,i){var o=r.child;if(o&&!o.unitMap.get(t.id))return Xr.createEmpty(i);for(var s=t.elements,u=s.length,c=Bi.create(u,u/10,i),l=S(),f=S(),d=S(),m=t.conformation.invariantPosition,p=A2(r,t,a),v=a.crossSize/2,h=a.crosses==="lone",g=0;g<u;++g)p&&p(s[g])||h&&Re.isAtomic(t)&&vu(r,t,g)!==0||(m(s[g],l),Wp(f,l,OV,v),Wp(d,l,OV,-v),c.add(f[0],f[1],f[2],d[0],d[1],d[2],g),Wp(f,l,kV,v),Wp(d,l,kV,-v),c.add(f[0],f[1],f[2],d[0],d[1],d[2],g),Wp(f,l,LV,v),Wp(d,l,LV,-v),c.add(f[0],f[1],f[2],d[0],d[1],d[2],g));var y=c.getLines(),b=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function aPe(e){return Jb({defaultProps:P.getDefaultValues(NV),createGeometry:nPe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var UV={"intra-bond":function(e,t){return sn("Intra-unit bond line",e,t,ePe)},"inter-bond":function(e,t){return Ps("Inter-unit bond line",e,t,rPe)},"element-point":function(e,t){return sn("Points",e,t,AV)},"element-cross":function(e,t){return sn("Crosses",e,t,aPe)}},zV=I(I(I(I(I({},RV),FV),l4),NV),{multipleBonds:P.Select("offset",P.arrayToOptions(["off","symmetric","offset"])),includeParent:P.Boolean(!1),sizeFactor:P.Numeric(3,{min:.01,max:10,step:.01}),unitKinds:v0(["atomic"]),visuals:P.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],P.objectToOptions(UV))});function iPe(e,t){var r=P.clone(zV);return r.pointStyle.defaultValue="circle",r}function oPe(e,t){return Vt.createMulti("Line",e,t,ta,UV)}var sPe=ri({name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:oPe,getParams:iPe,defaultValues:P.getDefaultValues(zV),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}});function uPe(e,t,r,n,a){return ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,d,m,p,v,h,g,y;return ae(this,function(b){switch(b.label){case 0:if(i=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=a?a.gridTexture.ref.value:void 0,[4,jAe(t,r.size,n,o,s).runInContext(i)];case 1:return u=b.sent(),c=u.transform,l=u.texture,f=u.bbox,d=u.gridDim,m={min:0,max:1,mean:.04,sigma:.01},p=se.mul(se(),c,se.fromScaling(se(),d)),v=se.getScaling(S(),c),h=S.create(0,1,2),g=ro.create(f,d,c,p,v,l,m,!0,h,a),y=Te.expand(Te(),t.boundary.sphere,n.radiusOffset+Zb(t)),g.setBoundingSphere(y),[2,g]}})})}var VV=I(I(I({},G2e),k0),{ignoreHydrogens:P.Boolean(!1),includeParent:P.Boolean(!1,{isHidden:!0})});function cPe(e){return H2e({defaultProps:P.getDefaultValues(VV),createGeometry:uPe,createLocationIterator:za.fromStructure,getLoci:P2,eachLocation:T2,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function lPe(e,t,r,n,a,i){return ie(this,void 0,void 0,function(){var o,s,u,c,l,f,d,m,p,v,h,g,y,b;return ae(this,function(x){switch(x.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=i?i.gridTexture.ref.value:void 0,[4,GAe(r,t,n.size,a,s,u).runInContext(o)];case 1:return c=x.sent(),l=c.transform,f=c.texture,d=c.bbox,m=c.gridDim,p={min:0,max:1,mean:.04,sigma:.01},v=se.mul(se(),l,se.fromScaling(se(),m)),h=se.getScaling(S(),l),g=S.create(0,1,2),y=ro.create(d,m,l,v,h,f,p,!0,g,i),b=Te.expand(Te(),t.boundary.sphere,a.radiusOffset+Ip(t)),y.setBoundingSphere(b),[2,y]}})})}var fPe=I(I(I({},K2e),k0),{ignoreHydrogens:P.Boolean(!1),includeParent:P.Boolean(!1,{isHidden:!0})});function dPe(e){return Q2e({defaultProps:P.getDefaultValues(fPe),createGeometry:lPe,createLocationIterator:za.fromGroup,getLoci:Rs,eachLocation:Ms,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var GV={"gaussian-volume":function(e,t){return Ps("Gaussian volume",e,t,cPe)},"units-gaussian-volume":function(e,t){return sn("Units-Gaussian volume",e,t,dPe)}},HV=I(I({},VV),{visuals:P.MultiSelect(["gaussian-volume"],P.objectToOptions(GV))});function mPe(e,t){var r=P.clone(HV);return r.jumpLength=P.Numeric(4,{min:0,max:20,step:.1}),r}function pPe(e,t){return Vt.createMulti("Gaussian Volume",e,t,ta,GV)}var vPe=ri({name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:pPe,getParams:mPe,defaultValues:P.getDefaultValues(HV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}}),hPe=S.scale,gPe=S.add,yPe=S.sub,m4=I(I(I({},Na),nU),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:P.Numeric(16,{min:2,max:56,step:2},Je.CustomQualityParamInfo),tryUseImpostor:P.Boolean(!0)});function bPe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?SPe(e):_Pe(e)}function xPe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return no.createEmpty(i);var s=o*2,u=r2.create(s,s/4,i),c=t.conformation.invariantPosition,l=S(),f=S(),d=S(),m=function(h,g,y,b,x){c(h,l),c(g,f);var C=iu(x),_=C?O2:F2;gPe(d,l,hPe(d,yPe(d,f,l),_)),u.add(l[0],l[1],l[2],d[0],d[1],d[2],1,!1,!1,y),u.add(d[0],d[1],d[2],f[0],f[1],f[2],1,!1,!1,b)};t9(t,m);var p=u.getCylinders(),v=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return p.setBoundingSphere(v),p}function SPe(e){return aU({defaultProps:P.getDefaultValues(m4),createGeometry:xPe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function CPe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return At.createEmpty(i);var s=a.radialSegments,u=a.sizeFactor,c=s*2*o*2,l=it.createState(c,c/10,i),f=t.conformation.invariantPosition,d=S(),m=S(),p={radiusTop:1,radiusBottom:1,radialSegments:s},v=Qe.create(r,t),h=Qe.create(r,t),g=function(x,C,_,w,T){v.element=x,h.element=C,f(v.element,d),f(h.element,m);var A=iu(T),D=A?O2:F2;p.radiusTop=p.radiusBottom=n.size.size(v)*u,l.currentGroup=_,la(l,d,m,D,p),p.radiusTop=p.radiusBottom=n.size.size(h)*u,l.currentGroup=w,la(l,m,d,1-D,p)};t9(t,g);var y=it.getMesh(l),b=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return y.setBoundingSphere(b),y}function _Pe(e){return xi({defaultProps:P.getDefaultValues(m4),createGeometry:CPe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var p4=I(I(I({},Na),tU),{sizeFactor:P.Numeric(.3,{min:0,max:10,step:.01}),detail:P.Numeric(0,{min:0,max:3,step:1},Je.CustomQualityParamInfo),tryUseImpostor:P.Boolean(!0)});function wPe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?TPe(e):EPe(e)}function APe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return Tl.createEmpty(i);var s=w2.create(o,o/2,i),u=t.conformation.invariantPosition,c=S(),l=function(m,p){u(m,c),s.add(c[0],c[1],c[2],p)};r9(t,l);var f=s.getSpheres(),d=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return f.setBoundingSphere(d),f}function TPe(e){return rU({defaultProps:P.getDefaultValues(p4),createGeometry:APe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function PPe(e,t,r,n,a,i){var o=t.polymerElements.length;if(!o)return At.createEmpty(i);var s=a.detail,u=a.sizeFactor,c=o*b1(s),l=it.createState(c,c/2,i),f=t.conformation.invariantPosition,d=S(),m=Qe.create(r,t),p=function(g,y){m.element=g,f(m.element,d),l.currentGroup=y,Kn(l,d,n.size.size(m)*u,s)};r9(t,p);var v=it.getMesh(l),h=Te.expand(Te(),t.boundary.sphere,1*a.sizeFactor);return v.setBoundingSphere(h),v}function EPe(e){return xi({defaultProps:P.getDefaultValues(p4),createGeometry:PPe,createLocationIterator:Dc.fromGroup,getLoci:Ld,eachLocation:Nd,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var qV={"polymer-backbone-cylinder":function(e,t){return sn("Polymer backbone cylinder",e,t,bPe)},"polymer-backbone-sphere":function(e,t){return sn("Polymer backbone sphere",e,t,wPe)},"polymer-gap":function(e,t){return sn("Polymer gap cylinder",e,t,QP)}},jV=I(I(I(I({},p4),m4),W2),{sizeAspectRatio:P.Numeric(1,{min:.1,max:3,step:.1}),visuals:P.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],P.objectToOptions(qV)),bumpFrequency:P.Numeric(0,{min:0,max:10,step:.1},Je.ShadingCategory)});function IPe(e,t){var r=P.clone(jV),n=!1;return t.units.forEach(function(a){!n&&a.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function DPe(e,t){return Vt.createMulti("Backbone",e,t,ta,qV)}var MPe=ri({name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:DPe,getParams:IPe,defaultValues:P.getDefaultValues(jV),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}}),v4=function(e){_t(t,e);function t(){var r=e.call(this)||this;return wo(t.BuiltIn,function(n,a){if(n.name!==a)throw new Error("Fix BuiltInStructureRepresentations to have matching names. ".concat(n.name," ").concat(a));r.add(n)}),r}return t}(_8);(function(e){e.BuiltIn={cartoon:_Ae,backbone:MPe,"ball-and-stick":D_e,carbohydrate:mwe,ellipsoid:EAe,"gaussian-surface":sTe,"gaussian-volume":vPe,label:vTe,line:sPe,"molecular-surface":PTe,orientation:kTe,point:HTe,putty:YTe,spacefill:$Te}})(v4||(v4={}));var RPe=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(en()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return ie(this,void 0,void 0,function(){return ae(this,function(a){switch(a.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous,r==null?void 0:r.animation)];case 1:return a.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=en()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),(t==null?void 0:t.immediate)?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),(t==null?void 0:t.noDraw)&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),h4=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=zy.create(new fe.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(wn.State.HistoryCapacity)}),n.behaviors=zy.create(new xr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:ku(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:ku(n.data.events.cell.created,n.behaviors.events.cell.created),removed:ku(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:ku(n.data.events.object.created,n.behaviors.events.object.created),removed:ku(n.data.events.object.removed,n.behaviors.events.object.removed),updated:ku(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(a){n.snapshotParams.next(I(I({},t.DefaultSnapshotParams),a))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,a,i=I(I({},this.snapshotParams.value),r);return{id:zr.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((n=i==null?void 0:i.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:i.canvas3d?{props:(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:i==null?void 0:i.durationInMs}},t.prototype.setSnapshot=function(r){var n,a,i;return ie(this,void 0,void 0,function(){var o;return ae(this,function(s){switch(s.label){case 0:return[4,this.animation.stop()];case 1:return s.sent(),((n=r.structureComponentManager)===null||n===void 0?void 0:n.options)?[4,this.plugin.managers.structure.component.setOptions((a=r.structureComponentManager)===null||a===void 0?void 0:a.options)]:[3,3];case 2:s.sent(),s.label=3;case 3:return r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,5];case 4:s.sent(),s.label=5;case 5:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,7];case 6:s.sent(),s.label=7;case 7:return((i=r.canvas3d)===null||i===void 0?void 0:i.props)?(o=P.normalizeParams(s7,r.canvas3d.props,"children"),[4,Xt.Canvas3D.SetSettings(this.plugin,{settings:o})]):[3,9];case 8:s.sent(),s.label=9;case 9:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&Xt.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,a,i){var o=r.build().to(n).update(a);return Xt.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:i}})},t.prototype.updateBehavior=function(r,n){var a=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))a.to(r.id).update(n);else{var i=r.createDefaultParams(void 0,this.plugin);a.to(xr.getCategoryId(r)).apply(r,Lf(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(a))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){xr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(s0);(function(e){e.SnapshotParams={durationInMs:P.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:P.Boolean(!0),behavior:P.Boolean(!1),componentManager:P.Boolean(!0),animation:P.Boolean(!0),startAnimation:P.Boolean(!1),canvas3d:P.Boolean(!0),interactivity:P.Boolean(!0),camera:P.Boolean(!0),cameraTransition:P.MappedStatic("animate",{animate:P.Group({durationInMs:P.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:P.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=P.getDefaultValues(e.SnapshotParams)})(h4||(h4={}));var BPe=function(){function e(t){var r=this;this.plugin=t,this.ev=Lu.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var a=n.first();return r.transforms.get(a).transformer.definition.isDecorator?this.getDecorator(a):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(!!n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!fe.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var a=this.root.get(n.data);a.count++}else{var i=t.select(Yt.Generators.byRef(r).rootOfType([fe.Molecule.Structure]))[0];i?this.root.set(n.data,{ref:i.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,a){return fe.Molecule.Structure.is(a)?(this.removeMapping(r),this.addMapping(t,r,a),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),g4=function(){function e(){this.ev=Lu.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var a=n[r],i=this.tryGetAbortTaskId(a);if(i!==void 0)return i}},e.prototype.track=function(t,r){var n=this;return function(a){var i;if(a.canAbort&&a.requestAbort){var o=n.tryGetAbortTaskId(a.root);o!==void 0&&a.requestAbort(n.abortRequests.get(o))}var s=en()-a.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(i=n.options.get(r))===null||i===void 0?void 0:i.useOverlay,level:s<250?"none":"background",progress:a})}},e.prototype.run=function(t,r){return ie(this,void 0,void 0,function(){var n,a,i;return ae(this,function(o){switch(o.label){case 0:n=this.id++,(r==null?void 0:r.createNewContext)||this.currentContext.length===0?a={ctx:Zj(t,this.track(n,t.id),100),refCount:1}:(a=this.currentContext[this.currentContext.length-1],a.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r==null?void 0:r.useOverlay)}),this.runningTasks.add(t.id),[4,sM(a.ctx,t)];case 2:return i=o.sent(),[2,i];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),a.refCount--,a.refCount===0&&dh(this.currentContext,a),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(a){return setTimeout(a,n)})}function r(n){var a=this;return Be.create("Test",function(i){return ie(a,void 0,void 0,function(){var o;return ae(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),i.shouldUpdate?[4,i.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(g4||(g4={}));var FPe=function(e){_t(t,e);function t(r){var n=e.call(this,{entries:ds()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,Xt.Toast.Show.subscribe(r,function(a){return n.show(a)}),Xt.Toast.Hide.subscribe(r,function(a){return n.hide(n.findByKey(a.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,a=this.state.entries,i=void 0,o=++this.serialId,s;r.key&&(i=this.findByKey(r.key))?(i.timeout!==void 0&&clearTimeout(i.timeout),s=i.serialNumber,a=a.remove(i.id)):s=++this.serialNumber,i={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:a.set(o,i)})&&this.events.changed.next(void 0)},t.prototype.timeout=function(r,n){var a=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var i=a.state.entries.get(r);i.timeout=void 0,a.hide(i)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){!r||(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))},t}(xc),OPe=function(e){_t(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var a=document.createElement("canvas");return a}(),n.previewCanvas=function(){var a=document.createElement("canvas");return a}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:st(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:P.MappedStatic("viewport",{viewport:P.Group({}),hd:P.Group({}),"full-hd":P.Group({}),"ultra-hd":P.Group({}),custom:P.Group({width:P.Numeric(1920,{min:128,max:r,step:1}),height:P.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:P.Boolean(!1),axes:Lb.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,a=n.webgl.extensions,i=a.colorBufferFloat,o=a.textureFloat,s=n.props.postprocessing.occlusion;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:i&&o?4:2},postprocessing:I(I({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:I(I({},s.params),{samples:128})}:s}),marking:I({},n.props.marking)})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:I(I({},r.props.postprocessing),{occlusion:n.name==="on"?{name:"on",params:I(I({},n.params),{samples:128})}:n}),marking:I({},r.props.marking)}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(Yt.Generators.rootsOfType(fe.Molecule.Model)).map(function(o){return o.obj.data}),a=new Set;n.forEach(function(o){return a.add(o.entryId.toUpperCase())});var i=Cn.toArray(a).join("-");return"".concat(i||"molstar-image").concat(r)},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(I(I({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(I(I({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return qr(r.x,0,1e-5)&&qr(r.y,0,1e-5)&&qr(r.width,1,1e-5)&&qr(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,a=n.data,i=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,c=i,l=0,f=o,d=0,m=0;m<o;m++)for(var p=m*i,v=0;v<i;v++){var h=4*(p+v);if(s){if(a[h+3]===0)continue}else{var g=a[h]<<16|a[h+1]<<8|a[h+2]|a[h+3]<<24;if(g===u)continue}v<c&&(c=v),v>l&&(l=v),m<f&&(f=m),m>d&&(d=m)}if(c>l){var y=c;c=l,l=y}if(f>d){var y=f;f=d,d=y}var b=l-c+1,x=d-f+1;c-=r*b,l+=r*b,f-=r*x,d+=r*x;var C={x:Math.max(0,c/i),y:Math.max(0,f/o),width:Math.min(1,(l-c+1)/i),height:Math.min(1,(d-f+1)/o)};this.behaviors.relativeCrop.next(C)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),a=n.width,i=n.height;if(!(a<=0||i<=0)){var o=a/i,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var c=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:c.postprocessing,marking:c.marking});var l=this.previewPass.getImageData(s,u),f=this.previewCanvas;f.width=l.width,f.height=l.height,this.previewData.image=l,this.previewData.background=c.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var d=f.getContext("2d");if(!d)throw new Error("Could not create canvas 2d context");return d.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:f,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,a=r.height,i=this.relativeCrop,o={x:Math.floor(i.x*n),y:Math.floor(i.y*a),width:Math.ceil(i.width*n),height:Math.ceil(i.height*a)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>a&&(o.height=a-o.y),{width:n,height:a,viewport:o}},t.prototype.draw=function(r){return ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return n=this.getSizeAndViewport(),a=n.width,i=n.height,o=n.viewport,a<=0||i<=0?[2]:[4,r.update("Rendering image...")];case 1:return l.sent(),s=this.imagePass.getImageData(a,i,o),[4,r.update("Encoding image...")];case 2:if(l.sent(),u=this.canvas,u.width=s.width,u.height=s.height,c=u.getContext("2d"),!c)throw new Error("Could not create canvas 2d context");return c.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n==null?void 0:n.write)){this.plugin.log.error("clipboard.write not supported!");return}return Be.create("Copy Image",function(a){return ie(r,void 0,void 0,function(){var i,o;return ae(this,function(s){switch(s.label){case 0:return[4,this.draw(a)];case 1:return s.sent(),[4,a.update("Converting image...")];case 2:return s.sent(),[4,az(this.canvas,"png")];case 3:return i=s.sent(),o=new ClipboardItem({"image/png":i}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(Be.create("Generate Image",function(n){return ie(r,void 0,void 0,function(){return ae(this,function(a){switch(a.label){case 0:return[4,this.draw(n)];case 1:return a.sent(),[4,n.update("Converting image...")];case 2:return a.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(!!r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return Be.create("Download Image",function(a){return ie(n,void 0,void 0,function(){var i;return ae(this,function(o){switch(o.label){case 0:return[4,this.draw(a)];case 1:return o.sent(),[4,a.update("Downloading image...")];case 2:return o.sent(),[4,az(this.canvas,"png")];case 3:return i=o.sent(),bN(i,r!=null?r:this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(s0),qPe=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,a){return r.managers.task.run(n,a)},this.resolveTask=function(n){if(!!n)return Be.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=Lu.create(),this.config=new L0e(this.spec.config),this.state=new h4(this),this.commands=new E0e,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ts.None,buttons:0,button:0}),click:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ts.None,buttons:0,button:0}),drag:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ts.None,buttons:0,button:0,pageStart:Fe(),pageEnd:Fe()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(yX(function(n){return!!n}),bX(1))}},this.layout=new m_e(this),this.animationLoop=new RPe(this),this.representation={structure:{registry:new v4,themes:{colorThemeRegistry:du.createRegistry(),sizeThemeRegistry:ea.createRegistry()}},volume:{registry:new m2,themes:{colorThemeRegistry:du.createRegistry(),sizeThemeRegistry:ea.createRegistry()}}},this.query={structure:{registry:new dfe}},this.dataFormats=new y3e,this.builders={data:new XCe(this),structure:void 0},this.helpers={substructureParent:new BPe(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new aP(this),component:new rP(this),measurement:new K3e(this),selection:new Z3e(this),focus:new D3e(this)},volume:{hierarchy:new cP(this)},interactivity:void 0,camera:new S3e(this),animation:new b3e(this),snapshot:new Db(this),lociLabels:void 0,toast:new FPe(this),asset:new NW,task:new g4},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new h2.Registry,this.customStructureProperties=new h2.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:wf(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(Xs.error(n))},message:function(n){return r.events.log.next(Xs.message(n))},info:function(n){return r.events.log.next(Xs.info(n))},warn:function(n){return r.events.log.next(Xs.warning(n))}},this.fetch=h3,RX(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var a=this,i,o,s,u,c,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var f=!((i=this.config.get(wn.General.DisableAntialiasing))!==null&&i!==void 0?i:!1),d=!((o=this.config.get(wn.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0?o:!1),m=this.config.get(wn.General.PixelScale)||1,p=this.config.get(wn.General.PickScale)||.25,v=(s=this.config.get(wn.General.PickPadding))!==null&&s!==void 0?s:1,h=this.config.get(wn.General.EnableWboit)||!1,g=this.config.get(wn.General.PreferWebGl1)||!1;this.canvas3dContext=rT.fromCanvas(t,{antialias:f,preserveDrawingBuffer:d,pixelScale:m,pickScale:p,pickPadding:v,enableWboit:h,preferWebGl1:g})}this.canvas3d=nT.create(this.canvas3dContext),this.canvas3dInit.next(!0);var y=this.spec.canvas3d,b=st(16579577);return y?(((c=y.renderer)===null||c===void 0?void 0:c.backgroundColor)===void 0&&(y=Lf(y,function(x){x.renderer?x.renderer.backgroundColor=b:x.renderer={backgroundColor:b}})),(l=this.canvas3d)===null||l===void 0||l.setProps(y)):(u=this.canvas3d)===null||u===void 0||u.setProps({renderer:{backgroundColor:b}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new OPe(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(x){return a.behaviors.interaction.click.next(x)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(x){return a.behaviors.interaction.drag.next(x)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(x){return a.behaviors.interaction.hover.next(x)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return a.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return a.handleResize()})})),this.handleResize(),!0}catch(x){return this.log.error(""+x),console.error(x),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,a=this.layout.root;if(a&&n){var i=this.config.get(wn.General.PixelScale)||1;jCe(n,a,i),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(tT)),Xt.State.RemoveObject(this,{state:this.state.data,ref:gr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var a=0,i=this.subs;a<i.length;a++){var o=i[a];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),wo(this.managers,function(s){var u,c;return(c=(u=s)===null||u===void 0?void 0:u.dispose)===null||c===void 0?void 0:c.call(u)}),wo(this.managers.structure,function(s){var u,c;return(c=(u=s)===null||u===void 0?void 0:u.dispose)===null||c===void 0?void 0:c.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(ku(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(wn.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,a=void 0,i=function(){n.value||n.next(!0)},o=function(){a!==void 0&&clearTimeout(a),a=void 0};this.subs.push(ku(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,c=t.behaviors.state.isAnimating.value;u||c?n.value||(o(),a=setTimeout(i,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;o2.State.registerDefault(this),o2.Representation.registerDefault(this),o2.Camera.registerDefault(this),o2.Misc.registerDefault(this),this.subs.push(ku(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ie(this,void 0,void 0,function(){var t,r,n,a,i,o,s,a,u,c,s,a;return ae(this,function(l){switch(l.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(xr.Categories);r<n.length;r++)a=n[r],t.toRoot().apply(xr.CreateCategory,{label:xr.Categories[a]},{ref:a,state:{isLocked:!0}});for(i=0,o=this.spec.behaviors;i<o.length;i++)s=o[i],a=xr.getCategoryId(s.transformer),a==="custom-props"&&t.to(xr.getCategoryId(s.transformer)).apply(s.transformer,s.defaultParams,{ref:s.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(l.sent(),t=this.state.behaviors.build(),u=0,c=this.spec.behaviors;u<c.length;u++)s=c[u],a=xr.getCategoryId(s.transformer),a!=="custom-props"&&t.to(xr.getCategoryId(s.transformer)).apply(s.transformer,s.defaultParams,{ref:s.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return l.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(!!this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(!!this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(!!this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return ie(this,void 0,void 0,function(){var t=this;return ae(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new tP(this),this.managers.lociLabels=new C3e(this),this.builders.structure=new n3e(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin ".concat(LA," [").concat(B0e.toLocaleString(),"]")),ih||this.log.message("Development mode enabled"),hr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),kPe={exports:{}},N0={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LPe=U0.exports,WV=60103;N0.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var XV=Symbol.for;WV=XV("react.element"),N0.Fragment=XV("react.fragment")}var NPe=LPe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,UPe=Object.prototype.hasOwnProperty,zPe={key:!0,ref:!0,__self:!0,__source:!0};function YV(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)UPe.call(t,n)&&!zPe.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:WV,type:e,key:i,ref:o,props:a,_owner:NPe.current}}N0.jsx=YV;N0.jsxs=YV;kPe.exports=N0;export{HPe as D,qPe as P,GPe as R,VPe as a,kPe as j,U0 as r};
